/*!
 * @maptalks/gl-layers v0.31.8
 * LICENSE : MIT
 * (c) 2016-2024 maptalks.com
 */
!function(global,factory){"object"==typeof exports&&"undefined"!=typeof module?factory(exports,require("maptalks")):"function"==typeof define&&define.amd?define(["exports","maptalks"],factory):factory((global="undefined"!=typeof globalThis?globalThis:global||self).maptalks=global.maptalks||{},global.maptalks)}(this,(function(exports,t$1){"use strict";function _interopNamespace(e){if(e&&e.__esModule)return e;var n=Object.create(null);return e&&Object.keys(e).forEach((function(k){if("default"!==k){var d=Object.getOwnPropertyDescriptor(e,k);Object.defineProperty(n,k,d.get?d:{enumerable:!0,get:function(){return e[k]}})}})),n.default=e,Object.freeze(n)}var t__namespace=_interopNamespace(t$1),regl_min=("undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self,{exports:{}});!function(module,exports){module.exports=function(){function U(a,b){this.id=Cb++,this.type=a,this.data=b}function W(a){if(0===a.length)return[];var b=a.charAt(0),c=a.charAt(a.length-1);if(1<a.length&&b===c&&('"'===b||"'"===b))return['"'+a.substr(1,a.length-2).replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];if(b=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(a))return W(a.substr(0,b.index)).concat(W(b[1])).concat(W(a.substr(b.index+b[0].length)));if(1===(b=a.split(".")).length)return['"'+a.replace(/\\/g,"\\\\").replace(/"/g,'\\"')+'"'];for(a=[],c=0;c<b.length;++c)a=a.concat(W(b[c]));return a}function ab(a){return"["+W(a).join("][")+"]"}function bb(a,b){return"function"==typeof a?new U(0,a):"number"==typeof a||"boolean"==typeof a?new U(5,a):Array.isArray(a)?new U(6,a.map((function(a,e){return bb(a)}))):a instanceof U?a:void 0}function Db(){var a={"":0},b=[""];return{id:function(c){var e=a[c];return e||(e=a[c]=b.length,b.push(c),e)},str:function(a){return b[a]}}}function Eb(a,b,c){function e(){var b=window.innerWidth,e=window.innerHeight;a!==document.body&&(b=(e=a.getBoundingClientRect()).right-e.left,e=e.bottom-e.top),f.width=c*b,f.height=c*e,F(f.style,{width:b+"px",height:e+"px"})}var d,f=document.createElement("canvas");return F(f.style,{border:0,margin:0,padding:0,top:0,left:0}),a.appendChild(f),a===document.body&&(f.style.position="absolute",F(a.style,{margin:0,padding:0})),a!==document.body&&"function"==typeof ResizeObserver?(d=new ResizeObserver((function(){setTimeout(e)}))).observe(a):window.addEventListener("resize",e,!1),e(),{canvas:f,onDestroy:function(){d?d.disconnect():window.removeEventListener("resize",e),a.removeChild(f)}}}function Fb(a,b){function c(c){try{return a.getContext(c,b)}catch(f){return null}}return c("webgl")||c("experimental-webgl")||c("webgl-experimental")}function cb(a){return"string"==typeof a?a.split():a}function db(a){return"string"==typeof a?document.querySelector(a):a}function Gb(a){var c,e,f,d,b=a||{};a={};var p=[],r=[],v="undefined"==typeof window?1:window.devicePixelRatio,m=!1,u=function(a){},n=function(){};if("string"==typeof b?c=document.querySelector(b):"object"==typeof b&&("string"==typeof b.nodeName&&"function"==typeof b.appendChild&&"function"==typeof b.getBoundingClientRect?c=b:"function"==typeof b.drawArrays||"function"==typeof b.drawElements?f=(d=b).canvas:("gl"in b?d=b.gl:"canvas"in b?f=db(b.canvas):"container"in b&&(e=db(b.container)),"attributes"in b&&(a=b.attributes),"extensions"in b&&(p=cb(b.extensions)),"optionalExtensions"in b&&(r=cb(b.optionalExtensions)),"onDone"in b&&(u=b.onDone),"profile"in b&&(m=!!b.profile),"pixelRatio"in b&&(v=+b.pixelRatio))),c&&("canvas"===c.nodeName.toLowerCase()?f=c:e=c),!d){if(!f){if(!(c=Eb(e||document.body,u,v)))return null;f=c.canvas,n=c.onDestroy}void 0===a.premultipliedAlpha&&(a.premultipliedAlpha=!0),d=Fb(f,a)}return d?{gl:d,canvas:f,container:e,extensions:p,optionalExtensions:r,pixelRatio:v,profile:m,onDone:u,onDestroy:n}:(n(),u("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Hb(a,b){function c(b){var c;b=b.toLowerCase();try{c=e[b]=a.getExtension(b)}catch(f){}return!!c}for(var e={},f=0;f<b.extensions.length;++f){var d=b.extensions[f];if(!c(d))return b.onDestroy(),b.onDone('"'+d+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return b.optionalExtensions.forEach(c),{extensions:e,restore:function(){Object.keys(e).forEach((function(a){if(e[a]&&!c(a))throw Error("(regl): error restoring extension "+a)}))}}}function J(a,b){for(var c=Array(a),e=0;e<a;++e)c[e]=b(e);return c}function eb(a){var b,c;return b=(65535<a)<<4,b|=c=(255<(a>>>=b))<<3,(b|=c=(15<(a>>>=c))<<2)|(c=(3<(a>>>=c))<<1)|a>>>c>>1}function fb(){function a(a){a:{for(var b=16;268435456>=b;b*=16)if(a<=b){a=b;break a}a=0}return 0<(b=c[eb(a)>>2]).length?b.pop():new ArrayBuffer(a)}function b(a){c[eb(a.byteLength)>>2].push(a)}var c=J(8,(function(){return[]}));return{alloc:a,free:b,allocType:function(b,c){var d=null;switch(b){case 5120:d=new Int8Array(a(c),0,c);break;case 5121:d=new Uint8Array(a(c),0,c);break;case 5122:d=new Int16Array(a(2*c),0,c);break;case 5123:d=new Uint16Array(a(2*c),0,c);break;case 5124:d=new Int32Array(a(4*c),0,c);break;case 5125:d=new Uint32Array(a(4*c),0,c);break;case 5126:d=new Float32Array(a(4*c),0,c);break;default:return null}return d.length!==c?d.subarray(0,c):d},freeType:function(a){b(a.buffer)}}}function Z(a){return!!a&&"object"==typeof a&&Array.isArray(a.shape)&&Array.isArray(a.stride)&&"number"==typeof a.offset&&a.shape.length===a.stride.length&&(Array.isArray(a.data)||K(a.data))}function gb(a,b,c,e,f,d){for(var p=0;p<b;++p)for(var r=a[p],v=0;v<c;++v)for(var m=r[v],u=0;u<e;++u)f[d++]=m[u]}function hb(a,b,c,e,f){for(var d=1,p=c+1;p<b.length;++p)d*=b[p];var r=b[c];if(4==b.length-c){var v=b[c+1],m=b[c+2];for(b=b[c+3],p=0;p<r;++p)gb(a[p],v,m,b,e,f),f+=d}else for(p=0;p<r;++p)hb(a[p],b,c+1,e,f),f+=d}function Fa(a){return 0|Ga[Object.prototype.toString.call(a)]}function ib(a,b){for(var c=0;c<b.length;++c)a[c]=b[c]}function jb(a,b,c,e,f,d,p){for(var r=0,v=0;v<c;++v)for(var m=0;m<e;++m)a[r++]=b[f*v+d*m+p]}function Ib(a,b,c,e){function f(b){this.id=v++,this.buffer=a.createBuffer(),this.type=b,this.usage=35044,this.byteLength=0,this.dimension=1,this.dtype=5121,this.persistentData=null,c.profile&&(this.stats={size:0})}function d(b,c,q){b.byteLength=c.byteLength,a.bufferData(b.type,c,q)}function p(a,b,c,h,g,k){if(a.usage=c,Array.isArray(b)){if(a.dtype=h||5126,0<b.length)if(Array.isArray(b[0])){g=kb(b);for(var l=h=1;l<g.length;++l)h*=g[l];a.dimension=h,d(a,b=Sa(b,g,a.dtype),c),k?a.persistentData=b:D.freeType(b)}else"number"==typeof b[0]?(a.dimension=g,ib(g=D.allocType(a.dtype,b.length),b),d(a,g,c),k?a.persistentData=g:D.freeType(g)):K(b[0])&&(a.dimension=b[0].length,a.dtype=h||Fa(b[0])||5126,d(a,b=Sa(b,[b.length,b[0].length],a.dtype),c),k?a.persistentData=b:D.freeType(b))}else if(K(b))a.dtype=h||Fa(b),a.dimension=g,d(a,b,c),k&&(a.persistentData=new Uint8Array(new Uint8Array(b.buffer)));else if(Z(b)){var e=b.stride,t=(l=b.offset,0),ka=0,f=0,m=0;1===(g=b.shape).length?(t=g[0],ka=1,f=e[0],m=0):2===g.length&&(t=g[0],ka=g[1],f=e[0],m=e[1]),a.dtype=h||Fa(b.data)||5126,a.dimension=ka,jb(g=D.allocType(a.dtype,t*ka),b.data,t,ka,f,m,l),d(a,g,c),k?a.persistentData=g:D.freeType(g)}else b instanceof ArrayBuffer&&(a.dtype=5121,a.dimension=g,d(a,b,c),k&&(a.persistentData=new Uint8Array(new Uint8Array(b))))}function r(c){b.bufferCount--,e(c),a.deleteBuffer(c.buffer),c.buffer=null,delete m[c.id]}var v=0,m={};f.prototype.bind=function(){a.bindBuffer(this.type,this.buffer)},f.prototype.destroy=function(){r(this)};var u=[];return c.profile&&(b.getTotalBufferSize=function(){var a=0;return Object.keys(m).forEach((function(b){a+=m[b].stats.size})),a}),{create:function(n,e,d,h){function g(b){var n=35044,t=null,e=0,d=0,f=k&&k.dimension||1;return Array.isArray(b)||K(b)||Z(b)||b instanceof ArrayBuffer?t=b:"number"==typeof b?e=0|b:b&&("data"in b&&(t=b.data),"usage"in b&&(n=lb[b.usage]),"type"in b&&(d=Ha[b.type]),"dimension"in b&&(f=0|b.dimension),"length"in b&&(e=0|b.length)),k.bind(),t?p(k,t,n,d,f,h):(e&&a.bufferData(k.type,e,n),k.dtype=d||5121,k.usage=n,k.dimension=f,k.byteLength=e),c.profile&&(k.stats.size=k.byteLength*ia[k.dtype]),g}b.bufferCount++;var k=new f(e);return m[k.id]=k,d||g(n),g._reglType="buffer",g._buffer=k,g.subdata=function(b,c){var n,t=0|(c||0);if(k.bind(),K(b)||b instanceof ArrayBuffer)a.bufferSubData(k.type,t,b);else if(Array.isArray(b)){if(0<b.length)if("number"==typeof b[0]){var e=D.allocType(k.dtype,b.length);ib(e,b),a.bufferSubData(k.type,t,e),D.freeType(e)}else(Array.isArray(b[0])||K(b[0]))&&(n=kb(b),e=Sa(b,n,k.dtype),a.bufferSubData(k.type,t,e),D.freeType(e))}else if(Z(b)){var d=b.stride,h=e=0,f=0,E=0;1===(n=b.shape).length?(e=n[0],h=1,f=d[0],E=0):2===n.length&&(e=n[0],h=n[1],f=d[0],E=d[1]),n=Array.isArray(b.data)?k.dtype:Fa(b.data),jb(n=D.allocType(n,e*h),b.data,e,h,f,E,b.offset),a.bufferSubData(k.type,t,n),D.freeType(n)}return g},c.profile&&(g.stats=k.stats),g.destroy=function(){r(k)},g},createStream:function(a,b){var c=u.pop();return c||(c=new f(a)),c.bind(),p(c,b,35040,0,1,!1),c},destroyStream:function(a){u.push(a)},clear:function(){S(m).forEach(r),u.forEach(r)},getBuffer:function(a){return a&&a._buffer instanceof f?a._buffer:null},restore:function(){S(m).forEach((function(b){b.buffer=a.createBuffer(),a.bindBuffer(b.type,b.buffer),a.bufferData(b.type,b.persistentData||b.byteLength,b.usage)}))},_initBuffer:p}}function Jb(a,b,c,e){function f(a){this.id=v++,r[this.id]=this,this.buffer=a,this.primType=4,this.type=this.vertCount=0}function d(e,d,f,h,g,k,l){var m;if(e.buffer.bind(),d?((m=l)||K(d)&&(!Z(d)||K(d.data))||(m=b.oes_element_index_uint?5125:5123),c._initBuffer(e.buffer,d,f,m,3)):(a.bufferData(34963,k,f),e.buffer.dtype=m||5121,e.buffer.usage=f,e.buffer.dimension=3,e.buffer.byteLength=k),m=l,!l){switch(e.buffer.dtype){case 5121:case 5120:m=5121;break;case 5123:case 5122:m=5123;break;case 5125:case 5124:m=5125}e.buffer.dtype=m}e.type=m,0>(d=g)&&(d=e.buffer.byteLength,5123===m?d>>=1:5125===m&&(d>>=2)),e.vertCount=d,d=h,0>h&&(d=4,1===(h=e.buffer.dimension)&&(d=0),2===h&&(d=1),3===h&&(d=4)),e.primType=d}function p(a){e.elementsCount--,delete r[a.id],a.buffer.destroy(),a.buffer=null}var r={},v=0,m={uint8:5121,uint16:5123};b.oes_element_index_uint&&(m.uint32=5125),f.prototype.bind=function(){this.buffer.bind()};var u=[];return{create:function(a,b){function q(a){if(a)if("number"==typeof a)h(a),g.primType=4,g.vertCount=0|a,g.type=5121;else{var b=null,c=35044,e=-1,f=-1,n=0,r=0;Array.isArray(a)||K(a)||Z(a)?b=a:("data"in a&&(b=a.data),"usage"in a&&(c=lb[a.usage]),"primitive"in a&&(e=Ia[a.primitive]),"count"in a&&(f=0|a.count),"type"in a&&(r=m[a.type]),"length"in a?n=0|a.length:(n=f,5123===r||5122===r?n*=2:5125!==r&&5124!==r||(n*=4))),d(g,b,c,e,f,n,r)}else h(),g.primType=4,g.vertCount=0,g.type=5121;return q}var h=c.create(null,34963,!0),g=new f(h._buffer);return e.elementsCount++,q(a),q._reglType="elements",q._elements=g,q.subdata=function(a,b){return h.subdata(a,b),q},q.destroy=function(){p(g)},q},createStream:function(a){var b=u.pop();return b||(b=new f(c.create(null,34963,!0,!1)._buffer)),d(b,a,35040,-1,-1,0,0),b},destroyStream:function(a){u.push(a)},getElements:function(a){return"function"==typeof a&&a._elements instanceof f?a._elements:null},clear:function(){S(r).forEach(p)}}}function mb(a){for(var b=D.allocType(5123,a.length),c=0;c<a.length;++c)if(isNaN(a[c]))b[c]=65535;else if(1/0===a[c])b[c]=31744;else if(-1/0===a[c])b[c]=64512;else{nb[0]=a[c];var f=(e=Kb[0])>>>31<<15,d=(e<<1>>>24)-127,e=e>>13&1023;b[c]=-24>d?f:-14>d?f+(e+1024>>-14-d):15<d?f+31744:f+(d+15<<10)+e}return b}function na(a){return Array.isArray(a)||K(a)}function oa(a){return"[object "+a+"]"}function ob(a){return Array.isArray(a)&&(0===a.length||"number"==typeof a[0])}function pb(a){return!(!Array.isArray(a)||0===a.length||!na(a[0]))}function ja(a){return Object.prototype.toString.call(a)}function Ta(a){if(!a)return!1;var b=ja(a);return 0<=Lb.indexOf(b)||ob(a)||pb(a)||Z(a)}function qb(a,b){36193===a.type?(a.data=mb(b),D.freeType(b)):a.data=b}function Ja(a,b,c,e,f,d){if(a=void 0!==H[a]?H[a]:R[a]*pa[b],d&&(a*=6),f){for(e=0;1<=c;)e+=a*c*c,c/=2;return e}return a*c*e}function Mb(a,b,c,e,f,d,p){function r(){this.format=this.internalformat=6408,this.type=5121,this.flipY=this.premultiplyAlpha=this.compressed=!1,this.unpackAlignment=1,this.colorSpace=37444,this.channels=this.height=this.width=0}function v(a,b){a.internalformat=b.internalformat,a.format=b.format,a.type=b.type,a.compressed=b.compressed,a.premultiplyAlpha=b.premultiplyAlpha,a.flipY=b.flipY,a.unpackAlignment=b.unpackAlignment,a.colorSpace=b.colorSpace,a.width=b.width,a.height=b.height,a.channels=b.channels}function m(a,b){if("object"==typeof b&&b){"premultiplyAlpha"in b&&(a.premultiplyAlpha=b.premultiplyAlpha),"flipY"in b&&(a.flipY=b.flipY),"alignment"in b&&(a.unpackAlignment=b.alignment),"colorSpace"in b&&(a.colorSpace=Nb[b.colorSpace]),"type"in b&&(a.type=N[b.type]);var c=a.width,e=a.height,d=a.channels,g=!1;"shape"in b?(c=b.shape[0],e=b.shape[1],3===b.shape.length&&(d=b.shape[2],g=!0)):("radius"in b&&(c=e=b.radius),"width"in b&&(c=b.width),"height"in b&&(e=b.height),"channels"in b&&(d=b.channels,g=!0)),a.width=0|c,a.height=0|e,a.channels=0|d,c=!1,"format"in b&&(e=a.internalformat=G[c=b.format],a.format=x[e],c in N&&!("type"in b)&&(a.type=N[c]),c in ga&&(a.compressed=!0),c=!0),!g&&c?a.channels=R[a.format]:g&&!c&&a.channels!==Ma[a.format]&&(a.format=a.internalformat=Ma[a.channels])}}function u(b){a.pixelStorei(37440,b.flipY),a.pixelStorei(37441,b.premultiplyAlpha),a.pixelStorei(37443,b.colorSpace),a.pixelStorei(3317,b.unpackAlignment)}function n(){r.call(this),this.yOffset=this.xOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function z(a,b){var c=null;if(Ta(b)?c=b:b&&(m(a,b),"x"in b&&(a.xOffset=0|b.x),"y"in b&&(a.yOffset=0|b.y),Ta(b.data)&&(c=b.data)),b.copy){var e=f.viewportWidth,d=f.viewportHeight;a.width=a.width||e-a.xOffset,a.height=a.height||d-a.yOffset,a.needsCopy=!0}else if(c){if(K(c))a.channels=a.channels||4,a.data=c,"type"in b||5121!==a.type||(a.type=0|Ga[Object.prototype.toString.call(c)]);else if(ob(c)){switch(a.channels=a.channels||4,d=(e=c).length,a.type){case 5121:case 5123:case 5125:case 5126:(d=D.allocType(a.type,d)).set(e),a.data=d;break;case 36193:a.data=mb(e)}a.alignment=1,a.needsFree=!0}else if(Z(c)){e=c.data,Array.isArray(e)||5121!==a.type||(a.type=0|Ga[Object.prototype.toString.call(e)]);var t,E,h,l,g=c.stride;3===(d=c.shape).length?(h=d[2],l=g[2]):l=h=1,t=d[0],E=d[1],d=g[0],g=g[1],a.alignment=1,a.width=t,a.height=E,a.channels=h,a.format=a.internalformat=Ma[h],a.needsFree=!0,t=l,c=c.offset;for(var w=D.allocType(36193===a.type?5126:a.type,(h=a.width)*(l=a.height)*(E=a.channels)),O=0,da=0;da<l;++da)for(var xa=0;xa<h;++xa)for(var Ua=0;Ua<E;++Ua)w[O++]=e[d*xa+g*da+t*Ua+c];qb(a,w)}else if(ja(c)===Va||ja(c)===Wa||ja(c)===sb)a.element=ja(c)===Va||ja(c)===Wa?c:c.canvas,a.width=a.element.width,a.height=a.element.height,a.channels=4;else if(ja(c)===tb)a.element=c,a.width=c.width,a.height=c.height,a.channels=4;else if(ja(c)===ub)a.element=c,a.width=c.naturalWidth,a.height=c.naturalHeight,a.channels=4;else if(ja(c)===vb)a.element=c,a.width=c.videoWidth,a.height=c.videoHeight,a.channels=4;else if(pb(c)){for(e=a.width||c[0].length,d=a.height||c.length,g=a.channels,g=na(c[0][0])?g||c[0][0].length:g||1,t=Oa.shape(c),h=1,l=0;l<t.length;++l)h*=t[l];h=D.allocType(36193===a.type?5126:a.type,h),Oa.flatten(c,t,"",h),qb(a,h),a.alignment=1,a.width=e,a.height=d,a.channels=g,a.format=a.internalformat=Ma[g],a.needsFree=!0}}else a.width=a.width||1,a.height=a.height||1,a.channels=a.channels||4}function q(b,c,d,g,h){var t=b.element,l=b.data,E=b.internalformat,f=b.format,m=b.type,w=b.width,O=b.height;u(b),t?a.texSubImage2D(c,h,d,g,f,m,t):b.compressed?a.compressedTexSubImage2D(c,h,d,g,E,w,O,l):b.needsCopy?(e(),a.copyTexSubImage2D(c,h,d,g,b.xOffset,b.yOffset,w,O)):a.texSubImage2D(c,h,d,g,w,O,f,m,l)}function h(){return wb.pop()||new n}function g(a){a.needsFree&&D.freeType(a.data),n.call(a),wb.push(a)}function k(){r.call(this),this.genMipmaps=!1,this.mipmapHint=4352,this.mipmask=0,this.images=Array(16)}function l(a,b,c){var e=a.images[0]=h();a.mipmask=1,e.width=a.width=b,e.height=a.height=c,e.channels=a.channels=4}function A(a,b){var c=null;if(Ta(b))v(c=a.images[0]=h(),a),z(c,b),a.mipmask=1;else if(m(a,b),Array.isArray(b.mipmap))for(var e=b.mipmap,d=0;d<e.length;++d)v(c=a.images[d]=h(),a),c.width>>=d,c.height>>=d,z(c,e[d]),a.mipmask|=1<<d;else v(c=a.images[0]=h(),a),z(c,b),a.mipmask=1;v(a,a.images[0])}function t(b,c){for(var d=b.images,g=0;g<d.length&&d[g];++g){var h=d[g],t=c,l=g,E=h.element,f=h.data,m=h.internalformat,w=h.format,O=h.type,da=h.width,xa=h.height;u(h),E?a.texImage2D(t,l,w,w,O,E):h.compressed?a.compressedTexImage2D(t,l,m,Math.max(1,da),Math.max(1,xa),0,f):h.needsCopy?(e(),a.copyTexImage2D(t,l,w,h.xOffset,h.yOffset,da,xa,0)):a.texImage2D(t,l,w,da,xa,0,w,O,f||null)}}function ka(){var a=J.pop()||new k;r.call(a);for(var b=a.mipmask=0;16>b;++b)a.images[b]=null;return a}function wa(a){for(var b=a.images,c=0;c<b.length;++c)b[c]&&g(b[c]),b[c]=null;J.push(a)}function B(){this.magFilter=this.minFilter=9728,this.wrapT=this.wrapS=33071,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=4352}function C(a,b){"min"in b&&(a.minFilter=ya[b.min],0<=Ob.indexOf(a.minFilter)&&!("faces"in b)&&(a.genMipmaps=!0)),"mag"in b&&(a.magFilter=Q[b.mag]);var c=a.wrapS,d=a.wrapT;if("wrap"in b){var e=b.wrap;"string"==typeof e?c=d=ha[e]:Array.isArray(e)&&(c=ha[e[0]],d=ha[e[1]])}else"wrapS"in b&&(c=ha[b.wrapS]),"wrapT"in b&&(d=ha[b.wrapT]);if(a.wrapS=c,a.wrapT=d,"anisotropic"in b&&(a.anisotropic=b.anisotropic),"mipmap"in b){switch(c=!1,typeof b.mipmap){case"string":a.mipmapHint=Pb[b.mipmap],c=a.genMipmaps=!0;break;case"boolean":c=a.genMipmaps=b.mipmap;break;case"object":a.genMipmaps=!1,c=!0}!c||"min"in b||(a.minFilter=9984)}}function M(c,d){a.texParameteri(d,10241,c.minFilter),a.texParameteri(d,10240,c.magFilter),a.texParameteri(d,10242,c.wrapS),a.texParameteri(d,10243,c.wrapT),b.ext_texture_filter_anisotropic&&a.texParameteri(d,34046,c.anisotropic),c.genMipmaps&&(a.hint(33170,c.mipmapHint),a.generateMipmap(d))}function E(b){r.call(this),this.mipmask=0,this.internalformat=6408,this.id=Y++,this.refCount=1,this.target=b,this.texture=a.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new B,p.profile&&(this.stats={size:0})}function aa(b){a.activeTexture(33984),a.bindTexture(b.target,b.texture)}function ta(){var b=T[0];b?a.bindTexture(b.target,b.texture):a.bindTexture(3553,null)}function y(b){var c=b.texture,e=b.unit,g=b.target;0<=e&&(a.activeTexture(33984+e),a.bindTexture(g,null),T[e]=null),a.deleteTexture(c),b.texture=null,b.params=null,b.pixels=null,b.refCount=0,delete ea[b.id],d.textureCount--}var Pb={"don't care":4352,"dont care":4352,nice:4354,fast:4353},ha={repeat:10497,clamp:33071,mirror:33648},Q={nearest:9728,linear:9729},ya=F({mipmap:9987,"nearest mipmap nearest":9984,"linear mipmap nearest":9985,"nearest mipmap linear":9986,"linear mipmap linear":9987},Q),Nb={none:0,browser:37444},N={uint8:5121,rgba4:32819,rgb565:33635,"rgb5 a1":32820},G={alpha:6406,luminance:6409,"luminance alpha":6410,rgb:6407,rgba:6408,rgba4:32854,"rgb5 a1":32855,rgb565:36194},ga={};b.ext_srgb&&(G.srgb=35904,G.srgba=35906),b.oes_texture_float&&(N.float32=N.float=5126),b.oes_texture_half_float&&(N.float16=N["half float"]=36193),b.webgl_depth_texture&&(F(G,{depth:6402,"depth stencil":34041}),F(N,{uint16:5123,uint32:5125,"depth stencil":34042})),b.webgl_compressed_texture_s3tc&&F(ga,{"rgb s3tc dxt1":33776,"rgba s3tc dxt1":33777,"rgba s3tc dxt3":33778,"rgba s3tc dxt5":33779}),b.webgl_compressed_texture_atc&&F(ga,{"rgb atc":35986,"rgba atc explicit alpha":35987,"rgba atc interpolated alpha":34798}),b.webgl_compressed_texture_pvrtc&&F(ga,{"rgb pvrtc 4bppv1":35840,"rgb pvrtc 2bppv1":35841,"rgba pvrtc 4bppv1":35842,"rgba pvrtc 2bppv1":35843}),b.webgl_compressed_texture_etc1&&(ga["rgb etc1"]=36196);var I=Array.prototype.slice.call(a.getParameter(34467));Object.keys(ga).forEach((function(a){var b=ga[a];0<=I.indexOf(b)&&(G[a]=b)}));var H=Object.keys(G);c.textureFormats=H;var ba=[];Object.keys(G).forEach((function(a){ba[G[a]]=a}));var L=[];Object.keys(N).forEach((function(a){L[N[a]]=a}));var Da=[];Object.keys(Q).forEach((function(a){Da[Q[a]]=a}));var la=[];Object.keys(ya).forEach((function(a){la[ya[a]]=a}));var ma=[];Object.keys(ha).forEach((function(a){ma[ha[a]]=a}));var x=H.reduce((function(a,c){var d=G[c];return a[d]=6409===d||6406===d||6409===d||6410===d||6402===d||34041===d||b.ext_srgb&&(35904===d||35906===d)?d:32855===d||0<=c.indexOf("rgba")?6408:6407,a}),{}),wb=[],J=[],Y=0,ea={},fa=c.maxTextureUnits,T=Array(fa).map((function(){return null}));return F(E.prototype,{bind:function(){this.bindCount+=1;var b=this.unit;if(0>b){for(var c=0;c<fa;++c){var e=T[c];if(e){if(0<e.bindCount)continue;e.unit=-1}T[c]=this,b=c;break}p.profile&&d.maxTextureUnits<b+1&&(d.maxTextureUnits=b+1),this.unit=b,a.activeTexture(33984+b),a.bindTexture(this.target,this.texture)}return b},unbind:function(){--this.bindCount},decRef:function(){0>=--this.refCount&&y(this)}}),p.profile&&(d.getTotalTextureSize=function(){var a=0;return Object.keys(ea).forEach((function(b){a+=ea[b].stats.size})),a}),{create2D:function(b,c){function e(a,b){var c=f.texInfo;B.call(c);var d=ka();return"number"==typeof a?l(d,0|a,"number"==typeof b?0|b:0|a):a?(C(c,a),A(d,a)):l(d,1,1),c.genMipmaps&&(d.mipmask=(Math.max(d.width,d.height)<<1)-1),f.mipmask=d.mipmask,v(f,d),f.internalformat=d.internalformat,e.width=d.width,e.height=d.height,aa(f),t(d,3553),M(c,3553),ta(),wa(d),p.profile&&(f.stats.size=Ja(f.internalformat,f.type,d.width,d.height,c.genMipmaps,!1)),e.format=ba[f.internalformat],e.type=L[f.type],e.mag=Da[c.magFilter],e.min=la[c.minFilter],e.wrapS=ma[c.wrapS],e.wrapT=ma[c.wrapT],e}var f=new E(3553);return ea[f.id]=f,d.textureCount++,e(b,c),e.subimage=function(a,b,c,d){b|=0,c|=0,d|=0;var t=h();return v(t,f),t.width=0,t.height=0,z(t,a),t.width=t.width||(f.width>>d)-b,t.height=t.height||(f.height>>d)-c,aa(f),q(t,3553,b,c,d),ta(),g(t),e},e.resize=function(b,c){var d=0|b,g=0|c||d;if(d===f.width&&g===f.height)return e;e.width=f.width=d,e.height=f.height=g,aa(f);for(var h=0;f.mipmask>>h;++h){var t=d>>h,w=g>>h;if(!t||!w)break;a.texImage2D(3553,h,f.format,t,w,0,f.format,f.type,null)}return ta(),p.profile&&(f.stats.size=Ja(f.internalformat,f.type,d,g,!1,!1)),e},e._reglType="texture2d",e._texture=f,p.profile&&(e.stats=f.stats),e.destroy=function(){f.decRef()},e},createCube:function(b,c,e,f,n,r){function k(a,b,c,d,e,f){var g,ca=y.texInfo;for(B.call(ca),g=0;6>g;++g)u[g]=ka();if("number"!=typeof a&&a){if("object"==typeof a)if(b)A(u[0],a),A(u[1],b),A(u[2],c),A(u[3],d),A(u[4],e),A(u[5],f);else if(C(ca,a),m(y,a),"faces"in a)for(a=a.faces,g=0;6>g;++g)v(u[g],y),A(u[g],a[g]);else for(g=0;6>g;++g)A(u[g],a)}else for(a=0|a||1,g=0;6>g;++g)l(u[g],a,a);for(v(y,u[0]),y.mipmask=ca.genMipmaps?(Math.max(u[0].width,u[0].height)<<1)-1:u[0].mipmask,y.internalformat=u[0].internalformat,k.width=u[0].width,k.height=u[0].height,aa(y),g=0;6>g;++g)t(u[g],34069+g);for(M(ca,34067),ta(),p.profile&&(y.stats.size=Ja(y.internalformat,y.type,k.width,k.height,ca.genMipmaps,!0)),k.format=ba[y.internalformat],k.type=L[y.type],k.mag=Da[ca.magFilter],k.min=la[ca.minFilter],k.wrapS=ma[ca.wrapS],k.wrapT=ma[ca.wrapT],g=0;6>g;++g)wa(u[g]);return k}var y=new E(34067);ea[y.id]=y,d.cubeCount++;var u=Array(6);return k(b,c,e,f,n,r),k.subimage=function(a,b,c,d,e){c|=0,d|=0,e|=0;var f=h();return v(f,y),f.width=0,f.height=0,z(f,b),f.width=f.width||(y.width>>e)-c,f.height=f.height||(y.height>>e)-d,aa(y),q(f,34069+a,c,d,e),ta(),g(f),k},k.resize=function(b){if((b|=0)!==y.width){k.width=y.width=b,k.height=y.height=b,aa(y);for(var c=0;6>c;++c)for(var d=0;y.mipmask>>d;++d)a.texImage2D(34069+c,d,y.format,b>>d,b>>d,0,y.format,y.type,null);return ta(),p.profile&&(y.stats.size=Ja(y.internalformat,y.type,k.width,k.height,!1,!0)),k}},k._reglType="textureCube",k._texture=y,p.profile&&(k.stats=y.stats),k.destroy=function(){y.decRef()},k},clear:function(){for(var b=0;b<fa;++b)a.activeTexture(33984+b),a.bindTexture(3553,null),T[b]=null;S(ea).forEach(y),d.cubeCount=0,d.textureCount=0},getTexture:function(a){return null},restore:function(){for(var b=0;b<fa;++b){var c=T[b];c&&(c.bindCount=0,c.unit=-1,T[b]=null)}S(ea).forEach((function(b){b.texture=a.createTexture(),a.bindTexture(b.target,b.texture);for(var c=0;32>c;++c)if(0!=(b.mipmask&1<<c))if(3553===b.target)a.texImage2D(3553,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);else for(var d=0;6>d;++d)a.texImage2D(34069+d,c,b.internalformat,b.width>>c,b.height>>c,0,b.internalformat,b.type,null);M(b.texInfo,b.target)}))},refresh:function(){for(var b=0;b<fa;++b){var c=T[b];c&&(c.bindCount=0,c.unit=-1,T[b]=null),a.activeTexture(33984+b),a.bindTexture(3553,null),a.bindTexture(34067,null)}}}}function Qb(a,b,c,e,f,d){function p(a,b,c){this.target=a,this.texture=b,this.renderbuffer=c;var d=a=0;b?(a=b.width,d=b.height):c&&(a=c.width,d=c.height),this.width=a,this.height=d}function r(a){a&&(a.texture&&a.texture._texture.decRef(),a.renderbuffer&&a.renderbuffer._renderbuffer.decRef())}function v(a,b,c){a&&(a.texture?a.texture._texture.refCount+=1:a.renderbuffer._renderbuffer.refCount+=1)}function m(b,c){c&&(c.texture?a.framebufferTexture2D(36160,b,c.target,c.texture._texture.texture,0):a.framebufferRenderbuffer(36160,b,36161,c.renderbuffer._renderbuffer.renderbuffer))}function u(a){var b=3553,c=null,d=null,e=a;return"object"==typeof a&&(e=a.data,"target"in a&&(b=0|a.target)),"texture2d"===(a=e._reglType)||"textureCube"===a?c=e:"renderbuffer"===a&&(d=e,b=36161),new p(b,c,d)}function n(a,b,c,d,g){return c?((a=e.create2D({width:a,height:b,format:d,type:g}))._texture.refCount=0,new p(3553,a,null)):((a=f.create({width:a,height:b,format:d}))._renderbuffer.refCount=0,new p(36161,null,a))}function z(a){return a&&(a.texture||a.renderbuffer)}function q(a,b,c){a&&(a.texture?a.texture.resize(b,c):a.renderbuffer&&a.renderbuffer.resize(b,c),a.width=b,a.height=c)}function h(){this.id=C++,M[this.id]=this,this.framebuffer=a.createFramebuffer(),this.height=this.width=0,this.colorAttachments=[],this.depthStencilAttachment=this.stencilAttachment=this.depthAttachment=null}function g(a){a.colorAttachments.forEach(r),r(a.depthAttachment),r(a.stencilAttachment),r(a.depthStencilAttachment)}function k(b){a.deleteFramebuffer(b.framebuffer),b.framebuffer=null,d.framebufferCount--,delete M[b.id]}function l(b,d){var e;a.bindFramebuffer(36160,b.framebuffer);var g=b.colorAttachments;for(e=0;e<g.length;++e)m(36064+e,g[e]);for(e=g.length;e<c.maxColorAttachments;++e)a.framebufferTexture2D(36160,36064+e,3553,null,0);a.framebufferTexture2D(36160,33306,3553,null,0),a.framebufferTexture2D(36160,36096,3553,null,0),a.framebufferTexture2D(36160,36128,3553,null,0),m(36096,b.depthAttachment),m(36128,b.stencilAttachment),m(33306,b.depthStencilAttachment),d||(a.checkFramebufferStatus(36160),a.isContextLost()),a.bindFramebuffer(36160,t.next?t.next.framebuffer:null),t.cur=t.next,d||a.getError()}function A(b,c){function e(a,b){var c,d=0,h=0,t=!0,k=!0;c=null;var m=!0,q="rgba",r="uint8",p=1,A=null,E=null,la=null,M=!1;if("number"==typeof a)d=0|a,h=0|b||d;else if(a){var x=a;"shape"in x?(d=(h=x.shape)[0],h=h[1]):("radius"in x&&(d=h=x.radius),"width"in x&&(d=x.width),"height"in x&&(h=x.height)),("color"in x||"colors"in x)&&(c=x.color||x.colors),c||("colorCount"in x&&(p=0|x.colorCount),"colorTexture"in x&&(m=!!x.colorTexture,q="rgba4"),"colorType"in x&&(r=x.colorType,!m)&&("half float"===r||"float16"===r?q="rgba16f":"float"!==r&&"float32"!==r||(q="rgba32f")),"colorFormat"in x&&(0<=ka.indexOf(q=x.colorFormat)?m=!0:0<=wa.indexOf(q)&&(m=!1))),("depthTexture"in x||"depthStencilTexture"in x)&&(M=!(!x.depthTexture&&!x.depthStencilTexture)),"depth"in x&&("boolean"==typeof x.depth?t=x.depth:(A=x.depth,k=!1)),"stencil"in x&&("boolean"==typeof x.stencil?k=x.stencil:(E=x.stencil,t=!1)),"depthStencil"in x&&("boolean"==typeof x.depthStencil?t=k=x.depthStencil:(la=x.depthStencil,k=t=!1))}else d=h=1;var C=null,aa=null,B=null,F=null;if(Array.isArray(c))C=c.map(u);else if(c)C=[u(c)];else for(C=Array(p),c=0;c<p;++c)C[c]=n(d,h,m,q,r);for(d=d||C[0].width,h=h||C[0].height,A?aa=u(A):t&&!k&&(aa=n(d,h,M,"depth","uint32")),E?B=u(E):k&&!t&&(B=n(d,h,!1,"stencil","uint8")),la?F=u(la):!A&&!E&&k&&t&&(F=n(d,h,M,"depth stencil","depth stencil")),t=null,c=0;c<C.length;++c)v(C[c]),C[c]&&C[c].texture&&(k=Xa[C[c].texture._texture.format]*Pa[C[c].texture._texture.type],null===t&&(t=k));return v(aa),v(B),v(F),g(f),f.width=d,f.height=h,f.colorAttachments=C,f.depthAttachment=aa,f.stencilAttachment=B,f.depthStencilAttachment=F,e.color=C.map(z),e.depth=z(aa),e.stencil=z(B),e.depthStencil=z(F),e.width=f.width,e.height=f.height,l(f,x&&x.ignoreStatusCheck),e}var f=new h;return d.framebufferCount++,e(b,c),F(e,{resize:function(a,b){var c=Math.max(0|a,1),d=Math.max(0|b||c,1);if(c===f.width&&d===f.height)return e;for(var g=f.colorAttachments,h=0;h<g.length;++h)q(g[h],c,d);return q(f.depthAttachment,c,d),q(f.stencilAttachment,c,d),q(f.depthStencilAttachment,c,d),f.width=e.width=c,f.height=e.height=d,l(f),e},blit:function(b,c,d){a.bindFramebuffer(36008,b._framebuffer.framebuffer),a.bindFramebuffer(36009,f.framebuffer),c||(c=16384),a.blitFramebuffer(0,0,b.width,b.height,0,0,f.width,f.height,c,"linear"===d?9729:9728),a.bindFramebuffer(36008,null),a.bindFramebuffer(36009,null)},_reglType:"framebuffer",_framebuffer:f,destroy:function(){k(f),g(f)},use:function(a){t.setFBO({framebuffer:e},a)}})}var t={cur:null,next:null,dirty:!1,setFBO:null},ka=["rgba"],wa=["rgba4","rgb565","rgb5 a1"];b.ext_srgb&&wa.push("srgba"),b.ext_color_buffer_half_float&&wa.push("rgba16f","rgb16f"),b.webgl_color_buffer_float&&wa.push("rgba32f");var B=["uint8"];b.oes_texture_half_float&&B.push("half float","float16"),b.oes_texture_float&&B.push("float","float32");var C=0,M={};return F(t,{getFramebuffer:function(a){return"function"==typeof a&&"framebuffer"===a._reglType&&(a=a._framebuffer)instanceof h?a:null},create:A,createCube:function(a){function b(a){var d,f={color:null},g=0,h=null;d="rgba";var t="uint8",l=1;if("number"==typeof a?g=0|a:a?("shape"in a?g=a.shape[0]:("radius"in a&&(g=0|a.radius),"width"in a?g=0|a.width:"height"in a&&(g=0|a.height)),("color"in a||"colors"in a)&&(h=a.color||a.colors),h||("colorCount"in a&&(l=0|a.colorCount),"colorType"in a&&(t=a.colorType),"colorFormat"in a&&(d=a.colorFormat)),"depth"in a&&(f.depth=a.depth),"stencil"in a&&(f.stencil=a.stencil),"depthStencil"in a&&(f.depthStencil=a.depthStencil)):g=1,h)if(Array.isArray(h))for(a=[],d=0;d<h.length;++d)a[d]=h[d];else a=[h];else for(a=Array(l),h={radius:g,format:d,type:t},d=0;d<l;++d)a[d]=e.createCube(h);for(f.color=Array(a.length),d=0;d<a.length;++d)l=a[d],g=g||l.width,f.color[d]={target:34069,data:a[d]};for(d=0;6>d;++d){for(l=0;l<a.length;++l)f.color[l].target=34069+d;0<d&&(f.depth=c[0].depth,f.stencil=c[0].stencil,f.depthStencil=c[0].depthStencil),c[d]?c[d](f):c[d]=A(f)}return F(b,{width:g,height:g,color:a})}var c=Array(6);return b(a),F(b,{faces:c,resize:function(a){var d=0|a;if(d===b.width)return b;var e=b.color;for(a=0;a<e.length;++a)e[a].resize(d);for(a=0;6>a;++a)c[a].resize(d);return b.width=b.height=d,b},_reglType:"framebufferCube",destroy:function(){c.forEach((function(a){a.destroy()}))}})},clear:function(){S(M).forEach(k)},restore:function(){t.cur=null,t.next=null,t.dirty=!0,S(M).forEach((function(b){b.framebuffer=a.createFramebuffer(),l(b)}))}})}function Ya(){this.w=this.z=this.y=this.x=this.state=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=5126,this.divisor=this.stride=this.offset=0}function Rb(a,b,c,e,f,d,p){function r(a){if(a!==k.currentVAO){var c=b.oes_vertex_array_object;c.bindVertexArrayOES(a?a.vao:null),k.currentVAO=a}}function v(c){if(c!==k.currentVAO){if(c)c.bindAttrs();else{for(var d=b.angle_instanced_arrays,e=0;e<q.length;++e){var f=q[e];f.buffer?(a.enableVertexAttribArray(e),f.buffer.bind(),a.vertexAttribPointer(e,f.size,f.type,f.normalized,f.stride,f.offfset),d&&f.divisor&&d.vertexAttribDivisorANGLE(e,f.divisor)):(a.disableVertexAttribArray(e),a.vertexAttrib4f(e,f.x,f.y,f.z,f.w))}a.bindBuffer(34963,p.elements?p.elements.buffer.buffer:null)}k.currentVAO=c}}function m(){S(g).forEach((function(a){a.destroy()}))}function u(){this.id=++h,this.attributes=[],this.elements=null,this.ownsElements=!1,this.offset=this.count=0,this.instances=-1,this.primitive=4;var a=b.oes_vertex_array_object;this.vao=a?a.createVertexArrayOES():null,g[this.id]=this,this.buffers=[]}function n(){b.oes_vertex_array_object&&S(g).forEach((function(a){a.refresh()}))}var z=c.maxAttributes,q=Array(z);for(c=0;c<z;++c)q[c]=new Ya;var h=0,g={},k={Record:Ya,scope:{},state:q,currentVAO:null,targetVAO:null,restore:b.oes_vertex_array_object?n:function(){},createVAO:function(a){function b(a){var e;Array.isArray(a)?(e=a,c.elements&&c.ownsElements&&c.elements.destroy(),c.elements=null,c.ownsElements=!1,c.offset=0,c.count=0,c.instances=-1,c.primitive=4):(a.elements?(e=a.elements,c.ownsElements?("function"==typeof e&&"elements"===e._reglType?c.elements.destroy():c.elements(e),c.ownsElements=!1):d.getElements(a.elements)?(c.elements=a.elements,c.ownsElements=!1):(c.elements=d.create(a.elements),c.ownsElements=!0)):(c.elements=null,c.ownsElements=!1),e=a.attributes,c.offset=0,c.count=-1,c.instances=-1,c.primitive=4,c.elements&&(c.count=c.elements._elements.vertCount,c.primitive=c.elements._elements.primType),"offset"in a&&(c.offset=0|a.offset),"count"in a&&(c.count=0|a.count),"instances"in a&&(c.instances=0|a.instances),"primitive"in a&&(c.primitive=Ia[a.primitive])),a={};var g=c.attributes;g.length=e.length;for(var h=0;h<e.length;++h){var n,l=e[h],k=g[h]=new Ya,m=l.data||l;Array.isArray(m)||K(m)||Z(m)?(c.buffers[h]&&(n=c.buffers[h],K(m)&&n._buffer.byteLength>=m.byteLength?n.subdata(m):(n.destroy(),c.buffers[h]=null)),c.buffers[h]||(n=c.buffers[h]=f.create(l,34962,!1,!0)),k.buffer=f.getBuffer(n),k.size=0|k.buffer.dimension,k.normalized=!1,k.type=k.buffer.dtype,k.offset=0,k.stride=0,k.divisor=0,k.state=1,a[h]=1):f.getBuffer(l)?(k.buffer=f.getBuffer(l),k.size=0|k.buffer.dimension,k.normalized=!1,k.type=k.buffer.dtype,k.offset=0,k.stride=0,k.divisor=0,k.state=1):f.getBuffer(l.buffer)?(k.buffer=f.getBuffer(l.buffer),k.size=0|(+l.size||k.buffer.dimension),k.normalized=!!l.normalized||!1,k.type="type"in l?Ha[l.type]:k.buffer.dtype,k.offset=0|(l.offset||0),k.stride=0|(l.stride||0),k.divisor=0|(l.divisor||0),k.state=1):"x"in l&&(k.x=+l.x||0,k.y=+l.y||0,k.z=+l.z||0,k.w=+l.w||0,k.state=2)}for(n=0;n<c.buffers.length;++n)!a[n]&&c.buffers[n]&&(c.buffers[n].destroy(),c.buffers[n]=null);return c.refresh(),b}var c=new u;return e.vaoCount+=1,b.destroy=function(){for(var a=0;a<c.buffers.length;++a)c.buffers[a]&&c.buffers[a].destroy();c.buffers.length=0,c.ownsElements&&(c.elements.destroy(),c.elements=null,c.ownsElements=!1),c.destroy()},b._vao=c,b._reglType="vao",b(a)},getVAO:function(a){return"function"==typeof a&&a._vao?a._vao:null},destroyBuffer:function(b){for(var c=0;c<q.length;++c){var d=q[c];d.buffer===b&&(a.disableVertexAttribArray(c),d.buffer=null)}},setVAO:b.oes_vertex_array_object?r:v,clear:b.oes_vertex_array_object?m:function(){}};return u.prototype.bindAttrs=function(){for(var c=b.angle_instanced_arrays,e=this.attributes,f=0;f<e.length;++f){var g=e[f];g.buffer?(a.enableVertexAttribArray(f),a.bindBuffer(34962,g.buffer.buffer),a.vertexAttribPointer(f,g.size,g.type,g.normalized,g.stride,g.offset),c&&g.divisor&&c.vertexAttribDivisorANGLE(f,g.divisor)):(a.disableVertexAttribArray(f),a.vertexAttrib4f(f,g.x,g.y,g.z,g.w))}for(c=e.length;c<z;++c)a.disableVertexAttribArray(c);(c=d.getElements(this.elements))?a.bindBuffer(34963,c.buffer.buffer):a.bindBuffer(34963,null)},u.prototype.refresh=function(){var a=b.oes_vertex_array_object;a&&(a.bindVertexArrayOES(this.vao),this.bindAttrs(),k.currentVAO=null,a.bindVertexArrayOES(null))},u.prototype.destroy=function(){if(this.vao){var a=b.oes_vertex_array_object;this===k.currentVAO&&(k.currentVAO=null,a.bindVertexArrayOES(null)),a.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),g[this.id]&&(delete g[this.id],--e.vaoCount)},k}function Sb(a,b,c,e){function f(a,b,c,d){this.name=a,this.id=b,this.location=c,this.info=d}function d(a,b){for(var c=0;c<a.length;++c)if(a[c].id===b.id)return void(a[c].location=b.location);a.push(b)}function p(c,d,e){if(!(f=(e=35632===c?m:u)[d])){var n=b.str(d),f=a.createShader(c);a.shaderSource(f,n),a.compileShader(f),e[d]=f}return f}function r(a,b){this.id=q++,this.fragId=a,this.vertId=b,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,e.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function v(c,g,k){var m;m=p(35632,c.fragId);var n=p(35633,c.vertId);if(g=c.program=a.createProgram(),a.attachShader(g,m),a.attachShader(g,n),k)for(m=0;m<k.length;++m)a.bindAttribLocation(g,(n=k[m])[0],n[1]);a.linkProgram(g),n=a.getProgramParameter(g,35718),e.profile&&(c.stats.uniformsCount=n);var q=c.uniforms;for(m=0;m<n;++m)if(k=a.getActiveUniform(g,m)){if(1<k.size)for(var r=0;r<k.size;++r){var u=k.name.replace("[0]","["+r+"]");d(q,new f(u,b.id(u),a.getUniformLocation(g,u),k))}r=k.name,1<k.size&&(r=r.replace("[0]","")),d(q,new f(r,b.id(r),a.getUniformLocation(g,r),k))}for(n=a.getProgramParameter(g,35721),e.profile&&(c.stats.attributesCount=n),c=c.attributes,m=0;m<n;++m)(k=a.getActiveAttrib(g,m))&&d(c,new f(k.name,b.id(k.name),a.getAttribLocation(g,k.name),k))}var m={},u={},n={},z=[],q=0;return e.profile&&(c.getMaxUniformsCount=function(){var a=0;return z.forEach((function(b){b.stats.uniformsCount>a&&(a=b.stats.uniformsCount)})),a},c.getMaxAttributesCount=function(){var a=0;return z.forEach((function(b){b.stats.attributesCount>a&&(a=b.stats.attributesCount)})),a}),{clear:function(){var b=a.deleteShader.bind(a);S(m).forEach(b),m={},S(u).forEach(b),u={},z.forEach((function(b){a.deleteProgram(b.program)})),z.length=0,n={},c.shaderCount=0},program:function(b,d,e,f){var q=n[d];q||(q=n[d]={});var t=q[b];if(t&&(t.refCount++,!f))return t;var p=new r(d,b);return c.shaderCount++,v(p,e,f),t||(q[b]=p),z.push(p),F(p,{destroy:function(){if(p.refCount--,0>=p.refCount){a.deleteProgram(p.program);var b=z.indexOf(p);z.splice(b,1),c.shaderCount--}0>=q[p.vertId].refCount&&(a.deleteShader(u[p.vertId]),delete u[p.vertId],delete n[p.fragId][p.vertId]),Object.keys(n[p.fragId]).length||(a.deleteShader(m[p.fragId]),delete m[p.fragId],delete n[p.fragId])}})},restore:function(){m={},u={};for(var a=0;a<z.length;++a)v(z[a],null,z[a].attributes.map((function(a){return[a.location,a.name]})))},shader:p,frag:-1,vert:-1}}function Tb(a,b,c,e,f,d,p){function r(d){var f;f=null===b.next?5121:b.next.colorAttachments[0].texture._texture.type;var n=0,r=0,q=e.framebufferWidth,h=e.framebufferHeight,g=null;return K(d)?g=d:d&&(n=0|d.x,r=0|d.y,q=0|(d.width||e.framebufferWidth-n),h=0|(d.height||e.framebufferHeight-r),g=d.data||null),c(),d=q*h*4,g||(5121===f?g=new Uint8Array(d):5126===f&&(g=g||new Float32Array(d))),a.pixelStorei(3333,4),a.readPixels(n,r,q,h,6408,f,g),g}function v(a){var c;return b.setFBO({framebuffer:a.framebuffer},(function(){c=r(a)})),c}return function(a){return a&&"framebuffer"in a?v(a):r(a)}}function za(a){return Array.prototype.slice.call(a)}function Aa(a){return za(a).join("")}function Ub(){function a(){var a=[],b=[];return F((function(){a.push.apply(a,za(arguments))}),{def:function(){var d="v"+c++;return b.push(d),0<arguments.length&&(a.push(d,"="),a.push.apply(a,za(arguments)),a.push(";")),d},toString:function(){return Aa([0<b.length?"var "+b.join(",")+";":"",Aa(a)])}})}function b(){function b(a,e){d(a,e,"=",c.def(a,e),";")}var c=a(),d=a(),e=c.toString,f=d.toString;return F((function(){c.apply(c,za(arguments))}),{def:c.def,entry:c,exit:d,save:b,set:function(a,d,e){b(a,d),c(a,d,"=",e,";")},toString:function(){return e()+f()}})}var c=0,e=[],f=[],d=a(),p={};return{global:d,link:function(a){for(var b=0;b<f.length;++b)if(f[b]===a)return e[b];return b="g"+c++,e.push(b),f.push(a),b},block:a,proc:function(a,c){function d(){var a="a"+e.length;return e.push(a),a}var e=[];c=c||0;for(var f=0;f<c;++f)d();var z=(f=b()).toString;return p[a]=F(f,{arg:d,toString:function(){return Aa(["function(",e.join(),"){",z(),"}"])}})},scope:b,cond:function(){var a=Aa(arguments),c=b(),d=b(),e=c.toString,f=d.toString;return F(c,{then:function(){return c.apply(c,za(arguments)),this},else:function(){return d.apply(d,za(arguments)),this},toString:function(){var b=f();return b&&(b="else{"+b+"}"),Aa(["if(",a,"){",e(),"}",b])}})},compile:function(){var a=['"use strict";',d,"return {"];Object.keys(p).forEach((function(b){a.push('"',b,'":',p[b].toString(),",")})),a.push("}");var b=Aa(a).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n");return Function.apply(null,e.concat(b)).apply(null,f)}}}function Qa(a){return Array.isArray(a)||K(a)||Z(a)}function xb(a){return a.sort((function(a,c){return"viewport"===a?-1:"viewport"===c?1:a<c?-1:1}))}function I(a,b,c,e){this.thisDep=a,this.contextDep=b,this.propDep=c,this.append=e}function ua(a){return a&&!(a.thisDep||a.contextDep||a.propDep)}function B(a){return new I(!1,!1,!1,a)}function L(a,b){var c=a.type;if(0===c)return new I(!0,1<=(c=a.data.length),2<=c,b);if(4===c)return new I((c=a.data).thisDep,c.contextDep,c.propDep,b);if(5===c)return new I(!1,!1,!1,b);if(6===c){for(var e=c=!1,f=!1,d=0;d<a.data.length;++d){var p=a.data[d];1===p.type?f=!0:2===p.type?e=!0:3===p.type?c=!0:0===p.type?(c=!0,1<=(p=p.data)&&(e=!0),2<=p&&(f=!0)):4===p.type&&(c=c||p.data.thisDep,e=e||p.data.contextDep,f=f||p.data.propDep)}return new I(c,e,f,b)}return new I(3===c,2===c,1===c,b)}function Vb(a,b,c,e,f,d,p,r,v,m,u,n,z,q,h){function g(a){return a.replace(".","_")}function k(a,b,c){var d=g(a);La.push(a),Ca[d]=qa[d]=!!c,ra[d]=b}function l(a,b,c){var d=g(a);La.push(a),Array.isArray(c)?(qa[d]=c.slice(),Ca[d]=c.slice()):qa[d]=Ca[d]=c,sa[d]=b}function A(){var a=Ub(),c=a.link,d=a.global;a.id=pa++,a.batchId="0";var e=c(rb),f=a.shared={props:"a0"};Object.keys(rb).forEach((function(a){f[a]=d.def(e,".",a)}));var g=a.next={},ca=a.current={};Object.keys(sa).forEach((function(a){Array.isArray(qa[a])&&(g[a]=d.def(f.next,".",a),ca[a]=d.def(f.current,".",a))}));var Wb=a.constants={};Object.keys(Na).forEach((function(a){Wb[a]=d.def(JSON.stringify(Na[a]))})),a.invoke=function(b,d){switch(d.type){case 0:var e=["this",f.context,f.props,a.batchId];return b.def(c(d.data),".call(",e.slice(0,Math.max(d.data.length+1,4)),")");case 1:return b.def(f.props,d.data);case 2:return b.def(f.context,d.data);case 3:return b.def("this",d.data);case 4:return d.data.append(a,b),d.data.ref;case 5:return d.data.toString();case 6:return d.data.map((function(c){return a.invoke(b,c)}))}},a.attribCache={};var X={};return a.scopeAttrib=function(a){if((a=b.id(a))in X)return X[a];var d=m.scope[a];return d||(d=m.scope[a]=new ea),X[a]=c(d)},a}function t(a){var c,b=a.static;if(a=a.dynamic,"profile"in b){var d=!!b.profile;(c=B((function(a,b){return d}))).enable=d}else if("profile"in a){var e=a.profile;c=L(e,(function(a,b){return a.invoke(b,e)}))}return c}function D(a,b){var c=a.static,d=a.dynamic;if("framebuffer"in c){var e=c.framebuffer;return e?(e=r.getFramebuffer(e),B((function(a,b){var c=a.link(e),d=a.shared;return b.set(d.framebuffer,".next",c),b.set(d=d.context,".framebufferWidth",c+".width"),b.set(d,".framebufferHeight",c+".height"),c}))):B((function(a,b){var c=a.shared;return b.set(c.framebuffer,".next","null"),b.set(c=c.context,".framebufferWidth",c+".drawingBufferWidth"),b.set(c,".framebufferHeight",c+".drawingBufferHeight"),"null"}))}if("framebuffer"in d){var f=d.framebuffer;return L(f,(function(a,b){var c=a.invoke(b,f),d=a.shared,e=d.framebuffer;return c=b.def(e,".getFramebuffer(",c,")"),b.set(e,".next",c),b.set(d=d.context,".framebufferWidth",c+"?"+c+".width:"+d+".drawingBufferWidth"),b.set(d,".framebufferHeight",c+"?"+c+".height:"+d+".drawingBufferHeight"),c}))}return null}function H(a,b,c){function d(a){if(a in e){var c=e[a];a=!0;var h,ca,w=0|c.x,g=0|c.y;return"width"in c?h=0|c.width:a=!1,"height"in c?ca=0|c.height:a=!1,new I(!a&&b&&b.thisDep,!a&&b&&b.contextDep,!a&&b&&b.propDep,(function(a,b){var d=a.shared.context,e=h;"width"in c||(e=b.def(d,".","framebufferWidth","-",w));var f=ca;return"height"in c||(f=b.def(d,".","framebufferHeight","-",g)),[w,g,e,f]}))}if(a in f){var k=f[a];return a=L(k,(function(a,b){var c=a.invoke(b,k),d=a.shared.context,e=b.def(c,".x|0"),f=b.def(c,".y|0");return[e,f,b.def('"width" in ',c,"?",c,".width|0:","(",d,".","framebufferWidth","-",e,")"),c=b.def('"height" in ',c,"?",c,".height|0:","(",d,".","framebufferHeight","-",f,")")]})),b&&(a.thisDep=a.thisDep||b.thisDep,a.contextDep=a.contextDep||b.contextDep,a.propDep=a.propDep||b.propDep),a}return b?new I(b.thisDep,b.contextDep,b.propDep,(function(a,b){var c=a.shared.context;return[0,0,b.def(c,".","framebufferWidth"),b.def(c,".","framebufferHeight")]})):null}var e=a.static,f=a.dynamic;if(a=d("viewport")){var g=a;a=new I(a.thisDep,a.contextDep,a.propDep,(function(a,b){var c=g.append(a,b),d=a.shared.context;return b.set(d,".viewportWidth",c[2]),b.set(d,".viewportHeight",c[3]),c}))}return{viewport:a,scissor_box:d("scissor.box")}}function K(a,b){if("string"==typeof(c=a.static).frag&&"string"==typeof c.vert){if(0<Object.keys(b.dynamic).length)return null;var c=b.static,d=Object.keys(c);if(0<d.length&&"number"==typeof c[d[0]]){for(var e=[],f=0;f<d.length;++f)e.push([0|c[d[f]],d[f]]);return e}}return null}function C(a,c,d){function e(a){if(a in f){var c=b.id(f[a]);return(a=B((function(){return c}))).id=c,a}if(a in g){var d=g[a];return L(d,(function(a,b){var c=a.invoke(b,d);return b.def(a.shared.strings,".id(",c,")")}))}return null}var f=a.static,g=a.dynamic,h=e("frag"),k=e("vert"),X=null;return ua(h)&&ua(k)?(X=u.program(k.id,h.id,null,d),a=B((function(a,b){return a.link(X)}))):a=new I(h&&h.thisDep||k&&k.thisDep,h&&h.contextDep||k&&k.contextDep,h&&h.propDep||k&&k.propDep,(function(a,b){var d,e,c=a.shared.shader;return d=h?h.append(a,b):b.def(c,".","frag"),e=k?k.append(a,b):b.def(c,".","vert"),b.def(c+".program("+e+","+d+")")})),{frag:h,vert:k,progVar:a,program:X}}function M(a,b){function c(a,b){if(a in e){var d=0|e[a];return b?g.offset=d:g.instances=d,B((function(a,c){return b&&(a.OFFSET=d),d}))}if(a in f){var w=f[a];return L(w,(function(a,c){var d=a.invoke(c,w);return b&&(a.OFFSET=d),d}))}if(b){if(X)return B((function(a,b){return a.OFFSET=0}));if(h)return new I(k.thisDep,k.contextDep,k.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.offset:0")}))}else if(h)return new I(k.thisDep,k.contextDep,k.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.instances:-1")}));return null}var e=a.static,f=a.dynamic,g={},h=!1,k=function(){if("vao"in e){var a=e.vao;return null!==a&&null===m.getVAO(a)&&(a=m.createVAO(a)),h=!0,g.vao=a,B((function(b){var c=m.getVAO(a);return c?b.link(c):"null"}))}if("vao"in f){h=!0;var b=f.vao;return L(b,(function(a,c){var d=a.invoke(c,b);return c.def(a.shared.vao+".getVAO("+d+")")}))}return null}(),X=!1,V=function(){if("elements"in e){if(g.elements=a=e.elements,Qa(a)){var b=g.elements=d.create(a,!0),a=d.getElements(b);X=!0}else a&&(a=d.getElements(a),X=!0);return b=B((function(b,c){if(a){var d=b.link(a);return b.ELEMENTS=d}return b.ELEMENTS=null})),b.value=a,b}if("elements"in f){X=!0;var c=f.elements;return L(c,(function(a,b){var e=(d=a.shared).isBufferArgs,d=d.elements,f=a.invoke(b,c),w=b.def("null");return e=b.def(e,"(",f,")"),f=a.cond(e).then(w,"=",d,".createStream(",f,");").else(w,"=",d,".getElements(",f,");"),b.entry(f),b.exit(a.cond(e).then(d,".destroyStream(",w,");")),a.ELEMENTS=w}))}return h?new I(k.thisDep,k.contextDep,k.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.elements+".getElements("+a.shared.vao+".currentVAO.elements):null")})):null}(),va=c("offset",!0),n=function(){if("primitive"in e){var a=e.primitive;return g.primitive=a,B((function(b,c){return Ia[a]}))}if("primitive"in f){var b=f.primitive;return L(b,(function(a,c){var d=a.constants.primTypes,e=a.invoke(c,b);return c.def(d,"[",e,"]")}))}return X?ua(V)?B(V.value?function(a,b){return b.def(a.ELEMENTS,".primType")}:function(){return 4}):new I(V.thisDep,V.contextDep,V.propDep,(function(a,b){var c=a.ELEMENTS;return b.def(c,"?",c,".primType:",4)})):h?new I(k.thisDep,k.contextDep,k.propDep,(function(a,b){return b.def(a.shared.vao+".currentVAO?"+a.shared.vao+".currentVAO.primitive:4")})):null}(),q=function(){if("count"in e){var a=0|e.count;return g.count=a,B((function(){return a}))}if("count"in f){var b=f.count;return L(b,(function(a,c){return a.invoke(c,b)}))}return X?ua(V)?V?va?new I(va.thisDep,va.contextDep,va.propDep,(function(a,b){return b.def(a.ELEMENTS,".vertCount-",a.OFFSET)})):B((function(a,b){return b.def(a.ELEMENTS,".vertCount")})):B((function(){return-1})):new I(V.thisDep||va.thisDep,V.contextDep||va.contextDep,V.propDep||va.propDep,(function(a,b){var c=a.ELEMENTS;return a.OFFSET?b.def(c,"?",c,".vertCount-",a.OFFSET,":-1"):b.def(c,"?",c,".vertCount:-1")})):h?new I(k.thisDep,k.contextDep,k.propDep,(function(a,b){return b.def(a.shared.vao,".currentVAO?",a.shared.vao,".currentVAO.count:-1")})):null}(),l=c("instances",!1);return{elements:V,primitive:n,count:q,instances:l,offset:va,vao:k,vaoActive:h,elementsActive:X,static:g}}function E(a,b){var c=a.static,d=a.dynamic,e={};return La.forEach((function(a){function b(w,g){if(a in c){var O=w(c[a]);e[f]=B((function(){return O}))}else if(a in d){var h=d[a];e[f]=L(h,(function(a,b){return g(a,b,a.invoke(b,h))}))}}var f=g(a);switch(a){case"cull.enable":case"blend.enable":case"dither":case"stencil.enable":case"depth.enable":case"scissor.enable":case"polygonOffset.enable":case"sample.alpha":case"sample.enable":case"depth.mask":case"lineWidth":return b((function(a){return a}),(function(a,b,c){return c}));case"depth.func":return b((function(a){return Za[a]}),(function(a,b,c){return b.def(a.constants.compareFuncs,"[",c,"]")}));case"depth.range":return b((function(a){return a}),(function(a,b,c){return[b.def("+",c,"[0]"),b=b.def("+",c,"[1]")]}));case"blend.func":return b((function(a){return[Ea["srcRGB"in a?a.srcRGB:a.src],Ea["dstRGB"in a?a.dstRGB:a.dst],Ea["srcAlpha"in a?a.srcAlpha:a.src],Ea["dstAlpha"in a?a.dstAlpha:a.dst]]}),(function(a,b,c){function d(a,e){return b.def('"',a,e,'" in ',c,"?",c,".",a,e,":",c,".",a)}a=a.constants.blendFuncs;var e=d("src","RGB"),f=d("dst","RGB"),w=(e=b.def(a,"[",e,"]"),b.def(a,"[",d("src","Alpha"),"]"));return[e,f=b.def(a,"[",f,"]"),w,a=b.def(a,"[",d("dst","Alpha"),"]")]}));case"blend.equation":return b((function(a){return"string"==typeof a?[fa[a],fa[a]]:"object"==typeof a?[fa[a.rgb],fa[a.alpha]]:void 0}),(function(a,b,c){var d=a.constants.blendEquations,e=b.def(),f=b.def();return(a=a.cond("typeof ",c,'==="string"')).then(e,"=",f,"=",d,"[",c,"];"),a.else(e,"=",d,"[",c,".rgb];",f,"=",d,"[",c,".alpha];"),b(a),[e,f]}));case"blend.color":return b((function(a){return J(4,(function(b){return+a[b]}))}),(function(a,b,c){return J(4,(function(a){return b.def("+",c,"[",a,"]")}))}));case"stencil.mask":return b((function(a){return 0|a}),(function(a,b,c){return b.def(c,"|0")}));case"stencil.func":return b((function(a){return[Za[a.cmp||"keep"],a.ref||0,"mask"in a?a.mask:-1]}),(function(a,b,c){return[a=b.def('"cmp" in ',c,"?",a.constants.compareFuncs,"[",c,".cmp]",":",7680),b.def(c,".ref|0"),b=b.def('"mask" in ',c,"?",c,".mask|0:-1")]}));case"stencil.opFront":case"stencil.opBack":return b((function(b){return["stencil.opBack"===a?1029:1028,Ra[b.fail||"keep"],Ra[b.zfail||"keep"],Ra[b.zpass||"keep"]]}),(function(b,c,d){function e(a){return c.def('"',a,'" in ',d,"?",f,"[",d,".",a,"]:",7680)}var f=b.constants.stencilOps;return["stencil.opBack"===a?1029:1028,e("fail"),e("zfail"),e("zpass")]}));case"polygonOffset.offset":return b((function(a){return[0|a.factor,0|a.units]}),(function(a,b,c){return[b.def(c,".factor|0"),b=b.def(c,".units|0")]}));case"cull.face":return b((function(a){var b=0;return"front"===a?b=1028:"back"===a&&(b=1029),b}),(function(a,b,c){return b.def(c,'==="front"?',1028,":",1029)}));case"frontFace":return b((function(a){return yb[a]}),(function(a,b,c){return b.def(c+'==="cw"?2304:2305')}));case"colorMask":return b((function(a){return a.map((function(a){return!!a}))}),(function(a,b,c){return J(4,(function(a){return"!!"+c+"["+a+"]"}))}));case"sample.coverage":return b((function(a){return["value"in a?a.value:1,!!a.invert]}),(function(a,b,c){return[b.def('"value" in ',c,"?+",c,".value:1"),b=b.def("!!",c,".invert")]}))}})),e}function aa(a,b){var c=a.static,d=a.dynamic,e={};return Object.keys(c).forEach((function(a){var d,b=c[a];if("number"==typeof b||"boolean"==typeof b)d=B((function(){return b}));else if("function"==typeof b){var f=b._reglType;"texture2d"===f||"textureCube"===f?d=B((function(a){return a.link(b)})):"framebuffer"!==f&&"framebufferCube"!==f||(d=B((function(a){return a.link(b.color[0])})))}else na(b)&&(d=B((function(a){return a.global.def("[",J(b.length,(function(a){return b[a]})),"]")})));d.value=b,e[a]=d})),Object.keys(d).forEach((function(a){var b=d[a];e[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),e}function ta(a,c){var d=a.static,e=a.dynamic,g={};return Object.keys(d).forEach((function(a){var c=d[a],e=b.id(a),w=new ea;if(Qa(c))w.state=1,w.buffer=f.getBuffer(f.create(c,34962,!1,!0)),w.type=0;else if(h=f.getBuffer(c))w.state=1,w.buffer=h,w.type=0;else if("constant"in c){var O=c.constant;w.buffer="null",w.state=2,"number"==typeof O?w.x=O:Ba.forEach((function(a,b){b<O.length&&(w[a]=O[b])}))}else{var h=Qa(c.buffer)?f.getBuffer(f.create(c.buffer,34962,!1,!0)):f.getBuffer(c.buffer),k=0|c.offset,n=0|c.stride,q=0|c.size,l=!!c.normalized,m=0;"type"in c&&(m=Ha[c.type]),c=0|c.divisor,w.buffer=h,w.state=1,w.size=q,w.normalized=l,w.type=m||h.dtype,w.offset=k,w.stride=n,w.divisor=c}g[a]=B((function(a,b){var c=a.attribCache;if(e in c)return c[e];var d={isStream:!1};return Object.keys(w).forEach((function(a){d[a]=w[a]})),w.buffer&&(d.buffer=a.link(w.buffer),d.type=d.type||d.buffer+".dtype"),c[e]=d}))})),Object.keys(e).forEach((function(a){var b=e[a];g[a]=L(b,(function(a,c){function d(a){c(h[a],"=",e,".",a,"|0;")}var e=a.invoke(c,b),w=a.constants,g=(f=a.shared).isBufferArgs,f=f.buffer,h={isStream:c.def(!1)},O=new ea;O.state=1,Object.keys(O).forEach((function(a){h[a]=c.def(""+O[a])}));var k=h.buffer,da=h.type;return c("if(",g,"(",e,")){",h.isStream,"=true;",k,"=",f,".createStream(",34962,",",e,");",da,"=",k,".dtype;","}else{",k,"=",f,".getBuffer(",e,");","if(",k,"){",da,"=",k,".dtype;",'}else if("constant" in ',e,"){",h.state,"=",2,";","if(typeof "+e+'.constant === "number"){',h[Ba[0]],"=",e,".constant;",Ba.slice(1).map((function(a){return h[a]})).join("="),"=0;","}else{",Ba.map((function(a,b){return h[a]+"="+e+".constant.length>"+b+"?"+e+".constant["+b+"]:0;"})).join(""),"}}else{","if(",g,"(",e,".buffer)){",k,"=",f,".createStream(",34962,",",e,".buffer);","}else{",k,"=",f,".getBuffer(",e,".buffer);","}",da,'="type" in ',e,"?",w.glTypes,"[",e,".type]:",k,".dtype;",h.normalized,"=!!",e,".normalized;"),d("size"),d("offset"),d("stride"),d("divisor"),c("}}"),c.exit("if(",h.isStream,"){",f,".destroyStream(",k,");","}"),h}))})),g}function y(a){var b=a.static,c=a.dynamic,d={};return Object.keys(b).forEach((function(a){var c=b[a];d[a]=B((function(a,b){return"number"==typeof c||"boolean"==typeof c?""+c:a.link(c)}))})),Object.keys(c).forEach((function(a){var b=c[a];d[a]=L(b,(function(a,c){return a.invoke(c,b)}))})),d}function S(a,b,d,e,f){function h(a){var b=q[a];b&&(l[a]=b)}var k=K(a,b),q=H(a,n=D(a)),V=M(a),l=E(a),p=C(a,f,k);h("viewport"),h(g("scissor.box"));var n,r=0<Object.keys(l).length;if((n={framebuffer:n,draw:V,shader:p,state:l,dirty:r,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}}).profile=t(a),n.uniforms=aa(d),n.drawVAO=n.scopeVAO=V.vao,!n.drawVAO&&p.program&&!k&&c.angle_instanced_arrays&&V.static.elements){var u=!0;if(a=p.program.attributes.map((function(a){return a=b.static[a],u=u&&!!a,a})),u&&0<a.length){var x=m.getVAO(m.createVAO({attributes:a,elements:V.static.elements}));n.drawVAO=new I(null,null,null,(function(a,b){return a.link(x)})),n.useVAO=!0}}return k?n.useVAO=!0:n.attributes=ta(b),n.context=y(e),n}function ha(a,b,c){var d=a.shared.context,e=a.scope();Object.keys(c).forEach((function(f){b.save(d,"."+f);var g=c[f].append(a,b);Array.isArray(g)?e(d,".",f,"=[",g.join(),"];"):e(d,".",f,"=",g,";")})),b(e)}function Q(a,b,c,d){var h,f=(e=a.shared).gl,g=e.framebuffer;Ka&&(h=b.def(e.extensions,".webgl_draw_buffers"));var e=(k=a.constants).drawBuffer,k=k.backBuffer;a=c?c.append(a,b):b.def(g,".next"),d||b("if(",a,"!==",g,".cur){"),b("if(",a,"){",f,".bindFramebuffer(",36160,",",a,".framebuffer);"),Ka&&b(h,".drawBuffersWEBGL(",e,"[",a,".colorAttachments.length]);"),b("}else{",f,".bindFramebuffer(",36160,",null);"),Ka&&b(h,".drawBuffersWEBGL(",k,");"),b("}",g,".cur=",a,";"),d||b("}")}function ya(a,b,c){var d=a.shared,e=d.gl,f=a.current,h=a.next,k=d.current,n=d.next,q=a.cond(k,".dirty");La.forEach((function(b){var d,O;if(!((b=g(b))in c.state))if(b in h){d=h[b],O=f[b];var l=J(qa[b].length,(function(a){return q.def(d,"[",a,"]")}));q(a.cond(l.map((function(a,b){return a+"!=="+O+"["+b+"]"})).join("||")).then(e,".",sa[b],"(",l,");",l.map((function(a,b){return O+"["+b+"]="+a})).join(";"),";"))}else d=q.def(n,".",b),l=a.cond(d,"!==",k,".",b),q(l),b in ra?l(a.cond(d).then(e,".enable(",ra[b],");").else(e,".disable(",ra[b],");"),k,".",b,"=",d,";"):l(e,".",sa[b],"(",d,");",k,".",b,"=",d,";")})),0===Object.keys(c.state).length&&q(k,".dirty=false;"),b(q)}function P(a,b,c,d){var e=a.shared,f=a.current,g=e.current,h=e.gl;xb(Object.keys(c)).forEach((function(e){var k=c[e];if(!d||d(k)){var n=k.append(a,b);if(ra[e]){var l=ra[e];ua(k)?b(h,n?".enable(":".disable(",l,");"):b(a.cond(n).then(h,".enable(",l,");").else(h,".disable(",l,");")),b(g,".",e,"=",n,";")}else if(na(n)){var q=f[e];b(h,".",sa[e],"(",n,");",n.map((function(a,b){return q+"["+b+"]="+a})).join(";"),";")}else b(h,".",sa[e],"(",n,");",g,".",e,"=",n,";")}}))}function N(a,b){T&&(a.instancing=b.def(a.shared.extensions,".angle_instanced_arrays"))}function G(a,b,c,d,e){function f(){return"undefined"==typeof performance?"Date.now()":"performance.now()"}function g(a){a(r=b.def(),"=",f(),";"),"string"==typeof e?a(l,".count+=",e,";"):a(l,".count++;"),q&&(d?a(t=b.def(),"=",p,".getNumPendingQueries();"):a(p,".beginQuery(",l,");"))}function h(a){a(l,".cpuTime+=",f(),"-",r,";"),q&&(d?a(p,".pushScopeStats(",t,",",p,".getNumPendingQueries(),",l,");"):a(p,".endQuery();"))}function k(a){var c=b.def(m,".profile");b(m,".profile=",a,";"),b.exit(m,".profile=",c,";")}var r,t,n=a.shared,l=a.stats,m=n.current,p=n.timer;if(c=c.profile){if(ua(c))return void(c.enable?(g(b),h(b.exit),k("true")):k("false"));k(c=c.append(a,b))}else c=b.def(m,".profile");g(n=a.block()),b("if(",c,"){",n,"}"),h(a=a.block()),b.exit("if(",c,"){",a,"}")}function ga(a,b,c,d,e){function f(a){switch(a){case 35664:case 35667:case 35671:return 2;case 35665:case 35668:case 35672:return 3;case 35666:case 35669:case 35673:return 4;default:return 1}}function g(c,d,e){function f(){b(n,".enableVertexAttribArray(",l,");");var g,c=e.type;g=e.size?b.def(e.size,"||",d):d,b(n,".bindBuffer(",34962,",",m,".buffer);",n,".vertexAttribPointer(",[l,g,c,e.normalized,e.stride,e.offset],");",q,".type=",c,";",q,".size=",g,";",da.map((function(a){return q+"."+a+"="+e[a]+";"})).join("")),T&&b("if(",q,".divisor!==",c=e.divisor,"){",a.instancing,".vertexAttribDivisorANGLE(",[l,c],");",q,".divisor=",c,";}")}function k(){b("if(",q,".buffer){",n,".disableVertexAttribArray(",l,");",q,".buffer=null;","}if(",Ba.map((function(a,b){return q+"."+a+"!=="+p[b]})).join("||"),"){",n,".vertexAttrib4f(",l,",",p,");",Ba.map((function(a,b){return q+"."+a+"="+p[b]+";"})).join(""),"}")}var n=h.gl,l=b.def(c,".location"),q=b.def(h.attributes,"[",l,"]"),m=e.buffer,p=[e.x,e.y,e.z,e.w],da=["buffer","normalized","offset","stride"];1===(c=e.state)?f():2===c?k():(b("if(",c,"===",1,"){"),f(),b("}else{"),k(),b("}"))}var h=a.shared;d.forEach((function(d){var n,h=d.name,k=c.attributes[h];if(k){if(!e(k))return;n=k.append(a,b)}else{if(!e(zb))return;var l=a.scopeAttrib(h);n={},Object.keys(new ea).forEach((function(a){n[a]=b.def(l,".",a)}))}g(a.link(d),f(d.info.type),n)}))}function R(a,c,d,e,f,g){for(var l,h=a.shared,k=h.gl,n={},q=0;q<e.length;++q){var m=(p=e[q]).name,r=p.info.type,u=d.uniforms[m];if(1<(t=p.info.size)){if(!u)continue;var x=m.replace("[0]","");if(n[x])continue;n[x]=1}var v,p=a.link(p)+".location";if(u){if(!f(u))continue;if(ua(u)){if(m=u.value,35678===r||35680===r)c(k,".uniform1i(",p,",",(r=a.link(m._texture||m.color[0]._texture))+".bind());"),c.exit(r,".unbind();");else if(35674===r||35675===r||35676===r)t=a.global.def("new Float32Array(["+Array.prototype.slice.call(m)+"])"),m=2,35675===r?m=3:35676===r&&(m=4),c(k,".uniformMatrix",m,"fv(",p,",false,",t,");");else{switch(r){case 5126:l="1f";break;case 35664:l="2f";break;case 35665:l="3f";break;case 35666:l="4f";break;case 35670:case 5124:l="1i";break;case 35671:case 35667:l="2i";break;case 35672:case 35668:l="3i";break;case 35673:case 35669:l="4i"}1<t?(l+="v",m=a.global.def("["+Array.prototype.slice.call(m)+"]")):m=na(m)?Array.prototype.slice.call(m):m,c(k,".uniform",l,"(",p,",",m,");")}continue}v=u.append(a,c)}else{if(!f(zb))continue;v=c.def(h.uniforms,"[",b.id(m),"]")}switch(35678===r?c("if(",v,"&&",v,'._reglType==="framebuffer"){',v,"=",v,".color[0];","}"):35680===r&&c("if(",v,"&&",v,'._reglType==="framebufferCube"){',v,"=",v,".color[0];","}"),m=1,r){case 35678:case 35680:r=c.def(v,"._texture"),c(k,".uniform1i(",p,",",r,".bind());"),c.exit(r,".unbind();");continue;case 5124:case 35670:l="1i";break;case 35667:case 35671:l="2i",m=2;break;case 35668:case 35672:l="3i",m=3;break;case 35669:case 35673:l="4i",m=4;break;case 5126:l="1f";break;case 35664:l="2f",m=2;break;case 35665:l="3f",m=3;break;case 35666:l="4f",m=4;break;case 35674:l="Matrix2fv";break;case 35675:l="Matrix3fv";break;case 35676:l="Matrix4fv"}if(-1===l.indexOf("Matrix")&&1<t&&(l+="v",m=1),"M"===l.charAt(0)){c(k,".uniform",l,"(",p,","),p=Math.pow(r-35674+2,2);var z=a.global.def("new Float32Array(",p,")");Array.isArray(v)?c("false,(",J(p,(function(a){return z+"["+a+"]="+v[a]})),",",z,")"):c("false,(Array.isArray(",v,")||",v," instanceof Float32Array)?",v,":(",J(p,(function(a){return z+"["+a+"]="+v+"["+a+"]"})),",",z,")"),c(");")}else{if(1<m){r=[];for(var A=[],t=0;t<m;++t)Array.isArray(v)?A.push(v[t]):A.push(c.def(v+"["+t+"]")),g&&r.push(c.def());g&&c("if(!",a.batchId,"||",r.map((function(a,b){return a+"!=="+A[b]})).join("||"),"){",r.map((function(a,b){return a+"="+A[b]+";"})).join("")),c(k,".uniform",l,"(",p,",",A.join(","),");")}else g&&(r=c.def(),c("if(!",a.batchId,"||",r,"!==",v,"){",r,"=",v,";")),c(k,".uniform",l,"(",p,",",v,");");g&&c("}")}}}function U(a,b,c,d){function e(f){var g=n[f];return g?g.append(a,g.contextDep&&d.contextDynamic||g.propDep?c:b):b.def(l,".",f)}function f(){function a(){c(u,".drawElementsInstancedANGLE(",[q,r,v,p+"<<(("+v+"-5121)>>1)",t],");")}function b(){c(u,".drawArraysInstancedANGLE(",[q,p,r,t],");")}m&&"null"!==m?x?a():(c("if(",m,"){"),a(),c("}else{"),b(),c("}")):b()}function g(){function a(){c(k+".drawElements("+[q,r,v,p+"<<(("+v+"-5121)>>1)"]+");")}function b(){c(k+".drawArrays("+[q,p,r]+");")}m&&"null"!==m?x?a():(c("if(",m,"){"),a(),c("}else{"),b(),c("}")):b()}var t,u,h=a.shared,k=h.gl,l=h.draw,n=d.draw,m=function(){var e=n.elements,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f),n.elementsActive&&f("if("+e+")"+k+".bindBuffer(34963,"+e+".buffer.buffer);")):(e=f.def(),f(e,"=",l,".","elements",";","if(",e,"){",k,".bindBuffer(",34963,",",e,".buffer.buffer);}","else if(",h.vao,".currentVAO){",e,"=",a.shared.elements+".getElements("+h.vao,".currentVAO.elements);",oa?"":"if("+e+")"+k+".bindBuffer(34963,"+e+".buffer.buffer);","}")),e}(),q=e("primitive"),p=e("offset"),r=function(){var e=n.count,f=b;return e?((e.contextDep&&d.contextDynamic||e.propDep)&&(f=c),e=e.append(a,f)):e=f.def(l,".","count"),e}();if("number"==typeof r){if(0===r)return}else c("if(",r,"){"),c.exit("}");T&&(t=e("instances"),u=a.instancing);var v=m+".type",x=n.elements&&ua(n.elements)&&!n.vaoActive;T&&("number"!=typeof t||0<=t)?"string"==typeof t?(c("if(",t,">0){"),f(),c("}else if(",t,"<0){"),g(),c("}")):f():g()}function ba(a,b,c,d,e){return e=(b=A()).proc("body",e),T&&(b.instancing=e.def(b.shared.extensions,".angle_instanced_arrays")),a(b,e,c,d),b.compile().body}function W(a,b,c,d){N(a,b),c.useVAO?c.drawVAO?b(a.shared.vao,".setVAO(",c.drawVAO.append(a,b),");"):b(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(b(a.shared.vao,".setVAO(null);"),ga(a,b,c,d.attributes,(function(){return!0}))),R(a,b,c,d.uniforms,(function(){return!0}),!1),U(a,b,b,c)}function Da(a,b){var c=a.proc("draw",1);N(a,c),ha(a,c,b.context),Q(a,c,b.framebuffer),ya(a,c,b),P(a,c,b.state),G(a,c,b,!1,!0);var d=b.shader.progVar.append(a,c);if(c(a.shared.gl,".useProgram(",d,".program);"),b.shader.program)W(a,c,b,b.shader.program);else{c(a.shared.vao,".setVAO(null);");var e=a.global.def("{}"),f=c.def(d,".id"),g=c.def(e,"[",f,"]");c(a.cond(g).then(g,".call(this,a0);").else(g,"=",e,"[",f,"]=",a.link((function(c){return ba(W,a,b,c,1)})),"(",d,");",g,".call(this,a0);"))}0<Object.keys(b.state).length&&c(a.shared.current,".dirty=true;"),a.shared.vao&&c(a.shared.vao,".setVAO(null);")}function la(a,b,c,d){function e(){return!0}a.batchId="a1",N(a,b),ga(a,b,c,d.attributes,e),R(a,b,c,d.uniforms,e,!1),U(a,b,b,c)}function ma(a,b,c,d){function e(a){return a.contextDep&&g||a.propDep}function f(a){return!e(a)}N(a,b);var g=c.contextDep,h=b.def(),k=b.def();a.shared.props=k,a.batchId=h;var n=a.scope(),l=a.scope();b(n.entry,"for(",h,"=0;",h,"<","a1",";++",h,"){",k,"=","a0","[",h,"];",l,"}",n.exit),c.needsContext&&ha(a,l,c.context),c.needsFramebuffer&&Q(a,l,c.framebuffer),P(a,l,c.state,e),c.profile&&e(c.profile)&&G(a,l,c,!1,!0),d?(c.useVAO?c.drawVAO?e(c.drawVAO)?l(a.shared.vao,".setVAO(",c.drawVAO.append(a,l),");"):n(a.shared.vao,".setVAO(",c.drawVAO.append(a,n),");"):n(a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"):(n(a.shared.vao,".setVAO(null);"),ga(a,n,c,d.attributes,f),ga(a,l,c,d.attributes,e)),R(a,n,c,d.uniforms,f,!1),R(a,l,c,d.uniforms,e,!0),U(a,n,l,c)):(b=a.global.def("{}"),d=c.shader.progVar.append(a,l),k=l.def(d,".id"),n=l.def(b,"[",k,"]"),l(a.shared.gl,".useProgram(",d,".program);","if(!",n,"){",n,"=",b,"[",k,"]=",a.link((function(b){return ba(la,a,c,b,2)})),"(",d,");}",n,".call(this,a0[",h,"],",h,");"))}function x(a,b){function c(a){return a.contextDep&&e||a.propDep}var d=a.proc("batch",2);a.batchId="0",N(a,d);var e=!1,f=!0;Object.keys(b.context).forEach((function(a){e=e||b.context[a].propDep})),e||(ha(a,d,b.context),f=!1);var h=!1;if((g=b.framebuffer)?(g.propDep?e=h=!0:g.contextDep&&e&&(h=!0),h||Q(a,d,g)):Q(a,d,null),b.state.viewport&&b.state.viewport.propDep&&(e=!0),ya(a,d,b),P(a,d,b.state,(function(a){return!c(a)})),b.profile&&c(b.profile)||G(a,d,b,!1,"a1"),b.contextDep=e,b.needsContext=f,b.needsFramebuffer=h,(f=b.shader.progVar).contextDep&&e||f.propDep)ma(a,d,b,null);else if(f=f.append(a,d),d(a.shared.gl,".useProgram(",f,".program);"),b.shader.program)ma(a,d,b,b.shader.program);else{d(a.shared.vao,".setVAO(null);");var g=a.global.def("{}"),k=(h=d.def(f,".id"),d.def(g,"[",h,"]"));d(a.cond(k).then(k,".call(this,a0,a1);").else(k,"=",g,"[",h,"]=",a.link((function(c){return ba(ma,a,b,c,2)})),"(",f,");",k,".call(this,a0,a1);"))}0<Object.keys(b.state).length&&d(a.shared.current,".dirty=true;"),a.shared.vao&&d(a.shared.vao,".setVAO(null);")}function Z(a,c){function d(b){var g=c.shader[b];g&&e.set(f.shader,"."+b,g.append(a,e))}var e=a.proc("scope",3);a.batchId="a2";var f=a.shared,g=f.current;ha(a,e,c.context),c.framebuffer&&c.framebuffer.append(a,e),xb(Object.keys(c.state)).forEach((function(b){var d=c.state[b].append(a,e);na(d)?d.forEach((function(c,d){e.set(a.next[b],"["+d+"]",c)})):e.set(f.next,"."+b,d)})),G(a,e,c,!0,!0),["elements","offset","count","instances","primitive"].forEach((function(b){var d=c.draw[b];d&&e.set(f.draw,"."+b,""+d.append(a,e))})),Object.keys(c.uniforms).forEach((function(d){var g=c.uniforms[d].append(a,e);Array.isArray(g)&&(g="["+g.join()+"]"),e.set(f.uniforms,"["+b.id(d)+"]",g)})),Object.keys(c.attributes).forEach((function(b){var d=c.attributes[b].append(a,e),f=a.scopeAttrib(b);Object.keys(new ea).forEach((function(a){e.set(f,"."+a,d[a])}))})),c.scopeVAO&&e.set(f.vao,".targetVAO",c.scopeVAO.append(a,e)),d("vert"),d("frag"),0<Object.keys(c.state).length&&(e(g,".dirty=true;"),e.exit(g,".dirty=true;")),e("a1(",a.shared.context,",a0,",a.batchId,");")}function ja(a){if("object"==typeof a&&!na(a)){for(var b=Object.keys(a),c=0;c<b.length;++c)if(Y.isDynamic(a[b[c]]))return!0;return!1}}function ia(a,b,c){function d(a,b){g.forEach((function(c){var d=e[c];Y.isDynamic(d)&&(d=a.invoke(b,d),b(l,".",c,"=",d,";"))}))}var e=b.static[c];if(e&&ja(e)){var f=a.global,g=Object.keys(e),h=!1,k=!1,n=!1,l=a.global.def("{}");g.forEach((function(b){var c=e[b];if(Y.isDynamic(c))"function"==typeof c&&(c=e[b]=Y.unbox(c)),b=L(c,null),h=h||b.thisDep,n=n||b.propDep,k=k||b.contextDep;else{switch(f(l,".",b,"="),typeof c){case"number":f(c);break;case"string":f('"',c,'"');break;case"object":Array.isArray(c)&&f("[",c.join(),"]");break;default:f(a.link(c))}f(";")}})),b.dynamic[c]=new Y.DynamicVariable(4,{thisDep:h,contextDep:k,propDep:n,ref:l,append:d}),delete b.static[c]}}var ea=m.Record,fa={add:32774,subtract:32778,"reverse subtract":32779};c.ext_blend_minmax&&(fa.min=32775,fa.max=32776);var T=c.angle_instanced_arrays,Ka=c.webgl_draw_buffers,oa=c.oes_vertex_array_object,qa={dirty:!0,profile:h.profile},Ca={},La=[],ra={},sa={};k("dither",3024),k("blend.enable",3042),l("blend.color","blendColor",[0,0,0,0]),l("blend.equation","blendEquationSeparate",[32774,32774]),l("blend.func","blendFuncSeparate",[1,0,1,0]),k("depth.enable",2929,!0),l("depth.func","depthFunc",513),l("depth.range","depthRange",[0,1]),l("depth.mask","depthMask",!0),l("colorMask","colorMask",[!0,!0,!0,!0]),k("cull.enable",2884),l("cull.face","cullFace",1029),l("frontFace","frontFace",2305),l("lineWidth","lineWidth",1),k("polygonOffset.enable",32823),l("polygonOffset.offset","polygonOffset",[0,0]),k("sample.alpha",32926),k("sample.enable",32928),l("sample.coverage","sampleCoverage",[1,!1]),k("stencil.enable",2960),l("stencil.mask","stencilMask",-1),l("stencil.func","stencilFunc",[519,0,-1]),l("stencil.opFront","stencilOpSeparate",[1028,7680,7680,7680]),l("stencil.opBack","stencilOpSeparate",[1029,7680,7680,7680]),k("scissor.enable",3089),l("scissor.box","scissor",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]),l("viewport","viewport",[0,0,a.drawingBufferWidth,a.drawingBufferHeight]);var rb={gl:a,context:z,strings:b,next:Ca,current:qa,draw:n,elements:d,buffer:f,shader:u,attributes:m.state,vao:m,uniforms:v,framebuffer:r,extensions:c,timer:q,isBufferArgs:Qa},Na={primTypes:Ia,compareFuncs:Za,blendFuncs:Ea,blendEquations:fa,stencilOps:Ra,glTypes:Ha,orientationType:yb};Ka&&(Na.backBuffer=[1029],Na.drawBuffer=J(e.maxDrawbuffers,(function(a){return 0===a?[0]:J(a,(function(a){return 36064+a}))})));var pa=0;return{next:Ca,current:qa,procs:function(){var a=A(),b=a.proc("poll"),d=a.proc("refresh"),f=a.block();b(f),d(f);var l,g=a.shared,h=g.gl,k=g.next,n=g.current;f(n,".dirty=false;"),Q(a,b),Q(a,d,null,!0),T&&(l=a.link(T)),c.oes_vertex_array_object&&d(a.link(c.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var m=0;m<e.maxAttributes;++m){var q=d.def(g.attributes,"[",m,"]"),p=a.cond(q,".buffer");p.then(h,".enableVertexAttribArray(",m,");",h,".bindBuffer(",34962,",",q,".buffer.buffer);",h,".vertexAttribPointer(",m,",",q,".size,",q,".type,",q,".normalized,",q,".stride,",q,".offset);").else(h,".disableVertexAttribArray(",m,");",h,".vertexAttrib4f(",m,",",q,".x,",q,".y,",q,".z,",q,".w);",q,".buffer=null;"),d(p),T&&d(l,".vertexAttribDivisorANGLE(",m,",",q,".divisor);")}return d(a.shared.vao,".currentVAO=null;",a.shared.vao,".setVAO(",a.shared.vao,".targetVAO);"),Object.keys(ra).forEach((function(c){var e=ra[c],g=f.def(k,".",c),l=a.block();l("if(",g,"){",h,".enable(",e,")}else{",h,".disable(",e,")}",n,".",c,"=",g,";"),d(l),b("if(",g,"!==",n,".",c,"){",l,"}")})),Object.keys(sa).forEach((function(c){var l,m,e=sa[c],g=qa[c],q=a.block();q(h,".",e,"("),na(g)?(e=g.length,l=a.global.def(k,".",c),m=a.global.def(n,".",c),q(J(e,(function(a){return l+"["+a+"]"})),");",J(e,(function(a){return m+"["+a+"]="+l+"["+a+"];"})).join("")),b("if(",J(e,(function(a){return l+"["+a+"]!=="+m+"["+a+"]"})).join("||"),"){",q,"}")):(l=f.def(k,".",c),m=f.def(n,".",c),q(l,");",n,".",c,"=",l,";"),b("if(",l,"!==",m,"){",q,"}")),d(q)})),a.compile()}(),compile:function(a,b,c,d,e){var f=A();f.stats=f.link(e),Object.keys(b.static).forEach((function(a){ia(f,b,a)})),Xb.forEach((function(b){ia(f,a,b)}));var g=S(a,b,c,d,f);return Da(f,g),Z(f,g),x(f,g),F(f.compile(),{destroy:function(){g.shader.program.destroy()}})}}}function Ab(a,b){for(var c=0;c<a.length;++c)if(a[c]===b)return c;return-1}var F=function(a,b){for(var c=Object.keys(b),e=0;e<c.length;++e)a[c[e]]=b[c[e]];return a},Cb=0,Y={DynamicVariable:U,define:function(a,b){return new U(a,ab(b+""))},isDynamic:function(a){return"function"==typeof a&&!a._reglType||a instanceof U},unbox:bb,accessor:ab},$a={next:"function"==typeof requestAnimationFrame?function(a){return requestAnimationFrame(a)}:function(a){return setTimeout(a,16)},cancel:"function"==typeof cancelAnimationFrame?function(a){return cancelAnimationFrame(a)}:clearTimeout},Bb="undefined"!=typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date},D=fb();D.zero=fb();var Yb=function(a,b){var c=1;b.ext_texture_filter_anisotropic&&(c=a.getParameter(34047));var e=1,f=1;b.webgl_draw_buffers&&(e=a.getParameter(34852),f=a.getParameter(36063));var d=!!b.oes_texture_float;if(d){d=a.createTexture(),a.bindTexture(3553,d),a.texImage2D(3553,0,6408,1,1,0,6408,5126,null);var p=a.createFramebuffer();if(a.bindFramebuffer(36160,p),a.framebufferTexture2D(36160,36064,3553,d,0),a.bindTexture(3553,null),36053!==a.checkFramebufferStatus(36160))d=!1;else{a.viewport(0,0,1,1),a.clearColor(1,0,0,1),a.clear(16384);var r=D.allocType(5126,4);a.readPixels(0,0,1,1,6408,5126,r),a.getError()?d=!1:(a.deleteFramebuffer(p),a.deleteTexture(d),d=1===r[0]),D.freeType(r)}}return r=!0,"undefined"!=typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent))||(r=a.createTexture(),p=D.allocType(5121,36),a.activeTexture(33984),a.bindTexture(34067,r),a.texImage2D(34069,0,6408,3,3,0,6408,5121,p),D.freeType(p),a.bindTexture(34067,null),a.deleteTexture(r),r=!a.getError()),{colorBits:[a.getParameter(3410),a.getParameter(3411),a.getParameter(3412),a.getParameter(3413)],depthBits:a.getParameter(3414),stencilBits:a.getParameter(3415),subpixelBits:a.getParameter(3408),extensions:Object.keys(b).filter((function(a){return!!b[a]})),maxAnisotropic:c,maxDrawbuffers:e,maxColorAttachments:f,pointSizeDims:a.getParameter(33901),lineWidthDims:a.getParameter(33902),maxViewportDims:a.getParameter(3386),maxCombinedTextureUnits:a.getParameter(35661),maxCubeMapSize:a.getParameter(34076),maxRenderbufferSize:a.getParameter(34024),maxTextureUnits:a.getParameter(34930),maxTextureSize:a.getParameter(3379),maxAttributes:a.getParameter(34921),maxVertexUniforms:a.getParameter(36347),maxVertexTextureUnits:a.getParameter(35660),maxVaryingVectors:a.getParameter(36348),maxFragmentUniforms:a.getParameter(36349),glsl:a.getParameter(35724),renderer:a.getParameter(7937),vendor:a.getParameter(7936),version:a.getParameter(7938),readFloat:d,npotTextureCube:r}},K=function(a){return a instanceof Uint8Array||a instanceof Uint16Array||a instanceof Uint32Array||a instanceof Int8Array||a instanceof Int16Array||a instanceof Int32Array||a instanceof Float32Array||a instanceof Float64Array||a instanceof Uint8ClampedArray},S=function(a){return Object.keys(a).map((function(b){return a[b]}))},Oa={shape:function(a){for(var b=[];a.length;a=a[0])b.push(a.length);return b},flatten:function(a,b,c,e){var f=1;if(b.length)for(var d=0;d<b.length;++d)f*=b[d];else f=0;switch(c=e||D.allocType(c,f),b.length){case 0:break;case 1:for(e=b[0],b=0;b<e;++b)c[b]=a[b];break;case 2:for(e=b[0],b=b[1],d=f=0;d<e;++d)for(var p=a[d],r=0;r<b;++r)c[f++]=p[r];break;case 3:gb(a,b[0],b[1],b[2],c,0);break;default:hb(a,b,0,c,0)}return c}},Ga={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},Ha={int8:5120,int16:5122,int32:5124,uint8:5121,uint16:5123,uint32:5125,float:5126,float32:5126},lb={dynamic:35048,stream:35040,static:35044},Sa=Oa.flatten,kb=Oa.shape,ia=[];ia[5120]=1,ia[5122]=2,ia[5124]=4,ia[5121]=1,ia[5123]=2,ia[5125]=4,ia[5126]=4;var Ia={points:0,point:0,lines:1,line:1,triangles:4,triangle:4,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},nb=new Float32Array(1),Kb=new Uint32Array(nb.buffer),Ob=[9984,9986,9985,9987],Ma=[0,6409,6410,6407,6408],R={};R[6409]=R[6406]=R[6402]=1,R[34041]=R[6410]=2,R[6407]=R[35904]=3,R[6408]=R[35906]=4;var Va=oa("HTMLCanvasElement"),Wa=oa("OffscreenCanvas"),sb=oa("CanvasRenderingContext2D"),tb=oa("ImageBitmap"),ub=oa("HTMLImageElement"),vb=oa("HTMLVideoElement"),Lb=Object.keys(Ga).concat([Va,Wa,sb,tb,ub,vb]),pa=[];pa[5121]=1,pa[5126]=4,pa[36193]=2,pa[5123]=2,pa[5125]=4;var H=[];H[32854]=2,H[32855]=2,H[36194]=2,H[34041]=4,H[33776]=.5,H[33777]=.5,H[33778]=1,H[33779]=1,H[35986]=.5,H[35987]=1,H[34798]=1,H[35840]=.5,H[35841]=.25,H[35842]=.5,H[35843]=.25,H[36196]=.5;var P=[];P[32854]=2,P[32855]=2,P[36194]=2,P[33189]=2,P[36168]=1,P[34041]=4,P[35056]=4,P[35907]=4,P[34836]=16,P[34842]=8,P[34843]=6;var Zb=function(a,b,c,e,f){function d(a){this.id=m++,this.refCount=1,this.renderbuffer=a,this.format=32854,this.height=this.width=0,f.profile&&(this.stats={size:0})}function p(b){var c=b.renderbuffer;a.bindRenderbuffer(36161,null),a.deleteRenderbuffer(c),b.renderbuffer=null,b.refCount=0,delete u[b.id],e.renderbufferCount--}var r={rgba4:32854,rgba8:32856,rgb565:36194,"rgb5 a1":32855,depth:33189,stencil:36168,"depth stencil":34041,"depth24 stencil8":35056};b.ext_srgb&&(r.srgba=35907),b.ext_color_buffer_half_float&&(r.rgba16f=34842,r.rgb16f=34843),b.webgl_color_buffer_float&&(r.rgba32f=34836);var v=[];Object.keys(r).forEach((function(a){v[r[a]]=a}));var m=0,u={};return d.prototype.decRef=function(){0>=--this.refCount&&p(this)},f.profile&&(e.getTotalRenderbufferSize=function(){var a=0;return Object.keys(u).forEach((function(b){a+=u[b].stats.size})),a}),{create:function(b,c){function m(b,c){var d=0,e=0,n=32854,p=0;if("object"==typeof b&&b?("shape"in b?(d=0|(e=b.shape)[0],e=0|e[1]):("radius"in b&&(d=e=0|b.radius),"width"in b&&(d=0|b.width),"height"in b&&(e=0|b.height)),"format"in b&&(n=r[b.format]),"samples"in b&&(p=b.samples)):"number"==typeof b?(d=0|b,e="number"==typeof c?0|c:d):b||(d=e=1),d!==h.width||e!==h.height||n!==h.format)return m.width=h.width=d,m.height=h.height=e,m.samples=p,h.format=n,h.samples=p,a.bindRenderbuffer(36161,h.renderbuffer),p&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,p,n,d,e):a.renderbufferStorage(36161,n,d,e),f.profile&&(h.stats.size=P[h.format]*h.width*h.height),m.format=v[h.format],m}var h=new d(a.createRenderbuffer());return u[h.id]=h,e.renderbufferCount++,m(b,c),m.resize=function(b,c){var d=0|b,e=0|c||d;if(d===h.width&&e===h.height)return m;m.width=h.width=d,m.height=h.height=e;var n=m.samples;return a.bindRenderbuffer(36161,h.renderbuffer),n&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,n,h.format,d,e):a.renderbufferStorage(36161,h.format,d,e),f.profile&&(h.stats.size=P[h.format]*h.width*h.height),m},m._reglType="renderbuffer",m._renderbuffer=h,f.profile&&(m.stats=h.stats),m.destroy=function(){h.decRef()},m},clear:function(){S(u).forEach(p)},restore:function(){S(u).forEach((function(b){b.renderbuffer=a.createRenderbuffer(),a.bindRenderbuffer(36161,b.renderbuffer),b.samples&&a.renderbufferStorageMultisample?a.renderbufferStorageMultisample(36161,b.samples,b.format,b.width,b.height):a.renderbufferStorage(36161,b.format,b.width,b.height)})),a.bindRenderbuffer(36161,null)}}},Xa=[];Xa[6408]=4,Xa[6407]=3;var Pa=[];Pa[5121]=1,Pa[5126]=4,Pa[36193]=2;var Ba=["x","y","z","w"],Xb="blend.func blend.equation stencil.func stencil.opFront stencil.opBack sample.coverage viewport scissor.box polygonOffset.offset".split(" "),Ea={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Za={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ra={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},yb={cw:2304,ccw:2305},zb=new I(!1,!1,!1,(function(){})),$b=function(a,b){function c(){this.endQueryIndex=this.startQueryIndex=-1,this.sum=0,this.stats=null}function e(a,b,d){var e=p.pop()||new c;e.startQueryIndex=a,e.endQueryIndex=b,e.sum=0,e.stats=d,r.push(e)}if(!b.ext_disjoint_timer_query)return null;var f=[],d=[],p=[],r=[],v=[],m=[];return{beginQuery:function(a){var c=f.pop()||b.ext_disjoint_timer_query.createQueryEXT();b.ext_disjoint_timer_query.beginQueryEXT(35007,c),d.push(c),e(d.length-1,d.length,a)},endQuery:function(){b.ext_disjoint_timer_query.endQueryEXT(35007)},pushScopeStats:e,update:function(){var a,c;if(0!==(a=d.length)){m.length=Math.max(m.length,a+1),v.length=Math.max(v.length,a+1),v[0]=0;var e=m[0]=0;for(c=a=0;c<d.length;++c)b.ext_disjoint_timer_query.getQueryObjectEXT(q=d[c],34919)?(e+=b.ext_disjoint_timer_query.getQueryObjectEXT(q,34918),f.push(q)):d[a++]=q,v[c+1]=e,m[c+1]=a;for(d.length=a,c=a=0;c<r.length;++c){var q,h=(e=r[c]).startQueryIndex;e.sum+=v[q=e.endQueryIndex]-v[h],(q=m[q])===(h=m[h])?(e.stats.gpuTime+=e.sum/1e6,p.push(e)):(e.startQueryIndex=h,e.endQueryIndex=q,r[a++]=e)}r.length=a}},getNumPendingQueries:function(){return d.length},clear:function(){f.push.apply(f,d);for(var a=0;a<f.length;a++)b.ext_disjoint_timer_query.deleteQueryEXT(f[a]);d.length=0,f.length=0},restore:function(){d.length=0,f.length=0}}};return function(a){function b(){if(0===G.length)t&&t.update(),ba=null;else{ba=$a.next(b),u();for(var a=G.length-1;0<=a;--a){var c=G[a];c&&c(C,null,0)}q.flush(),t&&t.update()}}function c(){!ba&&0<G.length&&(ba=$a.next(b))}function e(){ba&&($a.cancel(b),ba=null)}function f(a){a.preventDefault(),e(),S.forEach((function(a){a()}))}function d(a){q.getError(),g.restore(),y.restore(),E.restore(),K.restore(),P.restore(),Q.restore(),L.restore(),t&&t.restore(),J.procs.refresh(),c(),U.forEach((function(a){a()}))}function p(a){function b(a,c){var d={},e={};return Object.keys(a).forEach((function(b){var f=a[b];if(Y.isDynamic(f))e[b]=Y.unbox(f,b);else{if(c&&Array.isArray(f))for(var g=0;g<f.length;++g)if(Y.isDynamic(f[g]))return void(e[b]=Y.unbox(f,b));d[b]=f}})),{dynamic:e,static:d}}function c(a){for(;n.length<a;)n.push(null);return n}var d=b(a.context||{},!0),e=b(a.uniforms||{},!0),f=b(a.attributes||{},!1);a=b(function(a){function b(a){if(a in c){var d=c[a];delete c[a],Object.keys(d).forEach((function(b){c[a+"."+b]=d[b]}))}}var c=F({},a);return delete c.uniforms,delete c.attributes,delete c.context,delete c.vao,"stencil"in c&&c.stencil.op&&(c.stencil.opBack=c.stencil.opFront=c.stencil.op,delete c.stencil.op),b("blend"),b("depth"),b("cull"),b("stencil"),b("polygonOffset"),b("scissor"),b("sample"),"vao"in a&&(c.vao=a.vao),c}(a),!1);var g={gpuTime:0,cpuTime:0,count:0},h=J.compile(a,f,e,d,g),k=h.draw,l=h.batch,m=h.scope,n=[];return F((function(a,b){var d;if("function"==typeof a)return m.call(this,null,a,0);if("function"==typeof b)if("number"==typeof a)for(d=0;d<a;++d)m.call(this,null,b,d);else{if(!Array.isArray(a))return m.call(this,a,b,0);for(d=0;d<a.length;++d)m.call(this,a[d],b,d)}else if("number"==typeof a){if(0<a)return l.call(this,c(0|a),0|a)}else{if(!Array.isArray(a))return k.call(this,a);if(a.length)return l.call(this,a,a.length)}}),{stats:g,destroy:function(){h.destroy()}})}function r(a,b){var c=0;J.procs.poll();var d=b.color;d&&(q.clearColor(+d[0]||0,+d[1]||0,+d[2]||0,+d[3]||0),c|=16384),"depth"in b&&(q.clearDepth(+b.depth),c|=256),"stencil"in b&&(q.clearStencil(0|b.stencil),c|=1024),q.clear(c)}function v(a){return G.push(a),c(),{cancel:function(){function b(){var a=Ab(G,b);G[a]=G[G.length-1],--G.length,0>=G.length&&e()}var c=Ab(G,a);G[c]=b}}}function m(){var a=R.viewport,b=R.scissor_box;a[0]=a[1]=b[0]=b[1]=0,C.viewportWidth=C.framebufferWidth=C.drawingBufferWidth=a[2]=b[2]=q.drawingBufferWidth,C.viewportHeight=C.framebufferHeight=C.drawingBufferHeight=a[3]=b[3]=q.drawingBufferHeight}function u(){C.tick+=1,C.time=z(),m(),J.procs.poll()}function n(){K.refresh(),m(),J.procs.refresh(),t&&t.update()}function z(){return(Bb()-B)/1e3}if(!(a=Gb(a)))return null;var q=a.gl,h=q.getContextAttributes();q.isContextLost();var g=Hb(q,a);if(!g)return null;var k=Db(),l={vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0},A=g.extensions,t=$b(q,A),B=Bb(),H=q.drawingBufferHeight,C={tick:0,time:0,viewportWidth:D=q.drawingBufferWidth,viewportHeight:H,framebufferWidth:D,framebufferHeight:H,drawingBufferWidth:D,drawingBufferHeight:H,pixelRatio:a.pixelRatio},D={elements:null,primitive:4,count:-1,offset:0,instances:-1},M=Yb(q,A),E=Ib(q,l,a,(function(a){return L.destroyBuffer(a)})),I=Jb(q,A,E,l),L=Rb(q,A,M,l,E,I,D),y=Sb(q,k,l,a),K=Mb(q,A,M,(function(){J.procs.poll()}),C,l,a),P=Zb(q,A,M,l,a),Q=Qb(q,A,M,K,P,l),J=Vb(q,k,A,M,E,I,K,Q,{},L,y,D,C,t,a),R=(k=Tb(q,Q,J.procs.poll,C),J.next),N=q.canvas,G=[],S=[],U=[],W=[a.onDestroy],ba=null;N&&(N.addEventListener("webglcontextlost",f,!1),N.addEventListener("webglcontextrestored",d,!1));var Z=Q.setFBO=p({framebuffer:Y.define.call(null,1,"framebuffer")});return n(),h=F(p,{clear:function(a){if("framebuffer"in a)if(a.framebuffer&&"framebufferCube"===a.framebuffer_reglType)for(var b=0;6>b;++b)Z(F({framebuffer:a.framebuffer.faces[b]},a),r);else Z(a,r);else r(null,a)},prop:Y.define.bind(null,1),context:Y.define.bind(null,2),this:Y.define.bind(null,3),draw:p({}),buffer:function(a){return E.create(a,34962,!1,!1)},elements:function(a){return I.create(a,!1)},texture:K.create2D,cube:K.createCube,renderbuffer:P.create,framebuffer:Q.create,framebufferCube:Q.createCube,vao:L.createVAO,attributes:h,frame:v,on:function(a,b){var c;switch(a){case"frame":return v(b);case"lost":c=S;break;case"restore":c=U;break;case"destroy":c=W}return c.push(b),{cancel:function(){for(var a=0;a<c.length;++a)if(c[a]===b){c[a]=c[c.length-1],c.pop();break}}}},limits:M,hasExtension:function(a){return 0<=M.extensions.indexOf(a.toLowerCase())},read:k,destroy:function(){G.length=0,e(),N&&(N.removeEventListener("webglcontextlost",f),N.removeEventListener("webglcontextrestored",d)),y.clear(),Q.clear(),P.clear(),L.clear(),K.clear(),I.clear(),E.clear(),t&&t.clear(),W.forEach((function(a){a()}))},_gl:q,_refresh:n,poll:function(){u(),t&&t.update()},now:z,stats:l,blit:Q.blit}),a.onDone(null,h),h}}()}(regl_min);var a$2=regl_min.exports,EPSILON=1e-6,ARRAY_TYPE="undefined"!=typeof Float32Array?Float32Array:Array,RANDOM=Math.random;var degree=Math.PI/180;var common=Object.freeze({__proto__:null,EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE},RANDOM,setMatrixArrayType:function(type){ARRAY_TYPE=type},toRadian:function(a){return a*degree},equals:function(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b))}});function set$8(out,m00,m01,m10,m11){return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out}function multiply$8(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out}function fromRotation$4(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out}function subtract$6(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}var mat2=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out},fromValues:function(m00,m01,m10,m11){var out=new ARRAY_TYPE(4);return out[0]=m00,out[1]=m01,out[2]=m10,out[3]=m11,out},set:set$8,transpose:function(out,a){if(out===a){var a1=a[1];out[1]=a[2],out[2]=a1}else out[0]=a[0],out[1]=a[2],out[2]=a[1],out[3]=a[3];return out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],det=a0*a3-a2*a1;return det?(out[0]=a3*(det=1/det),out[1]=-a1*det,out[2]=-a2*det,out[3]=a0*det,out):null},adjoint:function(out,a){var a0=a[0];return out[0]=a[3],out[1]=-a[1],out[2]=-a[2],out[3]=a0,out},determinant:function(a){return a[0]*a[3]-a[2]*a[1]},multiply:multiply$8,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out},fromRotation:fromRotation$4,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out},str:function(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2))},LDU:function(L,D,U,a){return L[2]=a[2]/a[0],U[0]=a[0],U[1]=a[1],U[3]=a[3]-L[2]*U[1],[L,D,U]},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out},subtract:subtract$6,exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))},multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},mul:multiply$8,sub:subtract$6});function multiply$7(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return out[0]=a0*b0+a2*b1,out[1]=a1*b0+a3*b1,out[2]=a0*b2+a2*b3,out[3]=a1*b2+a3*b3,out[4]=a0*b4+a2*b5+a4,out[5]=a1*b4+a3*b5+a5,out}function subtract$5(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out}var mat2d=Object.freeze({__proto__:null,create:function(){var out=new ARRAY_TYPE(6);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[4]=0,out[5]=0),out[0]=1,out[3]=1,out},clone:function(a){var out=new ARRAY_TYPE(6);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out},identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out},fromValues:function(a,b,c,d,tx,ty){var out=new ARRAY_TYPE(6);return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},set:function(out,a,b,c,d,tx,ty){return out[0]=a,out[1]=b,out[2]=c,out[3]=d,out[4]=tx,out[5]=ty,out},invert:function(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3],atx=a[4],aty=a[5],det=aa*ad-ab*ac;return det?(out[0]=ad*(det=1/det),out[1]=-ab*det,out[2]=-ac*det,out[3]=aa*det,out[4]=(ac*aty-ad*atx)*det,out[5]=(ab*atx-aa*aty)*det,out):null},determinant:function(a){return a[0]*a[3]-a[1]*a[2]},multiply:multiply$7,rotate:function(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],s=Math.sin(rad),c=Math.cos(rad);return out[0]=a0*c+a2*s,out[1]=a1*c+a3*s,out[2]=a0*-s+a2*c,out[3]=a1*-s+a3*c,out[4]=a4,out[5]=a5,out},scale:function(out,a,v){var a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a[0]*v0,out[1]=a1*v0,out[2]=a2*v1,out[3]=a3*v1,out[4]=a4,out[5]=a5,out},translate:function(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],v0=v[0],v1=v[1];return out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=a0*v0+a2*v1+a4,out[5]=a1*v0+a3*v1+a5,out},fromRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=-s,out[3]=c,out[4]=0,out[5]=0,out},fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=v[1],out[4]=0,out[5]=0,out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=1,out[4]=v[0],out[5]=v[1],out},str:function(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+1)},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out},subtract:subtract$5,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))},mul:multiply$7,sub:subtract$5});function create$6(){var out=new ARRAY_TYPE(9);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[5]=0,out[6]=0,out[7]=0),out[0]=1,out[4]=1,out[8]=1,out}function fromMat4$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[4],out[4]=a[5],out[5]=a[6],out[6]=a[8],out[7]=a[9],out[8]=a[10],out}function set$6(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out}function transpose$1(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3],out[2]=a[6],out[3]=a01,out[5]=a[7],out[6]=a02,out[7]=a12}else out[0]=a[0],out[1]=a[3],out[2]=a[6],out[3]=a[1],out[4]=a[4],out[5]=a[7],out[6]=a[2],out[7]=a[5],out[8]=a[8];return out}function invert$3(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;return det?(out[0]=b01*(det=1/det),out[1]=(-a22*a01+a02*a21)*det,out[2]=(a12*a01-a02*a11)*det,out[3]=b11*det,out[4]=(a22*a00-a02*a20)*det,out[5]=(-a12*a00+a02*a10)*det,out[6]=b21*det,out[7]=(-a21*a00+a01*a20)*det,out[8]=(a11*a00-a01*a10)*det,out):null}function multiply$6(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];return out[0]=b00*a00+b01*a10+b02*a20,out[1]=b00*a01+b01*a11+b02*a21,out[2]=b00*a02+b01*a12+b02*a22,out[3]=b10*a00+b11*a10+b12*a20,out[4]=b10*a01+b11*a11+b12*a21,out[5]=b10*a02+b11*a12+b12*a22,out[6]=b20*a00+b21*a10+b22*a20,out[7]=b20*a01+b21*a11+b22*a21,out[8]=b20*a02+b21*a12+b22*a22,out}function fromRotation$2(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=-s,out[4]=c,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out}function fromQuat$1(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[3]=yx-wz,out[6]=zx+wy,out[1]=yx+wz,out[4]=1-xx-zz,out[7]=zy-wx,out[2]=zx-wy,out[5]=zy+wx,out[8]=1-xx-yy,out}function subtract$4(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out}var mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:function(a){var out=new ARRAY_TYPE(9);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},copy:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromValues:function(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m10,out[4]=m11,out[5]=m12,out[6]=m20,out[7]=m21,out[8]=m22,out},set:set$6,identity:function(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},transpose:transpose$1,invert:invert$3,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return out[0]=a11*a22-a12*a21,out[1]=a02*a21-a01*a22,out[2]=a01*a12-a02*a11,out[3]=a12*a20-a10*a22,out[4]=a00*a22-a02*a20,out[5]=a02*a10-a00*a12,out[6]=a10*a21-a11*a20,out[7]=a01*a20-a00*a21,out[8]=a00*a11-a01*a10,out},determinant:function(a){var a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a[0]*(a22*a11-a12*a21)+a[1]*(-a22*a10+a12*a20)+a[2]*(a21*a10-a11*a20)},multiply:multiply$6,translate:function(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];return out[0]=a00,out[1]=a01,out[2]=a02,out[3]=a10,out[4]=a11,out[5]=a12,out[6]=x*a00+y*a10+a20,out[7]=x*a01+y*a11+a21,out[8]=x*a02+y*a12+a22,out},rotate:function(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);return out[0]=c*a00+s*a10,out[1]=c*a01+s*a11,out[2]=c*a02+s*a12,out[3]=c*a10-s*a00,out[4]=c*a11-s*a01,out[5]=c*a12-s*a02,out[6]=a20,out[7]=a21,out[8]=a22,out},scale:function(out,a,v){var x=v[0],y=v[1];return out[0]=x*a[0],out[1]=x*a[1],out[2]=x*a[2],out[3]=y*a[3],out[4]=y*a[4],out[5]=y*a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out},fromTranslation:function(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=1,out[5]=0,out[6]=v[0],out[7]=v[1],out[8]=1,out},fromRotation:fromRotation$2,fromScaling:function(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=v[1],out[5]=0,out[6]=0,out[7]=0,out[8]=1,out},fromMat2d:function(out,a){return out[0]=a[0],out[1]=a[1],out[2]=0,out[3]=a[2],out[4]=a[3],out[5]=0,out[6]=a[4],out[7]=a[5],out[8]=1,out},fromQuat:fromQuat$1,normalFromMat4:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a12*b08-a10*b11-a13*b07)*det,out[2]=(a10*b10-a11*b08+a13*b06)*det,out[3]=(a02*b10-a01*b11-a03*b09)*det,out[4]=(a00*b11-a02*b08+a03*b07)*det,out[5]=(a01*b08-a00*b10-a03*b06)*det,out[6]=(a31*b05-a32*b04+a33*b03)*det,out[7]=(a32*b02-a30*b05-a33*b01)*det,out[8]=(a30*b04-a31*b02+a33*b00)*det,out):null},projection:function(out,width,height){return out[0]=2/width,out[1]=0,out[2]=0,out[3]=0,out[4]=-2/height,out[5]=0,out[6]=-1,out[7]=1,out[8]=1,out},str:function(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out},subtract:subtract$4,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))},mul:multiply$6,sub:subtract$4});function create$5(){var out=new ARRAY_TYPE(16);return ARRAY_TYPE!=Float32Array&&(out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=0,out[12]=0,out[13]=0,out[14]=0),out[0]=1,out[5]=1,out[10]=1,out[15]=1,out}function copy$5(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function identity$2(out){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a01,out[6]=a[9],out[7]=a[13],out[8]=a02,out[9]=a12,out[11]=a[14],out[12]=a03,out[13]=a13,out[14]=a23}else out[0]=a[0],out[1]=a[4],out[2]=a[8],out[3]=a[12],out[4]=a[1],out[5]=a[5],out[6]=a[9],out[7]=a[13],out[8]=a[2],out[9]=a[6],out[10]=a[10],out[11]=a[14],out[12]=a[3],out[13]=a[7],out[14]=a[11],out[15]=a[15];return out}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;return det?(out[0]=(a11*b11-a12*b10+a13*b09)*(det=1/det),out[1]=(a02*b10-a01*b11-a03*b09)*det,out[2]=(a31*b05-a32*b04+a33*b03)*det,out[3]=(a22*b04-a21*b05-a23*b03)*det,out[4]=(a12*b08-a10*b11-a13*b07)*det,out[5]=(a00*b11-a02*b08+a03*b07)*det,out[6]=(a32*b02-a30*b05-a33*b01)*det,out[7]=(a20*b05-a22*b02+a23*b01)*det,out[8]=(a10*b10-a11*b08+a13*b06)*det,out[9]=(a01*b08-a00*b10-a03*b06)*det,out[10]=(a30*b04-a31*b02+a33*b00)*det,out[11]=(a21*b02-a20*b04-a23*b00)*det,out[12]=(a11*b07-a10*b09-a12*b06)*det,out[13]=(a00*b09-a01*b07+a02*b06)*det,out[14]=(a31*b01-a30*b03-a32*b00)*det,out[15]=(a20*b03-a21*b01+a22*b00)*det,out):null}function multiply$5(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return out[0]=b0*a00+b1*a10+b2*a20+b3*a30,out[1]=b0*a01+b1*a11+b2*a21+b3*a31,out[2]=b0*a02+b1*a12+b2*a22+b3*a32,out[3]=b0*a03+b1*a13+b2*a23+b3*a33,out[4]=(b0=b[4])*a00+(b1=b[5])*a10+(b2=b[6])*a20+(b3=b[7])*a30,out[5]=b0*a01+b1*a11+b2*a21+b3*a31,out[6]=b0*a02+b1*a12+b2*a22+b3*a32,out[7]=b0*a03+b1*a13+b2*a23+b3*a33,out[8]=(b0=b[8])*a00+(b1=b[9])*a10+(b2=b[10])*a20+(b3=b[11])*a30,out[9]=b0*a01+b1*a11+b2*a21+b3*a31,out[10]=b0*a02+b1*a12+b2*a22+b3*a32,out[11]=b0*a03+b1*a13+b2*a23+b3*a33,out[12]=(b0=b[12])*a00+(b1=b[13])*a10+(b2=b[14])*a20+(b3=b[15])*a30,out[13]=b0*a01+b1*a11+b2*a21+b3*a31,out[14]=b0*a02+b1*a12+b2*a22+b3*a32,out[15]=b0*a03+b1*a13+b2*a23+b3*a33,out}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2],a00=void 0,a01=void 0,a02=void 0,a03=void 0,a10=void 0,a11=void 0,a12=void 0,a13=void 0,a20=void 0,a21=void 0,a22=void 0,a23=void 0;return a===out?(out[12]=a[0]*x+a[4]*y+a[8]*z+a[12],out[13]=a[1]*x+a[5]*y+a[9]*z+a[13],out[14]=a[2]*x+a[6]*y+a[10]*z+a[14],out[15]=a[3]*x+a[7]*y+a[11]*z+a[15]):(a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],out[0]=a00=a[0],out[1]=a01,out[2]=a02,out[3]=a03,out[4]=a10,out[5]=a11,out[6]=a12,out[7]=a13,out[8]=a20,out[9]=a21,out[10]=a22,out[11]=a23,out[12]=a00*x+a10*y+a20*z+a[12],out[13]=a01*x+a11*y+a21*z+a[13],out[14]=a02*x+a12*y+a22*z+a[14],out[15]=a03*x+a13*y+a23*z+a[15]),out}function scale$5(out,a,v){var x=v[0],y=v[1],z=v[2];return out[0]=a[0]*x,out[1]=a[1]*x,out[2]=a[2]*x,out[3]=a[3]*x,out[4]=a[4]*y,out[5]=a[5]*y,out[6]=a[6]*y,out[7]=a[7]*y,out[8]=a[8]*z,out[9]=a[9]*z,out[10]=a[10]*z,out[11]=a[11]*z,out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out}function rotate$1(out,a,rad,axis){var s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),a01=a[1],a02=a[2],a03=a[3],a11=a[5],a12=a[6],a13=a[7],a21=a[9],a22=a[10],a23=a[11],b10=x*y*(t=1-c)-z*s,b11=y*y*t+c,b12=z*y*t+x*s,b20=x*z*t+y*s,b21=y*z*t-x*s,b22=z*z*t+c,out[0]=(a00=a[0])*(b00=x*x*t+c)+(a10=a[4])*(b01=y*x*t+z*s)+(a20=a[8])*(b02=z*x*t-y*s),out[1]=a01*b00+a11*b01+a21*b02,out[2]=a02*b00+a12*b01+a22*b02,out[3]=a03*b00+a13*b01+a23*b02,out[4]=a00*b10+a10*b11+a20*b12,out[5]=a01*b10+a11*b11+a21*b12,out[6]=a02*b10+a12*b11+a22*b12,out[7]=a03*b10+a13*b11+a23*b12,out[8]=a00*b20+a10*b21+a20*b22,out[9]=a01*b20+a11*b21+a21*b22,out[10]=a02*b20+a12*b21+a22*b22,out[11]=a03*b20+a13*b21+a23*b22,a!==out&&(out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out)}function fromTranslation$1(out,v){return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromScaling(out,v){return out[0]=v[0],out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=v[1],out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=v[2],out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function fromRotation$1(out,rad,axis){var s,c,t,x=axis[0],y=axis[1],z=axis[2],len=Math.sqrt(x*x+y*y+z*z);return len<EPSILON?null:(x*=len=1/len,y*=len,z*=len,s=Math.sin(rad),c=Math.cos(rad),out[0]=x*x*(t=1-c)+c,out[1]=y*x*t+z*s,out[2]=z*x*t-y*s,out[3]=0,out[4]=x*y*t-z*s,out[5]=y*y*t+c,out[6]=z*y*t+x*s,out[7]=0,out[8]=x*z*t+y*s,out[9]=y*z*t-x*s,out[10]=z*z*t+c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out)}function fromRotationTranslation$1(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-(yy+zz),out[1]=xy+wz,out[2]=xz-wy,out[3]=0,out[4]=xy-wz,out[5]=1-(xx+zz),out[6]=yz+wx,out[7]=0,out[8]=xz+wy,out[9]=yz-wx,out[10]=1-(xx+yy),out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function getTranslation$1(out,mat){return out[0]=mat[12],out[1]=mat[13],out[2]=mat[14],out}function getScaling(out,mat){var m11=mat[0],m12=mat[1],m13=mat[2],m21=mat[4],m22=mat[5],m23=mat[6],m31=mat[8],m32=mat[9],m33=mat[10];return out[0]=Math.sqrt(m11*m11+m12*m12+m13*m13),out[1]=Math.sqrt(m21*m21+m22*m22+m23*m23),out[2]=Math.sqrt(m31*m31+m32*m32+m33*m33),out}function getRotation(out,mat){var trace=mat[0]+mat[5]+mat[10],S=0;return trace>0?(S=2*Math.sqrt(trace+1),out[3]=.25*S,out[0]=(mat[6]-mat[9])/S,out[1]=(mat[8]-mat[2])/S,out[2]=(mat[1]-mat[4])/S):mat[0]>mat[5]&&mat[0]>mat[10]?(S=2*Math.sqrt(1+mat[0]-mat[5]-mat[10]),out[3]=(mat[6]-mat[9])/S,out[0]=.25*S,out[1]=(mat[1]+mat[4])/S,out[2]=(mat[8]+mat[2])/S):mat[5]>mat[10]?(S=2*Math.sqrt(1+mat[5]-mat[0]-mat[10]),out[3]=(mat[8]-mat[2])/S,out[0]=(mat[1]+mat[4])/S,out[1]=.25*S,out[2]=(mat[6]+mat[9])/S):(S=2*Math.sqrt(1+mat[10]-mat[0]-mat[5]),out[3]=(mat[1]-mat[4])/S,out[0]=(mat[8]+mat[2])/S,out[1]=(mat[6]+mat[9])/S,out[2]=.25*S),out}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2];return out[0]=(1-(yy+zz))*sx,out[1]=(xy+wz)*sx,out[2]=(xz-wy)*sx,out[3]=0,out[4]=(xy-wz)*sy,out[5]=(1-(xx+zz))*sy,out[6]=(yz+wx)*sy,out[7]=0,out[8]=(xz+wy)*sz,out[9]=(yz-wx)*sz,out[10]=(1-(xx+yy))*sz,out[11]=0,out[12]=v[0],out[13]=v[1],out[14]=v[2],out[15]=1,out}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,yx=y*x2,yy=y*y2,zx=z*x2,zy=z*y2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;return out[0]=1-yy-zz,out[1]=yx+wz,out[2]=zx-wy,out[3]=0,out[4]=yx-wz,out[5]=1-xx-zz,out[6]=zy+wx,out[7]=0,out[8]=zx+wy,out[9]=zy-wx,out[10]=1-xx-yy,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out}function perspective(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2),nf=void 0;return out[0]=f/aspect,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=f,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[11]=-1,out[12]=0,out[13]=0,out[15]=0,null!=far&&far!==1/0?(out[10]=(far+near)*(nf=1/(near-far)),out[14]=2*far*near*nf):(out[10]=-1,out[14]=-2*near),out}function ortho(out,left,right,bottom,top,near,far){var lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);return out[0]=-2*lr,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=-2*bt,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=2*nf,out[11]=0,out[12]=(left+right)*lr,out[13]=(top+bottom)*bt,out[14]=(far+near)*nf,out[15]=1,out}function lookAt(out,eye,center,up){var x0=void 0,x1=void 0,x2=void 0,y0=void 0,y1=void 0,y2=void 0,z0=void 0,z1=void 0,z2=void 0,len=void 0,eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],centerx=center[0],centery=center[1],centerz=center[2];return Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON?identity$2(out):(z0=eyex-centerx,z1=eyey-centery,z2=eyez-centerz,x0=upy*(z2*=len=1/Math.sqrt(z0*z0+z1*z1+z2*z2))-upz*(z1*=len),x1=upz*(z0*=len)-upx*z2,x2=upx*z1-upy*z0,(len=Math.sqrt(x0*x0+x1*x1+x2*x2))?(x0*=len=1/len,x1*=len,x2*=len):(x0=0,x1=0,x2=0),y0=z1*x2-z2*x1,y1=z2*x0-z0*x2,y2=z0*x1-z1*x0,(len=Math.sqrt(y0*y0+y1*y1+y2*y2))?(y0*=len=1/len,y1*=len,y2*=len):(y0=0,y1=0,y2=0),out[0]=x0,out[1]=y0,out[2]=z0,out[3]=0,out[4]=x1,out[5]=y1,out[6]=z1,out[7]=0,out[8]=x2,out[9]=y2,out[10]=z2,out[11]=0,out[12]=-(x0*eyex+x1*eyey+x2*eyez),out[13]=-(y0*eyex+y1*eyey+y2*eyez),out[14]=-(z0*eyex+z1*eyey+z2*eyez),out[15]=1,out)}function subtract$3(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out[4]=a[4]-b[4],out[5]=a[5]-b[5],out[6]=a[6]-b[6],out[7]=a[7]-b[7],out[8]=a[8]-b[8],out[9]=a[9]-b[9],out[10]=a[10]-b[10],out[11]=a[11]-b[11],out[12]=a[12]-b[12],out[13]=a[13]-b[13],out[14]=a[14]-b[14],out[15]=a[15]-b[15],out}function exactEquals$5(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15]}var mul$5=multiply$5,mat4=Object.freeze({__proto__:null,create:create$5,clone:function(a){var out=new ARRAY_TYPE(16);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15],out},copy:copy$5,fromValues:function(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},set:function(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){return out[0]=m00,out[1]=m01,out[2]=m02,out[3]=m03,out[4]=m10,out[5]=m11,out[6]=m12,out[7]=m13,out[8]=m20,out[9]=m21,out[10]=m22,out[11]=m23,out[12]=m30,out[13]=m31,out[14]=m32,out[15]=m33,out},identity:identity$2,transpose,invert:invert$2,adjoint:function(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return out[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22),out[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22)),out[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12),out[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12)),out[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22)),out[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22),out[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12)),out[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12),out[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21),out[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21)),out[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11),out[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11)),out[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21)),out[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21),out[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11)),out[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11),out},determinant:function(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];return(a00*a11-a01*a10)*(a22*a33-a23*a32)-(a00*a12-a02*a10)*(a21*a33-a23*a31)+(a00*a13-a03*a10)*(a21*a32-a22*a31)+(a01*a12-a02*a11)*(a20*a33-a23*a30)-(a01*a13-a03*a11)*(a20*a32-a22*a30)+(a02*a13-a03*a12)*(a20*a31-a21*a30)},multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[4]=a10*c+a20*s,out[5]=a11*c+a21*s,out[6]=a12*c+a22*s,out[7]=a13*c+a23*s,out[8]=a20*c-a10*s,out[9]=a21*c-a11*s,out[10]=a22*c-a12*s,out[11]=a23*c-a13*s,out},rotateY:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];return a!==out&&(out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c-a20*s,out[1]=a01*c-a21*s,out[2]=a02*c-a22*s,out[3]=a03*c-a23*s,out[8]=a00*s+a20*c,out[9]=a01*s+a21*c,out[10]=a02*s+a22*c,out[11]=a03*s+a23*c,out},rotateZ:function(out,a,rad){var s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];return a!==out&&(out[8]=a[8],out[9]=a[9],out[10]=a[10],out[11]=a[11],out[12]=a[12],out[13]=a[13],out[14]=a[14],out[15]=a[15]),out[0]=a00*c+a10*s,out[1]=a01*c+a11*s,out[2]=a02*c+a12*s,out[3]=a03*c+a13*s,out[4]=a10*c-a00*s,out[5]=a11*c-a01*s,out[6]=a12*c-a02*s,out[7]=a13*c-a03*s,out},fromTranslation:fromTranslation$1,fromScaling,fromRotation:fromRotation$1,fromXRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=1,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=c,out[6]=s,out[7]=0,out[8]=0,out[9]=-s,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromYRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=0,out[2]=-s,out[3]=0,out[4]=0,out[5]=1,out[6]=0,out[7]=0,out[8]=s,out[9]=0,out[10]=c,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromZRotation:function(out,rad){var s=Math.sin(rad),c=Math.cos(rad);return out[0]=c,out[1]=s,out[2]=0,out[3]=0,out[4]=-s,out[5]=c,out[6]=0,out[7]=0,out[8]=0,out[9]=0,out[10]=1,out[11]=0,out[12]=0,out[13]=0,out[14]=0,out[15]=1,out},fromRotationTranslation:fromRotationTranslation$1,fromQuat2:function(out,a){var translation=new ARRAY_TYPE(3),bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],magnitude=bx*bx+by*by+bz*bz+bw*bw;return magnitude>0?(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by)/magnitude,translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz)/magnitude,translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)/magnitude):(translation[0]=2*(ax*bw+aw*bx+ay*bz-az*by),translation[1]=2*(ay*bw+aw*by+az*bx-ax*bz),translation[2]=2*(az*bw+aw*bz+ax*by-ay*bx)),fromRotationTranslation$1(out,a,translation),out},getTranslation:getTranslation$1,getScaling,getRotation,fromRotationTranslationScale,fromRotationTranslationScaleOrigin:function(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3],x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,sx=s[0],sy=s[1],sz=s[2],ox=o[0],oy=o[1],oz=o[2],out0=(1-(yy+zz))*sx,out1=(xy+wz)*sx,out2=(xz-wy)*sx,out4=(xy-wz)*sy,out5=(1-(xx+zz))*sy,out6=(yz+wx)*sy,out8=(xz+wy)*sz,out9=(yz-wx)*sz,out10=(1-(xx+yy))*sz;return out[0]=out0,out[1]=out1,out[2]=out2,out[3]=0,out[4]=out4,out[5]=out5,out[6]=out6,out[7]=0,out[8]=out8,out[9]=out9,out[10]=out10,out[11]=0,out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz),out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz),out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz),out[15]=1,out},fromQuat,frustum:function(out,left,right,bottom,top,near,far){var rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);return out[0]=2*near*rl,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=2*near*tb,out[6]=0,out[7]=0,out[8]=(right+left)*rl,out[9]=(top+bottom)*tb,out[10]=(far+near)*nf,out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near*2*nf,out[15]=0,out},perspective,perspectiveFromFieldOfView:function(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180),downTan=Math.tan(fov.downDegrees*Math.PI/180),leftTan=Math.tan(fov.leftDegrees*Math.PI/180),rightTan=Math.tan(fov.rightDegrees*Math.PI/180),xScale=2/(leftTan+rightTan),yScale=2/(upTan+downTan);return out[0]=xScale,out[1]=0,out[2]=0,out[3]=0,out[4]=0,out[5]=yScale,out[6]=0,out[7]=0,out[8]=-(leftTan-rightTan)*xScale*.5,out[9]=(upTan-downTan)*yScale*.5,out[10]=far/(near-far),out[11]=-1,out[12]=0,out[13]=0,out[14]=far*near/(near-far),out[15]=0,out},ortho,lookAt,targetTo:function(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2],z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2],len=z0*z0+z1*z1+z2*z2;len>0&&(z0*=len=1/Math.sqrt(len),z1*=len,z2*=len);var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;return(len=x0*x0+x1*x1+x2*x2)>0&&(x0*=len=1/Math.sqrt(len),x1*=len,x2*=len),out[0]=x0,out[1]=x1,out[2]=x2,out[3]=0,out[4]=z1*x2-z2*x1,out[5]=z2*x0-z0*x2,out[6]=z0*x1-z1*x0,out[7]=0,out[8]=z0,out[9]=z1,out[10]=z2,out[11]=0,out[12]=eyex,out[13]=eyey,out[14]=eyez,out[15]=1,out},str:function(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"},frob:function(a){return Math.sqrt(Math.pow(a[0],2)+Math.pow(a[1],2)+Math.pow(a[2],2)+Math.pow(a[3],2)+Math.pow(a[4],2)+Math.pow(a[5],2)+Math.pow(a[6],2)+Math.pow(a[7],2)+Math.pow(a[8],2)+Math.pow(a[9],2)+Math.pow(a[10],2)+Math.pow(a[11],2)+Math.pow(a[12],2)+Math.pow(a[13],2)+Math.pow(a[14],2)+Math.pow(a[15],2))},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out[8]=a[8]+b[8],out[9]=a[9]+b[9],out[10]=a[10]+b[10],out[11]=a[11]+b[11],out[12]=a[12]+b[12],out[13]=a[13]+b[13],out[14]=a[14]+b[14],out[15]=a[15]+b[15],out},subtract:subtract$3,multiplyScalar:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out[8]=a[8]*b,out[9]=a[9]*b,out[10]=a[10]*b,out[11]=a[11]*b,out[12]=a[12]*b,out[13]=a[13]*b,out[14]=a[14]*b,out[15]=a[15]*b,out},multiplyScalarAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out[4]=a[4]+b[4]*scale,out[5]=a[5]+b[5]*scale,out[6]=a[6]+b[6]*scale,out[7]=a[7]+b[7]*scale,out[8]=a[8]+b[8]*scale,out[9]=a[9]+b[9]*scale,out[10]=a[10]+b[10]*scale,out[11]=a[11]+b[11]*scale,out[12]=a[12]+b[12]*scale,out[13]=a[13]+b[13]*scale,out[14]=a[14]+b[14]*scale,out[15]=a[15]+b[15]*scale,out},exactEquals:exactEquals$5,equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8],a9=a[9],a10=a[10],a11=a[11],a12=a[12],a13=a[13],a14=a[14],a15=a[15],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8],b9=b[9],b10=b[10],b11=b[11],b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15))},mul:mul$5,sub:subtract$3});function create$4(){var out=new ARRAY_TYPE(3);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out}function length$4(a){var x=a[0],y=a[1],z=a[2];return Math.sqrt(x*x+y*y+z*z)}function fromValues$4(x,y,z){var out=new ARRAY_TYPE(3);return out[0]=x,out[1]=y,out[2]=z,out}function copy$4(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out}function set$4(out,x,y,z){return out[0]=x,out[1]=y,out[2]=z,out}function add$4(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out}function subtract$2(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out}function multiply$4(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out}function divide$2(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out}function scale$4(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out}function scaleAndAdd$2(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out}function distance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return Math.sqrt(x*x+y*y+z*z)}function squaredDistance$2(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2];return x*x+y*y+z*z}function squaredLength$4(a){var x=a[0],y=a[1],z=a[2];return x*x+y*y+z*z}function normalize$4(out,a){var x=a[0],y=a[1],z=a[2],len=x*x+y*y+z*z;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len,out[2]=a[2]*len),out}function dot$4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]}function cross$1(out,a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2];return out[0]=ay*bz-az*by,out[1]=az*bx-ax*bz,out[2]=ax*by-ay*bx,out}function transformMat4$2(out,a,m){var x=a[0],y=a[1],z=a[2],w=m[3]*x+m[7]*y+m[11]*z+m[15];return out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/(w=w||1),out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w,out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w,out}function angle$1(a,b){var tempA=fromValues$4(a[0],a[1],a[2]),tempB=fromValues$4(b[0],b[1],b[2]);normalize$4(tempA,tempA),normalize$4(tempB,tempB);var cosine=dot$4(tempA,tempB);return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)}function equals$5(a,b){var a0=a[0],a1=a[1],a2=a[2],b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))}var vec,sub$2=subtract$2,mul$4=multiply$4,div$2=divide$2,dist$2=distance$2,sqrDist$2=squaredDistance$2,len$4=length$4,sqrLen$4=squaredLength$4,forEach$2=(vec=create$4(),function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=3),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2];return a}),vec3=Object.freeze({__proto__:null,create:create$4,clone:function(a){var out=new ARRAY_TYPE(3);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out},length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out},scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out},normalize:normalize$4,dot:dot$4,cross:cross$1,lerp:function(out,a,b,t){var ax=a[0],ay=a[1],az=a[2];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out},hermite:function(out,a,b,c,d,t){var factorTimes2=t*t,factor1=factorTimes2*(2*t-3)+1,factor2=factorTimes2*(t-2)+t,factor3=factorTimes2*(t-1),factor4=factorTimes2*(3-2*t);return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},bezier:function(out,a,b,c,d,t){var inverseFactor=1-t,inverseFactorTimesTwo=inverseFactor*inverseFactor,factorTimes2=t*t,factor1=inverseFactorTimesTwo*inverseFactor,factor2=3*t*inverseFactorTimesTwo,factor3=3*factorTimes2*inverseFactor,factor4=factorTimes2*t;return out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4,out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4,out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4,out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI,z=2*RANDOM()-1,zScale=Math.sqrt(1-z*z)*scale;return out[0]=Math.cos(r)*zScale,out[1]=Math.sin(r)*zScale,out[2]=z*scale,out},transformMat4:transformMat4$2,transformMat3:function(out,a,m){var x=a[0],y=a[1],z=a[2];return out[0]=x*m[0]+y*m[3]+z*m[6],out[1]=x*m[1]+y*m[4]+z*m[7],out[2]=x*m[2]+y*m[5]+z*m[8],out},transformQuat:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],x=a[0],y=a[1],z=a[2],uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x,uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx,w2=2*q[3];return uvy*=w2,uvz*=w2,uuvy*=2,uuvz*=2,out[0]=x+(uvx*=w2)+(uuvx*=2),out[1]=y+uvy+uuvy,out[2]=z+uvz+uuvz,out},rotateX:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0],r[1]=p[1]*Math.cos(c)-p[2]*Math.sin(c),r[2]=p[1]*Math.sin(c)+p[2]*Math.cos(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateY:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[2]*Math.sin(c)+p[0]*Math.cos(c),r[1]=p[1],r[2]=p[2]*Math.cos(c)-p[0]*Math.sin(c),out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},rotateZ:function(out,a,b,c){var p=[],r=[];return p[0]=a[0]-b[0],p[1]=a[1]-b[1],p[2]=a[2]-b[2],r[0]=p[0]*Math.cos(c)-p[1]*Math.sin(c),r[1]=p[0]*Math.sin(c)+p[1]*Math.cos(c),r[2]=p[2],out[0]=r[0]+b[0],out[1]=r[1]+b[1],out[2]=r[2]+b[2],out},angle:angle$1,str:function(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]},equals:equals$5,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0,out[3]=0),out}function clone$3(a){var out=new ARRAY_TYPE(4);return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function fromValues$3(x,y,z,w){var out=new ARRAY_TYPE(4);return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function copy$3(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out}function set$3(out,x,y,z,w){return out[0]=x,out[1]=y,out[2]=z,out[3]=w,out}function add$3(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out}function subtract$1(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out[2]=a[2]-b[2],out[3]=a[3]-b[3],out}function multiply$3(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out[2]=a[2]*b[2],out[3]=a[3]*b[3],out}function divide$1(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out[2]=a[2]/b[2],out[3]=a[3]/b[3],out}function scale$3(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out}function distance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredDistance$1(a,b){var x=b[0]-a[0],y=b[1]-a[1],z=b[2]-a[2],w=b[3]-a[3];return x*x+y*y+z*z+w*w}function length$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return Math.sqrt(x*x+y*y+z*z+w*w)}function squaredLength$3(a){var x=a[0],y=a[1],z=a[2],w=a[3];return x*x+y*y+z*z+w*w}function normalize$3(out,a){var x=a[0],y=a[1],z=a[2],w=a[3],len=x*x+y*y+z*z+w*w;return len>0&&(len=1/Math.sqrt(len),out[0]=x*len,out[1]=y*len,out[2]=z*len,out[3]=w*len),out}function dot$3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]}function lerp$3(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out[2]=az+t*(b[2]-az),out[3]=aw+t*(b[3]-aw),out}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];return out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w,out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w,out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w,out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w,out}function exactEquals$3(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]}function equals$4(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))}var sub$1=subtract$1,mul$3=multiply$3,div$1=divide$1,dist$1=distance$1,sqrDist$1=squaredDistance$1,len$3=length$3,sqrLen$3=squaredLength$3,forEach$1=function(){var vec=create$3();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=4),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],vec[2]=a[i+2],vec[3]=a[i+3],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1],a[i+2]=vec[2],a[i+3]=vec[3];return a}}(),vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out[2]=Math.ceil(a[2]),out[3]=Math.ceil(a[3]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out[2]=Math.floor(a[2]),out[3]=Math.floor(a[3]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out[2]=Math.min(a[2],b[2]),out[3]=Math.min(a[3],b[3]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out[2]=Math.max(a[2],b[2]),out[3]=Math.max(a[3],b[3]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out[2]=Math.round(a[2]),out[3]=Math.round(a[3]),out},scale:scale$3,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out[2]=a[2]+b[2]*scale,out[3]=a[3]+b[3]*scale,out},distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=-a[3],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out[2]=1/a[2],out[3]=1/a[3],out},normalize:normalize$3,dot:dot$3,lerp:lerp$3,random:function(out,scale){var v1,v2,v3,v4,s1,s2;scale=scale||1;do{s1=(v1=2*RANDOM()-1)*v1+(v2=2*RANDOM()-1)*v2}while(s1>=1);do{s2=(v3=2*RANDOM()-1)*v3+(v4=2*RANDOM()-1)*v4}while(s2>=1);var d=Math.sqrt((1-s1)/s2);return out[0]=scale*v1,out[1]=scale*v2,out[2]=scale*v3*d,out[3]=scale*v4*d,out},transformMat4:transformMat4$1,transformQuat:function(out,a,q){var x=a[0],y=a[1],z=a[2],qx=q[0],qy=q[1],qz=q[2],qw=q[3],ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;return out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy,out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz,out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx,out[3]=a[3],out},str:function(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},exactEquals:exactEquals$3,equals:equals$4,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var out=new ARRAY_TYPE(4);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0,out[2]=0),out[3]=1,out}function identity$1(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out}function setAxisAngle(out,axis,rad){rad*=.5;var s=Math.sin(rad);return out[0]=s*axis[0],out[1]=s*axis[1],out[2]=s*axis[2],out[3]=Math.cos(rad),out}function multiply$2(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3];return out[0]=ax*bw+aw*bx+ay*bz-az*by,out[1]=ay*bw+aw*by+az*bx-ax*bz,out[2]=az*bw+aw*bz+ax*by-ay*bx,out[3]=aw*bw-ax*bx-ay*by-az*bz,out}function rotateX$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+aw*bx,out[1]=ay*bw+az*bx,out[2]=az*bw-ay*bx,out[3]=aw*bw-ax*bx,out}function rotateY$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],by=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw-az*by,out[1]=ay*bw+aw*by,out[2]=az*bw+ax*by,out[3]=aw*bw-ay*by,out}function rotateZ$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3],bz=Math.sin(rad),bw=Math.cos(rad);return out[0]=ax*bw+ay*bz,out[1]=ay*bw-ax*bz,out[2]=az*bw+aw*bz,out[3]=aw*bw-az*bz,out}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3],bx=b[0],by=b[1],bz=b[2],bw=b[3],omega=void 0,cosom=void 0,sinom=void 0,scale0=void 0,scale1=void 0;return(cosom=ax*bx+ay*by+az*bz+aw*bw)<0&&(cosom=-cosom,bx=-bx,by=-by,bz=-bz,bw=-bw),1-cosom>EPSILON?(omega=Math.acos(cosom),sinom=Math.sin(omega),scale0=Math.sin((1-t)*omega)/sinom,scale1=Math.sin(t*omega)/sinom):(scale0=1-t,scale1=t),out[0]=scale0*ax+scale1*bx,out[1]=scale0*ay+scale1*by,out[2]=scale0*az+scale1*bz,out[3]=scale0*aw+scale1*bw,out}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8],fRoot=void 0;if(fTrace>0)fRoot=Math.sqrt(fTrace+1),out[3]=.5*fRoot,out[0]=(m[5]-m[7])*(fRoot=.5/fRoot),out[1]=(m[6]-m[2])*fRoot,out[2]=(m[1]-m[3])*fRoot;else{var i=0;m[4]>m[0]&&(i=1),m[8]>m[3*i+i]&&(i=2);var j=(i+1)%3,k=(i+2)%3;fRoot=Math.sqrt(m[3*i+i]-m[3*j+j]-m[3*k+k]+1),out[i]=.5*fRoot,out[3]=(m[3*j+k]-m[3*k+j])*(fRoot=.5/fRoot),out[j]=(m[3*j+i]+m[3*i+j])*fRoot,out[k]=(m[3*k+i]+m[3*i+k])*fRoot}return out}function fromEuler(out,x,y,z){var halfToRad=.5*Math.PI/180;x*=halfToRad,y*=halfToRad,z*=halfToRad;var sx=Math.sin(x),cx=Math.cos(x),sy=Math.sin(y),cy=Math.cos(y),sz=Math.sin(z),cz=Math.cos(z);return out[0]=sx*cy*cz-cx*sy*sz,out[1]=cx*sy*cz+sx*cy*sz,out[2]=cx*cy*sz-sx*sy*cz,out[3]=cx*cy*cz+sx*sy*sz,out}var tmpvec3,xUnitVec3,yUnitVec3,temp1,temp2,matr,clone$2=clone$3,fromValues$2=fromValues$3,copy$2=copy$3,set$2=set$3,add$2=add$3,mul$2=multiply$2,scale$2=scale$3,dot$2=dot$3,lerp$2=lerp$3,length$2=length$3,len$2=length$2,squaredLength$2=squaredLength$3,sqrLen$2=squaredLength$2,normalize$2=normalize$3,exactEquals$2=exactEquals$3,equals$3=equals$4,rotationTo=(tmpvec3=create$4(),xUnitVec3=fromValues$4(1,0,0),yUnitVec3=fromValues$4(0,1,0),function(out,a,b){var dot=dot$4(a,b);return dot<-.999999?(cross$1(tmpvec3,xUnitVec3,a),len$4(tmpvec3)<1e-6&&cross$1(tmpvec3,yUnitVec3,a),normalize$4(tmpvec3,tmpvec3),setAxisAngle(out,tmpvec3,Math.PI),out):dot>.999999?(out[0]=0,out[1]=0,out[2]=0,out[3]=1,out):(cross$1(tmpvec3,a,b),out[0]=tmpvec3[0],out[1]=tmpvec3[1],out[2]=tmpvec3[2],out[3]=1+dot,normalize$2(out,out))}),sqlerp=(temp1=create$2(),temp2=create$2(),function(out,a,b,c,d,t){return slerp(temp1,a,d,t),slerp(temp2,b,c,t),slerp(out,temp1,temp2,2*t*(1-t)),out}),setAxes=(matr=create$6(),function(out,view,right,up){return matr[0]=right[0],matr[3]=right[1],matr[6]=right[2],matr[1]=up[0],matr[4]=up[1],matr[7]=up[2],matr[2]=-view[0],matr[5]=-view[1],matr[8]=-view[2],normalize$2(out,fromMat3(out,matr))}),quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle,getAxisAngle:function(out_axis,q){var rad=2*Math.acos(q[3]),s=Math.sin(rad/2);return s>EPSILON?(out_axis[0]=q[0]/s,out_axis[1]=q[1]/s,out_axis[2]=q[2]/s):(out_axis[0]=1,out_axis[1]=0,out_axis[2]=0),rad},multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:function(out,a){var x=a[0],y=a[1],z=a[2];return out[0]=x,out[1]=y,out[2]=z,out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z)),out},slerp,random:function(out){var u1=RANDOM(),u2=RANDOM(),u3=RANDOM(),sqrt1MinusU1=Math.sqrt(1-u1),sqrtU1=Math.sqrt(u1);return out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2),out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2),out[2]=sqrtU1*Math.sin(2*Math.PI*u3),out[3]=sqrtU1*Math.cos(2*Math.PI*u3),out},invert:function(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;return out[0]=-a0*invDot,out[1]=-a1*invDot,out[2]=-a2*invDot,out[3]=a3*invDot,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out},fromMat3,fromEuler,str:function(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")"},clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$3,rotationTo,sqlerp,setAxes});function fromRotationTranslation(out,q,t){var ax=.5*t[0],ay=.5*t[1],az=.5*t[2],bx=q[0],by=q[1],bz=q[2],bw=q[3];return out[0]=bx,out[1]=by,out[2]=bz,out[3]=bw,out[4]=ax*bw+ay*bz-az*by,out[5]=ay*bw+az*bx-ax*bz,out[6]=az*bw+ax*by-ay*bx,out[7]=-ax*bx-ay*by-az*bz,out}function copy$1(out,a){return out[0]=a[0],out[1]=a[1],out[2]=a[2],out[3]=a[3],out[4]=a[4],out[5]=a[5],out[6]=a[6],out[7]=a[7],out}function multiply$1(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];return out[0]=ax0*bw0+aw0*bx0+ay0*bz0-az0*by0,out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0,out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0,out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0,out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0,out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0,out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0,out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0,out}var dot$1=dot$2;var squaredLength$1=squaredLength$2;var quat2=Object.freeze({__proto__:null,create:function(){var dq=new ARRAY_TYPE(8);return ARRAY_TYPE!=Float32Array&&(dq[0]=0,dq[1]=0,dq[2]=0,dq[4]=0,dq[5]=0,dq[6]=0,dq[7]=0),dq[3]=1,dq},clone:function(a){var dq=new ARRAY_TYPE(8);return dq[0]=a[0],dq[1]=a[1],dq[2]=a[2],dq[3]=a[3],dq[4]=a[4],dq[5]=a[5],dq[6]=a[6],dq[7]=a[7],dq},fromValues:function(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new ARRAY_TYPE(8);return dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1,dq[4]=x2,dq[5]=y2,dq[6]=z2,dq[7]=w2,dq},fromRotationTranslationValues:function(x1,y1,z1,w1,x2,y2,z2){var dq=new ARRAY_TYPE(8);dq[0]=x1,dq[1]=y1,dq[2]=z1,dq[3]=w1;var ax=.5*x2,ay=.5*y2,az=.5*z2;return dq[4]=ax*w1+ay*z1-az*y1,dq[5]=ay*w1+az*x1-ax*z1,dq[6]=az*w1+ax*y1-ay*x1,dq[7]=-ax*x1-ay*y1-az*z1,dq},fromRotationTranslation,fromTranslation:function(out,t){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=.5*t[0],out[5]=.5*t[1],out[6]=.5*t[2],out[7]=0,out},fromRotation:function(out,q){return out[0]=q[0],out[1]=q[1],out[2]=q[2],out[3]=q[3],out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},fromMat4:function(out,a){var outer=create$2();getRotation(outer,a);var t=new ARRAY_TYPE(3);return getTranslation$1(t,a),fromRotationTranslation(out,outer,t),out},copy:copy$1,identity:function(out){return out[0]=0,out[1]=0,out[2]=0,out[3]=1,out[4]=0,out[5]=0,out[6]=0,out[7]=0,out},set:function(out,x1,y1,z1,w1,x2,y2,z2,w2){return out[0]=x1,out[1]=y1,out[2]=z1,out[3]=w1,out[4]=x2,out[5]=y2,out[6]=z2,out[7]=w2,out},getReal:copy$2,getDual:function(out,a){return out[0]=a[4],out[1]=a[5],out[2]=a[6],out[3]=a[7],out},setReal:copy$2,setDual:function(out,q){return out[4]=q[0],out[5]=q[1],out[6]=q[2],out[7]=q[3],out},getTranslation:function(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=-a[2],bw=a[3];return out[0]=2*(ax*bw+aw*bx+ay*bz-az*by),out[1]=2*(ay*bw+aw*by+az*bx-ax*bz),out[2]=2*(az*bw+aw*bz+ax*by-ay*bx),out},translate:function(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=.5*v[0],by1=.5*v[1],bz1=.5*v[2],ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];return out[0]=ax1,out[1]=ay1,out[2]=az1,out[3]=aw1,out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2,out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2,out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2,out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2,out},rotateX:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateX$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateY:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateY$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateZ:function(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;return rotateZ$1(out,a,rad),out[4]=ax1*(bw=out[3])+aw1*(bx=out[0])+ay1*(bz=out[2])-az1*(by=out[1]),out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz,out},rotateByQuatAppend:function(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];return out[0]=ax*qw+aw*qx+ay*qz-az*qy,out[1]=ay*qw+aw*qy+az*qx-ax*qz,out[2]=az*qw+aw*qz+ax*qy-ay*qx,out[3]=aw*qw-ax*qx-ay*qy-az*qz,out[4]=(ax=a[4])*qw+(aw=a[7])*qx+(ay=a[5])*qz-(az=a[6])*qy,out[5]=ay*qw+aw*qy+az*qx-ax*qz,out[6]=az*qw+aw*qz+ax*qy-ay*qx,out[7]=aw*qw-ax*qx-ay*qy-az*qz,out},rotateByQuatPrepend:function(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];return out[0]=qx*bw+qw*bx+qy*bz-qz*by,out[1]=qy*bw+qw*by+qz*bx-qx*bz,out[2]=qz*bw+qw*bz+qx*by-qy*bx,out[3]=qw*bw-qx*bx-qy*by-qz*bz,out[4]=qx*(bw=a[7])+qw*(bx=a[4])+qy*(bz=a[6])-qz*(by=a[5]),out[5]=qy*bw+qw*by+qz*bx-qx*bz,out[6]=qz*bw+qw*bz+qx*by-qy*bx,out[7]=qw*bw-qx*bx-qy*by-qz*bz,out},rotateAroundAxis:function(out,a,axis,rad){if(Math.abs(rad)<EPSILON)return copy$1(out,a);var axisLength=Math.sqrt(axis[0]*axis[0]+axis[1]*axis[1]+axis[2]*axis[2]);rad*=.5;var s=Math.sin(rad),bx=s*axis[0]/axisLength,by=s*axis[1]/axisLength,bz=s*axis[2]/axisLength,bw=Math.cos(rad),ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by,out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz,out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx,out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],aw=a[7];return out[4]=ax*bw+aw*bx+ay*bz-az*by,out[5]=ay*bw+aw*by+az*bx-ax*bz,out[6]=az*bw+aw*bz+ax*by-ay*bx,out[7]=aw*bw-ax*bx-ay*by-az*bz,out},add:function(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out[2]=a[2]+b[2],out[3]=a[3]+b[3],out[4]=a[4]+b[4],out[5]=a[5]+b[5],out[6]=a[6]+b[6],out[7]=a[7]+b[7],out},multiply:multiply$1,mul:multiply$1,scale:function(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out[2]=a[2]*b,out[3]=a[3]*b,out[4]=a[4]*b,out[5]=a[5]*b,out[6]=a[6]*b,out[7]=a[7]*b,out},dot:dot$1,lerp:function(out,a,b,t){var mt=1-t;return dot$1(a,b)<0&&(t=-t),out[0]=a[0]*mt+b[0]*t,out[1]=a[1]*mt+b[1]*t,out[2]=a[2]*mt+b[2]*t,out[3]=a[3]*mt+b[3]*t,out[4]=a[4]*mt+b[4]*t,out[5]=a[5]*mt+b[5]*t,out[6]=a[6]*mt+b[6]*t,out[7]=a[7]*mt+b[7]*t,out},invert:function(out,a){var sqlen=squaredLength$1(a);return out[0]=-a[0]/sqlen,out[1]=-a[1]/sqlen,out[2]=-a[2]/sqlen,out[3]=a[3]/sqlen,out[4]=-a[4]/sqlen,out[5]=-a[5]/sqlen,out[6]=-a[6]/sqlen,out[7]=a[7]/sqlen,out},conjugate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out[2]=-a[2],out[3]=a[3],out[4]=-a[4],out[5]=-a[5],out[6]=-a[6],out[7]=a[7],out},length:length$2,len:length$2,squaredLength:squaredLength$1,sqrLen:squaredLength$1,normalize:function(out,a){var magnitude=squaredLength$1(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude,a1=a[1]/magnitude,a2=a[2]/magnitude,a3=a[3]/magnitude,b0=a[4],b1=a[5],b2=a[6],b3=a[7],a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0,out[1]=a1,out[2]=a2,out[3]=a3,out[4]=(b0-a0*a_dot_b)/magnitude,out[5]=(b1-a1*a_dot_b)/magnitude,out[6]=(b2-a2*a_dot_b)/magnitude,out[7]=(b3-a3*a_dot_b)/magnitude}return out},str:function(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]},equals:function(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))}});function create(){var out=new ARRAY_TYPE(2);return ARRAY_TYPE!=Float32Array&&(out[0]=0,out[1]=0),out}function copy(out,a){return out[0]=a[0],out[1]=a[1],out}function set(out,x,y){return out[0]=x,out[1]=y,out}function add(out,a,b){return out[0]=a[0]+b[0],out[1]=a[1]+b[1],out}function subtract(out,a,b){return out[0]=a[0]-b[0],out[1]=a[1]-b[1],out}function multiply(out,a,b){return out[0]=a[0]*b[0],out[1]=a[1]*b[1],out}function divide(out,a,b){return out[0]=a[0]/b[0],out[1]=a[1]/b[1],out}function scale(out,a,b){return out[0]=a[0]*b,out[1]=a[1]*b,out}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.sqrt(x*x+y*y)}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y}function length(a){var x=a[0],y=a[1];return Math.sqrt(x*x+y*y)}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y}function transformMat2(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y,out[1]=m[1]*x+m[3]*y,out}function rotate(out,a,b,c){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(c),cosC=Math.cos(c);return out[0]=p0*cosC-p1*sinC+b[0],out[1]=p0*sinC+p1*cosC+b[1],out}var len=length,sub=subtract,mul=multiply,div=divide,dist=distance,sqrDist=squaredDistance,sqrLen=squaredLength,forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i=void 0,l=void 0;for(stride||(stride=2),offset||(offset=0),l=count?Math.min(count*stride+offset,a.length):a.length,i=offset;i<l;i+=stride)vec[0]=a[i],vec[1]=a[i+1],fn(vec,vec,arg),a[i]=vec[0],a[i+1]=vec[1];return a}}(),vec2=Object.freeze({__proto__:null,create,clone:function(a){var out=new ARRAY_TYPE(2);return out[0]=a[0],out[1]=a[1],out},fromValues:function(x,y){var out=new ARRAY_TYPE(2);return out[0]=x,out[1]=y,out},copy,set,add,subtract,multiply,divide,ceil:function(out,a){return out[0]=Math.ceil(a[0]),out[1]=Math.ceil(a[1]),out},floor:function(out,a){return out[0]=Math.floor(a[0]),out[1]=Math.floor(a[1]),out},min:function(out,a,b){return out[0]=Math.min(a[0],b[0]),out[1]=Math.min(a[1],b[1]),out},max:function(out,a,b){return out[0]=Math.max(a[0],b[0]),out[1]=Math.max(a[1],b[1]),out},round:function(out,a){return out[0]=Math.round(a[0]),out[1]=Math.round(a[1]),out},scale,scaleAndAdd:function(out,a,b,scale){return out[0]=a[0]+b[0]*scale,out[1]=a[1]+b[1]*scale,out},distance,squaredDistance,length,squaredLength,negate:function(out,a){return out[0]=-a[0],out[1]=-a[1],out},inverse:function(out,a){return out[0]=1/a[0],out[1]=1/a[1],out},normalize:function(out,a){var x=a[0],y=a[1],len=x*x+y*y;return len>0&&(len=1/Math.sqrt(len),out[0]=a[0]*len,out[1]=a[1]*len),out},dot:function(a,b){return a[0]*b[0]+a[1]*b[1]},cross:function(out,a,b){var z=a[0]*b[1]-a[1]*b[0];return out[0]=out[1]=0,out[2]=z,out},lerp:function(out,a,b,t){var ax=a[0],ay=a[1];return out[0]=ax+t*(b[0]-ax),out[1]=ay+t*(b[1]-ay),out},random:function(out,scale){scale=scale||1;var r=2*RANDOM()*Math.PI;return out[0]=Math.cos(r)*scale,out[1]=Math.sin(r)*scale,out},transformMat2,transformMat2d:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[2]*y+m[4],out[1]=m[1]*x+m[3]*y+m[5],out},transformMat3:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[3]*y+m[6],out[1]=m[1]*x+m[4]*y+m[7],out},transformMat4:function(out,a,m){var x=a[0],y=a[1];return out[0]=m[0]*x+m[4]*y+m[12],out[1]=m[1]*x+m[5]*y+m[13],out},rotate,angle:function(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1],len1=x1*x1+y1*y1;len1>0&&(len1=1/Math.sqrt(len1));var len2=x2*x2+y2*y2;len2>0&&(len2=1/Math.sqrt(len2));var cosine=(x1*x2+y1*y2)*len1*len2;return cosine>1?0:cosine<-1?Math.PI:Math.acos(cosine)},str:function(a){return"vec2("+a[0]+", "+a[1]+")"},exactEquals:function(a,b){return a[0]===b[0]&&a[1]===b[1]},equals:function(a,b){var a0=a[0],a1=a[1],b0=b[0],b1=b[1];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))},len,sub,mul,div,dist,sqrDist,sqrLen,forEach});
/*!
	 * @maptalks/gltf-loader v0.95.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2023 maptalks.org
	 */
let n$1=0;function i$3(e){return null==e}function a$1(e){return!i$3(e)}function o$1(e){return!i$3(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function f$4(e){for(let t=1;t<arguments.length;t++){const s=arguments[t];for(const t in s)e[t]=s[t]}return e}function u$4(e){switch(e){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView's component type: "+e)}function h$3(e){return 0===e.indexOf("data:")&&e.indexOf("base64,")>0}function c$2(e){const t=function(e){return"undefined"!=typeof self?self.atob(e):window.atob(e)}(e.substring(e.indexOf(",")+1)),s=t.length,r=new Uint8Array(s);for(let e=0;e<s;e++)r[e]=t.charCodeAt(e);return r.buffer}const l$2=[],m$4=[],d$3=[],g$2=[0,0,0],p$6=identity$1([]),b$6=[1,1,1];function y$5(e,t,s,r,n,i,a){const o=u$4(a);if((0===n||n===r*o.BYTES_PER_ELEMENT)&&i%o.BYTES_PER_ELEMENT==0){const n=new o(t,i,s*r);return e.set(n),e}0===n&&(n=r*o.BYTES_PER_ELEMENT);const f=new Uint8Array(r*o.BYTES_PER_ELEMENT);for(let a=0;a<s;a++){let s=null;const u=new Uint8Array(t,n*a+i,r*o.BYTES_PER_ELEMENT);f.set(u),s=new o(f.buffer,0,r);for(let t=0;t<r;t++)e[a*r+t]=s[t]}return e}const _$7="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function x$7(e,t,s){const r=new Uint8Array(e,t,s);return _$7.decode(r)}const w$5={get:function(e,t={}){t||(t={});const s=new AbortController,r=s.signal,n=f$4({},t);n.signal=r,n.method||(n.method="GET");const i=fetch(e,n).then((e=>{const s=this._parseResponse(e,t.responseType);return s.message?s:s.then((s=>"arraybuffer"===t.responseType?{data:s,cacheControl:e.headers.get("Cache-Control"),expires:e.headers.get("Expires"),contentType:e.headers.get("Content-Type")}:s)).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}))})).catch((e=>{if(!e.code||e.code!==DOMException.ABORT_ERR)throw e}));return i.xhr=s,i},_parseResponse:(e,t)=>200!==e.status?{status:e.status,statusText:e.statusText,message:`incorrect http request with status code(${e.status}): ${e.statusText}`}:"arraybuffer"===t?e.arrayBuffer():"json"===t?e.json():e.text(),getArrayBuffer:(e,t={})=>(t||(t={}),t.responseType="arraybuffer",w$5.get(e,t)),getJSON:function(e,t={}){return t&&t.jsonp?w$5.jsonp(e):((t=t||{}).responseType="json",w$5.get(e,t))},jsonp:function(e){const t="_maptalks_jsonp_"+n$1++;e.match(/\?/)?e+="&callback="+t:e+="?callback="+t;let s=document.createElement("script");return s.type="text/javascript",s.src=e,new Promise((e=>{window[t]=function(r){document.getElementsByTagName("head")[0].removeChild(s),s=null,delete window[t],e(r)},document.getElementsByTagName("head")[0].appendChild(s)}))}};class T$7{constructor(e,t,s,r){this._requestImage=e,this.decoders=t,this._supportedFormats=s,this.images={},this._imgRequests={},this._fetchOptions=r||{}}requestImageFromBufferURI(e,t,s){if(this.buffers[e.id]){const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}if(this._imgRequests[e.id])return this._imgRequests[e.id].then((()=>{const n=this._createDataView(t,this.buffers[e.id]);return this.getImageByBuffer(n,s)}));if(h$3(e.uri)){const r=this.buffers[e.id]=c$2(e.uri),n=this._createDataView(t,r);return this.getImageByBuffer(n,s)}let r;const n=e.uri.indexOf("blob:")>=0;return r=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this._imgRequests[e.id]=w$5.getArrayBuffer(r,this._fetchOptions).then((r=>{const n=this.buffers[e.id]=r.data,i=this._createDataView(t,n);return this.getImageByBuffer(i,s)}))}getImageByBuffer(e,t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const s=this.decoders;return s[t.mimeType]?s[t.mimeType](e,{supportedFormats:this._supportedFormats}):"image/crn"===t.mimeType||"image/ktx2"===t.mimeType||"image/cttf"===t.mimeType?(console.warn("missing transcoder for "+t.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this._getImageInfo(t.id,e)}requestExternalImage(e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const t=0===e.uri.indexOf("data:image/")?e.uri:this.rootPath+"/"+e.uri;return this._imgRequests[e.id]?this._imgRequests[e.id].then((()=>this.images[e.id])):this._imgRequests[e.id]=this._getImageInfo(e.id,t)}_getImageInfo(e,t){return new Promise(((s,r)=>{this._requestImage(t,this._fetchOptions,((n,i)=>{n?r(n):(URL.revokeObjectURL(t),this.images[e]=i,s(this.images[e]))}))}))}}const E$7=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],O$7=[];class I$6{constructor(e,t,s,r){this.rootPath=e,this.gltf=t,this._enableInterleave=!1,this.glbBuffer=s,this.buffers={},this.requests={},this.accessors={},this._compareAccessor(),this._fetchOptions=r}_requestData(e,t){const s=this.gltf,r=s.accessors[t];if(void 0===r.bufferView)return this.accessors[r.id]=this._toBufferData(e,t,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);return this._requestBufferOfBufferView(s.bufferViews[r.bufferView]).then((s=>{const{buffer:n,byteOffset:i}=s;return this.accessors[r.id]=this._toBufferData(e,t,n,i)}))}_requestBufferOfBufferView(e){const t=this.gltf.buffers[e.buffer];if(this.buffers[t.id]){return Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})}if(this.requests[t.id])return this.requests[t.id].then((()=>Promise.resolve({buffer:this.buffers[t.id],byteOffset:0})));if("binary_glTF"!==e.buffer&&"KHR_binary_glTF"!==e.buffer&&t.uri){if(h$3(t.uri)){const e=this.buffers[t.id]=c$2(t.uri);return Promise.resolve({buffer:e,byteOffset:0})}let e;const s=t.uri.indexOf("blob:")>=0;return e=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.requests[t.id]=w$5.getArrayBuffer(e,this._fetchOptions).then((r=>(s&&URL.revokeObjectURL(e),{buffer:this.buffers[t.id]=r.data,byteOffset:0})))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_toBufferData(e,t,r,n=0){const i=this.gltf,a=i.accessors[t],o=void 0!==a.bufferView?i.bufferViews[a.bufferView]:{},f=(o.byteOffset||0)+n,h=this._getTypeItemSize(a.type),c=u$4(a.componentType),l=o.byteStride||0,m={array:void 0,name:e,accessorName:t,byteLength:a.count*h*c.BYTES_PER_ELEMENT,componentType:a.componentType,count:a.count,type:a.type,itemSize:h,max:a.max,min:a.min,extensions:a.extensions};if(a.min&&(m.min=a.min),a.max&&(m.max=a.max),r)if(this._enableInterleave)m.byteStride=l,m.byteOffset=f+(a.byteOffset||0),!l||l===h*c.BYTES_PER_ELEMENT||"indices"===e||"input"===e||"output"===e||e.indexOf("morph")>=0?(m.array=this._typedArray(r,a.count,h,f+(a.byteOffset||0),c),m.array.buffer.byteLength===m.byteLength&&(m.byteOffset=0)):m.array=new Uint8Array(r,f,o.byteLength);else if(a.interleaved){m.byteStride=0,m.byteOffset=0;const e=new c(a.count*h);if(m.array=y$5(e,r,a.count,h,l,f+(a.byteOffset||0),a.componentType),m.extensions&&m.extensions.WEB3D_quantized_attributes&&h>2){const e=new Float32Array(m.array.length),{decodeMatrix:t}=m.extensions.WEB3D_quantized_attributes;for(let r=0;r<m.array.length;r+=h){O$7[0]=m.array[r],O$7[1]=m.array[r+1],O$7[2]=m.array[r+2],O$7[3]=1;const n=transformMat4$1(O$7,O$7,t);e[r]=n[0],e[r+1]=n[1],e[r+2]=n[2]}m.componentType=5126,m.array=e}}else m.byteStride=0,m.array=this._typedArray(r,a.count,h,f+(a.byteOffset||0),c),m.byteOffset=m.array.byteOffset;else{m.array=new c(a.count);const e=m.min||m.max;e&&(m.array[0]=e[0],m.array[1]=e[1],m.array[2]=e[2])}return m}_compareAccessor(){const e=this.gltf.accessors;if(Array.isArray(e))for(let t=0;t<e.length;t++)for(let s=0;s<e.length;s++)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0);else for(const t in e)for(const s in e)t!==s&&e[t].bufferView===e[s].bufferView&&(e[t].interleaved=e[s].interleaved=!0)}_typedArray(e,t,s,r,n){return r%n.BYTES_PER_ELEMENT!=0&&(e=e.slice(r,r+t*s*n.BYTES_PER_ELEMENT),r=0),new n(e,r,s*t)}_getTypeItemSize(e){const t=E$7.indexOf(e);return E$7[t+1]}requestKHRTechniquesWebgl(e){const{shaders:t}=e,s=t.map((e=>{if(void 0!==e.bufferView){const t=this.gltf.bufferViews[e.bufferView],{byteLength:s}=t;return this._requestBufferOfBufferView(t).then((r=>{const{buffer:n,byteOffset:i}=r,a=x$7(n,i+(t.byteOffset||0),s);return e.content=a,e}))}if(e.uri){if(h$3(e.uri)){const t=c$2(e.uri),s=x$7(t,0,t.byteLength);return e.content=s,Promise.resolve(e)}return w$5.get(this.rootPath+"/"+e.uri,this._fetchOptions).then((t=>(e.content=t,e)))}return Promise.resolve(e)}));return Promise.all(s).then((()=>e))}}class R$7 extends T$7{constructor(e,t,s,r,n,i,a){super(r,n,i,a),this.rootPath=e,this.gltf=t,this.requests={},this.buffers={},this.glbBuffer=s,this.accessor=new I$6(e,t,s,a)}iterate(e,t){const s=this.gltf[t];if(!s)return;let r=0;for(const t in s)e(t,s[t],r++)}createNode(e){const s={};if(a$1(e.name)&&(s.name=e.name),a$1(e.children)&&(s.children=e.children),a$1(e.jointName)&&(s.jointName=e.jointName),a$1(e.matrix)&&(s.matrix=e.matrix),a$1(e.rotation)&&(s.rotation=e.rotation),a$1(e.scale)&&(s.scale=e.scale),a$1(e.translation)&&(s.translation=e.translation),a$1(e.extras)&&(s.extras=e.extras),a$1(e.meshes)&&(s.mesh=e.meshes[0]),s.translation||s.rotation||s.scale){const e=function(e,s){if(s.matrix)return s.matrix;if(s.translation||s.scale||s.rotation){const r=fromTranslation$1(l$2,s.translation||g$2),n=fromQuat(m$4,s.rotation||p$6),i=fromScaling(d$3,s.scale||b$6);return multiply$5(i,n,i),multiply$5(e,r,i)}return identity$2(e)}([],s);delete s.translation,delete s.rotation,delete s.scale,s.matrix=e}return s}_loadMaterials(e){const t={};for(const s in e){const r=e[s];let n,i;r.instanceTechnique&&r.instanceTechnique.values?(n=r.instanceTechnique,i=n.values.diffuse):(n=r,i=n.values.tex||n.values.diffuseTex||n.values.diffuse);const a={baseColorTexture:{index:i}};r.name&&(a.name=r.name),r.extensions&&(a.extensions=r.extensions),r.extras&&(a.extras=r.extras),t[s]=a}return t}_loadImage(e){if(e.bufferView||e.extensions&&(e.extensions.KHR_binary_glTF||e.extensions.binary_glTF)){const t=e.bufferView?e:e.extensions.KHR_binary_glTF||e.extensions.binary_glTF;e.extensions&&(e.mimeType=t.mimeType,e.width=t.width,e.height=t.height);const s=this.gltf.bufferViews[t.bufferView],i=this.buffers[t.bufferView]=new Uint8Array(this.glbBuffer.buffer,(s.byteOffset||0)+this.glbBuffer.byteOffset,s.byteLength);return this.getImageByBuffer(i,e)}return this.requestExternalImage(e)}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;const s=this.gltf.images[t.source];return this._loadImage(s).then((e=>({image:{array:e.data,width:e.width,height:e.height,index:t.source,mimeType:s.mimeType,name:s.name,extras:s.extras},sampler:this.gltf.samplers[t.sampler]})))}getBaseColorTexture(e){const t=this.gltf.materials[e];let s,r;if(t.instanceTechnique&&t.instanceTechnique.values?(s=t.instanceTechnique,r=s.values.diffuse):(s=t,r=s.values.tex||s.values.diffuseTex||s.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const n=this.gltf.textures[r];if(!n)return null;return{format:n.format||6408,internalFormat:n.internalFormat||6408,type:n.type||5121,sampler:this.gltf.samplers[n.sampler],source:this.gltf.images[n.source]}}getMaterial(){return null}getAnimations(){return null}}class B$7 extends T$7{constructor(e,t,s,r,n,i,a){super(r,n,i,a),this.rootPath=e,this.gltf=t,this.glbBuffer=s,this.buffers={},this.requests={},this.accessor=new I$6(e,t,s,a)}iterate(e,t){const s=this.gltf[t];if(s)for(let t=0;t<s.length;t++)e(t,s[t],t)}createNode(e){const t={};return f$4(t,e),!a$1(e.weights)&&this.gltf.meshes&&a$1(t.mesh)?t.weights=this.gltf.meshes[t.mesh].weights:e.weights&&(t.weights=e.weights),t}_getTexture(e){const t=this.gltf.textures[e];if(!t)return null;let s=t.source;if(t.extensions&&t.extensions.EXT_texture_webp&&(s=t.extensions.EXT_texture_webp.source),!a$1(s))return null;const r=this.gltf.images[s];return this._loadImage(r).then((e=>{if(!e)return null;const s={image:{array:e.data,mipmap:e.mipmap,width:e.width,height:e.height,index:t.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};f$4(s,t);const n=a$1(t.sampler)?this.gltf.samplers[t.sampler]:void 0;return n&&(s.sampler=n,s.sampler.magFilter=n.magFilter||9729,s.sampler.minFilter=n.minFilter||9729,s.sampler.wrapS=n.wrapS||10497,s.sampler.wrapT=n.wrapT||10497),e.format&&(s.format=e.format),s}))}_loadImage(e){if(!a$1(e.bufferView))return this.requestExternalImage(e);{const t=this.gltf.bufferViews[e.bufferView],s=this.gltf.buffers[t.buffer];if(s.uri)return this.requestImageFromBufferURI(s,t,e);if(this.glbBuffer)return this._requestFromGlbBuffer(t,e)}return null}_requestFromGlbBuffer(e,t){const s=this._createDataView(e,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(s,t)}_createDataView(e,t,s){s=s||0;return new Uint8Array(t,e.byteOffset+s,e.byteLength)}_transformArrayBufferToBase64(e,t){const s=new Array(e.byteLength);for(let t=0;t<e.byteLength;t++)s[t]=String.fromCharCode(e[t]);return s.join(""),"data:"+(t=t||"image/png")+";base64,"+function(e){return"undefined"!=typeof self?self.btoa(e):window.btoa(e)}(unescape(encodeURIComponent(s)))}getAnimations(e){const t=[];return e.forEach((e=>{t.push(this.getSamplers(e.samplers))})),Promise.all(t).then((t=>{for(let s=0;s<t.length;s++)e[s].samplers=t[s];return e}))}getSamplers(e){const t=[];for(let s=0;s<e.length;s++)(a$1(e[s].input)||a$1(e[s].output))&&(t.push(this.accessor._requestData("input",e[s].input)),t.push(this.accessor._requestData("output",e[s].output)));return Promise.all(t).then((t=>{for(let s=0;s<t.length/2;s++)e[s].input=t[2*s],e[s].output=t[2*s+1],e[s].interpolation||(e[s].interpolation="LINEAR");return e}))}}const N$7="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class S$7{static read(e,t=0,s=0){s||(s=e.byteLength);const r=new DataView(e,t,s),n=r.getUint32(4,!0);if(1===n)return S$7.readV1(r,t);if(2===n)return S$7.readV2(e,t);throw new Error("Unsupported glb version : "+n)}static readV1(e,t){const s=e.getUint32(8,!0),r=e.getUint32(12,!0);if(s!==e.byteLength)throw new Error("Length in GLB header is inconsistent with glb's byte length.");const n=q$8(e.buffer,20+t,r);return{json:JSON.parse(n),glbBuffer:{byteOffset:20+t+r,buffer:e.buffer,byteLength:s}}}static readV2(e,t){let s,r,n;const i=new DataView(e,t+12);let a=0;for(;a<i.byteLength;){const o=i.getUint32(a,!0);a+=4;const f=i.getUint32(a,!0);if(a+=4,1313821514===f)s=q$8(e,t+12+a,o);else if(5130562===f){n=t+12+a,r=o;break}a+=o}return{json:JSON.parse(s),glbBuffer:{byteOffset:n,buffer:e,byteLength:r}}}}function q$8(e,t,s){if(N$7){const r=new Uint8Array(e,t,s);return N$7.decode(r)}return function(e){const t=e.length;let s="";for(let r=0;r<t;){let n=e[r++];if(128&n){let s=v$4[n>>3&7];if(!(64&n)||!s||r+s>t)return null;for(n&=63>>s;s>0;s-=1){const t=e[r++];if(128!=(192&t))return null;n=n<<6|63&t}}s+=String.fromCharCode(n)}return s}(new Uint8Array(e,t,s))}const v$4=[1,1,1,1,2,2,3,0],V$7=[0,0,0],M$7=[0,0,0,1],L$7=[1,1,1],D$7={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},U$7={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},C$5={_getTRSW(t,s,n,i,o,f,u,h){const c=a$1(t)?s.animations:[s.animations[0]],l={};for(let s=0;s<c.length;s++){const m=c[s],d=m.name||s;if(a$1(t)&&d!==t)continue;const g=m.channelsMap[n];if(g)for(let t=0;t<g.length;t++){const s=g[t];"translation"===s.target.path?(this._getAnimateData(o,m.samplers[s.sampler],i,1),l.translation=copy$4(V$7,o)):"rotation"===s.target.path?(this._getQuaternion(f,m.samplers[s.sampler],i,1),l.rotation=copy$2(M$7,f)):"scale"===s.target.path?(this._getAnimateData(u,m.samplers[s.sampler],i,1),l.scale=copy$4(L$7,u)):"weights"===s.target.path&&h&&(this._getAnimateData(h,m.samplers[s.sampler],i,h.length),l.weights=h)}}return l},_getAnimateData(e,t,s,r){switch(t.interpolation){case"LINEAR":{const n=this._getPreNext(U$7,t,s,1*r);n&&(e=function(e,t,s,r){for(let n=0;n<e.length;n++)e[n]=t[n]+r*(s[n]-t[n]);return e}(e,n.PREVIOUS,n.NEXT,n.INTERPOLATION));break}case"STEP":{const n=this._getPreNext(U$7,t,s,1*r);n&&(e=function(e,t){for(let s=0;s<e.length;s++)e[s]=t[s];return e}(e,...n.PREVIOUS));break}case"CUBICSPLINE":{const n=this._getPreNext(U$7,t,s,3*r);n&&(e=this._getCubicSpline(e,n,t.input.array,3*r));break}}return e},_getQuaternion(t,r,n){switch(r.interpolation){case"LINEAR":{const s=this._getPreNext(U$7,r,n,1);s&&slerp(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION);break}case"STEP":{const e=this._getPreNext(U$7,r,n,1);e&&(t=set$3(t,...e.PREVIOUS));break}case"CUBICSPLINE":{const e=this._getPreNext(U$7,r,n,3);if(e){for(let t=0;t<e.PREVIOUS.length;t++)e.PREVIOUS[t]=Math.acos(e.PREVIOUS[t]),e.NEXT[t]=Math.acos(e.NEXT[t]);t=this._getCubicSpline(t,e,r.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},_search(e,t){const s=e.length;let r,n,i,a=0,o=s-1,f=Math.floor((a+o)/2);for(;a<=s-1&&o>=0;){if(a===o)return null;if(e[f]<=t&&t<=e[f+1]){const s=e[f];return r=f,n=f+1,i=(t-s)/(e[f+1]-s),{preIndx:r,nextIndex:n,interpolation:i}}t<e[f]?(o=f,f=Math.floor((a+o)/2)):e[f+1]<t&&(a=f,f=Math.floor((a+o)/2))}return null},_getPreNext(e,t,s,r){const n=t.input.array,i=t.output.array,a=t.output.itemSize;(s<n[0]||s>n[n.length-1])&&(s=Math.max(n[0],Math.min(n[n.length-1],s))),s===n[n.length-1]&&(s=n[0]);const o=this._search(n,s);if(!o||!o.nextIndex)return null;const{preIndx:f,nextIndex:u,interpolation:h}=o;e.PREINDEX=f,e.NEXTINDEX=u,e.INTERPOLATION=h;const c=a*r;return e.PREVIOUS=i.subarray(e.PREINDEX*c,(e.PREINDEX+1)*c),e.NEXT=i.subarray(e.NEXTINDEX*c,(e.NEXTINDEX+1)*c),e},_getCubicSpline(e,t,s,r){const n=t.INTERPOLATION,i=s[t.PREINDEX],a=s[t.NEXTINDEX];for(let s=0;s<3;s++){const o=t.PREVIOUS[r+s],f=(a-i)*t.PREVIOUS[2*r+s],u=t.NEXT[3+s],h=(a-i)*t.NEXT[s],c=(2*Math.pow(n,3)-3*Math.pow(n,2)+1)*o+(Math.pow(n,3)-2*Math.pow(n,2)+n)*f+(2*-Math.pow(n,3)+3*Math.pow(n,2))*u+(Math.pow(n,3)-Math.pow(n,2))*h;e[s]=c}return e},getAnimationClip(e,t,n,i){const a=e.nodes[t]&&e.nodes[t].weights;return set$4(V$7,...D$7.TRANSLATION),set$3(M$7,...D$7.ROTATION),set$4(L$7,...D$7.SCALE),this._getTRSW(i,e,t,n,V$7,M$7,L$7,a)},getTimeSpan(e){if(!e.animations)return null;if(e.timeSpan)return e.timeSpan;const t=e.animations;return e.timeSpan={},t.forEach(((t,s)=>{let r=-1/0,n=1/0;const i=t.channels;for(let e=0;e<i.length;e++){const a=t.samplers[i[e].sampler].input.array;a[a.length-1]>r&&(r=a[a.length-1]),a[0]<n&&(n=a[0])}e.timeSpan[t.name||s]={max:r,min:n}})),e.timeSpan},getTimeSpanByName(e,t){const s=this.getTimeSpan(e);return s?a$1(t)?s[t]:s[Object.keys(s)[0]]:null}};let k$7=!1;if("undefined"!=typeof OffscreenCanvas){let e;try{e=new OffscreenCanvas(2,2).getContext("2d")}catch(e){}e&&"undefined"!=typeof createImageBitmap&&(k$7=!0)}const F$7="undefined"==typeof document?null:document.createElement("canvas");class X$8{constructor(e,t,s){if(this.options=s||{},this.options.decoders||(this.options.decoders={}),this._fetchOptions=this.options.fetchOptions||{},t.buffer instanceof ArrayBuffer){const{json:s,glbBuffer:r}=S$7.read(t.buffer,t.byteOffset,t.byteLength);this._init(e,s,r)}else this._init(e,t);this._accessor=new I$6(this.rootPath,this.gltf,this.glbBuffer,this._fetchOptions),this._checkExtensions()}_checkExtensions(){const e=this.gltf.extensionsRequired;if(e){if(e.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(e.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}_loadExtensions(){const e=this.gltf.extensions;return e&&e.KHR_techniques_webgl?this._accessor.requestKHRTechniquesWebgl(e.KHR_techniques_webgl).then((t=>(e.KHR_techniques_webgl=t,e))):Promise.resolve(e)}load(e){const t=this._loadScene(e=e||{}),s=this._loadAnimations(),r=this._loadTextures(),n=this._loadExtensions();return Promise.all([t,s,r,n]).then((e=>(e[0].animations=e[1],e[0].textures=e[2],e[0].extensions=e[3],e[0].transferables=this.transferables||[],this.createChannelsMap(e[0]),e[0])))}createChannelsMap(e){const t=e.animations;if(t)for(let e=0;e<t.length;e++){const s=t[e];s.channelsMap={};for(let e=0;e<s.channels.length;e++){const t=s.channels[e];s.channelsMap[t.target.node]||(s.channelsMap[t.target.node]=[]),s.channelsMap[t.target.node].push(t)}}}getExternalResources(){const e=[];if(this.gltf){const{buffers:t,images:s}=this.gltf;for(let s=0;s<t.length;s++)t[s].uri&&t[s].uri.indexOf("data:application/octet-stream;base64")<0&&e.push({type:"buffer",uri:t[s].uri});for(let t=0;t<s.length;t++)s[t].uri&&s[t].uri.indexOf("data:image/")<0&&e.push({type:"image",uri:s[t].uri})}return e}static getAnimationClip(e,t,s,r){return C$5.getAnimationClip(e,t,s,r)}static getAnimationTimeSpan(e,t){return C$5.getTimeSpanByName(e,t)}static getTypedArrayCtor(e){return u$4(e)}static readInterleavedArray(e,t,s,r,n,i,a){return y$5(e,t,s,r,n,i,a)}_init(e,t,s){this.gltf=t,this.glbBuffer=s,this.version=t.asset?+t.asset.version:1,this.rootPath=e,this.buffers={},this.requests={},this.options.requestImage=k$7?z$7.bind(this):this.options.requestImage||j$7,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new B$7(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions),this.adapter.iterate(((e,t,s)=>{t.id="buffer_"+s}),"buffers"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors")):(this.adapter=new R$7(e,t,s,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this._fetchOptions),this.adapter.iterate(((e,t,s)=>{t.id="accessor_"+s}),"accessors"),this.adapter.iterate(((e,t,s)=>{t.id="image_"+s}),"images"))}_parseNodes(e,t){if(e.children&&e.children.length>0){if(!("number"==typeof(s=e.children[0])&&isFinite(s)||o$1(e.children[0])))return e;const r=e.children.map((e=>{const s=t[e];return s.nodeIndex=e,this._parseNodes(s,t)}));e.children=r}var s;return e}_loadScene(e){return this._loadNodes(e).then((e=>{const t=this.scenes=[];let s;for(const t in e)e[t]=this._parseNodes(e[t],e),e[t].nodeIndex=Number(t)?Number(t):t;this.adapter.iterate(((r,n,i)=>{const a={};n.name&&(a.name=n.name),n.nodes&&(a.nodes=n.nodes.map((t=>e[t]))),this.gltf.scene===r&&(s=i),t.push(a)}),"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:s,scenes:t,nodes:e,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const e=this.adapter._loadMaterials(this.gltf.materials);r.materials=e}return delete this.gltf.buffers,r.json=this.gltf,r}))}_loadNodes(e){return this._loadMeshes(e).then((()=>{const e=this.nodes={};return this.adapter.iterate(((t,s)=>{const r=this.adapter.createNode(s,this.meshes,this.skins);e[t]=r}),"nodes"),e}))}_loadSkins(){this.skins=[];const e=[];return this.adapter.iterate(((t,s,r)=>{e.push(this._loadSkin(s).then((e=>{e.index=r,this.skins.push(e)})))}),"skins"),e}_loadSkin(e){return this.adapter.accessor._requestData("inverseBindMatrices",e.inverseBindMatrices).then((t=>(e.inverseBindMatrices=t,t&&t.buffer&&this.transferables&&this.transferables.indexOf(t.buffer)<0&&this.transferables.push(t.buffer),e)))}_loadAnimations(){const e=this.gltf.animations;return a$1(e)?this.adapter.getAnimations(e):null}_loadMeshes(e){this.meshes={};let t=[];return this.adapter.iterate(((s,r,n)=>{t.push(this._loadMesh(r,e).then((e=>{e.index=n,this.meshes[s]=e})))}),"meshes"),t=t.concat(this._loadSkins()),Promise.all(t)}_loadMesh(e,t){const s=e.primitives.map((e=>this._loadPrimitive(e,t))).filter((e=>!!e));return Promise.all(s).then((t=>{const s={};return f$4(s,e),s.primitives=t,s}))}_loadTextures(){const e=this.gltf.textures;if(!e)return null;const t=[];for(const s in e)t.push(this.adapter._getTexture(s));return Promise.all(t).then((t=>{if(this.transferables)for(let e=0;e<t.length;e++){const s=t[e].image.array;if(t[e]&&s){let e;e=s instanceof ImageBitmap?s:s.buffer,e&&this.transferables.indexOf(e)<0&&this.transferables.push(e)}}if(!Array.isArray(e)){const s={},r=Object.keys(e);for(let e=0;e<t.length;e++)t[e]&&(s[r[e]]=t[e]);return s}return t}))}_loadPrimitive(e,t){let s;const n=[],i=e.extensions;if(a$1(e.targets))for(let t=0;t<e.targets.length;t++){const s=e.targets[t];for(const e in s){const r=this.adapter.accessor._requestData(`morphTargets_${e}_${t}`,s[e]);r&&n.push(r)}}if(i&&i.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const e=this.options.decoders.draco,{bufferView:r,attributes:a}=i.KHR_draco_mesh_compression,o=this.gltf.bufferViews[r],f=this._accessor._requestBufferOfBufferView(o).then((s=>{const{buffer:r,byteOffset:n}=s;let{byteOffset:i}=o;i||(i=0);const u=new DataView(r,n+i,o.byteLength);return e(u,{attributes:a,useUniqueIDs:!1,skipAttributeTransform:t.skipAttributeTransform}).then((e=>{const t=Object.values(e.attributes);return e.indices&&t.push(e.indices),t}))}));n.push(f),s=Promise.all(n)}else{const t=e.attributes;for(const e in t){const s=this.adapter.accessor._requestData(e,t[e]);s&&n.push(s)}if(a$1(e.indices)){const t=this.adapter.accessor._requestData("indices",e.indices);t&&n.push(t)}s=Promise.all(n)}return s.then((t=>{if(i&&i.KHR_draco_mesh_compression){const s=e.targets?e.targets.length:0;t[s]=t[s].concat(t.slice(0,s)),t=t[s]}let s,n;const o={attributes:t.reduce(((e,t)=>{if("indices"===t.name)s=t;else if(t.name.indexOf("morphTargets_")>-1)n=n||{},n[t.name.slice(13)]=t;else{if(!("POSITION"!==t.name||t.min&&t.max)){const e=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0],{itemSize:n,array:i}=t,a=i.length/n;for(let t=0;t<a;t++)for(let r=0;r<n;r++){const a=t*n+r;i[a]<e[r]&&(e[r]=i[a]),i[a]>s[r]&&(s[r]=i[a])}if(t.quantization){const n=t.quantization,i=n.range/(1<<n.quantizationBits),a=n.minValues;scale$4(e,e,i),add$4(e,e,a),scale$4(s,s,i),add$4(s,s,a)}t.min=e,t.max=s}e[t.name]=t}return this.transferables&&t.array.buffer&&this.transferables.indexOf(t.array.buffer)<0&&this.transferables.push(t.array.buffer),e}),{}),material:e.material};return s&&(o.indices=s),n&&(o.morphTargets=n),o.mode=a$1(e.mode)?e.mode:4,a$1(e.extras)&&(o.extras=e.extras),o}))}}function j$7(e,t,s){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!F$7)return void s(new Error("There is no canvas to draw image!"));F$7.width=r.width,F$7.height=r.height;const e=F$7.getContext("2d",{willReadFrequently:!0});e.drawImage(r,0,0,r.width,r.height);const t=e.getImageData(0,0,r.width,r.height),n={width:r.width,height:r.height,data:new Uint8Array(t.data)};s(null,n)},r.onerror=function(e){s(e)},r.src=e}let H$7,K$8;function z$7(e,t,s){H$7||(H$7=new OffscreenCanvas(2,2),K$8=H$7.getContext("2d",{willReadFrequently:!0}));let r=null;if(o$1(e))r=fetch(e,t).then((e=>e.arrayBuffer())).then((e=>{const t=new Blob([new Uint8Array(e)]);return createImageBitmap(t)}));else{const t=new Blob([e]);r=createImageBitmap(t)}r.then(Y$7.bind(this)).then((e=>{s(null,e)})).catch((e=>{console.warn(e),s(e)}))}function Y$7(e){let{width:t,height:s}=e;W$7(t)||(t=G$7(t)),W$7(s)||(s=G$7(s));const r=this.options.maxTextureSize;r&&(t=Math.min(r,t),s=Math.min(r,s)),H$7.width=t,H$7.height=s,K$8.drawImage(e,0,0,t,s),e.close();const n=K$8.getImageData(0,0,t,s);return{width:t,height:s,data:new Uint8Array(n.data)}}function W$7(e){return 0==(e&e-1)&&0!==e}function G$7(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}
/*!
	 * Contains code from google filament
	 * https://github.com/google/filament/
	 * License Apache-2.0
	 */const MAT0=[],TMP0=[],TMP1=[],TMP2=[];function packTangentFrame(q,n,t){const c=cross$1(TMP0,n,t);q=fromMat3(q,function(out,c00,c01,c02,c10,c11,c12,c20,c21,c22){return out[0]=c00,out[1]=c01,out[2]=c02,out[3]=c10,out[4]=c11,out[5]=c12,out[6]=c20,out[7]=c21,out[8]=c22,out}(MAT0,t[0],t[1],t[2],...c,...n));const bias=1/32767;if((q=function(q){return q[3]<0?scale$2(q,q,-1):q}(q=normalize$2(q,q)))[3]<bias){q[3]=bias;const factor=Math.sqrt(1-bias*bias);q[0]*=factor,q[1]*=factor,q[2]*=factor}const b=t[3]>0?cross$1(TMP1,t,n):cross$1(TMP1,n,t);return dot$4(cross$1(TMP2,t,n),b)<0&&scale$2(q,q,-1),q}const COUNTS=[];function buildNormals(positions,indices,out){const normals=out||[];normals.setLength&&normals.setLength(positions.length);const counts=COUNTS;counts.length<positions.length/3&&(counts.length=positions.length/3),counts.fill(0,0,positions.length/3);const len=void 0===indices.length?indices:indices.length;for(let i=0;i<len/3;i++)void 0===indices.length?computeNormal(positions,3*i,3*i+1,3*i+2,normals,counts):computeNormal(positions,indices[3*i],indices[3*i+1],indices[3*i+2],normals,counts);for(let i=0;i<normals.length;i+=3){const count=counts[i/3];0!==count?(normals[i]/=count,normals[i+1]/=count,normals[i+2]/=count):(normals[i]=0,normals[i+1]=0,normals[i+2]=0)}return normals}const V0=[],V1=[],V2=[],vA$1=[],vB=[],vC=[],normal=[];function computeNormal(vertices,v1,v2,v3,normals,counts){set$4(vA$1,vertices[3*v1],vertices[3*v1+1],vertices[3*v1+2]),set$4(vB,vertices[3*v2],vertices[3*v2+1],vertices[3*v2+2]),set$4(vC,vertices[3*v3],vertices[3*v3+1],vertices[3*v3+2]);const cb=sub$2(V0,vC,vB),ab=sub$2(V1,vA$1,vB),cross=cross$1(V2,cb,ab);normalize$4(normal,cross),normals[3*v1]=normals[3*v1]||0,normals[3*v2]=normals[3*v2]||0,normals[3*v3]=normals[3*v3]||0,normals[3*v1+1]=normals[3*v1+1]||0,normals[3*v2+1]=normals[3*v2+1]||0,normals[3*v3+1]=normals[3*v3+1]||0,normals[3*v1+2]=normals[3*v1+2]||0,normals[3*v2+2]=normals[3*v2+2]||0,normals[3*v3+2]=normals[3*v3+2]||0,normals[3*v1]+=normal[0],normals[3*v2]+=normal[0],normals[3*v3]+=normal[0],normals[3*v1+1]+=normal[1],normals[3*v2+1]+=normal[1],normals[3*v3+1]+=normal[1],normals[3*v1+2]+=normal[2],normals[3*v2+2]+=normal[2],normals[3*v3+2]+=normal[2],counts[v1]+=1,counts[v2]+=1,counts[v3]+=1}
/*!
	 * Contains code from THREE.JS
	 * https://github.com/mrdoob/three.js/
	 * License MIT
	 * 
	 * Generate tangents per vertex.
	 */function buildTangents(positions,normals,uvs,indices,out){const nVertices=positions.length/3,tangents=out||new Array(4*nVertices),tan1=[],tan2=[];for(let i=0;i<nVertices;i++)tan1[i]=[0,0,0],tan2[i]=[0,0,0];const vA=[0,0,0],vB=[0,0,0],vC=[0,0,0],uvA=[0,0],uvB=[0,0],uvC=[0,0],sdir=[0,0,0],tdir=[0,0,0];function handleTriangle(a,b,c){fromArray3(vA,positions,3*a),fromArray3(vB,positions,3*b),fromArray3(vC,positions,3*c),fromArray2(uvA,uvs,2*a),fromArray2(uvB,uvs,2*b),fromArray2(uvC,uvs,2*c);const x1=vB[0]-vA[0],x2=vC[0]-vA[0],y1=vB[1]-vA[1],y2=vC[1]-vA[1],z1=vB[2]-vA[2],z2=vC[2]-vA[2],s1=uvB[0]-uvA[0],s2=uvC[0]-uvA[0],t1=uvB[1]-uvA[1],t2=uvC[1]-uvA[1],r=1/(s1*t2-s2*t1);set$4(sdir,(t2*x1-t1*x2)*r,(t2*y1-t1*y2)*r,(t2*z1-t1*z2)*r),set$4(tdir,(s1*x2-s2*x1)*r,(s1*y2-s2*y1)*r,(s1*z2-s2*z1)*r),add$4(tan1[a],tan1[a],sdir),add$4(tan1[b],tan1[b],sdir),add$4(tan1[c],tan1[c],sdir),add$4(tan2[a],tan2[a],tdir),add$4(tan2[b],tan2[b],tdir),add$4(tan2[c],tan2[c],tdir)}for(let j=0,jl=indices.length;j<jl;j+=3)handleTriangle(indices[j+0],indices[j+1],indices[j+2]);const tmp=[],tmp2=[],n=[],n2=[];let w,t,test;function handleVertex(v){fromArray3(n,normals,3*v),copy$4(n2,n),t=tan1[v],copy$4(tmp,t),sub$2(tmp,tmp,scale$4(n,n,dot$4(n,t))),normalize$4(tmp,tmp),cross$1(tmp2,n2,t),test=dot$4(tmp2,tan2[v]),w=test<0?-1:1,tangents[4*v]=tmp[0],tangents[4*v+1]=tmp[1],tangents[4*v+2]=tmp[2],tangents[4*v+3]=w}for(let j=0,jl=indices.length;j<jl;j+=3)handleVertex(indices[j+0]),handleVertex(indices[j+1]),handleVertex(indices[j+2]);return tangents}function fromArray3(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out[2]=array[offset+2],out}function fromArray2(out,array,offset){return out[0]=array[offset],out[1]=array[offset+1],out}
/*!
	 * @maptalks/reshader.gl v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.com
	 */function f$3(e){return!d$2(e)&&("string"==typeof e||null!==e.constructor&&e.constructor===String)}function d$2(e){return null==e}function u$3(e){return!d$2(e)}function h$2(e){return!d$2(e)&&("function"==typeof e||null!==e.constructor&&e.constructor===Function)}const m$3="function"==typeof Object.assign;function v$3(e){if(m$3)Object.assign.apply(Object,arguments);else for(let n=1;n<arguments.length;n++){const t=arguments[n];for(const n in t)e[n]=t[n]}return e}function _$6(e){for(let n=1;n<arguments.length;n++){const t=arguments[n];for(const n in t)null!=t[n]&&(e[n]=t[n])}return e}function g$1(e){return"number"==typeof e&&!isNaN(e)}function x$6(e,n,t){return e*(1-t)+n*t}function b$5(e){return Array.isArray(e)||e instanceof Uint8Array||e instanceof Int8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Uint32Array||e instanceof Int32Array||e instanceof Uint8ClampedArray||e instanceof Float32Array||e instanceof Float64Array}function p$5(e){return(e=Math.abs(e))<128?Int8Array:e<32768?Int16Array:Float32Array}function y$4(e,n,t){return Math.min(t,Math.max(n,e))}function A$4(e){return e&&e.hasExtension("oes_vertex_array_object")}function S$6(e,n){return Object.prototype.hasOwnProperty.call(e,n)}function T$6(e){if(e.data){if(e.data.BYTES_PER_ELEMENT)return e.data.length*e.data.BYTES_PER_ELEMENT;if(e.data.length)return 4*e.data.length}else{if(e.BYTES_PER_ELEMENT)return e.length*e.BYTES_PER_ELEMENT;if(e.length)return 4*e.length;if(e.buffer&&e.buffer.destroy)return e.buffer._buffer.byteLength}return 0}function M$6(e){return e.width*e.height*O$6(e.format)*C$4(e.type)*("textureCube"===e._reglType?6:1)}function C$4(e){return"uint8"===e?1:"uint16"===e||"float16"===e||"half float"===e?2:"uint32"===e||"float"===e||"float32"===e?4:0}function O$6(e){return"depth"===e||"alpha"===e||"luminance"===e?1:"luminance alpha"===e||"depth stencil"===e?2:"srgba"===e||"rgb5 a1"===e||"rgba"===e.substring(0,4)?4:"srgb"===e||"rgb"===e.substring(0,3)?3:1}function E$6(n){if(!n.componentType)return!1;const t=X$8.getTypedArrayCtor(n.componentType);return n.byteStride>0&&n.byteStride!==n.itemSize*t.BYTES_PER_ELEMENT}function P$5(e){return e&&(e.stride>0||E$6(e))}function I$5(e){let n=0;const t=e&&e.length||0;if(!t)return n;let r;for(let i=0;i<t;i++)r=e.charCodeAt(i),n=(n<<5)-n+r,n&=n;return n}function w$4(e){return 0==(e&e-1)&&0!==e}function D$6(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}function R$6(e,n,t){if(b$5(e))return w$4(e.width)&&w$4(e.height)?e:function(e,n,t){let r=n,i=t;w$4(n)||(r=D$6(n)),w$4(t)||(i=D$6(t));const o=new ImageData(new Uint8ClampedArray(e),n,t),a=document.createElement("canvas");a.width=n,a.height=t,a.getContext("2d").putImageData(o,0,0);const s=document.createElement("canvas");s.width=r,s.height=i,s.getContext("2d").drawImage(a,0,0,n,t,0,0,i,i),console.warn(`Texture's size is not power of two, resize from (${n}, ${t}) to (${r}, ${i})`);let c=document.getElementById("_debug_resize_canvas");return c||(c=document.createElement("canvas"),c.id="_debug_resize_canvas",document.body.appendChild(c)),c.width=r,c.height=i,c.getContext("2d").drawImage(s,0,0),s}(e,n,t);if(w$4(e.width)&&w$4(e.height))return e;t=e.height,w$4(n=e.width)||(n=D$6(n)),w$4(t)||(t=D$6(t));const r=document.createElement("canvas");r.width=n,r.height=t,r.getContext("2d").drawImage(e,0,0,n,t);const i=e.src,o=i.lastIndexOf("/")+1,a=i.substring(o);return console.warn(`Texture(${a})'s size is not power of two, resize from (${e.width}, ${e.height}) to (${n}, ${t})`),r}var N$6=Object.freeze({__proto__:null,isString:f$3,isNil:d$2,defined:u$3,isFunction:h$2,extend:v$3,extend1:_$6,extend2:function(e){for(let n=1;n<arguments.length;n++){const t=arguments[n];for(const n in t)void 0===e[n]&&(e[n]=t[n])}return e},isNumber:g$1,log2:function(e){if(Math.log2)return Math.log2(e);const n=Math.log(e)*Math.LOG2E,t=Math.round(n);return Math.abs(t-n)<1e-14?t:n},normalize:function(e,n){let t=0;for(let e=0,r=n.length;e<r;e++)t+=n[e];for(let r=0,i=n.length;r<i;r++)e[r]=n[r]/t;return e},interpolate:x$6,isArray:b$5,lerp:function(e,n,t,r){for(let i=0;i<e.length;i++)e[i]=n[i]+r*(t[i]-n[i]);return e},set:function(e,n){for(let t=0;t<e.length;t++)e[t]=n[t];return e},getPosArrayType:p$5,clamp:y$4,isSupportVAO:A$4,hasOwn:S$6,getBufferSize:T$6,getTexMemorySize:M$6,getTextureByteWidth:C$4,getTextureChannels:O$6,isInStride:E$6,isInterleaved:P$5,getSupportedFormats:function(e){return{etc:!!e.getExtension("WEBGL_compressed_texture_etc"),etc1:!!e.getExtension("WEBGL_compressed_texture_etc1"),s3tc:!!e.getExtension("WEBGL_compressed_texture_s3tc"),pvrtc:!!e.getExtension("WEBGL_compressed_texture_pvrtc"),astc:!!e.getExtension("WEBGL_compressed_texture_astc"),bc7:!!e.getExtension("EXT_texture_compression_bptc")}},hashCode:I$5,isPowerOfTwo:w$4,resizeToPowerOfTwo:R$6});const F$6=e=>class extends e{on(e,n){return this._events||(this._events={type:[n]}),this._events[e]=this._events[e]||[],this._events[e].push(n),this}once(e,n){return this.on(e,this._wrapOnce(e,n))}off(e,n){return this._events&&this._events[e]?(this._events[e].splice(this._events[e].indexOf(n),1),this):this}fire(e,n={}){if(!this._events||!this._events[e])return this;n.target||(n.target=this);const t=this._events[e].slice(0);for(const e of t)e(n);return this}_wrapOnce(e,n){const t=this;let r=!1;return function i(o){r||(r=!0,n(o),t.off(e,i))}}},H$6="__reshader_disposed";var L$6=Object.freeze({__proto__:null,KEY_DISPOSED:H$6,WEBGL_EXTENSIONS:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],WEBGL_OPTIONAL_EXTENSIONS:["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_texture_filter_anisotropic"]}),z$6=F$6(class{constructor(e,n){if(h$2(e)){this._texture=e,e=this.config={};for(const n in this._texture)S$6(this._texture,n)&&(h$2(this._texture[n])||(e[n]=this._texture[n]))}else if(this.config=e||{},this.resLoader=n,!e.url&&!e.promise||e.data)e.data&&this._needPowerOf2()&&(e.data instanceof Image?e.data=R$6(e.data):e.hdr||!b$5(e.data)||w$4(e.width)&&w$4(e.height)||(e.data=R$6(e.data,e.width,e.height)));else{this._loading=!0;const t=this;let r;if(e.promise)r=e.promise;else{let t;t=e.arrayBuffer?n.getArrayBuffer:n.get,r=t.call(n,e.url)}e.data=n.getDefaultTexture(e.url),this.promise=r,r.then((e=>(delete this.promise,t._loading=!1,t.config?(e.data instanceof Image&&this._needPowerOf2()&&(e.data=R$6(e.data)),t.onLoad(e),Array.isArray(e)||(e=[e]),t.fire("complete",{target:this,resources:e}),e):e))).catch((e=>{console.error("error when loading texture image.",e),t.fire("error",{target:this,error:e})}))}}isReady(){return!this._loading}set(e,n){return this.config[e]=n,this.dirty=!0,this}get(e){return this.config[e]}getREGLTexture(e){return this._texture||(this._texture=this.createREGLTexture(e),this.config.persistent||(this.config.data&&(this.config.data instanceof ImageBitmap&&this.config.data.close(),this.config.data=[]),this.config.faces&&(this.config.faces=[]),this.config.image&&(this.config.image.array=[]),this.config.mipmap&&delete this.config.mipmap)),this.dirty&&this._updateREGL(),this._texture}getMemorySize(){if(!this.config)return 0;const{width:e,height:n,type:t,format:r}=this.config,i=C$4(t||"uint8"),o=O$6(r||"rgba");return this.config.faces?e*n*i*o*6:e*n*i*o}_updateREGL(){this._texture&&!this._texture[H$6]&&this._texture(this.config),this.dirty=!1}dispose(){this.config&&this.config.url&&(URL.revokeObjectURL(this.config.url),this.resLoader.disposeRes(this.config.url)),this._texture&&!this._texture[H$6]&&(this._texture._reshader_refCount&&this._texture._reshader_refCount--,this._texture._reshader_refCount||(this._texture.destroy(),this._texture[H$6]=!0,delete this._texture)),delete this.resLoader;const e=this.config&&this.config.url;delete this.config,e&&this.fire("disposed",{target:this,url:e})}_needPowerOf2(){const e=this.config;return e.wrap&&"clamp"!==e.wrap||e.wrapS&&"clamp"!==e.wrapS||e.wrapT&&"clamp"!==e.wrapT||e.min&&"nearest"!==e.min&&"linear"!==e.min}});const k$6={};class B$6{constructor(e){this.regl=e}render(e,n,t,r){e.setUniforms(n||k$6),e.setFramebuffer(r);let i=0;if(t){const{opaques:n,transparents:r}=t.getSortedMeshes();i+=e.draw(this.regl,n),i+=e.draw(this.regl,r)}else i+=e.draw(this.regl);return i}clear(e){this.regl.clear(e)}}const U$6=[],V$6=identity$2([]),j$6={min:[],max:[]};class X$7{constructor(e,n){this.min=e||[1/0,1/0,1/0],this.max=n||[-1/0,-1/0,-1/0],this.updateVertex()}static copy(e,n){copy$4(e.min,n.min),copy$4(e.max,n.max);for(let r=0;r<n.vertex.length;r++)copy$4(e.vertex[r],n.vertex[r]);return e}combine(e){return e?(Array.isArray(e)&&(copy$4(j$6.min,e[0]),copy$4(j$6.max,e[1]),e=j$6),e.min[0]<this.min[0]&&(this.min[0]=e.min[0],this._dirty=!0),e.min[1]<this.min[1]&&(this.min[1]=e.min[1],this._dirty=!0),e.min[2]<this.min[2]&&(this.min[2]=e.min[2],this._dirty=!0),e.max[0]>this.max[0]&&(this.max[0]=e.max[0],this._dirty=!0),e.max[1]>this.max[1]&&(this.max[1]=e.max[1],this._dirty=!0),e.max[2]>this.max[2]&&(this.max[2]=e.max[2],this._dirty=!0),this):this}dirty(){return this._dirty=!0,this}getCenter(){return this.center||(this.center=[],this._dirty=!0),this._dirty&&(add$4(this.center,this.min,this.max),scale$4(this.center,this.center,.5)),this._dirty=!1,this.center}containPoint(e){const n=this.min,t=this.max;return n[0]<=e[0]&&n[1]<=e[1]&&n[2]<=e[2]&&t[0]>=e[0]&&t[1]>=e[1]&&t[2]>=e[2]}isFinite(){const e=this.min,n=this.max;return isFinite(e[0])&&isFinite(e[1])&&isFinite(e[2])&&isFinite(n[0])&&isFinite(n[1])&&isFinite(n[2])}updateVertex(){if(!this.vertex){this.vertex=[];for(let e=0;e<8;e++)this.vertex.push([])}return this.vertex[0][0]=this.min[0],this.vertex[0][1]=this.min[1],this.vertex[0][2]=this.min[2],this.vertex[1][0]=this.min[0],this.vertex[1][1]=this.min[1],this.vertex[1][2]=this.max[2],this.vertex[2][0]=this.min[0],this.vertex[2][1]=this.max[1],this.vertex[2][2]=this.max[2],this.vertex[3][0]=this.min[0],this.vertex[3][1]=this.max[1],this.vertex[3][2]=this.min[2],this.vertex[4][0]=this.max[0],this.vertex[4][1]=this.min[1],this.vertex[4][2]=this.min[2],this.vertex[5][0]=this.max[0],this.vertex[5][1]=this.min[1],this.vertex[5][2]=this.max[2],this.vertex[6][0]=this.max[0],this.vertex[6][1]=this.max[1],this.vertex[6][2]=this.max[2],this.vertex[7][0]=this.max[0],this.vertex[7][1]=this.max[1],this.vertex[7][2]=this.min[2],this.vertex}copy(e){return e?X$7.copy(e,this):new X$7(this.min.slice(),this.max.slice())}equals(e){if(!equals$5(this.min,e.min)||!equals$5(this.max,e.max))return!1;const n=e.vertex;for(let e=0;e<this.vertex.length;e++)if(!equals$5(n[e],this.vertex[e]))return!1;return!0}transform(e,r){if(e=e||V$6,(r=r||V$6)[1]||r[2]||r[4]||r[6]||r[8]||r[9]){const i=this.vertex,o=multiply$5(U$6,r,e);for(let e=0;e<i.length;e++)transformMat4$2(this.vertex[e],this.vertex[e],o);const a=this.vertex.map((e=>e[0])),s=this.vertex.map((e=>e[1])),c=this.vertex.map((e=>e[2])),l=Math.min(...a),f=Math.max(...a),d=Math.min(...s),u=Math.max(...s),h=Math.min(...c),m=Math.max(...c);set$4(this.min,l,d,h),set$4(this.max,f,u,m)}else{const i=multiply$5(U$6,r,e);transformMat4$2(this.min,this.min,i),transformMat4$2(this.max,this.max,i)}return this}}const W$6=[],K$7={5120:"int8",5122:"int16",5124:"int32",5121:"uint8",5123:"uint16",5125:"uint32",5126:"float"},q$7={5120:1,5122:2,5124:4,5121:1,5123:2,5125:4,5126:4},Y$6={positionSize:3,primitive:"triangles",positionAttribute:"aPosition",normalAttribute:"aNormal",uv0Attribute:"aTexCoord",uv1Attribute:"aTexCoord1",color0Attribute:"aColor0",tangentAttribute:"aTangent",pickingIdAttribute:"aPickingId",textureCoordMatrixAttribute:"aTextureCoordMatrix"};let J$7=1;const Z$7="_reshader_refCount";class Q$7{constructor(e,n,t,r){this._version=0,this.data=e,this.elements=n,this.desc=v$3({},Y$6,r);const i=this._getPosAttritute();this.data[this.desc.positionAttribute]=i,t||(this.elements?t=$$6(this.elements):i&&i.length?t=i.length/this.desc.positionSize:i&&i.interleavedArray?t=i.interleavedArray.length/this.desc.positionSize:i&&i.array&&(t=i.array.length/this.desc.positionSize)),this.count=t,this.elements||(this.elements=t),this.properties={},this._buffers={},this._vao={},this.getVertexCount(),this._prepareData(!0),this.updateBoundingBox()}set version(e){throw new Error("Geometry.version is read only.")}get version(){return this._version}_getPosAttritute(){return this.data[this.desc.positionAttribute]}_prepareData(e){if(!this.data)return;const n=this._buffers||{};for(const t in this.data){const r=this.data[t];if(r)if(r.buffer&&r.buffer.destroy){const n=r.buffer;n[Z$7]||(n[Z$7]=0),e&&n[Z$7]++}else if(r&&r.array)if(E$6(r)){let e=r.array.buffer.__id;e||(e=r.array.buffer.__id=J$7++),this.data[t]={buffer:e,offset:r.byteOffset,stride:r.byteStride,type:K$7[r.componentType],size:r.itemSize,count:r.count,componentType:r.componentType},n[e]||(n[e]={data:r.array.buffer})}else this.data[t]=r.array}this._buffers=n;const t=this.elements;t&&t.array&&(this.elements=this.elements.array)}getAttrData(e){const n=e.key,t=!this._reglData||!this._reglData[n];if(this._reglData||(this._reglData={}),t){const e=this._reglData[n]={},t=this.data,{positionAttribute:r,normalAttribute:i,uv0Attribute:o,uv1Attribute:a,tangentAttribute:s,color0Attribute:c,pickingIdAttribute:l,textureCoordMatrixAttribute:f}=this.desc;v$3(e,this.data),e.aPosition=t[r],t[i]&&(e.aNormal=t[i]),t[o]&&(e.aTexCoord=t[o]),t[a]&&(e.aTexCoord1=t[a]),t[s]&&(e.aTangent=t[s]),t[c]&&(e.aColor0=t[c]),t[l]&&(e.aPickingId=t[l]),t[f]&&(e.aTextureCoordMatrix=t[f])}return this._reglData[n]}getREGLData(e,n,t){this.getAttrData(n);const r=!this._reglData||!this._reglData[n.key];if(A$4(e)&&!t){const t=n&&n.key||"default";if(!this._vao[t]||r||this._vao[t].dirty){const r=this._reglData[n.key],i=this._vertexCount,o=[];for(let e=0;e<n.length;e++){const t=n[e].name,a=r[t]&&r[t].buffer;if(a&&a.destroy)o.push(void 0!==r[t].stride?r[t]:a);else{const e=r[t];if(!e){o.push(this.desc.fillEmptyDataInMissingAttribute?new Uint8Array(4*i):W$6);continue}const n=(e.data&&b$5(e.data)?e.data.length:e.length)/i;e.data?(e.dimension=n,o.push(e)):o.push({data:e,dimension:n})}}const a={attributes:o,primitive:this.getPrimitive()};if(this.elements&&!g$1(this.elements))if(this.elements.destroy)a.elements=this.elements;else{a.elements={primitive:this.getPrimitive(),data:this.elements};const e=this.getElementsType(this.elements);e&&(a.elements.type=e)}this._vao[t]?this._vao[t].vao(a):this._vao[t]={vao:e.vao(a)}}return delete this._vao[t].dirty,this._vao[t]}return this._reglData[n.key]}_isAttrChanged(e){if(e===this._activeAttributes)return!1;if(e.length!==this._activeAttributes.length)return!0;for(let n=0;n<e.length;n++)if(e[n]!==this._activeAttributes[n])return!0;return!1}generateBuffers(e){const n=this._buffers;for(const t in n)n[t].buffer||(n[t].buffer=e.buffer(n[t].data)),delete n[t].data;const t=this.desc.positionAttribute,r=this.desc.altitudeAttribute,i=this.data,o=this._vertexCount,a={};for(const s in i)if(i[s]){if(void 0===i[s].buffer||i[s].buffer instanceof ArrayBuffer){const n=i[s].data?i[s]:{data:i[s]};n.dimension=(i[s].data?i[s].data:i[s]).length/o;const c=e.buffer(n);c[Z$7]=1,a[s]={buffer:c},s!==t&&s!==r||(a[s].array=i[s])}else i[s].buffer.destroy?a[s]=i[s]:n[i[s].buffer]&&(a[s]=v$3({},i[s]),a[s].buffer=n[i[s].buffer].buffer);(this.desc.static||s!==t)&&delete i[s].array}if(this.data=a,delete this._reglData,this.elements&&!g$1(this.elements)){const n={primitive:this.getPrimitive(),data:this.elements},t=this.getElementsType(this.elements);if(t&&(n.type=t),!this.desc.static&&!this.elements.destroy){this.indices=new Uint16Array(this.elements.length);for(let e=0;e<this.elements.length;e++)this.indices[e]=this.elements[e]}this.elements=this.elements.destroy?this.elements:e.elements(n);const r=this.elements;r[Z$7]||(r[Z$7]=0),r[Z$7]++}}getVertexCount(){const{positionAttribute:e,positionSize:n,color0Attribute:t}=this.desc;let r=this.data[e];r.data&&(r=r.data),r.array&&(r=r.array),b$5(r)?this._vertexCount=Math.ceil(r.length/n):r&&void 0!==r.count&&(this._vertexCount=r.count);const i=t;if(this.data[i]){const e=this.data[i].data||this.data[i].array||this.data[i];Array.isArray(e)?this._color0Size=e.length/this._vertexCount:e&&e.count?this._color0Size=e.count/this._vertexCount:this.data[i].buffer&&this.data[i].buffer.destroy&&(this._color0Size=this.data[i].buffer._buffer.dimension)}return this._vertexCount}getColor0Size(){return this._color0Size||0}addBuffer(e,n){return this._buffers[e]={data:n},delete this._reglData,this._deleteVAO(),this}updateBuffer(e,n){if(!this._buffers[e])throw new Error(`invalid buffer ${e} in geometry`);return this._buffers[e].buffer?this._buffers[e].buffer.subdata(n):this._buffers[e].data=n,delete this._reglData,this._deleteVAO(),this}deleteData(e){const n=this.data[e];return n?(this._incrVersion(),n.buffer&&n.buffer.destroy&&n.buffer.destroy(),delete this.data[e],delete this._reglData,this._markVAODirty(),this):this}updateData(e,n){const t=this.data[e];if(!t)return this;let r;return this._incrVersion(),this.data[e]=n,t.buffer&&t.buffer.destroy&&(r=t),e===this.desc.positionAttribute&&this.updateBoundingBox(),this.getVertexCount(),r&&(r.buffer(n),this.data[e]=r),this._prepareData(!1),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}updateSubData(e,n,t){const r=this.data[e];if(!r)return this;let i;if(this._incrVersion(),r.buffer&&r.buffer.destroy&&(i=r),e===this.desc.positionAttribute&&this._updateSubBoundingBox(n),i){const e=q$7[i.buffer._buffer.dtype];n.BYTES_PER_ELEMENT!==e&&(n=new(function(e,n){return e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray?1===n?Uint8Array:2===n?Uint16Array:Uint32Array:e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array?1===n?Int8Array:2===n?Int16Array:Int32Array:e instanceof Float32Array||e instanceof Float64Array?4===n?Float32Array:Float64Array:null}(n,e))(n)),i.buffer.subdata(n,t*e)}else{const r=this.data[e].data?this.data[e].data:this.data[e];for(let e=0;e<n.length;e++)r[t+e]=n[e]}return this._prepareData(!1),this.desc.positionAttribute===e&&(this._posDirty=!0),delete this._reglData,this}getPrimitive(){return this.desc.primitive}getElements(){return this.elements}setElements(e,n){if(!e)throw new Error("elements data is invalid");this._incrVersion();const t=this.elements;return this.count=void 0===n?$$6(e):n,this.elements=e&&e.destroy?e:t.destroy?t(e):e,this._markVAODirty(!0),this}deleteElements(){return this.elements&&0!==this.elements.length?(this._incrVersion(),this.elements&&this.elements.destroy&&!this.elements[H$6]&&(this.elements.destroy(),this.elements[H$6]=1),this.elements=[],this._markVAODirty(!0),this):this}_markVAODirty(e){if(this._vao){for(const n in this._vao)e?this._vao[n].vao.destroy():this._vao[n].dirty=!0;e&&(this._vao={})}}setDrawCount(e){return this._incrVersion(),this.count1=e,this}getDrawCount(){return this.count1>=0?this.count1:this.count}setDrawOffset(e){return this._incrVersion(),this.offset=e,this}getDrawOffset(){return this.offset||0}dispose(){if(this._deleteVAO(),this._forEachBuffer((e=>{if(!e[H$6]){let n=e[Z$7];n&&n--,n<=0?(e[H$6]=!0,e.destroy()):e[Z$7]=n}})),this.properties){const e=this.properties.oldElementsBeforeHighlight;e&&!e[H$6]&&e.destroy&&(e.destroy(),e[H$6]=!0),delete this.properties.oldElementsBeforeHighlight,delete this.properties.hasInvisible}this.data={},this._buffers={},delete this._reglData,delete this._attributes,this.count=0,this.elements=[],delete this._tempPosArray,this._disposed=!0}isDisposed(){return!!this._disposed}updateBoundingBox(){let e=this.boundingBox;e||(e=this.boundingBox=new X$7);let n,r,i=this.data[this.desc.positionAttribute];if(b$5(i)||(i.data?i=i.data:P$5(i)?i=this._getAttributeData(this.desc.positionAttribute):i.array&&(n=i.min,r=i.max,i=i.array)),i&&i.length){const o=e.min,a=e.max;if(n&&r)set$4(o,...n),set$4(a,...r);else{set$4(o,i[0],i[1],i[2]),set$4(a,i[0],i[1],i[2]);for(let e=3;e<i.length;){const n=i[e++],t=i[e++],r=i[e++];n<o[0]&&(o[0]=n),t<o[1]&&(o[1]=t),r<o[2]&&(o[2]=r),n>a[0]&&(a[0]=n),t>a[1]&&(a[1]=t),r>a[2]&&(a[2]=r)}}e.updateVertex(),e.dirty()}}_updateSubBoundingBox(e){const n=this.boundingBox,t=n.min,r=n.max,i=this.desc.positionSize;for(let n=0;n<e.length;){const o=e[n++],a=e[n++];let s=0;3===i&&(s=e[n++]),o<t[0]&&(t[0]=o),a<t[1]&&(t[1]=a),s<t[2]&&(t[2]=s),o>r[0]&&(r[0]=o),a>r[1]&&(r[1]=a),s>r[2]&&(r[2]=s)}n.updateVertex(),n.dirty()}_getAttributeData(n){const t=this.data[n]&&this.data[n].array?this.data[n].array:this.data[n],r=t.buffer;if(P$5(t)){const i=this._buffers[r]?this._buffers[r].data:t.array,{count:o,size:a,stride:s,offset:c,componentType:l}=t,f=X$8.getTypedArrayCtor(l);if((0===s||s===a*f.BYTES_PER_ELEMENT)&&c%f.BYTES_PER_ELEMENT==0)return new f(i,c,o*a);if(n===this.desc.positionAttribute)return!this._tempPosArray||this._tempPosArray&&this._tempPosArray.length<a*o?(this._tempPosArray=new f(a*o),X$8.readInterleavedArray(this._tempPosArray,i,o,a,s,c,l)):this._posDirty?(this._posDirty=!1,X$8.readInterleavedArray(this._tempPosArray,i,o,a,s,c,l)):this._tempPosArray;{const n=new f(a*o);return X$8.readInterleavedArray(n,i,o,a,s,c,l)}}return t}createTangent(e="aTangent"){this._incrVersion();const{normalAttribute:n,positionAttribute:i,uv0Attribute:o}=this.desc,a=this._getAttributeData(n),f=buildTangents(this._getAttributeData(i),a,this.data[o],this.elements),d=this.data[e]=new Float32Array(f.length),u=[],h=[],m=[];for(let e=0;e<f.length;e+=4){const n=e/4*3;set$4(h,a[n],a[n+1],a[n+2]),set$3(u,f[e],f[e+1],f[e+2],f[e+3]),packTangentFrame(m,h,u),copy$3(d.subarray(e,e+4),m)}delete this._reglData}createNormal(e="aNormal"){this._incrVersion();const n=this._getAttributeData(this.desc.positionAttribute);this.data[e]=buildNormals(n.array||n,this.elements),delete this._reglData}createBarycentric(e="aBarycentric"){if("triangles"!==this.desc.primitive)throw new Error("Primitive must be triangles to create bary centric data");this._incrVersion();const n=new Uint8Array(3*this._vertexCount);for(let e=0,t=this.elements.length;e<t;)for(let t=0;t<3;t++)n[3*this.elements[e++]+t]=1;this.data[e]=n,delete this._reglData}buildUniqueVertex(){this._incrVersion();const e=this.data,n=this.elements;if(!b$5(n))throw new Error("elements must be array to build unique vertex.");const t=Object.keys(e),r={};let i=e[this.desc.positionAttribute];if(i=i.length?i:i.array,!b$5(i))throw new Error(this.desc.positionAttribute+" must be array to build unique vertex.");const o=this._vertexCount,a=n.length;for(let n=0;n<t.length;n++){const i=t[n],s=b$5(e[i])?e[i]:e[i].array,c=s.length/o;if(!b$5(s))throw new Error(i+" must be array to build unique vertex.");r[i]=s,e[i]=new s.constructor(a*c)}let s=0;for(let i=0;i<a;i++){const a=n[i];for(let n=0;n<t.length;n++){const i=t[n],c=e[i],l=r[i].length/o;for(let e=0;e<l;e++)c[s*l+e]=r[i][a*l+e]}n[i]=s++}i=this.data[this.desc.positionAttribute],this._vertexCount=Math.ceil(i.length/this.desc.positionSize),delete this._reglData}getMemorySize(){let e=0;for(const n in this.data)S$6(this.data,n)&&(e+=T$6(this.data[n]));if(this.elements){const n=this.elements;n.destroy?e+=n._elements.buffer.byteLength:n.BYTES_PER_ELEMENT?e+=n.length*n.BYTES_PER_ELEMENT:n.length&&(e+=4*n.length)}return e}_deleteVAO(){for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}_forEachBuffer(e){this.elements&&this.elements.destroy&&e(this.elements);for(const n in this.data)S$6(this.data,n)&&this.data[n]&&this.data[n].buffer&&this.data[n].buffer.destroy&&e(this.data[n].buffer);for(const n in this._buffers)S$6(this._buffers,n)&&this._buffers[n]&&this._buffers[n].buffer&&this._buffers[n].buffer.destroy&&e(this._buffers[n].buffer)}getElementsType(e){return e instanceof Uint8Array?"uint8":e instanceof Uint16Array?"uint16":e instanceof Uint32Array?"uint32":void 0}_incrVersion(){this._version++}}function $$6(e){if(g$1(e))return e;if(void 0!==e.count)return e.count;if(e.destroy)return e._elements.vertCount;if(void 0!==e.length)return e.length;if(e.data)return e.data.length;throw new Error("invalid elements length")}const ee$5=["points","lines","line strip","line loop","triangles","triangle strip","triangle fan"];function ne$5(e){return ee$5[e]}const te$5={5121:"uint8",5123:"uint16",5125:"uint32",5126:"float",36193:"half float"};function re$5(e){return te$5[e]}const ie$5={6406:"alpha",6407:"rgb",6408:"rgba",6409:"luminance",6410:"luminance alpha",33776:"rgb s3tc dxt1",33777:"rgba s3tc dxt1",33778:"rgba s3tc dxt3",33779:"rgba s3tc dxt5",35840:"rgb pvrtc 4bppv1",35841:"rgb pvrtc 2bppv1",35842:"rgba pvrtc 4bppv1",35843:"rgba pvrtc 2bppv1",35986:"rgb atc",35987:"rgba atc explicit alpha",34798:"rgba atc interpolated alpha",36196:"rgb etc1"};function oe$5(e){return ie$5[e]}const ae$5={9729:"linear",9728:"nearest"};function se$5(e){return ae$5[e]}const ce$5={9729:"linear",9728:"nearest",9984:"nearest mipmap nearest",9985:"linear mipmap nearest",9986:"nearest mipmap linear",9987:"linear mipmap linear"};function le$5(e){return ce$5[e]}const fe$5={10497:"repeat",33071:"clamp",33648:"mirror"};function de$5(e){return fe$5[e]}const ue$5="__reshader_webgl_buffer",he$5="__reshader_webgl_tex";function me$5(e,n,t){let r;if(b$5(n)?n.buffer&&void 0!==n.byteOffset&&(r=n):n.array&&n.array.buffer&&void 0!==n.array.byteOffset&&(r=n.array),!r)return null;const i=r.buffer,o=r.byteOffset;i[ue$5]||(i[ue$5]={});let a=i[ue$5][o];if(!a){const n={};t&&v$3(n,t),n.data=r,a=e.buffer(n),i[ue$5][o]=a}return a}function ve$5(e,n){const t=n.data;if(!t||!t.buffer)return e.texture(n);const r=t.buffer,i=t.byteOffset;r[he$5]||(r[he$5]={});let o=r[he$5][i];return o||(o=e.texture(n),r[he$5][i]=o),o}var _e$5=Object.freeze({__proto__:null,getPrimitive:ne$5,getMaterialType:re$5,getMaterialFormat:oe$5,getTextureMagFilter:se$5,getTextureMinFilter:le$5,getTextureWrap:de$5,getUniqueREGLBuffer:me$5,getUniqueTexture:ve$5});const ge$5=[],xe$5=[],be$5=[],pe$5=[],ye$5=[],Ae$5=[],Se$5=["a","b","c"];class Te$5 extends Q$7{constructor(e,n,t,r){super(e,n,t,{primitive:ne$5(1),positionAttribute:r.positionAttribute})}_getPosAttritute(){const e=this.data[this.desc.positionAttribute];if(!e)return null;const n=Math.pow(10,4),t=Math.cos(Math.PI/180*.8),r=this.elements,i=e.length?e:e.array,o=r.length?r?r.length:i.length/3:r,a=[0,0,0],s=new Array(3),c={},l=[],f=new Me$5;for(let e=0;e<o;e+=3){r.length?(a[0]=r[e],a[1]=r[e+1],a[2]=r[e+2]):(a[0]=e,a[1]=e+1,a[2]=e+2),f.a=this._getPos(pe$5,i,a[0]),f.b=this._getPos(ye$5,i,a[1]),f.c=this._getPos(Ae$5,i,a[2]);const o=f.getNormal(),d=f.a,u=f.b,h=f.c;if(s[0]=`${Math.round(d[0]*n)},${Math.round(d[1]*n)},${Math.round(d[2]*n)}`,s[1]=`${Math.round(u[0]*n)},${Math.round(u[1]*n)},${Math.round(u[2]*n)}`,s[2]=`${Math.round(h[0]*n)},${Math.round(h[1]*n)},${Math.round(h[2]*n)}`,s[0]!==s[1]&&s[1]!==s[2]&&s[2]!==s[0])for(let e=0;e<3;e++)this._calEdgeData(e,a,f,c,s,t,o,l)}for(const e in c)if(c[e]){const{index0:n,index1:t}=c[e];l.push(i[3*n],i[3*n+1],i[3*n+2]),l.push(i[3*t],i[3*t+1],i[3*t+2])}return this.elements=this._createElements(l),l}_getPos(e,n,r){return set$4(e,n[3*r],n[3*r+1],n[3*r+2])}_calEdgeData(e,n,r,i,o,a,s,c){const l=(e+1)%3,f=o[e],d=o[l],u=r[Se$5[e]],h=r[Se$5[l]],m=`${f}_${d}`,v=`${d}_${f}`;v in i&&i[v]?(dot$4(s,i[v].normal)<=a&&(c.push(u[0],u[1],u[2]),c.push(h[0],h[1],h[2])),i[v]=null):m in i||(i[m]={index0:n[e],index1:n[l],normal:copy$4([],s)})}_createElements(e){const n=[],t=e.length/3;for(let e=0;e<t;e++)n.push(e);return n}}class Me$5{constructor(e=[0,0,0],n=[0,0,0],t=[0,0,0]){this.a=e,this.b=n,this.c=t}getNormal(){const e=sub$2(ge$5,this.a,this.b),n=sub$2(xe$5,this.a,this.c);cross$1(be$5,e,n);const r=length$4(be$5);return set$4(be$5,be$5[0]/r,be$5[1]/r,be$5[2]/r)}}var Ce$5=F$6(class{constructor(e={},n){this._version=0,this.uniforms=_$6({},n||{},e);for(const n in e){const t=Object.getOwnPropertyDescriptor(e,n).get;t&&Object.defineProperty(this.uniforms,n,{get:t})}this._reglUniforms={},this.refCount=0,this._bindedOnTextureComplete=this._onTextureComplete.bind(this),this._genUniformKeys(),this._checkTextures()}set version(e){throw new Error("Material.version is read only.")}get version(){return this._version}set doubleSided(e){this._doubleSided=e}get doubleSided(){return this._doubleSided}isReady(){return this._loadingCount<=0}set(e,n){const t=d$2(this.uniforms[e])&&!d$2(n)||!d$2(this.uniforms[e])&&d$2(n);if(this.uniforms[e]&&this.isTexture(e)&&this.uniforms[e].dispose(),d$2(n))d$2(this.uniforms[e])||delete this.uniforms[e];else if(this.uniforms[e]=n,this._reglUniforms){const t=Object.getOwnPropertyDescriptor(this._reglUniforms,e);t&&!t.get&&(this._dirtyProps=this._dirtyProps||[],this._dirtyProps.push(e),this._reglUniforms[e]=n)}return this.isTexture(e)&&this._checkTextures(),t&&(this._genUniformKeys(),this._incrVersion()),this}_getDirtyProps(){return this._dirtyProps}_clearDirtyProps(){this._dirtyProps=null}get(e){return this.uniforms[e]}isDirty(){return this._uniformVer!==this.version}appendDefines(e){const n=this.uniforms;return n?(n.jointTexture&&(e.HAS_SKIN=1),n.morphWeights1&&(e.HAS_MORPH=1),(n.khr_offset||n.khr_rotation||n.khr_scale)&&(e.HAS_KHR_TEXTURE_TRANSFORM=1),e):e}hasSkinAnimation(){return this.uniforms&&this.uniforms.jointTexture&&this.uniforms.skinAnimation}getUniforms(e){if(this._reglUniforms&&!this.isDirty())return this._reglUniforms;const n=this.uniforms,t={};for(const r in n)this.isTexture(r)?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n[r].getREGLTexture(e)}}):Object.getOwnPropertyDescriptor(n,r).get?Object.defineProperty(t,r,{enumerable:!0,configurable:!0,get:function(){return n[r]}}):t[r]=n[r];return this._reglUniforms=t,this._uniformVer=this.version,t}isTexture(e){return this.uniforms[e]instanceof z$6}dispose(){for(const e in this.uniforms){const n=this.uniforms[e];n&&(n.dispose?n.dispose():n.destroy&&!n[H$6]&&(n.destroy(),n[H$6]=!0))}delete this.uniforms,delete this._reglUniforms,this._disposed=!0}isDisposed(){return!!this._disposed}_checkTextures(){this._loadingCount=0;for(const e in this.uniforms)if(this.isTexture(e)){const n=this.uniforms[e];n.isReady()||(this._loadingCount++,n.on("complete",this._bindedOnTextureComplete))}}_onTextureComplete(){this._loadingCount--,this._incrVersion(),this._loadingCount<=0&&(this._disposed||this.fire("complete"))}getUniformKeys(){return this._uniformKeys}_genUniformKeys(){const e=[];for(const n in this.uniforms)S$6(this.uniforms,n)&&!d$2(this.uniforms[n])&&e.push(n);this._uniformKeys=e.join()}_incrVersion(){this._version++}getMemorySize(){const e=this.uniforms;let n=0;for(const t in e)this.isTexture(t)?n+=e[t].getMemorySize():this.uniforms[t].destroy&&(n+=M$6(this.uniforms[t]));return n}});const Oe$5={time:0,seeThrough:!0,thickness:.03,fill:[1,.5137254902,.98,1],stroke:[.7019607843,.9333333333,.2274509804,1],dashEnabled:!1,dashAnimate:!1,dashRepeats:1,dashLength:.8,dashOverlap:!0,insideAltColor:!1,squeeze:!1,squeezeMin:.5,squeezeMax:1,dualStroke:!1,secondThickness:.05,opacity:1,noiseEnable:!1};const Pe$5={baseColorFactor:[1,1,1,1],materialShininess:32,environmentExposure:1,specularStrength:32,opacity:1,extrusionOpacity:0,extrusionOpacityRange:[0,1.8],baseColorTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null,uvScale:[1,1],uvOffset:[0,0],alphaTest:0};class Ie$5 extends Ce$5{constructor(e){super(e,Pe$5)}static convertFrom(e){const n={};for(const t in Pe$5)n[t]=e.get(t);return new Ie$5(n)}appendDefines(e,n){super.appendDefines(e,n);const t=this.uniforms;return t.extrusionOpacity&&(e.HAS_EXTRUSION_OPACITY=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1),n.data[n.desc.uv0Attribute]?(t.baseColorTexture&&(e.HAS_BASECOLOR_MAP=1),t.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),t.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),t.normalTexture&&(e.HAS_NORMAL_MAP=1),(e.HAS_BASECOLOR_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP)&&(e.HAS_MAP=1),e):e}}const we$5={toons:4,specularToons:2};const Re$5={baseColorFactor:[1,1,1,1],uvScale:[1,1],uvOffset:[0,0],opacity:1,envMapExposure:128,emissiveFactor:[.1,.1,.1],specularFactor:[0,0,0],envRotationSin:0,envRotationCos:1,reflectivity:.01,themingColor:[0,0,0,0],exposureBias:.6};class Ne$5 extends Ce$5{constructor(e){super(e,Re$5)}appendDefines(e,n){super.appendDefines(e,n);const t=this.uniforms;return t.extrusionOpacity&&(e.HAS_EXTRUSION_OPACITY=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.uv0Attribute]?(t.baseColorTexture&&(e.HAS_BASECOLOR_MAP=1),t.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),t.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),t.normalTexture&&(e.HAS_NORMAL_MAP=1),(e.HAS_BASECOLOR_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP)&&(e.HAS_MAP=1),e.ALPHATEST=.01,e.GAMMA_INPUT=1,e.GAMMA_FACTOR=1,e.TONEMAP_OUTPUT=1,e.ENVMAP_MODE_REFLECTION=1,e.ENV_RGBM=1,e.IRR_RGBM=1,e):e}}const Fe$5={diffuseFactor:[1,1,1,1],specularFactor:[1,1,1],glossinessFactor:1,diffuseTexture:null,specularGlossinessTexture:null,normalTexture:null,emissiveTexture:null,occlusionTexture:null},He$5=e=>class extends e{constructor(e){super(e=v$3({},Fe$5,e||{}))}appendDefines(e,n){if(super.appendDefines(e,n),e.SHADING_MODEL_SPECULAR_GLOSSINESS=1,!n.data[n.desc.uv0Attribute])return e;const t=this.uniforms;return t.diffuseTexture&&(e.HAS_DIFFUSE_MAP=1),t.specularGlossinessTexture&&(e.HAS_SPECULARGLOSSINESS_MAP=1),(e.HAS_SPECULARGLOSSINESS_MAP||e.HAS_DIFFUSE_MAP)&&(e.HAS_MAP=1),e}};class Le$5 extends(He$5(Ie$5)){}const ze$5=[];let ke$5=0;class Be$5{constructor(e,t,r={}){this._version=0,this._geometry=e,this._material=t,this.transparent=!!r.transparent,this.bloom=!!r.bloom,this.ssr=!!r.ssr,this.castShadow=d$2(r.castShadow)||r.castShadow,this.picking=!!r.picking,this.disableVAO=!!r.disableVAO,this.uniforms={},this._localTransform=identity$2(new Array(16)),this._positionMatrix=identity$2(new Array(16)),this.properties={},this._dirtyUniforms=!0,this._dirtyGeometry=!0,Object.defineProperty(this,"uuid",{value:ke$5++}),ke$5>Number.MAX_VALUE-10&&(ke$5=0)}set material(e){this._material!==e&&this.setMaterial(e)}get material(){return this._material}set version(e){throw new Error("Mesh.version is read only.")}get version(){return this._version}get geometry(){return this._geometry}set geometry(e){this._geometry!==e&&(this._incrVersion(),this._dirtyGeometry=!0),this._geometry=e}set localTransform(e){this._prevTMat||(this._prevTMat=[]),Array.isArray(e)&&!exactEquals$5(this._prevTMat,e)&&(this._incrVersion(),this._prevTMat=copy$5(this._prevTMat,e)),this._localTransform=e}get localTransform(){return this._localTransform}set positionMatrix(e){this._prevPMat||(this._prevPMat=[]),Array.isArray(e)&&!exactEquals$5(this._prevPMat,e)&&(this._incrVersion(),this._prevPMat=copy$5(this._prevPMat,e)),this._positionMatrix=e}get positionMatrix(){return this._positionMatrix}get config(){return this._cfg||(this._cfg={}),this._cfg.transparent=this.transparent,this._cfg.castShadow=this.castShadow,this._cfg.bloom=this.bloom,this._cfg.ssr=this.ssr,this._cfg.picking=this.picking,this._cfg}get defines(){return this._getDefines()}set defines(e){this.setDefines(e)}setMaterial(e){return this._material=e,this._dirtyUniforms=!0,delete this._materialVer,this.dirtyDefines=!0,this}setParent(e){return this.parent=e,this}setLocalTransform(e){return this.localTransform=e,this}setPositionMatrix(e){this.positionMatrix=e}setUniform(e,n){return void 0===this.uniforms[e]?this._dirtyUniforms=!0:(this._dirtyProps=this._dirtyProps||[],this._dirtyProps.push(e)),this.uniforms[e]=n,this}getUniform(e){return this.uniforms[e]}getDefines(){const e={};return v$3(e,this._getDefines()),this._material&&this._geometry&&this._material.appendDefines(e,this._geometry),e}_getDefines(){this._defines||(this._defines={});const e=this._geometry,n=e.data[e.desc.positionAttribute],t=e.data[e.desc.uv0Attribute],r=e.data[e.desc.normalAttribute];return n&&n.quantization&&(this._defines.HAS_DRACO_POSITION=1),t&&t.quantization&&(this._defines.HAS_DRACO_TEXCOORD=1),r&&r.quantization&&(this._defines.HAS_DRACO_NORMAL=1),this._defines}setDefines(e){const n=this._bakDefines;return this._defines=e,this.dirtyDefines=this.dirtyDefines||!!n!=!!e||!function(e,n){if(!e&&!n)return!0;const t=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(n);if(t.length!==r.length)return!1;for(let r=0;r<t.length;r++)if(e[t[r]]!==n[t[r]])return!1;return!0}(n,e),this.dirtyDefines&&(this._bakDefines=v$3({},e)),this}hasSkinAnimation(){return this._material&&this._material.hasSkinAnimation()}_getDefinesKey(){return this.dirtyDefines=!1,this._createDefinesKey(this.getDefines())}getCommandKey(){if(!this._commandKey||this.dirtyDefines||this._material&&this._materialKeys!==this._material.getUniformKeys()){let e=this._getDefinesKey();e+="_"+(g$1(this.getElements())?"count":"elements"),e+="_"+ +!!this.disableVAO,this._material&&(e+="_"+ +!!this._material.doubleSided),this._commandKey=e,this._material&&(this._materialKeys=this._material.getUniformKeys())}return this._commandKey}getUniforms(e){if(this._dirtyUniforms||this._dirtyGeometry||this._material&&this._materialVer!==this._material.version){this._realUniforms={},this._getUniformsForDraco();const n=this.uniforms;for(const e in this.uniforms)S$6(this.uniforms,e)&&(Object.getOwnPropertyDescriptor(n,e).get?Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return n[e]}}):this._realUniforms[e]=n[e]);if(this._material){const n=this._material.getUniforms(e);for(const e in n)S$6(n,e)&&!S$6(this._realUniforms,e)&&(Object.getOwnPropertyDescriptor(n,e).get?Object.defineProperty(this._realUniforms,e,{enumerable:!0,configurable:!0,get:function(){return n[e]}}):this._realUniforms[e]=n[e])}this._dirtyUniforms=!1,this._dirtyGeometry=!1,this._materialVer=this._material&&this._material.version,this._material&&this._material._clearDirtyProps(),this._dirtyProps=null}else if(this._dirtyProps||this._material&&this._material._getDirtyProps()){if(this._dirtyProps)for(const e of this._dirtyProps)this._realUniforms[e]=this.uniforms[e];const n=this._material&&this._material._getDirtyProps();if(n){const t=this._material.getUniforms(e);for(const e of n)this._realUniforms[e]=t[e];this._material._clearDirtyProps()}this._dirtyProps=null}return this._realUniforms.modelMatrix=h$2(this._localTransform)?this._localTransform():this._localTransform,this._realUniforms.positionMatrix=h$2(this._positionMatrix)?this._positionMatrix():this._positionMatrix,this._realUniforms}_getUniformsForDraco(){const e=this._geometry,n=e.data[e.desc.positionAttribute],t=e.data[e.desc.uv0Attribute],r=e.data[e.desc.normalAttribute];if(n&&n.quantization){const e=n.quantization,t=e.range/(1<<e.quantizationBits);this._realUniforms.minValues_pos=e.minValues,this._realUniforms.gltf_u_dec_position_normConstant=t}if(t&&t.quantization){const e=t.quantization;this._realUniforms.minValues_tex=e.minValues,this._realUniforms.gltf_u_dec_texcoord_0_normConstant=e.range/(1<<e.quantizationBits)}r&&r.quantization&&(this._realUniforms.gltf_u_dec_normal_rangeConstant=(1<<r.quantization.quantizationBits)-1)}getMaterial(){return this._material}getElements(){return this._geometry.getElements()}_getREGLAttrData(e,n){return this._geometry.getREGLData(e,n,this.disableVAO)}getREGLProps(e,n){const t=this.getUniforms(e);return v$3(t,this._getREGLAttrData(e,n)),A$4(e)&&!this.disableVAO||(t.elements=this._geometry.getElements()),t.meshProperties=this.properties,t.meshConfig=this.config,t.count=this._geometry.getDrawCount(),t.offset=this._geometry.getDrawOffset(),t.primitive=this._geometry.getPrimitive(),t}dispose(){return delete this._geometry,delete this._material,this.uniforms={},this}isValid(){return this._geometry&&!this._geometry.isDisposed()&&(!this._material||!this._material.isDisposed())}getBoundingBox(){return this._bbox||this.updateBoundingBox(),multiply$5(ze$5,this._localTransform,this._positionMatrix),exactEquals$5(ze$5,this._currentTransform)&&this._geometry.boundingBox.equals(this._geoBox)||this.updateBoundingBox(),this._bboxArr}updateBoundingBox(){const e=this._geometry.boundingBox;this._bbox||(this._bbox=new X$7),this._bboxArr||(this._bboxArr=[[],[]]),this._geoBox||(this._geoBox=new X$7),X$7.copy(this._bbox,e),this._bbox.updateVertex(),"InstancedMesh"===this.constructor.name?(this._bbox.transform(this._localTransform,this._positionMatrix),this._currentTransform=multiply$5(this._currentTransform||[],this._positionMatrix,this._localTransform)):(this._bbox.transform(this._positionMatrix,this._localTransform),this._currentTransform=multiply$5(this._currentTransform||[],this._localTransform,this._positionMatrix)),X$7.copy(this._geoBox,e),copy$4(this._bboxArr[0],this._bbox.min),copy$4(this._bboxArr[1],this._bbox.max)}_createDefinesKey(e){const n=[];for(const t in e)n.push(t,e[t]);return n.join(",")}_incrVersion(){this._version++}getMemorySize(){return(this.geometry&&this.geometry.getMemorySize()||0)+(this.material&&this.material.getMemorySize()||0)}}Be$5.prototype.getWorldTransform=function(){const e=[];return function(){const t=this.parent;return t?multiply$5(e,t.getWorldTransform(),this._localTransform):this._localTransform}}();class Ge$5 extends Be$5{constructor(e,n,t,r,i={}){super(t,r,i),this._instanceCount=n,this.instancedData=e||{},this._checkInstancedProp(),this._vao={}}get instanceCount(){return this._instanceCount}set instanceCount(e){this._incrVersion(),this._instanceCount=e}getMemorySize(){return super.getMemorySize()+this._getInstanceMemorySize()}_getInstanceMemorySize(){let e=0;for(const n in this.instancedData)S$6(this.instancedData,n)&&(e+=T$6(this.instancedData[n]));return e}_checkInstancedProp(){for(const e in this.instancedData)if(this.geometry.data[e])throw new Error(`Duplicate attribute ${e} defined in geometry and instanced data`)}_getREGLAttrData(e,n){const t=this.geometry.getAttrData(n);if(A$4(e)){const r=n.key;if(!this._vao[r]||this._vao[r].dirty){const i=n.map((e=>e.name)),o=[];for(let e=0;e<i.length;e++){const n=t[i[e]];o.push(n&&n.buffer||this.instancedData[i[e]])}const a={attributes:o,primitive:this.geometry.getPrimitive()};this._vao[r]?this._vao[r].vao(a):this._vao[r]={vao:e.vao(a)},delete this._vao[r].dirty}return this._vao[r]}return t}getDefines(){const e=super.getDefines();return e.HAS_INSTANCE=1,e}getCommandKey(e){return"i_"+super.getCommandKey(e)}updateInstancedData(e,n){const t=this.instancedData[e];if(!t)return this;if(this._incrVersion(),this.instancedData[e]=n,t.buffer&&t.buffer.destroy&&t.buffer.destroy(),this._vao)for(const e in this._vao)this._vao[e].dirty=!0;return this}generateInstancedBuffers(e){const n=this.instancedData,t={};for(const r in n)n[r]&&(void 0!==n[r].buffer&&n[r].buffer.destroy?(t[r]=n[r],t[r].divisor&&(t[r].divisor=1)):t[r]=n[r].destroy?{buffer:n[r],divisor:1}:{buffer:e.buffer({data:n[r],dimension:n[r].length/this._instanceCount}),divisor:1});return this.instancedData=t,this}getREGLProps(e,n){const t=super.getREGLProps(e,n);return A$4(e)||v$3(t,this.instancedData),t.elements=this.geometry.getElements(),t.instances=this._instanceCount,t}disposeInstanceData(){const e=this.instancedData;if(e)for(const n in e)e[n]&&e[n].destroy&&!e[n][H$6]&&(e[n][H$6]=1,e[n].destroy());this.instancedData={};for(const e in this._vao)this._vao[e].vao.destroy();this._vao={}}_getBytesPerElement(e){switch(e){case 5120:case 5121:return 1;case 5122:case 5123:return 2;case 5124:case 5125:case 5126:return 4}throw new Error("unsupported data type: "+e)}}const Ue$5={getArrayBuffer:(e,n)=>Ue$5.get(e,{responseType:"arraybuffer"},n),get:function(e,n,t){const r=Ue$5._getClient(t);if(r.open("GET",e,!0),n){for(const e in n.headers)r.setRequestHeader(e,n.headers[e]);r.withCredentials="include"===n.credentials,n.responseType&&(r.responseType=n.responseType)}return r.send(null),r},_wrapCallback:function(e,n){return function(){4===e.readyState&&(200===e.status?"arraybuffer"===e.responseType?0===e.response.byteLength?n(new Error("http status 200 returned without content.")):n(null,{data:e.response,cacheControl:e.getResponseHeader("Cache-Control"),expires:e.getResponseHeader("Expires"),contentType:e.getResponseHeader("Content-Type")}):n(null,e.responseText):n(new Error(e.statusText+","+e.status)))}},_getClient:function(e){let n;try{n=new XMLHttpRequest}catch(e){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(e){}}}return n.onreadystatechange=Ue$5._wrapCallback(n,e),n}};var Ve$5=F$6(class{constructor(e){this.defaultTexture=e,this.defaultCubeTexture=new Array(6),this.resources={}}get(e){return Array.isArray(e)?this._loadImages(e):this._loadImage(e)}getArrayBuffer(e){if(Array.isArray(e)){const n=e.map((e=>this.getArrayBuffer(e)));return Promise.all(n)}return new Promise(((n,t)=>{Ue$5.getArrayBuffer(e,((r,i)=>{r?t(r):n({url:e,data:i})}))}))}disposeRes(e){return Array.isArray(e)?e.forEach((e=>this._disposeOne(e))):this._disposeOne(e),this}isLoading(){return this._count&&this._count>0}getDefaultTexture(e){return Array.isArray(e)?this._getBlankTextures(e.length):this.defaultTexture}_disposeOne(e){const n=this.resources;n[e]&&(n[e].count--,n[e].count<=0&&delete n[e])}_loadImage(e){const n=this.resources;return n[e]?Promise.resolve({url:e,data:n[e].image}):new Promise(((t,r)=>{const i=new Image;i.crossOrigin="anonymous",i.onload=function(){n[e]={image:i,count:1},t({url:e,data:i})},i.onerror=function(e){r(e)},i.onabort=function(){r(`image(${e}) loading aborted.`)},i.src=e}))}_loadImages(e){const n=e.map((e=>this._loadImage(e,!0)));return Promise.all(n)}_getBlankTextures(e){const n=new Array(e);for(let e=0;e<6;e++)n.push(this.defaultTexture);return n}});const je$5=[],Xe$5=[];let We$5=0;class Ke$5{constructor(e){this._id=We$5++,this.sortedMeshes={},this.setMeshes(e),this._compareBinded=this._compare.bind(this),this.dirty()}setMeshes(e){if(this.clear(),!e||Array.isArray(e)&&!e.length||e===this.meshes)return this;e=Array.isArray(e)?e:[e],this.meshes=[];for(let n=0;n<e.length;n++){const t=e[n];t&&(t._scenes=t._scenes||{},t._scenes[this._id]=1,this.meshes.push(t))}return this.dirty(),this}addMesh(e){return!e||Array.isArray(e)&&!e.length||(Array.isArray(e)?e.forEach((e=>{e._scenes=e._scenes||{},e._scenes[this._id]||(e._scenes[this._id]=1,this.meshes.push(e),this.dirty())})):(e._scenes=e._scenes||{},e._scenes[this._id]||(e._scenes[this._id]=1,this.meshes.push(e),this.dirty()))),this}removeMesh(e){if(!e||Array.isArray(e)&&!e.length)return this;if(Array.isArray(e)){let n=!1;for(let t=0;t<e.length;t++)e[t]._scenes&&e[t]._scenes[this._id]&&(n=!0,this.dirty(),delete e[t]._scenes[this._id]);n&&(this.meshes=this.meshes.filter((n=>e.indexOf(n)<0)))}else{if(!e._scenes||!e._scenes[this._id])return this;const n=this.meshes.indexOf(e);n>=0&&this.meshes.splice(n,1),delete e._scenes[this._id],this.dirty()}return this}getMeshes(){return this.meshes||[]}clear(){if(this.meshes)for(let e=0;e<this.meshes.length;e++)delete this.meshes[e]._scenes[this._id];return this.meshes=[],this.sortedMeshes.opaques=[],this.sortedMeshes.transparents=[],this}dirty(){return this._dirty=!0,this}sortMeshes(e){const n=this.meshes;this.sortFunction&&n.sort(this.sortFunction);let t=this.sortedMeshes.transparents;if(this._dirty){const e=this.sortedMeshes.opaques=[];t=this.sortedMeshes.transparents=[];for(let r=0,i=n.length;r<i;r++)n[r].transparent?t.push(n[r]):e.push(n[r])}e&&t.length>1&&(this._cameraPosition=e,t.sort(this._compareBinded),delete this._cameraPosition),this._dirty=!1}getSortedMeshes(){return this._dirty&&this.sortMeshes(),this.sortedMeshes||[]}_compare(e,n){return transformMat4$2(je$5,e.geometry.boundingBox.getCenter(),e.localTransform),transformMat4$2(Xe$5,n.geometry.boundingBox.getCenter(),n.localTransform),dist$2(Xe$5,this._cameraPosition)-dist$2(je$5,this._cameraPosition)}}const qe$5=String.fromCharCode;function Ye$5(e,n,t,r){if(e[3]>0){const i=Math.pow(2,e[3]-128-8+r);n[t+0]=e[0]*i,n[t+1]=e[1]*i,n[t+2]=e[2]*i}else n[t+0]=0,n[t+1]=0,n[t+2]=0;return n[t+3]=1,n}function Je$5(e,n,t){const r=e[n]/t,i=e[n+1]/t,o=e[n+2]/t;let a=y$4(Math.max(Math.max(r,i),Math.max(o,1e-6)),0,1);a=Math.ceil(255*a)/255,e[n]=Math.min(255,r/a*255),e[n+1]=Math.min(255,i/a*255),e[n+2]=Math.min(255,o/a*255),e[n+3]=Math.min(255,255*a)}function Ze$5(e,n,t,r){let i=0,o=0,a=r;for(;a>0;)if(e[o][0]=n[t++],e[o][1]=n[t++],e[o][2]=n[t++],e[o][3]=n[t++],1===e[o][0]&&1===e[o][1]&&1===e[o][2]){for(let n=e[o][3]<<i>>>0;n>0;n--)(c=e[o])[0]=(s=e[o-1])[0],c[1]=s[1],c[2]=s[2],c[3]=s[3],o++,a--;i+=8}else o++,a--,i=0;var s,c;return t}function Qe$5(e,n,t,r){if(r<8|r>32767)return Ze$5(e,n,t,r);let i=n[t++];if(2!==i)return Ze$5(e,n,t-1,r);if(e[0][1]=n[t++],e[0][2]=n[t++],i=n[t++],(e[0][2]<<8>>>0|i)>>>0!==r)return null;for(let i=0;i<4;i++)for(let o=0;o<r;){let r=n[t++];if(r>128){r=(127&r)>>>0;const a=n[t++];for(;r--;)e[o++][i]=a}else for(;r--;)e[o++][i]=n[t++]}return t}function $e$5(e,n=0,t=9){const r=new Uint8Array(e),i=r.length;if("#?"!==function(e,n,t){let r="";for(let i=0;i<2;i++)r+=qe$5(e[i]);return r}(r))return null;for(var o=2;o<i&&("\n"!==qe$5(r[o])||"\n"!==qe$5(r[o+1]));o++);if(o>=i)return null;o+=2;let a="";for(;o<i;o++){const e=qe$5(r[o]);if("\n"===e)break;a+=e}const s=a.split(" "),c=parseInt(s[1]),l=parseInt(s[3]);if(!l||!c)return null;let f=o+1;const d=[];for(let e=0;e<l;e++){d[e]=[];for(let n=0;n<4;n++)d[e][n]=0}let u=0;const h=new Array(l*c*4);let m=0;for(let e=0;e<c;e++){if(f=Qe$5(d,r,f,l),!f)return null;for(let e=0;e<l;e++)Ye$5(d[e],h,m,n),u=Math.max(u,h[m],h[m+1],h[m+2],h[m+3]),m+=4}u=Math.min(u,t),m=0;for(let e=0;e<c;e++)for(let e=0;e<l;e++)Je$5(h,m,u),m+=4;return{width:l,height:c,pixels:h,rgbmRange:u}}class en$5 extends z$6{onLoad({data:e}){const n=this.config;if(n){if(n.hdr){if(!(e=$e$5(e.data,0,n.maxRange)))throw new Error("Invalid hdr data"+(n.url?":"+n.url:""));this.rgbmRange=e.rgbmRange,n.data=e.pixels}else n.data=e;n.width=n.width||e.width,n.height=n.height||e.height,this._updateREGL()}}createREGLTexture(e){if(b$5(this.config.data)||b$5(this.config.mipmap)){const n=ve$5(e,this.config);return n._reshader_refCount||(n._reshader_refCount=0),n._reshader_refCount++,n}return e.texture(this.config)}}class tn$5 extends Q$7{constructor(e){super({aPosition:new(p$5(e=e||0))([-1,-1,e,1,-1,e,-1,1,e,1,1,e]),aNormal:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1])},new Uint16Array([0,1,3,3,2,0]))}}const rn$5={vsm_shadow_vert:"\nuniform mat4 shadow_lightProjViewModelMatrix;\nvarying vec4 shadow_vLightSpacePos;\nvoid shadow_computeShadowPars(vec4 position) {\n    shadow_vLightSpacePos = shadow_lightProjViewModelMatrix * position;\n}",vsm_shadow_frag:"\nuniform sampler2D shadow_shadowMap;\nuniform float shadow_opacity;\nuniform vec3 shadow_color;\n#if defined(USE_ESM)\n    uniform float esm_shadow_threshold;\n#endif\nvarying vec4 shadow_vLightSpacePos;\n#ifdef PACK_FLOAT\n    #include <common_pack_float>\n#endif\n#if defined(USE_ESM)\nfloat esm(vec3 projCoords, vec4 shadowTexel) {\n    float compare = projCoords.z;\n    float c = 120.0;\n    #ifdef PACK_FLOAT\n        float depth = common_decodeDepth(shadowTexel);\n        if (depth >= 1.0 - 1E-6 || compare <= depth) {\n            return 1.0;\n        }\n    #else\n        float depth = shadowTexel.r;\n    #endif\n    depth = exp(-c * min(compare - depth, 0.05));\n    return clamp(depth, esm_shadow_threshold, 1.0);\n}\n#endif\n#if defined(USE_VSM)\nfloat vsm_shadow_chebyshevUpperBound(vec3 projCoords, vec4 shadowTexel){\n    vec2 moments = shadowTexel.rg;\n    float distance = projCoords.z;\n    if (distance >= 1.0 || distance <= moments.x)\n        return 1.0 ;\n    float variance = moments.y - (moments.x * moments.x);\n    variance = max(variance, 0.00002);\n    float d = distance - moments.x;\n    float p_max = variance / (variance + d * d);\n    return p_max;\n}\n#endif\nfloat shadow_computeShadow_coeff(sampler2D shadowMap, vec3 projCoords) {\n    vec2 uv = projCoords.xy;\n    vec4 shadowTexel = texture2D(shadowMap, uv);\n    #if defined(USE_ESM)\n        float esm_coeff = esm(projCoords, shadowTexel);\n        float coeff = esm_coeff * esm_coeff;\n    #endif\n    #if defined(USE_VSM)\n        float vsm_coeff = vsm_shadow_chebyshevUpperBound(projCoords, shadowTexel);\n        float coeff = vsm_coeff;\n    #endif\n    return 1.0 - (1.0 - coeff) * shadow_opacity;\n}\nfloat shadow_computeShadow() {\n    vec3 projCoords = shadow_vLightSpacePos.xyz / shadow_vLightSpacePos.w;\n    projCoords = projCoords * 0.5 + 0.5;\n    if(projCoords.z >= 1.0 || projCoords.x < 0.0 || projCoords.x > 1.0 || projCoords.y < 0.0 || projCoords.y > 1.0) return 1.0;\n    return shadow_computeShadow_coeff(shadow_shadowMap, projCoords);\n}\nvec3 shadow_blend(vec3 color, float coeff) {\n    color = color * coeff + shadow_color * shadow_opacity * (1.0 - coeff);\n    return color;\n}",fbo_picking_vert:"\n#ifdef ENABLE_PICKING\n#if HAS_PICKING_ID == 1\nattribute float aPickingId;\n#elif HAS_PICKING_ID == 2\nuniform float uPickingId;\n#endif\nvarying float vPickingId;\nvarying float vFbo_picking_viewZ;\nvarying float vFbo_picking_visible;\n#endif\nvarying float vFbo_picking_fragDepth;\nvoid fbo_picking_setData(float viewPosZ, bool visible) {\n    #ifdef ENABLE_PICKING\n    #if HAS_PICKING_ID == 1\n       vPickingId = aPickingId;\n    #elif HAS_PICKING_ID == 2\n        vPickingId = uPickingId;\n    #endif\n        vFbo_picking_viewZ = viewPosZ;\n    #endif\n    vFbo_picking_visible = visible ? 1.0 : 0.0;\n    vFbo_picking_fragDepth = viewPosZ + 1.0;\n}",common_pack_float:"const float COMMON_FLOAT_MAX =  1.70141184e38;\nconst float COMMON_FLOAT_MIN = 1.17549435e-38;\nfloat common_packFloat(vec4 val){\n    vec4 scl = floor(255.0 * val + 0.5);\n    float sgn = (scl.a < 128.0) ? 1.0 : -1.0;\n    float exn = mod(scl.a * 2.0, 256.0) + floor(scl.b / 128.0) - 127.0;\n    float man = 1.0 +\n        (scl.r / 8388608.0) +\n        (scl.g / 32768.0) +\n        mod(scl.b, 128.0) / 128.0;\n    return sgn * man * pow(2.0, exn);\n}\nvec4 common_unpackFloat(highp float v) {\n    highp float av = abs(v);\n    if(av < COMMON_FLOAT_MIN) {\n        return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > COMMON_FLOAT_MAX) {\n        return vec4(127.0, 128.0, 0.0, 0.0) / 255.0;\n    } else if(v < -COMMON_FLOAT_MAX) {\n        return vec4(255.0, 128.0, 0.0, 0.0) / 255.0;\n    }\n    highp vec4 c = vec4(0,0,0,0);\n    highp float e = floor(log2(av));\n    highp float m = av * pow(2.0, -e) - 1.0;\n    c[1] = floor(128.0 * m);\n    m -= c[1] / 128.0;\n    c[2] = floor(32768.0 * m);\n    m -= c[2] / 32768.0;\n    c[3] = floor(8388608.0 * m);\n    highp float ebias = e + 127.0;\n    c[0] = floor(ebias / 2.0);\n    ebias -= c[0] * 2.0;\n    c[1] += floor(ebias) * 128.0;\n    c[0] += 128.0 * step(0.0, -v);\n    return c / 255.0;\n}\nvec4 common_encodeDepth(const in float depth) {\n    float alpha = 1.0;\n    vec4 pack = vec4(0.0);\n    pack.a = alpha;\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n    pack.rgb = vec3(code * depth);\n    pack.gb = fract(pack.gb);\n    pack.rg -= pack.gb * (1.0 / 256.0);\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n    return pack;\n}\nfloat common_decodeDepth(const in vec4 pack) {\n    return pack.r + pack.g / 255.0;\n}",invert_matrix:"mat4 invert_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return inverse(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a00 = vector1.x, a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a10 = vector2.x, a11 = vector2.y, a12 = vector2.z, a13 = vector2.w;\n        float a20 = vector3.x, a21 = vector3.y, a22 = vector3.z, a23 = vector3.w;\n        float a30 = vector4.x, a31 = vector4.y, a32 = vector4.z, a33 = vector4.w;\n        float b00 = a00 * a11 - a01 * a10;\n        float b01 = a00 * a12 - a02 * a10;\n        float b02 = a00 * a13 - a03 * a10;\n        float b03 = a01 * a12 - a02 * a11;\n        float b04 = a01 * a13 - a03 * a11;\n        float b05 = a02 * a13 - a03 * a12;\n        float b06 = a20 * a31 - a21 * a30;\n        float b07 = a20 * a32 - a22 * a30;\n        float b08 = a20 * a33 - a23 * a30;\n        float b09 = a21 * a32 - a22 * a31;\n        float b10 = a21 * a33 - a23 * a31;\n        float b11 = a22 * a33 - a23 * a32;\n        float det = b00 * b11 - b01 * b10 + b02 * b09 + b03 * b08 - b04 * b07 + b05 * b06;\n        det = 1.0 / det;\n        mat4 m = mat4(\n            (a11 * b11 - a12 * b10 + a13 * b09) * det,\n            (a02 * b10 - a01 * b11 - a03 * b09) * det,\n            (a31 * b05 - a32 * b04 + a33 * b03) * det,\n            (a22 * b04 - a21 * b05 - a23 * b03) * det,\n            (a12 * b08 - a10 * b11 - a13 * b07) * det,\n            (a00 * b11 - a02 * b08 + a03 * b07) * det,\n            (a32 * b02 - a30 * b05 - a33 * b01) * det,\n            (a20 * b05 - a22 * b02 + a23 * b01) * det,\n            (a10 * b10 - a11 * b08 + a13 * b06) * det,\n            (a01 * b08 - a00 * b10 - a03 * b06) * det,\n            (a30 * b04 - a31 * b02 + a33 * b00) * det,\n            (a21 * b02 - a20 * b04 - a23 * b00) * det,\n            (a11 * b07 - a10 * b09 - a12 * b06) * det,\n            (a00 * b09 - a01 * b07 + a02 * b06) * det,\n            (a31 * b01 - a30 * b03 - a32 * b00) * det,\n            (a20 * b03 - a21 * b01 + a22 * b00) * det\n        );\n        return m;\n    #endif\n}\nmat4 transpose_matrix(mat4 matrix) {\n    #if __VERSION__ == 300\n        return transpose(matrix);\n    #else\n        vec4 vector1 = matrix[0], vector2 = matrix[1], vector3 = matrix[2], vector4 = matrix[3];\n        float a01 = vector1.y, a02 = vector1.z, a03 = vector1.w;\n        float a12 = vector2.z, a13 = vector2.w;\n        float a23 = vector3.w;\n        mat4 m = mat4(\n            vector1.x,\n            vector2.x,\n            vector3.x,\n            vector4.x,\n            a01,\n            vector2.y,\n            vector3.y,\n            vector4.y,\n            a02,\n            a12,\n            vector3.z,\n            vector4.z,\n            a03,\n            a13,\n            a23,\n            vector4.w\n        );\n        return m;\n    #endif\n}",get_output:"#include <invert_matrix>\n#include <draco_decode_vert>\n#ifdef HAS_INSTANCE\n    #include <instance_vert>\n    #ifdef HAS_INSTANCE_COLOR\n        varying vec4 vInstanceColor;\n    #endif\n#endif\n#ifdef HAS_SKIN\n    uniform int skinAnimation;\n    #include <skin_vert>\n#endif\n#include <mask_vert>\n#ifdef HAS_MORPH\n    attribute vec3 POSITION0;\n    attribute vec3 POSITION1;\n    attribute vec3 POSITION2;\n    attribute vec3 POSITION3;\n    attribute vec3 POSITION4;\n    attribute vec3 POSITION5;\n    attribute vec3 POSITION6;\n    attribute vec3 POSITION7;\n    #ifdef HAS_MORPHNORMALS\n        attribute vec3 NORMAL0;\n        attribute vec3 NORMAL1;\n        attribute vec3 NORMAL2;\n        attribute vec3 NORMAL3;\n    #endif\n    uniform vec4 morphWeights1;\n    uniform vec4 morphWeights2;\n#endif\n#ifdef HAS_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\n#endif\nmat4 getPositionMatrix() {\n    mat4 worldMatrix;\n    #ifdef HAS_INSTANCE\n        #ifdef HAS_INSTANCE_COLOR\n            vInstanceColor = instance_getInstanceColor();\n        #endif\n        mat4 attributeMatrix = instance_getAttributeMatrix();\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = attributeMatrix * positionMatrix * skin_getSkinMatrix();\n            } else {\n                worldMatrix = attributeMatrix * positionMatrix;\n            }\n        #else\n            worldMatrix = attributeMatrix * positionMatrix;\n        #endif\n    #else\n        #ifdef HAS_SKIN\n            if (skinAnimation == 1) {\n                worldMatrix = skin_getSkinMatrix() * positionMatrix;\n            } else {\n                worldMatrix = positionMatrix;\n            }\n        #else\n            worldMatrix = positionMatrix;\n        #endif\n    #endif\n    return worldMatrix;\n}\n#ifdef HAS_MIN_ALTITUDE\nuniform float minAltitude;\n#endif\nvec4 getPosition(vec3 aPosition) {\n    vec3 position = decode_getPosition(aPosition);\n    #ifdef HAS_MORPH\n        vec4 POSITION = vec4(position + morphWeights1[0] * POSITION0 + morphWeights1[1] * POSITION1 + morphWeights1[2] * POSITION2 + morphWeights1[3] * POSITION3\n        + morphWeights2[0] * POSITION4 + morphWeights2[1] * POSITION5 + morphWeights2[2] * POSITION6 + morphWeights2[3] * POSITION7\n        , 1.0);\n    #else\n        vec4 POSITION = vec4(position, 1.0);\n    #endif\n    #ifdef HAS_TERRAIN_ALTITUDE\n        POSITION.z += aTerrainAltitude * 100.0;\n    #endif\n    #ifdef HAS_MIN_ALTITUDE\n        POSITION.z += minAltitude * 100.0;\n    #endif\n    return POSITION;\n}\nvec3 appendMorphNormal(vec3 NORMAL) {\n    #ifdef HAS_MORPHNORMALS\n        vec3 normal = NORMAL + morphWeights1[0] * NORMAL0 + morphWeights1[1] * NORMAL1 + morphWeights1[2] * NORMAL2 + morphWeights1[3] * NORMAL3;\n    #else\n        vec3 normal = NORMAL;\n    #endif\n    return normal;\n}",instance_vert:"attribute vec4 instance_vectorA;\nattribute vec4 instance_vectorB;\nattribute vec4 instance_vectorC;\n#ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\nattribute float aTerrainAltitude;\nuniform float terrainAltitudeScale;\n#endif\nmat4 instance_getAttributeMatrix() {\n    mat4 mat =  mat4(\n        instance_vectorA.x, instance_vectorB.x, instance_vectorC.x, 0.0,\n        instance_vectorA.y, instance_vectorB.y, instance_vectorC.y, 0.0,\n        instance_vectorA.z, instance_vectorB.z, instance_vectorC.z, 0.0,\n        instance_vectorA.w, instance_vectorB.w, instance_vectorC.w, 1.0\n    );\n    #ifdef HAS_INSTANCE_TERRAIN_ALTITUDE\n        mat4 terrainMat = mat4(\n            1., 0., 0., 0.,\n            0., 1., 0., 0.,\n            0., 0., 1., 0.,\n            0., 0., aTerrainAltitude * terrainAltitudeScale, 1.\n        );\n        mat = terrainMat * mat;\n    #endif\n    return mat;\n}\n#ifdef HAS_INSTANCE_COLOR\n    attribute vec4 instance_color;\n    vec4 instance_getInstanceColor() {\n        return instance_color;\n    }\n#endif",skin_vert:"attribute vec4 WEIGHTS_0;\nattribute vec4 JOINTS_0;\nuniform sampler2D jointTexture;\nuniform vec2 jointTextureSize;\nuniform float numJoints;\n#define ROW0_U ((0.5 + 0.0) / 4.)\n#define ROW1_U ((0.5 + 1.0) / 4.)\n#define ROW2_U ((0.5 + 2.0) / 4.)\n#define ROW3_U ((0.5 + 3.0) / 4.)\nmat4 skin_getBoneMatrix(float jointNdx) {\n    float v = (jointNdx + 0.5) / numJoints;\n    return mat4(\n        texture2D(jointTexture, vec2(ROW0_U, v)),\n        texture2D(jointTexture, vec2(ROW1_U, v)),\n        texture2D(jointTexture, vec2(ROW2_U, v)),\n        texture2D(jointTexture, vec2(ROW3_U, v)));\n}\nmat4 skin_getSkinMatrix() {\n        mat4 skinMatrix = skin_getBoneMatrix(JOINTS_0[0]) * WEIGHTS_0[0] +\n                        skin_getBoneMatrix(JOINTS_0[1]) * WEIGHTS_0[1] +\n                        skin_getBoneMatrix(JOINTS_0[2]) * WEIGHTS_0[2] +\n                        skin_getBoneMatrix(JOINTS_0[3]) * WEIGHTS_0[3];\n        return skinMatrix;\n}",heatmap_render_vert:"#ifdef HAS_HEATMAP\nvarying vec2 heatmap_vTexCoord;\nvoid heatmap_compute(mat4 matrix, vec3 position) {\n    vec4 pos = matrix * vec4(position.xy, 0., 1.);\n    heatmap_vTexCoord = (1. + pos.xy / pos.w) / 2.;\n}\n#endif",heatmap_render_frag:"#ifdef HAS_HEATMAP\nuniform sampler2D heatmap_inputTexture;\nuniform sampler2D heatmap_colorRamp;\nuniform float heatmap_heatmapOpacity;\nvarying vec2 heatmap_vTexCoord;\nvec4 heatmap_getColor(vec4 color) {\n    float t = texture2D(heatmap_inputTexture, heatmap_vTexCoord).r;\n    vec4 heatmapColor = texture2D(heatmap_colorRamp, vec2(t, 0.5)) * heatmap_heatmapOpacity;\n    return color * (1.0 - heatmapColor.a) + heatmapColor * heatmapColor.a;\n}\n#endif",line_extrusion_vert:"#ifdef IS_LINE_EXTRUSION\n    #define ALTITUDE_SCALE 32767.0;\n    #define EXTRUDE_SCALE 63.0;\n    attribute vec2 aExtrude;\n    #ifdef HAS_LINE_WIDTH\n        attribute float aLineWidth;\n    #else\n        uniform float lineWidth;\n    #endif\n    #ifdef HAS_LINE_HEIGHT\n        attribute float aLineHeight;\n    #else\n        uniform float lineHeight;\n    #endif\n    uniform float linePixelScale;\n    vec3 getLineExtrudePosition(vec3 position) {\n        #ifdef HAS_LINE_WIDTH\n            float lineWidth = aLineWidth / 2.0;\n        #endif\n        #ifdef HAS_LINE_HEIGHT\n            float lineHeight = aLineHeight / 10.0;\n        #endif\n        float halfwidth = lineWidth / 2.0;\n        float outset = halfwidth;\n        vec2 dist = outset * aExtrude / EXTRUDE_SCALE;\n        position.z *= lineHeight / ALTITUDE_SCALE;\n        return position + vec3(dist, 0.0) * linePixelScale;\n    }\n#endif",gl2_vert:"#if __VERSION__ == 300\n    #define texture2D texture\n    #define varying out\n    #define attribute in\n#endif",gl2_frag:"#if __VERSION__ == 300\n    #define varying in\n    #define gl_FragDepthEXT gl_FragDepth\n    #define texture2D texture\n    #define textureCube texture\n    #define texture2DProj textureProj\n    #define texture2DLodEXT textureLod\n    #define texture2DProjLodEXT textureProjLod\n    #define textureCubeLodEXT textureLod\n    #define texture2DGradEXT textureGrad\n    #define texture2DProjGradEXT textureProjGrad\n    #define textureCubeGradEXT textureGrad\n    #define texture2D texture\n    out vec4 glFragColor;\n#else\n    vec4 glFragColor;\n#endif",hsv_frag:"\nconst mediump vec4 HSV_K0 = vec4(0.0, -1.0 / 3.0, 2.0 / 3.0, -1.0);\nconst mediump vec4 HSV_K1 = vec4(1.0, 2.0 / 3.0, 1.0 / 3.0, 3.0);\nconst mediump float HSV_E = 1.0e-10;\nvec3 hsv_rgb2hsv(vec3 c) {\n    vec4 K = HSV_K0;\n    vec4 p = mix(vec4(c.bg, K.wz), vec4(c.gb, K.xy), step(c.b, c.g));\n    vec4 q = mix(vec4(p.xyw, c.r), vec4(c.r, p.yzx), step(p.x, c.r));\n    float d = q.x - min(q.w, q.y);\n    float e = HSV_E;\n    return vec3(abs(q.z + (q.w - q.y) / (6.0 * d + e)), d / (q.x + e), q.x);\n}\nvec3 hsv_hsv2rgb(vec3 c) {\n    vec4 K = HSV_K1;\n    vec3 p = abs(fract(c.xxx + K.xyz) * 6.0 - K.www);\n    return c.z * mix(K.xxx, clamp(p - K.xxx, 0.0, 1.0), c.y);\n}\nvec4 hsv_apply(vec4 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return vec4(hsv_hsv2rgb(hsv), c.a);\n}\nvec3 hsv_apply(vec3 c, vec3 hsvOffset) {\n    vec3 hsv = hsv_rgb2hsv(c.rgb);\n    hsv += hsv * hsvOffset;\n    hsv = clamp(hsv, 0.0, 1.0);\n    return hsv_hsv2rgb(hsv);\n}\nmat4 contrastMatrix(float contrast)\n{\n    float t = (1.0 - contrast) / 2.0;\n    return mat4(\n        contrast, 0., 0., 0.,\n        0., contrast, 0., 0.,\n        0., 0., contrast, 0.,\n        t, t, t, 1\n    );\n}",snow_frag:"#ifdef HAS_SNOW\n    float lerp(float a, float b, float w) {\n        return a + w * (b - a);\n    }\n    vec3 snow(vec4 sceneColor, vec3 normalColor, float height) {\n        float snowIntense = normalColor.b;\n        vec3 fixedC = vec3(1.0, 1.0, 1.0);\n        if (height < 1.0) {\n            float r = lerp(0.5, fixedC.x, snowIntense);\n            float g = lerp(0.5, fixedC.y, snowIntense);\n            float b = lerp(0.5, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        } else {\n            float r = lerp(sceneColor.r, fixedC.x, snowIntense);\n            float g = lerp(sceneColor.g, fixedC.y, snowIntense);\n            float b = lerp(sceneColor.b, fixedC.z, snowIntense);\n            return vec3(r, g, b);\n        }\n    }\n#endif",draco_decode_vert:"#if defined(HAS_TANGENT)\n    attribute vec4 aTangent;\n#elif defined(HAS_NORMAL)\n    #ifdef HAS_DRACO_NORMAL\n        attribute vec2 aNormal;\n        uniform float gltf_u_dec_normal_rangeConstant;\n    #else\n        attribute vec3 aNormal;\n    #endif\n#endif\n#ifdef HAS_DRACO_POSITION\n    uniform float gltf_u_dec_position_normConstant;\n    uniform vec3 minValues_pos;\n    vec3 decodeDracoPosition(vec3 aPosition) {\n        return minValues_pos + aPosition * gltf_u_dec_position_normConstant;\n    }\n#endif\n#ifdef HAS_DRACO_TEXCOORD\n    uniform vec2 minValues_tex;\n    uniform float gltf_u_dec_texcoord_0_normConstant;\n    vec2 decodeDracoTexcoord(vec2 aTexCoord) {\n        return minValues_tex + aTexCoord * gltf_u_dec_texcoord_0_normConstant;\n    }\n#endif\n#ifdef HAS_WEB3D_quantized_attributes_TEXCOORD\n    uniform mat3 decodeMatrix;\n#endif\n#ifdef HAS_DRACO_NORMAL\n    float czm_signNotZero(float value) {\n        return value >= 0.0 ? 1.0 : -1.0;\n    }\n    vec2 czm_signNotZero(vec2 value) {\n        return vec2(czm_signNotZero(value.x), czm_signNotZero(value.y));\n    }\n    vec3 decodeDracoNormal(vec2 encoded, float range)\n    {\n        if (encoded.x == 0.0 && encoded.y == 0.0) {\n            return vec3(0.0, 0.0, 0.0);\n        }\n        encoded = encoded / range * 2.0 - 1.0;\n        vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n        if (v.z < 0.0) {\n            v.xy = (1.0 - abs(v.yx)) * czm_signNotZero(v.xy);\n        }\n        return normalize(v);\n    }\n    vec3 decode_getNormal(vec2 aNormal) {\n        return decodeDracoNormal(aNormal, gltf_u_dec_normal_rangeConstant).zxy;\n    }\n#endif\n#ifdef HAS_COMPRESSED_INT16\n    #ifdef HAS_COMPRESSED_INT16_POSITION\n      uniform vec2 compressedPositionRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_0\n      uniform vec2 compressedTexcoordRange_0;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_TEXCOORD_1\n      uniform vec2 compressedTexcoordRange_1;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n      uniform vec2 compressedNormalRange;\n    #endif\n    #ifdef HAS_COMPRESSED_INT16_RATIO\n      uniform float compressed_ratio;\n    #endif\n    float int16ToFloat32(float value, vec2 range) {\n        float v = (value >= 32768.0) ? -(65536.0 - value) / 32768.0 : value / 32767.0;\n        return (v + 1.0) * (range.y - range.x) / 2.0 + range.x;\n    }\n#endif\nvec3 decode_getPosition(vec3 aPosition) {\n    vec3 position = aPosition;\n    #if defined(HAS_COMPRESSED_INT16) && defined(HAS_COMPRESSED_INT16_POSITION)\n        float x = int16ToFloat32(aPosition.x, compressedPositionRange);\n        float y = int16ToFloat32(aPosition.y, compressedPositionRange);\n        float z = int16ToFloat32(aPosition.z, compressedPositionRange);\n        #ifdef HAS_COMPRESSED_INT16_RATIO\n          position = vec3(x / compressed_ratio, y / compressed_ratio, z);\n        #else\n          position = vec3(x, y, z);\n        #endif\n    #endif\n    #ifdef HAS_DRACO_POSITION\n        return decodeDracoPosition(position);\n    #else\n        return position;\n    #endif\n}\nvec2 decode_getTexcoord(vec2 aTexCoord) {\n    vec2 texcoord = aTexCoord;\n    #if defined(HAS_COMPRESSED_INT16) && (defined(HAS_COMPRESSED_INT16_TEXCOORD_0) || defined(HAS_COMPRESSED_INT16_TEXCOORD_1))\n        float x = int16ToFloat32(aTexCoord.x, compressedTexcoordRange_0);\n        float y = int16ToFloat32(aTexCoord.y, compressedTexcoordRange_0);\n        texcoord = vec2(x, y);\n    #endif\n    #ifdef HAS_DRACO_TEXCOORD\n        return decodeDracoTexcoord(texcoord);\n    #elif defined(HAS_WEB3D_quantized_attributes_TEXCOORD)\n        vec3 web3dTexcoord = decodeMatrix * vec3(texcoord, 1.0);\n        return vec2(web3dTexcoord.x, web3dTexcoord.y);\n    #else\n        return texcoord;\n    #endif\n}\nvec3 decode_getNormal(vec3 aNormal) {\n    #ifdef HAS_COMPRESSED_INT16_NORMAL\n        aNormal.x = int16ToFloat32(aNormal.x, compressedNormalRange);\n        aNormal.y = int16ToFloat32(aNormal.y, compressedNormalRange);\n        aNormal.z = int16ToFloat32(aNormal.z, compressedNormalRange);\n    #endif\n    return aNormal;\n}",highlight_vert:"#if defined(HAS_HIGHLIGHT_COLOR)\n    attribute vec4 aHighlightColor;\n    varying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    attribute float aHighlightOpacity;\n    varying float vHighlightOpacity;\n#endif\nvoid highlight_setVarying() {\n    #if defined(HAS_HIGHLIGHT_COLOR)\n        vHighlightColor = aHighlightColor / 255.0;\n    #endif\n    #if defined(HAS_HIGHLIGHT_OPACITY)\n        vHighlightOpacity = aHighlightOpacity / 255.0;\n    #endif\n}",highlight_frag:"#if defined(HAS_HIGHLIGHT_COLOR)\n\tvarying vec4 vHighlightColor;\n#endif\n#if defined(HAS_HIGHLIGHT_OPACITY)\n    varying float vHighlightOpacity;\n#endif\nvec4 highlight_blendColor(vec4 color) {\n\tvec4 outColor;\n\t#if defined(HAS_HIGHLIGHT_COLOR)\n\t\tcolor.rgb = color.rgb * (1.0 - vHighlightColor.a) + vHighlightColor.rgb * vHighlightColor.a;\n\t\t#ifndef HAS_HIGHLIGHT_COLOR_POINT\n        \tcolor.a = color.a * (1.0 - vHighlightColor.a) + vHighlightColor.a;\n        #endif\n        outColor = color;\n\t#else\n\t\toutColor = color;\n\t#endif\n\t#if defined(HAS_HIGHLIGHT_OPACITY)\n\t\toutColor *= vHighlightOpacity;\n\t#endif\n\treturn outColor;\n}",mask_vert:"#ifdef HAS_MASK_EXTENT\n    uniform vec4 mask_extent;\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_maskMode;\n    uniform float mask_hasFlatOut;\n    uniform mat4 viewMatrix;\n    uniform float mask_heightRatio;\n    uniform float mask_heightOffset;\n    varying vec4 vWorldPosition;\n    varying vec2 vUVInExtent;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    const float CLIPINSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float ELEVATE_MODE = 0.7;\n    float random (vec2 st) {\n        return fract(sin(dot(st.xy,vec2(12.9898,78.233)))*43758.5453123) * 0.1;\n    }\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    float getFlatHeight(float maskMode, float flatHeight, float height) {\n      if (maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n          return flatHeight + height;\n      } else {\n        return flatHeight;\n      }\n    }\n    vec4 getNoErrorPosition(vec4 position, vec4 wPosition) {\n      vec4 realPos = modelViewMatrix * position;      vec4 pos = viewMatrix * wPosition;      vec4 tempPos = viewMatrix * modelMatrix * position;      float deltaX = realPos.x - tempPos.x;\n      float deltaY = realPos.y - tempPos.y;\n      float deltaZ = realPos.z - tempPos.z;\n      pos.x = pos.x + deltaX;\n      pos.y = pos.y + deltaY;\n      pos.z = pos.z + deltaZ;\n      return pos;\n    }\n    vec4 getMaskPosition(vec4 position, mat4 modelMatrix) {\n        vWorldPosition = modelMatrix * position;\n        float w = mask_extent.z - mask_extent.x;\n        float h = mask_extent.y - mask_extent.w;\n        vec2 uvInExtent = vec2((vWorldPosition.x - mask_extent.x) / abs(w), 1.0 - (vWorldPosition.y - mask_extent.w) / h);\n        vec4 extentColor = texture2D(mask_colorExtent, uvInExtent);\n        vec3 maskOptionColor = texture2D(mask_modeExtent, uvInExtent).rgb;\n        float maskMode = maskOptionColor.r;\n        float flatHeight = maskOptionColor.g / mask_heightRatio + mask_heightOffset;\n        float height = getFlatHeight(maskMode, flatHeight, vWorldPosition.z);\n        vec4 wPosition = vec4(vWorldPosition.x, vWorldPosition.y, height, vWorldPosition.w);\n        vUVInExtent = uvInExtent;\n        vHeightRatio = mask_heightRatio;\n        vHeightOffset = mask_heightOffset;\n        if (maskMode <= FLATOUTSIDE_MODE && maskMode > FLATINSIDE_MODE) {\n            return modelViewMatrix * position;;\n        } else if (mask_hasFlatOut == 1.0) {\n            return getNoErrorPosition(position, wPosition);\n        }\n        if (isInExtent(extentColor) == true && maskMode <= FLATINSIDE_MODE && maskMode > CLIPINSIDE_MODE) {\n            return getNoErrorPosition(position, wPosition);\n        } if (isInExtent(extentColor) == true && maskMode <= ELEVATE_MODE && maskMode > 0.6) {\n            return getNoErrorPosition(position, wPosition);\n        } else {\n            return modelViewMatrix * position;\n        }\n    }\n#endif",mask_frag:"#ifdef HAS_MASK_EXTENT\n    uniform sampler2D mask_colorExtent;\n    uniform sampler2D mask_modeExtent;\n    uniform float mask_hasClipOut;\n    varying float vHeightRatio;\n    varying float vHeightOffset;\n    varying vec2 vUVInExtent;\n    varying vec4 vWorldPosition;\n    const float CLIPINSIDE_MODE = 0.1;\n    const float CLIPOUTSIDE_MODE = 0.2;\n    const float FLATINSIDE_MODE = 0.3;\n    const float FLATOUTSIDE_MODE = 0.4;\n    const float COLOR_MODE = 0.5;\n    const float VIDEO_MODE = 0.6;\n    bool isInExtent(vec4 color) {\n        return length(color.rgb) > 0.0;\n    }\n    vec4 setMask(vec4 glFragColor) {\n        vec4 extentColor = texture2D(mask_colorExtent, vUVInExtent);\n        vec4 modeColor = texture2D(mask_modeExtent, vUVInExtent);\n        float maskMode = modeColor.r;\n        float minHeight = modeColor.b / vHeightRatio + vHeightOffset;\n        float maxHeight = modeColor.a / vHeightRatio + vHeightOffset;\n        if (maskMode > CLIPINSIDE_MODE && maskMode <= CLIPOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                return glFragColor;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                return glFragColor;\n            } else {\n              discard;\n            }\n        } else if (mask_hasClipOut == 1.0) {\n            discard;\n        }\n        if (isInExtent(extentColor) == true && maskMode <= CLIPINSIDE_MODE && maskMode > 0.0) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                discard;\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                discard;\n            } else {\n              return glFragColor;\n            }\n        } else if (isInExtent(extentColor) == true && maskMode <= VIDEO_MODE && maskMode > FLATOUTSIDE_MODE) {\n            if (minHeight == 0.0 && maxHeight == 0.0) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            } else if (vWorldPosition.z >= minHeight && vWorldPosition.z <= maxHeight) {\n                glFragColor = vec4(mix(extentColor.rgb, glFragColor.rgb, 1.0 - extentColor.a), glFragColor.a);\n            }\n        }\n        return glFragColor;\n    }\n#endif",computeTexcoord_frag:"#ifdef HAS_KHR_TEXTURE_TRANSFORM\n    uniform vec2 khr_offset;\n    uniform float khr_rotation;\n    uniform vec2 khr_scale;\n    vec2 khr_tex_transformTexCoord(vec2 texCoords, vec2 offset, float rotation, vec2 scale) {\n        rotation = -rotation;\n        mat3 transform = mat3(\n        cos(rotation) * scale.x, sin(rotation) * scale.x, 0.0, -sin(rotation) * scale.y, cos(rotation) * scale.y, 0.0, offset.x, offset.y, 1.0);\n        vec2 transformedTexCoords = (transform * vec3(fract(texCoords), 1.0)).xy;\n        return transformedTexCoords;\n    }\n#endif\nvarying highp vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\n    varying vec4 vUvRegion;\n#endif\nvec2 computeTexCoord(vec2 texCoord) {\n    #ifdef HAS_I3S_UVREGION\n        vec2 atlasScale = vUvRegion.zw - vUvRegion.xy;\n        vec2 uvAtlas = fract(texCoord) * atlasScale + vUvRegion.xy;\n        return uvAtlas;\n    #elif defined(HAS_KHR_TEXTURE_TRANSFORM)\n        return khr_tex_transformTexCoord(texCoord, khr_offset, khr_rotation, khr_scale);\n    #else\n        return texCoord;\n    #endif\n}",terrain_normal_frag:"#ifdef HAS_TERRAIN_NORMAL\n    uniform sampler2D terrainHeightTexture;\n    uniform vec2 terrainHeightMapResolution;\n    uniform vec2 terrainResolution;\n    uniform float terrainHeightScale;\n    uniform float terrainTileResolution;\n    uniform vec4 terrainUnpackFactors;\n    float getHeight(vec2 uv) {\n        vec4 color = texture2D(terrainHeightTexture, uv) * 255.0;\n        color.a = -1.0;\n        return dot(color, terrainUnpackFactors) / 4.0;\n    }\n    vec3 convertTerrainHeightToNormalMap(vec2 uv) {\n        uv.y = 1.0 - uv.y;\n        vec2 epsilon = 1.0 / terrainHeightMapResolution;\n        float a = getHeight(uv + vec2(-epsilon.x, -epsilon.y));\n        float b = getHeight(uv + vec2(0, -epsilon.y));\n        float c = getHeight(uv + vec2(epsilon.x, -epsilon.y));\n        float d = getHeight(uv + vec2(-epsilon.x, 0));\n        float e = getHeight(uv + vec2(epsilon.x, 0));\n        float f = getHeight(uv + vec2(-epsilon.x, epsilon.y));\n        float g = getHeight(uv + vec2(0, epsilon.y));\n        float h = getHeight(uv + vec2(epsilon.x, epsilon.y));\n        vec2 dxy = vec2(\n            (c + e + e + h) - (a + d + d + f),\n            (f + g + g + h) - (a + b + b + c)\n        );\n        return normalize(vec3(dxy / epsilon, terrainResolution ));\n    }\n#endif",vertex_color_vert:"#ifdef HAS_VERTEX_COLOR\nattribute float aVertexColorType;\nuniform vec4 vertexColorsOfType[VERTEX_TYPES_COUNT];\nvarying vec4 vertexColor_color;\nvoid vertexColor_update() {\n    vertexColor_color = vertexColorsOfType[int(aVertexColorType)];\n}\n#endif",vertex_color_frag:"#ifdef HAS_VERTEX_COLOR\nvarying vec4 vertexColor_color;\nvec4 vertexColor_get() {\n\treturn vertexColor_color;\n}\n#endif",excavate_vert:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform vec4 excavateExtent;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  float getWorldHeight() {\n    vec4 wPosition = modelMatrix * getPosition(aPosition);\n    return wPosition.z;\n  }\n  vec2 getCoordinateTexcoord() {\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 wPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n    float x = (wPosition.x - excavateExtent.x) / (excavateExtent.z - excavateExtent.x);\n    float y = (wPosition.y - excavateExtent.y) / (excavateExtent.w - excavateExtent.y);\n    return vec2(x, y);\n  }\n#endif",excavate_frag:"#ifdef HAS_EXCAVATE_ANALYSIS\n  uniform sampler2D heightmap;\n  uniform float excavateHeight;\n  varying vec2 vCoordinateTexcoord;\n  varying float vHeight;\n  const vec2 range = vec2(-100.0, 1000.0);\n  float decodeHeight(const in vec4 pack) {\n      return pack.r + pack.g / 255.0;\n  }\n  vec4 excavateColor(vec4 fragColor) {\n      float samplerHeight = decodeHeight(texture2D(heightmap, vCoordinateTexcoord));\n      float realHeight = samplerHeight * (range.y - range.x) + range.x;\n      if(realHeight < range.x || realHeight > range.y) {\n          realHeight = 0.0;\n      }\n      if(vHeight > realHeight) {\n          discard;\n      }\n      return fragColor;\n  }\n#endif"};var on$5={register(e,n){if(rn$5[e])throw new Error(`Key of ${e} is already registered in ShaderLib.`);rn$5[e]=n},compile:e=>sn$5(e)};const an$5=/^[ \t]*#include +<([\w\d.]+)>/gm;function sn$5(e){return e.replace(an$5,cn$5)}function cn$5(e,n){const t=rn$5[n];if(!t)throw new Error("Can not resolve #include <"+n+">");return sn$5(t)}let dn$4=0;const un$4={};class hn$5{constructor({vert:e,frag:n,uniforms:t,defines:r,extraCommandProps:i}){this.vert=e,this.frag=n;const o=dn$4++;Object.defineProperty(this,"uid",{enumerable:!0,configurable:!1,get:()=>o}),this.shaderDefines=r&&v$3({},r)||{},t=this.uniforms=(t||[]).slice(),this.contextDesc={};for(let e=0,n=t.length;e<n;e++){const n=t[e];if(f$3(n))if(n.indexOf("[")>0){const{name:e,len:t}=mn$4(n);this.contextDesc[e]={name:e,type:"array",length:t}}else this.contextDesc[n]=null;else if(n.name.indexOf("[")>0){const{name:e,len:t}=mn$4(n.name);this.contextDesc[e]={name:e,type:"array",length:t,fn:n.fn}}else this.contextDesc[n.name]=n}this.extraCommandProps=i&&v$3({},i)||{},this.commands={},this._compileSource()}set shaderDefines(e){this._shaderDefines=e,this.dkey=Object.keys(this._shaderDefines).join()}get shaderDefines(){return this._shaderDefines||{}}setDefines(e){this.shaderDefines=e}setFramebuffer(e){return this.context.framebuffer=e,this}appendDescUniforms(e,n){const t=n,r=this.contextDesc;for(const i in r)if(r[i])if("array"===r[i].type){const o=i,a=r[i].length;let s=n[i];if(r[i].fn&&(s=r[i].fn(null,n)),!s)continue;if(s.length!==a)throw new Error(`${o} uniform's length is not ${a}`);t[o]=t[o]||{};for(let n=0;n<a;n++)t[o][""+n]=s[n].getREGLTexture?s[n].getREGLTexture(e):s[n]}else"function"===r[i].type&&(Object.getOwnPropertyDescriptor(t,i)||Object.defineProperty(t,i,{configurable:!1,enumerable:!0,get:function(){return r[i].fn(null,n)}}));return t}setUniforms(e){if(e.modelMatrix||e.positionMatrix)throw new Error("modelMatrix or positionMatrix is reserved uniform name for Mesh, please change to another name");return this.contextKeys=e?Object.keys(e).join():null,this.context=e,this}getVersion(e,n){return"#version"===n.substring(0,8)?"":0===e.limits.version.indexOf("WebGL 2.0")&&300===this.version?"#version 300 es\n":"#version 100\n"}getActiveVars(e,n,t,r){const i=r;if(un$4[i])return un$4[i];const o=e._gl,a=o.createProgram(),s=o.createShader(35633);o.shaderSource(s,n),o.compileShader(s);const c=o.createShader(35632);o.shaderSource(c,t),o.compileShader(c),o.attachShader(a,c),o.attachShader(a,s),o.linkProgram(a);const l=o.getProgramParameter(a,35721),f=[];for(let e=0;e<l;++e){const n=o.getActiveAttrib(a,e);n&&f.push({name:n.name,type:n.type})}const d=o.getProgramParameter(a,35718),u=[];for(let e=0;e<d;++e){const n=o.getActiveUniform(a,e);let t=n.name;n.name.indexOf("[")>0&&(t=t.replace("[0]","")),u.push(t)}return o.deleteProgram(a),o.deleteShader(s),o.deleteShader(c),un$4[i]={activeUniforms:u,activeAttributes:f},un$4[i]}createREGLCommand(e,n,t,r,i,o={}){const a=A$4(e)&&!i,s=v$3({},this.shaderDefines||{},n||{}),c=this._insertDefines(this.vert,s),l=this.getVersion(e,c)+c,f=this._insertDefines(this.frag,s),d=this.getVersion(e,f)+f,u=I$5(l)+"_"+I$5(d),{activeAttributes:h,activeUniforms:m}=this.getActiveVars(e,l,d,u),_={};h.forEach(((n,t)=>{const r=n.name;_[r]=a?t:e.prop(r)}));const x={};m.forEach((n=>{x[n]=e.prop(n)}));const b=this.contextDesc;for(const n in b)if(b[n]&&"function"===b[n].type)x[n]=b[n].fn;else if(b[n]&&"array"===b[n].type){const t=b[n].name,r=b[n].length;for(let n=0;n<r;n++){const r=`${t}[${n}]`;x[r]=e.prop(r)}}else x[n]=e.prop(n);const p={vert:l,frag:d,uniforms:x,attributes:_};a&&(p.vao=e.prop("vao")),a&&!r||!t||g$1(t)||(p.elements=e.prop("elements")),p.count=e.prop("count"),p.offset=e.prop("offset"),p.primitive=e.prop("primitive"),p.framebuffer=e.prop("framebuffer"),r&&(p.instances=e.prop("instances")),v$3(p,this.extraCommandProps,o);const y=e(p);return h.key=h.map((e=>e.name)).join(),y.activeAttributes=h,y}dispose(){for(const e in this.commands){const n=this.commands[e];n&&n.destroy&&!n[H$6]&&(n[H$6]=!0,n.destroy())}this.commands={},delete this.vert,delete this.frag}_insertDefines(e,n){const t=[];for(const e in n)S$6(n,e)&&!h$2(n[e])&&t.push(`#define ${e} ${n[e]}\n`);return t.join("")+e}_compileSource(){this.vert=on$5.compile(this.vert),this.frag=on$5.compile(this.frag)}}function mn$4(e){const n=e.indexOf("["),t=e.indexOf("]");return{name:e.substring(0,n),len:+e.substring(n+1,t)}}class vn$4 extends hn$5{draw(e,n){if(!n||!n.length)return 0;const t=[];let r,i=0;for(let o=0,a=n.length;o<a;o++){if(!n[o].isValid()){o===a-1&&r&&t.length&&r(t);continue}if(!n[o].geometry.getDrawCount()||!this._runFilter(n[o])){o===a-1&&r&&t.length&&r(t);continue}const s=this.getMeshCommand(e,n[o]);t.length&&r!==s&&(r(t),t.length=0);const c=n[o].getREGLProps(e,s.activeAttributes);this._ensureContextDefines(c),c.shaderContext=this.context,this.appendDescUniforms(e,c),t.push(c),i++,o<a-1?r=s:o===a-1&&s(t)}return i}_ensureContextDefines(e){if(this.context&&(e.contextKeys||(e.contextKeys={}),e.contextKeys[this.uid]!==this.contextKeys)){for(const n in this.context)"framebuffer"===n||Object.getOwnPropertyDescriptor(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:function(){return this.shaderContext[n]}});Object.getOwnPropertyDescriptor(e,"framebuffer")||Object.defineProperty(e,"framebuffer",{configurable:!1,enumerable:!0,get:function(){return this.targetFramebuffer||this.shaderContext&&this.shaderContext.framebuffer}}),e.contextKeys[this.uid]=this.contextKeys}}_runFilter(e){const n=this.filter;if(!n)return!0;if(Array.isArray(n)){for(let t=0;t<n.length;t++)if(!n[t](e))return!1;return!0}return n(e)}getMeshCommand(e,n){this._cmdKeys||(this._cmdKeys={});const t=this.dkey||"default";let r=this._cmdKeys[t];r||(r=this._cmdKeys[t]={});const i=n.getCommandKey(e);r[i]||(r[i]=t+"_"+n.getCommandKey(e));const o=r[i];let a=this.commands[o];if(!a){const t=n.getDefines(),r=n.getMaterial(),i={};r&&r.doubleSided&&this.extraCommandProps&&this.extraCommandProps.cull&&(i.cull={enable:!1}),a=this.commands[o]=this.createREGLCommand(e,t,n.getElements(),n instanceof Ge$5,n.disableVAO,i)}return a}}var gn$4="precision mediump float;\n#include <gl2_frag>\nuniform vec4 baseColorFactor;\nuniform float materialShininess;\nuniform float environmentExposure;\nuniform float specularStrength;\nuniform vec3 light0_viewDirection;\nuniform vec3 ambientColor;\nuniform vec4 light0_diffuse;\nuniform vec3 lightSpecular;\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#ifdef HAS_TOON\nuniform float toons;\nuniform float specularToons;\n#endif\n#ifdef HAS_TANGENT\nvarying vec4 vTangent;\n#endif\n#ifdef HAS_MAP\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vNormal;\nvarying vec3 vFragPos;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nuniform vec2 extrusionOpacityRange;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_AO_MAP\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#include <heatmap_render_frag>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#include <mask_frag>\nvec3 c() {\n  \n#if defined(HAS_NORMAL_MAP)\nvec3 d = normalize(vNormal);\n  vec3 e = texture2D(normalTexture, computeTexCoord(vTexCoord)).xyz * 2. - 1.;\n#if defined(HAS_TANGENT)\nvec3 t = normalize(vTangent.xyz);\n  vec3 b = normalize(cross(d, t) * sign(vTangent.w));\n  mat3 f = mat3(t, b, d);\n  return normalize(f * e);\n#else\nreturn normalize(e);\n#endif\n#else\nreturn normalize(vNormal);\n#endif\n}\nvec4 h(const in vec4 i) {\n  return vec4(i.r < .0031308 ? i.r * 12.92 : 1.055 * pow(i.r, 1. / 2.4) - .055, i.g < .0031308 ? i.g * 12.92 : 1.055 * pow(i.g, 1. / 2.4) - .055, i.b < .0031308 ? i.b * 12.92 : 1.055 * pow(i.b, 1. / 2.4) - .055, i.a);\n}\nvec4 j() {\n  \n#if defined(HAS_BASECOLOR_MAP)\nreturn texture2D(baseColorTexture, computeTexCoord(vTexCoord));\n#elif defined(HAS_DIFFUSE_MAP)\nreturn texture2D(diffuseTexture, computeTexCoord(vTexCoord));\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn diffuseFactor;\n#else\nreturn baseColorFactor;\n#endif\n}\nvec3 k() {\n  \n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn specularFactor;\n#else\nreturn vec3(1.);\n#endif\n}\nvoid main() {\n  vec4 l = j();\n  vec3 m = environmentExposure * ambientColor * l.rgb;\n#ifdef HAS_INSTANCE_COLOR\nm *= vInstanceColor.rgb;\n#endif\nvec3 o = c();\n  vec3 u = normalize(-light0_viewDirection);\n  float v = max(dot(o, u), .0);\n#ifdef HAS_TOON\nfloat A = floor(v * toons);\n  v = A / toons;\n#endif\nvec3 B = light0_diffuse.rgb * v * l.rgb;\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvec3 i = vColor.rgb;\n#elif defined(IS_LINE_EXTRUSION)\nvec3 i = lineColor.rgb;\n#else\nvec3 i = polygonFill.rgb;\n#endif\n#ifdef HAS_INSTANCE_COLOR\ni *= vInstanceColor.rgb;\n#endif\nm *= i.rgb;\n  B *= i.rgb;\n  vec3 C = normalize(cameraPosition - vFragPos);\n  vec3 D = normalize(u + C);\n  float E = pow(max(dot(o, D), .0), materialShininess);\n#ifdef HAS_TOON\nfloat F = floor(E * specularToons);\n  E = F / specularToons;\n#endif\nvec3 G = specularStrength * lightSpecular * E * k();\n#ifdef HAS_OCCLUSION_MAP\nfloat H = texture2D(occlusionTexture, computeTexCoord(vTexCoord1)).r;\n  m *= H;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat I = shadow_computeShadow();\n  B = shadow_blend(B, I).rgb;\n  G = shadow_blend(G, I).rgb;\n#endif\nvec3 J = m + B + G;\n#ifdef HAS_EMISSIVE_MAP\nvec3 K = texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n  J += K;\n#endif\n#ifdef IS_LINE_EXTRUSION\nglFragColor = vec4(J, lineOpacity * l.a);\n#else\nglFragColor = vec4(J, polygonOpacity * l.a);\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nfloat L = vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nfloat L = lineColor.a;\n#else\nfloat L = polygonFill.a;\n#endif\nglFragColor *= L;\n#ifdef HAS_EXTRUSION_OPACITY\nfloat M = extrusionOpacityRange.x;\n  float N = extrusionOpacityRange.y;\n  float O = M + vExtrusionOpacity * (N - M);\n  O = clamp(O, .0, 1.);\n  glFragColor *= O;\n#endif\nif(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",xn$4="#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nvarying vec3 vFragPos;\nvarying vec3 vNormal;\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <highlight_vert>\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nattribute float aExtrusionOpacity;\nvarying float vExtrusionOpacity;\n#endif\n#if defined(HAS_TANGENT)\nvarying vec4 vTangent;\n#endif\nvoid c(const highp vec4 q, out highp vec3 d) {\n  d = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid c(const highp vec4 q, out highp vec3 d, out highp vec3 t) {\n  c(q, d);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 e = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 e = getPosition(aPosition);\n#endif\nmat4 f = getPositionMatrix();\n  vFragPos = vec3(modelMatrix * f * e);\n#if defined(HAS_NORMAL) || defined(HAS_TANGENT)\nmat3 h = modelNormalMatrix * mat3(f);\n  vec3 i;\n#if defined(HAS_TANGENT)\nvec3 t;\n  c(aTangent, i, t);\n  vTangent = vec4(h * t, aTangent.w);\n#else\ni = decode_getNormal(aNormal);\n#endif\nvec3 j = appendMorphNormal(i);\n  vNormal = normalize(h * j);\n#else\nvNormal = vec3(.0);\n#endif\nmat4 k = projMatrix;\n  k[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = k * getMaskPosition(f * e, modelMatrix);\n#else\ngl_Position = k * modelViewMatrix * f * e;\n#endif\n#ifdef HAS_MAP\nvec2 l = decode_getTexcoord(aTexCoord);\n  vTexCoord = l * uvScale + uvOffset;\n#endif\n#ifdef HAS_AO_MAP\nvec2 m = decode_getTexcoord(aTexCoord1);\n  vTexCoord1 = m * uvScale + uvOffset;\n#endif\n#ifdef HAS_EXTRUSION_OPACITY\nvExtrusionOpacity = aExtrusionOpacity;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(f * e);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * f, e);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\nhighlight_setVarying();\n}";class bn$4 extends vn$4{constructor(e={}){const t=[],r=[],o=e.uniforms,a=[{name:"modelNormalMatrix",type:"function",fn:function(e,n){return fromMat4$1(t,n.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(e,t){return multiply$5(r,t.viewMatrix,t.modelMatrix)}}];o&&a.push(...o),super({vert:e.vert||xn$4,frag:e.frag||gn$4,uniforms:a,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}getGeometryDefines(e){const n={};return e.data[e.desc.tangentAttribute]?n.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(n.HAS_NORMAL=1),n}}var An$4="#if __VERSION__ == 300\n#define attribute in\n#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main() {\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}";const Sn$4=new Int8Array([-1,1,-1,-1,1,1,1,1,-1,-1,1,-1]),Tn$4=new Uint8Array([0,1,0,0,1,1,1,1,0,0,1,0]);class Mn$4 extends vn$4{constructor(e){e.vert=e.vert||An$4,e.extraCommandProps=e.extraCommandProps||{},e.extraCommandProps.depth||(e.extraCommandProps.depth={enable:!1,mask:!1}),e.extraCommandProps.stencil||(e.extraCommandProps.stencil={enable:!1}),super(e)}draw(e){return this._quadMesh||this._createQuadMesh(e),super.draw(e,this._quadMesh)}getMeshCommand(e){const n=this.dkey||"";return this.commands[n+"_quad"]||(this.commands[n+"_quad"]=this.createREGLCommand(e,null,this._quadMesh[0].getElements())),this.commands[n+"_quad"]}_createQuadMesh(e){const n=new Q$7({aPosition:Sn$4,aTexCoord:Tn$4},null,Sn$4.length/2,{positionSize:2,primitive:"triangles"});n.generateBuffers(e),this._quadMesh=[new Be$5(n)]}dispose(){if(this._quadMesh){const e=this._quadMesh[0];e.geometry.dispose(),e.dispose()}return delete this._quadMesh,super.dispose()}}class Cn$4 extends Mn$4{constructor(){super({vert:An$4,frag:"#define SHADER_NAME FXAA\n#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision mediump float;\nvarying vec2 vTexCoord;\nuniform float enableFXAA;\nuniform float enableToneMapping;\nuniform float enableSharpen;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\n#ifdef HAS_TAA_TEX\nuniform sampler2D taaTextureSource;\n#ifdef HAS_FXAA_TEX\nuniform sampler2D fxaaTextureSource;\n#endif\n#endif\nuniform float pixelRatio;\nuniform float sharpFactor;\n#ifdef HAS_OUTLINE_TEX\nuniform sampler2D textureOutline;\nuniform float enableOutline;\nuniform float highlightFactor;\nuniform float outlineFactor;\nuniform float outlineWidth;\nuniform vec3 outlineColor;\n#endif\nvec2 c;\nvec4 d(vec2 e) {\n  \n#ifdef HAS_TAA_TEX\nvec4 f = texture2D(textureSource, e);\n  vec4 taa = texture2D(taaTextureSource, e);\n#ifdef HAS_FXAA_TEX\nvec4 h = texture2D(fxaaTextureSource, e);\n#else\nvec4 h = vec4(.0);\n#endif\nvec4 i = taa + f * (1. - taa.a);\n  return h + i * (1. - h.a);\n#else\nreturn texture2D(textureSource, e);\n#endif\n}\nvec4 j(vec2 k) {\n  vec4 l;\n  mediump vec2 m = vec2(1. / resolution.x, 1. / resolution.y);\n  vec3 n = d((k + vec2(-1., -1.)) * m).xyz;\n  vec3 o = d((k + vec2(1., -1.)) * m).xyz;\n  vec3 u = d((k + vec2(-1., 1.)) * m).xyz;\n  vec3 v = d((k + vec2(1.)) * m).xyz;\n  vec4 A = d(k * m);\n  vec3 B = A.xyz;\n  vec3 C = vec3(.299, .587, .114);\n  float D = dot(n, C);\n  float E = dot(o, C);\n  float F = dot(u, C);\n  float G = dot(v, C);\n  float H = dot(B, C);\n  float I = min(H, min(min(D, E), min(F, G)));\n  float J = max(H, max(max(D, E), max(F, G)));\n  mediump vec2 K;\n  K.x = -((D + E) - (F + G));\n  K.y = (D + F) - (E + G);\n  float L = max((D + E + F + G) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float M = 1. / (min(abs(K.x), abs(K.y)) + L);\n  K = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), K * M)) * m;\n  vec4 N = .5 * (d(k * m + K * (1. / 3. - .5)) + d(k * m + K * (2. / 3. - .5)));\n  vec4 O = N * .5 + .25 * (d(k * m + K * -.5) + d(k * m + K * .5));\n  float P = dot(O.xyz, C);\n  if(P < I || P > J)\n    l = N;\n  else\n    l = O;\n  return l;\n}\nvec3 Q(const in vec3 l, const float R) {\n  vec2 S = pixelRatio / resolution.xy;\n  float T = .0;\n  vec4 n = texture2D(textureSource, c + S * vec2(-1., -1.));\n  n.rgb = mix(vec3(.0), n.rgb, sign(n.a));\n  T += mix(.0, 1., sign(n.a));\n  vec4 v = texture2D(textureSource, c + S * vec2(1.));\n  v.rgb = mix(vec3(.0), v.rgb, sign(v.a));\n  T += mix(.0, 1., sign(v.a));\n  vec4 o = texture2D(textureSource, c + S * vec2(1., -1.));\n  o.rgb = mix(vec3(.0), o.rgb, sign(o.a));\n  T += mix(.0, 1., sign(o.a));\n  vec4 u = texture2D(textureSource, c + S * vec2(-1., 1.));\n  u.rgb = mix(vec3(.0), u.rgb, sign(u.a));\n  T += mix(.0, 1., sign(u.a));\n  return l + R * (T * l - n.rgb - o.rgb - u.rgb - v.rgb);\n}\nvec4 U(const in vec4 l) {\n  return vec4(Q(l.rgb, sharpFactor), l.a);\n}\nvec3 V(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float W = 2.43;\n  const float X = .59;\n  const float Y = .14;\n  return (x * (a * x + b)) / (x * (W * x + X) + Y);\n}\nvec3 Z(vec3 l) {\n  l = l / (l + vec3(1.));\n  return l = pow(l, vec3(1. / 2.2));\n}\n#ifdef HAS_OUTLINE_TEX\nvec4 ba() {\n  float bb = 2.;\n  float bc = 1.;\n  float bd = pixelRatio / resolution[0] * outlineWidth;\n  float be = pixelRatio / resolution[1] * outlineWidth;\n  vec4 bf = (texture2D(textureOutline, c + vec2(bd, be)));\n  vec4 bg = (texture2D(textureOutline, c + vec2(bd, .0)));\n  vec4 bh = (texture2D(textureOutline, c + vec2(bd, -be)));\n  vec4 bi = (texture2D(textureOutline, c + vec2(.0, -be)));\n  vec4 bj = (texture2D(textureOutline, c + vec2(-bd, -be)));\n  vec4 bk = (texture2D(textureOutline, c + vec2(-bd, .0)));\n  vec4 bl = (texture2D(textureOutline, c + vec2(-bd, be)));\n  vec4 bm = (texture2D(textureOutline, c + vec2(.0, be)));\n  vec4 bn = -bb * bk + bb * bg + -bc * bl + bc * bf + -bc * bj + bc * bh;\n  vec4 bo = -bb * bi + bb * bm + -bc * bj + bc * bl + -bc * bh + bc * bf;\n  float bp = sqrt(dot(bo, bo) + dot(bn, bn));\n  bool bq = bp < 1. / 65025.;\n  vec3 br = (texture2D(textureOutline, c)).r * outlineColor;\n  if(br == vec3(.0) || (highlightFactor == .0 && bq)) {\n    return vec4(.0);\n  }\n  float bs = bq ? highlightFactor : min(1., sqrt(bp) * outlineFactor);\n  return bs * vec4(br, 1.);\n}\nvec4 bt(const in vec4 l) {\n  vec4 ba = ba();\n  return ba + vec4(l) * (1. - ba.a);\n}\n#endif\nvoid main() {\n  c = vTexCoord;\n  vec4 l;\n  if(enableFXAA == 1.) {\n    l = j(c * resolution);\n  } else {\n    l = d(vTexCoord);\n  }\n  if(enableSharpen == 1.) {\n    l = U(l);\n  }\n#if defined(HAS_NOAA_TEX) || defined(HAS_POINT_TEX)\nvec4 bu = vec4(.0);\n  vec4 bv = vec4(.0);\n#ifdef HAS_POINT_TEX\nbu = texture2D(pointTextureSource, vTexCoord);\n#endif\n#ifdef HAS_NOAA_TEX\nbv = texture2D(noAaTextureSource, vTexCoord);\n#endif\nvec4 bw = bu + bv * (1. - bu.a);\n  l = bw + l * (1. - bw.a);\n#endif\nif(enableToneMapping == 1.) {\n    l.rgb = Z(l.rgb);\n  }\n#ifdef HAS_OUTLINE_TEX\nl = bt(l);\n#endif\ngl_FragColor = l;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}getMeshCommand(e,n){const t=this.dkey||"";return this.commands[t+"_fxaa"]||(this.commands[t+"_fxaa"]=this.createREGLCommand(e,null,n.getElements())),this.commands[t+"_fxaa"]}}class En$4 extends Mn$4{constructor(){super({vert:An$4,frag:"precision mediump float;\n#define SHADER_NAME SSAO_BLUR\nstruct MaterialParams {\n  float farPlaneOverEdgeDistance;\n  vec2 axis;\n  vec2 resolution;\n};\nuniform sampler2D materialParams_ssao;\nuniform sampler2D TextureInput;\nuniform MaterialParams materialParams;\nvarying vec2 vTexCoord;\nconst int c = 6;\nfloat d[8];\nvoid e() {\n  d[0] = .099736;\n  d[1] = .096667;\n  d[2] = .088016;\n  d[3] = .075284;\n  d[4] = .060493;\n  d[5] = .045662;\n}\nfloat f(vec2 h) {\n  return (h.x * (256. / 257.) + h.y * (1. / 257.));\n}\nvoid tap(inout float i, inout float j, float k, float h, vec2 l) {\n  vec3 m = texture2D(materialParams_ssao, l).rgb;\n  float n = k;\n  i += m.r * n;\n  j += n;\n}\nvoid main() {\n  e();\n  highp vec2 o = vTexCoord;\n  vec3 m = texture2D(materialParams_ssao, o).rgb;\n  if(m.g * m.b == 1.) {\n    if(materialParams.axis.y > .0) {\n      vec4 u = texture2D(TextureInput, o);\n      gl_FragColor = u;\n    } else {\n      gl_FragColor = vec4(m, 1.);\n    }\n    return;\n  }\n  float h = f(m.gb);\n  float j = d[0];\n  float i = m.r * j;\n  vec2 v = materialParams.axis / materialParams.resolution;\n  vec2 A = v;\n  for(int B = 1; B < c; B++) {\n    float k = d[B];\n    tap(i, j, k, h, o + A);\n    tap(i, j, k, h, o - A);\n    A += v;\n  }\n  float C = i * (1. / j);\n  vec2 gb = m.gb;\n  if(materialParams.axis.y > .0) {\n    vec4 u = texture2D(TextureInput, o);\n    gl_FragColor = vec4(u.rgb * C, u.a);\n  } else {\n    gl_FragColor = vec4(C, gb, 1.);\n  }\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}}})}getMeshCommand(e,n){return this.commands.ssao_blur||(this.commands.ssao_blur=this.createREGLCommand(e,null,n.getElements())),this.commands.ssao_blur}}const Pn$4=[-2e-6,0,2e-6,-.095089,.004589,-.031253,.01518,-.025586,.003765,.073426,.021802,.002778,.094587,.043218,.089148,-.009509,.051369,.019673,.139973,-.101685,.10857,-.103804,.219853,-.043016,.004841,-.033988,.094187,.028011,.058466,-.25711,-.051031,.074993,.259843,.118822,-.186537,-.134192,.063949,-.094894,-.072683,.108176,.327108,-.254058,-.04718,.21918,.263895,-.407709,.240834,-.200352];class In$4 extends Mn$4{constructor(){super({vert:An$4,frag:"#if __VERSION__ == 100\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision highp float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#define SHADER_NAME SSAO_EXTRACT\n#define PI 3.14159265359\nconst float c = .0625;\nstruct MaterialParams {\n  mat4 projMatrix;\n  mat4 invProjMatrix;\n  vec4 resolution;\n  float radius;\n  float bias;\n  float power;\n  vec2 cameraNearFar;\n};\nuniform MaterialParams materialParams;\nuniform sampler2D materialParams_depth;\n#define NOISE_NONE      0\n#define NOISE_PATTERN   1\n#define NOISE_RANDOM    2\n#define NOISE_TYPE      NOISE_PATTERN\nconst int d = 16;\nuniform vec3 kSphereSamples[16];\nvec3 e(const int x) {\n  if(x == 0) {\n    return vec3(-.078247, -.749924, -.656880);\n  } else if(x == 1) {\n    return vec3(-.572319, -.102379, -.813615);\n  } else if(x == 2) {\n    return vec3(.048653, -.380791, .923380);\n  } else if(x == 3) {\n    return vec3(.281202, -.656664, -.699799);\n  } else if(x == 4) {\n    return vec3(.711911, -.235841, -.661485);\n  } else if(x == 5) {\n    return vec3(-.445893, .611063, .654050);\n  } else if(x == 6) {\n    return vec3(-.703598, .674837, .222587);\n  } else if(x == 7) {\n    return vec3(.768236, .507457, .390257);\n  } else if(x == 8) {\n    return vec3(-.670286, -.470387, .573980);\n  } else if(x == 9) {\n    return vec3(.199235, .849336, -.488808);\n  } else if(x == 10) {\n    return vec3(-.768068, -.583633, -.263520);\n  } else if(x == 11) {\n    return vec3(-.897330, .328853, .294372);\n  } else if(x == 12) {\n    return vec3(-.570930, -.531056, -.626114);\n  } else if(x == 13) {\n    return vec3(.699014, .063283, -.712303);\n  } else if(x == 14) {\n    return vec3(.207495, .976129, -.064172);\n  } else if(x == 15) {\n    return vec3(-.060901, -.869738, -.489742);\n  } else {\n    return vec3(.0);\n  }\n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n  \n}\nvec2 f(highp float h) {\n  highp float z = clamp(h * 1. / -materialParams.cameraNearFar.y, .0, 1.);\n  highp float t = floor(256. * z);\n  mediump float i = t * (1. / 256.);\n  mediump float j = 256. * z - t;\n  return vec2(i, j);\n}\nfloat k(highp vec2 l) {\n  l = fract(l * vec2(5.3987, 5.4421));\n  l += dot(l.yx, l.xy + vec2(21.5351, 14.3137));\n  highp float xy = l.x * l.y;\n  return fract(xy * 95.4307) + fract(xy * 75.04961) * .5;\n}\nvec3 m(const vec2 o) {\n  \n#if NOISE_TYPE == NOISE_RANDOM\nreturn normalize(2. * vec3(k(o), k(o * 2.), k(o * 4.)) - vec3(1.));\n#elif NOISE_TYPE == NOISE_PATTERN\nvec2 xy = floor(gl_FragCoord.xy);\n  float u = mod(xy.x, 4.);\n  float v = mod(xy.y, 4.);\n  return e(int(u + v * 4.));\n#else\nreturn vec3(.0);\n#endif\n}\nhighp mat4 A() {\n  return materialParams.projMatrix;\n}\nhighp mat4 B() {\n  return materialParams.invProjMatrix;\n}\nhighp float C(const vec2 o) {\n  return texture2D(materialParams_depth, o).r;\n}\nhighp float D(highp float h) {\n  highp mat4 E = A();\n  highp float z = h * 2. - 1.;\n  return -E[3].z / (z + E[2].z);\n}\nhighp float F(const vec2 o) {\n  return D(texture2D(materialParams_depth, o).r);\n}\nhighp vec3 G(in vec2 p, highp float H) {\n  p = p * 2. - 1.;\n  highp mat4 I = B();\n  p.x *= I[0].x;\n  p.y *= I[1].y;\n  return vec3(p * -H, H);\n}\nhighp vec3 J(const highp vec3 K) {\n  highp vec3 L = dFdx(K);\n  highp vec3 M = dFdy(K);\n  return cross(L, M);\n}\nhighp vec3 J(const highp vec3 K, const vec2 o) {\n  vec2 N = o + vec2(materialParams.resolution.z, .0);\n  vec2 O = o + vec2(.0, materialParams.resolution.w);\n  highp vec3 px = G(N, F(N));\n  highp vec3 py = G(O, F(O));\n  highp vec3 L = px - K;\n  highp vec3 M = py - K;\n  return cross(L, M);\n}\nfloat P(const highp vec3 Q, const highp float R, mat3 S, const vec3 T, const vec3 U) {\n  highp mat4 E = A();\n  float V = materialParams.radius;\n  float W = materialParams.bias;\n  highp vec3 X = S * U;\n  float Y = dot(X, T);\n  X = sign(Y) * X;\n  X = Q + X * V;\n  highp vec4 Z = E * vec4(X, 1.);\n  Z.xy = Z.xy * (.5 / Z.w) + .5;\n  highp float ba = C(Z.xy);\n  ba = D(ba);\n  float t = saturate(V / abs(R - ba));\n  float bb = t * t * (3. - 2. * t);\n  return (ba >= X.z + W ? bb : .0);\n}\nvoid main() {\n  highp vec2 o = vTexCoord;\n  highp float h = C(o);\n  highp float bc = D(h);\n  highp vec3 Q = G(o, bc);\n  highp vec3 T = J(Q, o);\n  T = normalize(T);\n  vec3 bd = m(o);\n  vec3 be = bd.xyz;\n  vec3 bf = normalize(be - T * dot(be, T));\n  vec3 bg = cross(T, bf);\n  mat3 S = mat3(bf, bg, T);\n  float bh = .0;\n  for(int bi = 0; bi < d; bi++) {\n    bh += P(Q, bc, S, T, kSphereSamples[bi]);\n  }\n  float bj = 1. - bh / float(d);\n  bj = mix(bj, bj * bj, materialParams.power);\n  glFragColor = vec4(bj, f(Q.z), 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"kSphereSamples",type:"function",fn:function(){return Pn$4}}],extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}}}),this.version=300}getMeshCommand(e,n){return this.commands.ssao_extract||(this.commands.ssao_extract=this.createREGLCommand(e,null,n.getElements())),this.commands.ssao_extract}}const wn$4=[];class Dn$4{constructor(e){this._renderer=e}render(e,n,t){const{width:r,height:i}=t;return this._initShaders(),this._extractFBO||this._createTextures(t),this._extract(e,r,i,t),this._blurAndCombine(n,e.cameraFar,r,i)}_blurAndCombine(e,n,t,r){const i=Math.floor(t/2),o=Math.floor(r/2);this._blurHTex.width===i&&this._blurHTex.height===o||(this._blurHFBO.resize(i,o),this._blurVFBO.resize(t,r));const a=[t,r],s=[1,0];return this._renderer.render(this._ssaoBlurShader,{TextureInput:e,materialParams_ssao:this._extractTex,materialParams:{axis:s,farPlaneOverEdgeDistance:-n/.0625,resolution:a},outputSize:[i,o]},null,this._blurHFBO),s[0]=0,s[1]=1,this._renderer.render(this._ssaoBlurShader,{TextureInput:e,materialParams_ssao:this._blurHTex,materialParams:{axis:s,farPlaneOverEdgeDistance:-n/.0625,resolution:a},outputSize:[t,r]},null,this._blurVFBO),this._blurVTex}_extract(e,t,r,i){const o=Math.floor(t/2),a=Math.floor(r/2);this._extractFBO.width===o&&this._extractFBO.height===a||this._extractFBO.resize(o,a);const{projMatrix:s}=e,c=invert$2(wn$4,s);this._renderer.render(this._ssaoExtractShader,{materialParams_depth:i,materialParams:{projMatrix:s,invProjMatrix:c,resolution:[o,a,1/o,1/a],radius:e.radius,bias:e.bias,power:e.power||1,cameraNearFar:[e.cameraNear,e.cameraFar]},outputSize:[o,a]},null,this._extractFBO)}_createTextures(e){const n=Math.floor(e.width/2),t=Math.floor(e.height/2);this._extractTex=this._createTex(n,t,"uint8"),this._extractFBO=this._createFBO(this._extractTex),this._blurHTex=this._createTex(n,t,"uint8"),this._blurHFBO=this._createFBO(this._blurHTex),this._blurVTex=this._createTex(e.width,e.height,"uint8"),this._blurVFBO=this._createFBO(this._blurVTex)}_createTex(e,n,t){return this._renderer.regl.texture({min:"linear",mag:"linear",wrap:"clamp",type:t,width:e,height:n})}_createFBO(e){return this._renderer.regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}dispose(){this._extractFBO&&(this._extractFBO.destroy(),delete this._extractFBO,this._blurVFBO.destroy(),this._blurHFBO.destroy(),this._ssaoExtractShader.dispose(),this._ssaoBlurShader.dispose(),delete this._ssaoExtractShader)}_initShaders(){this._ssaoExtractShader||(this._ssaoExtractShader=new In$4,this._ssaoBlurShader=new En$4)}}class Rn$4 extends Mn$4{constructor(){super({vert:An$4,frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec2 resolution;\nuniform sampler2D textureSource;\nuniform float enableVignette;\nuniform float enableGrain;\nuniform float enableLut;\nuniform float timeGrain;\nuniform float grainFactor;\nuniform vec2 lensRadius;\nuniform float frameMod;\nuniform sampler2D lookupTable;\nfloat c(const in vec2 d) {\n  vec3 e = fract(vec3(d.xyx) * .1031);\n  e += dot(e, e.yzx + 19.19);\n  return fract((e.x + e.y) * e.z);\n}\nfloat f() {\n  float h = c(gl_FragCoord.xy + 1000.0 * fract(timeGrain));\n  float i = h * 2. - 1.;\n  h = i * inversesqrt(abs(i));\n  h = max(-1., h);\n  h = h - sign(i) + .5;\n  return (h + .5) * .5;\n}\nvec4 j(const in vec4 k) {\n  float l = f();\n  return vec4(mix(k.rgb, k.rgb * (k.rgb + (1. - k.rgb) * 2. * l), grainFactor), k.a);\n}\nfloat m(const in float k) {\n  return k < .0031308 ? k * 12.92 : 1.055 * pow(k, 1. / 2.4) - .055;\n}\nvec3 m(const in vec3 k) {\n  return vec3(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055);\n}\nvec4 m(const in vec4 k) {\n  return vec4(k.r < .0031308 ? k.r * 12.92 : 1.055 * pow(k.r, 1. / 2.4) - .055, k.g < .0031308 ? k.g * 12.92 : 1.055 * pow(k.g, 1. / 2.4) - .055, k.b < .0031308 ? k.b * 12.92 : 1.055 * pow(k.b, 1. / 2.4) - .055, k.a);\n}\nfloat n(const in float k) {\n  return k < .04045 ? k * (1. / 12.92) : pow((k + .055) * (1. / 1.055), 2.4);\n}\nvec3 n(const in vec3 k) {\n  return vec3(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4));\n}\nvec4 n(const in vec4 k) {\n  return vec4(k.r < .04045 ? k.r * (1. / 12.92) : pow((k.r + .055) * (1. / 1.055), 2.4), k.g < .04045 ? k.g * (1. / 12.92) : pow((k.g + .055) * (1. / 1.055), 2.4), k.b < .04045 ? k.b * (1. / 12.92) : pow((k.b + .055) * (1. / 1.055), 2.4), k.a);\n}\nfloat o(const in vec2 d, const in float u) {\n  vec3 v = vec3(.06711056, .00583715, 52.9829189);\n  return fract(v.z * fract(dot(d.xy + u * vec2(47., 17.) * .695, v.xy)));\n}\nfloat A() {\n  vec2 B = lensRadius;\n  B.y = min(B.y, B.x - 1e-4);\n  float C = o(gl_FragCoord.xy, frameMod);\n  C = (B.x - B.y) * (B.x + B.y) * .07 * (C - .5);\n  return smoothstep(B.x, B.y, C + distance(vTexCoord, vec2(.5)));\n}\nvec4 D(const in vec4 k) {\n  float l = A();\n  return vec4(m(n(k.rgb) * l), clamp(k.a + (1. - l), .0, 1.));\n}\nvec4 E(in vec4 F, in sampler2D G) {\n  mediump float H = F.b * 63.;\n  mediump vec2 I;\n  I.y = floor(floor(H) / 8.);\n  I.x = floor(H) - I.y * 8.;\n  mediump vec2 J;\n  J.y = floor(ceil(H) / 8.);\n  J.x = ceil(H) - J.y * 8.;\n  highp vec2 K;\n  K.x = I.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  K.y = I.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nK.y = 1. - K.y;\n#endif\nhighp vec2 L;\n  L.x = J.x * .125 + .5 / 512. + (.125 - 1. / 512.) * F.r;\n  L.y = J.y * .125 + .5 / 512. + (.125 - 1. / 512.) * F.g;\n#ifdef LUT_FLIP_Y\nL.y = 1. - L.y;\n#endif\nlowp vec4 M = texture2D(G, K);\n  lowp vec4 N = texture2D(G, L);\n  lowp vec4 O = mix(M, N, fract(H));\n  return O;\n}\nvoid main() {\n  vec4 k = texture2D(textureSource, vTexCoord);\n  if(enableLut == 1.) {\n    k = E(k, lookupTable);\n  }\n  if(enableVignette == 1.) {\n    k = D(k);\n  }\n  if(enableGrain == 1.) {\n    k = j(k);\n  }\n  gl_FragColor = k;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}getMeshCommand(e,n){return this.commands.postprocess||(this.commands.postprocess=this.createREGLCommand(e,null,n.getElements())),this.commands.postprocess}}class Nn$4 extends Mn$4{constructor(){super({vert:An$4,frag:"#define SHADER_NAME TAA\nprecision mediump float;\n#define saturate(x)        clamp(x, 0.0, 1.0)\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\n#define TEXTURE_SPACE_UP    -1\n#define TEXTURE_SPACE_DN     1\n#else\n#define TEXTURE_SPACE_UP     1\n#define TEXTURE_SPACE_DN    -1\n#endif\n#define BOX_TYPE_AABB           0\n#define BOX_TYPE_VARIANCE       1\n#define BOX_TYPE_AABB_VARIANCE  2\n#define VARIANCE_GAMMA          1.0\n#define BOX_CLIPPING_ACCURATE   0\n#define BOX_CLIPPING_CLAMP      1\n#define BOX_CLIPPING_NONE       2\n#if defined(TARGET_MOBILE)\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            1\n#define FILTER_HISTORY          0\n#else\n#define BOX_CLIPPING            BOX_CLIPPING_ACCURATE\n#define BOX_TYPE                BOX_TYPE_AABB_VARIANCE\n#define USE_YCoCg               0\n#define FILTER_INPUT            0\n#define FILTER_HISTORY          0\n#endif\n#define HISTORY_REPROJECTION    1\n#define PREVENT_FLICKERING      0\nstruct MaterialParams {\n  float alpha;\n  mat4 reprojection;\n};\nuniform sampler2D materialParams_color;\nuniform sampler2D materialParams_history;\nuniform vec2 materialParams_history_size;\nuniform vec2 textureOutputSize;\nuniform sampler2D materialParams_depth;\nuniform MaterialParams materialParams;\nfloat c(const vec3 d) {\n  return dot(d, vec3(.2126, .7152, .0722));\n}\nfloat e(const vec3 f) {\n  \n#if USE_YCoCg\nreturn f.x;\n#else\nreturn c(f);\n#endif\n}\nvec3 h(const vec3 i) {\n  float j = dot(i.rgb, vec3(1, 2, 1) * .25);\n  float k = dot(i.rgb, vec3(2, 0, -2) * .25);\n  float l = dot(i.rgb, vec3(-1, 2, -1) * .25);\n  return vec3(j, k, l);\n}\nvec3 m(const vec3 i) {\n  float j = i.x;\n  float k = i.y;\n  float l = i.z;\n  float r = j + k - l;\n  float g = j + l;\n  float b = j - k - l;\n  return vec3(r, g, b);\n}\nvec4 n(const int o, const vec3 u, const vec3 v, const vec4 i, const vec4 A) {\n  const float B = .0001;\n  if(o == BOX_CLIPPING_ACCURATE) {\n    vec4 r = i - A;\n    vec3 C = 1. / (B + r.rgb);\n    vec3 D = (v - A.rgb) * C;\n    vec3 E = (u - A.rgb) * C;\n    vec3 F = min(D, E);\n    return A + r * saturate(max(max(F.x, F.y), F.z));\n  } else if(o == BOX_CLIPPING_CLAMP) {\n    return vec4(clamp(A.rgb, u, v), A.a);\n  }\n  return A;\n}\nvec4 G(const sampler2D H, const highp vec2 I, const highp vec2 J) {\n  highp vec2 K = I * J;\n  highp vec2 L = floor(K - .5) + .5;\n  highp vec2 M = K - L;\n  highp vec2 N = M * M;\n  highp vec2 O = N * M;\n  vec2 P = N - .5 * (O + M);\n  vec2 Q = 1.5 * O - 2.5 * N + 1.;\n  vec2 R = .5 * (O - N);\n  vec2 S = 1. - P - Q - R;\n  vec2 T = Q + S;\n  highp vec2 U = L - vec2(1.);\n  highp vec2 V = L + vec2(2.);\n  highp vec2 W = L + S / T;\n  highp vec2 X = 1. / J;\n  U *= X;\n  V *= X;\n  W *= X;\n  float Z = T.x * P.y;\n  float ba = P.x * T.y;\n  float bb = T.x * T.y;\n  float bc = R.x * T.y;\n  float bd = T.x * R.y;\n  vec4 be = texture2D(H, vec2(W.x, U.y)) * Z + texture2D(H, vec2(U.x, W.y)) * ba + texture2D(H, vec2(W.x, W.y)) * bb + texture2D(H, vec2(V.x, W.y)) * bc + texture2D(H, vec2(W.x, V.y)) * bd;\n  be *= 1. / (Z + ba + bb + bc + bd);\n  return be;\n}\nvec4 bf(sampler2D H, vec2 I, float bg, ivec2 bh) {\n  return texture2D(H, I + vec2(bh));\n}\nvoid main() {\n  highp vec4 I = (gl_FragCoord.xy / textureOutputSize.xy).xyxy;\n  float bi = texture2D(materialParams_depth, I.xy).r;\n#if HISTORY_REPROJECTION\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\nhighp vec4 q = materialParams.reprojection * vec4(I.zw, bi, 1.);\n  I.zw = (q.xy * (1. / q.w)) * .5 + .5;\n#if defined(TARGET_METAL_ENVIRONMENT) || defined(TARGET_VULKAN_ENVIRONMENT)\nI.w = 1. - I.w;\n#endif\n#endif\nvec4 f = bf(materialParams_color, I.xy, .0, ivec2(0));\n#if FILTER_HISTORY\nvec4 bj = G(materialParams_history, I.zw, materialParams_history_size);\n#else\nvec4 bj = texture2D(materialParams_history, I.zw);\n#endif\n#if USE_YCoCg\nbj.rgb = h(bj.rgb);\n#endif\nvec3 s[9];\n  s[0] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_DN)).rgb;\n  s[1] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_DN)).rgb;\n  s[2] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_DN)).rgb;\n  s[3] = bf(materialParams_color, I.xy, .0, ivec2(-1, 0)).rgb;\n  s[4] = f.rgb;\n  s[5] = bf(materialParams_color, I.xy, .0, ivec2(1, 0)).rgb;\n  s[6] = bf(materialParams_color, I.xy, .0, ivec2(-1, TEXTURE_SPACE_UP)).rgb;\n  s[7] = bf(materialParams_color, I.xy, .0, ivec2(0, TEXTURE_SPACE_UP)).rgb;\n  s[8] = bf(materialParams_color, I.xy, .0, ivec2(1, TEXTURE_SPACE_UP)).rgb;\n#if USE_YCoCg\nfor(int bk = 0; bk < 9; bk++) {\n    s[bk] = h(s[bk]);\n  }\n  f.rgb = s[4].rgb;\n#endif\n#if FILTER_INPUT\n#else\nvec4 bl = f;\n#endif\n#if BOX_TYPE == BOX_TYPE_AABB || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 u = min(s[4], min(min(s[1], s[3]), min(s[5], s[7])));\n  vec3 v = max(s[4], max(max(s[1], s[3]), max(s[5], s[7])));\n  vec3 bm = min(u, min(min(s[0], s[2]), min(s[6], s[8])));\n  vec3 bn = max(v, max(max(s[0], s[2]), max(s[6], s[8])));\n  u = (u + bm) * .5;\n  v = (v + bn) * .5;\n#endif\n#if BOX_TYPE == BOX_TYPE_VARIANCE || BOX_TYPE == BOX_TYPE_AABB_VARIANCE\nvec3 bo = s[4];\n  vec3 bp = s[4] * s[4];\n  for(int bk = 1; bk < 9; bk += 2) {\n    bo += s[bk];\n    bp += s[bk] * s[bk];\n  }\n  vec3 bq = bo * (1. / 5.);\n  vec3 br = bp * (1. / 5.);\n  vec3 bs = sqrt(br - bq * bq);\n#if BOX_TYPE == BOX_TYPE_VARIANCE\nvec3 u = bq - VARIANCE_GAMMA * bs;\n  vec3 v = bq + VARIANCE_GAMMA * bs;\n#else\nu = min(u, bq - VARIANCE_GAMMA * bs);\n  v = max(v, bq + VARIANCE_GAMMA * bs);\n#endif\n#endif\nfloat bt = e(bl.rgb);\n  float bu = e(bj.rgb);\n  float bv = materialParams.alpha;\n#if PREVENT_FLICKERING\nfloat bw = 1. - abs(bt - bu) / (.001 + max(bt, bu));\n  bv *= bw * bw;\n#endif\nbl.rgb *= 1. / (1. + bt);\n  bj.rgb *= 1. / (1. + bu);\n  vec4 be = mix(bj, bl, bv);\n  be.rgb *= 1. / (1. - e(be.rgb));\n#if USE_YCoCg\nbe.rgb = m(be.rgb);\n#endif\nbe = max(vec4(0), be);\n  gl_FragColor = be;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.materialParams_color.width,height:(e,n)=>n.materialParams_color.height},blend:{enable:!1}}})}getMeshCommand(e,n){return this.commands.taa||(this.commands.taa=this.createREGLCommand(e,null,n.getElements())),this.commands.taa}}const Fn$4=[2,0,0,0,0,2,0,0,0,0,-2,0,-1,-1,1,1];class Hn$4{constructor(e,n){this._jitter=n,this._renderer=e,this._halton=[],this._counter=0}needToRedraw(){return this._counter<this._jitter.getSampleCount()}render(e,t,r,i){const a=this._jitter;this._initShaders(),this._createTextures(e),i&&(this._counter=0),this._counter++;const s=a.getSampleCount();if(this._counter>=s)return this._prevTex;this._fbo.width===e.width&&this._fbo.height===e.height||this._fbo.resize(e.width,e.height);const c=this._outputTex,l=this._prevTex,f=this._uniforms||{materialParams_history_size:[l.width,l.height],textureOutputSize:[],materialParams:{alpha:1,reprojection:[],filterWeights:[]}};f.materialParams.alpha=1/this._counter;const d=f.materialParams.reprojection;multiply$5(d,this._prevProjMatrix||r,invert$2(d,r)),multiply$5(d,d,Fn$4),set(f.materialParams_history_size,l.width,l.height),set(f.textureOutputSize,e.width,e.height),f.materialParams_depth=t,f.materialParams_color=e,f.materialParams_history=l,this._renderer.render(this._shader,f,null,this._fbo);const u=this._outputTex,h=this._fbo;return this._outputTex=this._prevTex,this._fbo=this._prevFbo,this._prevTex=u,this._prevFbo=h,this._prevProjMatrix=copy$5(this._prevProjMatrix||[],r),c}dispose(){this._shader&&(this._shader.dispose(),delete this._shader),this._fbo&&this._fbo.destroy(),this._prevFbo&&this._prevFbo.destroy(),delete this._uniforms}_createTextures(e){if(this._outputTex)return;const n=this._renderer.regl;this._outputTex=this._createColorTex(e),this._fbo=n.framebuffer({width:e.width,height:e.height,colors:[this._outputTex],depth:!1,stencil:!1}),this._prevTex=this._createColorTex(e),this._prevFbo=n.framebuffer({width:e.width,height:e.height,colors:[this._prevTex],depth:!1,stencil:!1})}_createColorTex(e){return this._renderer.regl.texture({min:"linear",mag:"linear",type:"uint8",width:e.width,height:e.height})}_initShaders(){this._shader||(this._shader=new Nn$4)}}const Ln$4=[[.263385,-.0252475],[-.38545,.054485],[-.139795,-.5379925],[-.2793775,.6875475],[.7139025,.4710925],[.90044,-.16422],[.4481775,-.82799],[-.9253375,-.2910625],[.3468025,1.02292],[-1.13742,.33522],[-.7676225,-.9123175],[-.2005775,-1.1774125],[-.926525,.96876],[1.12909,-.7500325],[.9603,1.14625]],zn$4=Ln$4.length,kn$4=[0,0];for(let e=0;e<Ln$4.length;e++)kn$4[0]+=Ln$4[e][0],kn$4[1]+=Ln$4[e][1];kn$4[0]/=zn$4,kn$4[1]/=zn$4;class Bn$4{constructor(e){this._frameNum=0,this._ratio=e||.05,this._avg=[kn$4[0]*this._ratio,kn$4[1]*this._ratio]}getRatio(){return this._ratio}setRatio(e){this._ratio!==e&&(this._ratio=e,this.reset()),this._avg=[kn$4[0]*this._ratio,kn$4[1]*this._ratio]}getAverage(){return this._avg}reset(){this._frameNum=0}getJitter(e){const n=this._frameNum%zn$4,t=this._ratio;return set(e,Ln$4[n][0]*t,Ln$4[n][1]*t),e}frame(){this._frameNum++,this._frameNum%zn$4==0&&(this._frameNum=0)}getSampleCount(){return zn$4}}class Gn$4{constructor(e,n,t=5){this._regl=e,this._renderer=new B$6(e),this._inputRGBM=n,this._level=t}render(e,n){this._initShaders(),this._createTextures(e),this._blur(e,n||0);const t={blurTex0:this._blur01Tex,blurTex1:this._blur11Tex,blurTex2:this._blur21Tex,blurTex3:this._blur31Tex,blurTex4:this._blur41Tex};return this._level>5&&(t.blurTex5=this._blur51Tex,t.blurTex6=this._blur61Tex),t}_blur(e,n){let t=this._blurUniforms;t||(t=this._blurUniforms={rgbmRange:7,blurDir:[0,0],outSize:[0,0],pixelRatio:[1,1],outputSize:[0,0]}),set(t.outSize,e.width,e.height),this._blurOnce(this._blur0Shader,e,this._blur00FBO,this._blur01FBO,.5,n),this._blurOnce(this._blur1Shader,this._blur01FBO.color[0],this._blur10FBO,this._blur11FBO,.5),this._blurOnce(this._blur2Shader,this._blur11FBO.color[0],this._blur20FBO,this._blur21FBO,.5),this._blurOnce(this._blur3Shader,this._blur21FBO.color[0],this._blur30FBO,this._blur31FBO,.5),this._blurOnce(this._blur4Shader,this._blur31FBO.color[0],this._blur40FBO,this._blur41FBO,.5),this._level>5&&(this._blurOnce(this._blur5Shader,this._blur41FBO.color[0],this._blur50FBO,this._blur51FBO,.5),this._blurOnce(this._blur6Shader,this._blur51FBO.color[0],this._blur60FBO,this._blur51FBO,.5))}_blurOnce(e,n,t,r,i,a){const s=Math.ceil(i*n.width),c=Math.ceil(i*n.height);t.width===s&&t.height===c||t.resize(s,c),r.width===s&&r.height===c||r.resize(s,c);const l=this._blurUniforms;l.luminThreshold=a,l.TextureBlurInput=n,l.inputRGBM=+this._inputRGBM,set(l.blurDir,0,1),set(l.outputSize,t.width,t.height),this._renderer.render(e,l,null,t),l.luminThreshold=0,l.inputRGBM=1,set(l.blurDir,1,0),l.TextureBlurInput=t.color[0],this._renderer.render(e,l,null,r)}dispose(){this._blur0Shader&&(this._blur0Shader.dispose(),delete this._blur0Shader,this._blur1Shader.dispose(),this._blur2Shader.dispose(),this._blur3Shader.dispose(),this._blur4Shader.dispose(),this._blur5Shader&&(this._blur5Shader.dispose(),this._blur6Shader.dispose(),delete this._blur5Shader)),this._blur00Tex&&(delete this._blur00Tex,this._blur00FBO.destroy(),this._blur01FBO.destroy(),this._blur10FBO.destroy(),this._blur11FBO.destroy(),this._blur20FBO.destroy(),this._blur21FBO.destroy(),this._blur30FBO.destroy(),this._blur31FBO.destroy(),this._blur40FBO.destroy(),this._blur41FBO.destroy(),this._blur50FBO&&(this._blur50FBO.destroy(),this._blur51FBO.destroy(),this._blur60FBO.destroy(),this._blur61FBO.destroy()))}_createTextures(e){if(this._blur00Tex)return;let n=e.width,t=e.height;this._blur00Tex=this._createColorTex(e,n,t),this._blur00FBO=this._createBlurFBO(this._blur00Tex),this._blur01Tex=this._createColorTex(e),this._blur01FBO=this._createBlurFBO(this._blur01Tex),n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur10Tex=this._createColorTex(e,n,t),this._blur10FBO=this._createBlurFBO(this._blur10Tex),this._blur11Tex=this._createColorTex(e,n,t),this._blur11FBO=this._createBlurFBO(this._blur11Tex),n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur20Tex=this._createColorTex(e,n,t),this._blur20FBO=this._createBlurFBO(this._blur20Tex),this._blur21Tex=this._createColorTex(e,n,t),this._blur21FBO=this._createBlurFBO(this._blur21Tex),n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur30Tex=this._createColorTex(e,n,t),this._blur30FBO=this._createBlurFBO(this._blur30Tex),this._blur31Tex=this._createColorTex(e,n,t),this._blur31FBO=this._createBlurFBO(this._blur31Tex),n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur40Tex=this._createColorTex(e,n,t),this._blur40FBO=this._createBlurFBO(this._blur40Tex),this._blur41Tex=this._createColorTex(e,n,t),this._blur41FBO=this._createBlurFBO(this._blur41Tex),this._level>5&&(n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur50Tex=this._createColorTex(e,n,t),this._blur50FBO=this._createBlurFBO(this._blur50Tex),this._blur51Tex=this._createColorTex(e,n,t),this._blur51FBO=this._createBlurFBO(this._blur51Tex),n=Math.ceil(n/2),t=Math.ceil(t/2),this._blur60Tex=this._createColorTex(e,n,t),this._blur60FBO=this._createBlurFBO(this._blur60Tex),this._blur61Tex=this._createColorTex(e,n,t),this._blur61FBO=this._createBlurFBO(this._blur61Tex))}_createColorTex(e,n,t){return this._regl.texture({min:"linear",mag:"linear",type:"uint8",width:n||e.width,height:t||e.height})}_createBlurFBO(e){return this._regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._blur0Shader){const e={vert:An$4,extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}},frag:"#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\nuniform float inputRGBM;\nuniform float luminThreshold;\n#define SHADER_NAME GAUSSIAN_BLUR0\nconst vec3 c = vec3(.2126, .7152, .0722);\nfloat d(const in vec3 e) {\n  return dot(e, c);\n}\nvec4 f(vec4 e) {\n  float h = max(sign(d(e.rgb) - luminThreshold), .0);\n  return e * h;\n}\nvec2 i;\nvec4 j(const in vec3 e, const in float k) {\n  vec4 l;\n  vec3 m = e / k;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvec3 n(const in vec4 e, const in float k) {\n  if(inputRGBM == .0)\n    return e.rgb;\n  return k * e.rgb * e.a;\n}\nvec4 o() {\n  vec3 u = .375 * (f(vec4(n(texture2D(TextureBlurInput, i.xy), rgbmRange), 1.))).rgb;\n  vec2 v;\n  vec2 A = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  v = A * 1.2;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy + v.xy), rgbmRange), 1.))).rgb;\n  u += .3125 * (f(vec4(n(texture2D(TextureBlurInput, i.xy - v.xy), rgbmRange), 1.))).rgb;\n  return vec4(u, 1.);\n}\nvoid main(void) {\n  i = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = o();\n  e = j(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}"};this._blur0Shader=new Mn$4(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR1\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .3125 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.2857142857142858;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur1Shader=new Mn$4(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR2\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2734375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3333333333333333;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .328125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.111111111111111;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .03515625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur2Shader=new Mn$4(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR3\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .24609375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3636363636363635;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .322265625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.1818181818181817;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0537109375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur3Shader=new Mn$4(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR4\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .2255859375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  m = n * 1.3846153846153846;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .314208984375 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.230769230769231;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .06982421875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.076923076923077;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .003173828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur4Shader=new Mn$4(e),this._level>5&&(e.frag="precision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR5\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .20947265625 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.4;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .30548095703125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2666666666666666;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .08331298828125 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.133333333333334;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .00640869140625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur5Shader=new Mn$4(e),e.frag="#version 100\nprecision highp float;\nuniform float rgbmRange;\nuniform sampler2D TextureBlurInput;\nuniform sampler2D TextureInput;\nuniform vec2 blurDir;\nuniform vec2 outSize;\nuniform vec2 pixelRatio;\nuniform vec2 outputSize;\n#define SHADER_NAME GAUSSIAN_BLUR6\nvec2 c;\nvec4 d(const in vec3 e, const in float f) {\n  if(f <= .0)\n    return vec4(e, 1.);\n  vec4 h;\n  vec3 i = e / f;\n  h.a = clamp(max(max(i.r, i.g), max(i.b, 1e-6)), .0, 1.);\n  h.a = ceil(h.a * 255.) / 255.;\n  h.rgb = i / h.a;\n  return h;\n}\nvec3 j(const in vec4 e, const in float f) {\n  if(f <= .0)\n    return e.rgb;\n  return f * e.rgb * e.a;\n}\nvec4 k() {\n  vec3 l = .196380615234375 * (vec4(j(texture2D(TextureBlurInput, c.xy), rgbmRange), 1.)).rgb;\n  vec2 m;\n  vec2 n = pixelRatio.xy * blurDir.xy / outputSize.xy;\n  n *= outSize.y * .00075;\n  m = n * 1.411764705882353;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .2967529296875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 3.2941176470588234;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .09442138671875 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  m = n * 5.176470588235294;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy + m.xy), rgbmRange), 1.)).rgb;\n  l += .0103759765625 * (vec4(j(texture2D(TextureBlurInput, c.xy - m.xy), rgbmRange), 1.)).rgb;\n  return vec4(l, 1.);\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = k();\n  e = d(e.rgb, rgbmRange);\n  gl_FragColor = e;\n}",this._blur6Shader=new Mn$4(e))}}}class Un$4{constructor(e){this._regl=e,this._renderer=new B$6(e)}render(e,n,t,r,i,o,a,s,c){this._initShaders(),this._createTextures(e);const l=this._blurPass.render(n,t);return this._combine(e,l,n,r,i,o,a,s,c)}_combine(e,n,t,r,i,a,s,c,l){l||this._combineTex.width===e.width&&this._combineTex.height===e.height||this._combineFBO.resize(e.width,e.height);let f=this._combineUniforms;const{blurTex0:d,blurTex1:u,blurTex2:h,blurTex3:m,blurTex4:v}=n;f||(f=this._combineUniforms={bloomFactor:0,bloomRadius:0,rgbmRange:7,TextureBloomBlur1:d,TextureBloomBlur2:u,TextureBloomBlur3:h,TextureBloomBlur4:m,TextureBloomBlur5:v,TextureInput:null,TextureSource:null,outputSize:[0,0]}),f.noAaTextureSource=a,f.pointTextureSource=s,f.enableAA=c,f.bloomFactor=r,f.bloomRadius=i,f.TextureInput=t,f.TextureSource=e,set(f.outputSize,e.width,e.height);const _={};return a?_.HAS_NOAA_TEX=1:delete _.HAS_NOAA_TEX,s?_.HAS_POINT_TEX=1:delete _.HAS_POINT_TEX,this._combineShader.setDefines(_),this._renderer.render(this._combineShader,f,null,l?null:this._combineFBO),l?null:this._combineTex}dispose(){this._combineFBO&&(this._combineFBO.destroy(),delete this._combineFBO),this._blurPass&&(this._blurPass.dispose(),delete this._blurPass),delete this._uniforms}_createTextures(e){this._combineTex||(this._combineTex=this._createColorTex(e,e.width,e.height,"uint8"),this._combineFBO=this._createBlurFBO(this._combineTex))}_createColorTex(e,n,t,r){return this._renderer.regl.texture({min:"linear",mag:"linear",type:r,width:n||e.width,height:t||e.height})}_createBlurFBO(e){return this._renderer.regl.framebuffer({width:e.width,height:e.height,colors:[e],depth:!1,stencil:!1})}_initShaders(){if(!this._combineShader){const e={x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]};this._blurPass=new Gn$4(this._regl,!1),this._combineShader=new Mn$4({vert:An$4,frag:"#define FXAA_REDUCE_MIN   (1.0/ 128.0)\n#define FXAA_REDUCE_MUL   (1.0 / 8.0)\n#define FXAA_SPAN_MAX     8.0\nprecision highp float;\nuniform float bloomFactor;\nuniform float bloomRadius;\nuniform float rgbmRange;\nuniform sampler2D TextureBloomBlur1;\nuniform sampler2D TextureBloomBlur2;\nuniform sampler2D TextureBloomBlur3;\nuniform sampler2D TextureBloomBlur4;\nuniform sampler2D TextureBloomBlur5;\nuniform sampler2D TextureInput;\nuniform sampler2D TextureSource;\n#ifdef HAS_NOAA_TEX\nuniform sampler2D noAaTextureSource;\n#endif\n#ifdef HAS_POINT_TEX\nuniform sampler2D pointTextureSource;\n#endif\nuniform float enableAA;\nuniform vec2 outputSize;\n#define SHADER_NAME bloomCombine\nvec2 c;\nvec3 d(const in vec3 e) {\n  return vec3(e.r < .0031308 ? e.r * 12.92 : 1.055 * pow(e.r, 1. / 2.4) - .055, e.g < .0031308 ? e.g * 12.92 : 1.055 * pow(e.g, 1. / 2.4) - .055, e.b < .0031308 ? e.b * 12.92 : 1.055 * pow(e.b, 1. / 2.4) - .055);\n}\nvec3 f(const in vec4 e, const in float h) {\n  if(h <= .0)\n    return e.rgb;\n  return h * e.rgb * e.a;\n}\nfloat i(const float j, const float k) {\n  return mix(j, k * 2. - j, bloomRadius);\n}\nvec4 l(sampler2D m, vec2 n) {\n  vec4 e;\n  mediump vec2 o = vec2(1. / outputSize.x, 1. / outputSize.y);\n  vec3 u = texture2D(m, (n + vec2(-1., -1.)) * o).xyz;\n  vec3 v = texture2D(m, (n + vec2(1., -1.)) * o).xyz;\n  vec3 A = texture2D(m, (n + vec2(-1., 1.)) * o).xyz;\n  vec3 B = texture2D(m, (n + vec2(1.)) * o).xyz;\n  vec4 C = texture2D(m, n * o);\n  vec3 D = C.xyz;\n  vec3 E = vec3(.299, .587, .114);\n  float F = dot(u, E);\n  float G = dot(v, E);\n  float H = dot(A, E);\n  float I = dot(B, E);\n  float J = dot(D, E);\n  float K = min(J, min(min(F, G), min(H, I)));\n  float L = max(J, max(max(F, G), max(H, I)));\n  mediump vec2 M;\n  M.x = -((F + G) - (H + I));\n  M.y = (F + H) - (G + I);\n  float N = max((F + G + H + I) * (.25 * FXAA_REDUCE_MUL), FXAA_REDUCE_MIN);\n  float O = 1. / (min(abs(M.x), abs(M.y)) + N);\n  M = min(vec2(FXAA_SPAN_MAX), max(vec2(-FXAA_SPAN_MAX, -FXAA_SPAN_MAX), M * O)) * o;\n  vec4 P = .5 * (texture2D(m, n * o + M * (1. / 3. - .5)) + texture2D(m, n * o + M * (2. / 3. - .5)));\n  vec4 Q = P * .5 + .25 * (texture2D(m, n * o + M * -.5) + texture2D(m, n * o + M * .5));\n  float R = dot(Q.xyz, E);\n  if(R < K || R > L)\n    e = P;\n  else\n    e = Q;\n  return e;\n}\nvec4 S() {\n  vec3 T = vec3(.0);\n  const float U = .6;\n  const float V = 1.1;\n  const float W = .9;\n  const float X = .6;\n  const float Y = .3;\n  const float Z = .1;\n  T += (vec4(f(texture2D(TextureBloomBlur1, c), rgbmRange), 1.)).rgb * i(V, U);\n  T += (vec4(f(texture2D(TextureBloomBlur2, c), rgbmRange), 1.)).rgb * i(W, U);\n  T += (vec4(f(texture2D(TextureBloomBlur3, c), rgbmRange), 1.)).rgb * i(X, U);\n  T += (vec4(f(texture2D(TextureBloomBlur4, c), rgbmRange), 1.)).rgb * i(Y, U);\n  T += (vec4(f(texture2D(TextureBloomBlur5, c), rgbmRange), 1.)).rgb * i(Z, U);\n  vec4 ba;\n  if(enableAA == 1.) {\n    ba = l(TextureInput, gl_FragCoord.xy);\n  } else {\n    ba = texture2D(TextureInput, c);\n  }\n  ba.rgb = mix(vec3(.0), ba.rgb, sign(ba.a));\n  vec4 bb = texture2D(TextureSource, c);\n#ifdef HAS_NOAA_TEX\nvec4 bc = texture2D(noAaTextureSource, c);\n  bb = bc + bb * (1. - bc.a);\n#endif\nvec4 bd = vec4(.0);\n#ifdef HAS_POINT_TEX\nbd = texture2D(pointTextureSource, c);\n#endif\nfloat be = sqrt((T.r + T.g + T.b) / 3.);\n  vec4 bf = vec4(d(T * bloomFactor), be);\n  return bd + (ba + bb * (1. - ba.a)) * (1. - bd.a) + bf;\n}\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 e = S();\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:e}})}}}class Vn$4 extends Mn$4{constructor(){const e=[];super({vert:An$4,frag:"precision highp float;\n#include <gl2_frag>\n#define SHADER_NAME COPY_DEPTH\nuniform sampler2D TextureDepth;\nuniform vec2 textureSize;\n#include <common_pack_float>\nvoid main(void) {\n  vec2 c = gl_FragCoord.xy / textureSize.xy;\n  float d = texture2D(TextureDepth, c).r;\n  glFragColor = common_encodeDepth(d);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"textureSize",type:"function",fn:(n,t)=>(e[0]=t.TextureDepth.width,e[1]=t.TextureDepth.height,e)}],extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.TextureDepth.width,height:(e,n)=>n.TextureDepth.height}}}),this.version=300}getMeshCommand(e,n){return this.commands.copy_depth||(this.commands.copy_depth=this.createREGLCommand(e,null,n.getElements())),this.commands.copy_depth}}class jn$4{static getUniformDeclares(){const e=[[0,0,0,0],[0,0,0,0]],t=new Array(16);return[{name:"invProjMatrix",type:"function",fn:(e,r)=>invert$2(t,r.projMatrix)},{name:"outputFovInfo",type:"array",length:2,fn:function(n,t){const i=Math.tan(.5*t.fov),o=t.outSize[0]/t.outSize[1]*i;return set$3(e[0],o,i,o,-i),set$3(e[1],-o,i,-o,-i),e}},{name:"reprojViewProjMatrix",type:"function",fn:(e,t)=>multiply$5([],t.prevProjViewMatrix,t.cameraWorldMatrix)}]}static getDefines(){return{HAS_SSR:1}}constructor(e){this._regl=e,this._renderer=new B$6(e),this._inputRGBM=0}setup(e){this._initShaders(),this._createTextures(e)}getSSRUniforms(e,n,t){if(!this._depthCopy)return null;const r=this._depthCopy;return{TextureDepth:r,TextureReflected:this.getMipmapTexture(),ssrFactor:n||1,ssrQuality:t||2,outSize:[r.width,r.height],fov:e.getFov()*Math.PI/180,prevProjViewMatrix:this._projViewMatrix||e.projViewMatrix,cameraWorldMatrix:e.cameraWorldMatrix}}genMipMap(e,t,r){return this.setup(e),this._mipmap(e),this.copyDepthTex(t),this._projViewMatrix||(this._projViewMatrix=[]),copy$5(this._projViewMatrix,r),delete this._depthCopied,this._outputTex}getPrevProjViewMatrix(){return this._projViewMatrix}copyDepthTex(e){return this._depthCopied?null:(this.setup(e),this._depthCopy?e.width===this._depthCopy.width&&e.height===this._depthCopy.height||this._depthCopyFBO.resize(e.width,e.height):(this._depthCopy=this._regl.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"uint8",width:e.width,height:e.height}),this._depthCopyFBO=this._regl.framebuffer({width:e.width,height:e.height,colors:[this._depthCopy],colorFormat:"rgba"})),this._renderer.render(this._copyDepthShader,{TextureDepth:e},null,this._depthCopyFBO),this._depthCopied=!0,this._depthCopy)}_mipmap(e){const n=this._targetFBO,t=Math.ceil(.5*e.width),r=Math.ceil(.5*e.height);n.width===t&&n.height===r||n.resize(t,r);let i=this._blurUniforms;i||(i=this._blurUniforms={rgbmRange:7,outputSize:[0,0]}),i.TextureInput=e,i.inputRGBM=+this._inputRGBM,set(i.outputSize,n.width,n.height),this._renderer.render(this._ssrQuadShader,i,null,n)}getMipmapTexture(){return this._outputTex||(this._outputTex=this._renderer.regl.texture({type:"uint8",width:2,height:2})),this._outputTex}dispose(){this._copyDepthShader&&(this._ssrQuadShader.dispose(),this._copyDepthShader.dispose(),this._targetFBO.destroy(),delete this._copyDepthShader),this._depthCopy&&(this._depthCopyFBO.destroy(),delete this._depthCopy,delete this._depthCopyFBO)}_initShaders(){this._copyDepthShader||(this._copyDepthShader=new Vn$4,this._ssrQuadShader=new Mn$4({vert:An$4,frag:"#version 100\nprecision mediump float;\nuniform sampler2D TextureInput;\nuniform vec2 outputSize;\n#define SHADER_NAME QUAD\nvec2 c;\nvoid main(void) {\n  c = gl_FragCoord.xy / outputSize.xy;\n  vec4 d = texture2D(TextureInput, c.xy);\n  gl_FragColor = d;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.outputSize[0],height:(e,n)=>n.outputSize[1]}}}))}_createTextures(e){if(!this._targetFBO){const n=this._regl;this._outputTex&&this._outputTex.destroy(),this._outputTex=n.texture({min:"linear",mag:"linear",type:"uint8",width:e.width,height:e.height}),this._targetFBO=n.framebuffer({width:e.width,height:e.height,colors:[this._outputTex],depth:!1,stencil:!1})}}}class Xn$4 extends vn$4{constructor(e){const t=[];super({vert:"#define SHADER_NAME HEATMAP\nuniform mat4 projViewModelMatrix;\nuniform float extrudeScale;\nuniform float heatmapIntensity;\nattribute vec3 aPosition;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nattribute highp float aWeight;\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\nuniform mediump float heatmapRadius;\nconst highp float c = 1. / 255. / 16.;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float d = aWeight / 255.;\n  weight = d;\n#else\nhighp float d = heatmapWeight;\n#endif\nmediump float e = heatmapRadius;\n  vec2 f = vec2(mod(aPosition.xy, 2.) * 2. - 1.);\n  float h = sqrt(-2. * log(c / d / heatmapIntensity / GAUSS_COEF)) / 3.;\n  vExtrude = h * f;\n  vec2 i = vExtrude * e * extrudeScale;\n  vec4 j = vec4(floor(aPosition.xy * .5) + i, aPosition.z, 1);\n  gl_Position = projViewModelMatrix * j;\n}",frag:"#define SHADER_NAME HEATMAP\nprecision mediump float;\nuniform highp float heatmapIntensity;\nvarying vec2 vExtrude;\n#ifdef HAS_HEAT_WEIGHT\nvarying highp float weight;\n#else\nuniform highp float heatmapWeight;\n#endif\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n  \n#ifdef HAS_HEAT_WEIGHT\nhighp float c = weight;\n#else\nhighp float c = heatmapWeight;\n#endif\nfloat d = -.5 * 3. * 3. * dot(vExtrude, vExtrude);\n  float e = c * heatmapIntensity * GAUSS_COEF * exp(d);\n  gl_FragColor = vec4(e, 1., 1., 1.);\n}",uniforms:[{name:"extrudeScale",type:"function",fn:function(e,n){return n.resolution/n.dataResolution*n.tileRatio}},{name:"projViewModelMatrix",type:"function",fn:function(e,r){return multiply$5(t,r.projViewMatrix,r.modelMatrix)}}],extraCommandProps:v$3({},e&&e.extraCommandProps||{},{blend:{enable:!0,func:{src:"one",dst:"one"},equation:"add"}})})}}var Wn$4=[-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,-1,-1,-1,1,-1,-1,-1,-1,1,-1,-1,1,-1,-1,1,1,-1,-1,1,1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,-1,-1,1,-1,1,1,1,1,1,1,1,1,1,-1,1,-1,-1,1,-1,1,-1,1,1,-1,1,1,1,1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,1,-1,-1,1,-1,-1,-1,-1,1,1,-1,1],Kn$4="#define SHADER_NAME SKYBOX\n#if __VERSION__ == 100\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\nprecision highp float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nvarying vec3 vWorldPos;\n#ifdef USE_AMBIENT\nuniform vec3 diffuseSPH[9];\n#else\nuniform samplerCube cubeMap;\nuniform float bias;\nuniform float size;\n#endif\nuniform float environmentExposure;\n#if defined(INPUT_RGBM) || defined(ENC_RGBM)\nuniform float rgbmRange;\n#endif\nvec4 c(const in vec3 d, const in float e) {\n  if(e <= .0)\n    return vec4(d, 1.);\n  vec4 f;\n  vec3 h = d / e;\n  f.a = clamp(max(max(h.r, h.g), max(h.b, 1e-6)), .0, 1.);\n  f.a = ceil(f.a * 255.) / 255.;\n  f.rgb = h / f.a;\n  return f;\n}\nvec3 i(const in vec4 d, const in float e) {\n  if(e <= .0)\n    return d.rgb;\n  return e * d.rgb * d.a;\n}\nvec4 j(const in samplerCube k, const in vec3 l, const in float m, const in float n) {\n  vec3 o = l;\n  return textureCubeLod(k, o, n);\n}\nvec3 u(const in vec3 v, const in vec3 A[9]) {\n  float x = v.x;\n  float y = v.y;\n  float z = v.z;\n  vec3 B = (A[0] + A[1] * x + A[2] * y + A[3] * z + A[4] * z * x + A[5] * y * z + A[6] * y * x + A[7] * (3. * z * z - 1.) + A[8] * (x * x - y * y));\n  return max(B, vec3(.0));\n}\nfloat C(const in vec2 D) {\n  vec3 E = fract(vec3(D.xyx) * .1031);\n  E += dot(E, E.yzx + 19.19);\n  return fract((E.x + E.y) * E.z);\n}\nvoid main() {\n  vec4 F;\n#ifdef USE_AMBIENT\nvec3 v = normalize(vWorldPos + mix(-.5 / 255., .5 / 255., C(gl_FragCoord.xy)) * 2.);\n  F = vec4(u(v, diffuseSPH), 1.);\n  if(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n#else\nF = j(cubeMap, vWorldPos, size, bias);\n#endif\nF.rgb *= environmentExposure;\n#ifdef ENC_RGBM\n#if !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(i(F, rgbmRange).rgb, hsv);\n    F = c(F.rgb, rgbmRange);\n  }\n#else\nF = c(F.rgb, rgbmRange);\n#endif\nglFragColor = F;\n#elif !defined(USE_AMBIENT) && defined(INPUT_RGBM)\nglFragColor = vec4(i(F, rgbmRange), 1.);\n  if(length(hsv) > .0) {\n    glFragColor.rgb = hsv_apply(clamp(glFragColor.rgb, .0, 1.), hsv);\n  }\n#else\nif(length(hsv) > .0) {\n    F.rgb = hsv_apply(F.rgb, hsv);\n  }\n  glFragColor = F;\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}";class qn$4 extends vn$4{constructor(){super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 transformMatrix;\nvarying vec3 vWorldPos;\nvoid main() {\n  vWorldPos = aPosition;\n  mat4 c = mat4(mat3(viewMatrix) * transformMatrix);\n  vec4 d = projMatrix * c * vec4(vWorldPos, 1.);\n  gl_Position = d.xyww;\n}",frag:Kn$4,extraCommandProps:{depth:{enable:!0,range:[1,1],func:"lequal"},viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}}),this.version=300}setMode(e,n,t){const r={};return e&&(r.INPUT_RGBM=1),n&&(r.ENC_RGBM=1),0===t&&(r.USE_AMBIENT=1),this._skyboxMesh?this._skyboxMesh[0].setDefines(r):this._meshDefines=r,this}draw(e){return this._skyboxMesh||this._createSkyboxMesh(e),super.draw(e,this._skyboxMesh)}_createSkyboxMesh(e){const n=new Q$7({aPosition:new Int8Array(Wn$4)},null,Wn$4.length/3);n.generateBuffers(e),this._skyboxMesh=[new Be$5(n)],this._meshDefines&&(this._skyboxMesh[0].setDefines(this._meshDefines),delete this._meshDefines)}dispose(){if(this._skyboxMesh){const e=this._skyboxMesh[0];e.geometry.dispose(),e.dispose()}return delete this._skyboxMesh,super.dispose()}}class Yn$4 extends vn$4{constructor(e,t){const r={blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},viewport:e};t&&t.extraCommandProps&&v$3(r,t.extraCommandProps);const i=[];super({vert:"#define SHADER_NAME HEATMAP_DISPLAY\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nvoid main() {\n  gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n}",frag:"#define SHADER_NAME HEATMAP_DISPLAY\nprecision mediump float;\nuniform sampler2D inputTexture;\nuniform sampler2D colorRamp;\nuniform vec2 textureOutputSize;\nuniform float heatmapOpacity;\nvoid main() {\n  vec2 c = gl_FragCoord.xy / textureOutputSize.xy;\n  float t = texture2D(inputTexture, c).r;\n  vec4 d = texture2D(colorRamp, vec2(t, .5));\n  gl_FragColor = d * heatmapOpacity;\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,t){return multiply$5(i,t.projViewMatrix,t.modelMatrix)}}],extraCommandProps:r})}}class Zn$4 extends Mn$4{constructor(){super({vert:An$4,frag:"precision highp float;\nuniform sampler2D texture;\nuniform vec2 size;\nuniform float enableSharpen;\nuniform float sharpFactor;\nuniform float pixelRatio;\nvec2 c;\nvec3 d(const in vec3 e, const float f) {\n  vec2 h = pixelRatio / size.xy;\n  float i = .0;\n  vec4 j = texture2D(texture, c + h * vec2(-1., -1.));\n  j.rgb = mix(vec3(.0), j.rgb, sign(j.a));\n  i += mix(.0, 1., sign(j.a));\n  vec4 k = texture2D(texture, c + h * vec2(1.));\n  k.rgb = mix(vec3(.0), k.rgb, sign(k.a));\n  i += mix(.0, 1., sign(k.a));\n  vec4 l = texture2D(texture, c + h * vec2(1., -1.));\n  l.rgb = mix(vec3(.0), l.rgb, sign(l.a));\n  i += mix(.0, 1., sign(l.a));\n  vec4 m = texture2D(texture, c + h * vec2(-1., 1.));\n  m.rgb = mix(vec3(.0), m.rgb, sign(m.a));\n  i += mix(.0, 1., sign(m.a));\n  return e + f * (i * e - j.rgb - l.rgb - m.rgb - k.rgb);\n}\nvoid main() {\n  c = gl_FragCoord.xy / size;\n  vec4 e = texture2D(texture, c);\n  if(enableSharpen == 1.) {\n    e.rgb = d(e.rgb, sharpFactor);\n  }\n  gl_FragColor = e;\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.size[0],height:(e,n)=>n.size[1]}}})}getMeshCommand(e,n){return this.commands.copy||(this.commands.copy=this.createREGLCommand(e,null,n.getElements())),this.commands.copy}}class Qn$4 extends vn$4{constructor(e={}){const t=[],r=e.uniforms,i=[{name:"modelViewMatrix",type:"function",fn:function(e,r){return multiply$5(t,r.viewMatrix,r.modelMatrix)}}];r&&i.push(...r),super({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / outSize.xy;\n  gl_Position = e * modelViewMatrix * d * c;\n}",frag:"precision mediump float;\nuniform vec4 lineColor;\nuniform float lineOpacity;\nvoid main() {\n  gl_FragColor = lineColor;\n  gl_FragColor.a *= lineOpacity;\n}",uniforms:i,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}}const $n$4=[],et$6=[];const tt$6=[];class rt$6{constructor(e,n,t){this._regl=e,this._layer=t,this._viewport=n,this._init()}_init(){this._shader=new vn$4({vert:"attribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec4 vWorldPosition;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  vec4 e = modelMatrix * d * c;\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vWorldPosition = e;\n}",frag:"precision mediump float;\nvarying vec4 vWorldPosition;\nuniform vec2 fogDist;\nuniform vec3 cameraPosition;\nuniform float rainDepth;\nvoid main() {\n  vec3 c = vec3(vWorldPosition[0] - cameraPosition[0], vWorldPosition[1] - cameraPosition[1], vWorldPosition[2] - cameraPosition[2]);\n  float d = length(c);\n  float e = clamp(1. - (d - fogDist.x) / (fogDist.y - fogDist.x), .0, 1.);\n  if(vWorldPosition[2] < rainDepth) {\n    gl_FragColor = vec4(e, .0, .0, 1.);\n  } else {\n    gl_FragColor = vec4(e, 1., .0, 1.);\n  }\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,t){return multiply$5(tt$6,t.viewMatrix,t.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}});const e=this._layer.getRenderer().createFBOInfo();this._fbo=this._regl.framebuffer(e),this._scene=new Ke$5,this.renderer=new B$6(this._regl)}render(e,n){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._scene.setMeshes(e),this.renderer.render(this._shader,{projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,cameraPosition:n.cameraPosition,fogDist:n.fogDist,rainDepth:n.rainDepth},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=h$2(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,n=h$2(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}}class it$5 extends Mn$4{constructor(){super({vert:An$4,frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_RAIN\nuniform sampler2D ripplesMap;\n#endif\n#ifdef HAS_SNOW\nuniform sampler2D normalMap;\n#endif\n#ifdef HAS_FOG\nuniform vec3 fogColor;\n#endif\nuniform sampler2D sceneMap;\nuniform sampler2D mixFactorMap;\nuniform float time;\nuniform vec2 resolution;\nuniform float snowIntensity;\nfloat c(float a, float b, float w) {\n  return a + w * (b - a);\n}\n#define HASHSCALE1 .1031\n#define HASHSCALE3 vec3(.1031, .1030, .0973)\n#define HASHSCALE4 vec3(.1031, .1030, .0973, .1099)\nfloat d = .5;\nfloat e = .2;\nfloat f = .5;\nfloat h = 20.;\nfloat i(float p) {\n  vec3 j = fract(vec3(p) * HASHSCALE1);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.x + j.y) * j.z);\n}\nvec2 k(vec2 p) {\n  vec3 j = fract(vec3(p.xyx) * HASHSCALE3);\n  j += dot(j, j.yzx + 19.19);\n  return fract((j.xx + j.yz) * j.zy);\n}\nvec2 l(vec2 m) {\n  float x = fract(sin(dot(m.xy, vec2(122.9898, 783.233))) * 43758.5453);\n  float y = fract(sin(dot(m.xy, vec2(457.6537, 537.2793))) * 37573.5913);\n  return vec2(x, y);\n}\nvec3 n(vec2 o, float u) {\n  vec3 v = vec3(.0);\n  o = o * (2. + u);\n  float A = e * snowIntensity;\n  float B = o.y * (((i(u) * 2. - 1.) * .5 + 1.) * A);\n  float C = (f * time);\n  o += vec2(B, C);\n  vec2 D = k(floor(o) + 31.1759 * u);\n  o = fract(o);\n  o -= (D * 2. - 1.) * .35;\n  o -= .5;\n  float r = length(o);\n  float E = .05 * (1. + .3 * sin(time * d));\n  float F = smoothstep(E, -E, r);\n  vec3 G = vec3(F) * D.x;\n  return G;\n}\nvec3 H() {\n  vec3 v = vec3(0);\n  vec2 o = gl_FragCoord.xy / resolution.xy;\n  o *= vec2(resolution.x / resolution.y, 1.);\n  float I = h * snowIntensity;\n  for(float J = 0.; J < I; J++) {\n    v += n(o, J);\n  }\n  return v;\n}\nvec3 K(vec4 L, vec4 M, float N) {\n  float O = M.b;\n  vec3 P = vec3(1.);\n  if(N < 1.) {\n    float r = c(.5, P.x, O);\n    float g = c(.5, P.y, O);\n    float b = c(.5, P.z, O);\n    return vec3(r, g, b);\n  } else {\n    float r = c(L.r, P.x, O);\n    float g = c(L.g, P.y, O);\n    float b = c(L.b, P.z, O);\n    return vec3(r, g, b);\n  }\n}\nvoid main() {\n  vec4 L = texture2D(sceneMap, vTexCoord);\n  glFragColor = L;\n  vec4 Q = texture2D(mixFactorMap, vTexCoord);\n#ifdef HAS_RAIN\nvec4 R = texture2D(ripplesMap, vTexCoord);\n  if(Q.g < 1.) {\n    L = mix(L, R, .4);\n  }\n  glFragColor = L;\n#endif\n#ifdef HAS_SNOW\nvec3 S = H();\n  glFragColor = vec4(L.rgb + S, L.a);\n#endif\n#ifdef HAS_FOG\nfloat T = Q.r;\n  vec3 U = mix(fogColor, glFragColor.rgb, T);\n  glFragColor = vec4(U, L.a);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}})}}const ot$6=[],at$6=[.03,.03,.03],st$6=[],ct$6=[],lt$6=[],ft$6=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class dt$6{constructor(e,n){this._regl=e,this._viewport=n,this._init()}_init(){this._shader=new vn$4({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nvarying vec2 vTexCoord;\n#include <get_output>\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_Position = projMatrix * modelViewMatrix * d * c;\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\nuniform float rippleRadius;\nuniform float density;\nuniform float time;\nvec3 c(vec2 p) {\n  vec3 q = vec3(dot(p, vec2(127.1, 311.7)), dot(p, vec2(269.5, 183.3)), dot(p, vec2(419.2, 371.9)));\n  return fract(sin(q) * 43758.5453);\n}\nfloat d(in vec2 x) {\n  vec2 e = x * density / 4000.0;\n  vec2 p = floor(e);\n  vec2 f = fract(e);\n  float h = .0;\n  for(int i = -4; i <= 4; i++)\n    for(int k = -4; k <= 4; k++) {\n      vec2 g = vec2(float(k), float(i));\n      vec3 l = c(p + g);\n      vec2 r = g - f + l.xy;\n      float m = sqrt(dot(r, r));\n      float n = max(mix(smoothstep(.99, .999, max(cos(m - time * 2. + (l.x + l.y) * 5.), 0.)), 0., m), 0.);\n      h += n;\n    }\n  return h;\n}\nvoid main() {\n  vec2 u = vTexCoord;\n  float A = 24. / (rippleRadius * .01);\n  float f = d(A * u) * smoothstep(.0, .4, sin(u.x * 3.151592) * sin(u.y * 3.141592));\n  vec3 B = vec3(-dFdx(f), -dFdy(f), -dFdy(f));\n  glFragColor = vec4(B, 1.);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,t){return multiply$5(ot$6,t.viewMatrix,t.modelMatrix)}}],extraCommandProps:{viewport:this._viewport}}),this._shader.version=300,this._fbo=this._regl.framebuffer({color:this._regl.texture({width:this._viewport.width(),height:this._viewport.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._scene=new Ke$5,this.renderer=new B$6(this._regl)}_transformRipples(e){const r=e.coordinateToPointAtRes(e.getCenter(),e.getGLRes()),i=e.getGLScale()/e.getGLScale(this._fixZoom),o=set$4(ct$6,i,i,i),s=multiply$4(o,at$6,o),c=identity$2(lt$6);fromRotationTranslationScale(c,fromEuler(st$6,0,0,0),[r.x,r.y,0],s),multiply$5(c,c,ft$6),this._mesh.setLocalTransform(c)}_createRipplesMask(e){this._fixZoom=e.getZoom();const n=800*Math.pow(2,16.685648411389433-this._fixZoom),t={};t.POSITION=[-n,0,-n,n,0,-n,-n,0,n,n,0,n],t.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],t.TEXCOORD_0=[0,0,1,0,0,1,1,1];const r=new Q$7(t,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});r.generateBuffers(this._regl);const i=new Ce$5;return new Be$5(r,i)}render(e,n){return this._resize(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this._fbo}),this._mesh=this._mesh||this._createRipplesMask(e),this._scene.setMeshes(this._mesh),this._transformRipples(e),this.renderer.render(this._shader,{projMatrix:n.projMatrix,viewMatrix:n.viewMatrix,time:n.time,rippleRadius:n.rippleRadius,density:n.density},this._scene,this._fbo),this._fbo}dispose(){this._fbo&&this._fbo.destroy(),this._shader&&this._shader.dispose()}_resize(){const e=h$2(this._viewport.width.data)?this._viewport.width.data():this._viewport.width,n=h$2(this._viewport.height.data)?this._viewport.height.data():this._viewport.height;!this._fbo||this._fbo.width===e&&this._fbo.height===n||this._fbo.resize(e,n)}}var ut$6="attribute vec3 aPosition;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\n#ifdef HAS_VIDEO\nattribute vec2 aTexCoord;\nvarying vec2 uv;\n#endif\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = c * getPosition(aPosition);\n  gl_Position = projViewModelMatrix * d;\n#ifdef HAS_VIDEO\nuv = aTexCoord;\n#endif\n}";const ht$6=[0,0,0,1];class mt$6{constructor(e,n){this.regl=e,this._viewport=n,this.renderer=new B$6(e),this._init()}_init(){this._maskColorFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this._maskModeFbo=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0});const e=[{name:"projViewModelMatrix",type:"function",fn:(e,t)=>multiply$5([],t.projViewMatrix,t.modelMatrix)}];this._maskColorShader=new vn$4({vert:ut$6,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform vec4 maskColor;\n#ifdef HAS_VIDEO\nuniform sampler2D maskTexture;\nvarying vec2 uv;\n#endif\nvoid main() {\n  \n#ifdef HAS_VIDEO\ngl_FragColor = texture2D(maskTexture, uv);\n  gl_FragColor.a = maskColor.a;\n#else\ngl_FragColor = maskColor;\n#endif\n}",uniforms:e,extraCommandProps:{viewport:this._viewport}}),this._maskModeShader=new vn$4({vert:ut$6,frag:"#ifdef GL_ES\nprecision highp float;\n#endif\nuniform float maskMode;\n#ifdef HAS_MASK_FLAT\nuniform float flatHeight;\n#endif\n#ifdef HAS_MASK_COLOR\nuniform vec2 heightRange;\n#endif\nvoid main() {\n  \n#if defined(HAS_MASK_FLAT)\ngl_FragColor = vec4(maskMode, flatHeight, .0, 1.);\n#elif defined(HAS_MASK_COLOR)\ngl_FragColor = vec4(maskMode, .0, heightRange.x, heightRange.y);\n#else\ngl_FragColor = vec4(maskMode, .0, .0, .0);\n#endif\n}",uniforms:e,extraCommandProps:{viewport:this._viewport}}),this._scene=new Ke$5}render(e,n){this._resize(),this.renderer.clear({color:ht$6,depth:1,framebuffer:this._maskColorFbo}),this.renderer.clear({color:ht$6,depth:1,framebuffer:this._maskModeFbo}),this._scene.setMeshes(e);const t={projViewMatrix:n};return this.renderer.render(this._maskColorShader,t,this._scene,this._maskColorFbo),this.renderer.render(this._maskModeShader,t,this._scene,this._maskModeFbo),{colorExtent:this._maskColorFbo,modeExtent:this._maskModeFbo}}_resize(){const e=h$2(this._viewport.width)?this._viewport.width():this._viewport.width.data(),n=h$2(this._viewport.height)?this._viewport.height():this._viewport.height.data();!this._maskColorFbo||this._maskColorFbo.width===e&&this._maskColorFbo.height===n||(this._maskColorFbo.resize(e,n),this._maskModeFbo.resize(e,n))}dispose(){this._maskColorFbo&&(this._maskColorFbo.destroy(),delete this._maskColorFbo),this._maskModeFbo&&(this._maskModeFbo.destroy(),delete this._maskModeFbo),this._maskColorShader&&(this._maskColorShader.dispose(),delete this._maskColorShader),this._maskModeShader&&(this._maskModeShader.dispose(),delete this._maskModeShader)}}const vt$6=[],_t$6={width:4,type:"float"};class gt$6{constructor(e,n,t){this._regl=e,this.joints=n,this.inverseBindMatrices=[],this.jointMatrices=[],this.jointData=new Float32Array(16*n.length);for(let e=0;e<n.length;++e)this.inverseBindMatrices.push(new Float32Array(t.buffer,t.byteOffset+16*Float32Array.BYTES_PER_ELEMENT*e,16)),this.jointMatrices.push(new Float32Array(this.jointData.buffer,16*Float32Array.BYTES_PER_ELEMENT*e,16));this.jointTextureSize=[4,6]}update(e,t,r){invert$2(vt$6,e);for(let e=0;e<this.joints.length;++e){const r=this.jointMatrices[e];multiply$5(r,vt$6,t[this.joints[e].nodeIndex]),multiply$5(r,r,this.inverseBindMatrices[e])}_t$6.height=this.joints.length,_t$6.data=this.jointData;const i=_t$6;return r?r(i):r=this._regl.texture(i),r}}const xt$6=[0,0,0],bt$6=[0,0,0,1],pt$6=[1,1,1],yt$6=[];class At$6{constructor(e=[0,0,0],n=[0,0,0,1],t=[1,1,1]){this.translation=e,this.rotation=n,this.scale=t}getMatrix(){return fromRotationTranslationScale(yt$6,this.rotation,this.translation,this.scale)}decompose(e){getTranslation$1(this.translation,e),getRotation(this.rotation,e),getScaling(this.scale,e)}update(e){e&&(e.translation&&!equals$5(e.translation,xt$6)&&copy$4(this.translation,e.translation),e.rotation&&!equals$3(e.rotation,bt$6)&&copy$2(this.rotation,e.rotation),e.scale&&!equals$5(e.scale,pt$6)&&copy$4(this.scale,e.scale))}}class St$6{constructor(e){this._init(e)}_init(e){this.bbox=e.bbox,this.geometry=e.geometry,this.nodeMatrix=e.nodeMatrix,this.materialInfo=e.materialInfo,this.extraInfo=e.extraInfo,this.animationMatrix=e.animationMatrix,this.morphWeights=e.morphWeights,this.skin=e.skin,this.nodeIndex=e.nodeIndex}copyEdgeGeometry(){this.copyGeometry||(this.copyGeometry=this._copyEdgeGeometry(this.geometry))}createCopyBarycentric(){this.copyGeometry&&!this.copyGeometry.data.aBarycentric&&(this.copyGeometry.buildUniqueVertex(),this.copyGeometry.createBarycentric("aBarycentric"))}_copyEdgeGeometry(e){const n=e.data,t=e.indices||e.elements,r={};for(const t in n)if(t===e.desc.positionAttribute)if(b$5(n[t]))r[t]=n[t].slice();else if(n[t].buffer&&n[t].buffer.destroy)r[t]={buffer:n[t].buffer},b$5(n[t].array)&&(r[t].array=n[t].array.slice());else{const n=e._getAttributeData(t);r[t]=t!==e.desc.positionAttribute?n:n.slice()}const i=void 0!==t.length?t.slice():t,o=JSON.parse(JSON.stringify(e.desc)),a=new Te$5(r,i,0,o);return a.properties=e.properties,a}}let Tt$6=0;const Mt$6=[];class Ct$6{constructor(e,n){this.gltf=e,this.regl=n,this.geometries=[],n&&(this._emptyTexture=n.texture({width:2,height:2}))}getMeshesInfo(){return this.gltf?(this.geometries.length||(this._createTextures(this.gltf.textures),this._createSkins(this.gltf.skins),this.gltf.scenes[0].nodes.forEach((e=>{this._parserNode(e,this.geometries)})),this._checkBaseColorFactor()),this.geometries):null}getGLTFBBox(){if(!this.gltf)return null;const e=this.geometries;if(!e||!e.length)return null;const n=[1/0,1/0,1/0],t=[-1/0,-1/0,-1/0];for(let r=0;r<e.length;r++){const i=e[r].bbox,o=i.min,a=i.max;o[0]<n[0]&&(n[0]=o[0]),o[1]<n[1]&&(n[1]=o[1]),o[2]<n[2]&&(n[2]=o[2]),a[0]>t[0]&&(t[0]=a[0]),a[1]>t[1]&&(t[1]=a[1]),a[2]>t[2]&&(t[2]=a[2])}return{min:n,max:t}}_createSkins(e){if(e){this._skinMap={};for(let n=0;n<e.length;n++){const t=e[n];t.joints=t.joints.map((e=>this.gltf.nodes[e])),this._skinMap[n]=new gt$6(this.regl,t.joints,t.inverseBindMatrices.array),delete t.inverseBindMatrices}}}_createTextures(e){if(e){this._textureMap={};for(let n=0;n<e.length;n++){const t=e[n];this._textureMap[n]||(this._textureMap[n]=this._toTexture(t),delete t.image)}}}_checkBaseColorFactor(){if(!this._checkBaseColorFactorAlpha())for(let e=0;e<this.geometries.length;e++){const n=this.geometries[e].materialInfo.baseColorFactor;n&&0===n[3]&&(n[3]=1)}}_checkBaseColorFactorAlpha(){for(let e=0;e<this.geometries.length;e++){const n=this.geometries[e].materialInfo.baseColorFactor;if(n&&n[3]>0)return!0}return!1}dispose(){this._emptyTexture&&this._emptyTexture.destroy();const e=this.getMeshesInfo();if(e){e.forEach((e=>{e.geometry.dispose();for(const n in e.materialInfo){const t=e.materialInfo[n];t.destroy&&!t[H$6]&&t.destroy()}}));for(const e in this._textureMap){const n=this._textureMap[e];n.destroy&&!n[H$6]&&n.destroy()}delete this.gltf}}updateAnimation(n,t,r,i,o,a,s,c){const l=this.gltf;if(!l)return;if(Tt$6=l.animations?X$8.getAnimationTimeSpan(l,i):null,!Tt$6)return;n-=o;let f=0;f=t||!t&&this._isFirstLoop(n,r,i,o)?n*r*.001%(Tt$6.max-Tt$6.min)+Tt$6.min:n*r*.001+Tt$6.min,l.scenes[0].nodes.forEach((e=>{this._updateNodeMatrix(i,f,e,null,a,c)}));for(const e in this.gltf.nodes){const n=this.gltf.nodes[e],t=a[n.nodeIndex];if(n.skin&&t){const e=n.skin.update(t,a,s[n.nodeIndex]&&s[n.nodeIndex].jointTexture);s[n.nodeIndex]||(s[n.nodeIndex]={jointTextureSize:n.skin.jointTextureSize,numJoints:n.skin.joints.length}),s[n.nodeIndex].jointTexture=e}}}_isFirstLoop(n,t,r,i){const o=this.gltf;return!i||!o||(Tt$6=o.animations?X$8.getAnimationTimeSpan(o,r):null,n*t*.001/(Tt$6.max-Tt$6.min)<1)}hasSkinAnimation(){return!!this._isAnimation}_updateNodeMatrix(e,t,r,i,o,a){r.trs&&(a?a.indexOf(Number(r.nodeIndex))>-1&&this._updateNodeTRS(r,t,e):this._updateNodeTRS(r,t,e)),o[r.nodeIndex]=i?multiply$5(o[r.nodeIndex]||[],i,r.matrix||r.trs.getMatrix()):copy$5(o[r.nodeIndex]||[],r.matrix||r.trs.getMatrix()),r.children&&r.children.forEach((n=>{this._updateNodeMatrix(e,t,n,o[r.nodeIndex],o,a)}))}_updateNodeTRS(n,t,r){const i=X$8.getAnimationClip(this.gltf,Number(n.nodeIndex),t,r);i.weights&&this._updateMorph(n,i.weights),n.trs.update(i)}_updateMorph(e,n){const t=n.length;if(!e.influencesList){e.influencesList=[];for(let n=0;n<t;n++)e.influencesList[n]=[n,0]}const r=e.influencesList;for(let e=0;e<r.length;e++){const t=r[e];t[0]=e,t[1]=n[e]}r.sort(Et$6);const i=[];for(let e=0;e<8;e++)i[e]=[e,0];for(let e=0;e<8;e++)e<t&&r[e][1]?(i[e][0]=r[e][0],i[e][1]=r[e][1]):(i[e][0]=Number.MAX_SAFE_INTEGER,i[e][1]=0);i.sort(Ot$6),e.geometries.forEach((e=>{const n=e.properties.morphTargets;for(let t=0;t<8;t++){const r=i[t],o=r[0],a=r[1];o!==Number.MAX_SAFE_INTEGER&&a?(e.updateData("POSITION"+t,n["POSITION_"+o].array),e.properties.morphWeights[t]=a):e.properties.morphWeights[t]=0}}))}_parserNode(e,t,r){if(e.isParsed)return;e.nodeMatrix=e.nodeMatrix||identity$2([]),e.localMatrix=e.localMatrix||identity$2([]),e.matrix?(e.trs=new At$6,e.trs.decompose(e.matrix)):e.trs=new At$6(e.translation,e.rotation,e.scale),e.localMatrix=e.trs.getMatrix(),r?multiply$5(e.nodeMatrix,r,e.matrix||e.localMatrix):copy$5(e.nodeMatrix,e.matrix||e.localMatrix);const i=e.nodeMatrix;if(e.children)for(let n=0;n<e.children.length;n++)this._parserNode(e.children[n],t,i);if(u$3(e.skin)){this._isAnimation=!0;const n=e.skin;e.trs=new At$6,e.skin=this._skinMap[n]}u$3(e.mesh)&&(e.mesh=this.gltf.meshes[e.mesh],e.mesh.node=e,e.geometries=e.geometries||[],e.mesh.primitives.forEach((r=>{const o=this._createMaterialInfo(r.material),a=function(e,n,t){const r=e.attributes,i=r.COLOR_0;if(i&&i.array instanceof Float32Array){const e=new Uint8Array(i.array.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*i.array[n]);i.array=e}else if(i&&(i.array instanceof Uint16Array||i.array instanceof Int16Array||i.array instanceof Uint32Array||i.array instanceof Int32Array)){const e=new Uint8Array(i.array);i.array=e}t&&r.TEXCOORD_0&&!r.TEXCOORD_0&&(r.TEXCOORD_1=r.TEXCOORD_0);const o={};for(const e in r)o[e]=v$3({},r[e]),n&&(o[e].buffer=me$5(n,r[e],{dimension:r[e].itemSize}));if(e.morphTargets){const e=P$5(o.POSITION)?o.POSITION.itemSize*o.POSITION.count:o.POSITION.array.length;for(let n=0;n<8;n++)o["POSITION"+n]||(o["POSITION"+n]=new Float32Array(e).fill(0));for(let e=0;e<4;e++){const n=o.NORMAL.array?o.NORMAL.array.length:o.NORMAL.length;o["NORMAL"+e]||(o["NORMAL"+e]=new Float32Array(n).fill(0))}}let a=e.indices;a&&void 0===a.bufferView&&a.array&&(a=a.array);const s=new Q$7(o,a,0,{primitive:g$1(e.mode)?ne$5(e.mode):e.mode,positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",color0Attribute:"COLOR_0"});return e.morphTargets&&(s.properties.morphWeights=[]),e.mode>3&&!s.data.NORMAL&&s.createNormal("NORMAL"),s}(r,this.regl,o.occlusionTexture);a.properties.morphTargets=r.morphTargets,e.geometries.push(a);let s=a.boundingBox.copy();s=s.transform(identity$2(Mt$6),i);const c={geometry:a,bbox:s,nodeMatrix:i,materialInfo:o,extraInfo:this._createExtralInfo(r.material),animationMatrix:e.trs.getMatrix(),morphWeights:e.weights,nodeIndex:e.nodeIndex};e.skin&&(c.skin={jointTextureSize:[4,6],numJoints:e.skin.joints.length,jointTexture:e.skin.jointTexture});const l=new St$6(c);t.push(l)}))),e.isParsed=!0}_createMaterialInfo(e){const n={};if(this.gltf.materials&&this.gltf.materials[e]){const t=this.gltf.materials[e],r=t.pbrMetallicRoughness;if(r){const e=r.metallicRoughnessTexture,t=r.baseColorTexture;t&&(n.baseColorTexture=this._getTexture(t),t.KHR_texture_transform&&(n.khr_offset=t.KHR_texture_transform.offset||[0,0],n.khr_rotation=t.KHR_texture_transform.rotation||0,n.khr_scale=t.KHR_texture_transform.scale||[1,1])),r.baseColorFactor&&(n.baseColorFactor=r.baseColorFactor),e?n.metallicRoughnessTexture=this._getTexture(e):(n.metallicFactor=u$3(r.metallicFactor)?r.metallicFactor:1,n.roughnessFactor=u$3(r.roughnessFactor)?r.roughnessFactor:1)}const i=t.extensions;if(i&&i.KHR_materials_pbrSpecularGlossiness){const e=i.KHR_materials_pbrSpecularGlossiness;n.name="pbrSpecularGlossiness";for(const t in e)n[t]=u$3(e[t].index)?this._getTexture(e[t]):e[t]}t.normalTexture&&(n.normalTexture=this._getTexture(t.normalTexture)),t.occlusionTexture&&(n.occlusionTexture=this._getTexture(t.occlusionTexture)),t.emissiveTexture&&(n.emissiveTexture=this._getTexture(t.emissiveTexture)),t.emissiveFactor&&(n.emissiveFactor=t.emissiveFactor),n.alphaCutoff=t.alphaCutoff||.5}return n}_createExtralInfo(e){const n={};if(this.gltf.materials&&this.gltf.materials[e]){const t=this.gltf.materials[e];n.doubleSided=t.doubleSided,n.alphaMode=t.alphaMode||"OPAQUE"}return n}_getTexture(e){const n=e.extensions,t=e.index;if(!u$3(t))return null;n&&n.KHR_texture_transform&&(e.KHR_texture_transform=n.KHR_texture_transform);const r=this._textureMap[t];return r.texInfo=e,r}_toTexture(e){if(!e)return this._emptyTexture;const n=e.sampler||{};return new en$5({width:e.image.width,height:e.image.height,data:e.image.array,mag:se$5(n.magFilter)||"linear",min:le$5(n.minFilter)||"linear",wrapS:de$5(n.wrapS)||"repeat",wrapT:de$5(n.wrapT)||"repeat"})}}function Ot$6(e,n){return e[0]-n[0]}function Et$6(e,n){return Math.abs(n[1])-Math.abs(e[1])}function Pt$6(n){const t=n.lastIndexOf("/"),r=n.slice(0,t),i=n.slice(n.lastIndexOf(".")).toLowerCase();return".gltf"===i?function(n,t){return w$5.getJSON(n,{})}(n).then((e=>wt$6(r,e))):".glb"===i?function(n,t){return w$5.getArrayBuffer(n,{})}(n).then((e=>wt$6(r,{buffer:e.data,byteOffset:0}))):null}function It$6(e,n){return new Ct$6(e,n)}function wt$6(n,t){return new X$8(n,t).load()}var Dt$6=Object.freeze({__proto__:null,load:Pt$6,exportGLTFPack:It$6,loadGLTF:wt$6});const Rt$6=[-1,0,-1,1,0,-1,-1,0,1,1,0,1],Ft$6=[3,1,0,0,2,3],Ht$5=[0,0,1,0,0,1,1,1],Lt$6={vertices:[-.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,.010300000198185444,-0,.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,.010300000198185444,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,-.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,-.8111000061035156,-.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0,-.8111000061035156,2.0102999210357666,.8111000061035156,.8111000061035156,2.0102999210357666,.8111000061035156,0,2.9419000148773193,-0],normals:[-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,-.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,0,-.3758002817630768,.9267006516456604,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,.9267006516456604,-.3758002817630768,-0,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,-.3758002817630768,-.9267006516456604,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,0,.656676173210144,-.7541726231575012,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,-.7541726231575012,.656676173210144,-0,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012,0,.656676173210144,.7541726231575012],indices:[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23]},zt$5=["cube","plane","pyramid"],kt$6={cube:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1])},NORMAL:{array:new Int8Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1])},TEXCOORD_0:{array:new Int8Array([0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1,0,0,1,0,0,1,1,1])}},indices:new Uint16Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},"plane-cube":{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(Rt$6)},TEXCOORD_0:{array:new Int8Array(Ht$5)}},indices:new Uint16Array(Ft$6),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60],translation:[0,-60,0]},{mesh:0,scale:[60,60,60],translation:[0,60,0]},{mesh:0,scale:[60,60,60],translation:[60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[-60,0,0],rotation:[0,0,.7071067811865475,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,60],rotation:[.7071067811865475,0,0,.7071067811865476]},{mesh:0,scale:[60,60,60],translation:[0,0,-60],rotation:[.7071067811865475,0,0,.7071067811865476]}]}]},plane:{meshes:[{primitives:[{attributes:{POSITION:{array:new Int8Array(Rt$6)},NORMAL:{array:new Int8Array([0,1,0,0,1,0,0,1,0,0,1,0])},TEXCOORD_0:{array:new Int8Array(Ht$5)}},indices:new Uint16Array(Ft$6),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]},pyramid:{meshes:[{primitives:[{attributes:{POSITION:{array:new Float32Array(Lt$6.vertices)},NORMAL:{array:new Float32Array(Lt$6.normals)},TEXCOORD_0:{array:new Float32Array(Lt$6.uv)}},indices:new Uint16Array(Lt$6.indices),mode:4}]}],scenes:[{nodes:[{mesh:0,scale:[60,60,60]}]}]}};class Bt$6{constructor(e){this.regl=e,this.resourceMap={}}getGLTF(e){return this.resourceMap[e]}loginGLTF(e,n){if(this.resourceMap[e])this.resourceMap[e].refCount+=1;else{if(kt$6[e]){const n=function(e){let n=null;return kt$6[e]&&(n={meshes:kt$6[e].meshes},n.scenes=JSON.parse(JSON.stringify(kt$6[e].scenes))),n}(e);this.resourceMap[e]=this._exportGLTFResource(n,e,!1)}else this.resourceMap[e]=n?n(e).then((n=>{const t=this._exportGLTFResource(n,e);return this.resourceMap[e]=t,t})):this._loadGLTFModel(e);this.resourceMap[e].refCount=1}}logoutGLTF(e){if(this.resourceMap[e]&&(this.resourceMap[e].refCount-=1,this.resourceMap[e].refCount<1)){const n=this.resourceMap[e].resources;if(n)for(let e=0;e<n.length;e++)n[e].geometry.dispose(),n[e].copyGeometry&&n[e].copyGeometry.dispose(),n[e].material&&n[e].material.dispose();this.resourceMap[e].gltfPack&&this.resourceMap[e].gltfPack.dispose(),delete this.resourceMap[e]}}isSimpleModel(e){return kt$6[e]}addSimpleModel(e,n){!function(e,n){"string"==typeof e&&zt$5.indexOf(e)<0&&(kt$6[e]=n)}(e,n)}removeSimpleModel(e){delete kt$6[e]}_exportGLTFResource(e,n,t=!0){if(!e)return null;const r=It$6(e,t?this.regl:null),i=r.getMeshesInfo();return{bbox:r.getGLTFBBox(),gltfPack:r,resources:i,json:e.json,refCount:this.resourceMap[n]?this.resourceMap[n].refCount:0}}_loadData(e){return Pt$6(e).then((e=>e))}_loadGLTFModel(e){return this._loadData(e).then((n=>(this.resourceMap[e]=this._exportGLTFResource(n,e),this.resourceMap[e])))}}const Gt$5=function(){const e=[0,0,0],t=90*Math.PI/180,r=[0,0,0,0],i=new Array(16);return function(o,a,s,c,l,f){const d=[lookAt([],e,[1,0,0],f&&f[0]||[0,-1,0]),lookAt([],e,[-1,0,0],f&&f[1]||[0,-1,0]),lookAt([],e,[0,1,0],f&&f[2]||[0,0,1]),lookAt([],e,[0,-1,0],f&&f[3]||[0,0,-1]),lookAt([],e,[0,0,1],f&&f[4]||[0,-1,0]),lookAt([],e,[0,0,-1],f&&f[5]||[0,-1,0])],u={context:{viewMatrix:function(e,n,t){return d[t]},projMatrix:perspective(i,t,1,.5,1.1)}};return a&&(u.framebuffer=a.faces?function(e,n,t){return a.faces[t]}:a),o(u)(6,((e,n,t)=>{const i={color:r,depth:1};a&&(i.framebuffer=a.faces?a.faces[t]:a),o.clear(i),s(c),l&&l()})),a}}();var Ut$5={vertices:[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],textures:[1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1,0,0,1,0],indices:[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]},Vt$5="#define SHADER_NAME CUBE_MAP\nattribute vec3 aPosition;\nvarying vec3 vWorldPos;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nvoid main() {\n  vWorldPos = aPosition;\n  gl_Position = projMatrix * viewMatrix * vec4(vWorldPos, 1.);\n}",jt$5="precision highp float;\n#define PI 3.1415926\nvarying vec3 vWorldPos;\nuniform sampler2D equirectangularMap;\nconst vec2 c = vec2(.1591, .3183);\nvec2 d(vec3 e) {\n  vec2 f = vec2(atan(e.y, e.x), asin(e.z));\n  f *= c;\n  f += .5;\n  return f;\n}\nvec3 h(const in vec4 i, const in float j) {\n  return j * i.rgb * i.a;\n}\nvec4 k(const in vec3 i, const in float j) {\n  vec4 l;\n  vec3 m = i / j;\n  l.a = clamp(max(max(m.r, m.g), max(m.b, 1e-6)), .0, 1.);\n  l.a = ceil(l.a * 255.) / 255.;\n  l.rgb = m / l.a;\n  return l;\n}\nvoid main() {\n  vec2 f = d(normalize(vWorldPos));\n  vec4 i = texture2D(equirectangularMap, f);\n#ifdef INPUT_RGBM\ngl_FragColor = i;\n#else\ngl_FragColor = vec4(h(i, 7.), 1.);\n#endif\n}";
/*!
	 * from claygl
	 * https://github.com/pissang/claygl/
	 * License: BSD-2-Clause
	 */function Xt$5(e,n){const t=e[0],r=e[1],i=e[2];return 0===n?1:1===n?t:2===n?r:3===n?i:4===n?t*i:5===n?r*i:6===n?t*r:7===n?3*i*i-1:t*t-r*r}const Wt$5={px:[2,1,0,-1,-1,1],nx:[2,1,0,1,-1,-1],py:[0,2,1,1,-1,-1],ny:[0,2,1,1,1,1],pz:[0,1,2,-1,-1,-1],nz:[0,1,2,1,-1,1]},Kt$5=["px","nx","py","ny","pz","nz"],qt$5=on$5.compile(Kn$4);function Yt$5(e,n,t){const r=e({frag:qt$5,vert:Vt$5,attributes:{aPosition:Ut$5.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:n,environmentExposure:1,bias:0,size:t,hsv:[0,0,0]},elements:Ut$5.indices}),i=[],o=e.framebuffer(t);return Gt$5(e,o,r,{size:t},(function(){const n=e.read();i.push(new n.constructor(n))})),r.destroy(),o.destroy(),i}const Jt$5=new Int8Array([-1,1,0,-1,-1,0,1,1,0,1,-1,0]),Zt$5=new Int8Array([0,1,0,0,1,1,1,0]);function Qt$5(e,n,t,r){n=n||256;const i=$t$5(t=t||1024,r=r||256),o=e.texture({data:i,width:r,height:t,min:"nearest",mag:"nearest"}),a=e.buffer(Jt$5),s=e.buffer(Zt$5),c=e.framebuffer({radius:n,colorType:"uint8",colorFormat:"rgba",min:"linear",mag:"linear"}),l=e({frag:"precision highp float;\nvarying vec2 vTexCoords;\nuniform sampler2D distributionMap;\nconst float c = 3.14159265359;\nvec4 d(float a, float b) {\n  a *= 65535.;\n  b *= 65535.;\n  vec4 rgba;\n  rgba[0] = mod(a, 255.);\n  rgba[1] = (a - rgba[0]) / 65280.0;\n  rgba[2] = mod(b, 255.);\n  rgba[3] = (b - rgba[2]) / 65280.0;\n  return rgba;\n}\nvec3 e(float f, vec3 h, float i) {\n  vec4 j = texture2D(distributionMap, vec2(i, f));\n  vec3 k = j.xyz;\n  float l = sign(j.w - .5);\n  float m = sign(j.w - clamp(l, .0, 1.) * 200.0 / 255. - .15);\n  k.x *= l;\n  k.y *= m;\n  vec3 n = abs(h.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 o = normalize(cross(n, h));\n  vec3 u = cross(h, o);\n  vec3 v = o * k.x + u * k.y + h * k.z;\n  return normalize(v);\n}\nfloat A(float B, float i) {\n  float a = i;\n  float C = (a * a) / 2.;\n  float D = B;\n  float E = B * (1. - C) + C;\n  return D / E;\n}\nfloat F(float B, float G, float i) {\n  float I = A(B, i);\n  float J = A(G, i);\n  return J * I;\n}\nvec2 K(float B, float i) {\n  vec3 L;\n  L.x = sqrt(1. - B * B);\n  L.y = .0;\n  L.z = B;\n  float M = .0;\n  float O = .0;\n  vec3 h = vec3(.0, .0, 1.);\n  const int P = 1024;\n  for(int Q = 0; Q < P; ++Q) {\n    vec3 k = e(float(Q) / float(P), h, i);\n    vec3 R = normalize(2. * dot(L, k) * k - L);\n    float G = max(R.z, .0);\n    float S = max(k.z, .0);\n    float T = max(dot(L, k), .0);\n    float B = max(dot(h, L), .0);\n    if(G > .0) {\n      float U = F(B, G, i);\n      float W = (U * T) / (S * B);\n      float X = pow(1. - T, 5.);\n      M += (1. - X) * W;\n      O += X * W;\n    }\n  }\n  M /= float(P);\n  O /= float(P);\n  return vec2(M, O);\n}\nvoid main() {\n  vec2 Y = K(vTexCoords.x, vTexCoords.y);\n  gl_FragColor = d(Y.x, Y.y);\n}",vert:"attribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoords;\nvoid main() {\n  vTexCoords = aTexCoord;\n  gl_Position = vec4(aPosition, 1.);\n}",attributes:{aPosition:{buffer:a},aTexCoord:{buffer:s}},uniforms:{distributionMap:o},framebuffer:c,viewport:{x:0,y:0,width:n,height:n},count:Jt$5.length/3,primitive:"triangle strip"});return l(),l.destroy(),a.destroy(),s.destroy(),o.destroy(),c}function $t$5(e,n){const t=new Array(e*n*4);for(let r=0;r<e;r++){const{x:i,y:o}=er$4(r,e);for(let e=0;e<n;e++){const a=e/n,s=a*a,c=2*Math.PI*i,l=Math.sqrt((1-o)/(1+(s*s-1)*o)),f=Math.sqrt(1-l*l),d=4*(r*n+e),u=f*Math.cos(c),h=f*Math.sin(c);t[d]=Math.abs(255*u),t[d+1]=Math.abs(255*h),t[d+2]=255*l,t[d+3]=(u>0?200:0)+(h>0?55:0)}}return t}function er$4(e,n){let t=(e<<16|e>>>16)>>>0;return t=((1431655765&t)<<1|(2863311530&t)>>>1)>>>0,t=((858993459&t)<<2|(3435973836&t)>>>2)>>>0,t=((252645135&t)<<4|(4042322160&t)>>>4)>>>0,t=(((16711935&t)<<8|(4278255360&t)>>>8)>>>0)/4294967296,{x:e/n,y:t}}var nr$4=Object.freeze({__proto__:null,createIBLMaps:function(e,n={}){const r=n.envTexture,i=n.envCubeSize||512,o=n.sampleSize||1024,a=n.roughnessLevels||256,s=n.prefilterCubeSize||256;let c;if(Array.isArray(r)){const t=e.cube({flipY:!0,faces:r});c=function(e,n,t,r,i){const o=e({frag:"#define ENC_RGBM 1\n"+qt$5,vert:Vt$5,attributes:{aPosition:Ut$5.vertices},uniforms:{hsv:[0,0,0],projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),cubeMap:n,bias:0,size:n.width,environmentExposure:1,rgbmRange:i},elements:Ut$5.indices}),a=e.cube({width:t,height:t,min:"linear",mag:"linear",format:"rgba"}),s=e.framebufferCube({radius:t,color:a});return Gt$5(e,s,o,{size:t},null,[[0,0,-1],[0,0,-1],[0,0,1],[0,0,1],[0,-1,0],[0,-1,0]]),o.destroy(),s}(e,t,i,0,n.rgbmRange),t.destroy()}else c=function(e,n,t,r){t=t||512;const i=e({frag:"#define INPUT_RGBM 1\n"+jt$5,vert:Vt$5,attributes:{aPosition:Ut$5.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),equirectangularMap:n},elements:Ut$5.indices}),o=e.cube({width:t,height:t,min:"linear",mag:"linear",format:"rgba"}),a=e.framebufferCube({radius:t,color:o});return Gt$5(e,a,i),i.destroy(),a}(e,r,i);const{prefilterMap:l,prefilterMipmap:f}=function(e,n,t,r,i,o){const a=function(e,n,t,r,i,o){const a=$t$5(i=i||1024,o=o||256),s=e.texture({data:a,width:o,height:i,min:"nearest",mag:"nearest"}),c=e({frag:"#define SHADER_NAME PBR_prefilter\nprecision highp float;\nvarying vec3 vWorldPos;\nuniform samplerCube environmentMap;\nuniform sampler2D distributionMap;\nuniform float roughness;\nuniform float resolution;\nuniform float rgbmRange;\nconst float c = 3.14159265359;\nfloat d(vec3 e, vec3 f, float h) {\n  float a = h * h;\n  float i = a * a;\n  float j = max(dot(e, f), .0);\n  float k = j * j;\n  float l = i;\n  float m = (k * (i - 1.) + 1.);\n  m = c * m * m;\n  return l / m;\n}\nvec3 n(float o, vec3 e, float h) {\n  vec4 u = texture2D(distributionMap, vec2(h, o));\n  vec3 f = u.xyz;\n  float v = sign(u.w - .5);\n  float A = sign(u.w - 200.0 / 255. * clamp(v, .0, 1.) - .15);\n  f.x *= v;\n  f.y *= A;\n  vec3 B = abs(e.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 C = normalize(cross(B, e));\n  vec3 D = cross(e, C);\n  vec3 E = C * f.x + D * f.y + e * f.z;\n  return normalize(E);\n}\nvec4 F(const in vec3 G, const in float I) {\n  if(I <= .0)\n    return vec4(G, 1.);\n  vec4 J;\n  vec3 K = G / I;\n  J.a = clamp(max(max(K.r, K.g), max(K.b, 1e-6)), .0, 1.);\n  J.a = ceil(J.a * 255.) / 255.;\n  J.rgb = K / J.a;\n  return J;\n}\nvec3 L(const in vec4 G, const in float I) {\n  if(I <= .0)\n    return G.rgb;\n  return I * G.rgb * G.a;\n}\nvoid main() {\n  vec3 e = normalize(vWorldPos);\n  vec3 M = e;\n  vec3 O = M;\n  const int P = 1024;\n  vec3 Q = vec3(.0);\n  float S = .0;\n  for(int T = 0; T < P; ++T) {\n    vec3 f = n(float(T) / float(P), e, roughness);\n    vec3 U = normalize(2. * dot(O, f) * f - O);\n    float W = max(dot(e, U), .0);\n    if(W > .0) {\n      Q += L(textureCube(environmentMap, U), rgbmRange).rgb * W;\n      S += W;\n    }\n  }\n  Q = Q / S;\n  gl_FragColor = F(Q, rgbmRange);\n}",vert:Vt$5,attributes:{aPosition:Ut$5.vertices},uniforms:{projMatrix:e.context("projMatrix"),viewMatrix:e.context("viewMatrix"),environmentMap:n,distributionMap:s,roughness:e.prop("roughness"),resolution:r,rgbmRange:t||7},elements:Ut$5.indices,viewport:{x:0,y:0,width:e.prop("size"),height:e.prop("size")}});let l=r;const f=e.texture({radius:r,min:"linear",mag:"linear"}),d=e.framebuffer({radius:r,color:f}),u=Math.log(l)/Math.log(2),h=[];for(let n=0;n<=u;n++){let t=0;Gt$5(e,d,c,{roughness:n/(u-1),size:l},(function(){const n=e.read({framebuffer:d});h[t]||(h[t]={mipmap:[]}),h[t].mipmap.push(n),t++})),l/=2,d.resize(l)}return s.destroy(),d.destroy(),c.destroy(),h}(e,n,t,r,i,o);return{prefilterMap:e.cube({radius:r,min:"linear mipmap linear",mag:"linear",faces:a}),prefilterMipmap:a}}(e,c,n.rgbmRange,s,o,a);let d;if(!n.ignoreSH){const n=s;d=function(e,n,r){const i=new Array(9),o=[],a=[],s=[];for(let c=0;c<9;c++){const l=[0,0,0];for(let i=0;i<Kt$5.length;i++){const f=e[i],d=[0,0,0];let u=0,h=0;const m=Wt$5[Kt$5[i]];for(let e=0;e<r;e++)for(let i=0;i<n;i++){o[0]=i/(n-1)*2-1,o[1]=e/(r-1)*2-1,o[2]=-1,normalize$4(o,o),s[0]=o[m[0]]*m[3],s[1]=o[m[1]]*m[4],s[2]=o[m[2]]*m[5],a[0]=f[h++]/255,a[1]=f[h++]/255,a[2]=f[h++]/255;const l=f[h++]/255*7;a[0]*=l,a[1]*=l,a[2]*=l,scaleAndAdd$2(d,d,a,Xt$5(s,c)*-o[2]),u+=-o[2]}scaleAndAdd$2(l,l,d,1/u)}i[c]=scale$4(l,l,1/6)}return i}(Yt$5(e,l,n),n,n);const r=[];for(let e=0;e<d.length;e++)r.push(...d[e]);d=r}const u={rgbmRange:n.rgbmRange,envMap:c,prefilterMap:l};return d&&(u.sh=d),"array"===n.format&&(u.envMap={width:c.width,height:c.height,faces:Yt$5(e,c,i)},u.prefilterMap={width:l.width,height:l.height,faces:f},c.destroy(),l.destroy()),u},generateDFGLUT:Qt$5});const tr$4={uvScale:[1,1],uvOffset:[0,0],textureOrigin:null,textureWidth:null,baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,anisotropyDirection:0,anisotropyFactor:0,clearCoatFactor:0,clearCoatIor:1.4,clearCoatRoughnessFactor:.04,clearCoatThickness:5,emitColorFactor:1,occlusionFactor:1,roughnessFactor:.4,metallicFactor:0,normalMapFactor:1,specularF0:.5,emitMultiplicative:1,normalMapFlipY:0,outputSRGB:1,baseColorTexture:null,normalTexture:null,occlusionTexture:null,metallicRoughnessTexture:null,emissiveTexture:null,uvOrigin:[0,0],noiseTexture:null,clearCoatTint:[.006,.006,.006],specularAAVariance:20,specularAAThreshold:20,hsv:[0,0,0],contrast:1,bumpTexture:null,bumpScale:.05,bumpMinLayers:5,bumpMaxLayers:20,alphaTest:0};class rr$4 extends Ce$5{constructor(e){const n=v$3({},tr$4);(e.metallicRoughnessTexture||e.metallicRoughnessTexture)&&(n.roughnessFactor=1,n.metallicFactor=1),super(e,n)}appendDefines(e,n){super.appendDefines(e,n);const t=this.uniforms;return t.GAMMA_CORRECT_INPUT&&(e.GAMMA_CORRECT_INPUT=1),n.data[n.desc.colorAttribute]&&(e.HAS_COLOR=1),n.data[n.desc.color0Attribute]&&(e.HAS_COLOR0=1,e.COLOR0_SIZE=n.getColor0Size()),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1),n.data.aVertexColorType&&(e.HAS_VERTEX_COLOR=1),n.data[n.desc.uv0Attribute]?(t.baseColorTexture&&(e.HAS_ALBEDO_MAP=1),t.metallicRoughnessTexture&&(e.HAS_METALLICROUGHNESS_MAP=1),t.occlusionTexture&&n.data[n.desc.uv1Attribute]&&(e.HAS_AO_MAP=1),t.emissiveTexture&&(e.HAS_EMISSIVE_MAP=1),t.normalTexture&&(e.HAS_NORMAL_MAP=1),t.bumpTexture&&(e.HAS_BUMP_MAP=1),t.skinTexture&&(e.HAS_SKIN_MAP=1),(e.HAS_ALBEDO_MAP||e.HAS_METALLICROUGHNESS_MAP||e.HAS_AO_MAP||e.HAS_EMISSIVE_MAP||e.HAS_NORMAL_MAP||e.HAS_BUMP_MAP||e.HAS_SKIN_MAP)&&(e.HAS_MAP=1),t.noiseTexture&&(e.HAS_RANDOM_TEX=1),n.data[n.desc.tangentAttribute]?e.HAS_TANGENT=1:n.data[n.desc.normalAttribute]&&(e.HAS_NORMAL=1),e):e}}class ir$4 extends(He$5(rr$4)){}function or$4(e,n,t){if(t.ambientUpdate){const{iblTexes:r}=e;if(r){const i=t.target;cr$4(r),e.iblTexes=sr$4(n,i)}else e.iblTexes=sr$4(n,t.target)}}const ar$4=[0,0];function sr$4(e,n){const t=n.getLightManager(),r=t&&t.getAmbientResource();return r?{prefilterMap:e.cube({width:r.prefilterMap.width,height:r.prefilterMap.height,faces:r.prefilterMap.faces,min:"linear mipmap linear",mag:"linear",format:"rgba"}),sh:r.sh,rgbmRange:r.rgbmRange}:null}function cr$4(e){for(const n in e)e[n].destroy&&e[n].destroy(),delete e[n]}var lr$4=Object.freeze({__proto__:null,loginIBLResOnCanvas:function(e,n,t){if(!e.dfgLUT&&(e.dfgLUT=Qt$5(n),e.dfgLUT.mtkRefCount=0,t)){const r=or$4.bind(this,e,n);t.on("updatelights",r),e._iblResListener=r}e.dfgLUT.mtkRefCount++;const r=t.getLightManager();return r&&r.getAmbientResource()?(e.iblTexes||(e.iblTexes=sr$4(n,t)),{dfgLUT:e.dfgLUT,iblTexes:e.iblTexes}):{dfgLUT:e.dfgLUT,iblTexes:null}},getIBLResOnCanvas:function(e){const{dfgLUT:n,iblTexes:t}=e;return{dfgLUT:n,iblTexes:t}},logoutIBLResOnCanvas:function(e,n){let t=!1;e.dfgLUT&&(e.dfgLUT.mtkRefCount--,e.dfgLUT.mtkRefCount<=0)&&(t=!0,n&&n.off("updatelights",e._iblResListener),e.dfgLUT.destroy(),delete e.dfgLUT),e.iblTexes&&t&&(cr$4(e.iblTexes),delete e.iblTexes)},getPBRUniforms:function(e,n,t,r,i){const o=e.viewMatrix,a=e.projMatrix,s=e.cameraPosition,c=e.getRenderer().canvas,l=function(e,n){const t=e.getLightManager(),r=t&&t.getAmbientResource(),i=t&&t.getAmbientLight()||{},o=t&&t.getDirectionalLight()||{};let a;if(r){const e=n.prefilterMap.width,t=Math.log(e)/Math.log(2);a={prefilterMap:n.prefilterMap,diffuseSPH:n.sh,prefilterMiplevel:[t,t],prefilterSize:[e,e],hdrHSV:i.hsv||[0,0,0]}}else a={ambientColor:i.color||[.2,.2,.2]};return a.rgbmRange=r?n.rgbmRange:7,a.environmentExposure=g$1(i.exposure)?i.exposure:1,a.environmentOrientation=i.orientation||0,a.light0_diffuse=[...o.color||[1,1,1],1],a.light0_viewDirection=o.direction||[1,1,-1],a}(e,n),f=v$3({viewMatrix:o,projMatrix:a,projViewMatrix:e.projViewMatrix,cameraPosition:s,outSize:[c.width,c.height],cameraNearFar:[e.cameraNear,e.cameraFar]},l);return f.brdfLUT=t,r&&r.renderUniforms&&v$3(f,r.renderUniforms),f.halton=i||ar$4,f},createIBLTextures:sr$4,disposeIBLTextures:cr$4,isSupported:function(e){return e.hasExtension("EXT_shader_texture_lod")}});class fr$4 extends vn$4{constructor(e){super({vert:"attribute vec3 aPosition;\nuniform mat4 lightProjViewModelMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\n#include <line_extrusion_vert>\n#include <get_output>\nvarying vec4 vPosition;\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 d = getLineExtrudePosition(aPosition);\n  vec4 e = getPosition(d);\n#else\nvec4 e = getPosition(aPosition);\n#endif\ngl_Position = lightProjViewModelMatrix * c * e;\n  vPosition = gl_Position;\n}",frag:"#define SHADER_NAME vsm_mapping\n#ifdef USE_VSM\n#extension GL_OES_standard_derivatives : enable\n#endif\nprecision highp float;\nvarying vec4 vPosition;\n#ifdef PACK_FLOAT\n#include <common_pack_float>\n#endif\nvoid main() {\n  \n#if defined(USE_VSM)\nfloat c = vPosition.z / vPosition.w;\n  c = c * .5 + .5;\n  float d = c;\n  float e = c * c;\n  float f = dFdx(c);\n  float h = dFdy(c);\n  e += .25 * (f * f + h * h);\n  gl_FragColor = vec4(d, e, c, .0);\n#endif\n#if defined(USE_ESM)\n#ifdef PACK_FLOAT\ngl_FragColor = common_encodeDepth(gl_FragCoord.z);\n#else\ngl_FragColor = vec4(gl_FragCoord.z, .0, .0, 1.);\n#endif\n#endif\n}",uniforms:[{name:"lightProjViewModelMatrix",type:"function",fn:function(e,t){return multiply$5([],t.lightProjViewMatrix,t.modelMatrix)}}],extraCommandProps:{},defines:e})}filter(e){return e.castShadow}}class dr$4 extends Mn$4{constructor({blurOffset:e}){super({vert:An$4,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\n#include <common_pack_float>\nvoid main() {\n  float c = .0;\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      float f = common_decodeDepth(texture2D(textureSource, e));\n      float s = max(.0, sign(1. - f));\n      d += sign(f) * s;\n      c += f;\n    }\n  float h = c / max(1., d);\n  gl_FragColor = common_encodeDepth(h);\n}",defines:{BOXBLUR_OFFSET:e||2}}),this._blurOffset=e||2}getMeshCommand(e,n){const t="box_shadow_blur_"+this._blurOffset;return this.commands[t]||(this.commands[t]=this.createREGLCommand(e,null,n.getElements())),this.commands[t]}}let ur$4=null,hr$4=null;class mr$4{constructor(e,{width:n,height:t,blurOffset:r,defines:i}){this.renderer=e,this.width=n||512,this.height=t||512,this.blurOffset=d$2(r)?2:r,this._init(i)}render(e,{cameraProjViewMatrix:n,lightDir:t,farPlane:r,cameraLookAt:i}){return{lightProjViewMatrix:this._renderShadow(e,n,t,r,i),shadowMap:this.blurTex||this.depthTex,depthFBO:this.depthFBO,blurFBO:this.blurFBO}}resize(e,n){return this.depthTex&&(this.depthTex.resize(e,n),this.depthFBO.resize(e,n)),this.blurFBO&&(this.blurTex.resize(e,n),this.blurFBO.resize(e,n)),this}_renderShadow(e,n,t,r,i){const o=this.renderer,a=ur$4(n);if(r)for(let e=4;e<8;e++)a[e]=r[e-4];const s=hr$4(i,a,t);return o.clear({color:[1,0,0,1],depth:1,framebuffer:this.depthFBO}),o.render(this.shadowMapShader,{lightProjViewMatrix:s},e,this.depthFBO),this.blurFBO&&(this.boxBlurShader||(this.boxBlurShader=new dr$4({blurOffset:this.blurOffset})),o.clear({color:[1,0,0,1],depth:1,framebuffer:this.blurFBO}),o.render(this.boxBlurShader,{resolution:[this.depthTex.width,this.depthTex.height],textureSource:this.depthTex},null,this.blurFBO)),s}_init(e){const n=this.renderer.regl,t=this.width,r=this.height;this.depthTex=n.texture({width:t,height:r,format:"rgb",type:"uint8",min:"nearest",mag:"nearest"}),this.shadowMapShader=new fr$4(e),this.shadowMapShader.filter=e=>e.castShadow,this.depthFBO=n.framebuffer({color:this.depthTex}),this.blurOffset<=0||(this.blurTex=n.texture({width:t,height:r,format:"rgb",type:"uint8",min:"linear",mag:"linear"}),this.blurFBO=n.framebuffer({color:this.blurTex}))}dispose(){this.depthTex&&(this.depthTex.destroy(),this.depthFBO.destroy(),delete this.depthTex,delete this.depthFBO),this.blurTex&&(this.blurTex.destroy(),this.blurFBO.destroy(),delete this.blurTex,delete this.blurFBO),this.shadowMapShader&&(this.shadowMapShader.dispose(),delete this.shadowMapShader),this.boxBlurShader&&(this.boxBlurShader.dispose(),delete this.boxBlurShader)}}ur$4=function(){const e=[[-1,-1,-1,1],[1,-1,-1,1],[1,1,-1,1],[-1,1,-1,1],[-1,-1,1,1],[1,-1,1,1],[1,1,1,1],[-1,1,1,1]],t=new Array(16);return function(i){invert$2(t,i);const o=[];for(let n=0;n<e.length;n++){const i=transformMat4$1([],e[n],t);scale$3(i,i,1/i[3]),o.push(i)}return o}}(),hr$4=function(){let e=new Array(4);const i=new Array(3),o=[0,0,0,0],a=[0,1,0],s=new Array(3);let c=new Array(16),l=new Array(16);const f=new Array(16),d=[1,1,1],u=[0,0,0];return function(h,m,v){set$3(o,...h,1),scale$4(i,v,-1),c=lookAt(c,add$4(s,o,normalize$4(s,i)),o,a),transformMat4$1(e,m[0],c);let _=e[2],g=e[2],x=e[0],b=e[0],p=e[1],y=e[1];for(let n=1;n<8;n++)e=transformMat4$1(e,m[n],c),e[2]>g&&(g=e[2]),e[2]<_&&(_=e[2]),e[0]>b&&(b=e[0]),e[0]<x&&(x=e[0]),e[1]>y&&(y=e[1]),e[1]<p&&(p=e[1]);l=ortho(l,-1,1,-1,1,-g,-_);const A=d[0]=2/(b-x),S=d[1]=-2/(y-p);u[0]=-.5*(x+b)*A,u[1]=-.5*(p+y)*S,identity$2(f),translate$1(f,f,u),scale$5(f,f,d);const T=multiply$5(l,f,l);return multiply$5(new Array(16),T,c)}}();class vr$4 extends vn$4{constructor(e){super({vert:"#define SHADER_NAME SHADOW_DISPLAY\nattribute vec3 aPosition;\nuniform mat4 projMatrix;\nuniform mat4 modelViewMatrix;\nuniform vec2 halton;\nuniform vec2 globalTexSize;\nvarying vec4 vPosition;\n#include <vsm_shadow_vert>\nvoid main() {\n  vec4 c = vec4(aPosition, 1.);\n  vec4 d = modelViewMatrix * c;\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / globalTexSize.xy;\n  gl_Position = e * d;\n  vPosition = gl_Position;\n  shadow_computeShadowPars(c);\n}",frag:"#define SHADER_NAME SHADOW_DISPLAY\nprecision mediump float;\nuniform vec3 color;\n#include <vsm_shadow_frag>\nvoid main() {\n  float c = shadow_computeShadow();\n  float d = 1. - c;\n  gl_FragColor = vec4(color * d, d);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(e,t){const r=[];return multiply$5(r,t.viewMatrix,t.modelMatrix),r}}],defines:e||{USE_ESM:1},extraCommandProps:{depth:{enable:!0,mask:!1},viewport:{x:0,y:0,width:(e,n)=>n.globalTexSize[0],height:(e,n)=>n.globalTexSize[1]}}})}getMeshCommand(e,n){return this.commands.shadow_display||(this.commands.shadow_display=this.createREGLCommand(e,null,n.getElements())),this.commands.shadow_display}}function _r$4(e){return 256*e[2]*256+256*e[1]+e[0]}const gr$4=new Uint8Array(4),xr$4=new Float32Array(gr$4.buffer);let br$4,pr$4;const yr$4=[1,1],Ar$4="\n    vec3 unpack(highp float f) {\n        highp vec3 color;\n        color.b = floor(f / 65536.0);\n        color.g = floor((f - color.b * 65536.0) / 256.0);\n        color.r = f - floor(color.b * 65536.0) - floor(color.g * 256.0);\n        // now we have a vec3 with the 3 components in range [0..255]. Let's normalize it!\n        return color / 255.0;\n    }\n",Sr$4=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    uniform float fbo_picking_meshId;\n\n    ${Ar$4}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), fbo_picking_meshId / 255.0);\n    }\n`,Tr$4=`\n    precision highp float;\n\n    uniform int fbo_picking_meshId;\n    varying float vFbo_picking_visible;\n\n    ${Ar$4}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(float(fbo_picking_meshId)), 1.0);\n        // gl_FragColor = vec4(unpack(float(35)), 1.0);\n    }\n`,Mr$4=`\n    precision highp float;\n\n    varying float vPickingId;\n    varying float vFbo_picking_visible;\n\n    ${Ar$4}\n\n    void main() {\n        if (vFbo_picking_visible == 0.0) {\n            discard;\n            return;\n        }\n        gl_FragColor = vec4(unpack(vPickingId), 1.0);\n    }\n`;class Cr$4{constructor(e,{vert:n,uniforms:t,defines:r,extraCommandProps:i},o,a){this._renderer=e,this._fbo=o,this._map=a,this._clearFbo(o),this._vert=n,this._uniforms=t,this._defines=r,this._extraCommandProps=v$3({},i),delete this._extraCommandProps.blend,delete this._extraCommandProps.stencil,this._currentMeshes=[],this._init()}_init(){const e=[];this._uniforms&&e.push(...this._uniforms);const n={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)n[e]=this._defines[e];const t=this._vert,r=this._extraCommandProps;this._shader0=new vn$4({vert:t,frag:Sr$4,uniforms:e,defines:n,extraCommandProps:r}),this._shader2=new vn$4({vert:t,frag:Mr$4,uniforms:e,defines:n,extraCommandProps:r});const i={ENABLE_PICKING:1,HAS_PICKING_ID:1};if(this._defines)for(const e in this._defines)i[e]=this._defines[e];this._shader1=new vn$4({vert:t,frag:Tr$4,uniforms:e,defines:i,extraCommandProps:r}),this._depthShader=new vn$4({vert:t,frag:"\n    #ifdef GL_ES\n        precision highp float;\n    #endif\n    #if __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n        #extension GL_EXT_frag_depth : enable\n    #endif\n    #include <gl2_frag>\n    #include <common_pack_float>\n    varying float vFbo_picking_viewZ;\n    uniform float logDepthBufFC;\n    varying float vFbo_picking_fragDepth;\n\n    const float PackUpscale = 256. / 255.;\n    const float UnpackDownscale = 255. / 256.;\n    const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n    const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n    const float ShiftRight8 = 1. / 256.;\n    vec4 packDepthToRGBA(const in float v ) {\n        vec4 r = vec4(fract(v * PackFactors), v);\n        r.yzw -= r.xyz * ShiftRight8;\n        return r * PackUpscale;\n    }\n\n    void main() {\n        float fragDepth = vFbo_picking_fragDepth > 1.0 ? vFbo_picking_fragDepth : vFbo_picking_viewZ + 1.0;\n        #if __VERSION__ == 300 || __VERSION__ == 100 && defined(GL_EXT_frag_depth)\n            gl_FragDepthEXT = log2(fragDepth) * logDepthBufFC * 0.5;\n        #endif\n        vec4 depthColor = packDepthToRGBA(fragDepth - 1.0);\n        glFragColor = common_unpackFloat(dot(depthColor, UnpackFactors));\n        #if __VERSION__ == 100\n            gl_FragColor = glFragColor;\n        #endif\n    }\n",uniforms:e,defines:i,extraCommandProps:r}),this._scene=new Ke$5,this._scene1=new Ke$5}filter(){return!0}render(e,n,t=!1){if(!e||!e.length)return this;const r=this._fbo;t&&this.clear(),e=e.filter((e=>e&&e.isValid())),this._scene.setMeshes(e);const i=this._getShader(e,t);i.filter=this.filter,this._currentShader&&i!==this._currentShader&&this.clear(),this._currentShader=i,e.forEach(((e,n)=>{e.setUniform("fbo_picking_meshId",n+this._currentMeshes.length)}));for(let n=0;n<e.length;n++)this._currentMeshes.push(e[n]);return this._renderer.render(i,n,this._scene,r),this}pickAll(e,n,t,r,i){t=Er$4(t);const{meshIds:o,pickingIds:a,coords:s,points:c}=this._pick(e,n,t,r,i),l=[];if(a&&o){const e={};for(let n=0;n<o.length;n++){const t=`${a[n]}_${o[n]}`;null==o[n]||null==a[n]||e[t]||(e[t]=!0,l.push({meshId:o[n],pickingId:a[n],point:c[n]||null,coordinate:s[n]||null}))}}return l}pick(e,n,t,r,i={}){t=Er$4(t);const{meshIds:o,pickingIds:a,width:s,coords:c,points:l}=this._pick(e,n,t,r,i);if(a&&o){const e=[];for(let n=0;n<=t[0];n++)e.push(n),n>0&&e.push(-n);for(let n=0;n<e.length;n++)for(let r=0;r<e.length;r++){const i=(e[r]+t[1])*s+(e[n]+t[0]);if(null!=o[i]&&null!=a[i])return{meshId:o[i],pickingId:a[i],point:l[i]||null,coordinate:c[i]||null}}}return{pickingId:null,meshId:null,point:null}}_pick(e,n,t,r,i={}){const o=this._currentShader,a=this._currentMeshes;if(!o||!a||!a.length)return{pickingId:null,meshId:null,point:null};e=Math.round(e),n=Math.round(n);const s=this._fbo;if(e<=2||e>=s.width-2||n<=2||n>=s.height-2)return{pickingId:null,meshId:null,point:null};const{px:c,py:l,width:f,height:d}=this._getParams(e,n,t,s),u=new Uint8Array(4*f*d),h=this._renderer.regl.read({data:u,x:c,y:l,framebuffer:s,width:f,height:d}),m=[];let v=[];for(let e=0;e<h.length;e+=4){const{pickingId:n,meshId:t}=this._packData(h.subarray(e,e+4),o);m.push(t),v.push(n)}const _={},g=m.filter((e=>null!=e&&!_[e]&&(_[e]=1,!0))).map((e=>a[e]));let x;for(let e=0;e<g.length;e++)if(g[e]&&g[e].geometry){x=g[e];break}if(!x)return{pickingId:null,meshId:null,point:null};const b=x.geometry.desc.pickingIdAttribute;m.length&&o===this._shader1&&(void 0!==x.getUniform("uPickingId")||x.geometry.data[b])&&(v=this._getPickingId(c,l,f,d,u,g,r));const p=[],y=[];if(m.length&&i.returnPoint){const{viewMatrix:t,projMatrix:o}=i,a=this._pickDepth(c,l,f,d,u,g,r);for(let r=0;r<a.length;r++)if(a[r]&&null!=m[r]&&null!=v[r]){const i=this._getWorldPos(e,n,a[r],t,o),s=this._convertPickPoint(i);p.push(i),y.push(s)}else p.push(null),y.push(null)}return{meshIds:m,pickingIds:v,coords:y,points:p,width:f,height:d}}_convertPickPoint(e){const n=this._map;if(!n)return null;const t=n.getGLRes();if(!br$4){const e=n.getCenter();pr$4=new e.constructor(0,0,0);const t=n.coordToPoint(e);br$4=new t.constructor(0,0)}br$4.set(e[0],e[1]);const r=n.pointAtResToCoord(br$4,t,pr$4),i=n.pointAtResToAltitude(e[2],t);return[r.x,r.y,i]}clear(){return this._fbo&&this._clearFbo(this._fbo),this._currentMeshes=[],delete this._currentShader,this}getMeshAt(e){return this._currentMeshes?this._currentMeshes[e]:null}getRenderedMeshes(){return this._currentMeshes}dispose(){this.clear(),this._shader0&&this._shader0.dispose(),this._shader1&&this._shader1.dispose(),this._shader2&&this._shader2.dispose(),this._scene&&this._scene.clear(),this._scene1&&this._scene1.clear()}_getWorldPos(e,t,r,i,o){const a=this._fbo,s=[],c=a.width/2||1,l=a.height/2||1,f=[(e-c)/c,(l-t)/l,0,1],d=[(e-c)/c,(l-t)/l,1,1],u=invert$2(s,o),h=[],m=[];Or$4(h,f,u),Or$4(m,d,u);const v=-h[2],_=(r-v)/(-m[2]-v),b=invert$2(s,multiply$5(s,o,i)),p=Or$4(f,f,b),y=Or$4(d,d,b);return[x$6(p[0],y[0],_),x$6(p[1],y[1],_),x$6(p[2],y[2],_)]}_getPickingId(e,n,t,r,i,o,a){const s=this._renderer.regl,c=this._getFBO1();this._clearFbo(c),this._scene1.setMeshes(o),this._renderer.render(this._shader2,a,this._scene1,c);const l=s.read({data:i,x:e,y:n,framebuffer:c,width:t,height:r}),f=[];for(let e=0;e<l.length;e+=4)f.push(_r$4(l.subarray(e,e+4)));return f}_pickDepth(e,n,t,r,i,o,a){const s=this._renderer.regl,c=this._getFBO1();this._scene1.setMeshes(o),this._clearFbo(c),a.logDepthBufFC=2/(Math.log(this._map.cameraFar+1)/Math.LN2),this._renderer.render(this._depthShader,a,this._scene1,c);const l=s.read({data:i,x:e,y:n,framebuffer:c,width:t,height:r}),f=[];for(let e=0;e<l.length;e+=4)f.push((d=l.subarray(e,e+4),gr$4[0]=d[3],gr$4[1]=d[2],gr$4[2]=d[1],gr$4[3]=d[0],xr$4[0]));var d;return f}_packData(e,n){if(255===e[0]&&255===e[1]&&255===e[2]&&255===e[3])return{meshId:null,pickingId:null};let t=null,r=null;return n===this._shader1?r=_r$4(e):n===this._shader0?(r=e[3],t=_r$4(e)):(r=null,t=_r$4(e)),{meshId:r,pickingId:t}}_clearFbo(e){this._renderer.regl.clear({color:[1,1,1,1],depth:1,stencil:0,framebuffer:e})}_getShader(e,n){return n&&e.length<256?this._shader0:this._shader1}_getFBO1(){const e=this._renderer.regl,n=this._fbo;return this._fbo1?this._fbo1.width===n.width&&this._fbo1.height===n.height||this._fbo1.resize(n.width,n.height):this._fbo1=e.framebuffer(n.width,n.height),this._fbo1}_getParams(e,n,t,r){const i=t[0],o=t[1];n=r.height-n;let a=2*i+1,s=2*o+1;const c=(e-=i)+a,l=(n-=o)+s;return c>r.width&&(a-=c-r.width),l>r.height&&(s-=l-r.height),{px:e=e<0?0:e,py:n=n<0?0:n,width:a,height:s}}getPickingVert(){return this._vert}getUniformDeclares(){return this._uniforms}}function Or$4(e,n,t){const r=n[0],i=n[1],o=n[2],a=1/(t[3]*r+t[7]*i+t[11]*o+t[15]);return e[0]=(t[0]*r+t[4]*i+t[8]*o+t[12])*a,e[1]=(t[1]*r+t[5]*i+t[9]*o+t[13])*a,e[2]=(t[2]*r+t[6]*i+t[10]*o+t[14])*a,e}function Er$4(e){return g$1(e)&&(yr$4[0]=yr$4[1]=e,e=yr$4),e}const Pr$4=e=>e&&e.geometry&&void 0===e.geometry.properties.shaderHash,Ir$4=[],wr$4=[],Dr$4=[{name:"modelViewMatrix",type:"function",fn:(e,t)=>multiply$5(Ir$4,t.viewMatrix,t.modelMatrix)},{name:"modelViewProjMatrix",type:"function",fn:(e,t)=>{const r=multiply$5(Ir$4,t.viewMatrix,t.modelMatrix);return multiply$5(Ir$4,t.projMatrix,r)}},{name:"modelMatrixInverse",type:"function",fn:(e,t)=>invert$2(Ir$4,t.modelMatrix)},{name:"projMatrixInverse",type:"function",fn:(e,t)=>invert$2(Ir$4,t.projMatrix)},{name:"modelViewMatrixInverse",type:"function",fn:(e,t)=>(multiply$5(Ir$4,t.viewMatrix,t.modelMatrix),invert$2(Ir$4,Ir$4))},{name:"modelViewProjMatrixInverse",type:"function",fn:(e,t)=>{const r=multiply$5(Ir$4,t.viewMatrix,t.modelMatrix);return multiply$5(Ir$4,t.projMatrix,r),invert$2(Ir$4,Ir$4)}},{name:"modelInverseTransposeMatrix",type:"function",fn:(e,n)=>{const t=fromMat4$1(wr$4,n.modelMatrix),r=transpose$1(t,t);return invert$3(r,r)}},{name:"modelViewInverseTransposeMatrix",type:"function",fn:(e,t)=>{const r=multiply$5(Ir$4,t.viewMatrix,t.modelMatrix),o=fromMat4$1(wr$4,r),a=transpose$1(o,o);return invert$3(a,a)}}],Rr$4={LOCAL:"positionMatrix",MODEL:"modelMatrix",VIEW:"viewMatrix",PROJECTION:"projMatrix",MODELVIEW:"modelViewMatrix",MODELVIEWPROJECTION:"modelViewProjMatrix",MODELINVERSE:"modelMatrixInverse",VIEWINVERSE:"viewMatrixInverse",PROJECTIONINVERSE:"projMatrixInverse",MODELVIEWINVERSE:"modelViewMatrixInverse",MODELVIEWPROJECTIONINVERSE:"modelViewProjMatrixInverse",MODELINVERSETRANSPOSE:"modelInverseTransposeMatrix",MODELVIEWINVERSETRANSPOSE:"modelViewInverseTransposeMatrix",VIEWPORT:"viewport",JOINTMATRIX:"jointMatrix",ALPHACUTOFF:"alphaCutoff"};class Nr$4{constructor(e,n,t){this._regl=e,this._khrShaders={},this._commandProps=n,this._resLoader=t}getExcludeFilter(){return Pr$4}forEachShader(e){for(const n in this._khrShaders){const t=this._khrShaders[n];e(t.shader,t.filter,t.uniformSemantics)}}createMesh(e,n,t,r){const i=n.extensions.KHR_techniques_webgl,o=n.materials[e.material].extensions.KHR_techniques_webgl,{technique:a,values:s}=o,c=i.techniques[a],l=i.programs[c.program],f=i.shaders[l.vertexShader],d=i.shaders[l.fragmentShader];d.content=function(e){return e&&e.indexOf("precision")<0?"precision mediump float;\n"+e:e}(d.content);const u=I$5(f.content)+"-"+I$5(d.content);this._khrShaders[u]||(this._khrShaders[u]=this._createTechniqueShader(u,i,a,this._commandProps,r));const{attributeSemantics:h}=this._khrShaders[u],m=this._createGeometry(e,h,t,u),_=v$3({},s);for(const e in s)c.uniforms[e]&&35678===c.uniforms[e].type&&(_[e]=this._getTexture(n.textures[s[e].index]));return{geometry:m,material:new Ce$5(_)}}_createGeometry(e,n,t,r){const i=e.attributes;if(i.COLOR_0){const e=i.COLOR_0.array||i.COLOR_0;if(e instanceof Float32Array){const n=new Uint8Array(e.length);for(let t=0;t<n.length;t++)n[t]=Math.round(255*e[t]);i.COLOR_0.array?(i.COLOR_0.array=n,i.COLOR_0.componentType=5121):i.COLOR_0=n}}const o={};for(const e in i){const t=me$5(this._regl,i[e],{dimension:i[e].itemSize}),r=n[e]||e;o[r]={buffer:t},i[e].quantization&&(o[r].quantization=i[e].quantization),r===n.POSITION&&(o[r].array=i[e].array)}const a=new Q$7(o,e.indices.array?e.indices.array:e.indices,0,{positionAttribute:n.POSITION,normalAttribute:n.NORMAL,uv0Attribute:n.TEXCOORD_0,uv1Attribute:n.TEXCOORD_1,color0Attribute:n.COLOR_0,tangentAttribute:n.TANGENT,textureCoordMatrixAttribute:n.TextureCoordMatrix,primitive:void 0===e.mode?"triangles":ne$5(e.mode)});a.generateBuffers(this._regl,{excludeElementsInVAO:t}),a.properties.shaderHash=r;const s=a.data[a.desc.positionAttribute];return s&&s.array&&delete s.array,a}_getTexture(e){const n={type:e.type?re$5(e.type):"uint8",format:e.format?oe$5(e.format):"rgba",flipY:!!e.flipY},t=e.image;t.array?n.data=t.array:t.mipmap&&(n.mipmap=t.mipmap),n.width=t.width,n.height=t.height;const r=e.sampler||e.texture.sampler;return r&&(r.magFilter&&(n.mag=se$5(r.magFilter)),r.minFilter&&(n.min=le$5(r.minFilter)),r.wrapS&&(n.wrapS=de$5(r.wrapS)),r.wrapT&&(n.wrapT=de$5(r.wrapT))),new en$5(n,this._resLoader)}_createTechniqueShader(e,n,t,r,i){const{techniques:o,programs:a,shaders:s}=n,c=o[t],l=a[c.program],f=s[l.vertexShader].content,d=s[l.fragmentShader].content,u={};for(const e in c.uniforms){const n=c.uniforms[e];n.semantic&&(u[n.semantic]=e)}const h=Dr$4.slice();for(const e in u)h.push({name:u[e],type:"function",fn:(n,t)=>t[Rr$4[e]]});const m=new vn$4({vert:f,frag:d,uniforms:h,extraCommandProps:r});i&&(m.version=300);const v={};for(const e in c.attributes)v[c.attributes[e].semantic]=e;return{shader:m,filter:n=>n&&n.geometry&&n.geometry.properties.shaderHash===e,uniformSemantics:u,attributeSemantics:v}}dispose(){for(const e in this._khrShaders){const{shader:n}=this._khrShaders[e];n.dispose()}this._khrShaders={}}}var Fr$4={exports:{}};function Hr$4(e,n,t){t=t||2;var r,i,o,a,s,c,l,f=n&&n.length,d=f?n[0]*t:e.length,u=Lr$4(e,0,d,t,!0),h=[];if(!u||u.next===u.prev)return h;if(f&&(u=function(e,n,t,r){var i,o,a,s=[];for(i=0,o=n.length;i<o;i++)(a=Lr$4(e,n[i]*r,i<o-1?n[i+1]*r:e.length,r,!1))===a.next&&(a.steiner=!0),s.push(qr$4(a));for(s.sort(jr$4),i=0;i<s.length;i++)t=Xr$4(s[i],t);return t}(e,n,u,t)),e.length>80*t){r=o=e[0],i=a=e[1];for(var m=t;m<d;m+=t)(s=e[m])<r&&(r=s),(c=e[m+1])<i&&(i=c),s>o&&(o=s),c>a&&(a=c);l=0!==(l=Math.max(o-r,a-i))?32767/l:0}return kr$4(u,h,t,r,i,l,0),h}function Lr$4(e,n,t,r,i){var o,a;if(i===si$4(e,n,t,r)>0)for(o=n;o<t;o+=r)a=ii$4(o,e[o],e[o+1],a);else for(o=t-r;o>=n;o-=r)a=ii$4(o,e[o],e[o+1],a);return a&&Qr$4(a,a.next)&&(oi$4(a),a=a.next),a}function zr$4(e,n){if(!e)return e;n||(n=e);var t,r=e;do{if(t=!1,r.steiner||!Qr$4(r,r.next)&&0!==Zr$4(r.prev,r,r.next))r=r.next;else{if(oi$4(r),(r=n=r.prev)===r.next)break;t=!0}}while(t||r!==n);return n}function kr$4(e,n,t,r,i,o,a){if(e){!a&&o&&function(e,n,t,r){var i=e;do{0===i.z&&(i.z=Kr$4(i.x,i.y,n,t,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){var n,t,r,i,o,a,s,c,l=1;do{for(t=e,e=null,o=null,a=0;t;){for(a++,r=t,s=0,n=0;n<l&&(s++,r=r.nextZ);n++);for(c=l;s>0||c>0&&r;)0!==s&&(0===c||!r||t.z<=r.z)?(i=t,t=t.nextZ,s--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:e=i,i.prevZ=o,o=i;t=r}o.nextZ=null,l*=2}while(a>1)}(i)}(e,r,i,o);for(var s,c,l=e;e.prev!==e.next;)if(s=e.prev,c=e.next,o?Gr$4(e,r,i,o):Br$4(e))n.push(s.i/t|0),n.push(e.i/t|0),n.push(c.i/t|0),oi$4(e),e=c.next,l=c.next;else if((e=c)===l){a?1===a?kr$4(e=Ur$4(zr$4(e),n,t),n,t,r,i,o,2):2===a&&Vr$4(e,n,t,r,i,o):kr$4(zr$4(e),n,t,r,i,o,1);break}}}function Br$4(e){var n=e.prev,t=e,r=e.next;if(Zr$4(n,t,r)>=0)return!1;for(var i=n.x,o=t.x,a=r.x,s=n.y,c=t.y,l=r.y,f=i<o?i<a?i:a:o<a?o:a,d=s<c?s<l?s:l:c<l?c:l,u=i>o?i>a?i:a:o>a?o:a,h=s>c?s>l?s:l:c>l?c:l,m=r.next;m!==n;){if(m.x>=f&&m.x<=u&&m.y>=d&&m.y<=h&&Yr$4(i,s,o,c,a,l,m.x,m.y)&&Zr$4(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Gr$4(e,n,t,r){var i=e.prev,o=e,a=e.next;if(Zr$4(i,o,a)>=0)return!1;for(var s=i.x,c=o.x,l=a.x,f=i.y,d=o.y,u=a.y,h=s<c?s<l?s:l:c<l?c:l,m=f<d?f<u?f:u:d<u?d:u,v=s>c?s>l?s:l:c>l?c:l,_=f>d?f>u?f:u:d>u?d:u,g=Kr$4(h,m,n,t,r),x=Kr$4(v,_,n,t,r),b=e.prevZ,p=e.nextZ;b&&b.z>=g&&p&&p.z<=x;){if(b.x>=h&&b.x<=v&&b.y>=m&&b.y<=_&&b!==i&&b!==a&&Yr$4(s,f,c,d,l,u,b.x,b.y)&&Zr$4(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,p.x>=h&&p.x<=v&&p.y>=m&&p.y<=_&&p!==i&&p!==a&&Yr$4(s,f,c,d,l,u,p.x,p.y)&&Zr$4(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;b&&b.z>=g;){if(b.x>=h&&b.x<=v&&b.y>=m&&b.y<=_&&b!==i&&b!==a&&Yr$4(s,f,c,d,l,u,b.x,b.y)&&Zr$4(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;p&&p.z<=x;){if(p.x>=h&&p.x<=v&&p.y>=m&&p.y<=_&&p!==i&&p!==a&&Yr$4(s,f,c,d,l,u,p.x,p.y)&&Zr$4(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function Ur$4(e,n,t){var r=e;do{var i=r.prev,o=r.next.next;!Qr$4(i,o)&&$r$4(i,r,r.next,o)&&ti$4(i,o)&&ti$4(o,i)&&(n.push(i.i/t|0),n.push(r.i/t|0),n.push(o.i/t|0),oi$4(r),oi$4(r.next),r=e=o),r=r.next}while(r!==e);return zr$4(r)}function Vr$4(e,n,t,r,i,o){var a=e;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Jr$4(a,s)){var c=ri$4(a,s);return a=zr$4(a,a.next),c=zr$4(c,c.next),kr$4(a,n,t,r,i,o,0),void kr$4(c,n,t,r,i,o,0)}s=s.next}a=a.next}while(a!==e)}function jr$4(e,n){return e.x-n.x}function Xr$4(e,n){var t=function(e,n){var t,r=n,i=e.x,o=e.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,t=r.x<r.next.x?r:r.next,s===i))return t}r=r.next}while(r!==n);if(!t)return null;var c,l=t,f=t.x,d=t.y,u=1/0;r=t;do{i>=r.x&&r.x>=f&&i!==r.x&&Yr$4(o<d?i:a,o,f,d,o<d?a:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),ti$4(r,e)&&(c<u||c===u&&(r.x>t.x||r.x===t.x&&Wr$4(t,r)))&&(t=r,u=c)),r=r.next}while(r!==l);return t}(e,n);if(!t)return n;var r=ri$4(t,e);return zr$4(r,r.next),zr$4(t,t.next)}function Wr$4(e,n){return Zr$4(e.prev,e,n.prev)<0&&Zr$4(n.next,e,e.next)<0}function Kr$4(e,n,t,r,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-t)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function qr$4(e){var n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next}while(n!==e);return t}function Yr$4(e,n,t,r,i,o,a,s){return(i-a)*(n-s)>=(e-a)*(o-s)&&(e-a)*(r-s)>=(t-a)*(n-s)&&(t-a)*(o-s)>=(i-a)*(r-s)}function Jr$4(e,n){return e.next.i!==n.i&&e.prev.i!==n.i&&!function(e,n){var t=e;do{if(t.i!==e.i&&t.next.i!==e.i&&t.i!==n.i&&t.next.i!==n.i&&$r$4(t,t.next,e,n))return!0;t=t.next}while(t!==e);return!1}(e,n)&&(ti$4(e,n)&&ti$4(n,e)&&function(e,n){var t=e,r=!1,i=(e.x+n.x)/2,o=(e.y+n.y)/2;do{t.y>o!=t.next.y>o&&t.next.y!==t.y&&i<(t.next.x-t.x)*(o-t.y)/(t.next.y-t.y)+t.x&&(r=!r),t=t.next}while(t!==e);return r}(e,n)&&(Zr$4(e.prev,e,n.prev)||Zr$4(e,n.prev,n))||Qr$4(e,n)&&Zr$4(e.prev,e,e.next)>0&&Zr$4(n.prev,n,n.next)>0)}function Zr$4(e,n,t){return(n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function Qr$4(e,n){return e.x===n.x&&e.y===n.y}function $r$4(e,n,t,r){var i=ni$4(Zr$4(e,n,t)),o=ni$4(Zr$4(e,n,r)),a=ni$4(Zr$4(t,r,e)),s=ni$4(Zr$4(t,r,n));return i!==o&&a!==s||!(0!==i||!ei$4(e,t,n))||!(0!==o||!ei$4(e,r,n))||!(0!==a||!ei$4(t,e,r))||!(0!==s||!ei$4(t,n,r))}function ei$4(e,n,t){return n.x<=Math.max(e.x,t.x)&&n.x>=Math.min(e.x,t.x)&&n.y<=Math.max(e.y,t.y)&&n.y>=Math.min(e.y,t.y)}function ni$4(e){return e>0?1:e<0?-1:0}function ti$4(e,n){return Zr$4(e.prev,e,e.next)<0?Zr$4(e,n,e.next)>=0&&Zr$4(e,e.prev,n)>=0:Zr$4(e,n,e.prev)<0||Zr$4(e,e.next,n)<0}function ri$4(e,n){var t=new ai$4(e.i,e.x,e.y),r=new ai$4(n.i,n.x,n.y),i=e.next,o=n.prev;return e.next=n,n.prev=e,t.next=i,i.prev=t,r.next=t,t.prev=r,o.next=r,r.prev=o,r}function ii$4(e,n,t,r){var i=new ai$4(e,n,t);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function oi$4(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function ai$4(e,n,t){this.i=e,this.x=n,this.y=t,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function si$4(e,n,t,r){for(var i=0,o=n,a=t-r;o<t;o+=r)i+=(e[a]-e[o])*(e[o+1]+e[a+1]),a=o;return i}Fr$4.exports=Hr$4,Fr$4.exports.default=Hr$4,Hr$4.deviation=function(e,n,t,r){var i=n&&n.length,o=Math.abs(si$4(e,0,i?n[0]*t:e.length,t));if(i)for(var a=0,s=n.length;a<s;a++)o-=Math.abs(si$4(e,n[a]*t,a<s-1?n[a+1]*t:e.length,t));var c=0;for(a=0;a<r.length;a+=3){var l=r[a]*t,f=r[a+1]*t,d=r[a+2]*t;c+=Math.abs((e[l]-e[d])*(e[f+1]-e[l+1])-(e[l]-e[f])*(e[d+1]-e[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},Hr$4.flatten=function(e){for(var n=e[0][0].length,t={vertices:[],holes:[],dimensions:n},r=0,i=0;i<e.length;i++){for(var o=0;o<e[i].length;o++)for(var a=0;a<n;a++)t.vertices.push(e[i][o][a]);i>0&&t.holes.push(r+=e[i-1].length)}return t};var ci$4=Fr$4.exports;const li$4={parseHDR:$e$5},fi$4={PBRHelper:nr$4,StandardMaterial:rr$4,StandardSpecularGlossinessMaterial:ir$4,StandardShader:class extends vn$4{constructor(e={}){let t=e.extraCommandProps||{};const r=e.uniforms;t=v$3({},t);const o=e.defines||{},a=[],s=[],c=[],l=[],f=[],d=[{name:"modelNormalMatrix",type:"function",fn:(e,n)=>fromMat4$1(a,n.modelMatrix)},{name:"modelViewNormalMatrix",type:"function",fn:(e,t)=>{const r=multiply$5(s,t.viewMatrix,t.modelMatrix),o=invert$2(r,r),a=transpose(o,o);return fromMat4$1(c,a)}},{name:"modelViewMatrix",type:"function",fn:(e,t)=>multiply$5(l,t.viewMatrix,t.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(e,n)=>fromRotation$2(f,Math.PI*(n.environmentOrientation||0)/180)}];r&&d.push(...r),super({vert:e.vert||"#include <gl2_vert>\n#define SHADER_NAME PBR\nprecision highp float;\nattribute vec3 aPosition;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#if defined(HAS_AO_MAP)\nattribute vec2 aTexCoord1;\nvarying vec2 vTexCoord1;\n#endif\n#endif\nvec3 c;\nvec3 d;\nvec4 e;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform mediump vec3 cameraPosition;\nuniform mat3 modelNormalMatrix;\n#ifdef HAS_SSR\nuniform mat3 modelViewNormalMatrix;\nvarying vec3 vViewNormal;\n#ifdef HAS_TANGENT\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\nvarying vec3 vModelVertex;\n#if defined(HAS_MAP)\nvarying vec2 vTexCoord;\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\n#include <highlight_vert>\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\nvarying vec3 vColor0;\n#else\nattribute vec4 aColor0;\nvarying vec4 vColor0;\n#endif\n#endif\n#include <line_extrusion_vert>\n#include <get_output>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <heatmap_render_vert>\n#include <vertex_color_vert>\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#if __VERSION__ == 100\nmat3 f(in mat3 h) {\n  vec3 i = h[0];\n  vec3 j = h[1];\n  vec3 k = h[2];\n  return mat3(vec3(i.x, j.x, k.x), vec3(i.y, j.y, k.y), vec3(i.z, j.z, k.z));\n}\n#else\nmat3 f(in mat3 h) {\n  return transpose(h);\n}\n#endif\n#endif\nvoid l(const highp vec4 q, out highp vec3 m) {\n  m = vec3(.0, .0, 1.) + vec3(2., -2., -2.) * q.x * q.zwx + vec3(2., 2., -2.) * q.y * q.wzy;\n}\nvoid l(const highp vec4 q, out highp vec3 m, out highp vec3 t) {\n  l(q, m);\n  t = vec3(1., .0, .0) + vec3(-2., 2., -2.) * q.y * q.yxw + vec3(-2., 2., 2.) * q.z * q.zwx;\n}\nconst float o = .5;\nvec2 u(vec2 v, float A) {\n  return vec2(cos(A) * (v.x - o) + sin(A) * (v.y - o) + o, cos(A) * (v.y - o) - sin(A) * (v.x - o) + o);\n}\n#if defined(HAS_MAP)\nvec2 B(vec2 v) {\n  vec2 C = decode_getTexcoord(v);\n  vec2 D = C * uvScale + uvOffset;\n  return D;\n}\n#endif\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <excavate_vert>\nvoid main() {\n  mat4 E = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec3 F = getLineExtrudePosition(aPosition);\n  vec4 G = getPosition(F);\n#else\nvec4 G = getPosition(aPosition);\n#endif\nvModelVertex = (modelMatrix * G).xyz;\n  vec4 H = E * G;\n  vec4 I = modelViewMatrix * H;\n  vViewVertex = I;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(H, modelMatrix);\n#else\ngl_Position = projMatrix * I;\n#endif\n#ifdef PICKING_MODE\nfloat J = 1.;\n#if defined(HAS_COLOR)\nJ *= aColor.a;\n#endif\n#if defined(HAS_COLOR0) && COLOR0_SIZE == 4\nJ *= aColor0.a;\n#endif\nfbo_picking_setData(gl_Position.w, J != .0);\n#else\n#if defined(HAS_MAP)\nvTexCoord = B(aTexCoord);\n#ifdef HAS_AO_MAP\nvTexCoord1 = B(aTexCoord1);\n#endif\n#ifdef HAS_I3S_UVREGION\nvUvRegion = uvRegion / 65535.;\n#endif\n#endif\n#if defined(HAS_TANGENT) || defined(HAS_NORMAL)\nmat3 K = mat3(E);\n  mat3 L = modelNormalMatrix * K;\n#if defined(HAS_TANGENT)\nvec3 t;\n  l(aTangent, d, t);\n  vModelTangent = vec4(L * t, aTangent.w);\n#else\nd = decode_getNormal(aNormal);\n#endif\nvec3 M = d;\n  vModelNormal = L * M;\n#else\nd = vec3(.0);\n  vModelNormal = vec3(.0);\n#endif\n#if defined(HAS_TANGENT)\nvModelBiTangent = cross(vModelNormal, vModelTangent.xyz) * sign(aTangent.w);\n#endif\n#ifdef HAS_SSR\nmat3 N = modelViewNormalMatrix * K;\n  vViewNormal = N * d;\n#if defined(HAS_TANGENT)\nvec4 O = vec4(t, aTangent.w);\n  vViewTangent = vec4(N * O.xyz, O.w);\n#endif\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\nhighlight_setVarying();\n#if defined(HAS_COLOR0)\nvColor0 = aColor0 / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(H);\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * E, G);\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nmat3 P = f(mat3(vModelTangent.xyz, vModelBiTangent, vModelNormal));\n  vTangentViewPos = P * cameraPosition;\n  vTangentFragPos = P * vModelVertex;\n#endif\n#ifdef HAS_VERTEX_COLOR\nvertexColor_update();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nvCoordinateTexcoord = getCoordinateTexcoord();\n  vHeight = getWorldHeight();\n#endif\n#endif\n}",frag:e.frag||"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nconst float c = .04;\nstruct MaterialUniforms {\n  vec2 roughnessMetalness;\n  vec3 albedo;\n  float alpha;\n  vec3 normal;\n  vec3 emit;\n  float ao;\n  vec3 specularColor;\n  float glossiness;\n  vec4 skinColor;\n} d;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform vec3 cameraPosition;\nuniform float alphaTest;\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nuniform vec4 diffuseFactor;\nuniform vec3 specularFactor;\nuniform float glossinessFactor;\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\nuniform vec3 emissiveFactor;\nuniform vec4 baseColorFactor;\nuniform float baseColorIntensity;\nuniform float anisotropyDirection;\nuniform float anisotropyFactor;\nuniform float clearCoatFactor;\nuniform float clearCoatIor;\nuniform float clearCoatRoughnessFactor;\nuniform float clearCoatThickness;\nuniform float emitColorFactor;\nuniform float occlusionFactor;\nuniform float environmentExposure;\nuniform float roughnessFactor;\nuniform float metallicFactor;\nuniform float normalMapFactor;\nuniform float rgbmRange;\nuniform float specularF0;\nuniform int emitMultiplicative;\nuniform int normalMapFlipY;\nuniform int outputSRGB;\nuniform mat3 uEnvironmentTransform;\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nuniform sampler2D metallicRoughnessTexture;\n#endif\n#if defined(HAS_EMISSIVE_MAP)\nuniform sampler2D emissiveTexture;\n#endif\n#if defined(HAS_AO_MAP)\nuniform sampler2D occlusionTexture;\nvarying vec2 vTexCoord1;\n#endif\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nuniform sampler2D normalTexture;\n#endif\n#if defined(HAS_SKIN_MAP)\nuniform sampler2D skinTexture;\n#endif\n#if defined(HAS_ALPHAMODE)\nuniform float alphaCutoff;\n#endif\n#ifdef HAS_RANDOM_TEX\nuniform highp vec2 uvOrigin;\nuniform sampler2D noiseTexture;\n#endif\nuniform sampler2D brdfLUT;\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\nuniform vec2 cameraNearFar;\nuniform vec3 clearCoatTint;\nuniform vec3 light0_viewDirection;\nuniform vec4 light0_diffuse;\n#ifdef HAS_SSR\nvarying vec3 vViewNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vViewTangent;\n#endif\n#endif\nvarying vec3 vModelVertex;\nvarying vec4 vViewVertex;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\nvarying vec3 vModelNormal;\n#if defined(HAS_TANGENT)\nvarying vec4 vModelTangent;\nvarying vec3 vModelBiTangent;\n#endif\n#if defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvarying vec3 vColor0;\n#else\nvarying vec4 vColor0;\n#endif\n#endif\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#elif defined(IS_LINE_EXTRUSION)\nuniform vec4 lineColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#ifdef HAS_LAYER_OPACITY\nuniform float layerOpacity;\n#endif\nvarying float vOpacity;\n#ifdef HAS_INSTANCE_COLOR\nvarying vec4 vInstanceColor;\n#endif\n#ifdef IS_LINE_EXTRUSION\nuniform float lineOpacity;\n#else\nuniform float polygonOpacity;\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\nuniform float currentTime;\nuniform float animSpeedScale;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatternGapColor;\nuniform vec2 uvScale;\nvarying float vPatternHeight;\nvarying float vLinesofar;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvec2 e(vec2 f) {\n  vec2 h = mod(f, 1.);\n  vec2 i = vTexInfo.xy;\n  vec2 j = vTexInfo.zw;\n  return (i + h * j) / atlasSize;\n}\n#endif\n#include <heatmap_render_frag>\n#include <snow_frag>\n#include <mask_frag>\n#include <terrain_normal_frag>\n#include <vertex_color_frag>\n#include <excavate_frag>\n#ifdef HAS_RANDOM_TEX\nconst float k = .5;\nvec2 l(vec2 h, float m) {\n  return vec2(cos(m) * (h.x - k) + sin(m) * (h.y - k) + k, cos(m) * (h.y - k) - sin(m) * (h.x - k) + k);\n}\nfloat n(vec3 o) {\n  return o.x + o.y + o.z;\n}\n#endif\nvec4 u(sampler2D A, in vec2 h) {\n  \n#ifdef HAS_RANDOM_TEX\nhighp vec2 B = uvOrigin;\n  highp vec2 C = h + B;\n  float D = texture2D(noiseTexture, .005 * C).x;\n  vec2 E = dFdx(C);\n  vec2 F = dFdx(C);\n  float G = D * 8.;\n  float H = fract(G);\n#if 1\nfloat I = floor(G);\n  float J = I + 1.;\n#else\nfloat I = floor(G + .5);\n  float J = floor(G);\n  H = min(H, 1. - H) * 2.;\n#endif\nvec2 K = sin(vec2(3., 7.) * I);\n  vec2 L = sin(vec2(3., 7.) * J);\n  float M = .5;\n  vec4 N = texture2DGradEXT(A, h + M * K, E, F);\n  vec4 O = texture2DGradEXT(A, h + M * L, E, F);\n  return mix(N, O, smoothstep(.2, .8, H - .1 * n(N.xyz - O.xyz)));\n#else\nreturn texture2D(A, h);\n#endif\n}\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nuniform sampler2D bumpTexture;\nuniform float bumpScale;\nuniform float bumpMaxLayers;\nuniform float bumpMinLayers;\nvec2 P(vec2 h, vec3 Q) {\n  float R = mix(bumpMaxLayers, bumpMinLayers, abs(dot(vec3(.0, .0, 1.), Q)));\n  float S = 1. / R;\n  float T = .0;\n  vec2 U = Q.xy * bumpScale / (Q.z * R);\n  vec2 V = h;\n  float W = u(bumpTexture, V).r;\n  for(int X = 0; X < 30; X++) {\n    T += S;\n    V -= U;\n    W = u(bumpTexture, V).r;\n    if(W < T) {\n      break;\n    }\n  }\n  vec2 Y = V + U;\n  float Z = W - T;\n  float ba = u(bumpTexture, Y).r - T + S;\n  return mix(V, Y, Z / (Z - ba));\n}\nvarying vec3 vTangentViewPos;\nvarying vec3 vTangentFragPos;\n#endif\n#define SHADER_NAME PBR\nvec3 bb(const in vec3 bc) {\n  return vec3(bc.r < .0031308 ? bc.r * 12.92 : 1.055 * pow(bc.r, 1. / 2.4) - .055, bc.g < .0031308 ? bc.g * 12.92 : 1.055 * pow(bc.g, 1. / 2.4) - .055, bc.b < .0031308 ? bc.b * 12.92 : 1.055 * pow(bc.b, 1. / 2.4) - .055);\n}\nvec3 bd(const in vec3 bc) {\n  return vec3(bc.r < .04045 ? bc.r * (1. / 12.92) : pow((bc.r + .055) * (1. / 1.055), 2.4), bc.g < .04045 ? bc.g * (1. / 12.92) : pow((bc.g + .055) * (1. / 1.055), 2.4), bc.b < .04045 ? bc.b * (1. / 12.92) : pow((bc.b + .055) * (1. / 1.055), 2.4));\n}\nvec3 be(const in vec4 bc, const in float bf) {\n  if(bf <= .0)\n    return bc.rgb;\n  return bf * bc.rgb * bc.a;\n}\nvec3 bg() {\n  return d.albedo;\n}\nfloat bh() {\n  \n#if defined(HAS_ALPHAMODE)\nif(d.alpha >= alphaCutoff) {\n    return 1.;\n  } else {\n    return .0;\n  }\n#else\nreturn d.alpha;\n#endif\n}\nfloat bi() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 bc = d.specularColor;\n  return max(max(bc.r, bc.g), bc.b);\n#else\nreturn d.roughnessMetalness.y;\n#endif\n}\nfloat bj() {\n  return specularF0;\n}\nfloat bk() {\n  \n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nreturn 1. - d.glossiness;\n#else\nreturn d.roughnessMetalness.x;\n#endif\n}\nvec3 bl() {\n  return d.emit;\n}\nvec4 bm() {\n  return d.skinColor;\n}\nvec3 bn() {\n  return d.normal;\n}\nfloat bo() {\n  return clearCoatFactor;\n}\nfloat bp() {\n  return clearCoatRoughnessFactor;\n}\nfloat bq() {\n  return d.ao;\n}\nfloat br(const in vec4 bs) {\n  return bs.r + bs.g / 255.;\n}\nfloat bt(const in vec2 bu, const in float bv) {\n  vec3 bw = vec3(.06711056, .00583715, 52.9829189);\n  return fract(bw.z * fract(dot(bu.xy + bv * vec2(47., 17.) * .695, bw.xy))) * .5;\n}\nvec3 bx(const in float by, in vec3 bz, const in vec3 t, const in vec3 b, in vec3 bA) {\n  bz.xy = by * bz.xy;\n  mat3 bB = mat3(t, b, bA);\n  return normalize(bB * bz);\n}\nvoid bC(const in vec3 bD, const in vec3 bz, const in vec3 bE, out float bF, out vec3 bG, out float bH) {\n  bF = 1.;\n  bG = -bE;\n  bH = dot(bG, bz);\n}\nvec4 bI(const in vec3 bz, const in vec3 bD, const in float bJ) {\n  float bK = clamp(dot(bz, bD), 0., 1.);\n  float bL = bJ * bJ;\n  return vec4(bL, bL * bL, bK, bK * (1. - bL));\n}\nfloat bM(const vec4 bI, const float bN) {\n  float bO = bI.y;\n  float bP = (bN * bO - bN) * bN + 1.;\n  return bO / (3.141593 * bP * bP);\n}\nvec3 bQ(const vec3 bR, const float bS, const in float bT) {\n  float bU = pow(1. - bT, 5.);\n  return bS * bU + (1. - bU) * bR;\n}\nfloat bQ(const float bR, const float bS, const in float bT) {\n  return bR + (bS - bR) * pow(1. - bT, 5.);\n}\nfloat bV(const vec4 bI, const float bW) {\n  float a = bI.x;\n  float bX = bW * (bI.w + a);\n  float bY = bI.z * (bW * (1. - a) + a);\n  return .5 / (bX + bY);\n}\nvec3 bZ(const vec4 bI, const vec3 bz, const vec3 bD, const vec3 bG, const vec3 ca, const float bW, const float bS) {\n  vec3 cb = normalize(bD + bG);\n  float bN = clamp(dot(bz, cb), 0., 1.);\n  float bT = clamp(dot(bG, cb), 0., 1.);\n  float cc = bM(bI, bN);\n  float cd = bV(bI, bW);\n  vec3 ce = bQ(ca, bS, bT);\n  return (cc * cd * 3.141593) * ce;\n}\nvoid cf(const in vec3 bz, const in vec3 bD, const in float bW, const in vec4 bI, const in vec3 cg, const in vec3 ca, const in float bF, const in vec3 ch, const in vec3 bG, const in float bS, out vec3 ci, out vec3 cj, out bool ck) {\n  ck = bW > .0;\n  if(ck == false) {\n    cj = ci = vec3(.0);\n    return;\n  }\n  vec3 cl = bF * bW * ch;\n  cj = cl * bZ(bI, bz, bD, bG, ca, bW, bS);\n  ci = cl * cg;\n}\nfloat cm(float at, float ab, float cn, float co, float cp, float cq, float bK, float bW) {\n  float cr = bW * length(vec3(at * cn, ab * co, bK));\n  float cs = bK * length(vec3(at * cp, ab * cq, bW));\n  return .5 / (cr + cs);\n}\nfloat ct(const float at, const float ab, const float cu, const float cv, const float bN) {\n  float bO = at * ab;\n  vec3 bP = vec3(ab * cu, at * cv, bO * bN);\n  float x = bO / dot(bP, bP);\n  return bO * (x * x) / 3.141593;\n}\nvec3 cw(const vec4 bI, const vec3 bz, const vec3 bD, const vec3 bG, const vec3 ca, const float bW, const float bS, const in vec3 cx, const in vec3 cy, const in float cz) {\n  vec3 cb = normalize(bD + bG);\n  float bN = clamp(dot(bz, cb), 0., 1.);\n  float bK = clamp(dot(bz, bD), 0., 1.);\n  float bT = clamp(dot(bG, cb), 0., 1.);\n  float cn = dot(cx, bD);\n  float co = dot(cy, bD);\n  float cp = dot(cx, bG);\n  float cq = dot(cy, bG);\n  float cu = dot(cx, cb);\n  float cv = dot(cy, cb);\n  float cA = sqrt(1. - abs(cz) * .9);\n  if(cz > .0)\n    cA = 1. / cA;\n  float at = bI.x * cA;\n  float ab = bI.x / cA;\n  float cc = ct(at, ab, cu, cv, bN);\n  float cd = cm(at, ab, cn, co, cp, cq, bK, bW);\n  vec3 ce = bQ(ca, bS, bT);\n  return (cc * cd * 3.141593) * ce;\n}\nvoid cB(const in vec3 bz, const in vec3 bD, const in float bW, const in vec4 bI, const in vec3 cg, const in vec3 ca, const in float bF, const in vec3 ch, const in vec3 bG, const in float bS, const in vec3 cx, const in vec3 cy, const in float cz, out vec3 ci, out vec3 cj, out bool ck) {\n  ck = bW > .0;\n  if(ck == false) {\n    cj = ci = vec3(.0);\n    return;\n  }\n  vec3 cl = bF * bW * ch;\n  cj = cl * cw(bI, bz, bD, bG, ca, bW, bS, cx, cy, cz);\n  ci = cl * cg;\n}\n#if defined(HAS_IBL_LIGHTING)\nvec3 cC(const in vec3 bz) {\n  vec3 bA = uEnvironmentTransform * bz;\n  float x = bA.x;\n  float y = bA.y;\n  float z = bA.z;\n  vec3 cD = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    cD = hsv_apply(cD, hdrHSV);\n  }\n  return max(cD, vec3(.0));\n}\nfloat cE(const in float cF) {\n  return cF;\n}\nvec3 cG(const in float cH, const in vec3 cI) {\n  vec3 cJ = cI;\n  float cK = prefilterMiplevel.x;\n  float cL = min(cK, cE(cH) * prefilterMiplevel.y);\n  vec3 cM = be(textureCubeLod(prefilterMap, cJ, cL), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(cM, hdrHSV);\n  } else {\n    return cM;\n  }\n}\nvec3 cN(const in vec3 cO, const in vec3 cI, const in float cP) {\n  float cQ = 1. - cP;\n  float cR = cQ * (sqrt(cQ) + cP);\n  return mix(cO, cI, cR);\n}\nvec3 cS(const in vec3 bz, const in vec3 bD, const in float bJ, const in vec3 cT) {\n  vec3 cI = reflect(-bD, bz);\n  cI = cN(bz, cI, bJ);\n  vec3 cU = cG(bJ, uEnvironmentTransform * cI);\n  float by = clamp(1. + dot(cI, cT), .0, 1.);\n  cU *= by * by;\n  return cU;\n}\n#else\nvec3 cS(const in vec3 bz, const in vec3 bD, const in float bJ, const in vec3 cT) {\n  return ambientColor;\n}\n#endif\nvec3 cV(const in vec3 ca, const in float bJ, const in float bK, const in float bS) {\n  vec4 rgba = texture2D(brdfLUT, vec2(bK, bJ));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float cW = 1. / 65535.;\n  return (ca * a + b * bS) * cW;\n}\nvec3 cX(const in vec3 bz, const in vec3 bD, const in float bJ, const in vec3 ca, const in vec3 cT, const in float bS) {\n  float bK = dot(bz, bD);\n  return cS(bz, bD, bJ, cT) * cV(ca, bJ, bK, bS);\n}\nvec3 cY(const float bK, const float bW, const vec3 cZ, const float bP) {\n  return exp(cZ * -bP * ((bW + bK) / max(bW * bK, 1e-3)));\n}\nvec3 da(const in float bK, const in float bW, const in float db) {\n  return mix(vec3(1.), cY(bK, bW, clearCoatTint, clearCoatThickness), db);\n}\nvoid dc(const in float dd, const in vec3 bz, const in vec3 bD, const in float bH, const in vec4 bI, const in float bF, const in vec3 ch, const in vec3 bG, const in float db, out vec3 de, out vec3 df) {\n  if(bH <= .0) {\n    de = vec3(.0);\n    df = vec3(.0);\n    return;\n  }\n  float dg = clamp(dot(bz, -refract(bG, bz, 1. / clearCoatIor)), 0., 1.);\n  vec3 dh = da(dd, dg, db);\n  vec3 cb = normalize(bD + bG);\n  float bN = clamp(dot(bz, cb), 0., 1.);\n  float bT = clamp(dot(bG, cb), 0., 1.);\n  float cc = bM(bI, bN);\n  float cd = bV(bI, dg);\n  float ce = bQ(c, 1., bT);\n  de = (bF * bH * db * cc * cd * 3.141593 * ce) * ch;\n  df = (1. - ce * db) * dh;\n}\nfloat di(const in int dj, const in float dk, const in vec3 bz, const in vec3 bD) {\n  if(dj == 0)\n    return 1.;\n  float bP = dot(bz, bD) + dk;\n  return clamp(bP * bP - 1. + dk, .0, 1.);\n}\nvec3 dl(const in vec3 bz, const in vec3 bD, const in float bJ, const in vec3 cx, const in vec3 cy, const in float cz) {\n  vec3 dm = cz >= .0 ? cy : cx;\n  vec3 dn = cross(dm, bD);\n  vec3 dp = cross(dn, dm);\n  float dq = abs(cz) * clamp(5. * bJ, .0, 1.);\n  return normalize(mix(bz, dp, dq));\n}\nvoid dr() {\n  \n#ifdef HAS_MAP\nvec2 h = computeTexCoord(vTexCoord);\n#endif\n#ifdef HAS_UV_FLIP\nh.y = 1. - h.y;\n#endif\n#if defined(HAS_BUMP_MAP) && defined(HAS_TANGENT)\nh = P(h, normalize(vTangentViewPos - vTangentFragPos));\n#endif\nd.albedo = baseColorIntensity * baseColorFactor.rgb;\n  d.alpha = baseColorFactor.a * vOpacity;\n#if defined(HAS_PATTERN)\nfloat ds = vLinesofar;\n  vec2 j = vTexInfo.zw;\n#ifdef HAS_PATTERN_GAP\nfloat dt = vLinePatternGap;\n#else\nfloat dt = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat du = vLinePatternAnimSpeed;\n#else\nfloat du = linePatternAnimSpeed;\n#endif\nfloat dv = ceil(j.x * vPatternHeight / j.y);\n  float dw = dv * (1. + dt);\n  du /= animSpeedScale;\n  ds += mod(currentTime * -du * .2, dw);\n  float dx = mod(ds / dw, 1.);\n  float dy = mod(flipY * vNormalY, 1.);\n  vec2 h = e(vec2(dx * (1. + dt) * uvScale[0], dy * uvScale[1]));\n  vec4 dz = texture2D(linePatternFile, h);\n  float dA = clamp(sign(1. / (1. + dt) - dx) + .000001, .0, 1.);\n  dz = mix(linePatternGapColor, dz, dA);\n#ifdef IS_SQUARE_TUBE\nfloat o = clamp(sign(abs(vNormalY) - .999999), .0, 1.);\n  dz = mix(dz, vec4(1.), o);\n#endif\nd.albedo *= dz.rgb;\n  d.alpha *= dz.a;\n#endif\n#if defined(HAS_ALBEDO_MAP)\nvec4 dB = u(baseColorTexture, h);\n  d.albedo *= bd(dB.rgb);\n  d.alpha *= dB.a;\n#endif\n#if defined(HAS_SKIN_MAP)\nvec4 dC = u(skinTexture, h);\n  d.skinColor = dC;\n#endif\n#if defined(HAS_COLOR0)\nd.albedo *= vColor0.rgb;\n#if COLOR0_SIZE == 4\nd.alpha *= vColor0.a;\n#endif\n#endif\n#if defined(HAS_COLOR)\nd.albedo *= vColor.rgb;\n  d.alpha *= vColor.a;\n#elif defined(IS_LINE_EXTRUSION)\nd.albedo *= lineColor.rgb;\n  d.alpha *= lineColor.a;\n#else\nd.albedo *= polygonFill.rgb;\n  d.alpha *= polygonFill.a;\n#endif\n#if defined(HAS_INSTANCE_COLOR)\nd.albedo *= vInstanceColor.rgb;\n  d.alpha *= vInstanceColor.a;\n#endif\n#if defined(IS_LINE_EXTRUSION)\nd.alpha *= lineOpacity;\n#else\nd.alpha *= polygonOpacity;\n#endif\n#if defined(HAS_METALLICROUGHNESS_MAP)\nd.roughnessMetalness = u(metallicRoughnessTexture, h).gb * vec2(roughnessFactor, metallicFactor);\n#else\nd.roughnessMetalness = vec2(roughnessFactor, metallicFactor);\n#endif\nd.emit = emissiveFactor;\n#if defined(HAS_EMISSIVE_MAP)\nif(emitMultiplicative == 1) {\n    d.emit *= bd(u(emissiveTexture, h).rgb);\n  } else {\n    d.emit += bd(u(emissiveTexture, h).rgb);\n  }\n#endif\nd.emit *= emitColorFactor;\n#if defined(HAS_AO_MAP)\nvec2 dD = computeTexCoord(vTexCoord1);\n  d.ao = u(occlusionTexture, dD).r;\n#else\nd.ao = 1.;\n#endif\nd.ao *= occlusionFactor;\n#if defined(HAS_NORMAL_MAP) && defined(HAS_TANGENT)\nvec3 dE = u(normalTexture, h).xyz * 2. - 1.;\n  dE.y = normalMapFlipY == 1 ? -dE.y : dE.y;\n  d.normal = dE;\n#else\nd.normal = normalize(vModelNormal);\n#endif\n#if defined(HAS_TERRAIN_NORMAL) && defined(HAS_TANGENT)\nvec3 dE = convertTerrainHeightToNormalMap(h);\n  dE.y = normalMapFlipY == 1 ? -dE.y : dE.y;\n  d.normal = dE;\n#endif\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nd.albedo *= diffuseFactor.rgb;\n  d.alpha *= diffuseFactor.a;\n#if defined(HAS_DIFFUSE_MAP)\nvec4 cg = u(diffuseTexture, h);\n  d.albedo *= bd(cg.rgb);\n  d.alpha *= cg.a;\n#endif\nd.specularColor = specularFactor;\n  d.glossiness = glossinessFactor;\n#if defined(HAS_SPECULARGLOSSINESS_MAP)\nvec4 dF = u(specularGlossinessTexture, h);\n  d.specularColor *= bd(dF.rgb);\n  d.glossiness *= dF.a;\n#endif\n#endif\n}\nvec3 dG(const vec3 x) {\n  const float a = 2.51;\n  const float b = .03;\n  const float dH = 2.43;\n  const float bP = .59;\n  const float dI = .14;\n  return (x * (a * x + b)) / (x * (dH * x + bP) + dI);\n}\nvec3 dJ(vec3 bc) {\n  bc = dG(bc);\n  return bc = pow(bc, vec3(1. / 2.2));\n}\nuniform float specularAAVariance;\nuniform float specularAAThreshold;\nfloat dK(float bJ, const vec3 dL) {\n  \n#if defined(GL_OES_standard_derivatives) || __VERSION__ == 300\nvec3 dM = dFdx(dL);\n  vec3 dN = dFdy(dL);\n  float dO = specularAAVariance * (dot(dM, dM) + dot(dN, dN));\n  float dP = min(2. * dO, specularAAThreshold);\n  float dQ = saturate(bJ * bJ + dP);\n  return sqrt(dQ);\n#else\nreturn bJ;\n#endif\n}\n#ifdef HAS_SSR\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nvec3 dR(const in mat4 dS, const in vec3 dT) {\n  vec4 dU = dS * vec4(dT, 1.);\n  return vec3(.5 + .5 * dU.xy / dU.w, dU.w);\n}\nvec3 dV(const in float dW, const in vec2 h) {\n  return texture2D(TextureReflected, h).rgb;\n}\nfloat dX(float dY) {\n  highp mat4 dS = projMatrix;\n  highp float z = dY * 2. - 1.;\n  return -dS[3].z / (z + dS[2].z);\n}\nfloat dZ(const vec2 h) {\n  float dY = br(texture2D(TextureDepth, h));\n  return dY;\n}\nvec3 ea(const in float bv, const in vec3 eb, const in vec3 ec, const in vec3 ed, const in vec3 bD, const in float ee) {\n  vec2 ef;\n  ef.x = bt(gl_FragCoord.yx, bv);\n  ef.y = fract(ef.x * 52.9829189);\n  ef.y = mix(ef.y, 1., .7);\n  float eg = 2. * 3.14159 * ef.x;\n  float eh = pow(max(ef.y, .000001), ee / (2. - ee));\n  float ei = sqrt(1. - eh * eh);\n  vec3 ej = vec3(ei * cos(eg), ei * sin(eg), eh);\n  ej = ej.x * eb + ej.y * ec + ej.z * ed;\n  return normalize((2. * dot(bD, ej)) * ej - bD);\n}\nfloat ek(const in float bv) {\n  return (bt(gl_FragCoord.xy, bv) - .5);\n}\nvec3 el(const in vec3 em, const in float en, const in vec3 eo) {\n  vec3 ep = dR(projMatrix, vViewVertex.xyz + eo * en);\n  ep.z = 1. / ep.z;\n  ep -= em;\n  float eq = min(1., .99 * (1. - em.x) / max(1e-5, ep.x));\n  float er = min(1., .99 * (1. - em.y) / max(1e-5, ep.y));\n  float es = min(1., .99 * em.x / max(1e-5, -ep.x));\n  float et = min(1., .99 * em.y / max(1e-5, -ep.y));\n  return ep * min(eq, er) * min(es, et);\n}\nfloat eu(const in vec3 em, const in vec3 ep, inout float ev, inout float ew) {\n  float ex = (ew + ev) * .5;\n  vec3 ey = em + ep * ex;\n  float z = dZ(ey.xy);\n  float dY = dX(z);\n  float ez = -1. / ey.z;\n  ev = dY > ez ? ev : ex;\n  ew = dY > ez ? ex : ew;\n  return ex;\n}\nvec4 eA(const in vec3 em, const in float en, in float eB, const in vec3 eo, const in float bJ, const in float bv) {\n  int eC = 20;\n  float eD = 1. / float(eC);\n  eB *= eD;\n  vec3 ep = el(em, en, eo);\n  float eE = eD;\n  vec3 eF = vec3(.0, eE, 1.);\n  vec3 ey;\n  float z, dY, ez, eG, eH, eI;\n  bool eJ;\n  float eK = 1.;\n  float ex;\n  for(int X = 0; X < eC; X++) {\n    ey = em + ep * eF.y;\n    z = dZ(ey.xy);\n    dY = dX(z);\n    ez = -1. / ey.z;\n    float eL = clamp(sign(.999 - z), .0, 1.);\n    eG = eL * (ez - dY);\n    eG *= clamp(sign(abs(eG) - en * eD * eD), .0, 1.);\n    eJ = abs(eG + eB) < eB;\n    eH = clamp(eF.x / (eF.x - eG), .0, 1.);\n    eI = eJ ? eF.y + eH * eD - eD : 1.;\n    eF.z = min(eF.z, eI);\n    eF.x = eG;\n    if(eJ) {\n      float ev = eF.y - eD;\n      float ew = eF.y;\n      ex = eu(em, ep, ev, ew);\n      ex = eu(em, ep, ev, ew);\n      ex = eu(em, ep, ev, ew);\n      eK = ex;\n      break;\n    }\n    eF.y += eD;\n  }\n  return vec4(em + ep * eK, 1. - eK);\n}\nvec4 eM(in vec4 eN, const in float eO, const in vec3 eP, const in vec3 eQ, const in float bJ) {\n  vec4 eR = mix(outputFovInfo[0], outputFovInfo[1], eN.x);\n  eN.xyz = vec3(mix(eR.xy, eR.zw, eN.y), 1.) * -1. / eN.z;\n  eN.xyz = (reprojViewProjMatrix * vec4(eN.xyz, 1.)).xyw;\n  eN.xy /= eN.z;\n  float eS = clamp(6. - 6. * max(abs(eN.x), abs(eN.y)), .0, 1.);\n  eN.xy = .5 + .5 * eN.xy;\n  vec3 eT = eQ * dV(bJ * (1. - eN.w), eN.xy);\n  return vec4(mix(eP, eT, eO * eS), 1.);\n}\nvec3 ssr(const in vec3 eP, const in vec3 eQ, const in float bJ, const in vec3 bz, const in vec3 bD) {\n  float eU = .0;\n  vec4 cD = vec4(.0);\n  float ee = bJ * bJ;\n  ee = ee * ee;\n  vec3 eV = abs(bz.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 eb = normalize(cross(eV, bz));\n  vec3 ec = cross(bz, eb);\n  float eO = ssrFactor * clamp(-4. * dot(bD, bz) + 3.8, .0, 1.);\n  eO *= clamp(4.7 - bJ * 5., .0, 1.);\n  vec3 em = dR(projMatrix, vViewVertex.xyz);\n  em.z = 1. / em.z;\n  vec3 eo = ea(eU, eb, ec, bz, bD, ee);\n  float en = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, eo.z * .5 + .5);\n  float eB = .5 * en;\n  vec4 eN;\n  if(dot(eo, bz) > .001 && eO > .0) {\n    eN = eA(em, en, eB, eo, bJ, eU);\n    if(eN.w > .0)\n      cD += eM(eN, eO, eP, eQ, bJ);\n    \n  }\n  return cD.w > .0 ? cD.rgb / cD.w : eP;\n}\n#endif\n#include <highlight_frag>\nvoid main() {\n  dr();\n  vec3 bD = normalize(cameraPosition - vModelVertex.xyz);\n#if defined(HAS_DOUBLE_SIDE)\nvec3 cT = gl_FrontFacing ? normalize(vModelNormal) : -normalize(vModelNormal);\n#else\nvec3 cT = normalize(vModelNormal);\n#endif\n#if defined(HAS_TANGENT)\nvec4 eW;\n  eW = vModelTangent;\n#if defined(HAS_DOUBLE_SIDE)\neW.xyz = gl_FrontFacing ? normalize(eW.xyz) : -normalize(eW.xyz);\n#else\neW.xyz = normalize(eW.xyz);\n#endif\nvec3 eX = normalize(vModelBiTangent);\n#endif\nfloat bR = .08 * bj();\n  float eY = bi();\n  vec3 eZ = bg();\n#if defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\nvec3 fa = d.specularColor;\n#else\nvec3 fa = mix(vec3(bR), eZ, eY);\n#endif\neZ *= 1. - eY;\n  float fb = clamp(50.0 * fa.g, .0, 1.);\n  float fc = bk();\n  if(specularAAVariance > .0) {\n    fc = dK(fc, cT);\n  }\n  vec3 fd = bl();\n  vec3 fe = bn();\n  vec3 ff = vec3(fe);\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nff = bx(normalMapFactor, ff, eW.xyz, eX, cT);\n#endif\nfloat fg = bo();\n  float fh = bp();\n  if(specularAAVariance > .0) {\n    fh = dK(fh, cT);\n  }\n  vec3 fi = cT;\n#if defined(HAS_TANGENT)\nfloat cz;\n  vec3 cx;\n  vec3 cy;\n  if(anisotropyFactor > .0) {\n    cz = anisotropyFactor;\n    eW.xyz = normalize(eW.xyz - ff * dot(eW.xyz, ff));\n    eX = normalize(cross(ff, eW.xyz)) * eW.w;\n    cx = normalize(mix(eW.xyz, eX, anisotropyDirection));\n    cy = normalize(mix(eX, -eW.xyz, anisotropyDirection));\n  }\n#endif\nvec3 cg = vec3(.0);\n  vec3 ca = vec3(.0);\n  vec3 fj;\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    fj = dl(ff, bD, fc, cx, cy, cz);\n  } else {\n    fj = ff;\n  }\n#else\nfj = ff;\n#endif\n#if defined(HAS_IBL_LIGHTING)\ncg = eZ * cC(ff) * .5;\n#else\ncg = eZ * ambientColor;\n#endif\nca = cX(fj, bD, fc, fa, cT, fb);\n  float dd;\n  if(clearCoatFactor > .0) {\n    dd = clamp(dot(fi, -refract(bD, fi, 1. / clearCoatIor)), 0., 1.);\n    float fk = fg * bQ(c, 1., dd);\n    vec3 fl = da(dd, dd, fg);\n    ca = mix(ca * fl, cS(fi, bD, fh, cT), fk);\n    cg *= fl * (1. - fk);\n  }\n  float fm = 1.;\n  float fn = bq();\n  cg *= environmentExposure * fn;\n#ifdef HAS_IBL_LIGHTING\nfm = di(1, fn, ff, bD);\n#endif\n#ifdef HAS_SSR\nvec3 fo = normalize(gl_FrontFacing ? vViewNormal : -vViewNormal);\n  vec3 fp = fo;\n#if defined(HAS_TANGENT) && (defined(HAS_NORMAL_MAP) || defined(HAS_TERRAIN_NORMAL))\nvec4 fq;\n  fq = vViewTangent;\n  fq = gl_FrontFacing ? fq : -fq;\n  fq.xyz = normalize(fq.xyz);\n  vec3 fr = normalize(cross(fo, fq.xyz)) * fq.w;\n  fp = bx(normalMapFactor, fe, fq.xyz, fr, fo);\n#endif\nca = ssr(ca, fa * fm, fc, fp, -normalize(vViewVertex.xyz));\n#endif\nca *= environmentExposure * fm;\n  float bF, bH;\n  vec3 bG;\n  bool ck;\n  vec3 fs;\n  vec3 ft;\n  vec4 fu = bI(ff, bD, max(.045, fc));\n  vec3 fv = vModelNormal;\n  bC(bD, ff, light0_viewDirection, bF, bG, bH);\n#if defined(HAS_TANGENT)\nif(anisotropyFactor > .0) {\n    cB(ff, bD, bH, fu, eZ, fa, bF, light0_diffuse.rgb, bG, fb, cx, cy, cz, ft, fs, ck);\n  } else {\n    cf(ff, bD, bH, fu, eZ, fa, bF, light0_diffuse.rgb, bG, fb, ft, fs, ck);\n  }\n#else\ncf(ff, bD, bH, fu, eZ, fa, bF, light0_diffuse.rgb, bG, fb, ft, fs, ck);\n#endif\nif(clearCoatFactor > .0) {\n    vec3 fw;\n    vec3 fx;\n    vec4 fy = bI(fi, bD, fh);\n    dc(dd, fi, bD, dot(fi, bG), fy, bF, light0_diffuse.rgb, bG, fg, fw, fx);\n    ft *= fx;\n    fs = fw + fs * fx;\n  }\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat fz = shadow_computeShadow();\n  ft = shadow_blend(ft, fz).rgb;\n  fs = shadow_blend(fs, fz).rgb;\n#endif\nvec3 fA = vec3(ca);\n  vec3 fB = vec3(cg);\n  cg += ft;\n  ca += fs;\n  cg += fd;\n  vec3 fC = ca + cg;\n  if(outputSRGB == 1)\n    fC = bb(fC);\n  \n#ifdef HAS_SKIN_MAP\nvec4 fD = bm();\n  fC.rgb = fC.rgb * (1. - fD.a) + fD.rgb * fD.a;\n#endif\nfloat fE = bh();\n  glFragColor = vec4(fC * fE, fE);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n#ifdef HAS_VERTEX_COLOR\nglFragColor *= vertexColor_get();\n#endif\n#ifdef HAS_EXCAVATE_ANALYSIS\nglFragColor = excavateColor(glFragColor);\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_SNOW\nglFragColor.rgb = snow(glFragColor, bn(), 1.);\n#endif\nif(contrast != 1.) {\n    glFragColor = contrastMatrix(contrast) * glFragColor;\n  }\n  if(length(hsv) > .0) {\n    glFragColor = hsv_apply(glFragColor, hsv);\n  }\n#ifdef OUTPUT_NORMAL\nglFragColor = vec4(cT, 1.);\n#endif\nglFragColor = highlight_blendColor(glFragColor);\n#ifdef HAS_LAYER_OPACITY\nglFragColor *= layerOpacity;\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:d,extraCommandProps:t,defines:o}),this.version=300}getGeometryDefines(e){const n={};return e.data[e.desc.tangentAttribute]?n.HAS_TANGENT=1:e.data[e.desc.normalAttribute]&&(n.HAS_NORMAL=1),e.data[e.desc.colorAttribute]&&(n.HAS_COLOR=1),e.data[e.desc.color0Attribute]&&(n.HAS_COLOR0=1,n.COLOR0_SIZE=e.getColor0Size()),n}},StandardDepthShader:class extends vn$4{constructor(e={}){const t=[];super({vert:"#define SHADER_NAME depth_vert\nprecision highp float;\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projMatrix;\nuniform vec2 outSize;\nuniform vec2 halton;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n#ifdef IS_LINE_EXTRUSION\nvec4 d = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 d = getPosition(aPosition);\n#endif\nvec4 e = modelViewMatrix * c * d;\n  mat4 f = projMatrix;\n  f[2].xy += halton.xy / outSize.xy;\n  gl_Position = f * e;\n}",frag:"#define SHADER_NAME depth_frag\nprecision highp float;\nvoid main() {\n  gl_FragColor = vec4(1., .0, .0, 1.);\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,r)=>multiply$5(t,r.viewMatrix,r.modelMatrix)}],extraCommandProps:e.extraCommandProps,defines:e.defines})}},PBRUtils:lr$4};var l$1=Object.freeze({__proto__:null,AbstractTexture:z$6,BloomPass:Un$4,BoundingBox:X$7,BoxBlurShader:class extends Mn$4{constructor({blurOffset:e}){super({vert:An$4,frag:"precision highp float;\nvarying vec2 vTexCoord;\nuniform sampler2D textureSource;\nuniform vec2 resolution;\nuniform float ignoreTransparent;\nvoid main() {\n  vec4 c = vec4(.0);\n  float d = .0;\n  for(int x = -BOXBLUR_OFFSET; x <= BOXBLUR_OFFSET; ++x)\n    for(int y = -BOXBLUR_OFFSET; y <= BOXBLUR_OFFSET; ++y) {\n      vec2 e = vTexCoord.st + vec2(float(x) / resolution.x, float(y) / resolution.y);\n      e = clamp(e, .0, 1.);\n      vec4 f = texture2D(textureSource, e);\n      float h;\n      if(ignoreTransparent == 1.) {\n        h = sign(f.a);\n      } else {\n        h = 1.;\n      }\n      d += h;\n      c += h * f;\n    }\n  gl_FragColor = c / max(d, 1.) * clamp(sign(d - 1.), .0, 1.);\n}",defines:{BOXBLUR_OFFSET:e||2},extraCommandProps:{viewport:{x:0,y:0,width:(e,n)=>n.resolution[0],height:(e,n)=>n.resolution[1]}}}),this._blurOffset=e||2}getMeshCommand(e,n){const t="box_blur_"+this._blurOffset;return this.commands[t]||(this.commands[t]=this.createREGLCommand(e,null,n.getElements())),this.commands[t]}},Constants:L$6,CopyShader:Zn$4,DeferredRenderer:class extends B$6{},EdgeGeometry:Te$5,EdgeShader:Qn$4,ExtentPass:mt$6,FBORayPicking:Cr$4,FogPass:rt$6,FogShader:it$5,FxaaShader:Cn$4,GLTFHelper:Dt$6,GLTFManager:Bt$6,Geometry:Q$7,HDR:li$4,HeatmapDisplayShader:Yn$4,HeatmapShader:Xn$4,InstancedMesh:Ge$5,Jitter:Bn$4,KHRTechniquesWebglManager:Nr$4,Material:Ce$5,Mesh:Be$5,MeshShader:vn$4,PhongMaterial:Ie$5,PhongShader:bn$4,PhongSpecularGlossinessMaterial:Le$5,Plane:tn$5,PointLineShader:class extends vn$4{constructor(e={}){const t=[];super({vert:"attribute vec3 aPosition;\n#ifdef HAS_COLOR0\nattribute vec4 aColor0;\nvarying vec4 vColor;\n#endif\nuniform mat4 modelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float pointSize;\n#if defined(HAS_MAP)\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#endif\n#include <get_output>\n#include <heatmap_render_vert>\n#ifdef HAS_FLOODANALYSE\nvarying float vHeight;\n#endif\nvoid main() {\n  vec4 c = getPosition(aPosition);\n  mat4 d = getPositionMatrix();\n  gl_PointSize = pointSize;\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = projViewModelMatrix * d * c;\n#endif\n#ifdef HAS_COLOR0\nvColor = aColor0 / 255.;\n#endif\n#ifdef HAS_MAP\nvTexCoord = aTexCoord;\n#endif\n#ifdef HAS_HEATMAP\nheatmap_compute(projMatrix * modelViewMatrix * d, c);\n#endif\n}",frag:"precision mediump float;\n#include <gl2_frag>\n#if defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#include <heatmap_render_frag>\nuniform vec4 baseColorFactor;\n#if defined(HAS_MAP)\n#if defined(HAS_ALBEDO_MAP)\nuniform sampler2D baseColorTexture;\n#endif\n#if defined(HAS_DIFFUSE_MAP)\nuniform sampler2D diffuseTexture;\n#endif\nvarying vec2 vTexCoord;\n#endif\n#include <mask_frag>\nvoid main() {\n  \n#ifdef HAS_COLOR0\nglFragColor = vColor * baseColorFactor;\n#else\nglFragColor = vec4(1.) * baseColorFactor;\n#endif\n#ifdef HAS_MAP\n#ifdef HAS_ALBEDO_MAP\nglFragColor *= texture2D(baseColorTexture, vTexCoord);\n#endif\n#ifdef HAS_DIFFUSE_MAP\nglFragColor *= texture2D(diffuseTexture, vTexCoord);\n#endif\n#endif\n#ifdef HAS_HEATMAP\nglFragColor = heatmap_getColor(glFragColor);\n#endif\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(e,r)=>multiply$5(t,r.projViewMatrix,r.modelMatrix)}],defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},PostProcessShader:Rn$4,QuadShader:Mn$4,REGLHelper:_e$5,RainRipplesPass:dt$6,Renderer:B$6,ResourceLoader:Ve$5,Scene:Ke$5,Shader:hn$5,ShaderLib:on$5,ShadowDisplayShader:vr$4,ShadowMapShader:fr$4,ShadowPass:mr$4,SkyboxShader:qn$4,SsaoPass:Dn$4,SsrPass:jn$4,StandardLiteMaterial:Ne$5,StandardLiteShader:class extends vn$4{constructor(e={}){const t=[],r=e.uniforms,o=[{name:"viewMatrixInverse",type:"function",fn:(e,t)=>invert$2($n$4,t.viewMatrix)},{name:"modelViewMatrix",type:"function",fn:function(e,r){return multiply$5(t,r.viewMatrix,r.modelMatrix)}},{name:"uEnvironmentTransform",type:"function",fn:(e,n)=>fromRotation$2(et$6,Math.PI*(n.environmentOrientation||0)/180)}];r&&o.push(...r),super({vert:"precision mediump float;\n#include <gl2_vert>\nattribute vec3 aPosition;\n#include <line_extrusion_vert>\n#ifdef HAS_MAP\nuniform vec2 uvScale;\nuniform vec2 uvOffset;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\n#ifdef HAS_I3S_UVREGION\nattribute vec4 uvRegion;\nvarying vec4 vUvRegion;\n#endif\n#endif\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nattribute vec3 aColor0;\n#else\nattribute vec4 aColor0;\n#endif\nvarying vec4 vColor;\n#endif\nuniform mat4 projMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 positionMatrix;\nuniform vec2 halton;\nuniform vec2 outSize;\nuniform mat4 projViewMatrix;\n#include <get_output>\n#include <heatmap_render_vert>\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\nvarying vec3 vViewPosition;\nvoid main() {\n  \n#ifdef IS_LINE_EXTRUSION\nvec4 c = getPosition(getLineExtrudePosition(aPosition));\n#else\nvec4 c = getPosition(aPosition);\n#endif\nmat4 d = getPositionMatrix();\n  mat4 e = projMatrix;\n  e[2].xy += halton.xy / outSize.xy;\n#ifdef HAS_MASK_EXTENT\ngl_Position = e * getMaskPosition(d * c, modelMatrix);\n#else\ngl_Position = e * modelViewMatrix * d * c;\n#endif\nvec4 f = modelViewMatrix * d * c;\n  vViewPosition = -f.xyz;\n#ifdef HAS_MAP\nvec2 h = decode_getTexcoord(aTexCoord);\n  vTexCoord = h * uvScale + uvOffset;\n#endif\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#elif defined(HAS_COLOR0)\n#if COLOR0_SIZE == 3\nvColor = vec4(aColor0 / 255., 1.);\n#else\nvColor = aColor0 / 255.;\n#endif\n#endif\n}",frag:"#if __VERSION__ == 100\n#if defined(GL_EXT_shader_texture_lod)\n#extension GL_EXT_shader_texture_lod : enable\n#define textureCubeLod(tex, uv, lod) textureCubeLodEXT(tex, uv, lod)\n#else\n#define textureCubeLod(tex, uv, lod) textureCube(tex, uv, lod)\n#endif\n#if defined(GL_OES_standard_derivatives)\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define textureCubeLod(tex, uv, lod) textureLod(tex, uv, lod)\n#endif\n#define saturate(x)        clamp(x, 0.0, 1.0)\nprecision mediump float;\n#include <gl2_frag>\n#include <hsv_frag>\nuniform vec3 hsv;\n#define GET_BASEMAP(UV) (texture2D(baseColorTexture, (UV)))\nuniform mat4 viewMatrix;\nuniform mat4 projMatrix;\nuniform vec3 cameraPosition;\n#if defined(HAS_IBL_LIGHTING)\nuniform mat4 viewMatrixInverse;\n#endif\nuniform vec4 baseColorFactor;\nuniform vec3 emissiveFactor;\nuniform vec3 specularFactor;\nuniform float opacity;\nuniform float envRotationSin;\nuniform float envRotationCos;\nuniform float rgbmRange;\n#if defined(HAS_MAP)\n#include <computeTexcoord_frag>\n#endif\n#ifdef HAS_BASECOLOR_MAP\nuniform sampler2D baseColorTexture;\n#endif\n#ifdef HAS_NORMAL_MAP\nuniform sampler2D normalTexture;\nvec3 c(vec3 d, vec3 e) {\n  vec3 f = dFdx(d.xyz);\n  vec3 h = dFdy(d.xyz);\n  vec3 i = normalize(f - h);\n  vec3 j = normalize(-f + h);\n  vec3 k = normalize(e);\n  vec3 l = texture2D(normalTexture, computeTexCoord(vTexCoord)).rgb * 2. - 1.;\n  mat3 m = mat3(i, j, k);\n  return normalize(m * l);\n}\n#endif\n#ifdef HAS_EMISSIVE_MAP\nuniform sampler2D emissiveTexture;\n#endif\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\nuniform vec4 diffuseFactor;\n#ifdef HAS_DIFFUSE_MAP\nuniform sampler2D diffuseTexture;\n#endif\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nuniform sampler2D specularGlossinessTexture;\n#endif\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\nvarying vec4 vColor;\n#endif\n#ifdef GAMMA_INPUT\nvec3 n(vec3 o) {\n  return o * o;\n}\nfloat n(float o) {\n  return o * o;\n}\n#else\nvec3 n(vec3 o) {\n  return o;\n}\nfloat n(float o) {\n  return o;\n}\n#endif\nvec3 u() {\n  \n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n#ifdef HAS_SPECULARGLOSSINESS_MAP\nreturn texture2D(specularGlossinessTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn specularFactor;\n#endif\n#else\nreturn specularFactor;\n#endif\n}\nvec3 v() {\n  \n#ifdef HAS_EMISSIVE_MAP\nreturn texture2D(emissiveTexture, computeTexCoord(vTexCoord)).rgb;\n#else\nreturn emissiveFactor;\n#endif\n}\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT > 0\nuniform float exposureBias;\nfloat A(vec3 rgb) {\n  return dot(rgb, vec3(.299, .587, .114));\n}\nfloat B(vec3 rgb) {\n  return dot(rgb, vec3(.212671, .715160, .072169));\n}\nvec3 C(vec3 xyz) {\n  vec3 D = vec3(3.240479, -1.53715, -.498535);\n  vec3 E = vec3(-.969256, 1.875992, .041556);\n  vec3 F = vec3(.055648, -.204043, 1.057311);\n  vec3 rgb;\n  rgb.b = dot(xyz, F);\n  rgb.g = dot(xyz, E);\n  rgb.r = dot(xyz, D);\n  return rgb;\n}\nvec3 H(vec3 rgb) {\n  vec3 I = vec3(.412453, .35758, .180423);\n  vec3 J = vec3(.212671, .71516, .0721688);\n  vec3 K = vec3(.0193338, .119194, .950227);\n  vec3 xyz;\n  xyz.x = dot(rgb, I);\n  xyz.y = dot(rgb, J);\n  xyz.z = dot(rgb, K);\n  return xyz;\n}\nvec3 L(vec3 xyz) {\n  float M = xyz.x + xyz.y + xyz.z;\n  M = 1. / M;\n  vec3 O;\n  O.z = xyz.y;\n  O.x = xyz.x * M;\n  O.y = xyz.y * M;\n  return O;\n}\nvec3 P(vec3 O) {\n  float x = O.x;\n  float y = O.y;\n  float J = O.z;\n  vec3 xyz;\n  xyz.y = J;\n  xyz.x = x * (J / y);\n  xyz.z = (1. - x - y) * (J / y);\n  return xyz;\n}\nfloat Q(float x) {\n  float U = pow(x, 1.60525727);\n  float V = ((1.05542877 * 4.68037409) * U) / (4.68037409 * U + 1.);\n  return clamp(V, .0, 1.);\n}\nconst float W = 1. / .18;\nfloat ba(float x) {\n  x *= W;\n  const float bb = .2;\n  const float F = .34;\n  const float bc = .002;\n  const float bd = 1.68;\n  const float be = .0005;\n  const float bf = .252;\n  const float bg = 1. / .833837;\n  return ((x * (bb * x + bc * F) + bd * be) / (x * (bb * x + F) + bd * bf) - be / bf) * bg;\n}\nvec3 bh(vec3 x) {\n  x *= W;\n  const float bb = .27;\n  const float F = .29;\n  const float bc = .052;\n  const float bd = .2;\n  const float bf = .18;\n  const float bg = 1. / .897105;\n  return ((x * (bb * x + bc * F)) / (x * (bb * x + F) + bd * bf)) * bg;\n}\nvec3 bi(vec3 x) {\n  vec3 bj = x.rgb;\n  bj = min(bj, vec3(3.));\n  float bk = B(bj);\n  if(bk > .0) {\n    float bl = Q(bk);\n    bj = bj * (bl / bk);\n    bj = clamp(bj, vec3(.0), vec3(1.));\n  }\n  float bm = 1. / 2.2;\n  bj = pow(bj, vec3(bm));\n  return bj;\n}\n#endif\n#endif\n#if defined(IRR_RGBM) || defined(ENV_RGBM) || defined(ENV_GAMMA) || defined(IRR_GAMMA)\nuniform float envMapExposure;\n#endif\nuniform vec4 themingColor;\nuniform mat3 uEnvironmentTransform;\nvec3 bn(vec3 bo, vec3 bp) {\n  \n#if defined(HAS_SHADOWMAP)\nfloat bq = dot(shadowLightDir, bp);\n  float br = (bq + 1.) / 2.;\n  br = min(1., br * 1.5);\n  float bs = 1.;\n  vec3 bt = bo * min(bs, br);\n  return bt;\n#else\nreturn bo;\n#endif\n}\n#ifdef HAS_IBL_LIGHTING\nuniform float reflectivity;\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform vec3 diffuseSPH[9];\nuniform vec2 prefilterMiplevel;\nuniform vec2 prefilterSize;\n#else\nuniform vec3 ambientColor;\n#endif\n#if defined(HAS_IBL_LIGHTING)\nvec3 bu(const in vec3 bv) {\n  vec3 bw = uEnvironmentTransform * bv;\n  float x = bw.x;\n  float y = bw.y;\n  float z = bw.z;\n  vec3 bt = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    bt = hsv_apply(bt, hdrHSV);\n  }\n  return max(bt, vec3(.0));\n}\nvec3 bx(const in vec4 by, const in float bz) {\n  if(bz <= .0)\n    return by.rgb;\n  return bz * by.rgb * by.a;\n}\nfloat bA(const in float bB) {\n  return bB;\n}\nvec3 bC(const in float bD, const in vec3 D) {\n  vec3 bE = D;\n  float bF = prefilterMiplevel.x;\n  float bG = min(bF, bA(bD) * prefilterMiplevel.y);\n  vec3 bH = bx(textureCubeLod(prefilterMap, bE, bG), rgbmRange);\n  if(length(hdrHSV) > .0) {\n    return hsv_apply(bH, hdrHSV);\n  } else {\n    return bH;\n  }\n}\nvec3 bI(const in vec3 k, const in vec3 D, const in float bJ) {\n  float bK = 1. - bJ;\n  float bL = bK * (sqrt(bK) + bJ);\n  return mix(k, D, bL);\n}\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  vec3 D = reflect(-bN, bv);\n  D = bI(bv, D, bO);\n  vec3 bQ = bC(bO, uEnvironmentTransform * D);\n  float bR = clamp(1. + dot(D, bP), .0, 1.);\n  bQ *= bR * bR;\n  return bQ;\n}\n#else\nvec3 bM(const in vec3 bv, const in vec3 bN, const in float bO, const in vec3 bP) {\n  return ambientColor;\n}\n#endif\nvarying highp vec3 vViewPosition;\nvec3 bS(vec3 bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nfloat bW(float bT, float bU) {\n  float bV = max(1. - bU, .0);\n  return bT + (1. - bT) * pow(bV, 5.);\n}\nvec3 bX(const in vec3 by) {\n  return vec3(by.r < .0031308 ? by.r * 12.92 : 1.055 * pow(by.r, 1. / 2.4) - .055, by.g < .0031308 ? by.g * 12.92 : 1.055 * pow(by.g, 1. / 2.4) - .055, by.b < .0031308 ? by.b * 12.92 : 1.055 * pow(by.b, 1. / 2.4) - .055);\n}\nvoid main() {\n  glFragColor = vec4(vec3(1.), opacity);\n#ifdef HAS_BASECOLOR_MAP\nvec4 bY = GET_BASEMAP(computeTexCoord(vTexCoord));\n#ifdef GAMMA_INPUT\nbY.xyz *= bY.xyz;\n#endif\nglFragColor = glFragColor * bY;\n#endif\n#ifdef ALPHATEST\nif(glFragColor.a < ALPHATEST)\n    discard;\n  \n#endif\nfloat bZ = 1.;\n  vec3 ca = dFdx(vViewPosition);\n  vec3 cb = dFdy(vViewPosition);\n  vec3 bv = normalize(cross(ca, cb));\n  vec3 cc;\n  if(projMatrix[3][3] == .0) {\n    cc = normalize(vViewPosition);\n  } else {\n    cc = vec3(.0, .0, 1.);\n  }\n  bv = faceforward(bv, -cc, bv);\n  vec3 cd = bv;\n#ifdef HAS_NORMAL_MAP\nbv = c(-vViewPosition, bv);\n#endif\nvec3 ce = vec3(.0);\n  vec3 cf = vec3(.0);\n#ifdef HAS_IBL_LIGHTING\nvec3 bp = mat3(viewMatrixInverse) * bv;\n  vec3 cg = glFragColor.rgb * bu(bp) * .5;\n  cg = bn(cg, bp);\n  ce += n(baseColorFactor.rgb) * cg;\n#endif\nvec3 ch = v();\n#ifdef METAL\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb) + cf);\n#else\nglFragColor.xyz = glFragColor.xyz * (n(ch) + ce + n(baseColorFactor.rgb)) + cf;\n#endif\nvec3 ci;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat cj = shadow_computeShadow();\n  ci = shadow_blend(ci, cj).rgb;\n#endif\n#ifdef HAS_COLOR\nglFragColor = glFragColor * vColor;\n#endif\nglFragColor.rgb += ci;\n  glFragColor.rgb = bX(glFragColor.rgb);\n#if defined(HAS_IBL_LIGHTING)\nvec3 ck;\n#if defined(HAS_NORMAL_MAP)\n#ifdef ENVMAP_MODE_REFLECTION\nck = reflect(-cc, bv);\n#else\nck = refract(-cc, bv, 1.);\n#endif\n#else\nck = reflect(-cc, bv);\n#endif\nck = mat3(viewMatrixInverse) * ck;\n  float cl = 1.;\n  vec3 cm;\n#ifdef HAS_IBL_LIGHTING\ncm = vec3(.0);\n#elif\ncm = ambientColor;\n#endif\ncm *= cl;\n  float bV = dot(cc, bv);\n  if(bV < -1e-2 || reflectivity == .0)\n    bV = 1.;\n  else\n    bV = max(1e-6, bV);\n  vec3 cn;\n  vec3 co = u();\n#ifdef METAL\ncn = n(co);\n#else\ncn = bS(n(co), bV) * (1. - envRotationSin);\n  glFragColor.a = mix(glFragColor.a, bW(glFragColor.a, bV), reflectivity) * envRotationCos;\n  float cp = pow(1. - bV * .5, 5.);\n  float cq = (28. / 23.) * (1. - cp) * (1. - cp);\n  glFragColor.rgb *= cq * (1. - n(co));\n#endif\nglFragColor.rgb += cm.rgb * bZ * cn.rgb;\n#endif\n#if defined(TONEMAP_OUTPUT)\n#if TONEMAP_OUTPUT == 1\nglFragColor.rgb = bi(exposureBias * glFragColor.rgb);\n#elif TONEMAP_OUTPUT == 2\nglFragColor.rgb = bh(exposureBias * glFragColor.rgb);\n#endif\n#endif\nglFragColor.rgb = mix(glFragColor.rgb, themingColor.rgb, themingColor.a);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:o,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}}),this.version=300}},TaaPass:Hn$4,Texture2D:en$5,TextureCube:class extends z$6{onLoad(e){const n=this.config;if(!n)return;const t=this._createFaces(e);n.faces=t.map((e=>e.data)),this._updateREGL()}createREGLTexture(e){return e.cube(this.config)}_createFaces(){return[]}},ToonMaterial:class extends Ie$5{constructor(e){super(e,we$5)}},ToonShader:class extends bn$4{constructor(e={}){super({vert:xn$4,frag:gn$4,defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},Util:N$6,WaterShader:class extends vn$4{constructor(e={}){super({vert:"precision highp float;\nprecision highp sampler2D;\nconst float c = 3.141592653589793;\nuniform mat4 projMatrix;\nuniform mat4 viewMatrix;\nuniform mat4 modelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nattribute vec3 aNormal;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nvec4 d(mat4 e, mat4 f, vec3 h) {\n  return e * modelMatrix * f * vec4(h, 1.);\n}\nvec3 i(in vec3 h, in vec3 j) {\n  return normalize(h + j);\n}\nmat3 k(in vec3 l) {\n  vec3 t = normalize(cross(vec3(.0, .0, 1.), l));\n  vec3 b = normalize(cross(l, t));\n  return mat3(t, b, l);\n}\nvoid m() {\n  \n}\nvoid main(void) {\n  vuv = aTexCoord;\n  vpos = (modelMatrix * vec4(aPosition, 1.)).xyz;\n  vnormal = aNormal;\n  vtbnMatrix = k(vnormal);\n  gl_Position = d(projMatrix, viewMatrix, vpos);\n  m();\n}",frag:"precision highp float;\nprecision highp sampler2D;\nuniform sampler2D texWaveNormal;\nuniform sampler2D texWavePerturbation;\nuniform vec3 octaveTextureRepeat;\nuniform vec4 waveParams;\nuniform vec2 waveDirection;\nuniform vec4 waterColor;\nuniform vec3 lightingDirection;\nuniform vec3 lightingIntensity;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vuv;\nvarying vec3 vpos;\nvarying vec3 vnormal;\nvarying mat3 vtbnMatrix;\nconst vec2 c = vec2(6. / 25., 5. / 24.);\nvec2 d(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rg - 1.;\n}\nfloat h(vec2 f) {\n  return texture2D(texWavePerturbation, f).b;\n}\nvec3 i(sampler2D e, vec2 f) {\n  return 2. * texture2D(e, f).rgb - 1.;\n}\nfloat j(vec2 f, float k) {\n  return fract(k);\n}\nfloat l(vec2 f, float k) {\n  float m = j(f, k);\n  return 1. - abs(1. - 2. * m);\n}\nvec3 n(sampler2D o, vec2 f, float k, float u) {\n  float v = waveParams[2];\n  float A = waveParams[3];\n  vec2 B = d(o, f) * v;\n  float m = j(f, k + u);\n  float C = l(f, k + u);\n  vec2 D = f;\n  D -= B * (m + A);\n  D += u;\n  D += (k - m) * c;\n  return vec3(D, C);\n}\nconst float E = .3737;\nconst float F = 7.77;\nvec3 G(sampler2D H, sampler2D I, vec2 f, vec2 J, float k) {\n  float K = waveParams[0];\n  vec2 L = k * -J;\n  float M = h(f * E) * F;\n  vec3 N = n(I, f + L, k + M, .0);\n  vec3 O = n(I, f + L, k + M, .5);\n  vec3 P = i(H, N.xy) * N.z;\n  vec3 Q = i(H, O.xy) * O.z;\n  vec3 R = normalize(P + Q);\n  R.xy *= K;\n  R.z = sqrt(1. - dot(R.xy, R.xy));\n  return R;\n}\nvec3 S(vec2 f, float k) {\n  float T = waveParams[1];\n  return G(texWaveNormal, texWavePerturbation, f * T, waveDirection, k);\n}\nconst float U = 3.141592653589793;\nconst float V = 1. / U;\nconst float W = .3183098861837907;\nconst float X = 1.570796326794897;\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nfloat Y = 2.2;\nvec3 Z(float ba, vec3 bb, float bc) {\n  return bb + (bc - bb) * pow(1. - ba, 5.);\n}\nfloat bd(float be, float bf) {\n  float bg = bf * bf;\n  float bh = be * be;\n  float bi = pow((bh * (bg - 1.) + 1.), Y) * U;\n  return bg / bi;\n}\nfloat bj(float bk) {\n  return .25 / (bk * bk);\n}\nvec3 bl(in PBRShadingWater bm, float bf, vec3 bn, float bo) {\n  vec3 bp = Z(bm.VdotH, bn, bo);\n  float bq = bd(bm.NdotH, bf);\n  float br = bj(bm.LdotH);\n  return (bq * br) * bp;\n}\nvec3 bs(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float bt = 2.2;\nconst float bu = .4545454545;\nvec4 bv(vec4 bw) {\n  return vec4(pow(bw.rgb, vec3(bu)), bw.w);\n}\nvec3 bx(vec3 bw) {\n  return pow(bw, vec3(bt));\n}\nconst vec3 by = vec3(.02, 1., 5.);\nconst vec2 bz = vec2(.02, .1);\nconst float bf = .06;\nconst vec3 bA = vec3(0, .6, .9);\nconst vec3 bB = vec3(.72, .92, 1.);\nPBRShadingWater bC;\nvec3 bD(in float bE, in vec3 bF, in vec3 bG) {\n  float bH = pow((1. - bE), by[2]);\n  return mix(bG, bF, bH);\n}\nvec3 bI(in vec3 bJ, in vec3 bK, in vec3 bL, vec3 bw, in vec3 bM, in vec3 bN, in float bO) {\n  vec3 bP = bx(bw);\n  vec3 bQ = normalize(bL + bK);\n  bC.NdotL = clamp(dot(bJ, bL), .0, 1.);\n  bC.NdotV = clamp(dot(bJ, bK), .001, 1.);\n  bC.VdotN = clamp(dot(bK, bJ), .001, 1.);\n  bC.NdotH = clamp(dot(bJ, bQ), .0, 1.);\n  bC.VdotH = clamp(dot(bK, bQ), .0, 1.);\n  bC.LdotH = clamp(dot(bL, bQ), .0, 1.);\n  float bR = max(dot(bN, bK), .0);\n  vec3 bS = bx(bB);\n  vec3 bT = bx(bA);\n  vec3 bB = bD(bR, bS, bT);\n  float bU = max(dot(bN, bL), .0);\n  bB *= .1 + bU * .9;\n  float bV = clamp(bO, .8, 1.);\n  vec3 bW = Z(bC.VdotN, vec3(by[0]), by[1]) * bB * bV;\n  vec3 bX = bP * mix(bB, bU * bM * V, 2. / 3.) * bV;\n  vec3 bY = vec3(.0);\n  if(bR > .0 && bU > .0) {\n    vec3 bZ = bl(bC, bf, vec3(bz[0]), bz[1]);\n    vec3 ca = bM * V * bO;\n    bY = bC.NdotL * ca * bZ;\n  }\n  return bs(bW + bX + bY);\n}\nvoid main() {\n  vec3 bN = vnormal;\n  vec3 cb = S(vuv, timeElapsed);\n  vec3 bJ = normalize(vtbnMatrix * cb);\n  vec3 bK = -normalize(vpos - camPos);\n  vec3 bL = normalize(-lightingDirection);\n  float bO = 1.;\n  vec4 cc = vec4(bI(bJ, bK, bL, waterColor.rgb, lightingIntensity, bN, bO), waterColor.w);\n  gl_FragColor = bv(cc);\n}",defines:e.defines||{},extraCommandProps:e.extraCommandProps||{}})}},WireFrameMaterial:class extends Ce$5{constructor(e){super(e,Oe$5)}},WireframeShader:class extends vn$4{constructor(e={}){let t=e.extraCommandProps||{};const r=[];t=v$3({},t,{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},sample:{alpha:!0}}),super({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec3 aBarycentric;\nvarying vec3 vBarycentric;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projMatrix;\nuniform mat4 positionMatrix;\nvarying vec3 vPosition;\n#include <get_output>\nvoid main() {\n  mat4 c = getPositionMatrix();\n  vec4 d = getPosition(aPosition);\n#ifdef HAS_MASK_EXTENT\ngl_Position = projMatrix * getMaskPosition(c * d, modelMatrix);\n#else\ngl_Position = projMatrix * modelViewMatrix * c * d;\n#endif\nvBarycentric = aBarycentric;\n  vPosition = aPosition;\n}",frag:"#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives : enable\n#endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec3 vBarycentric;\nuniform float time;\nuniform float thickness;\nuniform float secondThickness;\nuniform float dashRepeats;\nuniform float dashLength;\nuniform bool dashOverlap;\nuniform bool dashEnabled;\nuniform bool dashAnimate;\nuniform bool seeThrough;\nuniform bool insideAltColor;\nuniform bool dualStroke;\nuniform bool squeeze;\nuniform float squeezeMin;\nuniform float squeezeMax;\nuniform vec4 stroke;\nuniform vec4 fill;\nuniform float opacity;\nuniform bool noiseEnable;\nvarying vec3 vPosition;\n#ifdef HAS_INSTANCE\nvarying vec4 vInstanceColor;\n#endif\n#include <mask_frag>\n#define F4 0.309016994374947451\n#define halfDist 0.5\nvec4 c(vec4 x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nfloat c(float x) {\n  return x - floor(x * (1. / 289.)) * 289.;\n}\nvec4 d(vec4 x) {\n  return c((x * 34. + 1.) * x);\n}\nfloat d(float x) {\n  return c((x * 34. + 1.) * x);\n}\nvec4 e(vec4 r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nfloat e(float r) {\n  return 1.79284291400159 - .85373472095314 * r;\n}\nvec4 f(float h, vec4 i) {\n  const vec4 k = vec4(1., 1., 1., -1.);\n  vec4 p, s;\n  p.xyz = floor(fract(vec3(h) * i.xyz) * 7.) * i.z - 1.;\n  p.w = 1.5 - dot(abs(p.xyz), k.xyz);\n  s = vec4(lessThan(p, vec4(.0)));\n  p.xyz = p.xyz + (s.xyz * 2. - 1.) * s.www;\n  return p;\n}\nfloat l(vec4 m) {\n  const vec4 n = vec4(.138196601125011, .276393202250021, .414589803375032, -.447213595499958);\n  vec4 o = floor(m + dot(m, vec4(F4)));\n  vec4 u = m - o + dot(o, n.xxxx);\n  vec4 A;\n  vec3 B = step(u.yzw, u.xxx);\n  vec3 D = step(u.zww, u.yyz);\n  A.x = B.x + B.y + B.z;\n  A.yzw = 1. - B;\n  A.y += D.x + D.y;\n  A.zw += 1. - D.xy;\n  A.z += D.z;\n  A.w += 1. - D.z;\n  vec4 E = clamp(A, .0, 1.);\n  vec4 F = clamp(A - 1., .0, 1.);\n  vec4 G = clamp(A - 2., .0, 1.);\n  vec4 H = u - G + n.xxxx;\n  vec4 I = u - F + n.yyyy;\n  vec4 J = u - E + n.zzzz;\n  vec4 K = u + n.wwww;\n  o = c(o);\n  float L = d(d(d(d(o.w) + o.z) + o.y) + o.x);\n  vec4 M = d(d(d(d(o.w + vec4(G.w, F.w, E.w, 1.)) + o.z + vec4(G.z, F.z, E.z, 1.)) + o.y + vec4(G.y, F.y, E.y, 1.)) + o.x + vec4(G.x, F.x, E.x, 1.));\n  vec4 i = vec4(1. / 294., 1. / 49., 1. / 7., .0);\n  vec4 N = f(L, i);\n  vec4 O = f(M.x, i);\n  vec4 P = f(M.y, i);\n  vec4 Q = f(M.z, i);\n  vec4 R = f(M.w, i);\n  vec4 S = e(vec4(dot(N, N), dot(O, O), dot(P, P), dot(Q, Q)));\n  N *= S.x;\n  O *= S.y;\n  P *= S.z;\n  Q *= S.w;\n  R *= e(dot(R, R));\n  vec3 T = max(.6 - vec3(dot(u, u), dot(H, H), dot(I, I)), .0);\n  vec2 U = max(.6 - vec2(dot(J, J), dot(K, K)), .0);\n  T = T * T;\n  U = U * U;\n  return 49. * (dot(T * T, vec3(dot(N, u), dot(O, H), dot(P, I))) + dot(U * U, vec2(dot(Q, J), dot(R, K))));\n}\nconst float V = 3.14159265359;\nfloat W(float X, float Y) {\n  float Z = fwidth(Y) * halfDist;\n  return smoothstep(X - Z, X + Z, Y);\n}\nvec4 ba(vec3 bb) {\n  float bc = min(min(bb.x, bb.y), bb.z);\n  float bd = .0;\n  if(noiseEnable)\n    bd += l(vec4(vPosition.xyz * 80.0, time * halfDist)) * .12;\n  bc += bd;\n  float be = max(bb.x, bb.y);\n  if(bb.y < bb.x && bb.y < bb.z) {\n    be = 1. - be;\n  }\n  float bf = thickness;\n  if(squeeze) {\n    bf *= mix(squeezeMin, squeezeMax, (1. - sin(be * V)));\n  }\n  if(dashEnabled) {\n    float bg = 1. / dashRepeats * dashLength / 2.;\n    if(!dashOverlap) {\n      bg += 1. / dashRepeats / 2.;\n    }\n    if(dashAnimate) {\n      bg += time * .22;\n    }\n    float bh = fract((be + bg) * dashRepeats);\n    bf *= 1. - W(dashLength, bh);\n  }\n  float bi = 1. - W(bf, bc);\n#ifdef HAS_INSTANCE\nvec4 bj = vInstanceColor;\n#else\nvec4 bj = stroke;\n#endif\nvec4 bk = vec4(.0);\n  if(seeThrough) {\n    bk = vec4(bj.xyz, bi);\n    if(insideAltColor && !gl_FrontFacing) {\n      bk.rgb = fill.xyz;\n    }\n  } else {\n    vec3 bl = mix(fill.xyz, bj.xyz, bi);\n    bk.a = fill.a;\n    if(dualStroke) {\n      float bm = 1. - W(secondThickness, bc);\n      vec3 bn = mix(fill.xyz, stroke.xyz, abs(bm - bi));\n      bk.rgb = bn;\n    } else {\n      bk.rgb = bl;\n    }\n  }\n  return bk;\n}\nvoid main() {\n  glFragColor = ba(vBarycentric);\n  glFragColor *= halfDist + opacity;\n#ifdef HAS_MASK_EXTENT\nglFragColor = setMask(glFragColor);\n#endif\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:(e,t)=>multiply$5(r,t.viewMatrix,t.modelMatrix)}],extraCommandProps:t}),this.version=300}},earcut:ci$4,pbr:fi$4}),isArray=Array.isArray,keyList=Object.keys,hasProp=Object.prototype.hasOwnProperty,fastDeepEqual=function equal(a,b){if(a===b)return!0;if(a&&b&&"object"==typeof a&&"object"==typeof b){var i,length,key,arrA=isArray(a),arrB=isArray(b);if(arrA&&arrB){if((length=a.length)!=b.length)return!1;for(i=length;0!=i--;)if(!equal(a[i],b[i]))return!1;return!0}if(arrA!=arrB)return!1;var dateA=a instanceof Date,dateB=b instanceof Date;if(dateA!=dateB)return!1;if(dateA&&dateB)return a.getTime()==b.getTime();var regexpA=a instanceof RegExp,regexpB=b instanceof RegExp;if(regexpA!=regexpB)return!1;if(regexpA&&regexpB)return a.toString()==b.toString();var keys=keyList(a);if((length=keys.length)!==keyList(b).length)return!1;for(i=length;0!=i--;)if(!hasProp.call(b,keys[i]))return!1;for(i=length;0!=i--;)if(!equal(a[key=keys[i]],b[key]))return!1;return!0}return a!=a&&b!=b};
/*!
	 * @maptalks/fusiongl v0.6.9
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.com
	 */
function i$2(t){for(let i=1;i<arguments.length;i++){const r=arguments[i];for(const i in r)t[i]=r[i]}return t}function r$1(t,...r){for(let e=0;e<r.length;e++)i$2(t,r[e])}class e$2{constructor(t){this.context=t,this.COLOR_ATTACHMENT0_WEBGL=36064,this.COLOR_ATTACHMENT1_WEBGL=36065,this.COLOR_ATTACHMENT2_WEBGL=36066,this.COLOR_ATTACHMENT3_WEBGL=36067,this.COLOR_ATTACHMENT4_WEBGL=36068,this.COLOR_ATTACHMENT5_WEBGL=36069,this.COLOR_ATTACHMENT6_WEBGL=36070,this.COLOR_ATTACHMENT7_WEBGL=36071,this.COLOR_ATTACHMENT8_WEBGL=36072,this.COLOR_ATTACHMENT9_WEBGL=36073,this.COLOR_ATTACHMENT10_WEBGL=577040,this.COLOR_ATTACHMENT11_WEBGL=577041,this.COLOR_ATTACHMENT12_WEBGL=577042,this.COLOR_ATTACHMENT13_WEBGL=577043,this.COLOR_ATTACHMENT14_WEBGL=577044,this.COLOR_ATTACHMENT15_WEBGL=577045,this.DRAW_BUFFER0_WEBGL=34853,this.DRAW_BUFFER1_WEBGL=34854,this.DRAW_BUFFER2_WEBGL=34855,this.DRAW_BUFFER3_WEBGL=34856,this.DRAW_BUFFER4_WEBGL=34857,this.DRAW_BUFFER5_WEBGL=34858,this.DRAW_BUFFER6_WEBGL=34859,this.DRAW_BUFFER7_WEBGL=34860,this.DRAW_BUFFER8_WEBGL=34861,this.DRAW_BUFFER9_WEBGL=34862,this.DRAW_BUFFER10_WEBGL=34863,this.DRAW_BUFFER11_WEBGL=34864,this.DRAW_BUFFER12_WEBGL=34865,this.DRAW_BUFFER13_WEBGL=34866,this.DRAW_BUFFER14_WEBGL=34867,this.DRAW_BUFFER15_WEBGL=34868,this.MAX_COLOR_ATTACHMENTS_WEBGL=36063,this.MAX_DRAW_BUFFERS_WEBGL=2178}drawBuffersWEBGL(){return this.context.drawBuffers.apply(this.context,arguments)}}class s{constructor(t){this.context=t,this.VERTEX_ARRAY_BINDING_OES=34229}createVertexArrayOES(){return this.context.createVertexArray()}deleteVertexArrayOES(){return this.context.deleteVertexArray.apply(this.context,arguments)}isVertexArrayOES(){return this.context.isVertexArray.apply(this.context,arguments)}bindVertexArrayOES(){return this.context.bindVertexArray.apply(this.context,arguments)}}class h$1{constructor(t){this.context=t,this.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070}drawArraysInstancedANGLE(){return this.context.drawArraysInstanced.apply(this.context,arguments)}drawElementsInstancedANGLE(){return this.context.drawElementsInstanced.apply(this.context,arguments)}vertexAttribDivisorANGLE(){return this.context.vertexAttribDivisor.apply(this.context,arguments)}}const n={webgl_depth_texture:{UNSIGNED_INT_24_8_WEBGL:34042},oes_element_index_uint:{},oes_texture_float:{},oes_texture_half_float:{HALF_FLOAT_OES:36193},ext_color_buffer_float:{},oes_standard_derivatives:{},ext_frag_depth:{},ext_blend_minmax:{MIN_EXT:32775,MAX_EXT:32776},ext_shader_texture_lod:{}},u$2={has(t,i){const r=t.t;return!(!r&&!t.i.getExtension(i))&&(i=i.toLowerCase(),r&&n[i]||"webgl_draw_buffers"===i||"oes_vertex_array_object"===i||"angle_instanced_arrays"===i)},mock:(t,i)=>(i=i.toLowerCase(),n[i]?t.t?("oes_texture_float"!==i&&"oes_texture_half_float"!==i||t.i.getExtension("EXT_color_buffer_float"),n[i]):t.i.getExtension(i):"webgl_draw_buffers"===i?new e$2(t):"oes_vertex_array_object"===i?new s(t):"angle_instanced_arrays"===i?new h$1(t):null),getInternalFormat:(t,i,r)=>6402===i?33190:34041===i?35056:36193===r&&i===t.RGBA?34842:36193===r&&i===t.RGB?34843:r===t.FLOAT&&i===t.RGBA?34836:r===t.FLOAT&&i===t.RGB?34837:i,getTextureType:(t,i)=>36193===i?t.HALF_FLOAT:i};let o=1;class a{constructor(t){this.uid=o++,this.states=function(t){return{scissor:[0,0,t.canvas.width,t.canvas.height],viewport:[0,0,t.canvas.width,t.canvas.height],blendColor:[0,0,0,0],blendEquationSeparate:[t.FUNC_ADD,t.FUNC_ADD],blendFuncSeparate:[t.ONE,t.ZERO,t.ONE,t.ZERO],clearColor:[0,0,0,0],clearDepth:[1],clearStencil:[0],colorMask:[!0,!0,!0,!0],cullFace:[t.BACK],depthFunc:[t.LESS],depthMask:[!0],depthRange:[0,1],capabilities:{3042:!1,2884:!1,2929:!1,3024:!1,32823:!1,32926:!1,32928:!1,3089:!1,2960:!1},frontFace:[t.CCW],hint:{33170:[t.DONT_CARE],35723:[t.DONT_CARE]},lineWidth:[1],pixelStorei:{3333:[4],3317:[4],37440:[!1],37441:[!1],37443:[t.BROWSER_DEFAULT_WEBGL]},polygonOffset:[0,0],sampleCoverage:[1,!1],stencilFuncSeparate:{1028:[t.ALWAYS,0,4294967295],1029:[t.ALWAYS,0,4294967295]},stencilMaskSeparate:{1028:[4294967295],1029:[4294967295]},stencilOpSeparate:{1028:[t.KEEP,t.KEEP,t.KEEP],1029:[t.KEEP,t.KEEP,t.KEEP]},program:null,framebuffer:{36160:null,36008:null,36009:null},renderbuffer:{36161:null},textures:{active:-1,units:function(){const i=[],r=t.getParameter(t.MAX_COMBINED_TEXTURE_IMAGE_UNITS);for(let t=0;t<r;t++)i.push({3553:null,34067:null});return i[-1]={3553:null,34067:null},i}()},attributes:{},arrayBuffer:null,elementArrayBuffer:null}}(t),this.i=t,this.i._fusiongl_drawCalls=0,this.t="undefined"!=typeof WebGL2RenderingContext&&this.i instanceof WebGL2RenderingContext;const i=Object.getPrototypeOf(this);Object.setPrototypeOf(i,this.t?WebGL2RenderingContext.prototype:WebGLRenderingContext.prototype),this.s=t.getParameter(t.MAX_VERTEX_ATTRIBS)}get canvas(){return this.i.canvas}get drawingBufferWidth(){return this.i.drawingBufferWidth}get drawingBufferHeight(){return this.i.drawingBufferHeight}get gl(){return this.i}get buffersOES(){return this.h||(this.h=this.i.getExtension("WEBGL_draw_buffers")),this.h}get vaoOES(){return this.u||(this.u=this.i.getExtension("OES_vertex_array_object")),this.u}get angleOES(){return this.o||(this.o=this.i.getExtension("ANGLE_instanced_arrays")),this.o}get standOES(){return this.l||(this.l=this.i.getExtension("OES_standard_derivatives")),this.l}attachShader(t,i){return this.i.attachShader(t,i)}shaderSource(t,i){return this.i.shaderSource(t,i)}compileShader(t){return this.i.compileShader(t)}createShader(t){return this.i.createShader(t)}createProgram(){return this.i.createProgram()}deleteProgram(t){return this.states.program===t&&(this.states.program=null),this.i.deleteProgram(t)}deleteShader(t){return this.i.deleteShader(t)}detachShader(t,i){return this.i.detachShader(t,i)}getAttachedShaders(t){return this.i.getAttachedShaders(t)}linkProgram(t){return this.i.linkProgram(t)}makeXRCompatible(){return this.i.makeXRCompatible()}getShaderParameter(t,i){return this.i.getShaderParameter(t,i)}getShaderPrecisionFormat(t,i){return this.i.getShaderPrecisionFormat(t,i)}getShaderInfoLog(t){return this.i.getShaderInfoLog(t)}getShaderSource(t){return this.i.getShaderSource(t)}getProgramInfoLog(t){return this.i.getProgramInfoLog(t)}getProgramParameter(t,i){return this.i.getProgramParameter(t,i)}getError(){return this.i.getError()}getContextAttributes(){return this.i.getContextAttributes()}getExtension(t){return u$2.has(this,t)?u$2.mock(this,t):this.i.getExtension(t)}getSupportedExtensions(){return this.i.getSupportedExtensions()}getParameter(t){return this.i.getParameter(t)}isEnabled(t){return this.i.isEnabled(t)}isProgram(t){return this.i.isProgram(t)}isShader(t){return this.i.isShader(t)}validateProgram(t){return this.i.validateProgram(t)}clear(t){return this.m(),this.i.clear(t)}drawArrays(t,i,r){return this.m(),this.states.activeAttribType=0,this.g(),this.i.drawArrays(t,i,r)}drawElements(t,i,r,e){return this.m(),this.states.activeAttribType=0,this.g(),this.i.drawElements(t,i,r,e)}drawBuffers(t){return this.m(),this.states.activeAttribType=0,this.g(),this.t?this.i.drawBuffers(t):this.buffersOES.drawBuffersWEBGL(t)}g(){this.i._fusiongl_drawCalls++}resetDrawCalls(){this.i._fusiongl_drawCalls=0}getDrawCalls(){return this.i._fusiongl_drawCalls}v(){const t=this.i,i=t.getParameter(t.CURRENT_PROGRAM),r=t.getProgramParameter(i,t.ACTIVE_ATTRIBUTES),e=[];for(let i=0;i<r;i++)e.push(t.getVertexAttrib(i,t.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING));this._={buffers:e,elements:t.getParameter(t.ELEMENT_ARRAY_BUFFER_BINDING),framebuffer:t.getParameter(t.FRAMEBUFFER_BINDING)},window.DEBUGGING&&(console.log(this.uid,this._),console.log(this.uid,this.states.attributes),console.log(this.states.attributes[0].buffer===this._.buffers[0]),console.log(this.states.attributes[1].buffer===this._.buffers[1]),console.log(this.states.attributes[2].buffer===this._.buffers[2]))}finish(){return this.i.finish()}flush(){return this.m(),this.i.flush()}commit(){return this.m(),this.i.commit()}isContextLost(){return this.i.isContextLost()}getFragDataLocation(t,i){return this.i.getFragDataLocation(t,i)}createSampler(){return this.i.createSampler()}deleteSampler(){return this.i.deleteSampler()}bindSampler(){return this.i.bindSampler()}isSampler(){return this.i.isSampler()}getSamplerParameter(){return this.i.getSamplerParameter()}isQuery(t){return this.i.beginQuery(t)}beginQuery(t,i){return this.i.beginQuery(t,i)}deleteQuery(t){return this.i.query(t)}isTransformFeedback(t){return this.i.isTransformFeedback(t)}beginTransformFeedback(t){return this.i.beginTransformFeedback(t)}deleteTransformFeedback(t){return this.i.deleteTransformFeedback(t)}pauseTransformFeedback(){return this.i.pauseTransformFeedback()}resumeTransformFeedback(){return this.i.resumeTransformFeedback()}transformFeedbackVaryings(t,i,r){return this.i.transformFeedbackVaryings(t,i,r)}bindBufferBase(t,i,r){return this.i.bbindBufferBase(t,i,r)}bindBufferRange(t,i,r,e,s){return this.i.bindBufferRange(t,i,r,e,s)}bindTransformFeedback(t,i){return this.i.bindTransformFeedback(t,i)}fenceSync(t,i){return this.i.fenceSync(t,i)}isSync(t){return this.i.isSync(t)}deleteSync(t){return this.i.deleteSync(t)}clientWaitSync(t,i,r){return this.i.clientWaitSync(t,i,r)}waitSync(t,i,r){return this.i.waitSync(t,i,r)}getSyncParameter(t,i){return this.i.getSyncParameter(t,i)}getIndexedParameter(t,i){return this.i.getIndexedParameter(t,i)}}function f$2(t,i){const r=i.length;for(let e=0;e<r;e++)t[e]=i[e];return t}r$1(a.prototype,{bufferData(...t){return this.m(),this.i.bufferData(...t)},bufferSubData(...t){return this.m(),this.i.bufferSubData(...t)},createBuffer(){return this.i.createBuffer()},deleteBuffer(t){const i=this.states;i.arrayBuffer===t?i.arrayBuffer=null:i.elementArrayBuffer===t&&(i.elementArrayBuffer=null);const r=i.attributes;for(const i in r)r[i].buffer===t&&(r[i].buffer=null);return this.i.deleteBuffer(t)},getBufferParameter(t,i){return this.m(),this.i.getBufferParameter(t,i)},isBuffer(t){return this.i.isBuffer(t)},copyBufferSubData(t,i,r,e,s){return this.i.isBuffer(t,i,r,e,s)},readBuffer(t){return this.i.readBuffer(t)}}),r$1(a.prototype,{checkFramebufferStatus(t){return this.i.checkFramebufferStatus(t)},createFramebuffer(){return this.i.createFramebuffer()},deleteFramebuffer(t){const i=this.states.framebuffer;for(const r in i)i[r]===t&&(i[r]=null);return this.i.deleteFramebuffer(t)},framebufferRenderbuffer(t,i,r,e){return this.m(),this.i.framebufferRenderbuffer(t,i,r,e)},framebufferTexture2D(t,i,r,e,s){return this.m(),this.i.framebufferTexture2D(t,i,r,e,s)},getFramebufferAttachmentParameter(t,i,r){return this.m(),this.i.getFramebufferAttachmentParameter(t,i,r)},isFramebuffer(t){return this.i.isFramebuffer(t)},readPixels(t,i,r,e,s,h,n){return this.m(),this.i.readPixels(t,i,r,e,s,h,n)},blitFramebuffer(t,i,r,e,s,h,n,u,o,a){return this.m(),this.i.blitFramebuffer(t,i,r,e,s,h,n,u,o,a)}}),r$1(a.prototype,{createRenderbuffer(){return this.i.createRenderbuffer()},deleteRenderbuffer(t){const i=this.states.renderbuffer;for(const r in i)i[r]===t&&(i[r]=null);return this.i.deleteRenderbuffer(t)},getRenderbufferParameter(t,i){return this.m(),this.i.getRenderbufferParameter(t,i)},isRenderbuffer(t){return this.i.isRenderbuffer(t)},renderbufferStorage(t,i,r,e){return this.m(),this.i.renderbufferStorage(t,i,r,e)},renderbufferStorageMultisample(t,i,r,e,s){return this.m(),this.i.renderbufferStorageMultisample(t,i,r,e,s)}}),r$1(a.prototype,{scissor(t,i,r,e){this.m();const s=this.states.scissor;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.scissor(t,i,r,e))},viewport(t,i,r,e){this.m();const s=this.states.viewport;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.viewport(t,i,r,e))},blendColor(t,i,r,e){this.m();const s=this.states.blendColor;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.blendColor(t,i,r,e))},blendEquation(t){this.m();const i=this.states.blendEquationSeparate;i[0]===t&&i[1]===t||(i[0]=t,i[1]=t,this.i.blendEquation(t))},blendEquationSeparate(t,i){this.m();const r=this.states.blendEquationSeparate;r[0]===t&&r[1]===i||(r[0]=t,r[1]=i,this.i.blendEquationSeparate(t,i))},blendFunc(t,i){this.m();const r=this.states.blendFuncSeparate;r[0]===t&&r[2]===t&&r[1]===i&&r[3]===i||(r[0]=t,r[1]=i,r[2]=t,r[3]=i,this.i.blendFunc(t,i))},blendFuncSeparate(t,i,r,e){this.m();const s=this.states.blendFuncSeparate;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.blendFuncSeparate(t,i,r,e))},clearColor(t,i,r,e){this.m();const s=this.states.clearColor;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.clearColor(t,i,r,e))},clearDepth(t){this.m();const i=this.states.clearDepth;i[0]!==t&&(i[0]=t,this.i.clearDepth(t))},clearStencil(t){this.m();const i=this.states.clearStencil;i[0]!==t&&(i[0]=t,this.i.clearStencil(t))},colorMask(t,i,r,e){this.m();const s=this.states.colorMask;s[0]===t&&s[1]===i&&s[2]===r&&s[3]===e||(s[0]=t,s[1]=i,s[2]=r,s[3]=e,this.i.colorMask(t,i,r,e))},cullFace(t){this.m();const i=this.states.cullFace;i[0]!==t&&(i[0]=t,this.i.cullFace(t))},depthFunc(t){this.m();const i=this.states.depthFunc;i[0]!==t&&(i[0]=t,this.i.depthFunc(t))},depthMask(t){this.m();const i=this.states.depthMask;i[0]!==t&&(i[0]=t,this.i.depthMask(t))},depthRange(t,i){this.m();const r=this.states.depthRange;r[0]===t&&r[1]===i||(r[0]=t,r[1]=i,this.i.depthRange(t,i))},disable(t){this.m();const i=this.states.capabilities;i[t]&&(i[t]=!1,this.i.disable(t))},enable(t){this.m();const i=this.states.capabilities;i[t]||(i[t]=!0,this.i.enable(t))},frontFace(t){this.m();const i=this.states.frontFace;i[0]!==t&&(i[0]=t,this.i.frontFace(t))},hint(t,i){this.m();const r=this.states.hint;r[t][0]!==i&&(r[t][0]=i,this.i.hint(t,i))},lineWidth(t){this.m();const i=this.states.lineWidth;i[0]!==t&&(i[0]=t,this.i.lineWidth(t))},pixelStorei(t,i){this.m();const r=this.states.pixelStorei;r[t]!==i&&(r[t]&&(r[t][0]=i),this.i.pixelStorei(t,i))},polygonOffset(t,i){this.m();const r=this.states.polygonOffset;r[0]===t&&r[1]===i||(r[0]=t,r[1]=i,this.i.polygonOffset(t,i))},sampleCoverage(t,i){this.m();const r=this.states.sampleCoverage;r[0]===t&&r[1]===i||(r[0]=t,r[1]=i,this.i.sampleCoverage(t,i))},stencilFunc(t,i,r){this.m();const e=this.states.stencilFuncSeparate,s=this.i;e[s.FRONT][0]===t&&e[s.FRONT][1]===i&&e[s.FRONT][2]===r&&e[s.BACK][0]===t&&e[s.BACK][1]===i&&e[s.BACK][2]===r||(e[s.FRONT][0]=e[s.BACK][0]=t,e[s.FRONT][1]=e[s.BACK][1]=i,e[s.FRONT][2]=e[s.BACK][2]=r,this.i.stencilFunc(t,i,r))},stencilFuncSeparate(t,i,r,e){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilFunc(i,r,e);const s=this.states.stencilFuncSeparate;s[t][0]===i&&s[t][1]===r&&s[t][2]===e||(s[t][0]=i,s[t][1]=r,s[t][2]=e,this.i.stencilFuncSeparate(t,i,r,e))},stencilMask(t){this.m();const i=this.i,r=this.states.stencilMaskSeparate;r[i.FRONT][0]===t&&r[i.BACK][0]===t||(r[i.FRONT][0]=t,r[i.BACK][0]=t,this.i.stencilMask(t))},stencilMaskSeparate(t,i){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilMask(i);const r=this.states.stencilMaskSeparate;r[t][0]!==i&&(r[t][0]=i,this.i.stencilMaskSeparate(t,i))},stencilOp(t,i,r){this.m();const e=this.states.stencilOpSeparate,s=this.i;e[s.FRONT][0]===t&&e[s.FRONT][1]===i&&e[s.FRONT][2]===r&&e[s.BACK][0]===t&&e[s.BACK][1]===i&&e[s.BACK][2]===r||(e[s.FRONT][0]=e[s.BACK][0]=t,e[s.FRONT][1]=e[s.BACK][1]=i,e[s.FRONT][2]=e[s.BACK][2]=r,this.i.stencilOp(t,i,r))},stencilOpSeparate(t,i,r,e){if(this.m(),t===this.i.FRONT_AND_BACK)return void this.stencilOp(i,r,e);const s=this.states.stencilOpSeparate;s[t][0]===i&&s[t][1]===r&&s[t][2]===e||(s[t][0]=i,s[t][1]=r,s[t][2]=e,this.i.stencilOpSeparate(t,i,r,e))},bindFramebuffer(t,i){this.m();const r=this.states.framebuffer;r[t]!==i&&(r[t]=i,this.i.bindFramebuffer(t,i))},bindRenderbuffer(t,i){this.m();const r=this.states.renderbuffer;r[t]!==i&&(r[t]=i,this.i.bindRenderbuffer(t,i))},bindTexture(t,i){this.m();const r=this.states.textures;r.units[-1!==r.active?r.active-33984:-1][t]=i,this.i.bindTexture(t,i)},activeTexture(t){this.m();const i=this.i,r=this.states.textures,e=r.active;r.active=t,this.activeUnit!==t&&(i.activeTexture(t),this.activeUnit=t),-1===e&&(r.units[t-33984][i.TEXTURE_2D]=r.units[-1][i.TEXTURE_2D],r.units[t-33984][i.TEXTURE_CUBE_MAP]=r.units[-1][i.TEXTURE_CUBE_MAP],r.units[-1][i.TEXTURE_2D]=null,r.units[-1][i.TEXTURE_CUBE_MAP]=null)},useProgram(t){this.m();const i=this.states;i.program!==t&&(i.program=t,void 0===t.fid&&(t.fid=0),this.S(),this.i.useProgram(t))},S(){const t=this.states.program;if(!t)return;const i=t.cachedUniforms=t.cachedUniforms||{};for(const t in i)Array.isArray(i[t])?i[t].fill(null):i[t]=null},bindBuffer(t,i){this.m();const r=this.i,e=this.states;t===r.ELEMENT_ARRAY_BUFFER?e.elementArrayBuffer=i:e.arrayBuffer=i,r.bindBuffer(t,i)},bindVertexArray(t){this.m();const i=this.i,r=this.states;r.vao!==t&&(r.vao=t,this.t?i.bindVertexArray(t):this.vaoOES.bindVertexArrayOES(t))},vertexAttribPointer(t,i,r,e,s,h){this.m(),this.states.attributes[t]||(this.states.attributes[t]={enable:!0});const n=this.states.attributes[t];return n.buffer=this.states.arrayBuffer,n.args?(n.args[0]=t,n.args[1]=i,n.args[2]=r,n.args[3]=e,n.args[4]=s,n.args[5]=h):n.args=[t,i,r,e,s,h],this.i.vertexAttribPointer(t,i,r,e,s,h)},vertexAttribDivisor(t,i){return this.m(),this.states.attributes[t].divisor=i,this.t?this.i.vertexAttribDivisor(t,i):this.angleOES.vertexAttribDivisorANGLE(t,i)}},{m(){const t=this.i;if(t.p!==this)if(t.p){this.A(t.p.states),t.p=this}else t.p=this},A(i){if(!i)return;delete this.activeUnit;const r=this.states,e=this.i;let s=0;for(const h in r)if("capabilities"!==h&&"textures"!==h&&"attributes"!==h&&"arrayBuffer"!==h&&"elementArrayBuffer"!==h&&"vao"!==h)if("program"===h)r.program!==i.program&&(e.useProgram(r.program),r.program&&(s=e.getProgramParameter(r.program,e.ACTIVE_ATTRIBUTES)));else if("framebuffer"===h)for(const t in r[h])r[h][t]!==i[h][t]&&e.bindFramebuffer(+t,r[h][t]);else if("renderbuffer"===h)for(const t in r[h])r[h][t]!==i[h][t]&&e.bindRenderbuffer(+t,r[h][t]);else if(!fastDeepEqual(r[h],i[h]))if(Array.isArray(i[h]))e[h](...r[h]);else if(i[h])for(const s in r[h])fastDeepEqual(r[h][s],i[h][s])||e[h](+s,...r[h][s]);this.S();for(const t in r.capabilities)r.capabilities[t]!==i.capabilities[t]&&e[r.capabilities[t]?"enable":"disable"](+t);const h=r.textures,u=h.units,o=i.textures.units,a=h.active-e.TEXTURE0;for(let t=0;t<u.length;t++)t===a||u[t][e.TEXTURE_2D]===o[t][e.TEXTURE_2D]&&u[t][e.TEXTURE_CUBE_MAP]===o[t][e.TEXTURE_CUBE_MAP]||(e.activeTexture(e.TEXTURE0+t),e.bindTexture(e.TEXTURE_2D,u[t][e.TEXTURE_2D]),e.bindTexture(e.TEXTURE_CUBE_MAP,u[t][e.TEXTURE_CUBE_MAP]));if(h.active>-1){const t=u[a];t[e.TEXTURE_2D]===o[a][e.TEXTURE_2D]&&t[e.TEXTURE_CUBE_MAP]===o[a][e.TEXTURE_CUBE_MAP]||(e.activeTexture(h.active),e.bindTexture(e.TEXTURE_2D,t[e.TEXTURE_2D]),e.bindTexture(e.TEXTURE_CUBE_MAP,t[e.TEXTURE_CUBE_MAP]))}this.t?e.bindVertexArray(null):this.u&&this.u.bindVertexArrayOES(null);const f=this.s;if(this.t||this.angleOES)for(let t=0;t<f;t++)this.t?e.vertexAttribDivisor(t,0):this.angleOES.vertexAttribDivisorANGLE(t,0);e.bindBuffer(e.ARRAY_BUFFER,r.arrayBuffer),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,r.elementArrayBuffer),1===r.activeAttribType?this.F(r,e):this.D(r,e,s)},F(t,i){const r=t.vao;r&&(this.t?i.bindVertexArray(r||null):this.u&&this.u.bindVertexArrayOES(r||null))},D(t,i,r){const e=this.s,s=t.attributes;let h=0;for(let t=0;t<e;t++){const e=s[t];h<r&&e?(e.buffer&&(i.bindBuffer(i.ARRAY_BUFFER,e.buffer),i.vertexAttribPointer(...e.args),e.divisor&&(this.t?i.vertexAttribDivisor(t,e.divisor):this.angleOES.vertexAttribDivisorANGLE(t,e.divisor))),e.enable?(i.enableVertexAttribArray(t),h++):i.disableVertexAttribArray(t)):i.disableVertexAttribArray(t)}}}),r$1(a.prototype,{compressedTexImage2D(t,i,r,e,s,h,n){return this.m(),this.i.compressedTexImage2D(t,i,r,e,s,h,n)},copyTexImage2D(t,i,r,e,s,h,n,u){return this.m(),this.i.copyTexImage2D(t,i,r,e,s,h,n,u)},copyTexSubImage2D(t,i,r,e,s,h,n,u){return this.m(),this.i.copyTexSubImage2D(t,i,r,e,s,h,n,u)},createTexture(){return this.i.createTexture()},deleteTexture(t){const i=this.states.textures.units;for(let r=0;r<i.length;r++)for(const e in i[r])i[r][e]===t&&(i[r][e]=null);return this.i.deleteTexture(t)},generateMipmap(t){return this.m(),this.i.generateMipmap(t)},getTexParameter(t,i){return this.m(),this.i.getTexParameter(t,i)},isTexture(t){return this.i.isTexture(t)},texImage2D(...t){if(this.m(),this.t){const i=t[t.length-2],r=u$2.getInternalFormat(this.i,t[2],i);r!==t[2]&&(t[2]=r);const e=u$2.getTextureType(this.i,i);e!==i&&(t[t.length-2]=e)}return this.i.texImage2D(...t)},texSubImage2D(...t){if(this.m(),this.t){const i=t[t.length-2],r=u$2.getTextureType(this.i,i);r!==i&&(t[t.length-2]=r)}return this.i.texSubImage2D(...t)},texParameterf(t,i,r){return this.m(),this.i.texParameterf(t,i,r)},texParameteri(t,i,r){return this.m(),this.i.texParameteri(t,i,r)},texStorage2D(t,i,r,e,s){return this.m(),this.i.texStorage2D(t,i,r,e,s)},texImage3D(t,i,r,e,s,h,n,u,o,a){return this.m(),this.i.texImage3D(t,i,r,e,s,h,n,u,o,a)},texStorage3D(t,i,r,e,s,h){return this.m(),this.i.texStorage3D(t,i,r,e,s,h)},texSubImage3D(t,i,r,e,s,h,n,u,o,a,f){return this.m(),this.i.texSubImage3D(t,i,r,e,s,h,n,u,o,a,f)},copyTexSubImage3D(t,i,r,e,s,h,n,u,o){return this.m(),this.i.copyTexSubImage3D(t,i,r,e,s,h,n,u,o)},compressedTexSubImage3D(t,i,r,e,s,h,n,u,o,a,f){return this.m(),this.i.compressedTexSubImage3D(t,i,r,e,s,h,n,u,o,a,f)}}),r$1(a.prototype,{bindAttribLocation(t,i,r){return this.i.bindAttribLocation(t,i,r)},enableVertexAttribArray(t){return this.m(),this.states.attributes[t]||(this.states.attributes[t]={}),this.states.attributes[t].enable=!0,this.i.enableVertexAttribArray(t)},disableVertexAttribArray(t){return this.m(),this.states.attributes[t]||(this.states.attributes[t]={}),this.states.attributes[t].enable=!1,this.i.disableVertexAttribArray(t)},getActiveAttrib(t,i){return this.i.getActiveAttrib(t,i)},getActiveUniform(t,i){return this.i.getActiveUniform(t,i)},getAttribLocation(t,i){return this.i.getAttribLocation(t,i)},getUniformLocation(t,i){return this.i.getUniformLocation(t,i)},getVertexAttrib(t,i){return this.m(),this.i.getVertexAttrib(t,i)},getVertexAttribOffset(t,i){return this.m(),this.i.getVertexAttribOffset(t,i)},uniformBlockBinding(t,i,r){return this.m(),this.i.uniformBlockBinding(t,i,r)},T(t,...i){const r=this.states.program;if(!r)return!1;let e=t.fid;void 0===e&&(e=t.fid=r.fid++);const s=r.cachedUniforms[e];return!!function(t,i){if(!t)return!1;const r=i.length;for(let e=0;e<r;e++)if(t[e]&&void 0!==t[e].length){const r=t[e].length;for(let s=0;s<r;s++)if(t[e][s]!==i[e][s])return!1}else if(t[e]!==i[e])return!1;return!0}(s,i)||(r.cachedUniforms[e]=function(t,i){t=t||new Array(i.length);const r=i.length;for(let e=0;e<r;e++)t[e]=void 0!==i[e].length?f$2(t[e]||[],i[e]):i[e];return t}(s,i),!1)},uniformMatrix2fv(t,i,r){this.T(t,i,r)||(this.m(),this.i.uniformMatrix2fv(t,i,r))},uniformMatrix3fv(t,i,r){this.T(t,i,r)||(this.m(),this.i.uniformMatrix3fv(t,i,r))},uniformMatrix4fv(t,i,r){this.T(t,i,r)||this.i.uniformMatrix4fv(t,i,r)},uniform1f(t,i){return this.m(),this.i.uniform1f(t,i)},uniform1i(t,i){return this.m(),this.i.uniform1i(t,i)},uniform2f(t,i,r){return this.m(),this.i.uniform2f(t,i,r)},uniform2i(t,i,r){return this.m(),this.i.uniform2i(t,i,r)},uniform3f(t,i,r,e){return this.m(),this.i.uniform3f(t,i,r,e)},uniform3i(t,i,r,e){return this.m(),this.i.uniform3i(t,i,r,e)},uniform4f(t,i,r,e,s){return this.m(),this.i.uniform4f(t,i,r,e,s)},uniform4i(t,i,r,e,s){return this.m(),this.i.uniform4i(t,i,r,e,s)},uniform1ui(t,i){return this.m(),this.i.uniform1ui(t,i)},uniform2ui(t,i,r){return this.m(),this.i.uniform2ui(t,i,r)},uniform3ui(t,i,r,e){return this.m(),this.i.uniform3ui(t,i,r,e)},uniform4ui(t,i,r,e,s){return this.m(),this.i.uniform4ui(t,i,r,e,s)},uniform1fv(t,i,r,e){this.m(),void 0!==e?this.i.uniform1fv(t,i,r,e):void 0!==r?this.i.uniform1fv(t,i,r):this.i.uniform1fv(t,i)},uniform2fv(t,i,r,e){this.m(),void 0!==e?this.i.uniform2fv(t,i,r,e):void 0!==r?this.i.uniform2fv(t,i,r):this.i.uniform2fv(t,i)},uniform3fv(t,i,r,e){this.m(),void 0!==e?this.i.uniform3fv(t,i,r,e):void 0!==r?this.i.uniform3fv(t,i,r):this.i.uniform3fv(t,i)},uniform4fv(t,i,r,e){this.m(),void 0!==e?this.i.uniform4fv(t,i,r,e):void 0!==r?this.i.uniform4fv(t,i,r):this.i.uniform4fv(t,i)},uniform1iv(t,i,r,e){this.m(),void 0!==e?this.i.uniform1iv(t,i,r,e):void 0!==r?this.i.uniform1iv(t,i,r):this.i.uniform1iv(t,i)},uniform2iv(t,i,r,e){this.m(),void 0!==e?this.i.uniform2iv(t,i,r,e):void 0!==r?this.i.uniform2iv(t,i,r):this.i.uniform2iv(t,i)},uniform3iv(t,i,r,e){this.m(),void 0!==e?this.i.uniform3iv(t,i,r,e):void 0!==r?this.i.uniform3iv(t,i,r):this.i.uniform3iv(t,i)},uniform4iv(t,i,r,e){this.m(),void 0!==e?this.i.uniform4iv(t,i,r,e):void 0!==r?this.i.uniform4iv(t,i,r):this.i.uniform4iv(t,i)},uniform1uiv(t,i,r,e){this.m(),void 0!==e?this.i.uniform1uiv(t,i,r,e):void 0!==r?this.i.uniform1uiv(t,i,r):this.i.uniform1uiv(t,i)},uniform2uiv(t,i,r,e){this.m(),void 0!==e?this.i.uniform2uiv(t,i,r,e):void 0!==r?this.i.uniform2uiv(t,i,r):this.i.uniform2uiv(t,i)},uniform3uiv(t,i,r,e){this.m(),void 0!==e?this.i.uniform3uiv(t,i,r,e):void 0!==r?this.i.uniform3uiv(t,i,r):this.i.uniform3uiv(t,i)},uniform4uiv(t,i,r,e){this.m(),void 0!==e?this.i.uniform4uiv(t,i,r,e):void 0!==r?this.i.uniform4uiv(t,i,r):this.i.uniform4uiv(t,i)},vertexAttrib1f(t,i){return this.m(),this.i.vertexAttrib1f(t,i)},vertexAttrib2f(t,i,r){return this.m(),this.i.vertexAttrib2f(t,i,r)},vertexAttrib3f(t,i,r,e){return this.m(),this.i.vertexAttrib3f(t,i,r,e)},vertexAttrib4f(t,i,r,e,s){return this.m(),this.i.vertexAttrib4f(t,i,r,e,s)},vertexAttrib1fv(t,i){return this.m(),this.i.vertexAttrib1fv(t,i)},vertexAttrib2fv(t,i){return this.m(),this.i.vertexAttrib2fv(t,i)},vertexAttrib3fv(t,i){return this.m(),this.i.vertexAttrib3fv(t,i)},vertexAttrib4fv(t,i){return this.m(),this.i.vertexAttrib4fv(t,i)},vertexAttribI4i(t,i,r,e,s){return this.m(),this.i.vertexAttribI4i(t,i,r,e,s)},vertexAttribI4ui(t,i,r,e,s){return this.m(),this.i.vertexAttribI4ui(t,i,r,e,s)},vertexAttribI4iv(t,i){return this.m(),this.i.vertexAttribI4iv(t,i)},vertexAttribI4uiv(t,i){return this.m(),this.i.vertexAttribI4uiv(t,i)}}),r$1(a.prototype,{createVertexArray(){return this.t?this.i.createVertexArray():this.vaoOES.createVertexArrayOES()},deleteVertexArray(t){const i=this.states;return i.vao===t&&(i.vao=null),this.t?this.i.deleteVertexArray(t):this.vaoOES.deleteVertexArrayOES(t)},isVertexArray(t){return this.t?this.i.isVertexArray(t):this.vaoOES.isVertexArrayOES(t)}}),r$1(a.prototype,{drawArraysInstanced(t,i,r,e){return this.m(),this.states.activeAttribType=1,this.g(),this.t?this.i.drawArraysInstanced(t,i,r,e):this.angleOES.drawArraysInstancedANGLE(t,i,r,e)},drawElementsInstanced(t,i,r,e,s){return this.m(),this.states.activeAttribType=1,this.g(),this.t?this.i.drawElementsInstanced(t,i,r,e,s):this.angleOES.drawElementsInstancedANGLE(t,i,r,e,s)}});
/*!
	 * @maptalks/gl v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.com
	 */
var w$3={exports:{}},x$5={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},M$5={exports:{}},_$5=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},y$3=Array.prototype.concat,b$4=Array.prototype.slice,S$5=M$5.exports=function(t){for(var i=[],e=0,s=t.length;e<s;e++){var n=t[e];_$5(n)?i=y$3.call(i,b$4.call(n)):i.push(n)}return i};S$5.wrap=function(t){return function(){return t(S$5(arguments))}};var C$3=x$5,T$5=M$5.exports,k$5=Object.hasOwnProperty,A$3=Object.create(null);for(var O$5 in C$3)k$5.call(C$3,O$5)&&(A$3[C$3[O$5]]=O$5);var I$4=w$3.exports={to:{},get:{}};function E$5(t,i,e){return Math.min(Math.max(i,t),e)}function L$5(t){var i=Math.round(t).toString(16).toUpperCase();return i.length<2?"0"+i:i}I$4.get=function(t){var i,e;switch(t.substring(0,3).toLowerCase()){case"hsl":i=I$4.get.hsl(t),e="hsl";break;case"hwb":i=I$4.get.hwb(t),e="hwb";break;default:i=I$4.get.rgb(t),e="rgb"}return i?{model:e,value:i}:null},I$4.get.rgb=function(t){if(!t)return null;var i,e,s,n=[0,0,0,1];if(i=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(s=i[2],i=i[1],e=0;e<3;e++){var r=2*e;n[e]=parseInt(i.slice(r,r+2),16)}s&&(n[3]=parseInt(s,16)/255)}else if(i=t.match(/^#([a-f0-9]{3,4})$/i)){for(s=(i=i[1])[3],e=0;e<3;e++)n[e]=parseInt(i[e]+i[e],16);s&&(n[3]=parseInt(s+s,16)/255)}else if(i=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(e=0;e<3;e++)n[e]=parseInt(i[e+1],0);i[4]&&(n[3]=i[5]?.01*parseFloat(i[4]):parseFloat(i[4]))}else{if(!(i=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(i=t.match(/^(\w+)$/))?"transparent"===i[1]?[0,0,0,0]:k$5.call(C$3,i[1])?((n=C$3[i[1]])[3]=1,n):null:null;for(e=0;e<3;e++)n[e]=Math.round(2.55*parseFloat(i[e+1]));i[4]&&(n[3]=i[5]?.01*parseFloat(i[4]):parseFloat(i[4]))}for(e=0;e<3;e++)n[e]=E$5(n[e],0,255);return n[3]=E$5(n[3],0,1),n},I$4.get.hsl=function(t){if(!t)return null;var i=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var e=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,E$5(parseFloat(i[2]),0,100),E$5(parseFloat(i[3]),0,100),E$5(isNaN(e)?1:e,0,1)]}return null},I$4.get.hwb=function(t){if(!t)return null;var i=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(i){var e=parseFloat(i[4]);return[(parseFloat(i[1])%360+360)%360,E$5(parseFloat(i[2]),0,100),E$5(parseFloat(i[3]),0,100),E$5(isNaN(e)?1:e,0,1)]}return null},I$4.to.hex=function(){var t=T$5(arguments);return"#"+L$5(t[0])+L$5(t[1])+L$5(t[2])+(t[3]<1?L$5(Math.round(255*t[3])):"")},I$4.to.rgb=function(){var t=T$5(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},I$4.to.rgb.percent=function(){var t=T$5(arguments),i=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),s=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+i+"%, "+e+"%, "+s+"%)":"rgba("+i+"%, "+e+"%, "+s+"%, "+t[3]+")"},I$4.to.hsl=function(){var t=T$5(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},I$4.to.hwb=function(){var t=T$5(arguments),i="";return t.length>=4&&1!==t[3]&&(i=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+i+")"},I$4.to.keyword=function(t){return A$3[t.slice(0,3)]};var F$5={exports:{}},R$5=x$5,P$4={};for(var D$5 in R$5)R$5.hasOwnProperty(D$5)&&(P$4[R$5[D$5]]=D$5);var H$5=F$5.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var N$5 in H$5)if(H$5.hasOwnProperty(N$5)){if(!("channels"in H$5[N$5]))throw new Error("missing channels property: "+N$5);if(!("labels"in H$5[N$5]))throw new Error("missing channel labels property: "+N$5);if(H$5[N$5].labels.length!==H$5[N$5].channels)throw new Error("channel and label counts mismatch: "+N$5);var G$5=H$5[N$5].channels,j$5=H$5[N$5].labels;delete H$5[N$5].channels,delete H$5[N$5].labels,Object.defineProperty(H$5[N$5],"channels",{value:G$5}),Object.defineProperty(H$5[N$5],"labels",{value:j$5})}H$5.rgb.hsl=function(t){var i,e,s=t[0]/255,n=t[1]/255,r=t[2]/255,h=Math.min(s,n,r),o=Math.max(s,n,r),a=o-h;return o===h?i=0:s===o?i=(n-r)/a:n===o?i=2+(r-s)/a:r===o&&(i=4+(s-n)/a),(i=Math.min(60*i,360))<0&&(i+=360),e=(h+o)/2,[i,100*(o===h?0:e<=.5?a/(o+h):a/(2-o-h)),100*e]},H$5.rgb.hsv=function(t){var i,e,s,n,r,h=t[0]/255,o=t[1]/255,a=t[2]/255,l=Math.max(h,o,a),c=l-Math.min(h,o,a),u=function(t){return(l-t)/6/c+.5};return 0===c?n=r=0:(r=c/l,i=u(h),e=u(o),s=u(a),h===l?n=s-e:o===l?n=1/3+i-s:a===l&&(n=2/3+e-i),n<0?n+=1:n>1&&(n-=1)),[360*n,100*r,100*l]},H$5.rgb.hwb=function(t){var i=t[0],e=t[1],s=t[2];return[H$5.rgb.hsl(t)[0],1/255*Math.min(i,Math.min(e,s))*100,100*(s=1-1/255*Math.max(i,Math.max(e,s)))]},H$5.rgb.cmyk=function(t){var i,e=t[0]/255,s=t[1]/255,n=t[2]/255;return[100*((1-e-(i=Math.min(1-e,1-s,1-n)))/(1-i)||0),100*((1-s-i)/(1-i)||0),100*((1-n-i)/(1-i)||0),100*i]},H$5.rgb.keyword=function(t){var i=P$4[t];if(i)return i;var e,s,n,r=1/0;for(var h in R$5)if(R$5.hasOwnProperty(h)){var a=(s=t,n=R$5[h],Math.pow(s[0]-n[0],2)+Math.pow(s[1]-n[1],2)+Math.pow(s[2]-n[2],2));a<r&&(r=a,e=h)}return e},H$5.keyword.rgb=function(t){return R$5[t]},H$5.rgb.xyz=function(t){var i=t[0]/255,e=t[1]/255,s=t[2]/255;return[100*(.4124*(i=i>.04045?Math.pow((i+.055)/1.055,2.4):i/12.92)+.3576*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(s=s>.04045?Math.pow((s+.055)/1.055,2.4):s/12.92)),100*(.2126*i+.7152*e+.0722*s),100*(.0193*i+.1192*e+.9505*s)]},H$5.rgb.lab=function(t){var i=H$5.rgb.xyz(t),e=i[0],s=i[1],n=i[2];return s/=100,n/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116)-16,500*(e-s),200*(s-(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116))]},H$5.hsl.rgb=function(t){var i,e,s,n,r,h=t[0]/360,o=t[1]/100,a=t[2]/100;if(0===o)return[r=255*a,r,r];i=2*a-(e=a<.5?a*(1+o):a+o-a*o),n=[0,0,0];for(var l=0;l<3;l++)(s=h+1/3*-(l-1))<0&&s++,s>1&&s--,n[l]=255*(r=6*s<1?i+6*(e-i)*s:2*s<1?e:3*s<2?i+(e-i)*(2/3-s)*6:i);return n},H$5.hsl.hsv=function(t){var i=t[0],e=t[1]/100,s=t[2]/100,n=e,r=Math.max(s,.01);return e*=(s*=2)<=1?s:2-s,n*=r<=1?r:2-r,[i,100*(0===s?2*n/(r+n):2*e/(s+e)),(s+e)/2*100]},H$5.hsv.rgb=function(t){var i=t[0]/60,e=t[1]/100,s=t[2]/100,n=Math.floor(i)%6,r=i-Math.floor(i),h=255*s*(1-e),o=255*s*(1-e*r),a=255*s*(1-e*(1-r));switch(s*=255,n){case 0:return[s,a,h];case 1:return[o,s,h];case 2:return[h,s,a];case 3:return[h,o,s];case 4:return[a,h,s];case 5:return[s,h,o]}},H$5.hsv.hsl=function(t){var i,e,s,n=t[0],r=t[1]/100,h=t[2]/100,o=Math.max(h,.01);return s=(2-r)*h,e=r*o,[n,100*(e=(e/=(i=(2-r)*o)<=1?i:2-i)||0),100*(s/=2)]},H$5.hwb.rgb=function(t){var i,e,s,n,r,h,o,a=t[0]/360,l=t[1]/100,c=t[2]/100,u=l+c;switch(u>1&&(l/=u,c/=u),s=6*a-(i=Math.floor(6*a)),0!=(1&i)&&(s=1-s),n=l+s*((e=1-c)-l),i){default:case 6:case 0:r=e,h=n,o=l;break;case 1:r=n,h=e,o=l;break;case 2:r=l,h=e,o=n;break;case 3:r=l,h=n,o=e;break;case 4:r=n,h=l,o=e;break;case 5:r=e,h=l,o=n}return[255*r,255*h,255*o]},H$5.cmyk.rgb=function(t){var e=t[1]/100,s=t[2]/100,n=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-n)+n)),255*(1-Math.min(1,e*(1-n)+n)),255*(1-Math.min(1,s*(1-n)+n))]},H$5.xyz.rgb=function(t){var i,e,s,n=t[0]/100,r=t[1]/100,h=t[2]/100;return e=-.9689*n+1.8758*r+.0415*h,s=.0557*n+-.204*r+1.057*h,i=(i=3.2406*n+-1.5372*r+-.4986*h)>.0031308?1.055*Math.pow(i,1/2.4)-.055:12.92*i,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,s=s>.0031308?1.055*Math.pow(s,1/2.4)-.055:12.92*s,[255*(i=Math.min(Math.max(0,i),1)),255*(e=Math.min(Math.max(0,e),1)),255*(s=Math.min(Math.max(0,s),1))]},H$5.xyz.lab=function(t){var i=t[0],e=t[1],s=t[2];return e/=100,s/=108.883,i=(i/=95.047)>.008856?Math.pow(i,1/3):7.787*i+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(i-e),200*(e-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},H$5.lab.xyz=function(t){var i,e,s;i=t[1]/500+(e=(t[0]+16)/116),s=e-t[2]/200;var r=Math.pow(e,3),h=Math.pow(i,3),o=Math.pow(s,3);return e=r>.008856?r:(e-16/116)/7.787,i=h>.008856?h:(i-16/116)/7.787,s=o>.008856?o:(s-16/116)/7.787,[i*=95.047,e*=100,s*=108.883]},H$5.lab.lch=function(t){var i,e=t[0],s=t[1],n=t[2];return(i=360*Math.atan2(n,s)/2/Math.PI)<0&&(i+=360),[e,Math.sqrt(s*s+n*n),i]},H$5.lch.lab=function(t){var i,s=t[1];return i=t[2]/360*2*Math.PI,[t[0],s*Math.cos(i),s*Math.sin(i)]},H$5.rgb.ansi16=function(t){var i=t[0],e=t[1],s=t[2],n=1 in arguments?arguments[1]:H$5.rgb.hsv(t)[2];if(0===(n=Math.round(n/50)))return 30;var r=30+(Math.round(s/255)<<2|Math.round(e/255)<<1|Math.round(i/255));return 2===n&&(r+=60),r},H$5.hsv.ansi16=function(t){return H$5.rgb.ansi16(H$5.hsv.rgb(t),t[2])},H$5.rgb.ansi256=function(t){var i=t[0],e=t[1],s=t[2];return i===e&&e===s?i<8?16:i>248?231:Math.round((i-8)/247*24)+232:16+36*Math.round(i/255*5)+6*Math.round(e/255*5)+Math.round(s/255*5)},H$5.ansi16.rgb=function(t){var i=t%10;if(0===i||7===i)return t>50&&(i+=3.5),[i=i/10.5*255,i,i];var e=.5*(1+~~(t>50));return[(1&i)*e*255,(i>>1&1)*e*255,(i>>2&1)*e*255]},H$5.ansi256.rgb=function(t){if(t>=232){var i=10*(t-232)+8;return[i,i,i]}var e;return t-=16,[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},H$5.rgb.hex=function(t){var i=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(i.length)+i},H$5.hex.rgb=function(t){var i=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!i)return[0,0,0];var e=i[0];3===i[0].length&&(e=e.split("").map((function(t){return t+t})).join(""));var s=parseInt(e,16);return[s>>16&255,s>>8&255,255&s]},H$5.rgb.hcg=function(t){var i,e=t[0]/255,s=t[1]/255,n=t[2]/255,r=Math.max(Math.max(e,s),n),h=Math.min(Math.min(e,s),n),o=r-h;return i=o<=0?0:r===e?(s-n)/o%6:r===s?2+(n-e)/o:4+(e-s)/o+4,i/=6,[360*(i%=1),100*o,100*(o<1?h/(1-o):0)]},H$5.hsl.hcg=function(t){var s,i=t[1]/100,e=t[2]/100,n=0;return(s=e<.5?2*i*e:2*i*(1-e))<1&&(n=(e-.5*s)/(1-s)),[t[0],100*s,100*n]},H$5.hsv.hcg=function(t){var e=t[2]/100,s=t[1]/100*e,n=0;return s<1&&(n=(e-s)/(1-s)),[t[0],100*s,100*n]},H$5.hcg.rgb=function(t){var e=t[1]/100,s=t[2]/100;if(0===e)return[255*s,255*s,255*s];var n,r=[0,0,0],h=t[0]/360%1*6,o=h%1,a=1-o;switch(Math.floor(h)){case 0:r[0]=1,r[1]=o,r[2]=0;break;case 1:r[0]=a,r[1]=1,r[2]=0;break;case 2:r[0]=0,r[1]=1,r[2]=o;break;case 3:r[0]=0,r[1]=a,r[2]=1;break;case 4:r[0]=o,r[1]=0,r[2]=1;break;default:r[0]=1,r[1]=0,r[2]=a}return[255*(e*r[0]+(n=(1-e)*s)),255*(e*r[1]+n),255*(e*r[2]+n)]},H$5.hcg.hsv=function(t){var i=t[1]/100,e=i+t[2]/100*(1-i),s=0;return e>0&&(s=i/e),[t[0],100*s,100*e]},H$5.hcg.hsl=function(t){var i=t[1]/100,e=t[2]/100*(1-i)+.5*i,s=0;return e>0&&e<.5?s=i/(2*e):e>=.5&&e<1&&(s=i/(2*(1-e))),[t[0],100*s,100*e]},H$5.hcg.hwb=function(t){var i=t[1]/100,e=i+t[2]/100*(1-i);return[t[0],100*(e-i),100*(1-e)]},H$5.hwb.hcg=function(t){var e=1-t[2]/100,s=e-t[1]/100,n=0;return s<1&&(n=(e-s)/(1-s)),[t[0],100*s,100*n]},H$5.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},H$5.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},H$5.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},H$5.gray.hsl=H$5.gray.hsv=function(t){return[0,0,t[0]]},H$5.gray.hwb=function(t){return[0,100,t[0]]},H$5.gray.cmyk=function(t){return[0,0,0,t[0]]},H$5.gray.lab=function(t){return[t[0],0,0]},H$5.gray.hex=function(t){var i=255&Math.round(t[0]/100*255),e=((i<<16)+(i<<8)+i).toString(16).toUpperCase();return"000000".substring(e.length)+e},H$5.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var B$5=F$5.exports;function z$5(t,i){return function(e){return i(t(e))}}function V$5(t,i){for(var e=[i[t].parent,t],s=B$5[i[t].parent][t],n=i[t].parent;i[n].parent;)e.unshift(i[n].parent),s=z$5(B$5[i[n].parent][n],s),n=i[n].parent;return s.conversion=e,s}var W$5=F$5.exports,q$6=function(t){for(var i=function(t){var i=function(){for(var t={},i=Object.keys(B$5),e=i.length,s=0;s<e;s++)t[i[s]]={distance:-1,parent:null};return t}(),e=[t];for(i[t].distance=0;e.length;)for(var s=e.pop(),n=Object.keys(B$5[s]),r=n.length,h=0;h<r;h++){var o=n[h],a=i[o];-1===a.distance&&(a.distance=i[s].distance+1,a.parent=s,e.unshift(o))}return i}(t),e={},s=Object.keys(i),n=s.length,r=0;r<n;r++){var h=s[r];null!==i[h].parent&&(e[h]=V$5(h,i))}return e},$$5={};Object.keys(W$5).forEach((function(t){$$5[t]={},Object.defineProperty($$5[t],"channels",{value:W$5[t].channels}),Object.defineProperty($$5[t],"labels",{value:W$5[t].labels});var i=q$6(t);Object.keys(i).forEach((function(e){var s=i[e];$$5[t][e]=function(t){var i=function(i){if(null==i)return i;arguments.length>1&&(i=Array.prototype.slice.call(arguments));var e=t(i);if("object"==typeof e)for(var s=e.length,n=0;n<s;n++)e[n]=Math.round(e[n]);return e};return"conversion"in t&&(i.conversion=t.conversion),i}(s),$$5[t][e].raw=function(t){var i=function(i){return null==i?i:(arguments.length>1&&(i=Array.prototype.slice.call(arguments)),t(i))};return"conversion"in t&&(i.conversion=t.conversion),i}(s)}))}));var X$6=w$3.exports,J$6=$$5,Z$6=[].slice,K$6=["keyword","gray","hex"],Q$6={};Object.keys(J$6).forEach((function(t){Q$6[Z$6.call(J$6[t].labels).sort().join("")]=t}));var tt$5={};function it$4(t,i){if(!(this instanceof it$4))return new it$4(t,i);if(i&&i in K$6&&(i=null),i&&!(i in J$6))throw new Error("Unknown model: "+i);var e,s;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof it$4)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var n=X$6.get(t);if(null===n)throw new Error("Unable to parse color from string: "+t);this.model=n.model,this.color=n.value.slice(0,s=J$6[this.model].channels),this.valpha="number"==typeof n.value[s]?n.value[s]:1}else if(t.length){this.model=i||"rgb";var r=Z$6.call(t,0,s=J$6[this.model].channels);this.color=rt$5(r,s),this.valpha="number"==typeof t[s]?t[s]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var h=Object.keys(t);"alpha"in t&&(h.splice(h.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var o=h.sort().join("");if(!(o in Q$6))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Q$6[o];var a=J$6[this.model].labels,l=[];for(e=0;e<a.length;e++)l.push(t[a[e]]);this.color=rt$5(l)}if(tt$5[this.model])for(s=J$6[this.model].channels,e=0;e<s;e++){var c=tt$5[this.model][e];c&&(this.color[e]=c(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function et$5(t,i,e){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(tt$5[t]||(tt$5[t]=[]))[i]=e})),t=t[0],function(s){var n;return arguments.length?(e&&(s=e(s)),(n=this[t]()).color[i]=s,n):(n=this[t]().color[i],e&&(n=e(n)),n)}}function st$5(t){return function(i){return Math.max(0,Math.min(t,i))}}function nt$5(t){return Array.isArray(t)?t:[t]}function rt$5(t,i){for(var e=0;e<i;e++)"number"!=typeof t[e]&&(t[e]=0);return t}it$4.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var i=this.model in X$6.to?this:this.rgb(),e=1===(i=i.round("number"==typeof t?t:1)).valpha?i.color:i.color.concat(this.valpha);return X$6.to[i.model](e)},percentString:function(t){var i=this.rgb().round("number"==typeof t?t:1),e=1===i.valpha?i.color:i.color.concat(this.valpha);return X$6.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},i=J$6[this.model].channels,e=J$6[this.model].labels,s=0;s<i;s++)t[e[s]]=this.color[s];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new it$4(this.color.map(function(t){return function(i){return function(t,i){return Number(t.toFixed(i))}(i,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new it$4(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:et$5("rgb",0,st$5(255)),green:et$5("rgb",1,st$5(255)),blue:et$5("rgb",2,st$5(255)),hue:et$5(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:et$5("hsl",1,st$5(100)),lightness:et$5("hsl",2,st$5(100)),saturationv:et$5("hsv",1,st$5(100)),value:et$5("hsv",2,st$5(100)),chroma:et$5("hcg",1,st$5(100)),gray:et$5("hcg",2,st$5(100)),white:et$5("hwb",1,st$5(100)),wblack:et$5("hwb",2,st$5(100)),cyan:et$5("cmyk",0,st$5(100)),magenta:et$5("cmyk",1,st$5(100)),yellow:et$5("cmyk",2,st$5(100)),black:et$5("cmyk",3,st$5(100)),x:et$5("xyz",0,st$5(100)),y:et$5("xyz",1,st$5(100)),z:et$5("xyz",2,st$5(100)),l:et$5("lab",0,st$5(100)),a:et$5("lab",1),b:et$5("lab",2),keyword:function(t){return arguments.length?new it$4(t):J$6[this.model].keyword(this.color)},hex:function(t){return arguments.length?new it$4(t):X$6.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,i=[],e=0;e<t.length;e++){var s=t[e]/255;i[e]=s<=.03928?s/12.92:Math.pow((s+.055)/1.055,2.4)}return.2126*i[0]+.7152*i[1]+.0722*i[2]},contrast:function(t){var i=this.luminosity(),e=t.luminosity();return i>e?(i+.05)/(e+.05):(e+.05)/(i+.05)},level:function(t){var i=this.contrast(t);return i>=7.1?"AAA":i>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),i=0;i<3;i++)t.color[i]=255-t.color[i];return t},lighten:function(t){var i=this.hsl();return i.color[2]+=i.color[2]*t,i},darken:function(t){var i=this.hsl();return i.color[2]-=i.color[2]*t,i},saturate:function(t){var i=this.hsl();return i.color[1]+=i.color[1]*t,i},desaturate:function(t){var i=this.hsl();return i.color[1]-=i.color[1]*t,i},whiten:function(t){var i=this.hwb();return i.color[1]+=i.color[1]*t,i},blacken:function(t){var i=this.hwb();return i.color[2]+=i.color[2]*t,i},grayscale:function(){var t=this.rgb().color,i=.3*t[0]+.59*t[1]+.11*t[2];return it$4.rgb(i,i,i)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var i=this.hsl(),e=i.color[0];return e=(e=(e+t)%360)<0?360+e:e,i.color[0]=e,i},mix:function(t,i){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var e=t.rgb(),s=this.rgb(),n=void 0===i?.5:i,r=2*n-1,h=e.alpha()-s.alpha(),o=((r*h==-1?r:(r+h)/(1+r*h))+1)/2,a=1-o;return it$4.rgb(o*e.red()+a*s.red(),o*e.green()+a*s.green(),o*e.blue()+a*s.blue(),e.alpha()*n+s.alpha()*(1-n))}},Object.keys(J$6).forEach((function(t){if(-1===K$6.indexOf(t)){var i=J$6[t].channels;it$4.prototype[t]=function(){if(this.model===t)return new it$4(this);if(arguments.length)return new it$4(arguments,t);var e="number"==typeof arguments[i]?i:this.valpha;return new it$4(nt$5(J$6[this.model][t].raw(this.color)).concat(e),t)},it$4[t]=function(e){return"number"==typeof e&&(e=rt$5(Z$6.call(arguments),i)),new it$4(e,t)}}}));var ht$5=it$4;const ot$5="function"==typeof Object.assign;function at$5(t){if(ot$5)Object.assign.apply(Object,arguments);else for(let i=1;i<arguments.length;i++){const e=arguments[i];for(const i in e)t[i]=e[i]}return t}function lt$5(t){return null==t}function ct$5(t){return"number"==typeof t&&!isNaN(t)}const ut$5=[];function ft$5(t,i){const e=i._get2DExtentAtRes(i.getGLRes()),s=e.getWidth(),n=e.getHeight(),r=t;return identity$2(r),translate$1(r,r,i.cameraLookAt),scale$5(r,r,set$4(ut$5,s,n,1)),r}function dt$5(t,i){return Object.prototype.hasOwnProperty.call(t,i)}function pt$5(t){for(let i=1;i<arguments.length;i++){const e=arguments[i];if(e)for(let i=0,s=e.length;i<s;i++)t.push(e[i])}return t.length}const gt$5={};function mt$5(t,i){if(!Array.isArray(i)){i=gt$5[i]=gt$5[i]||ht$5(i).array()}for(let e=0;e<i.length;e++)t[e]=i[e];return 3===i.length&&(t[3]=1),t}function vt$5(t,i){if(Array.isArray(i))for(let e=0;e<i.length;e++)t[e]=255*i[e];else{i=gt$5[i]=gt$5[i]||ht$5(i).array();for(let e=0;e<i.length;e++)t[e]=i[e]}return 3===t.length&&t.push(255),t}function wt$5(t,e,s=0){if(!(t&&e instanceof t$1.Coordinate))return null;const n=t.coordinateToPointAtRes(e,t.getGLRes());return[n.x,n.y,s]}const xt$5=[0,0],Mt$5=[0,0,0];let _t$5;class yt$5{static getUniformDeclares(){const t=[],i=[];return i.push({name:"shadow_lightProjViewModelMatrix",type:"function",fn:function(i,e){return multiply$5(t,e.shadow_lightProjViewMatrix,e.modelMatrix)}}),i.push("shadow_shadowMap","shadow_opacity","esm_shadow_threshold","shadow_color","shadow_nearFar"),i}constructor(t,i,e){this.renderer=new B$6(t),this.sceneConfig=i,this.t=.3,this.s=e,this.h()}resize(){const t=this.canvas;t.width=this.s.getRenderer().canvas.width,t.height=this.s.getRenderer().canvas.height}h(){const t=this.sceneConfig.shadow||{};let i=512;const e=t.quality;"high"===e?i=2048:"medium"===e&&(i=1024);const s=this.getDefines();this.o=new mr$4(this.renderer,{width:i,height:i,blurOffset:t.blurOffset,defines:s}),this.u=new vr$4(s),this.p()}getDefines(){return{HAS_SHADOWING:1,PACK_FLOAT:1,USE_ESM:1}}render(t,i,e,s,n,r,h,o,c,u){this.m();const f=this.s.getMap();let d,p;if(u||this.v(f,h,!!t)){this.M=this.M||[],this._=this._||[];const s=multiply$5(this.M,i,e),n=normalize$4(this._,r);_t$5||(_t$5=f.getContainerExtent());let o=f.height;f.getPitch()>62&&(o=f._getVisualHeight(62));const c=_t$5.set(0,f.height-o,f.width,f.height).convertTo((t=>f._containerPointToPointAtRes(t,f.getGLRes()))).toArray();t&&h.addMesh(this.S);const u=c.map((t=>[t.x,t.y,0,1])),{lightProjViewMatrix:g,shadowMap:m,blurFBO:v}=this.o.render(h,{cameraProjViewMatrix:s,lightDir:n,farPlane:u,cameraLookAt:f.cameraLookAt});d=this.C=g,p=this.T=m,this.k=v,this.A=h.getMeshes().reduce(((t,i)=>(i.castShadow&&i.geometry&&(t[i.uuid]={v0:i.version,v1:i.geometry.version}),t)),{}),this.O={count:h.getMeshes().length-+!!t,displayShadow:!!t},this.I=!0}else d=this.C,p=this.T,this.I=!1;return this.L=i,this.F=e,lt$5(n)&&(n=1),t&&h.getMeshes().length&&this.displayShadow(s,n,o,c),{shadow_lightProjViewMatrix:d,shadow_shadowMap:p,shadow_opacity:n,shadow_color:s||Mt$5,esm_shadow_threshold:this.t}}displayShadow(t,i,e,s){const n=this.C,r=this.S,h=this.R||[],o=this.s.getRenderer().canvas,l=this.P=this.P||[];l[0]=o.width,l[1]=o.height,this.renderer.render(this.u,{halton:e||xt$5,globalTexSize:l,projMatrix:this.L,viewMatrix:this.F,shadow_lightProjViewModelMatrix:multiply$5(h,n,r.localTransform),shadow_shadowMap:this.T,esm_shadow_threshold:this.t,shadow_opacity:i,color:t||Mt$5},this.D,s)}dispose(){this.o.dispose(),this.u.dispose(),this.S&&(this.S.geometry.dispose(),this.S.dispose()),delete this.renderer}isUpdated(){return!1!==this.I}v(t,i,e){if(!this.A)return!0;const s=this.O;if(i.getMeshes().length!==s.count||e!==s.displayShadow)return!0;const n=i.getMeshes();for(let t=0;t<n.length;t++){const i=this.A[n[t].uuid];if(n[t].castShadow&&(n[t].hasSkinAnimation()||!i||i.v0!==n[t].version||i.v1!==n[t].geometry.version))return!0}return!1}p(){const t=new tn$5;t.generateBuffers(this.renderer.regl),this.S=new Be$5(t),this.D=new Ke$5([this.S])}m(){const t=this.s.getMap(),i=ft$5(this.S.localTransform,t);this.S.setLocalTransform(i)}}const bt$5=[0,0],St$5=new t__namespace.Coordinate(0,0),Ct$5=new t__namespace.Coordinate(0,0),Tt$5=[],kt$5=[],At$5=[];function Ot$5(t,i,e,s){const n=t.getGLRes(),r=t.distanceToPointAtRes(i,i,n,e?St$5:null,Ct$5);return s?r.y:r.x}const{createIBLTextures:It$5,disposeIBLTextures:Et$5,getPBRUniforms:Lt$5}=fi$4.PBRUtils,Ft$5=[0,0],Rt$5=[1,1],Pt$5=[],Dt$5=[],Ht$4=[],Nt$5=[],Gt$4=[];class jt$4{static getGroundTransform(t,i){return ft$5(t,i)}constructor(t,i){this.H=t,this.renderer=new B$6(t),this.s=i,this.N=new Ve$5,this.G=this.j.bind(this),this.h()}needToRedraw(){const t=this.B();return t&&(t[0]||t[1])}getMap(){return this.s&&this.s.getMap()}getSymbol(){const t=this.s.getGroundConfig();return t&&t.symbol}isEnable(){const t=this.s.getGroundConfig();return t&&t.enable}paint(t){if(!this.isEnable())return!1;const i=this.U();if(this.V(t)&&i===this.W)return!1;const e=this.q(t);e&&this.S.setDefines(e),this.S.material!==this.material&&this.S.setMaterial(this.material);const s=this.s.getGroundConfig();this.S.ssr=(s&&s.symbol).ssr?1:0,this.m();const n=this.$(t);n.offsetFactor=t.offsetFactor,n.offsetUnits=t.offsetUnits;const r=t&&t.renderTarget&&t.renderTarget.fbo;return i===this.W?(this.renderer.render(i,n,this.D,r),this.s.getRenderer().setCanvasUpdated(),!0):(i.filter=t.sceneFilter,this.renderer.render(i,n,this.D,r),this.s.getRenderer().setCanvasUpdated(),!0)}V(t){return!!(this.s.getRenderer().isEnableSSR&&this.s.getRenderer().isEnableSSR()&&t&&t.ssr)}update(){const t=this.s.getGroundConfig();if(!t)return;const i=t&&t.symbol;if(i){this.Y=this.X(i.polygonFill||[1,1,1,1]),this.J=void 0===i.polygonOpacity?1:i.polygonOpacity;const t=i.polygonPatternFile;if(t){if(!this.Z||this.Z._pattern_src!==t){const i=new Image;i.onload=()=>{this.Z&&this.Z.destroy(),this.Z=this.K(i),this.Z._pattern_src=t,this.setToRedraw()},i.src=t}}else this.Z&&(this.Z.destroy(),delete this.Z)}else this.Y=[1,1,1,1],this.J=1,this.Z&&(this.Z.destroy(),delete this.Z);this.tt()}setToRedraw(){const t=this.s.getRenderer();t&&t.setToRedraw()}dispose(){this.material&&(this.material.dispose(),delete this.material),this.S&&(this.S.geometry.dispose(),this.S.material&&this.S.material.dispose(),this.S.dispose(),delete this.S),this.Z&&(this.Z.destroy(),delete this.Z),this.W&&(this.W.dispose(),delete this.W),this.it&&(this.it.dispose(),delete this.it),this.et(),this.st&&(this.st.destroy(),delete this.st);const t=this.getMap();t&&t.off("updatelights",this.nt,this)}U(){const t=this.s.getGroundConfig();if(!t||!t.renderPlugin)return this.W;const i=t.renderPlugin.type;if("lit"===i)return this.it;if("fill"===i)return this.W;throw new Error("unsupported render plugin of "+i+" for layer ground")}$(t){const i=this.rt(t);return i.polygonFill=this.Y,i.polygonOpacity=this.J,this.U()===this.W&&this.Z&&(i.polygonPatternFile=this.Z),i}rt(t){let i;return"lit"===this.s.getGroundConfig().renderPlugin.type?(this.ht||(this.ht=It$5(this.H,this.getMap())),this.st||(this.st=fi$4.PBRHelper.generateDFGLUT(this.H)),i=Lt$5(this.getMap(),this.ht,this.st,t&&t.ssr,t&&t.jitter)):i={projViewMatrix:this.getMap().projViewMatrix},this.ot(i,t),i}ot(t,i){const e=i&&i.includes;if(e)for(const s in e)e[s]&&i[s].renderUniforms&&at$5(t,i[s].renderUniforms)}et(){this.ht&&(Et$5(this.ht),delete this.ht)}h(){this.getMap().on("updatelights",this.nt,this);const t=this.lt(),i=yt$5.getUniformDeclares(),e=[];i.push({name:"projViewModelMatrix",type:"function",fn:function(t,i){return multiply$5(e,i.projViewMatrix,i.modelMatrix)}}),this.W=new vn$4({vert:"attribute vec3 aPosition;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\n#ifdef HAS_PATTERN\n    attribute vec2 aTexCoord;\n    uniform vec2 uvScale;\n    uniform vec2 uvOffset;\n    varying vec2 vTexCoord;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_vert>\n#endif\nvoid main () {\n    #ifdef HAS_PATTERN\n        vTexCoord = aTexCoord * uvScale + uvOffset;\n    #endif\n    vec3 position = vec3(aPosition);\n    gl_Position = projViewModelMatrix * vec4(position, 1.0);\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        shadow_computeShadowPars(vec4(position, 1.0));\n    #endif\n}",frag:"precision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n    #include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n    uniform sampler2D polygonPatternFile;\n    varying vec2 vTexCoord;\n#endif\nuniform vec4 polygonFill;\nuniform float polygonOpacity;\nvoid main() {\n    #ifdef HAS_PATTERN\n        vec4 color = texture2D(polygonPatternFile, vTexCoord);\n    #else\n        vec4 color = polygonFill;\n    #endif\n    gl_FragColor = color * polygonOpacity;\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n        float shadowCoeff = shadow_computeShadow();\n        gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, shadowCoeff);\n    #endif\n}",uniforms:i,extraCommandProps:t});const s=yt$5.getUniformDeclares();s.push(...jn$4.getUniformDeclares()),this.it=new fi$4.StandardShader({uniforms:s,extraCommandProps:t}),this.p(),this.update()}lt(){const t=[0,1],i=this.s.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>i.width,height:()=>i.height},depth:{enable:!0,mask:()=>{const t=this.s.getGroundConfig();return t.depth||void 0===t.depth},range:()=>{const i=this.s.getGroundConfig(),e=i&&i.renderPlugin.sceneConfig;return e&&e.depthRange||t},func:"<="},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:{factor:(t,i)=>i.offsetFactor,units:(t,i)=>i.offsetUnits}}}}ct(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}p(){const t=new tn$5;t.data.aTexCoord=new Uint8Array([0,0,1,0,0,1,1,1]),t.createTangent(),t.generateBuffers(this.renderer.regl),this.S=new Be$5(t,null,{castShadow:!1});const i=this.it.getGeometryDefines(t);this.S.setDefines(i),this.D=new Ke$5([this.S])}m(){const t=this.getMap(),i=jt$4.getGroundTransform(this.S.localTransform,t);this.S.setLocalTransform(i);const e=t.getGLRes(),s=t._get2DExtentAtRes(e),n=s.getWidth(),r=s.getHeight(),h=t.cameraLookAt,o=h[0]-n,a=h[1]-r,l=this.Z?this.Z.width/this.Z.height:1,u=this.getSymbol(),f=this.material?this.material.get("textureOrigin"):u.polygonPatternFileOrigin,d=!!(this.material?this.material.get("uvOffsetInMeter"):u.uvOffsetInMeter),p=(this.material?this.material.get("uvOffset"):u.uvOffset)||Ft$5,g=this.material&&this.material.get("uvScale")||Rt$5,m=this.material?this.material.get("textureWidth"):u.polygonPatternFileWidth,v=this.material?m*(g[1]/g[0]):u.polygonPatternFileHeight,w=this.B(),[x,M,_,y,b]=function(t,i,e,s,n,r,h,o,a,l,u){const f=t.getGLRes();s&&(St$5.set(s[0],s[1]),t.coordToPointAtRes(St$5,f,Ct$5),i-=Ct$5.x,e-=Ct$5.y);const d=s?St$5:null;l=copy(kt$5,l);const p=!a&&l||bt$5;let g=a&&l||bt$5;g=copy(Tt$5,g),g[0]&&(g[0]=Ot$5(t,g[0],d)),g[1]&&(g[1]=Ot$5(t,g[1],d,1));let m=.5;n&&(m=Ot$5(t,n,d));let v=m/h;if(r&&(v=Ot$5(t,r,d,1)),u&&(u[0]||u[1])){const i=performance.now()/1e3;let e=u[0],s=u[1];a&&(e=-Ot$5(t,u[0],d),s=-Ot$5(t,u[1],d,1)),u[0]&&(a?g[0]=i*e:p[0]=i*e),u[1]&&(a?g[1]=i*s:p[1]=i*s)}const w=(i+g[0])/(m/o[0]),x=(e-g[1])/(v/o[1]);return At$5[0]=m/o[0],At$5[1]=v/o[1],At$5[2]=w,At$5[3]=x,At$5[4]=p,At$5}(t,o,a,f,m,v,l,g,d,p,w),S=2*s.getWidth()/x,C=2*s.getHeight()/M;if(!this.material)return this.S.setUniform("uvScale",set(Pt$5,S,C)),void this.S.setUniform("uvOffset",set(Dt$5,_%1+b[0],y%1+b[1]));this.S.setUniform("uvScale",set(Gt$4,S,C)),this.S.setUniform("uvOffset",set(Ht$4,_%1+b[0],y%1+b[1])),this.S.setUniform("uvOrigin",set(Nt$5,_-_%1,y-y%1))}q(t){let i=!1;const e=this.S.defines,s=this.s.ut&&this.s.ut(),n=this.s.getGroundConfig();function r(t,s){t?e[s]||(e[s]=1,i=!0):e[s]&&(delete e[s],i=!0)}r(this.ct(),"HAS_IBL_LIGHTING"),r(t&&t.ssr&&n&&n.symbol&&n.symbol.ssr,"HAS_SSR");const h=t&&s&&s.shadow&&s.shadow.enable;return r(h,"HAS_SHADOWING"),r(h,"USE_ESM"),r(!!this.Z,"HAS_PATTERN"),r(t&&t.ssao,"HAS_SSAO"),i?e:null}tt(){const t=this.getSymbol()&&this.getSymbol().material;if(!t)return;const i={};let e=!1;for(const s in t)if(dt$5(t,s))if(s.indexOf("Texture")>0){let n=t[s];if(!n)continue;n="string"==typeof n?{url:n,wrap:"repeat"}:n,n.flipY=!0,n.min="linear mipmap linear",n.mag="linear",n.flipY=!0,i[s]=new en$5(n,this.N),e=!0}else i[s]=t[s];this.material?(this.ft=new fi$4.StandardMaterial(i),this.ft.isReady()?this.j():this.ft.once("complete",this.G)):(this.material=new fi$4.StandardMaterial(i),this.material.once("complete",this.G,this)),e||this.j()}j(){this.ft&&(this.material.dispose(),this.material=this.ft,delete this.ft),this.setToRedraw(!0)}K(t){t=N$6.resizeToPowerOfTwo(t);return this.H.texture({width:t.width,height:t.height,data:t,mag:"linear",min:"linear mipmap linear",flipY:!0,wrap:"repeat"})}nt(t){if(t.ambientUpdate){this.et();const t=this.getMap();t&&(this.ht=It$5(this.H,t))}this.setToRedraw()}X(t){return mt$5([],t)}B(){return this.material&&this.material.get("uvOffsetAnim")}getRenderMeshes(){return this.D.getMeshes()}}const{createIBLTextures:Bt$5,disposeIBLTextures:Ut$4}=fi$4.PBRUtils,zt$4=[0,0,0],Vt$4=[],Wt$4=[];class qt$4{constructor(t,i){this.dt=4,this.H=t,this.renderer=new B$6(t),this.s=i,this.h(),this.pt()}paint(t){if(!this.isEnable()||!this.gt)return;const i=this.$(t);this.renderer.render(this.vt,i,null,t&&t.renderTarget&&t.renderTarget.fbo)}update(){const t=this.getMap();if(!t||!this.isEnable())return;const i=t.getLightManager(),e=i&&i.getAmbientResource();e!==this.gt&&this.ht&&(Ut$4(this.ht),delete this.ht),this.gt=e,this.pt()}dispose(){this.vt.dispose(),Ut$4(this.ht),delete this.vt,delete this.ht,delete this.gt}getMap(){return this.s.getMap()}pt(){if(!this.gt)return;const t=this.s.ut();this.vt.setMode(1,0,t.environment&&t.environment.mode?1:0)}isEnable(){const t=this.s.ut();return this.ct()&&t&&t.environment&&t.environment.enable}ct(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}$(){const t=this.getMap(),i=this.getMap().getLightManager(),e=i&&i.getAmbientLight();let s=this.ht;s||(s=this.ht=Bt$5(this.H,t));const n=this.s.getRenderer().canvas,r=this.s.ut().environment||{},h=r.level||0,o=s.prefilterMap.width,a=this.wt=this.wt||[],f=r.brightness||0;return copy$4(Vt$4,e&&e.hsv||zt$4),f&&(Vt$4[2]+=f),Wt$4[0]=n.width,Wt$4[1]=n.height,{rgbmRange:s.rgbmRange,cubeMap:s.prefilterMap,bias:h,size:o/Math.pow(2,Math.max(0,h-1)),environmentExposure:ct$5(e&&e.exposure)?e.exposure:1,diffuseSPH:s.sh,viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,resolution:Wt$4,hsv:Vt$4,transformMatrix:fromRotation$2(a,e&&Math.PI/180*-e.orientation||0)}}h(){const t=this.getMap();if(t.on("updatelights",this.update,this),this.vt=new qn$4,t.options.lights){const t=this.getMap().getLightManager().getAmbientResource();this.gt=t}}}const $t$4=[],Yt$4=[.03,.03,.03],Xt$4=[],Jt$4=[],Zt$4=[],Kt$4=[1,1,1],Qt$4=[-1200,-1200,0],ti$3=[1200,1200,1e3],ii$3={min:[],max:[]},ei$3=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class si$3{constructor(t,i){this.H=t,this.renderer=new B$6(t),this.s=i,this.xt=new ni$3,this.h()}getMap(){return this.s&&this.s.getMap()}h(){const t=this.s.getRenderer().canvas;this.vt=new vn$4({vert:"attribute vec3 aPosition;\nattribute vec3 aNormal;\nattribute vec2 aTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform vec3 cameraPosition;\nuniform float top;\nuniform float bottom;\nuniform float time;\nvarying vec2 vTexCoord;\n#include <get_output>\nfloat angle(float x, float y){\n    return atan(y, x);\n}\nvec2 getFoot(vec2 camera, vec2 normal, vec2 pos) {\n    vec2 position = vec2(0.0, 0.0);\n    float distanceLen = distance(pos, normal);\n    float a = angle(camera.x - normal.x, camera.y - normal.y);\n    pos.x > normal.x ? a -= 0.785 : a += 0.785;\n    position.x = cos(a) * distanceLen;\n    position.y = sin(a) * distanceLen;\n    return position + normal;\n    return position;\n}\nvoid main()\n{\n    vec4 localPosition = getPosition(aPosition);\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec2 foot = getFoot(vec2(cameraPosition.x, cameraPosition.z), vec2(aNormal.x, aNormal.z), vec2(localPosition.x, localPosition.z));\n    float height = top - bottom;\n    float y = aNormal.y - bottom - height * time;\n    y = y + (y < 0.0 ? height : 0.0);\n    float ratio = (1.0 - y / height) * (1.0 - y / height);\n    y = height * (1.0 - ratio);\n    y += bottom;\n    y += aPosition.y - aNormal.y;\n    localPosition = vec4( foot.x, y, foot.y , 1.0);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"precision mediump float;\nvarying vec2 vTexCoord;\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D rainMap;\nvoid main() {\n    vec4 rainColor = texture2D(rainMap, vTexCoord);\n    vec4 diffuseColor = vec4(diffuse, opacity);\n    diffuseColor *= rainColor;\n    gl_FragColor = diffuseColor;\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,i){return multiply$5($t$4,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"less",range:[0,1]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.Mt()}Mt(){const t=this.H.texture({width:2,height:2});if(this._t=this.yt(),!this._t)return;this.bt=new Ke$5(this._t);const i=this.St();i.rainTexture?this.Ct(i.rainTexture).then((t=>{this._t.material.set("rainMap",t)})):(this._t.material.set("rainMap",t),console.warn("should set rain texture."))}yt(){const t=this.getMap(),i=this.St();if(!i)return null;this.Tt=t.getZoom();const e=this.kt(),s=this.At=i.density,n=this.Ot=i.rainWidth||1,r=this.It=i.rainHeight||1,h=[],o=[],a=[],l=[];for(let t=0;t<s;t++){const i={};i.x=Math.random()*(e.max[0]-e.min[0])+e.min[0],i.y=Math.random()*(e.max[2]-e.min[2])+e.min[2],i.z=Math.random()*(e.max[1]-e.min[1])+e.min[1];const s=(e.max[2]-e.min[2])/37.5*r,c=s/3*n;h.push(i.x+c,i.y+s,i.z,i.x-c,i.y+s,i.z,i.x-c,i.y,i.z,i.x+c,i.y,i.z),o.push(i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z,i.x,i.y-s/2,i.z),a.push(1,1,0,1,0,0,1,0),l.push(4*t+0,4*t+1,4*t+2,4*t+0,4*t+2,4*t+3)}const c={};c.POSITION=h,c.NORMAL=o,c.TEXCOORD_0=a;const u=new Q$7(c,l,0,{primitive:"triangles",positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});u.generateBuffers(this.renderer.regl);const f=new Ce$5({rainMap:this.H.texture({width:2,height:2}),diffuse:i.color||[1,1,1],opacity:i.opacity||1}),d=new Be$5(u,f);return d.setUniform("top",e.max[2]),d.setUniform("bottom",e.min[2]),this.Et(d),d.transparent=!0,d}Ct(t){const i=new Image;return i.src=this.Lt=t,new Promise(((t,e)=>{i.onload=()=>{const e=this.H.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"clamp",wrapT:"clamp",data:i});t(e)},i.onerror=t=>{e(t)}}))}paint(t){if(!this.bt)return;const i=this.St(),e={},s=this.getMap();e.projMatrix=s.projMatrix,e.viewMatrix=s.viewMatrix,e.cameraPosition=s.cameraPosition;const n=i.speed||1,r=this.xt.getElapsedTime()/(2/n)%1;e.time=r,this._t.material.set("diffuse",i.color||Kt$4),this._t.material.set("opacity",i.opacity||1),this.Et(this._t);this.renderer.render(this.vt,e,this.bt,t&&t.renderTarget&&t.renderTarget.fbo),this.s.getRenderer().setCanvasUpdated()}Et(t){const i=this.getMap(),e=i.coordinateToPointAtRes(i.getCenter(),i.getGLRes()),s=i.getGLScale()/i.getGLScale(this.Tt),n=set$4(Jt$4,s,s,s),r=multiply$4(n,Yt$4,n),h=identity$2(Zt$4),o=this.St(),c=i.getBearing();fromRotationTranslationScale(h,fromEuler(Xt$4,o.windDirectionX||0,o.windDirectionY||0,90-c),[e.x,e.y,0],r),multiply$5(h,h,ei$3),t.setLocalTransform(h)}setToRedraw(){const t=this.s.getRenderer();t&&t.setToRedraw()}update(){const t=this.St();if(t){if(this._t||this.Mt(),t.density!==this.At||t.rainWidth!==this.Ot||t.rainHeight!==this.It){const t=this._t.material.get("rainMap");this._t.geometry.dispose(),this._t.dispose(),this.bt.clear(),this._t=this.yt(),this._t.material.set("rainMap",t),this.bt.setMeshes(this._t)}t.rainTexture!==this.Lt&&this.Ct(t.rainTexture).then((t=>{this._t.material.set("rainMap",t)}))}}dispose(){this._t&&(this._t.geometry.dispose(),this._t.material&&this._t.material.dispose(),this._t.dispose(),delete this._t),this.vt&&(this.vt.dispose(),delete this.vt)}isEnable(){const t=this.St();return t&&t.enable}St(){const t=this.s.getWeatherConfig();return t&&t.rain}kt(){const t=16.685648411389433-this.getMap().getZoom();return scale$4(ii$3.min,Qt$4,Math.pow(2,t)),scale$4(ii$3.max,ti$3,Math.pow(2,t)),ii$3}}class ni$3{constructor(t){this.autoStart=void 0===t||t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=("undefined"==typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const i=("undefined"==typeof performance?Date:performance).now();t=(i-this.oldTime)/1e3,this.oldTime=i,this.elapsedTime+=t}return 0}}const ri$3=[],hi$3=[.03,.03,.03],oi$3=[],ai$3=[],li$3=[],ci$3=fromRotationTranslation$1([],fromEuler([],90,0,0),[0,0,0]);class ui$3{constructor(t,i){this.H=t,this.s=i,this.h()}h(){const t=this.s.getRenderer().canvas;this.vt=new vn$4({vert:"#include <gl2_vert>\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\n#include <get_output>\nvoid main()\n{\n    mat4 localPositionMatrix = getPositionMatrix();\n    vec4 localPosition = getPosition(aPosition);\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * localPosition;\n    vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nprecision mediump float;\nuniform sampler2D perlinTexture;\nvarying vec2 vTexCoord;\nfloat lerp(float a, float b, float w) {\n    return a + w * (b - a);\n}\nvoid main() {\n    float snowIntense = texture2D(perlinTexture, vTexCoord).r;\n    vec3 fixedC = vec3(1.0, 1.0, 1.0);\n    float r = lerp(0.5, fixedC.x, snowIntense);\n    float g = lerp(0.5, fixedC.y, snowIntense);\n    float b = lerp(0.5, fixedC.z, snowIntense);\n    glFragColor = vec4(r, g, b, 1.0);\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,i){return multiply$5(ri$3,i.viewMatrix,i.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height}}}),this.vt.version=300,this.bt=new Ke$5,this.Ft=this.Rt(),this.bt.setMeshes(this.Ft),this.renderer=new B$6(this.H);const e=this.Pt();e&&(e.snowGroundTexture?this.Dt(e.snowGroundTexture):(this.Ht=this.H.texture({width:2,height:2}),console.warn("should set snow ground texture.")))}render(t){this.Ht&&this.Ft.material.set("perlinTexture",this.Ht);const i=this.s.getMap();this.Nt(i);this.renderer.render(this.vt,{projMatrix:i.projMatrix,viewMatrix:i.viewMatrix,cameraPosition:i.cameraPosition},this.bt,t&&t.renderTarget&&t.renderTarget.fbo),this.s.getRenderer().setCanvasUpdated()}Nt(t){const i=t.coordinateToPointAtRes(t.getCenter(),t.getGLRes()),e=t.getGLScale()/t.getGLScale(this.Tt),s=set$4(ai$3,e,e,e),n=multiply$4(s,hi$3,s),r=identity$2(li$3);fromRotationTranslationScale(r,fromEuler(oi$3,0,0,0),[i.x,i.y,.005],n),multiply$5(r,r,ci$3),this.Ft.setLocalTransform(r)}Dt(t){const i=new Image;i.onload=()=>{this.Ht=this.H.texture({mag:"linear",min:"linear mipmap nearest",wrapS:"repeat",wrapT:"repeat",data:i})},i.onerror=t=>{console.log(t)},i.src=this.Gt=t}Rt(){const t=this.s.getMap();this.Tt=t.getZoom();const i=16e3*Math.pow(2,16.685648411389433-this.Tt),s={};s.POSITION=[-i,0,-i,i,0,-i,-i,0,i,i,0,i],s.NORMAL=[0,1,0,0,1,0,0,1,0,0,1,0],s.TEXCOORD_0=[0,0,1,0,0,1,1,1];const n=new Q$7(s,[3,1,0,0,2,3],0,{positionAttribute:"POSITION",normalAttribute:"NORMAL",uv0Attribute:"TEXCOORD_0"});n.generateBuffers(this.H);const r=new Ce$5({perlinTexture:this.H.texture({with:2,height:2})});return new Be$5(n,r)}getMeshes(){return this.Ft}dispose(){this.Ft&&(this.Ft.geometry.dispose(),this.Ft.material&&this.Ft.material.dispose(),this.Ft.dispose(),delete this.Ft),this.vt&&(this.vt.dispose(),delete this.vt)}update(){const t=this.Pt();t&&t.snowGroundTexture===!this.Gt&&this.Dt(t.snowGroundTexture)}isEnable(){const t=this.St();return t&&t.enable}Pt(){const t=this.s.getWeatherConfig();return t&&t.snow}}
/*!
	 * @maptalks/gltf-loader v0.95.2
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */if(identity$1([]),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(t){}}"undefined"!=typeof document&&document.createElement("canvas");const fi$3=[];class di$3{constructor(t,i,e){this.H=t,this.s=i,this.jt=e,this.h()}h(){this.renderer=new B$6(this.H);const t=this.s.getRenderer(),i=this.Bt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Ut=i.width,this.zt=i.height,this.Vt=this.H.framebuffer({color:this.H.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.EMPTY_TEXTURE=this.H.texture({with:2,height:2}),this.Wt=new si$3(this.H,this.s),this.qt=new dt$6(this.H,i),this.$t=new ui$3(this.H,this.s),this.Yt=new rt$6(this.H,i,this.s),this.Xt=new it$5,this.Xt.version=300}getMap(){return this.s&&this.s.getMap()}renderScene(t){this.renderSnowMask(t),this.renderRain(t)}renderRain(t){this.isEnableRain()&&this.Wt.paint(t)}renderSnowMask(t){if(!this.isEnableSnow())return;const i=this.getMap();this.$t.render(t,i)}paint(t,i){if(!i||!i.length)return t;this.Jt();const e=this.s.getWeatherConfig(),s={};var n;if(this.isEnableRain()?(s.ripplesMap=this.Zt(),this.Xt.shaderDefines.HAS_RAIN=1):delete this.Xt.shaderDefines.HAS_RAIN,this.isEnableSnow()?(this.Xt.shaderDefines.HAS_SNOW=1,s.snowIntensity="number"!=typeof(n=e.snow.snowIntensity)||isNaN(n)?.5:e.snow.snowIntensity,i.forEach((t=>{t.defines.HAS_SNOW=1}))):(delete this.Xt.shaderDefines.HAS_SNOW,i.forEach((t=>{delete t.defines.HAS_SNOW}))),this.isEnableFog()){s.fogColor=e.fog.color||[.9,.9,.9],this.Xt.shaderDefines.HAS_FOG=1}else delete this.Xt.shaderDefines.HAS_FOG;return this.Xt.setDefines(this.Xt.shaderDefines),s.mixFactorMap=this.Kt(i)||this.EMPTY_TEXTURE,s.sceneMap=t,s.time=this.Qt()/1e3,s.resolution=set(fi$3,this.Vt.width,this.Vt.height),this.renderer.render(this.Xt,s,null,this.Vt),this.ti=i,this.Vt}Kt(t){const i={},e=this.getMap(),s=e.getZoom(),n=Math.pow(2,16.685648411389433-s),r=this.s.getWeatherConfig(),h=r.fog;if(!h||!h.enable)return null;const o=h.start||.1,a=h.end||100;i.projMatrix=e.projMatrix,i.viewMatrix=e.viewMatrix,i.cameraPosition=e.cameraPosition,i.fogDist=[o*n,a*n],i.rainDepth=e.altitudeToPoint(r.rain&&r.rain.rainDepth||.1,e.getGLRes());const l=this.Yt.render(t,i);return this.s.getRenderer().ii(l)}Zt(){const t=this.getMap(),i=this.s.getWeatherConfig(),e=i.rain.rippleRadius||24,s={};return s.projMatrix=t.projMatrix,s.viewMatrix=t.viewMatrix,s.time=this.Qt()/1e3,s.rippleRadius=e,s.density=i.rain.density||2e3,this.qt.render(t,s)}Qt(){if(!this.s)return 0;if(void 0===this.ei&&(this.ei=0),this.isPlaying()){const t=this.s.getRenderer();this.ei=t.getFrameTime()}return this.ei}isEnable(){const t=this.s.getWeatherConfig();return t&&t.enable}isEnableRain(){const t=this.s.getWeatherConfig();return t&&t.enable&&t.rain&&t.rain.enable}isEnableFog(){const t=this.s.getWeatherConfig();return t&&t.enable&&t.fog&&t.fog.enable}isEnableSnow(){const t=this.s.getWeatherConfig();return t&&t.enable&&t.snow&&t.snow.enable}isPlaying(){const t=this.s.getWeatherConfig();return!!t&&!1!==t.playing}si(){return this.isEnableRain()||this.isEnableFog()||this.isEnableSnow()}update(){!this.isEnable()&&this.ti&&this.ti.forEach((t=>{delete t.defines.HAS_SNOW,delete t.defines.HAS_RAIN,delete t.defines.HAS_FOG})),this.isEnableRain()&&(this.Wt=this.Wt||new si$3(this.H,this.s),this.Wt.update()),this.isEnableSnow()&&(this.$t=this.$t||new ui$3(this.H,this.s),this.$t.update())}getShadowMeshes(){return this.$t.getMeshes()}Jt(){const t=this.Ut(),i=this.zt();!this.Vt||this.Vt.width===t&&this.Vt.height===i||this.Vt.resize(t,i)}dispose(){this.Vt&&this.Vt.destroy(),this.Xt&&(this.Xt.dispose(),delete this.Xt),this.Wt&&(this.Wt.dispose(),delete this.Wt),this.$t&&(this.$t.dispose(),delete this.$t)}}const pi$3=[],gi$3=t=>!!t.bloom,mi$3=t=>!!t.ssr;class vi$3{constructor(t,i,e){this.H=t,this.s=i,this.ni=new B$6(t),this.ri=new Cn$4,this.hi=new Hn$4(this.ni,e),this.oi=new Zn$4,this.ai=new jn$4(this.H)}setContextIncludes(){}bloom(t,i,e,s,n,r,h){this.li||(this.li=new Un$4(this.H));const o=this.s.getRenderer().ii(this.ci);return this.li.render(t,o,s,n,r,i,e,h)}drawBloom(t){const i=this.s.getRenderer(),e=this.H,s=this.ci;if(s){const{width:i,height:n}=t;s.width===i&&s.height===n||s.resize(i,n),e.clear({color:[0,0,0,0],framebuffer:s})}else{const i=this.ui(t);this.ci=e.framebuffer(i)}const n=i.getFrameTime(),r=i.getFrameEvent(),h=i.getFrameContext(),o=h.renderMode,a=h.sceneFilter,l=h.renderTarget;h.isPostProcess=!0,h.renderMode="default",h.sceneFilter=gi$3,h.renderTarget={fbo:this.ci,getFramebuffer:wi$3,getDepthTexture:xi$3};const c=i.glCtx;return c.resetDrawCalls(),i.forEachRenderer(r?t=>{i.clearStencil(t,s),t.drawOnInteracting(r,n,h)}:t=>{i.clearStencil(t,s),t.draw(n,h)}),delete h.isPostProcess,h.renderMode=o,h.sceneFilter=a,h.renderTarget=l,c.getDrawCalls()}genSsrMipmap(t,i){const e=this.s.getMap().projViewMatrix;this.ai.genMipMap(t,i,e)}getPrevSsrProjViewMatrix(){return this.ai&&this.ai.getPrevProjViewMatrix()}drawSSR(t,i,e){e&&this.ai.copyDepthTex(t);const s=this.s.getRenderer(),n=s.getFrameTime(),r=s.getFrameEvent(),h=s.getFrameContext();h.isPostProcess=!0,h.ssr=this.getSSRContext();const o=h.renderMode,a=h.sceneFilter;h.renderMode="default",h.sceneFilter=mi$3,h.renderTarget.fbo=i;const l=s.glCtx;let c=!1;s.forEachRenderer(r?t=>{s.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.drawOnInteracting(r,n,h)}:t=>{s.clearStencil(t,i),c||(l.resetDrawCalls(),c=!0),t.draw(n,h)});const u=s.drawGround();return delete h.ssr,delete h.isPostProcess,h.renderMode=o,h.sceneFilter=a,this.fi=l.getDrawCalls()>0,u}getSSRUniforms(){const t=this.s.ut(),i=t&&t.postProcess,e=this.s.getMap();return this.ai.getSSRUniforms(e,i.ssr.factor,i.ssr.quality)}getSSRContext(){const t=this.s.ut(),i=t&&t.postProcess,e=this.s.getMap(),s=this.ai.getSSRUniforms(e,i.ssr.factor,i.ssr.quality);return s?{renderUniforms:s,defines:{HAS_SSR:1}}:null}taa(t,i,{projMatrix:e,needClear:s}){const n=this.hi;return{outputTex:n.render(t,i,e,s),redraw:n.needToRedraw()}}isTaaNeedRedraw(){return this.hi.needToRedraw()}ssao(t,i,e){return this.di||(this.di=new Dn$4(this.ni),this.s.getRenderer().setToRedraw()),this.di.render({projMatrix:e.projMatrix,cameraNear:e.cameraNear,cameraFar:e.cameraFar,bias:e.ssaoBias,radius:e.ssaoRadius,intensity:e.ssaoIntensity,quality:.6},t,i)}fxaa(t,i,e,s,n,r,h,o,a,l,u,f,d,p,g,m){!t||t.width===i.fbo&&t.height===i.height||t.resize(i.width,i.height);const v={};n?v.HAS_TAA_TEX=1:delete v.HAS_TAA_TEX,r?v.HAS_FXAA_TEX=1:delete v.HAS_FXAA_TEX,f?v.HAS_OUTLINE_TEX=1:delete v.HAS_OUTLINE_TEX,e?v.HAS_NOAA_TEX=1:delete v.HAS_NOAA_TEX,s?v.HAS_POINT_TEX=1:delete v.HAS_POINT_TEX,this.ri.setDefines(v),this.ni.render(this.ri,{textureSource:i,noAaTextureSource:e,pointTextureSource:s,taaTextureSource:n,fxaaTextureSource:r,resolution:set(pi$3,i.width,i.height),enableFXAA:h,enableToneMapping:o,enableSharpen:a,pixelRatio:l,sharpFactor:u,textureOutline:f,highlightFactor:d,outlineFactor:p,outlineWidth:g,outlineColor:m},null,t)}renderFBOToScreen(t,i,e,s){this.pi||(this.pi=[]),this.pi[0]=t.width,this.pi[1]=t.height;const n=this.s.getRenderer();this.ni.render(this.oi,{texture:t.color&&n.ii(t)||t,size:this.pi,enableSharpen:+!!i,sharpFactor:e,pixelRatio:s})}postprocess(t,i,e){this.gi||(this.gi=new Rn$4);const s=this.s&&this.s.getRenderer(),n=e||s.ii(t);return i.resolution=set(pi$3,n.width,n.height),i.textureSource=n,i.timeGrain=performance.now(),this.ni.render(this.gi,i),this.mi}dispose(){this.ci&&(this.ci.destroy(),delete this.ci),this.hi&&(this.hi.dispose(),delete this.hi),this.di&&(this.di.dispose(),delete this.di),this.li&&(this.li.dispose(),delete this.li),this.gi&&(this.gi.dispose(),delete this.gi),this.ri&&(this.ri.dispose(),delete this.ri),this.oi&&(this.oi.dispose(),delete this.oi)}ui(t,i){const{width:e,height:s}=this.s.getRenderer().canvas,n=this.H;let r;r=this.s.getRenderer().vi()?n.renderbuffer({width:e,height:s,samples:this.s.options.multiSamples,format:"rgba8"}):n.texture({min:"nearest",mag:"nearest",format:i||"rgba",width:e,height:s});const h={width:e,height:s,colors:[r]};return t&&(h.depthStencil=t),h}}function wi$3(t){return t._framebuffer.framebuffer}function xi$3(t){return t.depthStencil._texture.texture}class Mi$3 extends Mn$4{constructor(t){super({vert:"#if __VERSION__ == 300\n\t#define attribute in\n\t#define varying out\n#endif\nattribute vec2 aPosition;\nattribute vec2 aTexCoord;\nvarying vec2 vTexCoord;\nvoid main()\n{\n  gl_Position = vec4(aPosition, 0., 1.);\n  vTexCoord = aTexCoord;\n}",frag:"#if __VERSION__ == 100\n  #ifdef GL_OES_standard_derivatives\n    #extension GL_OES_standard_derivatives : enable\n  #endif\n#endif\nprecision mediump float;\n#include <gl2_frag>\nvarying vec2 vTexCoord;\n#ifdef HAS_FLOODANALYSE\n    uniform vec3 flood_waterColor;\n    uniform float flood_waterOpacity;\n    uniform sampler2D floodMap;\n#endif\n#ifdef HAS_SKYLINE\n    uniform sampler2D skylineMap;\n#endif\n#ifdef HAS_VIEWSHED\n    uniform vec4 viewshed_visibleColor;\n    uniform vec4 viewshed_invisibleColor;\n    uniform sampler2D viewshedMap;\n#endif\n#ifdef HAS_INSIGHT\n    uniform vec4 insight_visibleColor;\n    uniform vec4 insight_invisibleColor;\n    uniform sampler2D insightMap;\n#endif\n#ifdef HAS_CUT\n    uniform sampler2D meshesMap;\n    uniform sampler2D invisibleMap;\n#endif\n#ifdef HAS_EXCAVATE\n    uniform sampler2D excavateMap;\n#endif\n#ifdef HAS_CROSSCUT\n    uniform sampler2D crosscutMap;\n    uniform vec4 cutLineColor;\n#endif\n#ifdef HAS_HEIGHTLIMIT\n    uniform vec3 limitColor;\n    uniform sampler2D heightLimitMap;\n#endif\nuniform sampler2D sceneMap;\nvoid main() {\n    vec4 sceneColor = texture2D(sceneMap, vTexCoord);\n    glFragColor = sceneColor;\n    #ifdef HAS_VIEWSHED\n        vec4 viewshedColor = texture2D(viewshedMap, vTexCoord);\n        if (viewshedColor.r > 0.99) {\n            glFragColor = vec4(mix(viewshed_invisibleColor.rgb, sceneColor.rgb, viewshed_invisibleColor.a), sceneColor.a);\n        } else if (viewshedColor.g > 0.99) {\n            glFragColor = vec4(mix(viewshed_visibleColor.rgb, sceneColor.rgb, viewshed_visibleColor.a), sceneColor.a);\n        } else if (viewshedColor.a < 0.01) {\n            glFragColor = vec4(viewshedColor.rgb, 1.0);\n        }\n    #endif\n    #ifdef HAS_FLOODANALYSE\n        vec4 floodColor = texture2D(floodMap, vTexCoord);\n        if (floodColor.r > 0.0) {\n            glFragColor = vec4(mix(glFragColor.rgb, flood_waterColor, flood_waterOpacity), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_SKYLINE\n        vec4 skylineColor = texture2D(skylineMap, vTexCoord);\n        if (skylineColor.r > 0.0 || skylineColor.g > 0.0 || skylineColor.b > 0.0) {\n            glFragColor = skylineColor;\n        }\n    #endif\n    #ifdef HAS_INSIGHT\n        vec4 insightColor = texture2D(insightMap, vTexCoord);\n        if (insightColor.g > 0.0) {\n            glFragColor = insight_visibleColor;\n        } else if (insightColor.r > 0.0) {\n            glFragColor = insight_invisibleColor;\n        }\n    #endif\n    #ifdef HAS_CUT\n        vec4 cutColor = texture2D(invisibleMap, vTexCoord);\n        vec4 meshesMapColor = texture2D(meshesMap, vTexCoord);\n        if (cutColor.r == 1.0 && cutColor.g == 0.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 1.0 && cutColor.b == 0.0) {\n            glFragColor = meshesMapColor;\n        } else if (cutColor.r == 0.0 && cutColor.g == 0.0 && cutColor.b == 1.0) {\n          glFragColor = sceneColor;\n        }\n    #endif\n    #ifdef HAS_EXCAVATE\n        vec4 excavateColor = texture2D(excavateMap, vTexCoord);\n        if (excavateColor.r == 1.0 && excavateColor.g == 0.0 && excavateColor.b == 0.0) {\n          glFragColor = sceneColor;\n        }  else {\n          glFragColor = excavateColor;\n        }\n    #endif\n    #ifdef HAS_CROSSCUT\n        vec4 crosscutColor = texture2D(crosscutMap, vTexCoord);\n        if (crosscutColor.r > 0.0) {\n            glFragColor = vec4(mix(cutLineColor.rgb, glFragColor.rgb, 0.99), glFragColor.a);\n        }\n    #endif\n    #ifdef HAS_HEIGHTLIMIT\n        vec4 heightLimitColor = texture2D(heightLimitMap, vTexCoord);\n        if (heightLimitColor.r > 0.0) {\n            glFragColor = vec4(mix(limitColor, glFragColor.rgb, 0.6), glFragColor.a);\n        }\n    #endif\n    #if __VERSION__ == 100\n        gl_FragColor = glFragColor;\n    #endif\n}",extraCommandProps:{viewport:t,cull:{enable:!0},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}})}}class _i$3{constructor(t,i,e){this.H=t,this.s=i,this.jt=e,this.h()}h(){this.renderer=new B$6(this.H);const t=this.s.getRenderer(),i=this.Bt={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.Vt=this.H.framebuffer({color:this.H.texture({width:t.canvas?t.canvas.width:1,height:t.canvas?t.canvas.height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.vt=new Mi$3(i)}getMap(){return this.s&&this.s.getMap()}paint(t,i){if(!i&&i.length)return t;this.Jt();const e={},s=this.s.wi;if(!this.xi())return t;this.H.clear({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.Vt}),delete this.vt.shaderDefines.HAS_FLOODANALYSE,delete this.vt.shaderDefines.HAS_VIEWSHED,delete this.vt.shaderDefines.HAS_SKYLINE,delete this.vt.shaderDefines.HAS_INSIGHT,delete this.vt.shaderDefines.HAS_CUT,delete this.vt.shaderDefines.HAS_CROSSCUT,delete this.vt.shaderDefines.HAS_HEIGHTLIMIT;for(let t=0;t<s.length;t++){const n=s[t];if(!n.isEnable())continue;const r=n.getDefines();at$5(this.vt.shaderDefines,r);const h=this.getMap(),o=h.width,a=h.height,l=this.Mi(i,n.getExcludeLayers()),c=n.renderAnalysis(l,o,a);c&&at$5(e,c)}return e.sceneMap=t,this.vt.setDefines(this.vt.shaderDefines),this.renderer.render(this.vt,e,null,this.Vt),this.Vt}Mi(t,i){let e=[];for(let s=0;s<t.length;s++){if(i.indexOf(t[s].getId())>-1)continue;const n=t[s].getRenderer();if(n&&n.getAnalysisMeshes){const t=n.getAnalysisMeshes();t.forEach((t=>{t.setUniform("useAnalysis",1)})),e=e.concat(t)}}return e}Jt(){const t=t$1.Util.isFunction(this.Bt.width.data)?this.Bt.width.data():this.Bt.width,i=t$1.Util.isFunction(this.Bt.height.data)?this.Bt.height.data():this.Bt.height;!this.Vt||this.Vt.width===t&&this.Vt.height===i||this.Vt.resize(t,i)}xi(){const t=this.s&&this.s.wi;if(!t)return!1;for(let i=0;i<t.length;i++)if(t[i].isEnable())return!0;return!1}}const yi$3=[0,0,0,0],bi$3=[1,1,-1],Si$3=[0,0],Ci$3=t=>!t.bloom&&!t.ssr,Ti$3=t=>!t.bloom,ki$3=t=>!t.ssr;function Oi$3(t){return"number"==typeof t&&!isNaN(t)}function Ii$3(t){return t._framebuffer.framebuffer}function Ei$3(t){return t.depthStencil._texture.texture}function Li$3(t,i,e){return null==t[i]?e:t[i]}class Fi$3 extends t__namespace.worker.Actor{constructor(t){super("@maptalks/terrain"),this.mapId=t}checkUrl(i){return i&&t__namespace.Util.isString(i)?t__namespace.Util.getAbsoluteURL(i):i}fetchTerrain(t,i,e){t=this.checkUrl(t);const s={actorId:this.actorId,mapId:this.mapId,command:"fetchTerrain",params:{url:t,origin:location.origin,terrainWidth:i.terrainWidth,type:i.type,accessToken:i.accessToken,cesiumIonTokenURL:i.cesiumIonTokenURL,error:i.error}};this.send(s,null,((t,i)=>{t?e(t):e(t,i)}))}abortTerrain(t,i){this.broadcast({actorId:this.actorId,mapId:this.mapId,command:"abortTerrain",params:{url:t}},null,i)}addLayer(t,i,e){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{}},null,e)}createTerrainMesh(t,i){this.send({actorId:this.actorId,command:"createTerrainMesh",params:t},[t.terrainHeights.data.buffer],((t,e)=>{t?i(t):i(t,e)}))}removeLayer(t,i,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}}class Ri$3{constructor(t=257){this.gridSize=t;const i=t-1;if(i&i-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=i*i*2-2,this.numParentTriangles=this.numTriangles-i*i,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let e=t+2,s=0,n=0,r=0,h=0,o=0,a=0;for(1&e?r=h=o=i:s=n=a=i;(e>>=1)>1;){const t=s+r>>1,i=n+h>>1;1&e?(r=s,h=n,s=o,n=a):(s=r,n=h,r=o,h=a),o=t,a=i}const l=4*t;this.coords[l+0]=s,this.coords[l+1]=n,this.coords[l+2]=r,this.coords[l+3]=h}}createTile(t){return new Pi$3(t,this)}}class Pi$3{constructor(t,i){const e=i.gridSize;if(t.length!==e*e)throw new Error(`Expected terrain data of length ${e*e} (${e} x ${e}), got ${t.length}.`);this.terrain=t,this.martini=i,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:i,coords:e,gridSize:s}=this.martini,{terrain:n,errors:r}=this;for(let h=t-1;h>=0;h--){const t=4*h,o=e[t+0],a=e[t+1],l=e[t+2],c=e[t+3],u=o+l>>1,f=a+c>>1,d=u+f-a,p=f+o-u,m=f*s+u,v=Math.abs((n[a*s+o]+n[c*s+l])/2-n[m]);if(r[m]=Math.max(r[m],v),h<i){r[m]=Math.max(r[m],r[(a+p>>1)*s+(o+d>>1)],r[(c+p>>1)*s+(l+d>>1)])}}}getMesh(t=0){const{gridSize:i,indices:e}=this.martini,{errors:s}=this;let n=0,r=0;const h=i-1;function o(h,a,l,c,u,f){const d=h+l>>1,p=a+c>>1;Math.abs(h-u)+Math.abs(a-f)>1&&s[p*i+d]>t?(o(u,f,h,a,d,p),o(l,c,u,f,d,p)):(e[a*i+h]=e[a*i+h]||++n,e[c*i+l]=e[c*i+l]||++n,e[f*i+u]=e[f*i+u]||++n,r++)}e.fill(0),o(0,0,h,h,h,0),o(h,h,0,0,0,h);const a=new Uint16Array(2*n),l=new Uint32Array(3*r);let c=0;function u(n,r,h,o,f,d){const p=n+h>>1,g=r+o>>1;if(Math.abs(n-f)+Math.abs(r-d)>1&&s[g*i+p]>t)u(f,d,n,r,p,g),u(h,o,f,d,p,g);else{const t=e[r*i+n]-1,s=e[o*i+h]-1,u=e[d*i+f]-1;a[2*t]=n,a[2*t+1]=r,a[2*s]=h,a[2*s+1]=o,a[2*u]=f,a[2*u+1]=d,l[c++]=t,l[c++]=s,l[c++]=u}}return u(0,0,h,h,h,0),u(h,h,0,0,0,h),{vertices:a,triangles:l}}getMeshWithSkirts(t=0,i){const{gridSize:e,indices:s}=this.martini,{errors:n}=this;let r=0,h=0;const o=e-1;let a,l,c=0;const u=[],f=[],d=[],p=[];function g(i,m,v,w,x,M){const _=i+v>>1,y=m+w>>1;Math.abs(i-x)+Math.abs(m-M)>1&&n[y*e+_]>t?(g(x,M,i,m,_,y),g(v,w,x,M,_,y)):(a=m*e+i,l=w*e+v,c=M*e+x,0===s[a]&&(0===i?u.push(r):i===o&&f.push(r),0===m?d.push(r):m===o&&p.push(r),s[a]=++r),0===s[l]&&(0===v?u.push(r):v===o&&f.push(r),0===w?d.push(r):w===o&&p.push(r),s[l]=++r),0===s[c]&&(0===x?u.push(r):x===o&&f.push(r),0===M?d.push(r):M===o&&p.push(r),s[c]=++r),h++)}let m;s.fill(0),g(0,0,o,o,o,0),g(o,o,0,0,0,o),m=i?2*(r+3*u.length-2+3*f.length-2+3*d.length-2+3*p.length-2):2*(r+u.length+f.length+d.length+p.length);const v=3*(h+2*(u.length-1)+2*(f.length-1)+2*(d.length-1)+2*(p.length-1)),w=new Uint16Array(m),x=new Uint32Array(v);let M=0;function _(i,r,h,o,a,l){const c=i+h>>1,u=r+o>>1;if(Math.abs(i-a)+Math.abs(r-l)>1&&n[u*e+c]>t)_(a,l,i,r,c,u),_(h,o,a,l,c,u);else{const t=s[r*e+i]-1,n=s[o*e+h]-1,c=s[l*e+a]-1;w[2*t]=i,w[2*t+1]=r,w[2*n]=h,w[2*n+1]=o,w[2*c]=a,w[2*c+1]=l,x[M++]=t,x[M++]=n,x[M++]=c}}_(0,0,o,o,o,0),_(o,o,0,0,0,o),u.sort(((t,i)=>w[2*t+1]-w[2*i+1])),f.sort(((t,i)=>w[2*i+1]-w[2*t+1])),d.sort(((t,i)=>w[2*i]-w[2*t])),p.sort(((t,i)=>w[2*t]-w[2*i]));let y,b,S,C,T=2*r,k=0;function A(t){k=t.length;for(let e=0;e<k-1;e++)y=t[e],b=t[e+1],S=T/2,C=(T+(i?6:2))/2,w[T++]=2*y,w[T++]=2*y+1,i&&(w[T++]=2*y,w[T++]=2*y+1,w[T++]=2*b,w[T++]=2*b+1),i?(x[M++]=S+1,x[M++]=S,x[M++]=S+2,x[M++]=S,x[M++]=C,x[M++]=S+2):(x[M++]=y,x[M++]=S,x[M++]=b,x[M++]=S,x[M++]=C,x[M++]=b);w[T++]=2*t[k-1],w[T++]=2*t[k-1]+1}A(u);const O=T;A(f);const I=T;A(d);const E=T;return A(p),{vertices:w,triangles:x,numVerticesWithoutSkirts:r,numTrianglesWithoutSkirts:h,leftSkirtIndex:O,rightSkirtIndex:I,bottomSkirtIndex:E,topSkirtIndex:T}}}const Di$3={};function Hi$3(t,i,e,s){let n=Di$3[e];n||(n=Di$3[e]=new Ri$3(e));const r=n.createTile(i),h=s?r.getMeshWithSkirts(t,!0):r.getMesh(t),{triangles:o,vertices:a,leftSkirtIndex:l,rightSkirtIndex:c,bottomSkirtIndex:u,topSkirtIndex:f}=h;let{numVerticesWithoutSkirts:d,numTrianglesWithoutSkirts:p}=h;d||(d=a.legnth/3,p=o.length/3);const g=a.length/2,m=new Float32Array(3*g),v=new Float32Array(2*g);let w=1/0,x=-1/0;const M=e-1;for(let t=0;t<g;t++){const s=a[2*t],n=a[2*t+1];if(t>=d){const i=s/2*3;let e,n=.001;(t-(t<l/2?d:t<c/2?l/2:t<u/2?c/2:u/2))%3==0?(e=0,n=0):e=m[i+2],m[3*t]=m[i],m[3*t+1]=m[i+1],m[3*t+2]=e,v[2*t]=m[i]/M+n,v[2*t+1]=-m[i+1]/M+n}else m[3*t]=1*s,m[3*t+1]=1*-n,m[3*t+2]=i[n*e+s],v[2*t]=s/M,v[2*t+1]=n/M;const r=m[m.length-1];r<w&&(w=r),r>x&&(x=r)}return{positions:m,texcoords:v,triangles:o,leftSkirtIndex:l,rightSkirtIndex:c,bottomSkirtIndex:u,topSkirtIndex:f,numTrianglesWithoutSkirts:p,numVerticesWithoutSkirts:d,minHeight:w,maxHeight:x,terrainWidth:e}}function Ni$3(t,i,e,s,n,r,h,o,a){const l={};for(let c=0;c<a;c++)l[c+""]=ji$3(t,i,e,s,n,r,h,o,c);return l}const Gi$3=[];function ji$3(t,i,e,s,n,r,h,o,a){if((s-=a)<=0)return Gi$3;const l=t.getTileSize().width,c=t._getTileOffset(s,n),u=r[0]-c[0],f=c[1]-r[1],d=t._getTileConfig(),p=t.getSpatialReference().getResolution(s),g=d.tileSystem.scale.y;let m=0,v=0,w=o/=Math.pow(2,a),x=o;if(u<0?w+=Math.ceil(-u/l-1e-7):u>0&&(m-=Math.ceil(u/l-1e-7)),f>0?v-=Math.ceil(f/l-1e-7):f<0&&(x+=Math.ceil(-f/l-1e-7)),0===m&&0===v&&w<=1&&x<=1){const n=Math.floor(i*o);let r=Math.floor(e*o);const a=r;return g!==h&&(r=zi$3(d,r,p)),[{x:n,y:r,skinY:a,z:s,offset:c,tileSize:l,id:t._getTileId(n,r,s)}]}const M=[];for(let n=m;n<w;n++)for(let r=v;r<x;r++){const a=i*o+n;let u=e*o+r;const f=u;g!==h&&(u=zi$3(d,u,p)),M.push({x:a,y:u,skinY:f,z:s,offset:c,tileSize:l,id:t._getTileId(a,u,s)})}return M}function Bi$3(t,i,e,s){let n=t/e*s/i;return n<1?(n=1/n,n=1/Math.round(n)):n=Math.round(n),n}function Ui$3(t,i,e){const s=t.getResolution(i),n=i-Math.log(e/s)*Math.LOG2E;return{zoom:n,res:t.getResolution(n)}}function zi$3(t,i,e){const s=t.fullExtent,n=t.tileSize.width,r=Math.max(s.top,s.bottom),h=Math.min(s.top,s.bottom);return Math.ceil(r/n/e)-1-Math.floor(h/n/e)-i}function Vi$3(t,i){const e=i*i,s=0!==t?new Float32Array(e):new Uint8Array(e);return s.fill(t),{data:s,width:i,height:i,max:t,min:t}}new t__namespace.Point(0,0);const Wi$3=Vi$3(0,5),qi$3=Hi$3(1,Wi$3.data,Wi$3.width,!0);qi$3.empty=!0;const $i$3=[],Yi$3=[];class Xi$3{constructor(t){this.layer=t,this.regl=t.getRenderer().regl,this.renderer=new B$6(this.regl),this.Ae=new Ke$5;const i=new Uint8Array(16);i.fill(255),this.Oe=this.regl.texture({width:2,height:2,data:i}),this.Ie=new Ve$5(this.Oe),this.Ee()}setToRedraw(){this.layer.getRenderer().setToRedraw()}getMap(){return this.layer.getMap()}startFrame(){this.shader||this.initShader(),this.Ae.clear()}createTerrainMesh(t,i){const{mesh:e,image:s}=i;let n=i.terrainMesh;const{positions:r,texcoords:h,triangles:o,empty:a}=e;if(n&&n.geometry!==this.Le)n.geometry.updateData("aPosition",r),n.geometry.updateData("aTexCoord",h),n.geometry.setElements(o);else{const t=a?this.Le:new Q$7({aPosition:r,aTexCoord:h},o,0);n?n.geometry=t:(n=new Be$5(t,null,{disableVAO:!0}),t.generateBuffers(this.regl))}if(!n.uniforms.skin){const t=this.getEmptyTexture();n.setUniform("skin",t)}return n.setUniform("heightTexture",s),this.prepareMesh(n,t,i),n}Fe(t){const i=this.layer.getRenderer();i&&i.updateMaskDefines(t)}Re(t){const i=this.Pe(100)/100,e=identity$2(t);return scale$5(e,e,[1,1,i]),e}De(t,i,e){const s=this.getMap(),n=this.layer.getTileSize().width,r=i.res/s.getGLRes(),h=n/(e-1),{extent2d:o,offset:c}=i;set$4($i$3,(o.xmin-c[0])*r,(i.extent2d.ymax-c[1])*r,0);const u=identity$2(t);return translate$1(u,u,$i$3),set$4(Yi$3,r*h,r*h,1),scale$5(u,u,Yi$3),u}prepareMesh(t,i,e){if(!t.isValid())return;const{mesh:s}=e;this.Fe(t);const{triangles:n,numTrianglesWithoutSkirts:r,terrainWidth:h}=s;t.localTransform=this.De(t.localTransform||[],i,h),t.positionMatrix=this.Re(t.positionMatrix||[]),t.properties.skirtOffset=3*r,t.properties.skirtCount=n.length-3*r,t.properties.z=i.z,t.properties.minHeight=s.minHeight,t.properties.maxHeight=s.maxHeight,t.properties.terrainWidth=h,t.castShadow=!1,dt$5(t.uniforms,"minAltitude")||Object.defineProperty(t.uniforms,"minAltitude",{enumerable:!0,get:()=>e.minAltitude||0})}addTerrainImage(t,i){const e=i.terrainMesh;e&&e.geometry&&i.skin&&(e.setUniform("skin",i.skin.color[0]),e.setUniform("polygonOpacity",1),this.Ae.addMesh(e))}endFrame(t){this.updateIBLDefines(this.shader);let i=0;const e=this.getUniformValues(),s=this.He(t);return this.shader.filter=t&&t.sceneFilter,i+=this.renderer.render(this.shader,e,this.Ae,s),i}delete(){this.shader&&(this.shader.dispose(),delete this.shader),this.Oe&&(this.Oe.destroy(),delete this.Oe),this.Le&&(this.Le.dispose(),delete this.Le)}deleteMesh(t){if(!t)return;const i=t.geometry;t.dispose(),i!==this.Le&&i.dispose()}initShader(){const t=[],i=[];this.shader=new vn$4({vert:"#define SHADER_NAME TERRAIN_MESH\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform float minAltitude;\nuniform mat4 projViewModelMatrix;\nuniform mat4 projMatrix;\nuniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 positionMatrix;\nuniform float heightScale;\nvarying vec2 vUv;\n#include <mask_vert>\nvoid main() {\n    vec3 position = vec3(aPosition.xy, (aPosition.z + minAltitude) * heightScale);\n    #ifdef HAS_MASK_EXTENT\n        gl_Position = projMatrix * getMaskPosition(positionMatrix * vec4(position, 1.0), modelMatrix);\n    #else\n        gl_Position = projViewModelMatrix * positionMatrix * vec4(position, 1.0);\n    #endif\n    vUv = aTexCoord;\n}",frag:"#define SHADER_NAME TERRAIN_MESH\nprecision mediump float;\nuniform sampler2D skin;\nuniform float polygonOpacity;\nvarying vec2 vUv;\n#include <mask_frag>\nvoid main() {\n    vec2 uv = vec2(vUv);\n    uv.y = 1.0 - uv.y;\n    vec4 color = texture2D(skin, uv);\n    gl_FragColor = color * polygonOpacity;\n    #ifdef HAS_MASK_EXTENT\n      gl_FragColor = setMask(gl_FragColor);\n    #endif\n}",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(t,e){return multiply$5(i,e.viewMatrix,e.modelMatrix)}},{name:"projViewModelMatrix",type:"function",fn:function(i,e){return multiply$5(t,e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.layer.getRenderer().canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!1},cull:{enable:!0,face:"back"},depth:{enable:!0,mask:()=>!!this.layer.options.depthMask,func:this.layer.options.depthFunc||"<="},blend:{enable:!0,func:{src:this.layer.options.blendSrc,dst:this.layer.options.blendDst},equation:"add"}}}He(t){return t&&t.renderTarget&&t.renderTarget.fbo}getUniformValues(){const t=this.getMap(),i=t.projViewMatrix,e=this.layer.getRenderer().getMaskUniforms(),s={viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:i,heightScale:1};return at$5(s,e),s}Pe(t){const i=this.layer.getMap();return i?i.altitudeToPoint(t,i.getGLRes()):null}getEmptyTexture(){return this.Oe}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const i=t.shaderDefines;let e=!1;this.hasIBL()?i[["HAS_IBL_LIGHTING"]]||(i.HAS_IBL_LIGHTING=1,e=!0):i[["HAS_IBL_LIGHTING"]]&&(delete i.HAS_IBL_LIGHTING,e=!0),e&&(t.shaderDefines=i)}Ee(){const t=qi$3,{positions:i,texcoords:e,triangles:s}=t;this.Le=new Q$7({aPosition:i,aTexCoord:e},s,0),this.Le.generateBuffers(this.regl)}}const{getIBLResOnCanvas:Ji$3,getPBRUniforms:Zi$3,loginIBLResOnCanvas:Ki$3,logoutIBLResOnCanvas:Qi$3}=fi$4.PBRUtils,te$4={baseColorFactor:[1,1,1,1],emissiveFactor:[0,0,0],baseColorIntensity:1,emitColorFactor:1,roughnessFactor:1,metallicFactor:0,emitMultiplicative:1,outputSRGB:1,hsv:[0,0,0],contrast:1,alphaTest:0};class ie$4 extends Xi$3{constructor(...t){super(...t),this.createIBLTextures(),this.Ne=0}updateMaterial(t,i){this.Ne=i,this.Ge=this.Ge||{},at$5(this.Ge,t),this.setToRedraw()}setMaterial(t,i){this.Ne=i,this.Ge=at$5({},te$4,t),this.setToRedraw()}createIBLTextures(){const t=this.getMap().getRenderer().canvas;Ki$3(t,this.regl,this.getMap()),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.getMap().getRenderer().canvas;Qi$3(t,this.getMap())}createTerrainMesh(t,i){const{mesh:e,image:s}=i,{positions:n,texcoords:r,triangles:h,leftSkirtIndex:o,rightSkirtIndex:a,bottomSkirtIndex:l,numVerticesWithoutSkirts:c}=e,u=new Int8Array(n.length);for(let t=2;t<u.length;t+=3)t<3*c?u[t]=1:t<o/2*3?u[t-2]=-1:t<a/2*3?u[t-2]=1:u[t-1]=t<l/2*3?-1:1;const f=new Q$7({aPosition:n,aTexCoord:r,aNormal:u},h,0);let d;f.createTangent(),delete f.data.aNormal,f.generateBuffers(this.regl),d=s?this.regl.texture({width:s.width,height:s.height,data:s,min:"linear",mag:"linear"}):this.getEmptyTexture();const p=this.getEmptyTexture(),m=at$5({},te$4,this.layer.options.material||{});m.skinTexture=p,m.terrainHeightTexture=d;const v=new fi$4.StandardMaterial(m),w=new Be$5(f,v);w.properties.matVer=this.Ne;const x=w.defines;return x.HAS_UV_FLIP=1,x.HAS_TERRAIN_NORMAL=1,x.HAS_MAP=1,w.defines=x,w.setUniform("terrainTileResolution",t.res),this.prepareMesh(w,t,i),w}addTerrainImage(t,i){const e=i.terrainMesh;if(e){if(this.Ge&&e.properties.matVer!==this.Ne){for(const t in this.Ge)e.material.set(t,this.Ge[t]);e.properties.matVer=this.Ne}i.skin&&e.material.set("skinTexture",i.skin),e.setUniform("polygonOpacity",1),this.Ae.addMesh(e)}}getUniformValues(){const t=this.getMap(),i=t.getRenderer().canvas,{iblTexes:e,dfgLUT:s}=Ji$3(i),n=Zi$3(t,e,s),r=this.layer.getTileSize().width,h=this.layer.getRenderer().getMaskUniforms(),o=this.Pe(100)/100;return at$5(n,{viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[i.width,i.height],polygonFill:[1,1,1,1],terrainHeightMapResolution:[r,r],terrainResolution:[i.width,i.height],terrainHeightScale:o,terrainUnpackFactors:[6553.6,25.6,.1,1e4]}),at$5(n,h),n}initShader(){this.shader=new fi$4.StandardShader({extraCommandProps:this.getExtraCommandProps()})}delete(){return this.disposeIBLTextures(),super.delete()}}function ee$4(t,i,e,s){const n=se$4.call(this,e,s);this._projViewMatrix=i;const{colorExtent:r,modeExtent:h}=this._extentPass.render(n,i);this._maskUniforms=this._maskUniforms||{},this._maskUniforms.mask_colorExtent=r,this._maskUniforms.mask_extent=t,this._maskUniforms.mask_modeExtent=h,this._maskUniforms.mask_hasFlatOut=re$4.call(this,"flat-outside"),this._maskUniforms.mask_hasClipOut=re$4.call(this,"clip-outside"),this._maskUniforms.mask_hasVideo=re$4.call(this,"video"),this._maskUniforms.mask_heightRatio=e,this._maskUniforms.mask_heightOffset=s,this.setToRedraw()}function se$4(t,i){const e=[],s=this.layer.getMasks();for(let n=0;n<s.length;n++){const r=s[n].getMesh(this.regl,t,i);r&&e.push(r)}return e}function ne$4(){if(!this._extentPass||!this._maskUniforms)return;const e=se$4.call(this,this._maskUniforms.mask_heightRatio,this._maskUniforms.mask_heightOffset);this._extentPass.render(e,this._projViewMatrix);const s=this.layer.getMasks();for(let t=0;t<s.length;t++)"video"===s[t].getMode()&&s[t].je()}function re$4(t){const i=this.layer.getMasks();for(let e=0;e<i.length;e++)if(i[e].getMode()===t)return 1;return 0}function he$4(){const t=this.layer.getMasks();if(!t)return!1;for(let i=0;i<t.length;i++)if("video"===t[i].getMode()&&t[i].Be())return!0;return!1}function oe$4(t){return class extends t{setMask(t,i,e,s){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),this._extentPass?ee$4.call(this,t,i,e,s):this.regl?(this._extentPass=new mt$6(this.regl,this.viewport),ee$4.call(this,t,i,e,s)):this.layer.once("contextcreate",(()=>{this._extentPass=new mt$6(this.regl,this.viewport),ee$4.call(this,t,i,e,s)}),this)}needToRedraw(){return!!super.needToRedraw()||!!he$4.call(this)}getMaskUniforms(){return he$4.call(this)&&ne$4.call(this),this.layer.updateExtent(),this._maskUniforms}getMaskDefines(){return this._maskDefines||(this._maskDefines={}),this._maskUniforms&&this._maskUniforms.mask_colorExtent?this._maskDefines.HAS_MASK_EXTENT=1:delete this._maskDefines.HAS_MASK_EXTENT,this._maskDefines}updateMaskDefines(t){const i=t.getDefines();delete i.HAS_MASK_EXTENT,at$5(i,this.getMaskDefines()),t.setDefines(i)}_clearMask(){this._deleteMaskUniforms(),this._extentPass&&(this._extentPass.dispose(),delete this._extentPass),this.setToRedraw()}_deleteMaskUniforms(){delete this._maskUniforms}}}class ae$4{constructor(t,i){this.max=t,this.onRemove=i,this.reset()}reset(){if(this.data){const t=this.data.values();for(const i of t)this.onRemove(i)}return this.data=new Map,this}clear(){this.reset(),delete this.onRemove}add(t,i){return i?(this.has(t)?(this.data.delete(t),this.data.set(t,i)):this.data.set(t,i),this):this}keys(){const t=new Array(this.data.size);let i=0;const e=this.data.keys();for(const s of e)t[i++]=s;return t}has(t){return this.data.has(t)}getAndRemove(t){if(!this.has(t))return null;const i=this.data.get(t);return this.data.delete(t),i}get(t){return this.has(t)?this.data.get(t):null}pop(){if(this.data.size<this.max)return null;const t=this.data.keys().next();return this.data.get(t.value).current?(this.max+=Math.ceil(this.max/2),null):this.getAndRemove(t.value)}remove(t){if(!this.has(t))return this;const i=this.data.get(t);return this.data.delete(t),this.onRemove(i),this}resetCurrent(t){this.data&&this.data.forEach((i=>{i.current=t}))}}const le$4=new t__namespace.Point(0,0),ce$4=new t__namespace.Point(0,0),ue$4=new t__namespace.PointExtent(0,0,0,0),fe$4=new t__namespace.Point(0,0),de$4=new t__namespace.Point(20,20),pe$4={color:[0,0,0,0],depth:1,stencil:0};class ge$4 extends(oe$4(t__namespace.renderer.TileLayerCanvasRenderer)){isDrawable(){return!0}getTempTileOnLoading(t,i){if(i.image&&!i.image.reset)return i;const e=this.Ue(t);return e.temp=!0,i.image||(i.image=e),delete i.image.reset,i.current=!0,i.info=t,at$5(i.image,e),this.ze(i.image,t),i}Ve(t,i,e){i.reset=!0,delete i.data,delete i.loadTime,delete i.rendered,delete i.minAltitude;const s=t.id+"-temp",n=i.skinImages;if(n)for(let t=0;t<n.length;t++){const i=n[t];if(i){for(let t=0;t<i.length;t++){const n=i[t];n&&(n.refs.delete(s),n.refs.size||e.push(n))}delete i.currentSkins,delete i.tileIds}}delete i.sourceZoom,delete i.skinImages,delete i.skinStatus,delete i.skinTileIds,i.debugTexture&&(i.debugTexture.destroy(),delete i.debugTexture)}Ue(t,i){for(i=i||this.findParentTile(t);i&&i.image&&-1===i.image.sourceZoom;)i=this.findParentTile(i.info);const e=(i&&i.info||t).res,s=this.getMap().pointAtResToDistance(1,1,e),n=i&&i.image&&i.image.data&&this.We(i,t),r=n&&-1!==i.image.sourceZoom?i.info.z:-1;if(!n||n.width<=1){const e=this.qe(t,i);return{data:Vi$3(e||0,5),minAltitude:e,mesh:qi$3,sourceZoom:r}}return{data:n,mesh:Hi$3(s,n.data,n.width,!0),sourceZoom:r}}qe(t,i){if(i&&i.minAltitude)return i.minAltitude;const{idx:e,idy:s,z:n}=t;for(let t=-1;t<=1;t++)for(let i=-1;i<=1;i++){if(0===t&&0===i)continue;const r=this.layer.getTileId(e+t,s+i,n),h=this.layer.tileInfoCache.get(r);if(h&&h.minAltitude)return h.minAltitude}return 0}consumeTile(t,i){if(t.empty&&!t.mesh){const e=this.findParentTile(i);if(!e||e.image&&e.image.empty){t.mesh=qi$3;const e=this.qe(i);t.data=Vi$3(e||0,5),t.minAltitude=e,t.sourceZoom=-1}else t=this.Ue(i,e)}this.ze(t,i),super.consumeTile(t,i),this.$e(i)}ze(t,i){if(t&&t.mesh){t.terrainMesh=this.Ye.createTerrainMesh(i,t),i.minAltitude=t.data.min,i.maxAltitude=t.data.max,delete t.mesh;const e=this.layer.tileInfoCache;if(e&&i.parent&&!t.empty&&!t.temp){const t=e.get(i.parent);if(t){const{minAltitude:e,maxAltitude:s}=i;(void 0===t.minAltitude||t.minAltitude>e)&&(t.minAltitude=e),(void 0===t.maxAltitude||t.maxAltitude<s)&&(t.maxAltitude=s)}}}}$e(t){const i=this.getMap();if(i.updateCenterAltitude&&void 0===i.centerAltitude&&t.z===this.getCurrentTileZoom()){const e=i._getPrjCenter(),s=i._prjToPointAtRes(e,t.res,fe$4);t.extent2d.contains(s)&&i.updateCenterAltitude()}}draw(t,i){this.Xe(),this.Ye.startFrame(),super.draw(t,i),this.Je(i)}drawTile(t,i){const e=this.getMap();if(!t||!e||!i)return;if(!this.drawingCurrentTiles&&!this.drawingChildTiles)return;let s=this.drawingCurrentTiles?this.getTileOpacity(i):1;s*=this.layer.options.opacity||1,this.Ye.addTerrainImage(t,i,s)}_drawTiles(t,i,e,s,n,r,h){const o=[],a=this.Ze(r,o);this.Ke=0;const l=this.layer.getSkinCount();pt$5(t,a);const c=new Set;for(let t=0;t<l;t++)this.Qe(t,h,c,o);for(let i=0;i<l;i++)this.Qe(i,t,c,o);for(let i=0;i<t.length;i++)this.ts(t[i].info,t[i].image);for(let t=0;t<o.length;t++)o[t]&&o[t].texture&&!o[t].refs.size&&(this.es.delete(o[t].tile.id),this.ss(o[t]));return this.ns(),super._drawTiles(...arguments)}Ze(t,i){const e=[];let s=this.rs;s||(s=this.rs=new ae$4(this.layer.options.tempTileCacheSize,(t=>{const{info:i,image:e}=t;this.hs(i,e)}))),s.resetCurrent(!1);for(let n=0;n<t.length;n++){const r=t[n];let h;s.has(r.id)?h=s.getAndRemove(r.id):(h=s.pop(),h?h.image&&(this.Ve(h.info,h.image,i),h.image.temp=!0):h={info:r}),h.current=!0,s.add(r.id,h),e.push(h)}for(let i=0;i<t.length;i++)this.getTempTileOnLoading(t[i],e[i]);return e}ns(){if(!this.es)return;const t=this.getCurrentTimestamp();if(this.os&&t-this.os<1e3)return;const i=new Set;for(const t of this.tileCache.data.values())this.as(t,i);for(const t in this.tilesInView){this.as(this.tilesInView[t],i)}if(this.rs)for(const t of this.rs.data.values())this.as(t,i);i.size&&(this.es.forEach(((t,e)=>{i.has(e)||(console.log("deleted:",e),this.ss(this.es.get(e)),this.es.delete(e))})),this.os=t)}as(t,i){const e=t.image&&t.image.skinImages;if(e&&e.length)for(let t=0;t<e.length;t++){const s=e[t]&&e.currentSkins;if(s)for(const t of s)i.add(t)}}Qe(t,i,e,s){const n=this.layer.getSkinLayer(t).getRenderer();if(!n)return;const r=[];for(let n=0;n<i.length;n++){const{info:h,image:o}=i[n];if(this.ls(t,h,o,s)){const s=i[n].image.skinImages[t];for(let t=0;t<s.length;t++){const i=s[t].tile.info.id;e.has(i)||(r.push(s[t]),e.add(i))}}}n.renderTerrainSkin(this.regl,this.layer,r)}ls(t,i,e,s){const n=this.getMap();if(delete e.path,!i||!n||!e)return!1;if(!e.terrainMesh)return!1;const r=this.layer.getSkinLayer(t),h=r.getRenderer();if(!h)return!1;e.skinImages||(e.skinImages=[]),e.skinStatus||(e.skinStatus=[]),e.skinTileIds||(e.skinTileIds=[]);const o=h.isAnimating&&h.isAnimating(),a=e.skinStatus[t],l=h.needToRefreshTerrainTileOnZooming&&h.needToRefreshTerrainTileOnZooming(),c=o||l&&e.renderedZoom!==n.getZoom();if(a&&!c)return!1;const u=r.getSpatialReference(),{x:f,y:d,z:p,res:g,offset:m}=i;let v=i.nw;v||(v=i.nw=this.getMap().pointAtResToCoord(i.extent2d.getMin(le$4),i.res));const w=this.layer.getTileSize().width,{res:x,zoom:M}=Ui$3(u,p,g),_=Bi$3(x,r.getTileSize().width,g,w);let y=e.skinTileIds[t];if(!y){const i=this.layer._getTileConfig().tileSystem.scale.y;y=e.skinTileIds[t]=Ni$3(r,f,d,M,v,m,i,_,me$4)}const b=y[0];let S=!0;const C=[];for(let t=0;t<b.length;t++){const i=h.getCachedTile(b[t],!1);if(i)C.push(i);else{S=!1;const i=h.findParentTile(b[t]);i&&C.push(i)}}const T=e.skinImages[t]||[];T.currentSkins=T.currentSkins||new Set;const k=new Set;let A=!1;for(let t=0;t<T.length;t++){if(!T[t].tile){A=!0;continue}k.add(T[t].tile.info.id)}if(!C.length)return T.currentSkins.clear(),e.skinImages[t]=[],!1;const O=C.length?C.map((t=>t.info.id)).join():C[0].info.id;if(!c&&!A&&T.tileIds===O)return!1;T.tileIds=O;let I=!1;T.currentSkins.clear(),T.length=0;const E=T.currentSkins;let L=i.id;e.temp&&(L+="-temp");for(let t=0;t<C.length;t++){const i=C[t].info.id;E.add(i);let e=this.cs(i);e&&(F=e)&&F.texture||(e={tile:at$5({},C[t]),layer:r,refs:new Set,texture:h.createTerrainTexture(this.regl)},this.us(i,e)),e.refs.add(L),T.push(e),I=!0}var F;return this.fs(i,e,k,E,s),I&&this.Ke++,e.skinImages[t]=T,r.fire("renderterrainskin",{tile:i,skinTiles:C}),S&&(e.skinStatus[t]=1),!0}fs(t,i,e,s,n){if(!e.size)return;let r=t.id;i.temp&&(r+="-temp");for(const t of e)if(!s||!s.has(t)){const i=this.cs(t);this.ds(i,r,n)}}cs(t){return this.es||(this.es=new Map),this.es.get(t)}us(t,i){this.es.set(t,i)}ts(t,i){const e=this.getMap();if(!t||!e||!i)return;const s=i.skinImages,n=this.ps(i.renderedZoom);if(i.rendered&&!n)return;i.skin?(pe$4.framebuffer=i.skin,this.regl.clear(pe$4)):i.skin=this.gs(),this.ms();const r=this.layer.options.debug,h=[],o=r&&[],a=this.layer.getTileSize().width;if(s)for(let i=0;i<s.length;i++){const e=s[i];for(let i=0;i<e.length;i++){const{tile:s,texture:n,layer:r}=e[i];if((s.info.offset[0]||s.info.offset[1])&&t.skinTileIds){const i=t.skinTileIds[r.getId()];for(let t=0;t<i.length;t++)if(s.info.x===i[t].x&&s.info.y===i[t].y){s.info.offset=i[t].offset;break}}const o=we$4(t,s,a),l=e[i].skinMesh||new Be$5(this.vs);l.setUniform("skinTexture",n);const c=r.getOpacity();l.setUniform("opacity",lt$5(c)?1:c),l.setUniform("skinDim",o),l.setUniform("tileSize",a),l.setUniform("x",t.x),l.setUniform("y",t.y),e[i].skinMesh=l,h.push(l)}}if(r){const e=i.skinDebugMesh||new Be$5(this.vs);e.setUniform("tileSize",a);const s=i.debugTexture||this.ws(t,a);i.debugTexture=s,i.skinDebugMesh=e,e.setUniform("opacity",1),e.setUniform("skinTexture",s),e.setUniform("skinDim",[0,0,1]),e.setUniform("tileSize",a),o.push(e)}if(h.length){this.xs.setMeshes(h);try{this.renderer.render(this.Ms,null,this.xs,i.skin)}catch(t){throw console.error(i),t}}o&&o.length&&this.layer.options.debug&&(this.xs.setMeshes(o),this.renderer.render(this.Ms,null,this.xs,i.skin)),i.rendered=this._s(i),i.renderedZoom=e.getZoom()}ws(t,i){i*=2;const{x:e,y:s,z:n}=t,r=`terrain:${e}/${s}/${n}`,h=document.createElement("canvas");h.width=i,h.height=i;const o=h.getContext("2d");o.font="40px monospace";const a=this.layer.options.debugOutline;return o.fillStyle=a,o.strokeStyle=a,o.fillText(r,20,i-40),o.beginPath(),o.lineWidth=4,o.moveTo(0,0),o.lineTo(i,0),o.lineTo(i,i),o.lineTo(0,i),o.lineTo(0,0),o.stroke(),this.regl.texture({data:h,flipY:!0,mag:"linear",min:"linear"})}gs(){const t=this.layer.getTileSize().width,i=2*t,e=2*t,s=this.regl,n=s.texture({min:"linear",mag:"linear",type:"uint8",width:i,height:e,flipY:!0}),h=s.framebuffer({width:i,height:e,colors:[n],colorFormat:"rgba",ignoreStatusCheck:!0,depthStencil:!1,depth:!1,stencil:!1});return h.colorTex=n,h}Je(t){this.Ye.endFrame(t)&&!Object.keys(this.tilesLoading).length&&this.layer.fire("terrainreadyandrender")}We(t,i){const{image:e,info:s}=t,n=e.data,r=n.width,{extent2d:h,res:o}=s,{extent2d:a,res:l}=i,c=h.getWidth(),u=h.getHeight();let f=(a.xmin*l/o-h.xmin)/c*(r-1),d=(h.ymax-a.ymax*l/o)/u*(r-1);let g=Math.round((a.xmax*l/o-h.xmin)/c*(r-1)-f);const m=Math.log2(g);g=Math.pow(2,Math.round(m))+1,f=Math.floor(f),d=Math.floor(d);const v=new Float32Array(g*g);let w=1/0,x=-1/0;for(let t=0;t<g;t++)for(let i=0;i<g;i++){let e=t+f,s=i+d;e>r-1?e=r-1:e<0&&(e=0),s>r-1?s=r-1:s<0&&(s=0);const h=n.data[e+s*r];v[t+i*g]=h,h<w&&(w=h),h>x&&(x=h)}return{width:g,height:g,data:v,min:w,max:x}}getTileOpacity(t){return this._s(t)?super.getTileOpacity(t):(this.resetTileLoadTime(t),0)}_s(t){const i=this.layer.getSkinCount();if(!i)return!0;if(!t.skinStatus)return!1;for(let e=0;e<i;e++)if(!t.skinStatus[e])return!1;return!0}ps(t){const i=this.getMap().getZoom(),e=this.layer.getSkinLayers();for(let s=0;s<e.length;s++){const n=e[s]&&e[s].getRenderer();if(n){if(n.isAnimating&&n.isAnimating())return!0;if(n.needToRefreshTerrainTileOnZooming&&n.needToRefreshTerrainTileOnZooming()&&t!==i)return!0}}return!1}isValidCachedTile(t){return t.image&&!t.image.temp&&(!t.image.skinStatus||this._s(t.image))}isTileComplete(t){return t.image&&!t.image.temp&&this._s(t.image)}ys(){const t=this.layer.options;return lt$5(t.terrainWidth)?t.tileSize+1:t.terrainWidth}bs(t,i){const e=this.layer.options.maxAvailableZoom-this.layer.options.zoomOffset,n=Math.pow(2,t.z-e),r=Math.floor(t.x/n),h=Math.floor(t.y/n),o=Math.floor(t.idx/n),a=Math.floor(t.idy/n),l=xe$4(r,h);this.Ss||(this.Ss={});const c=!this.Ss[l];return c&&i&&(this.Ss[l]=new Set,this.Ss[l].url=this.layer.getTileUrl(r,h,e+this.layer.options.zoomOffset)),{x:r,y:h,idx:o,idy:a,requests:this.Ss[l],isFirst:c,key:l}}loadTile(i){const e=this.layer,s=this.ys(),n=e.getSpatialReference().getResolution(i.z);let r=this.getMap().pointAtResToDistance(1,1,n);const o=e.options.maxAvailableZoom&&e.options.maxAvailableZoom-(e.options.zoomOffset||0);if(o&&i.z>o){const t=this.Ue(i);if(-1!==t.sourceZoom)return this.onTileLoad(t,i),t;{const{requests:s,isFirst:n,x:h,y:a,idx:l,idy:c}=this.bs(i,!0);if(s.add(i),!n)return t;const u=i.z-o;r*=Math.pow(2,u);const f=[h,a,o,l,c,i.res*Math.pow(2,u),i.error*Math.pow(2,u)];i=e.createTileNode?e.createTileNode(...f):e.Cs(...f)}}const l={},c=e.options;return this.workerConn.fetchTerrain(i.url,{terrainWidth:s,type:c.type,accessToken:c.accessToken,cesiumIonTokenURL:c.cesiumIonTokenURL,error:r},((e,s)=>{if(this.Ss){const t=xe$4(i.x,i.y),e=this.Ss[t];if(e&&e.size){this.tileCache.add(i.id,{info:i,image:l});for(const t of e)this.removeTileLoading(t)}delete this.Ss[t]}if(e){if(e.canceled)return;return console.warn(e),void this.onTileError(l,i)}t__namespace.Util.extend(l,s),this.onTileLoad(l,i)})),l}deleteTile(t){if(!t||!t.image)return;super.deleteTile(t);const{info:i,image:e}=t;e.temp||(delete i.skinTileIds,this.hs(t.info,e))}hs(t,i){const e=i.skin;e&&(e.destroy(),e.colorTex.destroy(),delete e.colorTex),i.debugTexture&&(i.debugTexture.destroy(),delete i.debugTexture,i.skinDebugMesh.dispose(),delete i.skinDebugMesh);const s=i.skinImages;if(s&&s.length){let e=t.id;i.temp&&(e+="-temp");for(let t=0;t<s.length;t++){const i=s[t];if(i){for(let t=0;t<i.length;t++){if(!i[t]||!i[t].tile)continue;const s=i[t].tile.info.id,n=this.es&&this.es.get(s);n&&this.ds(n,e)}i.length=0}}}i.terrainMesh&&this.Ye.deleteMesh(i.terrainMesh),i.image&&i.image.close&&i.image.close(),delete i.skinImages,delete i.skin,delete i.skinStatus,delete i.skinTileIds,delete i.terrainMesh,delete i.image,delete i.data,delete i.mesh,delete i.rendered}ds(t,i,e){t&&(t.refs.delete(i),t.refs.size||(e?e.push(t):this.ss(t)))}ss(t){if(!t||!t.tile)return;const i=t.tile.info.id,e=t.layer.getRenderer();delete t.canvas,delete t.layer,t.refs.clear(),t.texture&&(e?e.deleteTerrainTexture(t.texture):t.texture.destroy&&t.texture.destroy(),delete t.texture),t.skinMesh&&(t.skinMesh.dispose(),delete t.skinMesh),e&&(e.removeTileCache&&e.removeTileCache(i),e.deleteTile&&e.constructor.prototype.deleteTile.call(e,t.tile)),delete t.tile,this.es.delete(i)}Ts(){if(!this.es)return;const t=this.es.keys();for(const i of t){const t=this.cs(i);this.ss(t)}this.es.clear()}abortTileLoading(t,i){const e=this.layer,s=e.options.maxAvailableZoom&&e.options.maxAvailableZoom-e.options.zoomOffset;if(i)if(s&&i.z>s){const{requests:t,key:e}=this.bs(i);t&&t.size&&(t.delete(i),t.size||(delete this.Ss[e],this.workerConn&&this.workerConn.abortTerrain(t.url)))}else i&&i.url&&this.workerConn&&this.workerConn.abortTerrain(i.url);super.abortTileLoading(t,i)}onTileError(t,i){super.onTileError(t,i)}ks(t){const i=this.getCurrentTileZoom(),e=this.layer.getSpatialReference().getResolution(i),s=this.layer._getTileConfig().getTileIndex(t,e,this.layer.options.repeatWorld);return s.z=i,s}As(t,i,e,s,n){const r=this.layer.getMinZoom(),h=this.Os(i,e.x,e.y,e.z,r);if(h&&h.image&&h.image.data){const i=h.info.extent2d,r=h.info.res/n,a=i.ymax*r-s.y,l=this.Is(h.image.data,(s.x-i.xmin*r)/(i.getWidth()*r),a/(i.getHeight()*r));t[0]=l,t[1]=null===l?0:+(h.info.z===e.z)}else t[0]=null,t[1]=0;return t}Os(t,i,e,s,n){t||(t=this.layer._getTileId(i,e,s));const r=this.tilesInView[t]||this.tileCache.get(t);return!r&&s-1>=n?this.Os(null,Math.floor(i/2),Math.floor(e/2),s-1,n):r}Is(t,i,e){const{width:s,height:n,data:r}=t,h=Math.floor((s-1)*i),o=Math.floor((n-1)*e)*s+h;return void 0===r[o]?null:r[o]}Es(t,i,e){t||(t={tiles:{},dirty:!0,complete:!1});const s=this.layer,n=this.getCurrentTileZoom(),r=s.getSpatialReference().getResolution(n),{xmin:h,ymin:o,xmax:a,ymax:l}=i,c=s._getTileConfig();le$4.set(h,o).Ls(e);const u=c._getTileNum(le$4,e,!0);ce$4.set(a,l).Ls(e);const f=c._getTileNum(ce$4,e,!0),d=Math.min(u.x,f.x),p=Math.max(u.x,f.x),g=Math.min(u.y,f.y),m=Math.max(u.y,f.y),v=e/r;le$4.set(h,o).Ls(v),ce$4.set(a,l).Ls(v);const w=ue$4.set(le$4.x,le$4.y,ce$4.x,ce$4.y),x=s.getTileSize().width+1;w.Fs(w.getWidth()/x),t.array=t.array||new Float32Array(x*x);const M=t.tiles;t.complete=!0,t.array.fill(0);for(let i=d;i<=p;i++)for(let e=g;e<=m;e++){const s=this.layer._getTileId(i,e,n);if(M[s])continue;const r=this.tileCache.get(s);r?(this.Rs(t.array,r,w,x),t.dirty=!0,M[s]=1):(t.dirty=t.dirty||void 0!==t.tiles[s],t.tiles[s]&&delete t.tiles[s],t.complete=!1)}return t}Rs(t,i,e,s){const n=i.info.extent2d,r=n.intersection(e),{xmin:h,ymin:o,xmax:a,ymax:l}=r,{data:c}=i.image,u=c.width,f=e.getWidth()/s,d=Math.floor((h-e.xmin)/f),p=Math.floor((o-e.ymin)/f),g=Math.floor((a-e.xmin)/f)-d,m=Math.floor((l-e.ymin)/f)-p,v=n.getWidth()/u,w=Math.floor((h-n.xmin)/v),x=Math.floor((o-n.ymin)/v),M=Math.floor(f/v);for(let i=0;i<=g;i++)for(let e=0;e<=m;e++){const n=i+d+(p+e)*s;let r=0;for(let t=0;t<M;t++)for(let s=0;s<M;s++){const n=(w+Math.floor(i*M))*u+t+x+Math.floor(e*M)+s;r+=c.data[n]}t[n]=r/Math.max(M,1)}return t}clear(){return this.clearTempResources(),super.clear()}clearTempResources(){this.rs&&(this.rs.reset(),delete this.rs),this.es&&this.Ts()}onAdd(){super.onAdd(),this.prepareWorker()}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),this.clearTempResources(),this.Ms&&(this.Ms.dispose(),delete this.Ms),this.vs&&(this.vs.dispose(),delete this.vs),delete this.Ss,super.onRemove(),this.Ye&&(this.Ye.delete(),delete this.Ye)}prepareWorker(){const t=this.layer.getMap();this.workerConn||(this.workerConn=new Fi$3(t.id));const i=this.workerConn;if(!i.isActive())return;const e=this.layer.options||{},s=this.layer.getId();i.addLayer(s,e,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.setToRedraw(),this.layer.fire("workerready"))}))}createContext(){this.canvas.gl&&this.canvas.gl.wrap?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.Ps(),this.renderer=new B$6(this.regl),this.layer.fire("contextcreate",{regl:this.regl})}Xe(){const t=this.Ye;"lit"===this.layer.options.shader||"pbr"===this.layer.options.shader?(t&&t.constructor===Xi$3||!t)&&(t&&(t.delete(),this.clear(),this.setToRedraw()),this.Ye=new ie$4(this.layer),this.layer.fire("paintercreated")):(t&&t.constructor===ie$4||!t)&&(t&&(t.delete(),this.clear(),this.setToRedraw()),this.Ye=new Xi$3(this.layer),this.layer.fire("paintercreated"))}Ps(){const t=this.layer,i=t.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};i.preserveDrawingBuffer=!0,i.stencil=!0,this.glOptions=i,this.gl=this.gl||this.Ds(this.canvas,i),this.regl=regl_min.exports.createREGL({gl:this.gl,attributes:i,extensions:["OES_element_index_uint"],optionalExtensions:t.options.glExtensions})}Ds(t,i){const e=["webgl","experimental-webgl"];let s=null;for(let n=0;n<e.length;++n){try{s=t.getContext(e[n],i)}catch(t){}if(s)break}return s}resizeCanvas(t){this.canvas&&super.resizeCanvas(t)}clearCanvas(){this.canvas&&super.clearCanvas()}ms(){if(this.Ms)return;const t=this.layer.getTileSize().width;this.Ms=new vn$4({vert:"#define SHADER_NAME TERRAIN_SKIN\nattribute vec2 aPosition;\nvoid main() {\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}",frag:"#define SHADER_NAME TERRAIN_SKIN\nprecision mediump float;\nuniform float tileSize;\nuniform sampler2D skinTexture;\nuniform vec3 skinDim;\nuniform float opacity;\nvoid main() {\n    vec2 fragCoord = gl_FragCoord.xy / 2.0;\n    vec2 resolution = vec2(tileSize);\n    vec2 uv = (fragCoord - skinDim.xy) /  (resolution * skinDim.z);\n    if (uv.x >= 0.0 && uv.x <= 1.0 && uv.y >= 0.0 && uv.y <= 1.0) {\n        gl_FragColor = texture2D(skinTexture, uv) * opacity;\n    } else {\n        gl_FragColor = vec4(0.0);\n    }\n}",extraCommandProps:{cull:{enable:!1},viewport:{x:0,y:0,width:2*t,height:2*t},depth:{enable:!1},stencil:{enable:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}});const i=new Int8Array([-1,-1,1,1,-1,1,1,1,-1,-1,1,-1]);this.vs=this.vs||new Q$7({aPosition:i},0,6,{positionSize:2}),this.vs.generateBuffers(this.regl),this.xs=this.xs||new Ke$5}updateMaterial(t){this.Ye&&t&&this.Ye.updateMaterial&&(void 0===this.Ne&&(this.Ne=1),this.Ye.updateMaterial(t,this.Ne++))}setMaterial(t){this.Ye&&t&&this.Ye.setMaterial&&(void 0===this.Ne&&(this.Ne=1),this.Ye.setMaterial(t,this.Ne++))}getAnalysisMeshes(){return this.Ye&&this.Ye.Ae?this.Ye.Ae.getMeshes():[]}}const me$4=1;function ve$4(t,i,e,s,n,r,h,o,a=0){t.font="20px monospace",t.fillStyle=e,de$4.y=o-30,t.globalAlpha=1,t.fillText(i,de$4.x+n,de$4.y+r+a),t.globalAlpha=.6,t.strokeStyle=e,t.lineWidth=s,t.beginPath(),t.moveTo(n,r),t.lineTo(n+h,r),t.lineTo(n+h,r+o),t.lineTo(n,r+o),t.lineTo(n,r),t.stroke(),t.globalAlpha=1}function we$4(t,i,e){const{res:s,extent2d:n,offset:r}=t,{info:h}=i,o=h.res/s,a=h.offset;return[h.extent2d.xmin*o-n.xmin+(r[0]-a[0]),-(n.ymin-h.extent2d.ymin*o+(a[1]-r[1])),o*h.tileSize/e]}function xe$4(t,i){return t+"-"+i}t__namespace.renderer.TileLayerCanvasRenderer.include({renderTerrainSkin(t,i,e){const s=this.layer.getTileSize().width,n=i.options.debug;for(let t=0;t<e.length;t++){const{tile:i,texture:r}=e[t];if(!i.image)continue;const h=document.createElement("canvas");e[t].canvas=h,h.width=s,h.height=s;const o=h.getContext("2d");if(o.drawImage(i.image,0,0),n){const{x:t,y:e,z:n}=i.info;ve$4(o,`${t}/${e}/${n}`,"yellow",1,0,0,s,s,-18)}r({data:h,width:s,height:s,flipY:!0,min:"linear mipmap linear",mag:"linear"})}},createTerrainTexture(t){const i=this.layer.getTileSize().width;return t.texture({width:i,height:i,flipY:!0,min:"linear mipmap linear",mag:"linear",depthStencil:!1,depth:!1,stencil:!1})},deleteTerrainTexture(t){t.destroy()}});var Me$4={exports:{}};function _e$4(t,i,e){e=e||2;var s,n,r,h,o,a,l,c=i&&i.length,u=c?i[0]*e:t.length,f=ye$4(t,0,u,e,!0),d=[];if(!f||f.next===f.prev)return d;if(c&&(f=function(t,i,e,s){var n,r,a,l=[];for(n=0,r=i.length;n<r;n++)(a=ye$4(t,i[n]*s,n<r-1?i[n+1]*s:t.length,s,!1))===a.next&&(a.steiner=!0),l.push(Fe$4(a));for(l.sort(Oe$4),n=0;n<l.length;n++)e=Ie$4(l[n],e);return e}(t,i,f,e)),t.length>80*e){s=r=t[0],n=h=t[1];for(var p=e;p<u;p+=e)(o=t[p])<s&&(s=o),(a=t[p+1])<n&&(n=a),o>r&&(r=o),a>h&&(h=a);l=0!==(l=Math.max(r-s,h-n))?32767/l:0}return Se$4(f,d,e,s,n,l,0),d}function ye$4(t,i,e,s,n){var r,h;if(n===qe$4(t,i,e,s)>0)for(r=i;r<e;r+=s)h=ze$4(r,t[r],t[r+1],h);else for(r=e-s;r>=i;r-=s)h=ze$4(r,t[r],t[r+1],h);return h&&He$4(h,h.next)&&(Ve$4(h),h=h.next),h}function be$4(t,i){if(!t)return t;i||(i=t);var e,s=t;do{if(e=!1,s.steiner||!He$4(s,s.next)&&0!==De$4(s.prev,s,s.next))s=s.next;else{if(Ve$4(s),(s=i=s.prev)===s.next)break;e=!0}}while(e||s!==i);return i}function Se$4(t,i,e,s,n,r,h){if(t){!h&&r&&function(t,i,e,s){var n=t;do{0===n.z&&(n.z=Le$4(n.x,n.y,i,e,s)),n.prevZ=n.prev,n.nextZ=n.next,n=n.next}while(n!==t);n.prevZ.nextZ=null,n.prevZ=null,function(t){var i,e,s,n,r,h,o,a,l=1;do{for(e=t,t=null,r=null,h=0;e;){for(h++,s=e,o=0,i=0;i<l&&(o++,s=s.nextZ);i++);for(a=l;o>0||a>0&&s;)0!==o&&(0===a||!s||e.z<=s.z)?(n=e,e=e.nextZ,o--):(n=s,s=s.nextZ,a--),r?r.nextZ=n:t=n,n.prevZ=r,r=n;e=s}r.nextZ=null,l*=2}while(h>1)}(n)}(t,s,n,r);for(var o,a,l=t;t.prev!==t.next;)if(o=t.prev,a=t.next,r?Te$4(t,s,n,r):Ce$4(t))i.push(o.i/e|0),i.push(t.i/e|0),i.push(a.i/e|0),Ve$4(t),t=a.next,l=a.next;else if((t=a)===l){h?1===h?Se$4(t=ke$4(be$4(t),i,e),i,e,s,n,r,2):2===h&&Ae$4(t,i,e,s,n,r):Se$4(be$4(t),i,e,s,n,r,1);break}}}function Ce$4(t){var i=t.prev,e=t,s=t.next;if(De$4(i,e,s)>=0)return!1;for(var n=i.x,r=e.x,h=s.x,o=i.y,a=e.y,l=s.y,c=n<r?n<h?n:h:r<h?r:h,u=o<a?o<l?o:l:a<l?a:l,f=n>r?n>h?n:h:r>h?r:h,d=o>a?o>l?o:l:a>l?a:l,p=s.next;p!==i;){if(p.x>=c&&p.x<=f&&p.y>=u&&p.y<=d&&Re$4(n,o,r,a,h,l,p.x,p.y)&&De$4(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function Te$4(t,i,e,s){var n=t.prev,r=t,h=t.next;if(De$4(n,r,h)>=0)return!1;for(var o=n.x,a=r.x,l=h.x,c=n.y,u=r.y,f=h.y,d=o<a?o<l?o:l:a<l?a:l,p=c<u?c<f?c:f:u<f?u:f,g=o>a?o>l?o:l:a>l?a:l,m=c>u?c>f?c:f:u>f?u:f,v=Le$4(d,p,i,e,s),w=Le$4(g,m,i,e,s),x=t.prevZ,M=t.nextZ;x&&x.z>=v&&M&&M.z<=w;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==h&&Re$4(o,c,a,u,l,f,x.x,x.y)&&De$4(x.prev,x,x.next)>=0)return!1;if(x=x.prevZ,M.x>=d&&M.x<=g&&M.y>=p&&M.y<=m&&M!==n&&M!==h&&Re$4(o,c,a,u,l,f,M.x,M.y)&&De$4(M.prev,M,M.next)>=0)return!1;M=M.nextZ}for(;x&&x.z>=v;){if(x.x>=d&&x.x<=g&&x.y>=p&&x.y<=m&&x!==n&&x!==h&&Re$4(o,c,a,u,l,f,x.x,x.y)&&De$4(x.prev,x,x.next)>=0)return!1;x=x.prevZ}for(;M&&M.z<=w;){if(M.x>=d&&M.x<=g&&M.y>=p&&M.y<=m&&M!==n&&M!==h&&Re$4(o,c,a,u,l,f,M.x,M.y)&&De$4(M.prev,M,M.next)>=0)return!1;M=M.nextZ}return!0}function ke$4(t,i,e){var s=t;do{var n=s.prev,r=s.next.next;!He$4(n,r)&&Ne$4(n,s,s.next,r)&&Be$4(n,r)&&Be$4(r,n)&&(i.push(n.i/e|0),i.push(s.i/e|0),i.push(r.i/e|0),Ve$4(s),Ve$4(s.next),s=t=r),s=s.next}while(s!==t);return be$4(s)}function Ae$4(t,i,e,s,n,r){var h=t;do{for(var o=h.next.next;o!==h.prev;){if(h.i!==o.i&&Pe$4(h,o)){var a=Ue$4(h,o);return h=be$4(h,h.next),a=be$4(a,a.next),Se$4(h,i,e,s,n,r,0),void Se$4(a,i,e,s,n,r,0)}o=o.next}h=h.next}while(h!==t)}function Oe$4(t,i){return t.x-i.x}function Ie$4(t,i){var e=function(t,i){var e,s=i,n=t.x,r=t.y,h=-1/0;do{if(r<=s.y&&r>=s.next.y&&s.next.y!==s.y){var o=s.x+(r-s.y)*(s.next.x-s.x)/(s.next.y-s.y);if(o<=n&&o>h&&(h=o,e=s.x<s.next.x?s:s.next,o===n))return e}s=s.next}while(s!==i);if(!e)return null;var a,l=e,c=e.x,u=e.y,f=1/0;s=e;do{n>=s.x&&s.x>=c&&n!==s.x&&Re$4(r<u?n:h,r,c,u,r<u?h:n,r,s.x,s.y)&&(a=Math.abs(r-s.y)/(n-s.x),Be$4(s,t)&&(a<f||a===f&&(s.x>e.x||s.x===e.x&&Ee$4(e,s)))&&(e=s,f=a)),s=s.next}while(s!==l);return e}(t,i);if(!e)return i;var s=Ue$4(e,t);return be$4(s,s.next),be$4(e,e.next)}function Ee$4(t,i){return De$4(t.prev,t,i.prev)<0&&De$4(i.next,t,t.next)<0}function Le$4(t,i,e,s,n){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*n|0)|t<<8))|t<<4))|t<<2))|t<<1))|(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-s)*n|0)|i<<8))|i<<4))|i<<2))|i<<1))<<1}function Fe$4(t){var i=t,e=t;do{(i.x<e.x||i.x===e.x&&i.y<e.y)&&(e=i),i=i.next}while(i!==t);return e}function Re$4(t,i,e,s,n,r,h,o){return(n-h)*(i-o)>=(t-h)*(r-o)&&(t-h)*(s-o)>=(e-h)*(i-o)&&(e-h)*(r-o)>=(n-h)*(s-o)}function Pe$4(t,i){return t.next.i!==i.i&&t.prev.i!==i.i&&!function(t,i){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==i.i&&e.next.i!==i.i&&Ne$4(e,e.next,t,i))return!0;e=e.next}while(e!==t);return!1}(t,i)&&(Be$4(t,i)&&Be$4(i,t)&&function(t,i){var e=t,s=!1,n=(t.x+i.x)/2,r=(t.y+i.y)/2;do{e.y>r!=e.next.y>r&&e.next.y!==e.y&&n<(e.next.x-e.x)*(r-e.y)/(e.next.y-e.y)+e.x&&(s=!s),e=e.next}while(e!==t);return s}(t,i)&&(De$4(t.prev,t,i.prev)||De$4(t,i.prev,i))||He$4(t,i)&&De$4(t.prev,t,t.next)>0&&De$4(i.prev,i,i.next)>0)}function De$4(t,i,e){return(i.y-t.y)*(e.x-i.x)-(i.x-t.x)*(e.y-i.y)}function He$4(t,i){return t.x===i.x&&t.y===i.y}function Ne$4(t,i,e,s){var n=je$4(De$4(t,i,e)),r=je$4(De$4(t,i,s)),h=je$4(De$4(e,s,t)),o=je$4(De$4(e,s,i));return n!==r&&h!==o||!(0!==n||!Ge$4(t,e,i))||!(0!==r||!Ge$4(t,s,i))||!(0!==h||!Ge$4(e,t,s))||!(0!==o||!Ge$4(e,i,s))}function Ge$4(t,i,e){return i.x<=Math.max(t.x,e.x)&&i.x>=Math.min(t.x,e.x)&&i.y<=Math.max(t.y,e.y)&&i.y>=Math.min(t.y,e.y)}function je$4(t){return t>0?1:t<0?-1:0}function Be$4(t,i){return De$4(t.prev,t,t.next)<0?De$4(t,i,t.next)>=0&&De$4(t,t.prev,i)>=0:De$4(t,i,t.prev)<0||De$4(t,t.next,i)<0}function Ue$4(t,i){var e=new We$4(t.i,t.x,t.y),s=new We$4(i.i,i.x,i.y),n=t.next,r=i.prev;return t.next=i,i.prev=t,e.next=n,n.prev=e,s.next=e,e.prev=s,r.next=s,s.prev=r,s}function ze$4(t,i,e,s){var n=new We$4(t,i,e);return s?(n.next=s.next,n.prev=s,s.next.prev=n,s.next=n):(n.prev=n,n.next=n),n}function Ve$4(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function We$4(t,i,e){this.i=t,this.x=i,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function qe$4(t,i,e,s){for(var n=0,r=i,h=e-s;r<e;r+=s)n+=(t[h]-t[r])*(t[r+1]+t[h+1]),h=r;return n}Me$4.exports=_e$4,Me$4.exports.default=_e$4,_e$4.deviation=function(t,i,e,s){var n=i&&i.length,h=Math.abs(qe$4(t,0,n?i[0]*e:t.length,e));if(n)for(var o=0,a=i.length;o<a;o++){h-=Math.abs(qe$4(t,i[o]*e,o<a-1?i[o+1]*e:t.length,e))}var u=0;for(o=0;o<s.length;o+=3){var f=s[o]*e,d=s[o+1]*e,p=s[o+2]*e;u+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===h&&0===u?0:Math.abs((u-h)/h)},_e$4.flatten=function(t){for(var i=t[0][0].length,e={vertices:[],holes:[],dimensions:i},s=0,n=0;n<t.length;n++){for(var r=0;r<t[n].length;r++)for(var h=0;h<i;h++)e.vertices.push(t[n][r][h]);n>0&&e.holes.push(s+=t[n-1].length)}return e};var $e$4=Me$4.exports;const Ye$4={"clip-inside":.1,"clip-outside":.2,"flat-inside":.3,"flat-outside":.4,color:.5,video:.6,elevate:.7},Xe$4=[],Je$4=[1,1,1],Ze$4={polygonFill:[255,0,0],polygonOpacity:.8},Ke$4=new t$1.Coordinate(0,0),Qe$4=new t$1.Coordinate(0,0),ts$4=[],is$4=new t$1.Coordinate(0,0),es$4=new t$1.Point(0,0),ss$4=new t$1.Point(0,0),ns$4=new t$1.Point(0,0);class rs$4 extends t$1.Polygon{getMode(){return this.Hs}remove(){const t=this.getLayer();return t?(t.removeMask(this),this.Ns(),super.remove(),this):this}getMesh(t,i,e){return this.isVisible()?(this._t||(this._t=this.ze(t,i,e)),this.Gs(this._t,i,e),this._t):null}js(t){const i=this.getMap(),e=this.toGeoJSON(),s=$e$4.flatten(e.geometry.coordinates);for(let t=0;t<s.vertices.length;t+=2){is$4.x=s.vertices[t],is$4.y=s.vertices[t+1];const e=wt$5(i,is$4);s.vertices[t]=e[0],s.vertices[t+1]=e[1]}const n=wt$5(i,this.getCenter()),r=[],h="video"===this.getMode()?4:s.vertices.length/2;for(let t=0;t<h;t++)r.push(s.vertices[2*t]-n[0]),r.push(s.vertices[2*t+1]-n[1]),r.push(0);const o=$e$4(r,s.holes,3),a=new Q$7({POSITION:r,TEXCOORD:this.Bs(s.vertices)},o,0,{positionAttribute:"POSITION",uv0Attribute:"TEXCOORD"});return a.generateBuffers(t),a}Bs(t){const i=[0,0,1,0,1,1,0,1];if(this.hasHoles())for(let e=i.length/2-1;e<t.length;e+=2)i[e]=i[e+1]=0;return i}Us(){this.Ns(),delete this._t}zs(){return Ye$4[this.Hs]}Vs(){const t=this.getSymbol(),{polygonFill:i,polygonOpacity:e}=t||Ze$4,s=mt$5([],i);return s[0]/=255,s[1]/=255,s[2]/=255,s[3]=ct$5(e)?e:Ze$4.polygonOpacity,s}Ws(t=0){const i=this.getMap(),e=i.getGLRes();return i.altitudeToPoint(t,e)}qs(t){const i=wt$5(this.getMap(),this.getCenter()),e=fromRotationTranslationScale(t.localTransform,identity$1(Xe$4),i,Je$4);t.localTransform=e}Ns(){this._t&&(this._t.material&&this._t.material.dispose(),this._t.geometry&&this._t.geometry.dispose(),this._t.dispose(),delete this._t)}containsPoint(t){const i=this.getExtent();if(is$4.x=t[0],is$4.y=t[1],!i.contains(is$4))return!1;const e=this.getHoles();for(let i=0;i<e.length;i++)if(this.$s(e[i],t))return!1;const s=this.getShell();return this.$s(s,t)}$s(t,i){const e=this.Ys(t);let s=0;for(let e=0;e<t.length;e++){Ke$4.x=t[e].x,Ke$4.y=t[e].y;const n=e+1>=t.length?0:e+1;Qe$4.x=t[n].x,Qe$4.y=t[n].y,is$4.x=i[0],is$4.y=i[1],ts$4[0]=is$4,ts$4[1]=Ke$4,ts$4[2]=Qe$4,s+=this.Ys(ts$4)}return!(Math.abs(s-e)>1e-8)}Ys(t){const i=this.getMap();let e=0;const s=i.getGLRes(),n=i.coordToPointAtRes(t[0],s,es$4);for(let a=1;a<t.length-1;a++){const l=i.coordToPointAtRes(t[a],s,ss$4),c=i.coordToPointAtRes(t[a+1],s,ns$4);e+=Math.abs((o=c,((h=l).x-(r=n).x)*(o.y-r.y)-(h.y-r.y)*(o.x-r.x)))/2}var r,h,o;return e}}const hs$4=["shapechange","symbolchange","heightrangechange","flatheightchange"],os$4=new t$1.Coordinate(0,0),as$4=[],ls$4=[];function cs$5(){return this._maskList?(this._maskList.forEach((t=>{t.remove()})),this._maskList=[],this.updateExtent("shapechange"),this):this}function us$4(t){const i=this.getMap(),e=i.getView(),s=i.getFitZoom(t),n=t.getCenter();i.setView({center:n,zoom:s,pitch:0,bearing:0});const r=i.getExtent(),h=copy$5([],i.projViewMatrix);return i.setView(e),{mapExtent:r,projViewMatrix:h}}function fs$4(){for(let t=0;t<this._maskList.length;t++)if(this._maskList[t].isVisible())return!0;return!1}function ds$4(t){return class extends t{removeMask(t){if(!this._maskList)return this;if(!t)return cs$5.call(this),this;const i=Array.isArray(t)?t:[t];for(let t=0;t<i.length;t++){const s=this._maskList.indexOf(i[t]);s>-1&&this._maskList.splice(s,1)}return this.updateExtent("shapechange"),this}setMask(t){return this.removeMask(),this._maskList||(this._maskList=[]),Array.isArray(t)?t.forEach((t=>{this._maskList.push(t)})):this._maskList.push(t),this._maskList.forEach((t=>{t._bindLayer(this),t.Xs&&t.Xs()})),this.updateExtent("shapechange"),this}onAdd(){super.onAdd(),this.updateExtent("shapechange")}getMasks(){return this._maskList||[]}_onGeometryEvent(t){if(!t||!t.target)return;const i=t.type;"shapechange"===i&&t.target instanceof rs$4&&t.target.Us(),t.target instanceof rs$4&&hs$4.indexOf(i)>-1&&this.updateExtent(i),super._onGeometryEvent&&super._onGeometryEvent(t)}identifyMask(t,i){if(!this.getMap())return[];if(!this._maskList||!this._maskList.length)return[];const e=at$5({},i);e.excludeMasks=!0;const s=this.identifyAtPoint(t,e),n=s.length&&s[0].coordinate;return n?this._hitMasks(n):[]}_hitMasks(t){const i=this._maskList;if(!i)return[];const e=[];for(let s=0;s<i.length;s++){const n=i[s].getMode();!i[s].containsPoint(t)||"color"!==n&&"video"!==n||e.push(i[s])}return e}remove(){this._maskList&&this._maskList.length&&this._maskList.forEach((t=>{t.remove()})),super.remove()}updateMask(t){const i=this.getMap(),{projViewMatrix:e,mapExtent:s}=us$4.call(this,t);os$4.x=s.xmin,os$4.y=s.ymin;const n=ps$4(as$4,os$4,i);os$4.x=s.xmax,os$4.y=s.ymax;const r=ps$4(ls$4,os$4,i);return{projViewMatrix:e,extentInWorld:[n[0],n[1],r[0],r[1]]}}updateExtent(t){if(!this._maskList)return;if(!this.getMap())return;const i=this.getRenderer();if(i&&!this._maskList.length)return void i._clearMask();if(i&&!fs$4.call(this))return i._deleteMaskUniforms(),void i.setToRedraw();const e=this.getMaskExtent();if(!e)return;const{extent:s,ratio:n,minHeight:r}=e;if(t||!this._projViewMatrix||!this._projViewMatrix){const{projViewMatrix:t,extentInWorld:i}=this.updateMask(s);this._projViewMatrix=t,this.Js=i}i?i.setMask(this.Js,this._projViewMatrix,n,r):this.once("renderercreate",(t=>{t.renderer.setMask(this.Js,this._projViewMatrix,n,r)}))}getMaskExtent(){let t=1/0,i=1/0,e=-1/0,s=-1/0,n=-1/0,h=1/0,o=!1;for(let r=0;r<this._maskList.length;r++){const a=this._maskList[r];if(!a.isVisible())continue;const l=a.getExtent();if(l&&this.Zs(l)&&(o=!0,l.xmin<t&&(t=l.xmin),l.ymin<i&&(i=l.ymin),l.xmax>e&&(e=l.xmax),l.ymax>s&&(s=l.ymax),a.Ks)){const t=a.Ks();t[0]<h&&(h=t[0]),t[1]>n&&(n=t[1])}}if(!o)return null;const{ratio:a,minHeight:l}=function(t,i){const e=t===1/0?0:t,n=Math.abs((i===-1/0?0:i)-e);return 0===n?{ratio:1,minHeight:0}:{ratio:Math.pow(n,-1),minHeight:e}}(h,n);return{extent:new t$1.Extent(t,i,e,s),ratio:a,minHeight:l}}Zs(t){return this.getMap().getExtent().intersects(t)}}}function ps$4(t,e,s,n=0){if(!(s&&e instanceof t$1.Coordinate))return null;const r=s.coordinateToPointAtRes(e,s.getGLRes());return t[0]=r.x,t[1]=r.y,t[2]=n,t}const gs$4=new t__namespace.Coordinate(0,0),ms$4=new t__namespace.Coordinate(0,0),vs$4=new t__namespace.Point(0,0),ws$4=[],xs$3={tileGrids:[],count:0},Ms$3="01",_s$3="1";class ys$4 extends(ds$4(t__namespace.TileLayer)){constructor(t,i){i&&!i.tileSystem&&("cesium"===i.type||"cesium-ion"===i.type?i.tileSystem=[1,1,-180,-90]:"tianditu"===i.type&&(i.tileSystem=[1,-1,-180,90])),super(t,i)}getTileUrl(t,i,e){let s=super.getTileUrl(t,i,e);return"mapbox"===this.options.type&&this.options.requireSkuToken&&(this.Qs||(this.Qs=this.tn()),s.indexOf("?")>-1?s+="&sku="+this.Qs:s+="?sku="+this.Qs),s}getMaxAvailableZoom(){return this.getSpatialReference().getMaxZoom()}tn(){let t="";for(let i=0;i<10;i++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return[_s$3,Ms$3,t].join("")}setSkinLayers(t){this.in=t;const i=this.getRenderer();i&&(i.clear(),i.setToRedraw())}getSkinTiles(i){const e=this.getRenderer();if(!e)return xs$3;const s=e.getTileGridsInCurrentFrame().tileGrids[0];if(!s)return xs$3;const n=i.getId(),r=this._getTileConfig().tileSystem.scale,h=i.getTileSize().width,o=s.tiles;if(!o.length)return xs$3;const a=this.getMap(),l=s.parents||ws$4,c=l.length,u=l.concat(o),f=i.getSpatialReference(),d=o[0].extent2d.getWidth(),p=r.x,g=r.y,m=[],v=[],w=new Set,x=this._getTileConfig().tileSystem.scale.y;for(let e=0;e<u.length;e++){const s=u[e],{res:r}=s;let o=s.nw;o||(o=s.nw=a.pointAtResToCoord(s.extent2d.getMin(vs$4),s.res));const{res:l,zoom:M}=Ui$3(f,s.z,r),_=l/r,y=Bi$3(l,h,r,d),{extent2d:b,offset:S}=s,C=y*s.x,T=y*s.y;if(s.skinTileIds||(s.skinTileIds={}),!s.skinTileIds[n]){const e=new Set,r=[],a=ji$3(i,s.x,s.y,M,o,S,g,y,0);for(let s=0;s<a.length;s++){const n=a[s];if(e.has(n.id))continue;n.idx=n.x,n.idy=n.y,n.res=l,n.url=i.getTileUrl(n.x,n.y,n.z+i.options.zoomOffset);const c=g*(n.skinY-T)*h,u=b.xmin*_+p*(n.x-C)*h,f=b.ymax*_+c,d=b.ymin*_+c;n.extent2d=x>0?new t__namespace.PointExtent(u,d,u+h,d+h):new t__namespace.PointExtent(u,f-h,u+h,f),e.add(n.id),r.push(n)}s.skinTileIds[n]=r}const k=s.skinTileIds[n];for(let t=0;t<k.length;t++)w.has(k[t].id)||(e<c?m.push(k[t]):v.push(k[t]),w.add(k[t].id))}return{tileGrids:[{extent:s.extent,tiles:v,parents:m,count:v.length}],count:v.length}}getSkinLayer(t){return this.getSkinLayers()[t]}getSkinLayers(){return this.in||ws$4}getSkinCount(){return this.in&&this.in.length||0}queryTerrainByProjCoord(t,i){i=i||[];const e=this.getRenderer();if(!e)return i[0]=null,i[1]=0,i;const s=this.getMap(),n=e.ks(t);if(!n)return i[0]=null,i[1]=0,i;const r=s._prjToPointAtRes(t,1,vs$4);return e.As(i,n.id,n,r,1)}queryTileTerrainByProjCoord(t,i,e,s){s=s||[];const n=this.getRenderer();if(!n)return s[0]=null,s[1]=0,s;const r=this.getMap()._prjToPointAtRes(t,1,vs$4);return n.As(s,i,e,r,1)}queryTileTerrainByPointAtRes(t,i,e,s,n){n=n||[];const r=this.getRenderer();return r?r.As(n,e,s,t,i):(n[0]=null,n[1]=0,n)}queryTerrain(t,i){if(i=i||[],!this.getRenderer())return i[0]=null,i[1]=0,i;const e=this.getMap().getProjection().project(t,gs$4);return this.queryTerrainByProjCoord(e,i)}queryTileMesh(t,i){const e=this.getRenderer();e&&e.en(t,i)}getTerrainTiles(i){const{x:e,y:s,z:n,res:r,offset:h}=i,o=i.extent2d.getWidth(),a=this._getTileConfig(),l=this.getSpatialReference(),{res:c,zoom:u}=Ui$3(l,n,r),f=this.getTileSize().width,d=Bi$3(c,f,r,o);let p=i.nw;p||(p=i.nw=this.getMap().pointAtResToCoord(i.extent2d.getMin(vs$4),i.res));const g=Ni$3(this,e,s,u,p,h,a.tileSystem.scale.y,d,1)[0];for(let i=0;i<g.length;i++){const{x:e,y:s}=g[i],n=a.getTilePointNW(e,s,c,vs$4);g[i].res=c,g[i].extent2d=new t__namespace.PointExtent(n.x,n.y,n.x+f,n.y-f)}return g}isTerrainTileLoaded(t){const i=this.getRenderer();return!!i&&i.isTileCached(t)}updateMaterial(t){if(!t)return;this.options.material||(this.options.material={}),at$5(this.options.material,t);const i=this.getRenderer();i&&i.updateMaterial(t)}setMaterial(t){if(!t)return;this.options.material=t;const i=this.getRenderer();i&&i.setMaterial(t)}Cs(t,i,e,s,n,r,h,o,a,l){const c=this.getMap(),u=this.options.zoomOffset;a||(a=this._getTileConfig().getTilePrjExtent(t,i,r).convertTo((t=>c._prjToPointAtRes(t,r,ms$4))));const f=this._getTileOffset(e);return{parent:o,layer:this.getId(),x:t,y:i,z:e,idx:s,idy:n,res:r,extent2d:a,id:l||this._getTileId(t,i,e),url:this.getTileUrl(t,i,e+u),offset:f,error:h,children:[]}}}ys$4.mergeOptions({forceRenderOnMoving:!0,forceRenderOnZooming:!0,forceRenderOnRotating:!0,fadeAnimation:!1,fadeDuration:1e3/60*15,tileLimitPerFrame:2,newTerrainTileRenderLimitPerFrameOnInteracting:1,opacity:1,renderer:"gl",pyramidMode:1,tileSize:256,terrainWidth:65,backZoomOffset:0,depthMask:!0,blendSrc:"one",blendDst:"one minus src alpha",requireSkuToken:!0,cesiumIonTokenURL:"https://api.cesium.com/v1/assets/1/endpoint?access_token=",tileRetryCount:0,shader:"default",terrainTileMode:!0,tempTileCacheSize:64,tileStackStartDepth:7,tileStackDepth:6}),ys$4.registerJSONType("TerrainLayer"),ys$4.registerRenderer("gl",ge$4);const bs$4=()=>{},Ss$3=[null,0];class Cs$3 extends t__namespace.Layer{static fromJSON(i){if(!i||"GroupGLLayer"!==i.type)return null;const e=i.layers.map((i=>t__namespace.Layer.fromJSON(i)));return new Cs$3(i.id,e,i.options)}constructor(t,i,e){super(t,e),this.layers=i&&i.slice()||[],this.layers.forEach((t=>{if(t.getMap())throw new Error(`layer(${t.getId()} is already added on map`)})),this.sn(),this.sortLayersByZIndex(),this.nn={}}sortLayersByZIndex(){if(this.layers&&this.layers.length){for(let t=0,i=this.layers.length;t<i;t++)this.layers[t].__group_gl_order=t;this.layers.sort(ks$3)}}setSceneConfig(t){this.options.sceneConfig=t;const i=this.getRenderer();return i&&i.updateSceneConfig(),this}getSceneConfig(){return JSON.parse(JSON.stringify(this.ut()))}ut(){return this.options.sceneConfig||{}}getGroundConfig(){return this.ut().ground}getWeatherConfig(){return this.ut().weather}addLayer(t,i){if(t.getMap())throw new Error(`layer(${t.getId()}) is already added on map`);if("gl"!==t.options.renderer)throw new Error(`layer(${t.getId()})'s renderer is canvas, not supported to be added to GroupGLLayer`);void 0===i?this.layers.push(t):this.layers.splice(i,0,t),this.sn(),this.sortLayersByZIndex();const e=this.getRenderer();return e?(this.rn(t),this.hn(),e.setToRedraw(),this):this}removeLayer(i){t__namespace.Util.isString(i)&&(i=this.getChildLayer(i));const e=this.layers.indexOf(i);if(e<0)return this;const s=i.getRenderer();s&&s.setTerrainHelper&&s.setTerrainHelper(null),i._doRemove(),this.an(i),delete this.nn[i.getId()],this.layers.splice(e,1);const n=this.getRenderer();return n?(this.hn(),n.setToRedraw(),this):this}clearLayers(){const t=this.getLayers();for(let i=0;i<t.length;i++)t[i]&&t[i].remove();return this}ki(){let t=0;for(let i=0;i<this.layers.length;i++)this.layers[i].setPolygonOffset&&this.layers[i].getPolygonOffsetCount&&(t+=this.layers[i].getPolygonOffsetCount());let i=0;for(let e=this.layers.length-1;e>=0;e--)this.layers[e].setPolygonOffset&&this.layers[e].getPolygonOffsetCount&&(this.layers[e].setPolygonOffset(i,t),i+=this.layers[e].getPolygonOffsetCount());this.ln=i}getPolygonOffsetCount(){return this.ln}getLayers(){return this.layers.slice()}ue(){return this.layers}toJSON(){const t=[];if(this.layers)for(let i=0;i<this.layers.length;i++){const e=this.layers[i];e&&e&&e.toJSON&&t.push(e.toJSON())}return{type:this.getJSONType(),id:this.getId(),layers:t,options:this.config()}}onLoadEnd(){this.layers.forEach((t=>{this.rn(t)})),this.options.terrain&&this.cn(),super.onLoadEnd()}rn(t){const i=this.getMap();this.nn[t.getId()]=t,t._canvas=this.getRenderer().canvas,t._bindMap(i),t.once("renderercreate",this.un,this),t.remove=()=>{this.removeLayer(t),t.constructor.prototype.remove.call(t),delete t.remove},t.load(),this.dn(t)}onRemove(){this.pn(),this.layers.forEach((t=>{this.gn(t),t._doRemove(),this.an(t)})),this.nn={},this.clearAnalysis(),super.onRemove()}getChildLayer(t){return this.nn[t]||null}getLayer(t){return this.getChildLayer(t)}dn(t){t.on("show hide",this.mn,this),t.on("idchange",this.vn,this)}an(t){t.off("show hide",this.mn,this),t.off("idchange",this.vn,this)}mn(){const t=this.getRenderer();t&&t.setToRedraw()}vn(t){const i=t.new,e=t.old,s=this.getLayer(e);delete this.nn[e],this.nn[i]=s}un(t){t.renderer.clearCanvas=Ts$3}sn(){const t={};this.layers.forEach((i=>{const e=i.getId();if(t[e])throw new Error(`Duplicate child layer id (${e}) in the GroupGLLayer (${this.getId()})`);t[e]=1}))}addAnalysis(t){this.wi=this.wi||[],this.wi.push(t);const i=this.getRenderer();i&&i.setToRedraw()}removeAnalysis(t){if(this.wi){const i=this.wi.indexOf(t);i>-1&&(this.wi.splice(i,1),t.remove())}const i=this.getRenderer();i&&i.setToRedraw()}clearAnalysis(){this.wi&&(this.wi.forEach((t=>{t.remove()})),this.wi=[]);const t=this.getRenderer();t&&t.setToRedraw()}identify(i,e={}){const s=this.getMap(),n=this.getRenderer();if(!s||!n)return[];const r=s.coordToContainerPoint(new t__namespace.Coordinate(i));return this.identifyAtPoint(r,e)}identifyAtPoint(t,i={}){const e=i.includeInternals,s=this.getLayers(),n=i&&i.childLayers||s,r=this.getMap();if(!r)return[];const h=lt$5(i.count)?1:i.count;let o=[];for(let r=n.length-1;r>=0;r--){const h=n[r];if(s.indexOf(h)<0||!h.identifyAtPoint)continue;const a=h.options.geometryEvents;if(e&&(void 0===a||!1===a||0===a))continue;if(h.isGeometryListening&&e&&i.eventTypes.indexOf("mousemove")>=0&&!h.isGeometryListening(i.eventTypes))continue;let l=h.identifyAtPoint(t,i);if(!l||!l.length)continue;if(i.filter&&(l=l.filter((t=>i.filter(t)))),!l.length)continue;const c=h.getId();for(let t=0;t<l.length;t++)l[t]&&(l[t].layer=c);o.push(...l)}if(i.orderByCamera){const t=r.cameraPosition;o.sort(((i,e)=>e.point?i.point?dist$2(i.point,t)-dist$2(e.point,t):1:-1))}return h&&(o=o.slice(0,h)),o}getTerrain(){return this.options.terrain}setTerrain(t){return this.options.terrain=t,this.getRenderer()?(this.cn(),this.getMap().updateCenterAltitude(),this):this}removeTerrain(){return this.setTerrain(null)}updateTerrainMaterial(t){this.le&&t&&(this.options.terrain.material?at$5(this.options.terrain.material,t):this.options.terrain.material=t,this.le.updateMaterial(t))}cn(){const t=this.getRenderer();t&&t.setToRedraw();const i=this.options.terrain;if(this.le){const t=this.le.options;if(i&&t.urlTemplate===i.urlTemplate&&t.spatialReference===i.spatialReference){for(const t in i)"material"===t?this.le.setMaterial(i[t]):"urlTemplate"!==t&&"spatialReference"!==t&&this.le.config(t,i[t]);return this}this.pn()}if(this.wn(),!i)return this;this.le=new ys$4("__terrain_in_group",i),this.hn(),this.le.on("tileload",this.xn,this),this.rn(this.le);const e=i.masks;return e&&e.length?this.le.setMask(e):this.le.removeMask(),this.fire("terrainlayercreated"),this}queryTerrain(t,i){return this.le?this.le.queryTerrain(t,i):Ss$3}queryTerrainByProjCoord(t,i){return this.le?this.le.queryTerrainByProjCoord(t,i):Ss$3}hn(){if(!this.le)return;const t=this.layers,i=[];for(let e=0;e<t.length;e++){if(!t[e])continue;const s=t[e],n=s.getRenderer();if(n.renderTerrainSkin){if(n.deleteTile===bs$4){i.push(t[e]);continue}s.getTiles=()=>this.le.getSkinTiles(s),n.drawTile=n.drawTileOnTerrain?(...t)=>n.drawTileOnTerrain(...t):bs$4,n.deleteTile=bs$4,i.push(t[e])}n.setTerrainHelper&&n.setTerrainHelper(this.le)}this.le.setSkinLayers(i)}gn(t){if(!function(t){if(!t)return!1;const i=t.getRenderer();return!!i&&!!i.renderTerrainSkin}(t))return;const i=t.getRenderer();i&&(i.setTerrainHelper&&i.setTerrainHelper(null),i.clear&&i.clear(),delete i.drawTile,delete i.deleteTile),delete t.getTiles}wn(){const t=this.layers;for(let i=0;i<t.length;i++)t[i]&&this.gn(t[i])}xn(){const t=this.getRenderer();t&&t.setToRedraw()}pn(){if(this.le){const t=this.le;t.off("tileload",this.xn,this),this.an(t),this.le._doRemove(),delete this.le,this.fire("terrainlayerremoved")}}getTerrainLayer(){return this.le}_bindMap(...t){if(this.options.single){const i=t[0].getLayers();for(let t=0;t<i.length;t++)if(i[t]instanceof Cs$3)throw new Error("Only one GroupGLLayer is allowed in a map instance. Set options.single to false if you want to add two or more GroupGLLayers.")}return super._bindMap(...t)}fire(...t){if("layerload"===t[0]){const t=this.ue();for(const i of t){const t=i.getRenderer();t&&t.isRenderComplete()&&i.fire("layerload")}}super.fire(...t)}}function Ts$3(){}function ks$3(t,i){const e=t.getZIndex()-i.getZIndex();return 0===e?t.__group_gl_order-i.__group_gl_order:e}Cs$3.mergeOptions({renderer:"gl",antialias:!0,extensions:[],single:!0,onlyWebGL1:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","EXT_frag_depth","EXT_texture_filter_anisotropic","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,viewMoveThreshold:100,geometryEvents:!0,multiSamples:4,forceRedrawPerFrame:!1}),Cs$3.registerJSONType("GroupGLLayer"),Cs$3.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{setToRedraw(){this.setRetireFrames(),super.setToRedraw()}onAdd(){super.onAdd(),this.prepareCanvas()}updateSceneConfig(){this._i&&this._i.update(),this.yi&&this.yi.update(),this.bi&&this.bi.update(),this.setToRedraw()}render(...t){this.getMap()&&this.layer.isVisible()&&(this.forEachRenderer((t=>{t._replacedDrawFn||(t.draw=this.Si(t.draw),t.drawOnInteracting=this.Ci(t.drawOnInteracting),t.setToRedraw=this.Ti(t.setToRedraw),t._replacedDrawFn=!0)})),this.prepareRender(),this.prepareCanvas(),this.layer.ki(),this._toRedraw=!1,this.Ai("render",t),this.Oi(),this.Ii())}prepareCanvas(){super.prepareCanvas(),this.forEachRenderer((t=>{t.prepareCanvas()}))}drawOnInteracting(...t){this.getMap()&&this.layer.isVisible()&&(this.layer.ki(),this._toRedraw=!1,this.Ai("drawOnInteracting",t),this.Oi(),this.Ii())}Ai(t,i){this.Ei="default";const e=this.hasRenderTarget(),s=this.Li(i);if(e&&(this.Fi.renderTarget=this.Ri()),this.yi.paint(s),this.drawGround(!0),!e)return void this.Pi("default",null,t,i,!0);const n=this.glCtx,r=this.layer.ut(),h=r&&r.postProcess,o=this.isSSROn(),a=this.isEnableTAA(),l=s.jitter;s.jitter=Si$3;const c=this.layer.getGroundConfig();if(s.hasSSRGround=!!(o&&c&&c.enable&&c.symbol&&c.symbol.ssr),n.resetDrawCalls(),this.Pi(a?"fxaaBeforeTaa":"fxaa",this.Di,t,i),this.Hi=n.getDrawCalls(),o&&this.Ni.drawSSR(this.Gi(),this.Di),a){const e=this.getMap(),r=this.Ni.isTaaNeedRedraw()||this.ji||e.getRenderer().isViewChanged();s.jitter=r?l:this.Bi.getAverage(),s.onlyUpdateDepthInTaa=!r;let o=this.Ui;if(o)o.width===this.Di.width&&o.height===this.Di.height||o.resize(this.Di.width,this.Di.height);else{const t=this.regl,i=this.createFBOInfo(h,this.zi);o=this.Ui=t.framebuffer(i)}n.resetDrawCalls(),this.Pi("taa",o,t,i),this.Vi=n.getDrawCalls(),delete s.onlyUpdateDepthInTaa,s.jitter=Si$3;let a=this.Wi;if(a)a.width===this.Di.width&&a.height===this.Di.height||a.resize(this.Di.width,this.Di.height);else{const t=this.regl,i=this.createFBOInfo(h,this.zi);a=this.Wi=t.framebuffer(i)}n.resetDrawCalls(),this.Pi("fxaaAfterTaa",this.Wi,t,i),this.qi=n.getDrawCalls()}else this.Ui&&(this.Ui.destroy(),this.Wi.destroy(),delete this.Ui,delete this.Wi,delete this.qi);h.bloom&&h.bloom.enable&&(this.$i=this.Ni.drawBloom(this.zi)),2===o&&this.Ni.drawSSR(this.Gi(),this.Di,!0),n.resetDrawCalls(),this.Pi("noAa",this.Yi,t,i),this.Xi=n.getDrawCalls(),n.resetDrawCalls(),this.Pi("point",this.Ji,t,i,!0),this.bi.renderScene(s),this.Zi=n.getDrawCalls()}Pi(t,i,e,s,n){this.Ei=t;const r=this.Li(s);r.renderMode=this.Ei,r.renderTarget&&(r.renderTarget.fbo=i),n&&(r.isFinalRender=!0),this.forEachRenderer(((n,r)=>{r.isVisible()&&("default"===t||!n.supportRenderMode&&("fxaa"===t||"fxaaAfterTaa"===t)||n.supportRenderMode&&n.supportRenderMode(t))&&(this.clearStencil(n,i),n[e].apply(n,s))}))}Li(t){let i=t[0];return Oi$3(i)||(i=t[1]),i!==this.Ki&&(this.forEachRenderer(((t,i)=>{i.isVisible()&&t.needRetireFrames&&t.needRetireFrames()&&this.setRetireFrames()})),this.Fi=this.Qi(i),this.Ki=i,this.te=Oi$3(t[0])?null:t[0]),this.Fi}Oi(){if(!this.isEnableOutline())return;const t=this.ie(),i=this.glCtx;i.resetDrawCalls(),this.forEachRenderer(((i,e)=>{e.isVisible()&&i.drawOutline&&i.drawOutline(t)})),this.ee=i.getDrawCalls()}ie(){const{width:t,height:i}=this.canvas;let e=this.se;if(e)t===e.width&&i===e.height||e.resize(t,i);else{const s=this.regl.texture({width:t,height:i,format:"rgba4"});e=this.se=this.regl.framebuffer({width:t,height:i,colors:[s],depth:!1,stencil:!1})}return e}ii(t){if(this.vi()){const i=this.ne(t);return i.width!==t.width||i.height!==t.height?i.resize(t.width,t.height):this.regl.clear({color:[0,0,0,0],fbo:i}),i.blit(t),i.color[0]}return t.color[0]}Gi(){if(this.zi.subimage)return this.zi;const{width:t,height:i}=this.zi;if(!this.re){const e=this.regl,s={depthStencil:e.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:t,height:i,format:"depth stencil"}),colors:[e.renderbuffer({width:t,height:i,format:"rgba4"})],colorFormat:"rgba4",width:t,height:i};this.re=e.framebuffer(s)}return this.re.width===t&&this.re.height===i||this.re.resize(t,i),this.regl.clear({color:[0,0,0,0],depth:1,fbo:this.re}),this.re.blit(this.Di,256,"nearest"),this.re.depthStencil}ne(t){if(this.he||(this.he=[]),!t.oe){const i=this.ae(!0,t.width,t.height),e=this.regl.framebuffer(i);this.he.push(e),t.oe=e}return t.oe}vi(){return 0===this.regl.limits.version.indexOf("WebGL 2.0")&&this.layer.options.antialias}hasRenderTarget(){const t=this.layer.ut(),i=t&&t.postProcess;return!(!i||!i.enable)}testIfNeedRedraw(){if(this.layer.options.forceRedrawPerFrame)return!0;if(this._toRedraw)return this._toRedraw=!1,!0;if(this.getMap().isInteracting()&&(this._i&&this._i.isEnable()||this.yi&&this.yi.isEnable()))return!0;if(this.bi&&this.bi.isEnable())return!0;const t=this.layer.le;if(t){const i=t.getRenderer();if(i&&i.testIfNeedRedraw())return this.ce=!0,!0}const i=this.ue();for(const t of i){const i=t.getRenderer();if(i&&i.testIfNeedRedraw())return this.ce=!0,!0}return!1}isRenderComplete(){const t=this.ue();for(const i of t){const t=i.getRenderer();if(t&&!t.isRenderComplete())return!1}return!0}mustRenderOnInteracting(){const t=this.ue();for(const i of t){const t=i.getRenderer();if(t&&t.mustRenderOnInteracting())return!0}return!1}isCanvasUpdated(){if(super.isCanvasUpdated())return!0;const t=this.ue();for(const i of t){const t=i.getRenderer();if(t&&t.isCanvasUpdated())return!0}return!1}isBlank(){if(this._i&&this._i.isEnable())return!1;if(this.yi&&this.yi.isEnable())return!1;const t=this.layer.getTerrainLayer();if(t){const i=t.getRenderer();if(i&&!i.isBlank())return!1}const i=this.ue();for(const t of i){const i=t.getRenderer();if(i&&!i.isBlank())return!1}return!0}createContext(){const t=this.layer,i=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0};i.preserveDrawingBuffer=!0,i.antialias=!!t.options.antialias,this.glOptions=i;const e=this.gl=function(t,i,e){const s=e?["webgl","experimental-webgl"]:["webgl2","webgl","experimental-webgl"];let n=null;for(let e=0;e<s.length;++e){try{n=t.getContext(s[e],i)}catch(t){}if(n)break}return n||console.error("Browser doesn't support WebGL."),n}(this.canvas,i,t.options.onlyWebGL1);this.fe(e),e.wrap=()=>new a(this.gl),this.glCtx=e.wrap(),this.canvas.gl=this.gl,this.reglGL=e.wrap(),this.regl=a$2({gl:this.reglGL,attributes:i,extensions:t.options.extensions,optionalExtensions:t.options.optionalExtensions}),this.gl.regl=this.regl,this.de=[0,0],this._i=new jt$4(this.regl,this.layer),this.yi=new qt$4(this.regl,this.layer);const s=this.layer.getWeatherConfig();this.bi=new di$3(this.regl,t,s),this.pe=new _i$3(this.regl,t);const n=this.layer.ut()||{},r=n&&n.postProcess;this.Bi=new Bn$4(r&&r.antialias&&r.antialias.jitterRatio||.2),this.Ni=new vi$3(this.regl,this.layer,this.Bi),this.o=new yt$5(this.regl,n,this.layer)}fe(){const t=this.layer,i=this.gl,e=t.options.extensions;e&&e.forEach((t=>{i.getExtension(t)}));const s=t.options.optionalExtensions;s&&s.forEach((t=>{i.getExtension(t)})),this.gl.clearColor(0,0,0,0)}clearCanvas(){super.clearCanvas(),this.ge()}ge(){const t=this.regl;this.Di&&(t.clear({color:yi$3,depth:1,stencil:255,framebuffer:this.Di}),t.clear({color:yi$3,framebuffer:this.Yi}),t.clear({color:yi$3,framebuffer:this.Ji}),this.Ui&&this.Vi&&t.clear({color:yi$3,framebuffer:this.Ui}),this.Wi&&this.qi&&t.clear({color:yi$3,framebuffer:this.Wi})),this.se&&t.clear({color:yi$3,framebuffer:this.se}),t.clear({color:yi$3,depth:1,stencil:255})}resizeCanvas(){const t=this.canvas.width,i=this.canvas.height;!this.Di||this.Di.width===t&&this.Di.height===i||(super.resizeCanvas(),this.Di.resize(t,i),this.Yi.resize(t,i),this.Ji.resize(t,i),this.Ui&&this.Ui.resize(t,i),this.Wi&&this.Wi.resize(t,i),this.ge(),this.forEachRenderer((t=>{t.canvas&&t.resizeCanvas()})))}getCanvasImage(){return this.forEachRenderer((t=>{t.getCanvasImage()})),super.getCanvasImage()}ue(){return this.layer.ue()}forEachRenderer(t){const i=this.ue();for(const e of i){if(!e.isVisible()||!e.options.beneathTerrain)continue;const i=e.getRenderer();i&&t(i,e)}const e=this.layer.le;if(e){const i=e.getRenderer();i&&t(i,e)}for(const e of i){if(!e.isVisible()||e.options.beneathTerrain)continue;const i=e.getRenderer();i&&t(i,e)}}clearStencil(t,i){const e={stencil:t.getStencilValue?t.getStencilValue():255};i&&(e.framebuffer=i),this.regl.clear(e)}onRemove(){this.canvas.pickingFBO&&this.canvas.pickingFBO.destroy&&this.canvas.pickingFBO.destroy(),this.me(),this._i&&(this._i.dispose(),delete this._i),this.yi&&(this.yi.dispose(),delete this.yi),this.o&&(this.o.dispose(),delete this.o),this.Ni&&(this.Ni.dispose(),delete this.Ni),this.se&&(this.se.destroy(),delete this.se),this.bi&&(this.bi.dispose(),delete this.bi),super.onRemove()}me(){if(this.Di&&(this.Di.destroy(),this.Yi.destroy(),this.Ji.destroy(),this.Ui&&(this.Ui.destroy(),delete this.Ui),this.Wi&&(this.Wi.destroy(),delete this.Wi),delete this.Di,delete this.Yi,delete this.Ji,this.ve&&(this.ve.destroy(),delete this.ve),this.re&&(this.re.destroy(),delete this.re),this.he)){for(let t=0;t<this.he.length;t++)this.he[t]&&this.he[t].destroy();delete this.he}}setRetireFrames(){this.ji=!0}getFrameTime(){return this.Ki}getFrameEvent(){return this.te}getFrameContext(){return this.Fi}drawGround(t){const i=this.layer.getGroundConfig();if(!i||!i.enable)return!1;if(!this._i)return!1;const e=this.getFrameContext(),s=e.jitter;e.jitter=Si$3;const n=this.layer.getPolygonOffsetCount();let r;e.offsetFactor=n+1,e.offsetUnits=n+1,t&&(r=e.sceneFilter,delete e.sceneFilter);const h=this._i.paint(e);return this._i.needToRedraw()&&this.setToRedraw(),r&&(e.sceneFilter=r),e.jitter=s,h}Si(t){const i=this;return function(e,s){return(s=s||i.Fi)&&s.renderTarget&&(s.renderTarget.getFramebuffer=Ii$3,s.renderTarget.getDepthTexture=Ei$3),t.call(this,e,s)}}Ci(t){const i=this;return function(e,s,n){return(n=n||i.Fi)&&n.renderTarget&&(n.renderTarget.getFramebuffer=Ii$3,n.renderTarget.getDepthTexture=Ei$3),t.call(this,e,s,n)}}Ti(t){return function(...i){return t.apply(this,i)}}isEnableSSR(){const t=this.layer.ut(),i=t&&t.postProcess;return i&&i.enable&&i.ssr&&i.ssr.enable}isSSROn(){const t=this.isEnableSSR(),i=this.getMap();if(!t||i.getPitch()<=-.001)return 0;const e=i.projViewMatrix,s=this.Ni.getPrevSsrProjViewMatrix();return s&&exactEquals$5(s,e)?1:2}isEnableTAA(){return!1}isEnableSSAO(){const t=this.layer.ut(),i=t&&t.postProcess;return i&&i.enable&&i.ssao&&i.ssao.enable}isEnableOutline(){const t=this.layer.ut(),i=t&&t.postProcess;return i&&i.enable&&i.outline&&i.outline.enable}isEnableWeather(){const t=this.layer.ut(),i=t&&t.weather;return i&&i.enable}we(){const t=this.layer.getMap();if(!this.O){this.O={center:t.getCenter(),bearing:t.getBearing(),pitch:t.getPitch(),res:t.getResolution()};let i=!1;if(t.options.lights){const e=t.getLightManager().getDirectionalLight().direction||bi$3;this.O.lightDirection=copy$4([],e),i=!0}return{viewChanged:!0,lightDirectionChanged:i}}const i=t.getResolution()/this.O.res,e=t.coordToContainerPoint(this.O.center),s=this.layer.options.viewMoveThreshold,n=e._sub(t.width/2,t.height/2).mag()>s||i<.95||i>1.05;let r=!1;if(t.options.lights){const i=t.getLightManager().getDirectionalLight().direction||bi$3;r=!equals$5(this.O.lightDirection,i),r&&(this.O.lightDirection=copy$4([],i))}return n&&(this.O.center=t.getCenter(),this.O.bearing=t.getBearing(),this.O.pitch=t.getPitch(),this.O.res=t.getResolution()),{viewChanged:n,lightDirectionChanged:r}}Qi(t){const i=this.layer.ut(),e=i&&i.postProcess,s=i&&i.weather,n={timestamp:t,renderMode:this.Ei||"default",includes:{},states:this.we(),testSceneFilter:t=>!n.sceneFilter||n.sceneFilter(t),isFinalRender:!1,weather:{fog:s&&s.fog}},h=this.Bi;h&&h.setRatio(e&&e.antialias&&e.antialias.jitterRatio||.2);const o=this.isSSROn();let a;if(e&&e.enable){this.isEnableTAA()?((this.getMap().isInteracting()||this.ji)&&h.reset(),h.getJitter(this.de),h.frame()):set(this.de,0,0),n.jitter=this.de;const t=e.bloom&&e.bloom.enable;t&&o?(n.bloom=1,n.sceneFilter=Ci$3):t?(n.bloom=1,n.sceneFilter=Ti$3):o&&(n.sceneFilter=ki$3),a=this.Ri(),a&&(n.renderTarget=a)}else this.me();return"noAa"!==this.Ei&&(this.xe=this.Me(n),this.xe&&(n.includes.shadow=1),this._e=this.ye(n)),this.xe&&(n.shadow=this.xe,n.includes.shadow=1),n.states.includesChanged=this._e,e&&e.enable&&this.Ni&&this.Ni.setContextIncludes(n),n}be(t){const i=this.ue().filter((t=>t.isVisible()));return this.layer.le&&i.push(this.layer.le),this.pe.paint(t,i)}ye(t){let i=!1;const e=Object.keys(t.includes),s=this.Se;if(s){const t=e.filter((t=>-1===s.indexOf(t))).concat(s.filter((t=>-1===e.indexOf(t))));t.length&&(i=t.reduce(((t,i)=>(t[i]=1,t)),{}))}return this.Se=e,i}Me(t){const i=this.layer.ut();if(!i||!i.shadow||!i.shadow.enable)return this.o&&(this.o.dispose(),delete this.o),null;this.o||(this.o=new yt$5(this.regl,this.layer.ut()||{},this.layer));const e={config:i.shadow,defines:this.o.getDefines(),uniformDeclares:yt$5.getUniformDeclares()};return e.renderUniforms=this.Ce(t),e}Ce(t){const i=t.renderTarget&&t.renderTarget.fbo,e=this.layer.ut(),s=[];let n=t.states.lightDirectionChanged||t.states.viewChanged;this.forEachRenderer(((t,i)=>{if(!t.getShadowMeshes||!i.isVisible())return;const e=t.getShadowMeshes();if(Array.isArray(e))for(let t=0;t<e.length;t++)e[t].needUpdateShadow&&(n=!0),e[t].needUpdateShadow=!1,s.push(e[t])})),this.Te||(this.Te=new Ke$5),this.Te.setMeshes(s);const r=this.getMap(),h=e.shadow,o=r.getLightManager(),a=o&&o.getDirectionalLight().direction||bi$3;return this.o.render(!e.ground||!e.ground.enable,r.projMatrix,r.viewMatrix,h.color,h.opacity,a,this.Te,this.de,i,n)}ke(t){let i=[];if(this.forEachRenderer(((t,e)=>{if(!t.getAnalysisMeshes||!e.isVisible())return;const s=t.getAnalysisMeshes();i=i.concat(s)})),this._i){const t=this._i.getRenderMeshes();i=i.concat(t)}const e=this.layer.getWeatherConfig();return this.bi.paint(t,i,e)}getGroundMesh(){return this._i?this._i.getRenderMeshes():[]}Ri(){const t=this.layer.ut(),i=t&&t.postProcess;if(!this.Di){const t=this.regl;let e=this.zi;(!e||!e._texture||e._texture.refCount<=0)&&(e=null);const s=this.createFBOInfo(i,e);this.zi=s.depth||s.depthStencil,this.Di=t.framebuffer(s);const n=this.createFBOInfo(i,this.zi);this.Yi=t.framebuffer(n);const r=this.createFBOInfo(i,this.zi);this.Ji=t.framebuffer(r),this.ge()}return{fbo:this.Di}}ae(t,i,e){i=i||this.canvas.width,e=e||this.canvas.height;const s=this.regl,n=this.vi();let r;if(!t&&n)r=s.renderbuffer({width:i,height:e,samples:this.layer.options.multiSamples,format:"rgba8"});else{r=s.texture({min:"nearest",mag:"nearest",type:"uint8",width:i,height:e})}return{width:i,height:e,colors:[r],colorFormat:n?"rgba8":"rgba"}}createFBOInfo(t,i){const{width:e,height:s}=this.canvas,n=this.regl,r=this.ae(),h=this.vi(),o=n.hasExtension("WEBGL_depth_texture");if(h){const t=i||n.renderbuffer({width:e,height:s,format:"depth24 stencil8",samples:this.layer.options.multiSamples});r.depthStencil=t}else if(o){const t=i||n.texture({min:"nearest",mag:"nearest",mipmap:!1,type:"depth stencil",width:e,height:s,format:"depth stencil"});r.depthStencil=t}else{const t=i||n.renderbuffer({width:e,height:s,format:"depth stencil"});r.depthStencil=t}return r}Ii(){if(!this.Di)return void(this.ji=!1);const t=this.layer.ut(),i=t&&t.postProcess;if(!i||!i.enable){if(this.isEnableWeather())throw new Error("you must enable the post process to turn on weather");return}this.layer.fire("postprocessstart");const e=this.layer.getMap();let s;if(this.isEnableTAA()){const t=this.ji||e.getRenderer().isViewChanged();t&&this.layer.fire("taastart");const{outputTex:i,redraw:n}=this.Ni.taa(this.ii(this.Ui),this.Gi(),{projMatrix:e.projMatrix,needClear:t});s=i,n?this.setToRedraw():this.layer.fire("taaend"),this.ji=!1}let n=i.sharpen&&i.sharpen.factor;n||0===n||(n=.2);let r=0,h=.2,o=.3,a=1,l=[1,1,0];i.outline&&(r=+!!i.outline.enable,h=Li$3(i.outline,"highlightFactor",h),o=Li$3(i.outline,"outlineFactor",o),a=Li$3(i.outline,"outlineWidth",a),l=Li$3(i.outline,"outlineColor",l));const c=this.isEnableSSAO(),u=i.ssr&&i.ssr.enable,f=i.bloom&&i.bloom.enable,d=f&&this.$i,p=+!(!i.antialias||!i.antialias.enable),g=this.pe.xi(),m=this.bi.si(),v=c||f||u||g||m;let w=this.ve;if(v){if(!w){const t=this.ae();this.vi()&&(t.depthStencil=this.regl.renderbuffer({width:this.canvas.width,height:this.canvas.height,samples:this.layer.options.multiSamples,format:"depth24 stencil8"})),w=this.ve=this.regl.framebuffer(t)}const{width:t,height:i}=this.canvas;w.width===t&&w.height===i||w.resize(t,i)}else w=null,this.ve&&(this.ve.destroy(),delete this.ve);let x=this.ii(this.Di);const M=this.Xi&&this.ii(this.Yi),_=this.Zi&&this.ii(this.Ji);if(this.Ni.fxaa(w,x,!d&&M,!d&&_,s,this.qi&&this.Wi&&this.ii(this.Wi),p,+!(!i.toneMapping||!i.toneMapping.enable),+!(v||!i.sharpen||!i.sharpen.enable),e.getDevicePixelRatio(),n,r&&this.ee>0&&this.ie(),h,o,a,l),w&&(x=this.ii(w)),c&&(this.qi||this.Vi||this.Hi)&&(x=this.Ni.ssao(x,this.Gi(),{projMatrix:e.projMatrix,cameraNear:e.cameraNear,cameraFar:e.cameraFar,ssaoBias:i.ssao&&i.ssao.bias||10,ssaoRadius:i.ssao&&i.ssao.radius||100,ssaoIntensity:i.ssao&&i.ssao.intensity||.5})),f&&this.$i){const t=i.bloom,e=+t.threshold||0,s=Li$3(t,"factor",1),n=Li$3(t,"radius",1);x=this.Ni.bloom(x,M,_,e,s,n,p)}if(u&&(this.Ni.genSsrMipmap(x,this.Gi()),this.ce)){const t=this.ji;this.setToRedraw(),this.ji=t,this.ce=!1}this.pe&&(x=this.be(x)),this.isEnableWeather()&&(x=this.ke(x)),v&&this.Ni.renderFBOToScreen(x,+!(!i.sharpen||!i.sharpen.enable),n,e.getDevicePixelRatio()),this.layer.fire("postprocessend")}}),Cs$3.registerRenderer("canvas",null);class As$3{constructor(t){this.Mn=t,this.N=new Ve$5,this.onHDRLoaded=this._n.bind(this),this.onHDRError=this.yn.bind(this)}getDirectionalLight(){return this.jt&&this.jt.directional||{}}getAmbientLight(){return this.jt&&this.jt.ambient||{}}getAmbientResource(){return this.bn}setConfig(t){const i=this.jt;this.jt=JSON.parse(JSON.stringify(t));let e=!1;if(t&&t.ambient&&t.ambient.resource){if(!(i&&i.ambient&&function(t,i){return!!t.resource&&t.resource.url===i.resource.url}(i.ambient,t.ambient)))return void this.Sn();this.bn&&(t.ambient.prefilterCubeSize!==i.ambient&&i.ambient.prefilterCubeSize&&this._n(),e=!0,t.ambient.resource.sh&&(this.bn.sh=t.ambient.resource.sh))}else this.Cn(),e=i&&i.ambient&&i.ambient.resource;this.Mn.fire("updatelights",{ambientUpdate:e})}Tn(t){const i=t.getLayers();for(let t=0;t<i.length;t++){const e=i[t]&&i[t].getRenderer();if(e&&e.regl)return e.regl}const e=document.createElement("canvas"),s=a$2({canvas:e,attributes:{depth:!1,stencil:!1,alpha:!1}});return s.kn=!0,s}Sn(){const t=this.jt.ambient.resource,i=t&&t.url;if(!i)return;const e=[];let s=0,n=0;const r=()=>{n++,n>=s&&this.An(e)},h=function(){throw new Error(`skybox image with url(${this.src}) failed to load, please check the image's url.`)};if(i.top||i.nx){const{front:t,back:n,right:o,left:a,top:l,bottom:c}=i,{nx:u,ny:f,px:d,py:p,nz:g,pz:m}=i;let v;v=t?[a,o,n,t,l,c]:[u,d,g,m,p,f],s=v.length;for(let t=0;t<s;t++){const i=new Image;i.onload=r,i.onerror=h,i.src=v[t],e[t]=i}}else{this.On=new en$5({url:t.url,arrayBuffer:!0,hdr:!0,flipY:!0},this.N),this.On.once("complete",this.onHDRLoaded),this.On.once("error",this.onHDRError)}}dispose(){this.Cn()}_n(){this.On&&(this.bn=this.In(this.On),this.Mn.fire("updatelights",{ambientUpdate:!0}))}yn(){this.Mn.fire("hdrerror")}An(t){this.bn=this.In(t),this.Mn.fire("updatelights",{ambientUpdate:!0})}In(t){const i=this.jt.ambient.resource,e=i.prefilterCubeSize||128,s=this.Tn(this.Mn),n=fi$4.PBRHelper.createIBLMaps(s,{envTexture:Array.isArray(t)?t:t.getREGLTexture(s),rgbmRange:Array.isArray(t)?9:t.rgbmRange,ignoreSH:!!i.sh,envCubeSize:e,prefilterCubeSize:e,format:"array"});if(i.sh&&(n.sh=i.sh,Array.isArray(n.sh[0]))){const t=n.sh,i=[];for(let e=0;e<t.length;e++)i.push(...t[e]);n.sh=i}return s.kn&&(delete this.On,s.destroy()),n}Cn(){this.On&&(this.On.dispose(),delete this.On),delete this.bn}}let Os$3,Is$3,Es$3,Ls$3,Fs$3;t$1.Map.include({setLights(t){return this.options.lights=t,this.En(),this},getLights(){return this.options.lights},En(){this.Ln||(this.Ln=new As$3(this)),this.Ln.setConfig(this.getLights())},getLightManager(){return this.Ln?this.Ln:(this.Fn||(this.Fn=!0,console.warn("map's light config is not set, use map.setLights(config) to set lights.")),null)}}),t$1.Map.addOnLoadHook((function(){this.options.lights&&this.En()}));const Rs$3={color:[0,0,0,0]},Ps$3={enable:!0};t$1.Map.include({setPostProcessConfig(t){return this.options.postProcessConfig=t,this},getPostProcessConfig(){return this.options.postProcessConfig}});const Ds$3=t$1.renderer.MapCanvasRenderer.prototype.drawLayerCanvas;t$1.renderer.MapCanvasRenderer.prototype.drawLayerCanvas=function(){const t=Ds$3.apply(this,arguments);return t&&Ns$2(this,this.canvas),t};const Hs$2=t$1.renderer.MapCanvasRenderer.prototype.renderFrame;function Ns$2(t,i){const e=t.map.getPostProcessConfig();if(!e||!e.enable)return;var s,n;Os$3||(s=i.width,n=i.height,Os$3=document.createElement("canvas",s,n),Is$3=a$2({canvas:Os$3,attributes:{depth:!1,stencil:!1,alpha:!0,antialias:!1,premultipliedAlpha:!1}}),Es$3=Is$3.texture({mag:"linear",min:"linear",mipmap:!1,flipY:!0,width:s,height:n}),Ls$3=Is$3.texture()),Os$3.width===i.width&&Os$3.height===i.height||(Os$3.width=i.width,Os$3.height=i.height),Is$3.clear(Rs$3);const r=e.filmicGrain||Ps$3;void 0===r.enable&&(r.enable=!0);const h=e.vignette||Ps$3;void 0===h.enable&&(h.enable=!0);const o=e.colorLUT||Ps$3;void 0===o.enable&&(o.enable=!0),t.Rn||(t.Rn={});const a=t.Rn;if(o.enable){const i=o.lut;if(!a.lutTexture||a.lutTexture.url!==i){const e=new Image;e.onload=function(){const s={data:e,min:"linear",mag:"linear"},n=a.lutTexture?a.lutTexture.texture(s):Is$3.texture(s);a.lutTexture={url:i,texture:n},t.setLayerCanvasUpdated()},e.src=i}}const l={enableGrain:+!!r.enable,grainFactor:void 0===r.factor?.15:r.factor,timeGrain:performance.now(),enableVignette:+!!h.enable,lensRadius:h.lensRadius||[.8,.25],frameMod:1,enableLut:+!!o.enable,lookupTable:a.lutTexture?a.lutTexture.texture:Ls$3};Fs$3||(Fs$3=new vi$3(Is$3)),Fs$3.postprocess(null,l,Es$3({width:Os$3.width,height:Os$3.height,data:i,flipY:!0,mag:"linear",min:"linear",mipmap:!1})),r.enable&&t.setLayerCanvasUpdated(),t.context.drawImage(Os$3,0,0,Os$3.width,Os$3.height)}t$1.renderer.MapCanvasRenderer.prototype.renderFrame=function(){const t=Hs$2.apply(this,arguments),i=this.map.getPostProcessConfig(),e=i&&i.filmicGrain;return!e||void 0!==e.enable&&!0!==e.enable||this.setLayerCanvasUpdated(),t};const Gs$3=[];function js$2(t){t.properties.showOnlyTimestamp&&(delete t.properties.showOnlyTimestamp,Us$3(t))}function Bs$3(t,i){const e=t.geometry.properties;e.oldElementsBeforeHighlight||(e.oldElementsBeforeHighlight=t.geometry.elements),e.elements&&(e.oldElementsArrBeforeHighlight||(e.oldElementsArrBeforeHighlight=e.elements),e.elements=i)}function Us$3(t){const i=t.geometry.properties.oldElementsBeforeHighlight;i&&t.geometry.elements!==i&&(t.geometry.deleteElements(),t.geometry.setElements(t.geometry.properties.oldElementsBeforeHighlight),t.geometry.properties.oldElementsArrBeforeHighlight&&(t.geometry.properties.elements=t.geometry.properties.oldElementsArrBeforeHighlight,delete t.geometry.properties.oldElementsArrBeforeHighlight),delete t.geometry.properties.hasInvisible,delete t.geometry.properties.oldElementsBeforeHighlight)}function zs$3(t){if(!t.properties.highlightTimestamp)return;const i=t.defines;delete i.HAS_HIGHLIGHT_COLOR,delete i.HAS_HIGHLIGHT_OPACITY,t.setDefines(i),delete t.properties.highlightTimestamp,Us$3(t),Vs$3(t)}function Vs$3(t){if(!t)return;const{hlBloomMesh:i}=t.properties;if(i){const e=i.geometry;e.elements&&e.elements.destroy&&e.deleteElements(),i.dispose(),delete t.properties.hlBloomMesh}}var Ws$3=Object.freeze({__proto__:null,clearShowOnly:js$2,showOnly:function(t,i,e,s,n){const{showOnlyTimestamp:r}=i.properties;if(!e)return void(r&&js$2(i));if(s===r)return;i.properties.showOnlyTimestamp=s;const h=e.keys(),o=[];for(const t of h){if(!n.has(t))continue;const i=n.get(t);i&&pt$5(o,i)}Bs$3(i,o),i.geometry.elements!==i.geometry.properties.oldElementsBeforeHighlight&&i.geometry.elements.destroy&&i.geometry.deleteElements();const a={data:o,primitive:i.geometry.getPrimitive()};i.geometry.setElements(t.elements(a)),i.geometry.generateBuffers(t)},clearHighlight:zs$3,highlightMesh:function(t,i,e,s,n){const{highlightTimestamp:r}=i.properties;if(!e)return void(r&&zs$3(i));if(s===r)return;const h=i.geometry.getVertexCount();let{aHighlightColor:o,aHighlightOpacity:l}=i.geometry.properties;o&&o.fill(0),l&&l.fill(255);let c=!1,u=!1;const f=e.keys();let p=null,m=null;for(const t of f)if(n.has(t)){const i=e.get(t),{color:s,bloom:r,visible:a}=i;let f,{opacity:g}=i;if(s&&(c||(o||(o=new Uint8Array(4*h)),c=!0),f=vt$5(Gs$3,s)),g=lt$5(g)?1:g,g<1&&(u||(l||(l=new Uint8Array(h),l.fill(255)),u=!0)),!1===a&&(m||(m=new Set),m.add(t)),f||g<1||r){const i=n.get(t);if(i)for(let t=0;t<i.length;t++){const e=i[t];f&&set$3(o.subarray(4*e,4*e+4),...f),g<1&&(l[e]=255*g),r&&(p||(p=[]),p.push(e))}}}const v=i.defines;if(c?(i.geometry.data.aHighlightColor?i.geometry.updateData("aHighlightColor",o):(i.geometry.data.aHighlightColor=o,i.geometry.generateBuffers(t)),i.geometry.properties.aHighlightColor=o,v.HAS_HIGHLIGHT_COLOR=1):v.HAS_HIGHLIGHT_COLOR&&(i.geometry.updateData("aHighlightColor",o),delete v.HAS_HIGHLIGHT_COLOR),u?(i.geometry.data.aHighlightOpacity?i.geometry.updateData("aHighlightOpacity",l):(i.geometry.data.aHighlightOpacity=l,i.geometry.generateBuffers(t)),i.geometry.properties.aHighlightOpacity=l,v.HAS_HIGHLIGHT_OPACITY=1):v.HAS_HIGHLIGHT_OPACITY&&(i.geometry.updateData("aHighlightOpacity",l),delete v.HAS_HIGHLIGHT_OPACITY),m&&m.size>0){let e=[];n.forEach(((t,i)=>{m.has(i)||pt$5(e,t)})),i.geometry.properties.hasInvisible=!0,Bs$3(i,e);const s={data:e,primitive:i.geometry.getPrimitive()};i.geometry.elements!==i.geometry.properties.oldElementsBeforeHighlight&&i.geometry.elements.destroy&&i.geometry.deleteElements(),e=t.elements(s),i.geometry.setElements(e),i.geometry.generateBuffers(t)}else i.geometry.properties.hasInvisible&&Us$3(i);i.setDefines(v),i.properties.highlightTimestamp=s;let w=i.properties.hlBloomMesh;if(p&&p.length){if(w){const t=copy$5(w.localTransform,i.localTransform),e=copy$5(w.positionMatrix,i.positionMatrix);w.setLocalTransform(t),w.setPositionMatrix(e),i.properties.hlBloomMesh.geometry.setElements(p)}else{const e=new Q$7(i.geometry.data,p,0,i.geometry.desc);e.generateBuffers(t);w=new Be$5(e,i.material,i.config);const n=i.uniforms;for(const t in n)Object.defineProperty(w.uniforms,t,{enumerable:!0,get:function(){return i.getUniform(t)}});const r=at$5({},i.defines);r.HAS_BLOOM=1;const h=copy$5([],i.localTransform),o=copy$5([],i.positionMatrix);w.setLocalTransform(h),w.setPositionMatrix(o),at$5(w.properties,i.properties),at$5(e.properties,i.geometry.properties),w.setDefines(r),w.bloom=1}i.properties.hlBloomMesh=w}else w&&Vs$3(i)},deleteHighlightBloomMesh:Vs$3});const qs$2=[0,0,0,0];class $s$2{constructor(t,i,e,s,n,r){this.renderer=new B$6(t),this.sceneConfig=i,this.s=e,this.Pn=s,this.Dn=n,this.ln=r||{factor:0,units:0},this.h(),this.Hn=[]}render(t,i,e){this.Nn();const s=this.s.getMap();this.renderer.regl.clear({color:qs$2,depth:1,stencil:255,framebuffer:this.Gn}),this.renderer.render(this.jn,i,t,this.Gn);const n=this.s.getRenderer().canvas;this.Hn[0]=n.width,this.Hn[1]=n.height;const r=at$5({colorRamp:this.Bn,inputTexture:this.Gn,projViewMatrix:s.projViewMatrix,textureOutputSize:this.Hn},i);return this.m(),this.renderer.render(this.Un,r,this.D,e)}dispose(){this.jn&&(this.jn.dispose(),delete this.jn),this.Un&&(this.Un.dispose(),delete this.Un),this.S&&(this.S.geometry.dispose(),this.S.dispose(),delete this.S,delete this.D),this.Gn&&(this.Gn.destroy(),delete this.Gn)}zn(){const t=this.Pn;let i=this.Vn,e=this.Wn;e?e.clearRect(0,0,256,1):(i=this.Vn=document.createElement("canvas"),i.width=256,i.height=1,e=this.Wn=i.getContext("2d"));const s=e.createLinearGradient(0,0,256,1);for(let i=0;i<t.length;i++)s.addColorStop(t[i][0],t[i][1]);e.fillStyle=s,e.fillRect(0,0,256,1),this.Bn&&this.Bn.destroy();this.Bn=this.renderer.regl.texture({width:256,height:1,data:i,min:"linear",mag:"linear",premultiplyAlpha:!0})}Nn(){const t=this.s.getRenderer().canvas,i=Math.ceil(t.width/4),e=Math.ceil(t.height/4),s=this.Gn;s.width===i&&s.height===e||s.resize(i,e)}h(){this.zn(),this.qn(),this.$n(),this.p()}p(){const t=new tn$5;t.generateBuffers(this.renderer.regl),this.S=new Be$5(t),this.D=new Ke$5([this.S])}m(){const t=this.s.getMap(),i=jt$4.getGroundTransform(this.S.localTransform,t);this.S.setLocalTransform(i)}$n(){const t=this.s.getRenderer().canvas,i=this.renderer.regl,e=i.hasExtension("OES_texture_half_float")?"half float":"float",s=Math.ceil(t.width/4),n=Math.ceil(t.height/4),r=i.texture({width:s,height:n,type:e,min:"linear",mag:"linear",format:"rgba"});this.Gn=i.framebuffer({width:s,height:n,color:[r]})}qn(){const t=this.s.getRenderer().canvas,i=this.sceneConfig.depthRange,e={viewport:{x:0,y:0,width:()=>t?Math.ceil(t.width/4):1,height:()=>t?Math.ceil(t.height/4):1},depth:{enable:!0,func:"always"}};this.Dn&&(e.stencil=this.Dn),this.jn=new Xn$4({extraCommandProps:e}),this.Un=new Yn$4({x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},{extraCommandProps:{stencil:{enable:!1},depth:{enable:!0,range:i||[0,1],func:"<="},polygonOffset:{enable:!0,offset:this.ln},scissor:{enable:!1}}})}}class Ys$3 extends rs$4{constructor(t,i){super(t,i)}ze(t){const i=this.js(t),e=new Be$5(i);return this.Yn(e),this.qs(e),e}Gs(t,i,e){const s=this.zs();t.setUniform("maskMode",s);const n=this.Vs();if(t.setUniform("maskColor",n),ct$5(i)){const s=this.Ks();s[0]=(s[0]-e)*i,s[1]=(s[1]-e)*i,t.setUniform("heightRange",s)}}setHeightRange(t){this.options.heightRange=t,this._fireEvent("heightrangechange")}getHeightRange(){return this.options.heightRange}Ks(){const t=[0,0];return this.options.heightRange&&(t[0]=this.Ws(this.options.heightRange[0]),t[1]=this.Ws(this.options.heightRange[1])),t}Yn(t){const i=t.getDefines();i.HAS_MASK_COLOR=1,t.setDefines(i)}}class Xs$3 extends Ys$3{constructor(t,i){super(t,i),this.Hs="clip-inside"}}class Js$3 extends Ys$3{constructor(t,i){super(t,i),this.Hs="clip-outside"}}class Zs$3 extends rs$4{constructor(t,i){super(t,i)}setFlatheight(t){this.options.flatHeight=t,this._fireEvent("flatheightchange")}ze(t){const i=this.js(t),e=new Be$5(i);return this.Yn(e),this.qs(e),e}Gs(t){const i=this.zs();t.setUniform("maskMode",i);const e=this.Vs();t.setUniform("maskColor",e);const s=this.Ws(this.options.flatHeight||0);t.setUniform("flatHeight",s)}Yn(t){const i=t.getDefines();i.HAS_MASK_FLAT=1,t.setDefines(i)}Ks(){const t=[0,this.options.flatHeight];return t[1]=this.Ws(t[1]),t}}class Ks$3 extends Zs$3{constructor(t,i){super(t,i),this.Hs="flat-inside"}}class Qs$3 extends Zs$3{constructor(t,i){super(t,i),this.Hs="flat-outside"}}class tn$4 extends rs$4{constructor(t,i){super(t,i),this.Hs="color"}setHeightRange(t){this.options.heightRange=t,this._fireEvent("heightrangechange")}ze(t){const i=this.js(t),e=new Be$5(i);return this.Yn(e),this.qs(e),e}Gs(t,i,e){const s=this.zs();t.setUniform("maskMode",s);const n=this.Vs();if(t.setUniform("maskColor",n),ct$5(i)){const s=this.Ks();s[0]=(s[0]-e)*i,s[1]=(s[1]-e)*i,t.setUniform("heightRange",s)}}Yn(t){const i=t.getDefines();i.HAS_MASK_COLOR=1,t.setDefines(i)}Ks(){const t=[0,0];return this.options.heightRange&&(t[0]=this.Ws(this.options.heightRange[0]),t[1]=this.Ws(this.options.heightRange[1])),t}}class en$4 extends rs$4{constructor(t,i){super(t,i),this.Hs="video"}play(){this.Xn&&this.Xn.play()}pause(){this.Xn&&this.Xn.pause()}setAudio(t){this.Xn&&(this.video.muted=t)}setUrl(t){this.options.url=t,this.Jn(t)}getState(){return this.Zn}ze(t){const i=this.js(t),e=new Be$5(i),s=this.Kn(t);return e.material=new Ce$5({maskTexture:s}),this.Yn(e),this.qs(e),e}Gs(t){const i=this.zs();t.setUniform("maskMode",i);const e=this.Vs();t.setUniform("maskColor",e)}Yn(t){const i=t.getDefines();i.HAS_VIDEO=1,t.setDefines(i)}Kn(t){return this.Jn(),t.texture()}Jn(){this.Zn="stop";const t=this.options.url;let e=document.getElementById(this.options.elementId);if(t&&(e=document.createElement("video"),e.src=t),!e)throw new Error("there is no element or url setting for video mask");e.autoplay=this.options.autoplay||!0,e.loop=this.options.loop||!0,e.muted=this.options.muted||!0,e.play(),e.addEventListener("playing",(()=>{this.Zn="playing"})),e.addEventListener("pause",(()=>{this.Zn="pause"})),this.Xn=e}je(){const t=this._t;if(t&&t.material){const i=t.material.get("maskTexture");i&&this.Xn&&this.Be()&&i(this.Xn)}}Be(){return"playing"===this.Zn}}class sn$4 extends Zs$3{constructor(t,i){super(t,i),this.setElevation(i.elevation),this.Hs="elevate"}setElevation(t){this.options.elevation=t,this.setFlatheight(this.options.elevation)}}const nn$4=new t$1.Point(0,0),rn$4=new t$1.Point(0,0),hn$4=new t$1.Point(0,0),on$4=new t$1.Point(0,0);class an$4 extends Ys$3{constructor(t,i){super([],i),this.Qn=t}setPosition(t){this.Qn=t,this.Xs()}getPosition(){return this.Qn}setWidth(t){this.options.width=t,this.Xs()}setLength(t){this.options.length=t,this.Xs()}setHeight(t){this.options.height=t,this.Xs()}setRotation(t){this.options.rotation=t,this.Xs()}Xs(){const t=this.getLayer();if(!t)return;const i=t.getMap();if(i){const{length:t,width:e,height:s}=this.options,n=this.Qn,r=this.options.rotation||0,{coordinates:h,heightRange:o}=this.tr(i,n,t,e,s,r);this.setCoordinates(h),this.setHeightRange(o)}}tr(t,i,e,s,n,r){const h=t.getGLRes(),o=t.distanceToPointAtRes(s/2,0,h,nn$4),a=t.distanceToPointAtRes(0,e/2,h,rn$4),l=t.coordinateToPointAtRes(i,h,hn$4),c=l.x-o.x,u=l.x+o.x,f=l.y+a.y,d=l.y-a.y,p=this.ir([[c,f],[u,f],[u,d],[c,d]],l,r);on$4.set(p[0][0],p[0][1]);const g=t.pointAtResToCoordinate(on$4,h);on$4.set(p[1][0],p[1][1]);const m=t.pointAtResToCoordinate(on$4,h);on$4.set(p[2][0],p[2][1]);const v=t.pointAtResToCoordinate(on$4,h);on$4.set(p[3][0],p[3][1]);const w=t.pointAtResToCoordinate(on$4,h),x=i.z-n/2;return{coordinates:[[g.x,g.y,x],[m.x,m.y,x],[v.x,v.y,x],[w.x,w.y,x],[g.x,g.y,x]],heightRange:[x,i.z+n/2]}}ir(t,i,e){for(let s=0;s<t.length;s++)rotate(t[s],t[s],[i.x,i.y],e*Math.PI/180);return t}}class ln$4 extends an$4{constructor(t,i){super(t,i),this.Hs="clip-inside"}}class cn$4 extends an$4{constructor(t,i){super(t,i),this.Hs="clip-outside"}}"undefined"!=typeof window&&window.maptalks&&(window.maptalks.GroupGLLayer=Cs$3,window.maptalks.ClipInsideMask=Xs$3,window.maptalks.ClipOutsideMask=Js$3,window.maptalks.FlatInsideMask=Ks$3,window.maptalks.FlatOutsideMask=Qs$3,window.maptalks.ElevateMask=sn$4,window.maptalks.ColorMask=tn$4,window.maptalks.VideoMask=en$4,window.maptalks.BoxInsideClipMask=ln$4,window.maptalks.BoxOutsideClipMask=cn$4);const getGlobal=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},globals=getGlobal(),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};transcoders.inject=function(chunk){const fnString=chunk.toString(),prefixIndex=fnString.indexOf("{")+1,prefix=fnString.substring(0,prefixIndex),transcoders=globals.gl_trans__coders=globals.gl_trans__coders||{};let injected=`${prefix}\n    const _____getGlobal = ${getGlobal.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const p in transcoders)"inject"!==p&&"getTranscoder"!==p&&"registerTranscoder"!==p&&(injected+='tran_____scoders["'+p+'"] ='+transcoders[p].toString()+"\n;");return injected+="\n"+fnString.substring(prefix.length),injected},transcoders.registerTranscoder=function(name,fn){transcoders[name]=fn},transcoders.getTranscoder=function(name){return transcoders[name]};let canvas;t__namespace.registerWorkerAdapter("@maptalks/terrain",'function(t){var r="undefined"!=typeof Float32Array?Float32Array:Array;function e(){var t=new r(3);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function i(t,e,i){var n=new r(3);return n[0]=t,n[1]=e,n[2]=i,n}function n(t,r){var e=r[0],i=r[1],n=r[2],s=e*e+i*i+n*n;return s>0&&(s=1/Math.sqrt(s),t[0]=r[0]*s,t[1]=r[1]*s,t[2]=r[2]*s),t}function s(t,r,e){var i=r[0],n=r[1],s=r[2],a=e[0],o=e[1],h=e[2];return t[0]=n*h-s*o,t[1]=s*a-i*h,t[2]=i*o-n*a,t}var a=function(t,r,e){return t[0]=r[0]-e[0],t[1]=r[1]-e[1],t[2]=r[2]-e[2],t};function o(){var t=new r(4);return r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}e(),function(){var t,e=(t=new r(4),r!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var h;function c(t,r,e){return t[0]=r,t[1]=e,t}e(),i(1,0,0),i(0,1,0),o(),o(),h=new r(9),r!=Float32Array&&(h[1]=0,h[2]=0,h[3]=0,h[5]=0,h[6]=0,h[7]=0),h[0]=1,h[4]=1,h[8]=1,function(){var t=function(){var t=new r(2);return r!=Float32Array&&(t[0]=0,t[1]=0),t}()}();\n/*!\n   * @maptalks/gltf-loader v0.95.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.org\n   */\nlet f=0;!function(t){t[0]=0,t[1]=0,t[2]=0,t[3]=1}([]),"undefined"!=typeof TextDecoder&&new TextDecoder("utf-8");const u={get:function(t,r={}){r||(r={});const e=new AbortController,i=e.signal,n=function(t){for(let r=1;r<arguments.length;r++){const e=arguments[r];for(const r in e)t[r]=e[r]}return t}({},r);n.signal=i,n.method||(n.method="GET");const s=fetch(t,n).then(t=>{const e=this.U(t,r.responseType);return e.message?e:e.then(e=>"arraybuffer"===r.responseType?{data:e,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:e).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t})}).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t});return s.xhr=e,s},U:(t,r)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===r?t.arrayBuffer():"json"===r?t.json():t.text(),getArrayBuffer:(t,r={})=>(r||(r={}),r.responseType="arraybuffer",u.get(t,r)),getJSON:function(t,r={}){return r&&r.jsonp?u.jsonp(t):((r=r||{}).responseType="json",u.get(t,r))},jsonp:function(t){const r="_maptalks_jsonp_"+f++;t.match(/\\?/)?t+="&callback="+r:t+="?callback="+r;let e=document.createElement("script");return e.type="text/javascript",e.src=t,new Promise(t=>{window[r]=function(i){document.getElementsByTagName("head")[0].removeChild(e),e=null,delete window[r],t(i)},document.getElementsByTagName("head")[0].appendChild(e)})}};if("undefined"!=typeof TextDecoder&&new TextDecoder("utf-8"),"undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(t){}}"undefined"!=typeof document&&document.createElement("canvas"),function(){function t(t){throw t}var r=void 0,e=!0,i=this;function n(t,e){var n,s=t.split("."),a=i;!(s[0]in a)&&a.execScript&&a.execScript("var "+s[0]);for(;s.length&&(n=s.shift());)s.length||e===r?a=a[n]?a[n]:a[n]={}:a[n]=e}var s="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array&&"undefined"!=typeof DataView;function a(r,e){this.index="number"==typeof e?e:0,this.i=0,this.buffer=r instanceof(s?Uint8Array:Array)?r:new(s?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}a.prototype.f=function(){var t,r=this.buffer,e=r.length,i=new(s?Uint8Array:Array)(e<<1);if(s)i.set(r);else for(t=0;t<e;++t)i[t]=r[t];return this.buffer=i},a.prototype.d=function(t,r,e){var i,n=this.buffer,s=this.index,a=this.i,o=n[s];if(e&&1<r&&(t=8<r?(l[255&t]<<24|l[t>>>8&255]<<16|l[t>>>16&255]<<8|l[t>>>24&255])>>32-r:l[t]>>8-r),8>r+a)o=o<<r|t,a+=r;else for(i=0;i<r;++i)o=o<<1|t>>r-i-1&1,8==++a&&(a=0,n[s++]=l[o],o=0,s===n.length&&(n=this.f()));n[s]=o,this.buffer=n,this.i=a,this.index=s},a.prototype.finish=function(){var t,r=this.buffer,e=this.index;return 0<this.i&&(r[e]<<=8-this.i,r[e]=l[r[e]],e++),s?t=r.subarray(0,e):(r.length=e,t=r),t};var o,h=new(s?Uint8Array:Array)(256);for(o=0;256>o;++o){for(var c=u=o,f=7,u=u>>>1;u;u>>>=1)c<<=1,c|=1&u,--f;h[o]=(c<<f&255)>>>0}var l=h;function y(t){this.buffer=new(s?Uint16Array:Array)(2*t),this.length=0}function d(t){var r,e,i,n,a,o,h,c,f,u,l=t.length,y=0,d=Number.POSITIVE_INFINITY;for(c=0;c<l;++c)t[c]>y&&(y=t[c]),t[c]<d&&(d=t[c]);for(r=1<<y,e=new(s?Uint32Array:Array)(r),i=1,n=0,a=2;i<=y;){for(c=0;c<l;++c)if(t[c]===i){for(o=0,h=n,f=0;f<i;++f)o=o<<1|1&h,h>>=1;for(u=i<<16|c,f=o;f<r;f+=a)e[f]=u;++n}++i,n<<=1,a<<=1}return[e,y,d]}function A(t,r){this.h=b,this.w=0,this.input=s&&t instanceof Array?new Uint8Array(t):t,this.b=0,r&&(r.lazy&&(this.w=r.lazy),"number"==typeof r.compressionType&&(this.h=r.compressionType),r.outputBuffer&&(this.a=s&&r.outputBuffer instanceof Array?new Uint8Array(r.outputBuffer):r.outputBuffer),"number"==typeof r.outputIndex&&(this.b=r.outputIndex)),this.a||(this.a=new(s?Uint8Array:Array)(32768))}y.prototype.getParent=function(t){return 2*((t-2)/4|0)},y.prototype.push=function(t,r){var e,i,n,s=this.buffer;for(e=this.length,s[this.length++]=r,s[this.length++]=t;0<e&&(i=this.getParent(e),s[e]>s[i]);)n=s[e],s[e]=s[i],s[i]=n,n=s[e+1],s[e+1]=s[i+1],s[i+1]=n,e=i;return this.length},y.prototype.pop=function(){var t,r,e,i,n,s=this.buffer;for(r=s[0],t=s[1],this.length-=2,s[0]=s[this.length],s[1]=s[this.length+1],n=0;!((i=2*n+2)>=this.length)&&(i+2<this.length&&s[i+2]>s[i]&&(i+=2),s[i]>s[n]);)e=s[n],s[n]=s[i],s[i]=e,e=s[n+1],s[n+1]=s[i+1],s[i+1]=e,n=i;return{index:t,value:r,length:this.length}};var w,b=2,p={NONE:0,r:1,k:b,N:3},v=[];for(w=0;288>w;w++)switch(!0){case 143>=w:v.push([w+48,8]);break;case 255>=w:v.push([w-144+400,9]);break;case 279>=w:v.push([w-256+0,7]);break;case 287>=w:v.push([w-280+192,8]);break;default:t("invalid literal: "+w)}function k(t,r){this.length=t,this.G=r}A.prototype.j=function(){var i,n,o,h,c=this.input;switch(this.h){case 0:for(o=0,h=c.length;o<h;){var f,u,l,y=n=s?c.subarray(o,o+65535):c.slice(o,o+65535),d=(o+=n.length)===h,A=r,w=r,p=this.a,k=this.b;if(s){for(p=new Uint8Array(this.a.buffer);p.length<=k+y.length+5;)p=new Uint8Array(p.length<<1);p.set(this.a)}if(f=d?1:0,p[k++]=0|f,l=65536+~(u=y.length)&65535,p[k++]=255&u,p[k++]=u>>>8&255,p[k++]=255&l,p[k++]=l>>>8&255,s)p.set(y,k),k+=y.length,p=p.subarray(0,k);else{for(A=0,w=y.length;A<w;++A)p[k++]=y[A];p.length=k}this.b=k,this.a=p}break;case 1:var m=new a(s?new Uint8Array(this.a.buffer):this.a,this.b);m.d(1,1,e),m.d(1,2,e);var U,x,M,S=g(this,c);for(U=0,x=S.length;U<x;U++)if(M=S[U],a.prototype.d.apply(m,v[M]),256<M)m.d(S[++U],S[++U],e),m.d(S[++U],5),m.d(S[++U],S[++U],e);else if(256===M)break;this.a=m.finish(),this.b=this.a.length;break;case b:var I,F,D,z,C,N,O,j,q,W,Z,V,$,_,B,H=new a(s?new Uint8Array(this.a.buffer):this.a,this.b),L=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],P=Array(19);for(I=b,H.d(1,1,e),H.d(I,2,e),F=g(this,c),O=T(N=E(this.L,15)),q=T(j=E(this.K,7)),D=286;257<D&&0===N[D-1];D--);for(z=30;1<z&&0===j[z-1];z--);var G,R,Y,J,K,X,Q=D,tt=z,rt=new(s?Uint32Array:Array)(Q+tt),et=new(s?Uint32Array:Array)(316),it=new(s?Uint8Array:Array)(19);for(G=R=0;G<Q;G++)rt[R++]=N[G];for(G=0;G<tt;G++)rt[R++]=j[G];if(!s)for(G=0,J=it.length;G<J;++G)it[G]=0;for(G=K=0,J=rt.length;G<J;G+=R){for(R=1;G+R<J&&rt[G+R]===rt[G];++R);if(Y=R,0===rt[G])if(3>Y)for(;0<Y--;)et[K++]=0,it[0]++;else for(;0<Y;)(X=138>Y?Y:138)>Y-3&&X<Y&&(X=Y-3),10>=X?(et[K++]=17,et[K++]=X-3,it[17]++):(et[K++]=18,et[K++]=X-11,it[18]++),Y-=X;else if(et[K++]=rt[G],it[rt[G]]++,3>--Y)for(;0<Y--;)et[K++]=rt[G],it[rt[G]]++;else for(;0<Y;)(X=6>Y?Y:6)>Y-3&&X<Y&&(X=Y-3),et[K++]=16,et[K++]=X-3,it[16]++,Y-=X}for(i=s?et.subarray(0,K):et.slice(0,K),W=E(it,7),_=0;19>_;_++)P[_]=W[L[_]];for(C=19;4<C&&0===P[C-1];C--);for(Z=T(W),H.d(D-257,5,e),H.d(z-1,5,e),H.d(C-4,4,e),_=0;_<C;_++)H.d(P[_],3,e);for(_=0,B=i.length;_<B;_++)if(V=i[_],H.d(Z[V],W[V],e),16<=V){switch(_++,V){case 16:$=2;break;case 17:$=3;break;case 18:$=7;break;default:t("invalid code: "+V)}H.d(i[_],$,e)}var nt,st,at,ot,ht,ct,ft,ut,lt=[O,N],yt=[q,j];for(ht=lt[0],ct=lt[1],ft=yt[0],ut=yt[1],nt=0,st=F.length;nt<st;++nt)if(at=F[nt],H.d(ht[at],ct[at],e),256<at)H.d(F[++nt],F[++nt],e),ot=F[++nt],H.d(ft[ot],ut[ot],e),H.d(F[++nt],F[++nt],e);else if(256===at)break;this.a=H.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var m=function(){function r(r){switch(!0){case 3===r:return[257,r-3,0];case 4===r:return[258,r-4,0];case 5===r:return[259,r-5,0];case 6===r:return[260,r-6,0];case 7===r:return[261,r-7,0];case 8===r:return[262,r-8,0];case 9===r:return[263,r-9,0];case 10===r:return[264,r-10,0];case 12>=r:return[265,r-11,1];case 14>=r:return[266,r-13,1];case 16>=r:return[267,r-15,1];case 18>=r:return[268,r-17,1];case 22>=r:return[269,r-19,2];case 26>=r:return[270,r-23,2];case 30>=r:return[271,r-27,2];case 34>=r:return[272,r-31,2];case 42>=r:return[273,r-35,3];case 50>=r:return[274,r-43,3];case 58>=r:return[275,r-51,3];case 66>=r:return[276,r-59,3];case 82>=r:return[277,r-67,4];case 98>=r:return[278,r-83,4];case 114>=r:return[279,r-99,4];case 130>=r:return[280,r-115,4];case 162>=r:return[281,r-131,5];case 194>=r:return[282,r-163,5];case 226>=r:return[283,r-195,5];case 257>=r:return[284,r-227,5];case 258===r:return[285,r-258,0];default:t("invalid length: "+r)}}var e,i,n=[];for(e=3;258>=e;e++)i=r(e),n[e]=i[2]<<24|i[1]<<16|i[0];return n}(),U=s?new Uint32Array(m):m;function g(e,i){function n(r,e){var i,n,s,a,o=r.G,h=[],c=0;switch(i=U[r.length],h[c++]=65535&i,h[c++]=i>>16&255,h[c++]=i>>24,!0){case 1===o:n=[0,o-1,0];break;case 2===o:n=[1,o-2,0];break;case 3===o:n=[2,o-3,0];break;case 4===o:n=[3,o-4,0];break;case 6>=o:n=[4,o-5,1];break;case 8>=o:n=[5,o-7,1];break;case 12>=o:n=[6,o-9,2];break;case 16>=o:n=[7,o-13,2];break;case 24>=o:n=[8,o-17,3];break;case 32>=o:n=[9,o-25,3];break;case 48>=o:n=[10,o-33,4];break;case 64>=o:n=[11,o-49,4];break;case 96>=o:n=[12,o-65,5];break;case 128>=o:n=[13,o-97,5];break;case 192>=o:n=[14,o-129,6];break;case 256>=o:n=[15,o-193,6];break;case 384>=o:n=[16,o-257,7];break;case 512>=o:n=[17,o-385,7];break;case 768>=o:n=[18,o-513,8];break;case 1024>=o:n=[19,o-769,8];break;case 1536>=o:n=[20,o-1025,9];break;case 2048>=o:n=[21,o-1537,9];break;case 3072>=o:n=[22,o-2049,10];break;case 4096>=o:n=[23,o-3073,10];break;case 6144>=o:n=[24,o-4097,11];break;case 8192>=o:n=[25,o-6145,11];break;case 12288>=o:n=[26,o-8193,12];break;case 16384>=o:n=[27,o-12289,12];break;case 24576>=o:n=[28,o-16385,13];break;case 32768>=o:n=[29,o-24577,13];break;default:t("invalid distance")}for(i=n,h[c++]=i[0],h[c++]=i[1],h[c++]=i[2],s=0,a=h.length;s<a;++s)w[b++]=h[s];v[h[0]]++,k[h[3]]++,p=r.length+e-1,y=null}var a,o,h,c,f,u,l,y,d,A={},w=s?new Uint16Array(2*i.length):[],b=0,p=0,v=new(s?Uint32Array:Array)(286),k=new(s?Uint32Array:Array)(30),m=e.w;if(!s){for(h=0;285>=h;)v[h++]=0;for(h=0;29>=h;)k[h++]=0}for(v[256]=1,a=0,o=i.length;a<o;++a){for(h=f=0,c=3;h<c&&a+h!==o;++h)f=f<<8|i[a+h];if(A[f]===r&&(A[f]=[]),u=A[f],!(0<p--)){for(;0<u.length&&32768<a-u[0];)u.shift();if(a+3>=o){for(y&&n(y,-1),h=0,c=o-a;h<c;++h)d=i[a+h],w[b++]=d,++v[d];break}0<u.length?(l=x(i,a,u),y?y.length<l.length?(d=i[a-1],w[b++]=d,++v[d],n(l,0)):n(y,-1):l.length<m?y=l:n(l,0)):y?n(y,-1):(d=i[a],w[b++]=d,++v[d])}u.push(a)}return w[b++]=256,v[256]++,e.L=v,e.K=k,s?w.subarray(0,b):w}function x(t,r,e){var i,n,s,a,o,h,c=0,f=t.length;a=0,h=e.length;t:for(;a<h;a++){if(i=e[h-a-1],s=3,3<c){for(o=c;3<o;o--)if(t[i+o-1]!==t[r+o-1])continue t;s=c}for(;258>s&&r+s<f&&t[i+s]===t[r+s];)++s;if(s>c&&(n=i,c=s),258===s)break}return new k(c,r-n)}function E(t,r){var e,i,n,a,o,h=t.length,c=new y(572),f=new(s?Uint8Array:Array)(h);if(!s)for(a=0;a<h;a++)f[a]=0;for(a=0;a<h;++a)0<t[a]&&c.push(a,t[a]);if(e=Array(c.length/2),i=new(s?Uint32Array:Array)(c.length/2),1===e.length)return f[c.pop().index]=1,f;for(a=0,o=c.length/2;a<o;++a)e[a]=c.pop(),i[a]=e[a].value;for(n=function(t,r,e){function i(t){var e=d[t][A[t]];e===r?(i(t+1),i(t+1)):--l[e],++A[t]}var n,a,o,h,c,f=new(s?Uint16Array:Array)(e),u=new(s?Uint8Array:Array)(e),l=new(s?Uint8Array:Array)(r),y=Array(e),d=Array(e),A=Array(e),w=(1<<e)-r,b=1<<e-1;for(f[e-1]=r,a=0;a<e;++a)w<b?u[a]=0:(u[a]=1,w-=b),w<<=1,f[e-2-a]=(f[e-1-a]/2|0)+r;for(f[0]=u[0],y[0]=Array(f[0]),d[0]=Array(f[0]),a=1;a<e;++a)f[a]>2*f[a-1]+u[a]&&(f[a]=2*f[a-1]+u[a]),y[a]=Array(f[a]),d[a]=Array(f[a]);for(n=0;n<r;++n)l[n]=e;for(o=0;o<f[e-1];++o)y[e-1][o]=t[o],d[e-1][o]=o;for(n=0;n<e;++n)A[n]=0;for(1===u[e-1]&&(--l[0],++A[e-1]),a=e-2;0<=a;--a){for(h=n=0,c=A[a+1],o=0;o<f[a];o++)(h=y[a+1][c]+y[a+1][c+1])>t[n]?(y[a][o]=h,d[a][o]=r,c+=2):(y[a][o]=t[n],d[a][o]=n,++n);A[a]=0,1===u[a]&&i(a)}return l}(i,i.length,r),a=0,o=e.length;a<o;++a)f[e[a].index]=n[a];return f}function T(t){var r,e,i,n,a=new(s?Uint16Array:Array)(t.length),o=[],h=[],c=0;for(r=0,e=t.length;r<e;r++)o[t[r]]=1+(0|o[t[r]]);for(r=1,e=16;r<=e;r++)h[r]=c,c+=0|o[r],c<<=1;for(r=0,e=t.length;r<e;r++)for(c=h[t[r]],h[t[r]]+=1,i=a[r]=0,n=t[r];i<n;i++)a[r]=a[r]<<1|1&c,c>>>=1;return a}function M(r,e){switch(this.l=[],this.m=32768,this.e=this.g=this.c=this.q=0,this.input=s?new Uint8Array(r):r,this.s=!1,this.n=I,this.B=!1,!e&&(e={})||(e.index&&(this.c=e.index),e.bufferSize&&(this.m=e.bufferSize),e.bufferType&&(this.n=e.bufferType),e.resize&&(this.B=e.resize)),this.n){case S:this.b=32768,this.a=new(s?Uint8Array:Array)(32768+this.m+258);break;case I:this.b=0,this.a=new(s?Uint8Array:Array)(this.m),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}var S=0,I=1,F={D:S,C:I};M.prototype.p=function(){for(;!this.s;){var i=Y(this,3);switch(1&i&&(this.s=e),i>>>=1){case 0:var n=this.input,a=this.c,o=this.a,h=this.b,c=n.length,f=r,u=o.length,l=r;switch(this.e=this.g=0,a+1>=c&&t(Error("invalid uncompressed block header: LEN")),f=n[a++]|n[a++]<<8,a+1>=c&&t(Error("invalid uncompressed block header: NLEN")),f===~(n[a++]|n[a++]<<8)&&t(Error("invalid uncompressed block header: length verify")),a+f>n.length&&t(Error("input buffer is broken")),this.n){case S:for(;h+f>o.length;){if(f-=l=u-h,s)o.set(n.subarray(a,a+l),h),h+=l,a+=l;else for(;l--;)o[h++]=n[a++];this.b=h,o=this.f(),h=this.b}break;case I:for(;h+f>o.length;)o=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(s)o.set(n.subarray(a,a+f),h),h+=f,a+=f;else for(;f--;)o[h++]=n[a++];this.c=a,this.b=h,this.a=o;break;case 1:this.o(P,R);break;case 2:var y,A,w,b,p=Y(this,5)+257,v=Y(this,5)+1,k=Y(this,4)+4,m=new(s?Uint8Array:Array)(N.length),U=r,g=r,x=r,E=r,T=r;for(T=0;T<k;++T)m[N[T]]=Y(this,3);if(!s)for(T=k,k=m.length;T<k;++T)m[N[T]]=0;for(y=d(m),U=new(s?Uint8Array:Array)(p+v),T=0,b=p+v;T<b;)switch(g=J(this,y),g){case 16:for(E=3+Y(this,2);E--;)U[T++]=x;break;case 17:for(E=3+Y(this,3);E--;)U[T++]=0;x=0;break;case 18:for(E=11+Y(this,7);E--;)U[T++]=0;x=0;break;default:x=U[T++]=g}A=d(s?U.subarray(0,p):U.slice(0,p)),w=d(s?U.subarray(p):U.slice(p)),this.o(A,w);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var D,z,C=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],N=s?new Uint16Array(C):C,O=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],j=s?new Uint16Array(O):O,q=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],W=s?new Uint8Array(q):q,Z=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],V=s?new Uint16Array(Z):Z,$=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],_=s?new Uint8Array($):$,B=new(s?Uint8Array:Array)(288);for(D=0,z=B.length;D<z;++D)B[D]=143>=D?8:255>=D?9:279>=D?7:8;var H,L,P=d(B),G=new(s?Uint8Array:Array)(30);for(H=0,L=G.length;H<L;++H)G[H]=5;var R=d(G);function Y(r,e){for(var i,n=r.g,s=r.e,a=r.input,o=r.c,h=a.length;s<e;)o>=h&&t(Error("input buffer is broken")),n|=a[o++]<<s,s+=8;return i=n&(1<<e)-1,r.g=n>>>e,r.e=s-e,r.c=o,i}function J(r,e){for(var i,n,s=r.g,a=r.e,o=r.input,h=r.c,c=o.length,f=e[0],u=e[1];a<u&&!(h>=c);)s|=o[h++]<<a,a+=8;return(n=(i=f[s&(1<<u)-1])>>>16)>a&&t(Error("invalid code length: "+n)),r.g=s>>n,r.e=a-n,r.c=h,65535&i}function K(t){if("string"==typeof t){var r,e,i=t.split("");for(r=0,e=i.length;r<e;r++)i[r]=(255&i[r].charCodeAt(0))>>>0;t=i}for(var n,s=1,a=0,o=t.length,h=0;0<o;){o-=n=1024<o?1024:o;do{a+=s+=t[h++]}while(--n);s%=65521,a%=65521}return(a<<16|s)>>>0}function X(r,e){var i,n;switch(this.input=r,this.c=0,!e&&(e={})||(e.index&&(this.c=e.index),e.verify&&(this.M=e.verify)),i=r[this.c++],n=r[this.c++],15&i){case Q:this.method=Q;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+n)%31&&t(Error("invalid fcheck flag:"+((i<<8)+n)%31)),32&n&&t(Error("fdict flag is not supported")),this.A=new M(r,{index:this.c,bufferSize:e.bufferSize,bufferType:e.bufferType,resize:e.resize})}M.prototype.o=function(t,r){var e=this.a,i=this.b;this.u=t;for(var n,s,a,o,h=e.length-258;256!==(n=J(this,t));)if(256>n)i>=h&&(this.b=i,e=this.f(),i=this.b),e[i++]=n;else for(o=j[s=n-257],0<W[s]&&(o+=Y(this,W[s])),n=J(this,r),a=V[n],0<_[n]&&(a+=Y(this,_[n])),i>=h&&(this.b=i,e=this.f(),i=this.b);o--;)e[i]=e[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.I=function(t,r){var e=this.a,i=this.b;this.u=t;for(var n,s,a,o,h=e.length;256!==(n=J(this,t));)if(256>n)i>=h&&(h=(e=this.f()).length),e[i++]=n;else for(o=j[s=n-257],0<W[s]&&(o+=Y(this,W[s])),n=J(this,r),a=V[n],0<_[n]&&(a+=Y(this,_[n])),i+o>h&&(h=(e=this.f()).length);o--;)e[i]=e[i++-a];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.f=function(){var t,r,e=new(s?Uint8Array:Array)(this.b-32768),i=this.b-32768,n=this.a;if(s)e.set(n.subarray(32768,e.length));else for(t=0,r=e.length;t<r;++t)e[t]=n[t+32768];if(this.l.push(e),this.q+=e.length,s)n.set(n.subarray(i,i+32768));else for(t=0;32768>t;++t)n[t]=n[i+t];return this.b=32768,n},M.prototype.J=function(t){var r,e,i,n=this.input.length/this.c+1|0,a=this.input,o=this.a;return t&&("number"==typeof t.v&&(n=t.v),"number"==typeof t.F&&(n+=t.F)),2>n?e=(i=(a.length-this.c)/this.u[2]/2*258|0)<o.length?o.length+i:o.length<<1:e=o.length*n,s?(r=new Uint8Array(e)).set(o):r=o,this.a=r},M.prototype.t=function(){var t,r,e,i,n,a=0,o=this.a,h=this.l,c=new(s?Uint8Array:Array)(this.q+(this.b-32768));if(0===h.length)return s?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(r=0,e=h.length;r<e;++r)for(i=0,n=(t=h[r]).length;i<n;++i)c[a++]=t[i];for(r=32768,e=this.b;r<e;++r)c[a++]=o[r];return this.l=[],this.buffer=c},M.prototype.H=function(){var t,r=this.b;return s?this.B?(t=new Uint8Array(r)).set(this.a.subarray(0,r)):t=this.a.subarray(0,r):(this.a.length>r&&(this.a.length=r),t=this.a),this.buffer=t},X.prototype.p=function(){var r,e=this.input;return r=this.A.p(),this.c=this.A.c,this.M&&((e[this.c++]<<24|e[this.c++]<<16|e[this.c++]<<8|e[this.c++])>>>0!==K(r)&&t(Error("invalid adler-32 checksum"))),r};var Q=8;function tt(t,r){this.input=t,this.a=new(s?Uint8Array:Array)(32768),this.h=rt.k;var e,i={};for(e in!r&&(r={})||"number"!=typeof r.compressionType||(this.h=r.compressionType),r)i[e]=r[e];i.outputBuffer=this.a,this.z=new A(this.input,i)}var rt=p;function et(t,r){var e,i,s,a;if(Object.keys)e=Object.keys(r);else for(i in e=[],s=0,r)e[s++]=i;for(s=0,a=e.length;s<a;++s)n(t+"."+(i=e[s]),r[i])}tt.prototype.j=function(){var r,e,i,n,a,o,h,c=0;switch(h=this.a,r=Q){case Q:e=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=e<<4|r,h[c++]=i,r){case Q:switch(this.h){case rt.NONE:a=0;break;case rt.r:a=1;break;case rt.k:a=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return n=a<<6|0,h[c++]=n|31-(256*i+n)%31,o=K(this.input),this.z.b=c,c=(h=this.z.j()).length,s&&((h=new Uint8Array(h.buffer)).length<=c+4&&(this.a=new Uint8Array(h.length+4),this.a.set(h),h=this.a),h=h.subarray(0,c+4)),h[c++]=o>>24&255,h[c++]=o>>16&255,h[c++]=o>>8&255,h[c++]=255&o,h},n("Zlib.Inflate",X),n("Zlib.Inflate.prototype.decompress",X.prototype.p),et("Zlib.Inflate.BufferType",{ADAPTIVE:F.C,BLOCK:F.D}),n("Zlib.Deflate",tt),n("Zlib.Deflate.compress",(function(t,r){return new tt(t,r).j()})),n("Zlib.Deflate.prototype.compress",tt.prototype.j),et("Zlib.Deflate.CompressionType",{NONE:rt.NONE,FIXED:rt.r,DYNAMIC:rt.k})}.call(self);class l{constructor(t=257){this.gridSize=t;const r=t-1;if(r&r-1)throw new Error(`Expected grid size to be 2^n+1, got ${t}.`);this.numTriangles=r*r*2-2,this.numParentTriangles=this.numTriangles-r*r,this.indices=new Uint32Array(this.gridSize*this.gridSize),this.coords=new Uint16Array(4*this.numTriangles);for(let t=0;t<this.numTriangles;t++){let e=t+2,i=0,n=0,s=0,a=0,o=0,h=0;for(1&e?s=a=o=r:i=n=h=r;(e>>=1)>1;){const t=i+s>>1,r=n+a>>1;1&e?(s=i,a=n,i=o,n=h):(i=s,n=a,s=o,a=h),o=t,h=r}const c=4*t;this.coords[c+0]=i,this.coords[c+1]=n,this.coords[c+2]=s,this.coords[c+3]=a}}createTile(t){return new y(t,this)}}class y{constructor(t,r){const e=r.gridSize;if(t.length!==e*e)throw new Error(`Expected terrain data of length ${e*e} (${e} x ${e}), got ${t.length}.`);this.terrain=t,this.martini=r,this.errors=new Float32Array(t.length),this.update()}update(){const{numTriangles:t,numParentTriangles:r,coords:e,gridSize:i}=this.martini,{terrain:n,errors:s}=this;for(let a=t-1;a>=0;a--){const t=4*a,o=e[t+0],h=e[t+1],c=e[t+2],f=e[t+3],u=o+c>>1,l=h+f>>1,y=u+l-h,d=l+o-u,A=(n[h*i+o]+n[f*i+c])/2,w=l*i+u,b=Math.abs(A-n[w]);if(s[w]=Math.max(s[w],b),a<r){const t=(h+d>>1)*i+(o+y>>1),r=(f+d>>1)*i+(c+y>>1);s[w]=Math.max(s[w],s[t],s[r])}}}getMesh(t=0){const{gridSize:r,indices:e}=this.martini,{errors:i}=this;let n=0,s=0;const a=r-1;function o(a,h,c,f,u,l){const y=a+c>>1,d=h+f>>1;Math.abs(a-u)+Math.abs(h-l)>1&&i[d*r+y]>t?(o(u,l,a,h,y,d),o(c,f,u,l,y,d)):(e[h*r+a]=e[h*r+a]||++n,e[f*r+c]=e[f*r+c]||++n,e[l*r+u]=e[l*r+u]||++n,s++)}e.fill(0),o(0,0,a,a,a,0),o(a,a,0,0,0,a);const h=new Uint16Array(2*n),c=new Uint32Array(3*s);let f=0;function u(n,s,a,o,l,y){const d=n+a>>1,A=s+o>>1;if(Math.abs(n-l)+Math.abs(s-y)>1&&i[A*r+d]>t)u(l,y,n,s,d,A),u(a,o,l,y,d,A);else{const t=e[s*r+n]-1,i=e[o*r+a]-1,u=e[y*r+l]-1;h[2*t]=n,h[2*t+1]=s,h[2*i]=a,h[2*i+1]=o,h[2*u]=l,h[2*u+1]=y,c[f++]=t,c[f++]=i,c[f++]=u}}return u(0,0,a,a,a,0),u(a,a,0,0,0,a),{vertices:h,triangles:c}}getMeshWithSkirts(t=0,r){const{gridSize:e,indices:i}=this.martini,{errors:n}=this;let s=0,a=0;const o=e-1;let h,c,f=0;const u=[],l=[],y=[],d=[];function A(r,w,b,p,v,k){const m=r+b>>1,U=w+p>>1;Math.abs(r-v)+Math.abs(w-k)>1&&n[U*e+m]>t?(A(v,k,r,w,m,U),A(b,p,v,k,m,U)):(h=w*e+r,c=p*e+b,f=k*e+v,0===i[h]&&(0===r?u.push(s):r===o&&l.push(s),0===w?y.push(s):w===o&&d.push(s),i[h]=++s),0===i[c]&&(0===b?u.push(s):b===o&&l.push(s),0===p?y.push(s):p===o&&d.push(s),i[c]=++s),0===i[f]&&(0===v?u.push(s):v===o&&l.push(s),0===k?y.push(s):k===o&&d.push(s),i[f]=++s),a++)}let w;i.fill(0),A(0,0,o,o,o,0),A(o,o,0,0,0,o),w=r?2*(s+3*u.length-2+3*l.length-2+3*y.length-2+3*d.length-2):2*(s+u.length+l.length+y.length+d.length);const b=3*(a+2*(u.length-1)+2*(l.length-1)+2*(y.length-1)+2*(d.length-1)),p=new Uint16Array(w),v=new Uint32Array(b);let k=0;function m(r,s,a,o,h,c){const f=r+a>>1,u=s+o>>1;if(Math.abs(r-h)+Math.abs(s-c)>1&&n[u*e+f]>t)m(h,c,r,s,f,u),m(a,o,h,c,f,u);else{const t=i[s*e+r]-1,n=i[o*e+a]-1,f=i[c*e+h]-1;p[2*t]=r,p[2*t+1]=s,p[2*n]=a,p[2*n+1]=o,p[2*f]=h,p[2*f+1]=c,v[k++]=t,v[k++]=n,v[k++]=f}}m(0,0,o,o,o,0),m(o,o,0,0,0,o),u.sort((t,r)=>p[2*t+1]-p[2*r+1]),l.sort((t,r)=>p[2*r+1]-p[2*t+1]),y.sort((t,r)=>p[2*r]-p[2*t]),d.sort((t,r)=>p[2*t]-p[2*r]);let U,g,x,E,T=2*s,M=0;function S(t){M=t.length;for(let e=0;e<M-1;e++)U=t[e],g=t[e+1],x=T/2,E=(T+(r?6:2))/2,p[T++]=2*U,p[T++]=2*U+1,r&&(p[T++]=2*U,p[T++]=2*U+1,p[T++]=2*g,p[T++]=2*g+1),r?(v[k++]=x+1,v[k++]=x,v[k++]=x+2,v[k++]=x,v[k++]=E,v[k++]=x+2):(v[k++]=U,v[k++]=x,v[k++]=g,v[k++]=x,v[k++]=E,v[k++]=g);p[T++]=2*t[M-1],p[T++]=2*t[M-1]+1}S(u);const I=T;S(l);const F=T;S(y);const D=T;S(d);return{vertices:p,triangles:v,numVerticesWithoutSkirts:s,numTrianglesWithoutSkirts:a,leftSkirtIndex:I,rightSkirtIndex:F,bottomSkirtIndex:D,topSkirtIndex:T}}}const d={};let A,w=null,b=null;const p={},v=64,k=64,m=3,U=-1e3,g=.001,x=256,E=4,T=.002,M={cesium_request_token:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"},tianditu:{"Accept-Encoding":"gzip, deflate, br"},cesium:{"Accept-Encoding":"gzip, deflate, br",Accept:"application/vnd.quantized-mesh,application/octet-stream;q=0.9,*/*;q=0.01"},mapbox:{Accept:"image/webp,*/*"}};M["cesium-ion"]=M.cesium;let S=null,I=null;function F(t,r){const e=function(t){if(t.length<1e3)return null;const r=new Zlib.Inflate(t);return r?r.decompress():null}(new Uint8Array(t));if(!e)throw new Error((i=new Uint8Array(t),D.decode(i)));var i;const n=function(t,r){const e=r,i=r,n=e+1,s=i+1,a=m,o=U,h=g,c=x,f=T,u=new Float32Array(n*s);let l=0,y=1/0,d=-1/0;for(let r=0;r<n;r++){const n=r>=i?i-1:r;for(let r=0;r<s;r++){let i=0;const s=n*(4*e)+4*(r>=e?e-1:r);for(let r=0;r<a;r++)i=i*c+t[s+r];i=1*(i*h+o),i-=f,u[l]=i,i<y&&(y=i),i>d&&(d=i),l++}}return{data:u,min:y,max:d}}(function(t){const r=t,e=v,i=k,n=new Uint8Array(e*i*E);let s,a,o,h,c;for(let t=0;t<i;t++)for(let f=0;f<e;f++){h=parseInt(149*t/(i-1)),c=parseInt(149*f/(e-1)),a=2*(150*h+c),s=r[a]+256*r[a+1],(s>1e4||s<-2e3)&&(s=0),o=4*(t*e+f);const u=(s+1e3)/g,l=x;n[o]=u/(l*l),n[o+1]=(u-n[o]*l*l)/l,n[o+2]=u-n[o]*l*l-n[o+1]*l,n[o+3]=255}return n}(e),r-1);return n.width=n.height=r,n}const D=new TextDecoder("utf-8");function z(t){return t>>1^-(1&t)}const C=[];function N(t){let r=0;const e=3*Float64Array.BYTES_PER_ELEMENT,i=3*Uint16Array.BYTES_PER_ELEMENT;let n=Uint16Array.BYTES_PER_ELEMENT;const s=new DataView(t);r+=e;const a=s.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT;const o=s.getFloat32(r,!0);r+=Float32Array.BYTES_PER_ELEMENT,r+=e;const h=s.getFloat64(r,!0);r+=Float64Array.BYTES_PER_ELEMENT,r+=e;const c=s.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const f=new Uint16Array(t,r,3*c);r+=c*i,c>65536&&(n=Uint32Array.BYTES_PER_ELEMENT);!function(t,r,e){const i=t.length;let n=0,s=0,a=0;for(let o=0;o<i;++o)n+=z(t[o]),s+=z(r[o]),t[o]=n,r[o]=s,e&&(a+=z(e[o]),e[o]=a)}(f.subarray(0,c),f.subarray(c,2*c),f.subarray(2*c,3*c)),r%n!=0&&(r+=n-r%n);const u=s.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const l=c>65536?new Uint32Array(t,r,3*u):new Uint16Array(t,r,3*u);let y=0;const d=l.length;for(let t=0;t<d;++t){const r=l[t];l[t]=y-r,0===r&&++y}const A={minimumHeight:a,maximumHeight:o,quantizedVertices:f,indices:l}.quantizedVertices,w=A.length/3,b=A.subarray(0,w),p=A.subarray(w,2*w),v=A.subarray(2*w,3*w),k=C;for(let t=0;t<w;++t){const r=b[t]/32767,e=p[t]/32767,i=(m=a,U=o,(1-(g=v[t]/32767))*m+g*U);k[3*t]=r,k[3*t+1]=1-e,k[3*t+2]=i}var m,U,g;return{positions:k,radius:h,min:a,max:o,indices:l}}const O=[],j=[],q=[],W=[],Z=[];class V{constructor(t,r,e,i,n){this.p0=[],this.p1=[],this.p2=[],this.normal=[],this.min=[],this.max=[],this.set(t,r,e,i,n)}set(t,r,e,i,o){this.radius=o;let h=3*r,c=3*r+1,f=3*r+2;this.p0[0]=t[h]*o,this.p0[1]=t[c]*o,this.p0[2]=t[f],h=3*e,c=3*e+1,f=3*e+2,this.p1[0]=t[h]*o,this.p1[1]=t[c]*o,this.p1[2]=t[f],h=3*i,c=3*i+1,f=3*i+2,this.p2[0]=t[h]*o,this.p2[1]=t[c]*o,this.p2[2]=t[f],this.min[0]=Math.min(this.p0[0],this.p1[0],this.p2[0]),this.min[1]=Math.min(this.p0[1],this.p1[1],this.p2[1]),this.max[0]=Math.max(this.p0[0],this.p1[0],this.p2[0]),this.max[1]=Math.max(this.p0[1],this.p1[1],this.p2[1]);const u=a(O,this.p1,this.p0),l=a(j,this.p2,this.p1);this.normal=n(this.normal,s(this.normal,u,l))}contains(t,r){if(t<this.min[0]||t>this.max[0]||r<this.min[1]||r>this.max[1])return!1;c(q,this.p0[0],this.p0[1]),c(W,this.p1[0],this.p1[1]),c(Z,this.p2[0],this.p2[1]);const e=H(q[0],q[1],W[0],W[1],Z[0],Z[1]);return H(t,r,q[0],q[1],Z[0],Z[1])+H(t,r,q[0],q[1],W[0],W[1])+H(t,r,W[0],W[1],Z[0],Z[1])-e<=1e-4}getHeight(t,r){const e=this.normal;return this.p0[2]-((t-this.p0[0])*e[0]+(r-this.p0[1])*e[1])/e[2]}}let $=null;function _(t,r,e){if($&&$.contains(r,e))return $.getHeight(r,e);for(let i=0;i<t.length;i++)if(t[i].contains(r,e))return $=t[i],t[i].getHeight(r,e);return 0}const B=[];function H(t,r,e,i,n,s){return.5*Math.abs(t*i+e*s+n*r-t*s-e*r-n*i)}function L(t,r,e,i,n,s){"cesium-ion"===e&&(r.Authorization="Bearer "+S),function(t,r,e){const i={method:"GET",referrer:e,headers:r},n=u.getArrayBuffer(t,i),s=n.xhr;return p[t]=s,n.then(r=>(delete p[t],r))}(t,r,origin).then(t=>{if(!t||t.message)s(t?{empty:!0,originalError:t}:{error:{canceled:!0}});else{const r=t.data;let a=null;if("tianditu"===e){const t=F(r,i);P(n,t,i,null,!0,s)}else if("cesium-ion"===e||"cesium"===e){a=N(r);const t=function(t,r){const{positions:e,min:i,max:n,indices:s,radius:a}=t,o=[];let h=0;for(let t=0;t<s.length;t+=3){let r=B[h];r?r.set(e,s[t],s[t+1],s[t+2],2*a):r=B[h]=new V(e,s[t],s[t+1],s[t+2],2*a),h++,o.push(r)}const c=new Float32Array(r*r);h=0;for(let t=0;t<r;t++)for(let e=0;e<r;e++)c[h++]=_(o,e/r*a*2,t/r*a*2);return{data:c,min:i,max:n,width:r,height:r}}(a,i);P(n,t,i,null,!0,s)}else"mapbox"===e&&(a=function(t){const r=new self.Blob([new Uint8Array(t)]);return self.createImageBitmap(r)}(r),a.then(t=>{const r=function(t,r){const{data:e,width:i}=t;let n=1/0,s=-1/0;const a=new Float32Array(r*r),o=Math.round(i/r);for(let t=0;t<r;t++)for(let h=0;h<r;h++){const c=t+h*r;let f=0,u=0;const l=t,y=h;for(let t=0;t<o;t++)for(let r=0;r<o;r++){let n=l*o+t,s=y*o+r;s>i-1&&(s=i-1),n>i-1&&(n=i-1);const a=n+s*i,h=e[4*a],c=e[4*a+1],d=e[4*a+2];0===e[4*a+3]?u+=1:f+=.1*(256*h*256+256*c+d)-1e4}f/=o*o-u||1,f>s&&(s=f),f<n&&(n=f),a[c]=f}return{data:a,width:r,height:r,min:n,max:s}}(function(t){const{width:r,height:e}=t;w||(w=new OffscreenCanvas(1,1),b=w.getContext("2d",{willReadFrequently:!0}));return w.width=r,w.height=e,b.drawImage(t,0,0,r,e),b.getImageData(0,0,r,e)}(t),i);P(n,r,i,t,!0,s)}))}}).catch(r=>{delete p[t],s({empty:!0,originalError:r})})}function P(t,r,e,i,n,s){const a=function(t,r,e,i){let n=d[e];n||(n=d[e]=new l(e));const s=n.createTile(r),a=i?s.getMeshWithSkirts(t,!0):s.getMesh(t),{triangles:o,vertices:h,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:u,topSkirtIndex:y}=a;let{numVerticesWithoutSkirts:A,numTrianglesWithoutSkirts:w}=a;A||(A=h.legnth/3,w=o.length/3);const b=h.length/2,p=new Float32Array(3*b),v=new Float32Array(2*b);let k=1/0,m=-1/0;const U=e-1;for(let t=0;t<b;t++){const i=h[2*t],n=h[2*t+1];if(t>=A){const r=i/2*3;let e,n=.001;(t-(t<c/2?A:t<f/2?c/2:t<u/2?f/2:u/2))%3==0?(e=0,n=0):e=p[r+2];p[3*t]=p[r],p[3*t+1]=p[r+1],p[3*t+2]=e,v[2*t]=p[r]/U+n,v[2*t+1]=-p[r+1]/U+n}else p[3*t]=1*i,p[3*t+1]=1*-n,p[3*t+2]=r[n*e+i],v[2*t]=i/U,v[2*t+1]=n/U;const s=p[p.length-1];s<k&&(k=s),s>m&&(m=s)}return{positions:p,texcoords:v,triangles:o,leftSkirtIndex:c,rightSkirtIndex:f,bottomSkirtIndex:u,topSkirtIndex:y,numTrianglesWithoutSkirts:w,numVerticesWithoutSkirts:A,minHeight:k,maxHeight:m,terrainWidth:e}}(t,r.data,e,n),o=[a.positions.buffer,a.texcoords.buffer,a.triangles.buffer];i&&o.push(i);const h={mesh:a};h.image=i,h.data=r,o.push(r.data.buffer),s(h,o)}t.initialize=function(){},t.onmessage=function(t,r){const e=t.data;var i;"addLayer"===e.command||"removeLayer"===e.command?(A=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:A,params:"ok",callback:t.callback})):"fetchTerrain"===e.command?function(t,r){const{url:e,origin:i,type:n,accessToken:s,terrainWidth:a,error:o}=t,h=t.headers||M[n];if("tianditu"===n)L(e,h,n,a,o,r);else if("cesium-ion"===n){const c=t.cesiumIonTokenURL+s;S?L(e,h,n,a,o,r):(I||(I=fetch(c,{responseType:"json",method:"GET",referrer:i,headers:{Accept:"application/json,*/*;q=0.01","Accept-Encoding":"gzip, deflate, br"}}).then(t=>t.json()).then(t=>{S=t.accessToken,I=null})),I.then(()=>{L(e,h,n,a,o,r)}))}else("cesium"===n||"mapbox"===n)&&L(e,h,n,a,o,r)}(e.params,(t,e)=>{r(t.error,t,e)}):"abortTerrain"===e.command&&(i=e.params.url,p[i]&&(p[i].abort(),delete p[i]))}}'),"undefined"!=typeof console&&console.log("@maptalks/gl v0.95.6");const OPTIONS={width:100,height:10};function getCanvas(){if(!canvas){const{width,height}=OPTIONS;OffscreenCanvas?canvas=new OffscreenCanvas(width,height):(canvas=document.createElement("canvas"),canvas.width=width,canvas.height=height)}return canvas}class ColorIn{constructor(colors,options={}){if(!Array.isArray(colors))return void console.error("colors is not array");if(colors.length<2)return void console.error("colors.length should >1");this.colors=colors;let min=1/0,max=-1/0;for(let i=0,len=colors.length;i<len;i++){const value=colors[i][0];min=Math.min(value,min),max=Math.max(value,max)}this.min=min,this.max=max,this.valueOffset=this.max-this.min,this.options=Object.assign({},OPTIONS,options),this._initImgData()}getImageData(){return this.imgData}_initImgData(){const canvas=getCanvas(),{width,height}=this.options;canvas.width=width,canvas.height=height;const ctx=canvas.getContext("2d");ctx.clearRect(0,0,canvas.width,canvas.height);const gradient=ctx.createLinearGradient(0,0,canvas.width,0),{colors,valueOffset}=this;for(let i=0,len=colors.length;i<len;i++){const[stop,color]=colors[i];gradient.addColorStop((stop-this.min)/valueOffset,color)}ctx.fillStyle=gradient,ctx.fillRect(0,0,canvas.width,canvas.height),this.imgData=ctx.getImageData(0,0,canvas.width,canvas.height)}getColor(stop){stop=Math.max(this.min,stop),stop=Math.min(stop,this.max);let x=Math.round((stop-this.min)/this.valueOffset*this.imgData.width);x=Math.min(x,this.imgData.width-1);const idx=4*x;return[this.imgData.data[idx],this.imgData.data[idx+1],this.imgData.data[idx+2],this.imgData.data[idx+3]]}}var colorInCache;function createFunction(parameters,defaultType){var fun,isFeatureConstant,isZoomConstant;if(isFunctionDefinition(parameters)){var innerFun,zoomAndFeatureDependent=parameters.stops&&"object"==typeof parameters.stops[0][0],zoomDependent=zoomAndFeatureDependent||!(zoomAndFeatureDependent||void 0!==parameters.property),type=parameters.type||defaultType||"exponential";if("exponential"===type)innerFun=evaluateExponentialFunction;else if("interval"===type)innerFun=evaluateIntervalFunction;else if("categorical"===type)innerFun=evaluateCategoricalFunction;else if("identity"===type)innerFun=evaluateIdentityFunction;else{if("color-interpolate"!==type)throw new Error('Unknown function type "'+type+'"');innerFun=evaluateColorInterpolateFunction}if(zoomAndFeatureDependent){var featureFunctions={},featureFunctionStops=[];for(let s=0;s<parameters.stops.length;s++){var stop=parameters.stops[s];void 0===featureFunctions[stop[0].zoom]&&(featureFunctions[stop[0].zoom]={zoom:stop[0].zoom,type:parameters.type,property:parameters.property,default:parameters.default,stops:[]}),featureFunctions[stop[0].zoom].stops.push([stop[0].value,stop[1]])}for(let z in featureFunctions)featureFunctionStops.push([featureFunctions[z].zoom,createFunction(featureFunctions[z])]);fun=function(zoom,feature){const value=evaluateExponentialFunction({stops:featureFunctionStops,base:parameters.base},zoom)(zoom,feature);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!1}else zoomDependent?(fun=function(zoom){const value=innerFun(parameters,zoom);return"function"==typeof value?value(zoom):value},isFeatureConstant=!0,isZoomConstant=!1):(fun=function(zoom,feature){const value=innerFun(parameters,feature?feature[parameters.property]:null);return"function"==typeof value?value(zoom,feature):value},isFeatureConstant=!1,isZoomConstant=!0)}else fun=function(){return parameters},isFeatureConstant=!0,isZoomConstant=!0;return fun.isZoomConstant=isZoomConstant,fun.isFeatureConstant=isFeatureConstant,fun}function evaluateCategoricalFunction(parameters,input){for(let i=0;i<parameters.stops.length;i++)if(input===parameters.stops[i][0])return parameters.stops[i][1];return parameters.default}function evaluateIntervalFunction(parameters,input){for(var i=0;i<parameters.stops.length&&!(input<parameters.stops[i][0]);i++);return parameters.stops[Math.max(i-1,0)][1]}function evaluateExponentialFunction(parameters,input){for(var base=void 0!==parameters.base?parameters.base:1,i=0;!(i>=parameters.stops.length||input<=parameters.stops[i][0]);)i++;return 0===i?parameters.stops[i][1]:i===parameters.stops.length?parameters.stops[i-1][1]:interpolate(input,base,parameters.stops[i-1][0],parameters.stops[i][0],parameters.stops[i-1][1],parameters.stops[i][1])}"function"==typeof Map&&(colorInCache=new Map);const COLORIN_OPTIONS={width:100,height:1};function evaluateColorInterpolateFunction(parameters,input){const stops=parameters.stops;if(stops&&stops.length>1){let colorIn;if(colorInCache){const key=JSON.stringify(stops);if(!colorInCache.has(key)){const colorIn=new ColorIn(stops,COLORIN_OPTIONS);colorInCache.set(key,colorIn)}colorIn=colorInCache.get(key)}else colorIn=new ColorIn(stops,COLORIN_OPTIONS);const[r,g,b,a]=colorIn.getColor(input);return[r/255,g/255,b/255,a/255]}return stops&&1===stops.length?stops[0][1]:null}function evaluateIdentityFunction(parameters,input){return function(a,b,c){return void 0!==a?a:void 0!==b?b:void 0!==c?c:null}(input,parameters.default)}function interpolate(input,base,inputLower,inputUpper,outputLower,outputUpper){return"function"==typeof outputLower?function(){var evaluatedLower=outputLower.apply(void 0,arguments),evaluatedUpper=outputUpper.apply(void 0,arguments);return interpolate(input,base,inputLower,inputUpper,evaluatedLower,evaluatedUpper)}:outputLower.length?function(input,base,inputLower,inputUpper,outputLower,outputUpper){var output=[];for(let i=0;i<outputLower.length;i++)output[i]=interpolateNumber(input,base,inputLower,inputUpper,outputLower[i],outputUpper[i]);return output}(input,base,inputLower,inputUpper,outputLower,outputUpper):interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper)}function interpolateNumber(input,base,inputLower,inputUpper,outputLower,outputUpper){var ratio,difference=inputUpper-inputLower,progress=input-inputLower;return outputLower*(1-(ratio=1===base?progress/difference:(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)))+outputUpper*ratio}function isFunctionDefinition(obj){return obj&&"object"==typeof obj&&(obj.stops||obj.property&&"identity"===obj.type)}function hasFunctionDefinition(obj){for(const p in obj)if(isFunctionDefinition(obj[p]))return!0;return!1}function interpolated(parameters){return createFunction1(parameters,"exponential")}function piecewiseConstant(parameters){return createFunction1(parameters,"interval")}function loadFunctionTypes(obj,argFn){if(!obj)return null;var hit=!1;if(Array.isArray(obj)){var loaded,multResult=[];for(let i=0;i<obj.length;i++)loaded=loadFunctionTypes(obj[i],argFn),loaded?(multResult.push(loaded),hit=!0):multResult.push(obj[i]);return hit?multResult:obj}var p,result={__fn_types_loaded:!0},props=[];for(p in obj)obj.hasOwnProperty(p)&&props.push(p);const buildFn=function(p){Object.defineProperty(result,p,{get:function(){return this["__fn_"+p]||(this["__fn_"+p]=interpolated(this["_"+p])),this["__fn_"+p].apply(this,argFn())},set:function(v){this["_"+p]=v},configurable:!0,enumerable:!0})};for(let i=0,len=props.length;i<len;i++)p=props[i],isFunctionDefinition(obj[p])?(hit=!0,result["_"+p]=obj[p],buildFn(p)):result[p]=obj[p];return hit?result:obj}function createFunction1(parameters,defaultType){if(!isFunctionDefinition(parameters))return function(){return parameters};let isZoomConstant=!0,isFeatureConstant=!0;const stops=(parameters=JSON.parse(JSON.stringify(parameters))).stops;if(stops)for(let i=0;i<stops.length;i++)if(isFunctionDefinition(stops[i][1])){const fn=createFunction1(stops[i][1],defaultType);isZoomConstant=isZoomConstant&&fn.isZoomConstant,isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,stops[i]=[stops[i][0],fn]}const fn=createFunction(parameters,defaultType);return fn.isZoomConstant=isZoomConstant&&fn.isZoomConstant,fn.isFeatureConstant=isFeatureConstant&&fn.isFeatureConstant,fn}var pointGeometry=Point;function Point(x,y){this.x=x,this.y=y}function ShelfPack(w,h,options){options=options||{},this.w=w||64,this.h=h||64,this.autoResize=!!options.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Shelf(y,w,h){this.x=0,this.y=y,this.w=this.free=w,this.h=h}function Bin(id,x,y,w,h,maxw,maxh){this.id=id,this.x=x,this.y=y,this.w=w,this.h=h,this.maxw=maxw||w,this.maxh=maxh||h,this.refcount=0}Point.prototype={clone:function(){return new Point(this.x,this.y)},add:function(p){return this.clone()._add(p)},sub:function(p){return this.clone()._sub(p)},multByPoint:function(p){return this.clone()._multByPoint(p)},divByPoint:function(p){return this.clone()._divByPoint(p)},mult:function(k){return this.clone()._mult(k)},div:function(k){return this.clone()._div(k)},rotate:function(a){return this.clone()._rotate(a)},rotateAround:function(a,p){return this.clone()._rotateAround(a,p)},matMult:function(m){return this.clone()._matMult(m)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(other){return this.x===other.x&&this.y===other.y},dist:function(p){return Math.sqrt(this.distSqr(p))},distSqr:function(p){var dx=p.x-this.x,dy=p.y-this.y;return dx*dx+dy*dy},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(x,y){return Math.atan2(this.x*y-this.y*x,this.x*x+this.y*y)},_matMult:function(m){var y=m[2]*this.x+m[3]*this.y;return this.x=m[0]*this.x+m[1]*this.y,this.y=y,this},_add:function(p){return this.x+=p.x,this.y+=p.y,this},_sub:function(p){return this.x-=p.x,this.y-=p.y,this},_mult:function(k){return this.x*=k,this.y*=k,this},_div:function(k){return this.x/=k,this.y/=k,this},_multByPoint:function(p){return this.x*=p.x,this.y*=p.y,this},_divByPoint:function(p){return this.x/=p.x,this.y/=p.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var y=this.y;return this.y=this.x,this.x=-y,this},_rotate:function(angle){var cos=Math.cos(angle),sin=Math.sin(angle),y=sin*this.x+cos*this.y;return this.x=cos*this.x-sin*this.y,this.y=y,this},_rotateAround:function(angle,p){var cos=Math.cos(angle),sin=Math.sin(angle),y=p.y+sin*(this.x-p.x)+cos*(this.y-p.y);return this.x=p.x+cos*(this.x-p.x)-sin*(this.y-p.y),this.y=y,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Point.convert=function(a){return a instanceof Point?a:Array.isArray(a)?new Point(a[0],a[1]):a},ShelfPack.prototype.pack=function(bins,options){bins=[].concat(bins),options=options||{};for(var w,h,allocation,results=[],i=0;i<bins.length;i++)if(h=bins[i].h||bins[i].height,(w=bins[i].w||bins[i].width)&&h){if(!(allocation=this.packOne(w,h,bins[i].id)))continue;options.inPlace&&(bins[i].x=allocation.x,bins[i].y=allocation.y,bins[i].id=allocation.id),results.push(allocation)}return this.shrink(),results},ShelfPack.prototype.packOne=function(w,h,id){var bin,shelf,waste,i,h1,h2,w1,w2,best={freebin:-1,shelf:-1,waste:1/0},y=0;if("string"==typeof id||"number"==typeof id){if(bin=this.getBin(id))return this.ref(bin),bin;"number"==typeof id&&(this.maxId=Math.max(id,this.maxId))}else id=++this.maxId;for(i=0;i<this.freebins.length;i++){if(h===(bin=this.freebins[i]).maxh&&w===bin.maxw)return this.allocFreebin(i,w,h,id);h>bin.maxh||w>bin.maxw||h<=bin.maxh&&w<=bin.maxw&&(waste=bin.maxw*bin.maxh-w*h)<best.waste&&(best.waste=waste,best.freebin=i)}for(i=0;i<this.shelves.length;i++)if(y+=(shelf=this.shelves[i]).h,!(w>shelf.free)){if(h===shelf.h)return this.allocShelf(i,w,h,id);h>shelf.h||h<shelf.h&&(waste=(shelf.h-h)*w)<best.waste&&(best.freebin=-1,best.waste=waste,best.shelf=i)}return-1!==best.freebin?this.allocFreebin(best.freebin,w,h,id):-1!==best.shelf?this.allocShelf(best.shelf,w,h,id):h<=this.h-y&&w<=this.w?(shelf=new Shelf(y,this.w,h),this.allocShelf(this.shelves.push(shelf)-1,w,h,id)):this.autoResize?(h1=h2=this.h,((w1=w2=this.w)<=h1||w>w1)&&(w2=2*Math.max(w,w1)),(h1<w1||h>h1)&&(h2=2*Math.max(h,h1)),this.resize(w2,h2),this.packOne(w,h,id)):null},ShelfPack.prototype.allocFreebin=function(index,w,h,id){var bin=this.freebins.splice(index,1)[0];return bin.id=id,bin.w=w,bin.h=h,bin.refcount=0,this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.allocShelf=function(index,w,h,id){var bin=this.shelves[index].alloc(w,h,id);return this.bins[id]=bin,this.ref(bin),bin},ShelfPack.prototype.shrink=function(){if(this.shelves.length>0){for(var w2=0,h2=0,j=0;j<this.shelves.length;j++){var shelf=this.shelves[j];h2+=shelf.h,w2=Math.max(shelf.w-shelf.free,w2)}this.resize(w2,h2)}},ShelfPack.prototype.getBin=function(id){return this.bins[id]},ShelfPack.prototype.ref=function(bin){if(1==++bin.refcount){var h=bin.h;this.stats[h]=1+(0|this.stats[h])}return bin.refcount},ShelfPack.prototype.unref=function(bin){return 0===bin.refcount?0:(0==--bin.refcount&&(this.stats[bin.h]--,delete this.bins[bin.id],this.freebins.push(bin)),bin.refcount)},ShelfPack.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},ShelfPack.prototype.resize=function(w,h){this.w=w,this.h=h;for(var i=0;i<this.shelves.length;i++)this.shelves[i].resize(w);return!0},Shelf.prototype.alloc=function(w,h,id){if(w>this.free||h>this.h)return null;var x=this.x;return this.x+=w,this.free-=w,new Bin(id,x,this.y,w,h,w,this.h)},Shelf.prototype.resize=function(w){return this.free+=w-this.w,this.w=w,!0};var colorString$1={exports:{}},colorName={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},simpleSwizzle={exports:{}},isArrayish=function(obj){return!(!obj||"string"==typeof obj)&&(obj instanceof Array||Array.isArray(obj)||obj.length>=0&&(obj.splice instanceof Function||Object.getOwnPropertyDescriptor(obj,obj.length-1)&&"String"!==obj.constructor.name))},concat=Array.prototype.concat,slice=Array.prototype.slice,swizzle$1=simpleSwizzle.exports=function(args){for(var results=[],i=0,len=args.length;i<len;i++){var arg=args[i];isArrayish(arg)?results=concat.call(results,slice.call(arg)):results.push(arg)}return results};swizzle$1.wrap=function(fn){return function(){return fn(swizzle$1(arguments))}};var colorNames=colorName,swizzle=simpleSwizzle.exports,hasOwnProperty=Object.hasOwnProperty,reverseNames=Object.create(null);for(var name in colorNames)hasOwnProperty.call(colorNames,name)&&(reverseNames[colorNames[name]]=name);var cs$4=colorString$1.exports={to:{},get:{}};function clamp(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=Math.round(num).toString(16).toUpperCase();return str.length<2?"0"+str:str}cs$4.get=function(string){var val,model;switch(string.substring(0,3).toLowerCase()){case"hsl":val=cs$4.get.hsl(string),model="hsl";break;case"hwb":val=cs$4.get.hwb(string),model="hwb";break;default:val=cs$4.get.rgb(string),model="rgb"}return val?{model,value:val}:null},cs$4.get.rgb=function(string){if(!string)return null;var match,i,hexAlpha,rgb=[0,0,0,1];if(match=string.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(hexAlpha=match[2],match=match[1],i=0;i<3;i++){var i2=2*i;rgb[i]=parseInt(match.slice(i2,i2+2),16)}hexAlpha&&(rgb[3]=parseInt(hexAlpha,16)/255)}else if(match=string.match(/^#([a-f0-9]{3,4})$/i)){for(hexAlpha=(match=match[1])[3],i=0;i<3;i++)rgb[i]=parseInt(match[i]+match[i],16);hexAlpha&&(rgb[3]=parseInt(hexAlpha+hexAlpha,16)/255)}else if(match=string.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(i=0;i<3;i++)rgb[i]=parseInt(match[i+1],0);match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}else{if(!(match=string.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(match=string.match(/^(\w+)$/))?"transparent"===match[1]?[0,0,0,0]:hasOwnProperty.call(colorNames,match[1])?((rgb=colorNames[match[1]])[3]=1,rgb):null:null;for(i=0;i<3;i++)rgb[i]=Math.round(2.55*parseFloat(match[i+1]));match[4]&&(rgb[3]=match[5]?.01*parseFloat(match[4]):parseFloat(match[4]))}for(i=0;i<3;i++)rgb[i]=clamp(rgb[i],0,255);return rgb[3]=clamp(rgb[3],0,1),rgb},cs$4.get.hsl=function(string){if(!string)return null;var match=string.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$4.get.hwb=function(string){if(!string)return null;var match=string.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(match){var alpha=parseFloat(match[4]);return[(parseFloat(match[1])%360+360)%360,clamp(parseFloat(match[2]),0,100),clamp(parseFloat(match[3]),0,100),clamp(isNaN(alpha)?1:alpha,0,1)]}return null},cs$4.to.hex=function(){var rgba=swizzle(arguments);return"#"+hexDouble(rgba[0])+hexDouble(rgba[1])+hexDouble(rgba[2])+(rgba[3]<1?hexDouble(Math.round(255*rgba[3])):"")},cs$4.to.rgb=function(){var rgba=swizzle(arguments);return rgba.length<4||1===rgba[3]?"rgb("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+")":"rgba("+Math.round(rgba[0])+", "+Math.round(rgba[1])+", "+Math.round(rgba[2])+", "+rgba[3]+")"},cs$4.to.rgb.percent=function(){var rgba=swizzle(arguments),r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return rgba.length<4||1===rgba[3]?"rgb("+r+"%, "+g+"%, "+b+"%)":"rgba("+r+"%, "+g+"%, "+b+"%, "+rgba[3]+")"},cs$4.to.hsl=function(){var hsla=swizzle(arguments);return hsla.length<4||1===hsla[3]?"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)":"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+hsla[3]+")"},cs$4.to.hwb=function(){var hwba=swizzle(arguments),a="";return hwba.length>=4&&1!==hwba[3]&&(a=", "+hwba[3]),"hwb("+hwba[0]+", "+hwba[1]+"%, "+hwba[2]+"%"+a+")"},cs$4.to.keyword=function(rgb){return reverseNames[rgb.slice(0,3)]};var conversions$2={exports:{}},cssKeywords=colorName,reverseKeywords={};for(var key in cssKeywords)cssKeywords.hasOwnProperty(key)&&(reverseKeywords[cssKeywords[key]]=key);var convert$2=conversions$2.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var model in convert$2)if(convert$2.hasOwnProperty(model)){if(!("channels"in convert$2[model]))throw new Error("missing channels property: "+model);if(!("labels"in convert$2[model]))throw new Error("missing channel labels property: "+model);if(convert$2[model].labels.length!==convert$2[model].channels)throw new Error("channel and label counts mismatch: "+model);var channels=convert$2[model].channels,labels=convert$2[model].labels;delete convert$2[model].channels,delete convert$2[model].labels,Object.defineProperty(convert$2[model],"channels",{value:channels}),Object.defineProperty(convert$2[model],"labels",{value:labels})}function comparativeDistance(x,y){return Math.pow(x[0]-y[0],2)+Math.pow(x[1]-y[1],2)+Math.pow(x[2]-y[2],2)}convert$2.rgb.hsl=function(rgb){var h,l,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;return max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360),l=(min+max)/2,[h,100*(max===min?0:l<=.5?delta/(max+min):delta/(2-max-min)),100*l]},convert$2.rgb.hsv=function(rgb){var rdif,gdif,bdif,h,s,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,v=Math.max(r,g,b),diff=v-Math.min(r,g,b),diffc=function(c){return(v-c)/6/diff+.5};return 0===diff?h=s=0:(s=diff/v,rdif=diffc(r),gdif=diffc(g),bdif=diffc(b),r===v?h=bdif-gdif:g===v?h=1/3+rdif-bdif:b===v&&(h=2/3+gdif-rdif),h<0?h+=1:h>1&&(h-=1)),[360*h,100*s,100*v]},convert$2.rgb.hwb=function(rgb){var r=rgb[0],g=rgb[1],b=rgb[2];return[convert$2.rgb.hsl(rgb)[0],100*(1/255*Math.min(r,Math.min(g,b))),100*(b=1-1/255*Math.max(r,Math.max(g,b)))]},convert$2.rgb.cmyk=function(rgb){var k,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*((1-r-(k=Math.min(1-r,1-g,1-b)))/(1-k)||0),100*((1-g-k)/(1-k)||0),100*((1-b-k)/(1-k)||0),100*k]},convert$2.rgb.keyword=function(rgb){var reversed=reverseKeywords[rgb];if(reversed)return reversed;var currentClosestKeyword,currentClosestDistance=1/0;for(var keyword in cssKeywords)if(cssKeywords.hasOwnProperty(keyword)){var distance=comparativeDistance(rgb,cssKeywords[keyword]);distance<currentClosestDistance&&(currentClosestDistance=distance,currentClosestKeyword=keyword)}return currentClosestKeyword},convert$2.keyword.rgb=function(keyword){return cssKeywords[keyword]},convert$2.rgb.xyz=function(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;return[100*(.4124*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.3576*(g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92)+.1805*(b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92)),100*(.2126*r+.7152*g+.0722*b),100*(.0193*r+.1192*g+.9505*b)]},convert$2.rgb.lab=function(rgb){var xyz=convert$2.rgb.xyz(rgb),x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.hsl.rgb=function(hsl){var t1,t2,t3,rgb,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100;if(0===s)return[val=255*l,val,val];t1=2*l-(t2=l<.5?l*(1+s):l+s-l*s),rgb=[0,0,0];for(var i=0;i<3;i++)(t3=h+1/3*-(i-1))<0&&t3++,t3>1&&t3--,rgb[i]=255*(val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1);return rgb},convert$2.hsl.hsv=function(hsl){var h=hsl[0],s=hsl[1]/100,l=hsl[2]/100,smin=s,lmin=Math.max(l,.01);return s*=(l*=2)<=1?l:2-l,smin*=lmin<=1?lmin:2-lmin,[h,100*(0===l?2*smin/(lmin+smin):2*s/(l+s)),100*((l+s)/2)]},convert$2.hsv.rgb=function(hsv){var h=hsv[0]/60,s=hsv[1]/100,v=hsv[2]/100,hi=Math.floor(h)%6,f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f));switch(v*=255,hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}},convert$2.hsv.hsl=function(hsv){var lmin,sl,l,h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,vmin=Math.max(v,.01);return l=(2-s)*v,sl=s*vmin,[h,100*(sl=(sl/=(lmin=(2-s)*vmin)<=1?lmin:2-lmin)||0),100*(l/=2)]},convert$2.hwb.rgb=function(hwb){var i,v,f,n,r,g,b,h=hwb[0]/360,wh=hwb[1]/100,bl=hwb[2]/100,ratio=wh+bl;switch(ratio>1&&(wh/=ratio,bl/=ratio),f=6*h-(i=Math.floor(6*h)),0!=(1&i)&&(f=1-f),n=wh+f*((v=1-bl)-wh),i){default:case 6:case 0:r=v,g=n,b=wh;break;case 1:r=n,g=v,b=wh;break;case 2:r=wh,g=v,b=n;break;case 3:r=wh,g=n,b=v;break;case 4:r=n,g=wh,b=v;break;case 5:r=v,g=wh,b=n}return[255*r,255*g,255*b]},convert$2.cmyk.rgb=function(cmyk){var m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100;return[255*(1-Math.min(1,cmyk[0]/100*(1-k)+k)),255*(1-Math.min(1,m*(1-k)+k)),255*(1-Math.min(1,y*(1-k)+k))]},convert$2.xyz.rgb=function(xyz){var r,g,b,x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100;return g=-.9689*x+1.8758*y+.0415*z,b=.0557*x+-.204*y+1.057*z,r=(r=3.2406*x+-1.5372*y+-.4986*z)>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:12.92*g,b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:12.92*b,[255*(r=Math.min(Math.max(0,r),1)),255*(g=Math.min(Math.max(0,g),1)),255*(b=Math.min(Math.max(0,b),1))]},convert$2.xyz.lab=function(xyz){var x=xyz[0],y=xyz[1],z=xyz[2];return y/=100,z/=108.883,x=(x/=95.047)>.008856?Math.pow(x,1/3):7.787*x+16/116,[116*(y=y>.008856?Math.pow(y,1/3):7.787*y+16/116)-16,500*(x-y),200*(y-(z=z>.008856?Math.pow(z,1/3):7.787*z+16/116))]},convert$2.lab.xyz=function(lab){var x,y,z;x=lab[1]/500+(y=(lab[0]+16)/116),z=y-lab[2]/200;var y2=Math.pow(y,3),x2=Math.pow(x,3),z2=Math.pow(z,3);return y=y2>.008856?y2:(y-16/116)/7.787,x=x2>.008856?x2:(x-16/116)/7.787,z=z2>.008856?z2:(z-16/116)/7.787,[x*=95.047,y*=100,z*=108.883]},convert$2.lab.lch=function(lab){var h,l=lab[0],a=lab[1],b=lab[2];return(h=360*Math.atan2(b,a)/2/Math.PI)<0&&(h+=360),[l,Math.sqrt(a*a+b*b),h]},convert$2.lch.lab=function(lch){var hr,c=lch[1];return hr=lch[2]/360*2*Math.PI,[lch[0],c*Math.cos(hr),c*Math.sin(hr)]},convert$2.rgb.ansi16=function(args){var r=args[0],g=args[1],b=args[2],value=1 in arguments?arguments[1]:convert$2.rgb.hsv(args)[2];if(0===(value=Math.round(value/50)))return 30;var ansi=30+(Math.round(b/255)<<2|Math.round(g/255)<<1|Math.round(r/255));return 2===value&&(ansi+=60),ansi},convert$2.hsv.ansi16=function(args){return convert$2.rgb.ansi16(convert$2.hsv.rgb(args),args[2])},convert$2.rgb.ansi256=function(args){var r=args[0],g=args[1],b=args[2];return r===g&&g===b?r<8?16:r>248?231:Math.round((r-8)/247*24)+232:16+36*Math.round(r/255*5)+6*Math.round(g/255*5)+Math.round(b/255*5)},convert$2.ansi16.rgb=function(args){var color=args%10;if(0===color||7===color)return args>50&&(color+=3.5),[color=color/10.5*255,color,color];var mult=.5*(1+~~(args>50));return[(1&color)*mult*255,(color>>1&1)*mult*255,(color>>2&1)*mult*255]},convert$2.ansi256.rgb=function(args){if(args>=232){var c=10*(args-232)+8;return[c,c,c]}var rem;return args-=16,[Math.floor(args/36)/5*255,Math.floor((rem=args%36)/6)/5*255,rem%6/5*255]},convert$2.rgb.hex=function(args){var string=(((255&Math.round(args[0]))<<16)+((255&Math.round(args[1]))<<8)+(255&Math.round(args[2]))).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.hex.rgb=function(args){var match=args.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!match)return[0,0,0];var colorString=match[0];3===match[0].length&&(colorString=colorString.split("").map((function(char){return char+char})).join(""));var integer=parseInt(colorString,16);return[integer>>16&255,integer>>8&255,255&integer]},convert$2.rgb.hcg=function(rgb){var hue,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,max=Math.max(Math.max(r,g),b),min=Math.min(Math.min(r,g),b),chroma=max-min;return hue=chroma<=0?0:max===r?(g-b)/chroma%6:max===g?2+(b-r)/chroma:4+(r-g)/chroma+4,hue/=6,[360*(hue%=1),100*chroma,100*(chroma<1?min/(1-chroma):0)]},convert$2.hsl.hcg=function(hsl){var s=hsl[1]/100,l=hsl[2]/100,c=1,f=0;return(c=l<.5?2*s*l:2*s*(1-l))<1&&(f=(l-.5*c)/(1-c)),[hsl[0],100*c,100*f]},convert$2.hsv.hcg=function(hsv){var v=hsv[2]/100,c=hsv[1]/100*v,f=0;return c<1&&(f=(v-c)/(1-c)),[hsv[0],100*c,100*f]},convert$2.hcg.rgb=function(hcg){var c=hcg[1]/100,g=hcg[2]/100;if(0===c)return[255*g,255*g,255*g];var mg,pure=[0,0,0],hi=hcg[0]/360%1*6,v=hi%1,w=1-v;switch(Math.floor(hi)){case 0:pure[0]=1,pure[1]=v,pure[2]=0;break;case 1:pure[0]=w,pure[1]=1,pure[2]=0;break;case 2:pure[0]=0,pure[1]=1,pure[2]=v;break;case 3:pure[0]=0,pure[1]=w,pure[2]=1;break;case 4:pure[0]=v,pure[1]=0,pure[2]=1;break;default:pure[0]=1,pure[1]=0,pure[2]=w}return[255*(c*pure[0]+(mg=(1-c)*g)),255*(c*pure[1]+mg),255*(c*pure[2]+mg)]},convert$2.hcg.hsv=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c),f=0;return v>0&&(f=c/v),[hcg[0],100*f,100*v]},convert$2.hcg.hsl=function(hcg){var c=hcg[1]/100,l=hcg[2]/100*(1-c)+.5*c,s=0;return l>0&&l<.5?s=c/(2*l):l>=.5&&l<1&&(s=c/(2*(1-l))),[hcg[0],100*s,100*l]},convert$2.hcg.hwb=function(hcg){var c=hcg[1]/100,v=c+hcg[2]/100*(1-c);return[hcg[0],100*(v-c),100*(1-v)]},convert$2.hwb.hcg=function(hwb){var v=1-hwb[2]/100,c=v-hwb[1]/100,g=0;return c<1&&(g=(v-c)/(1-c)),[hwb[0],100*c,100*g]},convert$2.apple.rgb=function(apple){return[apple[0]/65535*255,apple[1]/65535*255,apple[2]/65535*255]},convert$2.rgb.apple=function(rgb){return[rgb[0]/255*65535,rgb[1]/255*65535,rgb[2]/255*65535]},convert$2.gray.rgb=function(args){return[args[0]/100*255,args[0]/100*255,args[0]/100*255]},convert$2.gray.hsl=convert$2.gray.hsv=function(args){return[0,0,args[0]]},convert$2.gray.hwb=function(gray){return[0,100,gray[0]]},convert$2.gray.cmyk=function(gray){return[0,0,0,gray[0]]},convert$2.gray.lab=function(gray){return[gray[0],0,0]},convert$2.gray.hex=function(gray){var val=255&Math.round(gray[0]/100*255),string=((val<<16)+(val<<8)+val).toString(16).toUpperCase();return"000000".substring(string.length)+string},convert$2.rgb.gray=function(rgb){return[(rgb[0]+rgb[1]+rgb[2])/3/255*100]};var conversions$1=conversions$2.exports;function deriveBFS(fromModel){var graph=function(){for(var graph={},models=Object.keys(conversions$1),len=models.length,i=0;i<len;i++)graph[models[i]]={distance:-1,parent:null};return graph}(),queue=[fromModel];for(graph[fromModel].distance=0;queue.length;)for(var current=queue.pop(),adjacents=Object.keys(conversions$1[current]),len=adjacents.length,i=0;i<len;i++){var adjacent=adjacents[i],node=graph[adjacent];-1===node.distance&&(node.distance=graph[current].distance+1,node.parent=current,queue.unshift(adjacent))}return graph}function link(from,to){return function(args){return to(from(args))}}function wrapConversion(toModel,graph){for(var path=[graph[toModel].parent,toModel],fn=conversions$1[graph[toModel].parent][toModel],cur=graph[toModel].parent;graph[cur].parent;)path.unshift(graph[cur].parent),fn=link(conversions$1[graph[cur].parent][cur],fn),cur=graph[cur].parent;return fn.conversion=path,fn}var conversions=conversions$2.exports,route=function(fromModel){for(var graph=deriveBFS(fromModel),conversion={},models=Object.keys(graph),len=models.length,i=0;i<len;i++){var toModel=models[i];null!==graph[toModel].parent&&(conversion[toModel]=wrapConversion(toModel,graph))}return conversion},convert$1={};Object.keys(conversions).forEach((function(fromModel){convert$1[fromModel]={},Object.defineProperty(convert$1[fromModel],"channels",{value:conversions[fromModel].channels}),Object.defineProperty(convert$1[fromModel],"labels",{value:conversions[fromModel].labels});var routes=route(fromModel);Object.keys(routes).forEach((function(toModel){var fn=routes[toModel];convert$1[fromModel][toModel]=function(fn){var wrappedFn=function(args){if(null==args)return args;arguments.length>1&&(args=Array.prototype.slice.call(arguments));var result=fn(args);if("object"==typeof result)for(var len=result.length,i=0;i<len;i++)result[i]=Math.round(result[i]);return result};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn),convert$1[fromModel][toModel].raw=function(fn){var wrappedFn=function(args){return null==args?args:(arguments.length>1&&(args=Array.prototype.slice.call(arguments)),fn(args))};return"conversion"in fn&&(wrappedFn.conversion=fn.conversion),wrappedFn}(fn)}))}));var colorString=colorString$1.exports,convert=convert$1,_slice=[].slice,skippedModels=["keyword","gray","hex"],hashedModelKeys={};Object.keys(convert).forEach((function(model){hashedModelKeys[_slice.call(convert[model].labels).sort().join("")]=model}));var limiters={};function Color(obj,model){if(!(this instanceof Color))return new Color(obj,model);if(model&&model in skippedModels&&(model=null),model&&!(model in convert))throw new Error("Unknown model: "+model);var i,channels;if(null==obj)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(obj instanceof Color)this.model=obj.model,this.color=obj.color.slice(),this.valpha=obj.valpha;else if("string"==typeof obj){var result=colorString.get(obj);if(null===result)throw new Error("Unable to parse color from string: "+obj);this.model=result.model,this.color=result.value.slice(0,channels=convert[this.model].channels),this.valpha="number"==typeof result.value[channels]?result.value[channels]:1}else if(obj.length){this.model=model||"rgb";var newArr=_slice.call(obj,0,channels=convert[this.model].channels);this.color=zeroArray(newArr,channels),this.valpha="number"==typeof obj[channels]?obj[channels]:1}else if("number"==typeof obj)obj&=16777215,this.model="rgb",this.color=[obj>>16&255,obj>>8&255,255&obj],this.valpha=1;else{this.valpha=1;var keys=Object.keys(obj);"alpha"in obj&&(keys.splice(keys.indexOf("alpha"),1),this.valpha="number"==typeof obj.alpha?obj.alpha:0);var hashedKeys=keys.sort().join("");if(!(hashedKeys in hashedModelKeys))throw new Error("Unable to parse color from object: "+JSON.stringify(obj));this.model=hashedModelKeys[hashedKeys];var labels=convert[this.model].labels,color=[];for(i=0;i<labels.length;i++)color.push(obj[labels[i]]);this.color=zeroArray(color)}if(limiters[this.model])for(channels=convert[this.model].channels,i=0;i<channels;i++){var limit=limiters[this.model][i];limit&&(this.color[i]=limit(this.color[i]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function getset(model,channel,modifier){return(model=Array.isArray(model)?model:[model]).forEach((function(m){(limiters[m]||(limiters[m]=[]))[channel]=modifier})),model=model[0],function(val){var result;return arguments.length?(modifier&&(val=modifier(val)),(result=this[model]()).color[channel]=val,result):(result=this[model]().color[channel],modifier&&(result=modifier(result)),result)}}function maxfn(max){return function(v){return Math.max(0,Math.min(max,v))}}function assertArray(val){return Array.isArray(val)?val:[val]}function zeroArray(arr,length){for(var i=0;i<length;i++)"number"!=typeof arr[i]&&(arr[i]=0);return arr}Color.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(places){var self=this.model in colorString.to?this:this.rgb(),args=1===(self=self.round("number"==typeof places?places:1)).valpha?self.color:self.color.concat(this.valpha);return colorString.to[self.model](args)},percentString:function(places){var self=this.rgb().round("number"==typeof places?places:1),args=1===self.valpha?self.color:self.color.concat(this.valpha);return colorString.to.rgb.percent(args)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var result={},channels=convert[this.model].channels,labels=convert[this.model].labels,i=0;i<channels;i++)result[labels[i]]=this.color[i];return 1!==this.valpha&&(result.alpha=this.valpha),result},unitArray:function(){var rgb=this.rgb().color;return rgb[0]/=255,rgb[1]/=255,rgb[2]/=255,1!==this.valpha&&rgb.push(this.valpha),rgb},unitObject:function(){var rgb=this.rgb().object();return rgb.r/=255,rgb.g/=255,rgb.b/=255,1!==this.valpha&&(rgb.alpha=this.valpha),rgb},round:function(places){return places=Math.max(places||0,0),new Color(this.color.map(function(places){return function(num){return function(num,places){return Number(num.toFixed(places))}(num,places)}}(places)).concat(this.valpha),this.model)},alpha:function(val){return arguments.length?new Color(this.color.concat(Math.max(0,Math.min(1,val))),this.model):this.valpha},red:getset("rgb",0,maxfn(255)),green:getset("rgb",1,maxfn(255)),blue:getset("rgb",2,maxfn(255)),hue:getset(["hsl","hsv","hsl","hwb","hcg"],0,(function(val){return(val%360+360)%360})),saturationl:getset("hsl",1,maxfn(100)),lightness:getset("hsl",2,maxfn(100)),saturationv:getset("hsv",1,maxfn(100)),value:getset("hsv",2,maxfn(100)),chroma:getset("hcg",1,maxfn(100)),gray:getset("hcg",2,maxfn(100)),white:getset("hwb",1,maxfn(100)),wblack:getset("hwb",2,maxfn(100)),cyan:getset("cmyk",0,maxfn(100)),magenta:getset("cmyk",1,maxfn(100)),yellow:getset("cmyk",2,maxfn(100)),black:getset("cmyk",3,maxfn(100)),x:getset("xyz",0,maxfn(100)),y:getset("xyz",1,maxfn(100)),z:getset("xyz",2,maxfn(100)),l:getset("lab",0,maxfn(100)),a:getset("lab",1),b:getset("lab",2),keyword:function(val){return arguments.length?new Color(val):convert[this.model].keyword(this.color)},hex:function(val){return arguments.length?new Color(val):colorString.to.hex(this.rgb().round().color)},rgbNumber:function(){var rgb=this.rgb().color;return(255&rgb[0])<<16|(255&rgb[1])<<8|255&rgb[2]},luminosity:function(){for(var rgb=this.rgb().color,lum=[],i=0;i<rgb.length;i++){var chan=rgb[i]/255;lum[i]=chan<=.03928?chan/12.92:Math.pow((chan+.055)/1.055,2.4)}return.2126*lum[0]+.7152*lum[1]+.0722*lum[2]},contrast:function(color2){var lum1=this.luminosity(),lum2=color2.luminosity();return lum1>lum2?(lum1+.05)/(lum2+.05):(lum2+.05)/(lum1+.05)},level:function(color2){var contrastRatio=this.contrast(color2);return contrastRatio>=7.1?"AAA":contrastRatio>=4.5?"AA":""},isDark:function(){var rgb=this.rgb().color;return(299*rgb[0]+587*rgb[1]+114*rgb[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var rgb=this.rgb(),i=0;i<3;i++)rgb.color[i]=255-rgb.color[i];return rgb},lighten:function(ratio){var hsl=this.hsl();return hsl.color[2]+=hsl.color[2]*ratio,hsl},darken:function(ratio){var hsl=this.hsl();return hsl.color[2]-=hsl.color[2]*ratio,hsl},saturate:function(ratio){var hsl=this.hsl();return hsl.color[1]+=hsl.color[1]*ratio,hsl},desaturate:function(ratio){var hsl=this.hsl();return hsl.color[1]-=hsl.color[1]*ratio,hsl},whiten:function(ratio){var hwb=this.hwb();return hwb.color[1]+=hwb.color[1]*ratio,hwb},blacken:function(ratio){var hwb=this.hwb();return hwb.color[2]+=hwb.color[2]*ratio,hwb},grayscale:function(){var rgb=this.rgb().color,val=.3*rgb[0]+.59*rgb[1]+.11*rgb[2];return Color.rgb(val,val,val)},fade:function(ratio){return this.alpha(this.valpha-this.valpha*ratio)},opaquer:function(ratio){return this.alpha(this.valpha+this.valpha*ratio)},rotate:function(degrees){var hsl=this.hsl(),hue=hsl.color[0];return hsl.color[0]=hue=(hue=(hue+degrees)%360)<0?360+hue:hue,hsl},mix:function(mixinColor,weight){if(!mixinColor||!mixinColor.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof mixinColor);var color1=mixinColor.rgb(),color2=this.rgb(),p=void 0===weight?.5:weight,w=2*p-1,a=color1.alpha()-color2.alpha(),w1=((w*a==-1?w:(w+a)/(1+w*a))+1)/2,w2=1-w1;return Color.rgb(w1*color1.red()+w2*color2.red(),w1*color1.green()+w2*color2.green(),w1*color1.blue()+w2*color2.blue(),color1.alpha()*p+color2.alpha()*(1-p))}},Object.keys(convert).forEach((function(model){if(-1===skippedModels.indexOf(model)){var channels=convert[model].channels;Color.prototype[model]=function(){if(this.model===model)return new Color(this);if(arguments.length)return new Color(arguments,model);var newAlpha="number"==typeof arguments[channels]?channels:this.valpha;return new Color(assertArray(convert[this.model][model].raw(this.color)).concat(newAlpha),model)},Color[model]=function(color){return"number"==typeof color&&(color=zeroArray(_slice.call(arguments),channels)),new Color(color,model)}}}));var color=Color;
/*!
	    Feature Filter by

	    (c) mapbox 2016 and maptalks 2018
	    www.mapbox.com | www.maptalks.org
	    License: MIT, header required.
	*/const types=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function createFilter(filter){return new Function("f",`var p = (f && f.properties || {}); return ${compile(filter)}`)}function isFeatureFilter(filter){if(!0===filter||!1===filter)return!0;if(!Array.isArray(filter)||0===filter.length)return!1;switch(filter[0]){case"has":case"!has":return 2===filter.length&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"in":case"!in":return filter.length>=2&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===filter.length&&("string"==typeof filter[1]||filter[1].property&&filter[1].op);case"none":case"any":case"all":for(const f of filter.slice(1))if(!isFeatureFilter(f)&&"boolean"!=typeof f)return!1;return!0;case"contains":return!0;default:return!1}}function compile(filter){if(!filter)return"true";const op=filter[0];if(filter.length<=1)return"any"===op?"false":"true";return`(${"=="===op?compileComparisonOp(filter[1],filter[2],"===",!1):"!="===op?compileComparisonOp(filter[1],filter[2],"!==",!1):"<"===op||">"===op||"<="===op||">="===op?compileComparisonOp(filter[1],filter[2],op,!0):"any"===op?compileLogicalOp(filter.slice(1),"||"):"all"===op?compileLogicalOp(filter.slice(1),"&&"):"none"===op?compileNegation(compileLogicalOp(filter.slice(1),"||")):"in"===op?compileInOp(filter[1],filter.slice(2)):"!in"===op?compileNegation(compileInOp(filter[1],filter.slice(2))):"has"===op?compileHasOp(filter[1]):"!has"===op?compileNegation(compileHasOp(filter[1])):"contains"===op?function(property,str,index){const prop=compilePropertyReference(property);return void 0!==index?`(${prop} + '').indexOf("${str}") === ${index}`:`(${prop} + '').indexOf("${str}") >= 0`}(filter[1],filter[2],filter[3]):"true"})`}function compilePropertyReference(property){return"$"===property[0]?"f."+property.substring(1):"p["+JSON.stringify(property)+"]"}function compileComparisonOp(property,value,op,checkType){if("object"==typeof(obj=property)&&obj&&property.op)return function(propertyObj,value,op,checkType){const property=propertyObj.property,funName=propertyObj.op;let left=compilePropertyReference(property);return"length"!==funName?(console.error(`not support ${funName} op`),"false"):(left=`((${left}+='').length)`,getComparisonCode(left,property,value,op,checkType))}(property,value,op,checkType);var obj;return getComparisonCode(compilePropertyReference(property),property,value,op,checkType)}function getComparisonCode(left,property,value,op,checkType){const right="$type"===property?types.indexOf(value):JSON.stringify(value);return(checkType?`typeof ${left}=== typeof ${right}&&`:"")+left+op+right}function compileLogicalOp(expressions,op){return expressions.map(compile).join(op)}function compileInOp(property,values){"$type"===property&&(values=values.map((value=>types.indexOf(value))));const left=JSON.stringify(values.sort(compare)),right=compilePropertyReference(property);return values.length<=200?`${left}.indexOf(${right}) !== -1`:`function(v, a, i, j) {\n        while (i <= j) { var m = (i + j) >> 1;\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\n        }\n    return false; }(${right}, ${left},0,${values.length-1})`}function compileHasOp(property){return"$id"===property?'"id" in f':`${JSON.stringify(property)} in p`}function compileNegation(expression){return`!(${expression})`}function compare(a,b){return a<b?-1:a>b?1:0}function compileStyle(styles){if(!Array.isArray(styles))return compileStyle([styles]);const compiled=[];for(let i=0;i<styles.length;i++){let filter;filter=!0===styles[i].filter?function(){return!0}:createFilter(styles[i].filter),compiled.push(extend$1({},styles[i],{filter}))}return compiled}function extend$1(dest){for(let i=1;i<arguments.length;i++){const src=arguments[i];for(const k in src)dest[k]=src[k]}return dest}var quickselect$1={exports:{}};!function(module,exports){module.exports=function(){function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}return quickselect}()}(quickselect$1);var h=quickselect$1.exports;class TinyQueue{constructor(data=[],compare=defaultCompare$1){if(this.data=data,this.length=this.data.length,this.compare=compare,this.length>0)for(let i=(this.length>>1)-1;i>=0;i--)this._down(i)}push(item){this.data.push(item),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const top=this.data[0],bottom=this.data.pop();return this.length--,this.length>0&&(this.data[0]=bottom,this._down(0)),top}peek(){return this.data[0]}_up(pos){const{data,compare}=this,item=data[pos];for(;pos>0;){const parent=pos-1>>1,current=data[parent];if(compare(item,current)>=0)break;data[pos]=current,pos=parent}data[pos]=item}_down(pos){const{data,compare}=this,halfLength=this.length>>1,item=data[pos];for(;pos<halfLength;){let left=1+(pos<<1),best=data[left];const right=left+1;if(right<this.length&&compare(data[right],best)<0&&(left=right,best=data[right]),compare(best,item)>=0)break;data[pos]=best,pos=left}data[pos]=item}}function defaultCompare$1(a,b){return a<b?-1:a>b?1:0}var earcut$1={exports:{}};function earcut(data,holeIndices,dim){dim=dim||2;var minX,minY,maxX,maxY,x,y,invSize,hasHoles=holeIndices&&holeIndices.length,outerLen=hasHoles?holeIndices[0]*dim:data.length,outerNode=linkedList(data,0,outerLen,dim,!0),triangles=[];if(!outerNode||outerNode.next===outerNode.prev)return triangles;if(hasHoles&&(outerNode=function(data,holeIndices,outerNode,dim){var i,len,list,queue=[];for(i=0,len=holeIndices.length;i<len;i++)(list=linkedList(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim,!1))===list.next&&(list.steiner=!0),queue.push(getLeftmost(list));for(queue.sort(compareX),i=0;i<queue.length;i++)outerNode=eliminateHole(queue[i],outerNode);return outerNode}(data,holeIndices,outerNode,dim)),data.length>80*dim){minX=maxX=data[0],minY=maxY=data[1];for(var i=dim;i<outerLen;i+=dim)(x=data[i])<minX&&(minX=x),(y=data[i+1])<minY&&(minY=y),x>maxX&&(maxX=x),y>maxY&&(maxY=y);invSize=0!==(invSize=Math.max(maxX-minX,maxY-minY))?32767/invSize:0}return earcutLinked(outerNode,triangles,dim,minX,minY,invSize,0),triangles}function linkedList(data,start,end,dim,clockwise){var i,last;if(clockwise===signedArea(data,start,end,dim)>0)for(i=start;i<end;i+=dim)last=insertNode(i,data[i],data[i+1],last);else for(i=end-dim;i>=start;i-=dim)last=insertNode(i,data[i],data[i+1],last);return last&&equals(last,last.next)&&(removeNode(last),last=last.next),last}function filterPoints(start,end){if(!start)return start;end||(end=start);var again,p=start;do{if(again=!1,p.steiner||!equals(p,p.next)&&0!==area(p.prev,p,p.next))p=p.next;else{if(removeNode(p),(p=end=p.prev)===p.next)break;again=!0}}while(again||p!==end);return end}function earcutLinked(ear,triangles,dim,minX,minY,invSize,pass){if(ear){!pass&&invSize&&function(start,minX,minY,invSize){var p=start;do{0===p.z&&(p.z=zOrder(p.x,p.y,minX,minY,invSize)),p.prevZ=p.prev,p.nextZ=p.next,p=p.next}while(p!==start);p.prevZ.nextZ=null,p.prevZ=null,function(list){var i,p,q,e,tail,numMerges,pSize,qSize,inSize=1;do{for(p=list,list=null,tail=null,numMerges=0;p;){for(numMerges++,q=p,pSize=0,i=0;i<inSize&&(pSize++,q=q.nextZ);i++);for(qSize=inSize;pSize>0||qSize>0&&q;)0!==pSize&&(0===qSize||!q||p.z<=q.z)?(e=p,p=p.nextZ,pSize--):(e=q,q=q.nextZ,qSize--),tail?tail.nextZ=e:list=e,e.prevZ=tail,tail=e;p=q}tail.nextZ=null,inSize*=2}while(numMerges>1)}(p)}(ear,minX,minY,invSize);for(var prev,next,stop=ear;ear.prev!==ear.next;)if(prev=ear.prev,next=ear.next,invSize?isEarHashed(ear,minX,minY,invSize):isEar(ear))triangles.push(prev.i/dim|0),triangles.push(ear.i/dim|0),triangles.push(next.i/dim|0),removeNode(ear),ear=next.next,stop=next.next;else if((ear=next)===stop){pass?1===pass?earcutLinked(ear=cureLocalIntersections(filterPoints(ear),triangles,dim),triangles,dim,minX,minY,invSize,2):2===pass&&splitEarcut(ear,triangles,dim,minX,minY,invSize):earcutLinked(filterPoints(ear),triangles,dim,minX,minY,invSize,1);break}}}function isEar(ear){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,p=c.next;p!==a;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function isEarHashed(ear,minX,minY,invSize){var a=ear.prev,b=ear,c=ear.next;if(area(a,b,c)>=0)return!1;for(var ax=a.x,bx=b.x,cx=c.x,ay=a.y,by=b.y,cy=c.y,x0=ax<bx?ax<cx?ax:cx:bx<cx?bx:cx,y0=ay<by?ay<cy?ay:cy:by<cy?by:cy,x1=ax>bx?ax>cx?ax:cx:bx>cx?bx:cx,y1=ay>by?ay>cy?ay:cy:by>cy?by:cy,minZ=zOrder(x0,y0,minX,minY,invSize),maxZ=zOrder(x1,y1,minX,minY,invSize),p=ear.prevZ,n=ear.nextZ;p&&p.z>=minZ&&n&&n.z<=maxZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;if(p=p.prevZ,n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}for(;p&&p.z>=minZ;){if(p.x>=x0&&p.x<=x1&&p.y>=y0&&p.y<=y1&&p!==a&&p!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,p.x,p.y)&&area(p.prev,p,p.next)>=0)return!1;p=p.prevZ}for(;n&&n.z<=maxZ;){if(n.x>=x0&&n.x<=x1&&n.y>=y0&&n.y<=y1&&n!==a&&n!==c&&pointInTriangle(ax,ay,bx,by,cx,cy,n.x,n.y)&&area(n.prev,n,n.next)>=0)return!1;n=n.nextZ}return!0}function cureLocalIntersections(start,triangles,dim){var p=start;do{var a=p.prev,b=p.next.next;!equals(a,b)&&intersects$1(a,p,p.next,b)&&locallyInside(a,b)&&locallyInside(b,a)&&(triangles.push(a.i/dim|0),triangles.push(p.i/dim|0),triangles.push(b.i/dim|0),removeNode(p),removeNode(p.next),p=start=b),p=p.next}while(p!==start);return filterPoints(p)}function splitEarcut(start,triangles,dim,minX,minY,invSize){var a=start;do{for(var b=a.next.next;b!==a.prev;){if(a.i!==b.i&&isValidDiagonal(a,b)){var c=splitPolygon(a,b);return a=filterPoints(a,a.next),c=filterPoints(c,c.next),earcutLinked(a,triangles,dim,minX,minY,invSize,0),void earcutLinked(c,triangles,dim,minX,minY,invSize,0)}b=b.next}a=a.next}while(a!==start)}function compareX(a,b){return a.x-b.x}function eliminateHole(hole,outerNode){var bridge=function(hole,outerNode){var m,p=outerNode,hx=hole.x,hy=hole.y,qx=-1/0;do{if(hy<=p.y&&hy>=p.next.y&&p.next.y!==p.y){var x=p.x+(hy-p.y)*(p.next.x-p.x)/(p.next.y-p.y);if(x<=hx&&x>qx&&(qx=x,m=p.x<p.next.x?p:p.next,x===hx))return m}p=p.next}while(p!==outerNode);if(!m)return null;var tan,stop=m,mx=m.x,my=m.y,tanMin=1/0;p=m;do{hx>=p.x&&p.x>=mx&&hx!==p.x&&pointInTriangle(hy<my?hx:qx,hy,mx,my,hy<my?qx:hx,hy,p.x,p.y)&&(tan=Math.abs(hy-p.y)/(hx-p.x),locallyInside(p,hole)&&(tan<tanMin||tan===tanMin&&(p.x>m.x||p.x===m.x&&sectorContainsSector(m,p)))&&(m=p,tanMin=tan)),p=p.next}while(p!==stop);return m}(hole,outerNode);if(!bridge)return outerNode;var bridgeReverse=splitPolygon(bridge,hole);return filterPoints(bridgeReverse,bridgeReverse.next),filterPoints(bridge,bridge.next)}function sectorContainsSector(m,p){return area(m.prev,m,p.prev)<0&&area(p.next,m,m.next)<0}function zOrder(x,y,minX,minY,invSize){return(x=1431655765&((x=858993459&((x=252645135&((x=16711935&((x=(x-minX)*invSize|0)|x<<8))|x<<4))|x<<2))|x<<1))|(y=1431655765&((y=858993459&((y=252645135&((y=16711935&((y=(y-minY)*invSize|0)|y<<8))|y<<4))|y<<2))|y<<1))<<1}function getLeftmost(start){var p=start,leftmost=start;do{(p.x<leftmost.x||p.x===leftmost.x&&p.y<leftmost.y)&&(leftmost=p),p=p.next}while(p!==start);return leftmost}function pointInTriangle(ax,ay,bx,by,cx,cy,px,py){return(cx-px)*(ay-py)>=(ax-px)*(cy-py)&&(ax-px)*(by-py)>=(bx-px)*(ay-py)&&(bx-px)*(cy-py)>=(cx-px)*(by-py)}function isValidDiagonal(a,b){return a.next.i!==b.i&&a.prev.i!==b.i&&!function(a,b){var p=a;do{if(p.i!==a.i&&p.next.i!==a.i&&p.i!==b.i&&p.next.i!==b.i&&intersects$1(p,p.next,a,b))return!0;p=p.next}while(p!==a);return!1}(a,b)&&(locallyInside(a,b)&&locallyInside(b,a)&&function(a,b){var p=a,inside=!1,px=(a.x+b.x)/2,py=(a.y+b.y)/2;do{p.y>py!=p.next.y>py&&p.next.y!==p.y&&px<(p.next.x-p.x)*(py-p.y)/(p.next.y-p.y)+p.x&&(inside=!inside),p=p.next}while(p!==a);return inside}(a,b)&&(area(a.prev,a,b.prev)||area(a,b.prev,b))||equals(a,b)&&area(a.prev,a,a.next)>0&&area(b.prev,b,b.next)>0)}function area(p,q,r){return(q.y-p.y)*(r.x-q.x)-(q.x-p.x)*(r.y-q.y)}function equals(p1,p2){return p1.x===p2.x&&p1.y===p2.y}function intersects$1(p1,q1,p2,q2){var o1=sign(area(p1,q1,p2)),o2=sign(area(p1,q1,q2)),o3=sign(area(p2,q2,p1)),o4=sign(area(p2,q2,q1));return o1!==o2&&o3!==o4||(!(0!==o1||!onSegment(p1,p2,q1))||(!(0!==o2||!onSegment(p1,q2,q1))||(!(0!==o3||!onSegment(p2,p1,q2))||!(0!==o4||!onSegment(p2,q1,q2)))))}function onSegment(p,q,r){return q.x<=Math.max(p.x,r.x)&&q.x>=Math.min(p.x,r.x)&&q.y<=Math.max(p.y,r.y)&&q.y>=Math.min(p.y,r.y)}function sign(num){return num>0?1:num<0?-1:0}function locallyInside(a,b){return area(a.prev,a,a.next)<0?area(a,b,a.next)>=0&&area(a,a.prev,b)>=0:area(a,b,a.prev)<0||area(a,a.next,b)<0}function splitPolygon(a,b){var a2=new Node(a.i,a.x,a.y),b2=new Node(b.i,b.x,b.y),an=a.next,bp=b.prev;return a.next=b,b.prev=a,a2.next=an,an.prev=a2,b2.next=a2,a2.prev=b2,bp.next=b2,b2.prev=bp,b2}function insertNode(i,x,y,last){var p=new Node(i,x,y);return last?(p.next=last.next,p.prev=last,last.next.prev=p,last.next=p):(p.prev=p,p.next=p),p}function removeNode(p){p.next.prev=p.prev,p.prev.next=p.next,p.prevZ&&(p.prevZ.nextZ=p.nextZ),p.nextZ&&(p.nextZ.prevZ=p.prevZ)}function Node(i,x,y){this.i=i,this.x=x,this.y=y,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function signedArea(data,start,end,dim){for(var sum=0,i=start,j=end-dim;i<end;i+=dim)sum+=(data[j]-data[i])*(data[i+1]+data[j+1]),j=i;return sum}earcut$1.exports=earcut,earcut$1.exports.default=earcut,earcut.deviation=function(data,holeIndices,dim,triangles){var hasHoles=holeIndices&&holeIndices.length,polygonArea=Math.abs(signedArea(data,0,hasHoles?holeIndices[0]*dim:data.length,dim));if(hasHoles)for(var i=0,len=holeIndices.length;i<len;i++){polygonArea-=Math.abs(signedArea(data,holeIndices[i]*dim,i<len-1?holeIndices[i+1]*dim:data.length,dim))}var trianglesArea=0;for(i=0;i<triangles.length;i+=3){var a=triangles[i]*dim,b=triangles[i+1]*dim,c=triangles[i+2]*dim;trianglesArea+=Math.abs((data[a]-data[c])*(data[b+1]-data[a+1])-(data[a]-data[b])*(data[c+1]-data[a+1]))}return 0===polygonArea&&0===trianglesArea?0:Math.abs((trianglesArea-polygonArea)/polygonArea)},earcut.flatten=function(data){for(var dim=data[0][0].length,result={vertices:[],holes:[],dimensions:dim},holeIndex=0,i=0;i<data.length;i++){for(var j=0;j<data[i].length;j++)for(var d=0;d<dim;d++)result.vertices.push(data[i][j][d]);i>0&&result.holes.push(holeIndex+=data[i-1].length)}return result};
/*!
	 * @maptalks/vector-packer v0.92.1
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.com
	 */
const x$4={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function v$2(t,e={}){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)b$3(n,t.features[r],e,r);else b$3(n,"Feature"===t.type?t:{geometry:t},e);return n}function b$3(t,e,n,r){if(e.geometry&&e.geometry.geometry){var i=e.geometry.coordinates,s=e.geometry.type,a=[],o=e.id;if(n.promoteId?o=e.properties[n.promoteId]:n.generateId&&(o=r||0),"Point"===s)w$2(i,a);else if("MultiPoint"===s)for(var l=0;l<i.length;l++)w$2(i[l],a);else if("LineString"===s)A$2([i],a);else if("MultiLineString"===s){if(n.lineMetrics){for(l=0;l<i.length;l++)k$4(i[l],a=[]),t.push(_$4(o,"LineString",a,e.properties));return}A$2(i,a)}else if("Polygon"===s)A$2(i,a);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(l=0;l<e.geometry.geometries.length;l++)b$3(t,{id:o,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}return void console.warn(`Input data type(${s}) is not a valid GeoJSON geometry type.`)}for(l=0;l<i.length;l++){var h=[];A$2(i[l],h),a.push(h)}}t.push(_$4(o,s,a,e.properties))}}function w$2(e,n){const r=new pointGeometry(e[0],e[1]);r.z=100*(e[2]||0),n.push([r])}function k$4(e,n){for(let r=0;r<e.length;r++){const i=new pointGeometry(e[r][0],e[r][1]);i.z=100*(e[r][2]||0),n.push(i)}}function A$2(t,e,n,r){for(var i=0;i<t.length;i++){var s=[];k$4(t[i],s),e.push(s)}}function _$4(t,e,n,r){return{id:void 0===t?null:t,type:x$4[e],geometry:n,properties:r}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */function F$4(t,{width:e,height:n},r,i){if(i){if(i.length!==e*n*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*n*r);return t.width=e,t.height=n,t.data=i,t}function P$3(t,{width:e,height:n},r){if(e===t.width&&n===t.height)return;const i=F$4({},{width:e,height:n},r);z$4(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,e),height:Math.min(t.height,n)},r),t.width=e,t.height=n,t.data=i.data}function z$4(t,e,n,r,i,s){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const a=t.data,o=e.data;if(a===o)return e;for(let l=0;l<i.height;l++){const h=((n.y+l)*t.width+n.x)*s,u=((r.y+l)*e.width+r.x)*s;for(let t=0;t<i.width*s;t++)o[u+t]=a[h+t]}return e}class M$4{constructor(t,e){F$4(this,t,1,e)}resize(t){P$3(this,t,1)}clone(){return new M$4({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){z$4(t,e,n,r,i,1)}}class T$4{constructor(t,e){F$4(this,t,4,e)}resize(t){P$3(this,t,4)}clone(){return new T$4({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){z$4(t,e,n,r,i,4)}}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 */class S$4{constructor(t,e,{pixelRatio:n}){this.paddedRect=t,this.pixelRatio=n||1,this.padding=e}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class C$2{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n=Object.keys(t).length,r={},i=new ShelfPack(0,0,{autoResize:!0}),s=[],a=n>1?1:0;for(const e in t){const n=t[e],i={x:0,y:0,w:n.data.width+2*a,h:n.data.height+2*a};s.push(i),r[e]=new S$4(i,a,n)}if(i.pack(s,{inPlace:!0}),!D$4(i.w)||!D$4(i.h)){const t=I$3(i.w),e=I$3(i.h);i.resize(t,e)}const o=new T$4({width:i.w,height:i.h});for(const e in t){const n=t[e],i=r[e].paddedRect;T$4.copy(n.data,o,{x:0,y:0},{x:i.x+a,y:i.y+a},n.data)}this.image=o,this.positions=r}}function D$4(t){return 0==(t&t-1)&&0!==t}function I$3(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}
/*!
	 * Codes from mapbox-gl-js
	 * github.com/mapbox/mapbox-gl-js
	 * MIT License
	 * TODO potpack
	 */class E$4{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n={},r=new ShelfPack(0,0,{autoResize:!0}),i=[];for(const e in t){const r=t[e],s=n[e]={};for(const t in r){const e=r[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const n={x:0,y:0,w:e.bitmap.width+2,h:e.bitmap.height+2};i.push(n),s[t]={rect:n,metrics:e.metrics}}}r.pack(i,{inPlace:!0});const s=new M$4({width:r.w,height:r.h});for(const e in t){const r=t[e];for(const t in r){const i=r[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const a=n[e][t].rect;M$4.copy(i.bitmap,s,{x:0,y:0},{x:a.x+1,y:a.y+1},i.bitmap)}}this.image=s,this.positions=n}}function O$4(t){return t<65536?Uint16Array:Uint32Array}function L$4(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function R$4(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function W$4(t,e){const n=new e(t.length),r=n.length;for(let e=0;e<r;e++)n[e]=t[e];return n}function V$4(t){const e=t.type,n=[];if(1===e||4===e)for(let e=0;e<t.geometry.length;e++)w$2(t.geometry[e],n);else if(2===e)A$2(t.geometry,n);else if(3===e)A$2(t.geometry,n);else if(5===e)A$2(t.geometry,n);else if(6===e)for(let e=0;e<t.geometry.length;e++){const r=[];A$2(t.geometry[e],r),n.push(r)}return t.geometry=n,t}function U$4(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function $$4(t){return null==t}function N$4(t){return"number"==typeof t&&!isNaN(t)}function H$4(t){return"object"==typeof t&&!!t}function j$4(t){return!$$4(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function q$5(t){return!$$4(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}const G$4=Object.prototype.hasOwnProperty;function X$5(t,e){return G$4.call(t,e)}const B$4=Math.PI/180;function J$5(t){return t&&isFunctionDefinition(t)&&t.property}function Z$5(t){const{verticalCentimeterToPoint:e,tileRatio:n}=t;return e*n}const K$5={};function Q$5(t,e){if(!Array.isArray(e)){if(e&&void 0!==e.r&&void 0!==e.g&&void 0!==e.b)return t[0]=255*e.r,t[1]=255*e.g,t[2]=255*e.b,t[3]=void 0!==e.a?255*e.a:255,t;e=K$5[e]=K$5[e]||color(e).unitArray()}for(let n=0;n<e.length;n++)t[n]=255*e[n];return 3===e.length&&(t[3]=255),t}const tt$4={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1},et$4={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};var nt$4=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:U$4,isNil:$$4,isNumber:N$4,isInteger:function(t){return(0|t)===t},isObject:H$4,isString:j$4,isFunction:q$5,hasOwn:X$5,join:function(t,e){return t.join?t.join(e||","):Array.prototype.join.call(t,e||",")},toRadian:function(t){return t*B$4},toDegree:function(t){return t/B$4},evaluate:function(t,e,n){return q$5(t)?t(void 0!==n?n:null,e):t},isFnTypeSymbol:J$5,getAltitudeToLocal:Z$5,getTubeSizeScale:function(t){return"centimeter"===t||"cm"===t?1:"millimeter"===t||"mm"===t?.1:100},normalizeColor:Q$5,checkIfIdentityZoomDependent:function(t,e,i){if(Array.isArray(i)||(i=Object.values(i)),!i||!i.length)return!1;if(!tt$4[t])return!1;for(let t=0;t<i.length;t++){const s=i[t]&&(i[t].feature||i[t]);if(!s)continue;const a=s.properties&&s.properties[e];if(a&&isFunctionDefinition(a)&&!interpolated(a).isZoomConstant)return!0}return!1},checkIfZoomFnTypeSymbol:function(t){return!!tt$4[t]||!!et$4[t]}});function rt$4(t){let e=0;for(let n,r,i=0,s=t.length,a=s-1;i<s;a=i++)if(n=t[i],r=t[a],void 0!==n.x){if(n.z||r.z)return 1;e+=(r.x-n.x)*(n.y+r.y)}else{if(n[2]||r[2])return 1;e+=(r[0]-n[0])*(n[1]+r[1])}return e}function st$4(t,e,n){let r=n;return e&&t&&(r=+t[e]),isNaN(r)&&(r=n||0),100*r}function at$4(t,e,n,r,i,s,a){e||0===e||(e=1);const o=st$4(t.properties,n,r),l=o*e;let h=(s?100*s:0)||o;return i?h=st$4(t.properties,i,s):a&&(h=o-st$4(t.properties,a,s)),h*=e,{altitude:l,height:h}}function ot$4(t,e){return e<1/0&&(t.x<0||t.x>e||t.y<0||t.y>e)}function lt$4(t){return null==t}function ht$4(t,e,n){if(t===n||t===e)return t;const r=n-e;return((t-e)%r+r)%r+e}function ut$4(t,e){if(!e)return null;const n=new Map;for(let r=0;r<e.length;r++){const i=e[r],s=t[i];let a=n.get(s);a||(a=[],n.set(s,a)),a.push(i)}return n}class ct$4{constructor(t,e,n,r){this.feature=t,this.symbol=e,this.fnTypes=n,this.options=r}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:e}=this.fnTypes;return this._getResource(t,e)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:e}=this.fnTypes;return this._getResource(t,e)}_getResource(t,e){return e&&(t=e(this.options.zoom,this.feature.properties)),t}}function pt$4(t,e,n,r){const i=Math.abs(r)>>15,s=i>>1,a=i%2;let o=r%Math.pow(2,15);const l=e+(s<<14)*Math.sign(e),h=n+(a<<14)*Math.sign(n);return t[0]=l,t[1]=h,o=Math.round(o),t[2]=0===o?r<0?-1:0:o,t}const ft$4=Math.pow(2,14),dt$4=Math.pow(2,15);
/*!
	 * a compact version of mapbox-gl-style-spec
	 * based on mapbox-gl-style-spec@13.28.0
	 * https://github.com/mapbox/mapbox-gl-js/tree/main/src/style-spec
	 * LICENSE : ISC
	 */var yt$4,mt$4,gt$4="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},xt$4={exports:{}};function vt$4(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}
/*! https://mths.be/punycode v1.3.2 by @mathias */yt$4=xt$4,mt$4=xt$4.exports,function(t){var e=mt$4&&!mt$4.nodeType&&mt$4,n=yt$4&&!yt$4.nodeType&&yt$4,r="object"==typeof gt$4&&gt$4;r.global!==r&&r.window!==r&&r.self!==r||(t=r);var i,s,a=2147483647,o=/^xn--/,l=/[^\x20-\x7E]/,h=/[\x2E\u3002\uFF0E\uFF61]/g,u={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=Math.floor,p=String.fromCharCode;function f(t){throw RangeError(u[t])}function d(t,e){for(var n=t.length,r=[];n--;)r[n]=e(t[n]);return r}function y(t,e){var n=t.split("@"),r="";return n.length>1&&(r=n[0]+"@",t=n[1]),r+d((t=t.replace(h,".")).split("."),e).join(".")}function m(t){for(var e,n,r=[],i=0,s=t.length;i<s;)(e=t.charCodeAt(i++))>=55296&&e<=56319&&i<s?56320==(64512&(n=t.charCodeAt(i++)))?r.push(((1023&e)<<10)+(1023&n)+65536):(r.push(e),i--):r.push(e);return r}function g(t){return d(t,(function(t){var e="";return t>65535&&(e+=p((t-=65536)>>>10&1023|55296),t=56320|1023&t),e+p(t)})).join("")}function x(t,e){return t+22+75*(t<26)-((0!=e)<<5)}function v(t,e,n){var r=0;for(t=n?c(t/700):t>>1,t+=c(t/e);t>455;r+=36)t=c(t/35);return c(r+36*t/(t+38))}function b(t){var e,n,r,i,s,o,l,h,u,p,d,y=[],m=t.length,x=0,b=128,w=72;for((n=t.lastIndexOf("-"))<0&&(n=0),r=0;r<n;++r)t.charCodeAt(r)>=128&&f("not-basic"),y.push(t.charCodeAt(r));for(i=n>0?n+1:0;i<m;){for(s=x,o=1,l=36;i>=m&&f("invalid-input"),((h=(d=t.charCodeAt(i++))-48<10?d-22:d-65<26?d-65:d-97<26?d-97:36)>=36||h>c((a-x)/o))&&f("overflow"),x+=h*o,!(h<(u=l<=w?1:l>=w+26?26:l-w));l+=36)o>c(a/(p=36-u))&&f("overflow"),o*=p;w=v(x-s,e=y.length+1,0==s),c(x/e)>a-b&&f("overflow"),b+=c(x/e),x%=e,y.splice(x++,0,b)}return g(y)}function w(t){var e,n,r,i,s,o,l,h,u,d,y,g,b,w,k,A=[];for(g=(t=m(t)).length,e=128,n=0,s=72,o=0;o<g;++o)(y=t[o])<128&&A.push(p(y));for(r=i=A.length,i&&A.push("-");r<g;){for(l=a,o=0;o<g;++o)(y=t[o])>=e&&y<l&&(l=y);for(l-e>c((a-n)/(b=r+1))&&f("overflow"),n+=(l-e)*b,e=l,o=0;o<g;++o)if((y=t[o])<e&&++n>a&&f("overflow"),y==e){for(h=n,u=36;!(h<(d=u<=s?1:u>=s+26?26:u-s));u+=36)A.push(p(x(d+(k=h-d)%(w=36-d),0))),h=c(k/w);A.push(p(x(h,0))),s=v(n,b,r==i),n=0,++r}++n,++e}return A.join("")}if(i={version:"1.3.2",ucs2:{decode:m,encode:g},decode:b,encode:w,toASCII:function(t){return y(t,(function(t){return l.test(t)?"xn--"+w(t):t}))},toUnicode:function(t){return y(t,(function(t){return o.test(t)?b(t.slice(4).toLowerCase()):t}))}},e&&n)if(yt$4.exports==e)n.exports=i;else for(s in i)i.hasOwnProperty(s)&&(e[s]=i[s]);else t.punycode=i}(gt$4);class bt$4 extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}var wt$4=bt$4;class kt$4{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[t,n]of e)this.bindings[t]=n}concat(t){return new kt$4(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var At$4=kt$4;const _t$4={kind:"null"},Ft$4={kind:"number"},Pt$4={kind:"string"},zt$3={kind:"boolean"},Mt$4={kind:"color"},Tt$4={kind:"object"},St$4={kind:"value"},Ct$4={kind:"collator"},Dt$4={kind:"formatted"},It$4={kind:"resolvedImage"};function Et$4(t,e){return{kind:"array",itemType:t,N:e}}function Ot$4(t){if("array"===t.kind){const e=Ot$4(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Lt$4=[_t$4,Ft$4,Pt$4,zt$3,Mt$4,Dt$4,Tt$4,Et$4(St$4),It$4];function Rt$4(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Rt$4(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of Lt$4)if(!Rt$4(t,e))return null}return`Expected ${Ot$4(t)} but found ${Ot$4(e)} instead.`}function Wt$3(t,e){return e.some((e=>e.kind===t.kind))}function Vt$3(t,e){return e.some((e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t))}var Ut$3,$t$3={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Nt$4(t){return(t=Math.round(t))<0?0:t>255?255:t}function jt$3(t){return Nt$4("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function qt$3(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function Gt$3(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Ut$3={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in $t$3)return $t$3[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var r=n.indexOf("("),i=n.indexOf(")");if(-1!==r&&i+1===n.length){var s=n.substr(0,r),a=n.substr(r+1,i-(r+1)).split(","),o=1;switch(s){case"rgba":if(4!==a.length)return null;o=qt$3(a.pop());case"rgb":return 3!==a.length?null:[jt$3(a[0]),jt$3(a[1]),jt$3(a[2]),o];case"hsla":if(4!==a.length)return null;o=qt$3(a.pop());case"hsl":if(3!==a.length)return null;var l=(parseFloat(a[0])%360+360)%360/360,h=qt$3(a[1]),u=qt$3(a[2]),c=u<=.5?u*(h+1):u+h-u*h,p=2*u-c;return[Nt$4(255*Gt$3(p,c,l+1/3)),Nt$4(255*Gt$3(p,c,l)),Nt$4(255*Gt$3(p,c,l-1/3)),o];default:return null}}return null}}catch(t){}class Xt$3{constructor(t,e,n,r=1){this.r=t,this.g=e,this.b=n,this.a=r}static parse(t){if(!t)return;if(t instanceof Xt$3)return t;if("string"!=typeof t)return;const e=Ut$3(t);return e?new Xt$3(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${r})`}toArray(){const{r:t,g:e,b:n,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*n/r,r]}toArray01(){const{r:t,g:e,b:n,a:r}=this;return 0===r?[0,0,0,0]:[t/r,e/r,n/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:e,b:n,a:r}=this;return[t,e,n,r]}}Xt$3.black=new Xt$3(0,0,0,1),Xt$3.white=new Xt$3(1,1,1,1),Xt$3.transparent=new Xt$3(0,0,0,0),Xt$3.red=new Xt$3(1,0,0,1),Xt$3.blue=new Xt$3(0,0,1,1);var Bt$4=Xt$3;class Jt$3{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Zt$3{constructor(t,e,n,r,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i}}class Yt$3{constructor(t){this.sections=t}static fromString(t){return new Yt$3([new Zt$3(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((t=>0!==t.text.length||t.image&&0!==t.image.name.length))}static factory(t){return t instanceof Yt$3?t:Yt$3.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class Kt$3{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new Kt$3({name:t,available:!1}):null}serialize(){return["image",this.name]}}function Qt$3(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function te$3(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof Bt$4)return!0;if(t instanceof Jt$3)return!0;if(t instanceof Yt$3)return!0;if(t instanceof Kt$3)return!0;if(Array.isArray(t)){for(const e of t)if(!te$3(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!te$3(t[e]))return!1;return!0}return!1}function ee$3(t){if(null===t)return _t$4;if("string"==typeof t)return Pt$4;if("boolean"==typeof t)return zt$3;if("number"==typeof t)return Ft$4;if(t instanceof Bt$4)return Mt$4;if(t instanceof Jt$3)return Ct$4;if(t instanceof Yt$3)return Dt$4;if(t instanceof Kt$3)return It$4;if(Array.isArray(t)){const e=t.length;let n;for(const e of t){const t=ee$3(e);if(n){if(n===t)continue;n=St$4;break}n=t}return Et$4(n||St$4,e)}return Tt$4}function ne$3(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Bt$4||t instanceof Yt$3||t instanceof Kt$3?t.toString():JSON.stringify(t)}class re$3{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!te$3(t[1]))return e.error("invalid value");const n=t[1];let r=ee$3(n);const i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new re$3(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Bt$4?["rgba"].concat(this.value.toArray()):this.value instanceof Yt$3?this.value.serialize():this.value}}var ie$3=re$3,se$3=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ae$3={string:Pt$4,number:Ft$4,boolean:zt$3,object:Tt$4};class oe$3{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,r=1;const i=t[0];if("array"===i){let i,s;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in ae$3)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=ae$3[n],r++}else i=St$4;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);s=t[2],r++}n=Et$4(i,s)}else n=ae$3[i];const s=[];for(;r<t.length;r++){const n=e.parse(t[r],r,St$4);if(!n)return null;s.push(n)}return new oe$3(n,s)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!Rt$4(this.type,ee$3(n)))return n;if(e===this.args.length-1)throw new se$3(`Expected value to be of type ${Ot$4(this.type)}, but found ${Ot$4(ee$3(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((t=>t.serialize())))}}var le$3=oe$3;class he$3{constructor(t){this.type=Dt$4,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const r=[];let i=!1;for(let n=1;n<=t.length-1;++n){const s=t[n];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let t=null;if(s["font-scale"]&&(t=e.parse(s["font-scale"],1,Ft$4),!t))return null;let n=null;if(s["text-font"]&&(n=e.parse(s["text-font"],1,Et$4(Pt$4)),!n))return null;let a=null;if(s["text-color"]&&(a=e.parse(s["text-color"],1,Mt$4),!a))return null;const o=r[r.length-1];o.scale=t,o.font=n,o.textColor=a}else{const s=e.parse(t[n],1,St$4);if(!s)return null;const a=s.type.kind;if("string"!==a&&"value"!==a&&"null"!==a&&"resolvedImage"!==a)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:s,scale:null,font:null,textColor:null})}}return new he$3(r)}evaluate(t){return new Yt$3(this.sections.map((e=>{const n=e.content.evaluate(t);return ee$3(n)===It$4?new Zt$3("",n,null,null,null):new Zt$3(ne$3(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class ue$3{constructor(t){this.type=It$4,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Pt$4);return n?new ue$3(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=Kt$3.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const ce$3={"to-boolean":zt$3,"to-color":Mt$4,"to-number":Ft$4,"to-string":Pt$4};class pe$3{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const r=ce$3[n],i=[];for(let n=1;n<t.length;n++){const r=e.parse(t[n],n,St$4);if(!r)return null;i.push(r)}return new pe$3(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const r of this.args){if(e=r.evaluate(t),n=null,e instanceof Bt$4)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:Qt$3(e[0],e[1],e[2],e[3]),!n))return new Bt$4(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new se$3(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new se$3(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?Yt$3.fromString(ne$3(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?Kt$3.fromString(ne$3(this.args[0].evaluate(t))):ne$3(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new he$3([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ue$3(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild((e=>{t.push(e.serialize())})),t}}var fe$3=pe$3;const de$3=["Unknown","Point","LineString","Polygon"];var ye$3=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?de$3[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Bt$4.parse(t)),e}};class me$3{constructor(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,e){const n=t[0],r=me$3.definitions[n];if(!r)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,s=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,a=s.filter((([e])=>!Array.isArray(e)||e.length===t.length-1));let o=null;for(const[r,s]of a){o=new Ne$3(e.registry,e.path,null,e.scope);const a=[];let l=!1;for(let e=1;e<t.length;e++){const n=t[e],i=Array.isArray(r)?r[e-1]:r.type,s=o.parse(n,1+a.length,i);if(!s){l=!0;break}a.push(s)}if(!l)if(Array.isArray(r)&&r.length!==a.length)o.error(`Expected ${r.length} arguments, but found ${a.length} instead.`);else{for(let t=0;t<a.length;t++){const e=Array.isArray(r)?r[t]:r.type,n=a[t];o.concat(t+1).checkSubtype(e,n.type)}if(0===o.errors.length)return new me$3(n,i,s,a)}}if(1===a.length)e.errors.push(...o.errors);else{const n=(a.length?a:s).map((([t])=>{return e=t,Array.isArray(e)?`(${e.map(Ot$4).join(", ")})`:`(${Ot$4(e.type)}...)`;var e})).join(" | "),r=[];for(let n=1;n<t.length;n++){const i=e.parse(t[n],1+r.length);if(!i)return null;r.push(Ot$4(i.type))}e.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){me$3.definitions=e;for(const n in e)t[n]=me$3}}var ge$3=me$3;class xe$3{constructor(t,e,n){this.type=Ct$4,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,zt$3);if(!r)return null;const i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,zt$3);if(!i)return null;let s=null;return n.locale&&(s=e.parse(n.locale,1,Pt$4),!s)?null:new xe$3(r,i,s)}evaluate(t){return new Jt$3(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function ve$3(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function be$3(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function we$3(t,e){const n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function ke$3(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],s=t[0]-n[0],a=t[1]-n[1];return r*a-s*i==0&&r*s<=0&&i*a<=0}function Ae$3(t,e){let n=!1;for(let a=0,o=e.length;a<o;a++){const o=e[a];for(let e=0,a=o.length;e<a-1;e++){if(ke$3(t,o[e],o[e+1]))return!1;(i=o[e])[1]>(r=t)[1]!=(s=o[e+1])[1]>r[1]&&r[0]<(s[0]-i[0])*(r[1]-i[1])/(s[1]-i[1])+i[0]&&(n=!n)}}var r,i,s;return n}function _e$3(t,e){for(let n=0;n<e.length;n++)if(Ae$3(t,e[n]))return!0;return!1}function Fe$3(t,e,n,r){const i=r[0]-n[0],s=r[1]-n[1],a=(t[0]-n[0])*s-i*(t[1]-n[1]),o=(e[0]-n[0])*s-i*(e[1]-n[1]);return a>0&&o<0||a<0&&o>0}function Pe$3(t,e,n){for(const h of n)for(let n=0;n<h.length-1;++n)if(void 0,void 0,0!=(o=[(a=h[n+1])[0]-(s=h[n])[0],a[1]-s[1]])[0]*(l=[(i=e)[0]-(r=t)[0],i[1]-r[1]])[1]-o[1]*l[0]&&Fe$3(r,i,s,a)&&Fe$3(s,a,r,i))return!0;var r,i,s,a,o,l;return!1}function ze$3(t,e){for(let n=0;n<t.length;++n)if(!Ae$3(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Pe$3(t[n],t[n+1],e))return!1;return!0}function Me$3(t,e){for(let n=0;n<e.length;n++)if(ze$3(t,e[n]))return!0;return!1}function Te$3(t,e,n){const r=[];for(let i=0;i<t.length;i++){const s=[];for(let r=0;r<t[i].length;r++){const a=we$3(t[i][r],n);ve$3(e,a),s.push(a)}r.push(s)}return r}function Se$3(t,e,n){const r=[];for(let i=0;i<t.length;i++){const s=Te$3(t[i],e,n);r.push(s)}return r}function Ce$3(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const e=.5*r;let i=t[0]-n[0]>e?-r:n[0]-t[0]>e?r:0;0===i&&(i=t[0]-n[2]>e?-r:n[2]-t[0]>e?r:0),t[0]+=i}ve$3(e,t)}function De$3(t,e,n,r){const i=8192*Math.pow(2,r.z),s=[8192*r.x,8192*r.y],a=[];if(!t)return a;for(const r of t)for(const t of r){const r=[t.x+s[0],t.y+s[1]];Ce$3(r,e,n,i),a.push(r)}return a}function Ie$3(t,e,n,r){const i=8192*Math.pow(2,r.z),s=[8192*r.x,8192*r.y],a=[];if(!t)return a;for(const n of t){const t=[];for(const r of n){const n=[r.x+s[0],r.y+s[1]];ve$3(e,n),t.push(n)}a.push(t)}if(e[2]-e[0]<=i/2){(o=e)[0]=o[1]=1/0,o[2]=o[3]=-1/0;for(const t of a)for(const r of t)Ce$3(r,e,n,i)}var o;return a}class Ee$3{constructor(t,e){this.type=zt$3,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(te$3(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new Ee$3(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new Ee$3(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new Ee$3(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){const s=Te$3(e.coordinates,r,i),a=De$3(t.geometry(),n,r,i);if(!be$3(n,r))return!1;for(const t of a)if(!Ae$3(t,s))return!1}if("MultiPolygon"===e.type){const s=Se$3(e.coordinates,r,i),a=De$3(t.geometry(),n,r,i);if(!be$3(n,r))return!1;for(const t of a)if(!_e$3(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){const s=Te$3(e.coordinates,r,i),a=Ie$3(t.geometry(),n,r,i);if(!be$3(n,r))return!1;for(const t of a)if(!ze$3(t,s))return!1}if("MultiPolygon"===e.type){const s=Se$3(e.coordinates,r,i),a=Ie$3(t.geometry(),n,r,i);if(!be$3(n,r))return!1;for(const t of a)if(!Me$3(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Oe$3=Ee$3;function Le$3(t){if(t instanceof ge$3){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof Oe$3)return!1;let e=!0;return t.eachChild((t=>{e&&!Le$3(t)&&(e=!1)})),e}function Re$3(t){if(t instanceof ge$3&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild((t=>{e&&!Re$3(t)&&(e=!1)})),e}function We$3(t,e){if(t instanceof ge$3&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild((t=>{n&&!We$3(t,e)&&(n=!1)})),n}class Ve$3{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Ve$3(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Ue$3=Ve$3;class $e$3{constructor(t,e=[],n,r=new At$4,i=[]){this.registry=t,this.path=e,this.key=e.map((t=>`[${t}]`)).join(""),this.scope=r,this.errors=i,this.expectedType=n}parse(t,e,n,r,i={}){return e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)}_parse(t,e){function n(t,e,n){return"assert"===n?new le$3(e,[t]):"coerce"===n?new fe$3(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"coerce");else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof ie$3)&&"resolvedImage"!==r.type.kind&&function t(e){if(e instanceof Ue$3)return t(e.boundExpression);if(e instanceof ge$3&&"error"===e.name)return!1;if(e instanceof xe$3)return!1;if(e instanceof Oe$3)return!1;const n=e instanceof fe$3||e instanceof le$3;let r=!0;return e.eachChild((e=>{r=n?r&&t(e):r&&e instanceof ie$3})),!!r&&(Le$3(e)&&We$3(e,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(r)){const t=new ye$3;try{r=new ie$3(r.type,r.evaluate(t))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new $e$3(this.registry,r,e||null,i,this.errors)}error(t,...e){const n=`${this.key}${e.map((t=>`[${t}]`)).join("")}`;this.errors.push(new wt$4(n,t))}checkSubtype(t,e){const n=Rt$4(t,e);return n&&this.error(n),n}}var Ne$3=$e$3;function He$3(t,e){const n=t.length-1;let r,i,s=0,a=n,o=0;for(;s<=a;)if(o=Math.floor((s+a)/2),r=t[o],i=t[o+1],r<=e){if(o===n||e<i)return o;s=o+1}else{if(!(r>e))throw new se$3("Input is not a number.");a=o-1}return 0}class je$3{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[t,e]of n)this.labels.push(t),this.outputs.push(e)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Ft$4);if(!n)return null;const r=[];let i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(let n=1;n<t.length;n+=2){const s=1===n?-1/0:t[n],a=t[n+1],o=n,l=n+1;if("number"!=typeof s)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',o);if(r.length&&r[r.length-1][0]>=s)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',o);const h=e.parse(a,l,i);if(!h)return null;i=i||h.type,r.push([s,h])}return new je$3(i,n,r)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[He$3(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}var qe$3=je$3,Ge$3=Xe$3;function Xe$3(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=r}function Be$3(t,e,n){return t*(1-n)+e*n}Xe$3.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,r=0;r<8;r++){var i=this.sampleCurveX(n)-t;if(Math.abs(i)<e)return n;var s=this.sampleCurveDerivativeX(n);if(Math.abs(s)<1e-6)break;n-=i/s}var a=0,o=1;for(n=t,r=0;r<20&&(i=this.sampleCurveX(n),!(Math.abs(i-t)<e));r++)t>i?a=n:o=n,n=.5*(o-a)+a;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var Je$3=Object.freeze({__proto__:null,number:Be$3,color:function(t,e,n){return new Bt$4(Be$3(t.r,e.r,n),Be$3(t.g,e.g,n),Be$3(t.b,e.b,n),Be$3(t.a,e.a,n))},array:function(t,e,n){return t.map(((t,r)=>Be$3(t,e[r],n)))}});const Ze$3=6/29,Ye$3=3*Ze$3*Ze$3,Ke$3=Math.PI/180,Qe$3=180/Math.PI;function tn$3(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ye$3+4/29}function en$3(t){return t>Ze$3?t*t*t:Ye$3*(t-4/29)}function nn$3(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function rn$3(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function sn$3(t){const e=rn$3(t.r),n=rn$3(t.g),r=rn$3(t.b),i=tn$3((.4124564*e+.3575761*n+.1804375*r)/.95047),s=tn$3((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-tn$3((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function an$3(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*en$3(e),n=.95047*en$3(n),r=1.08883*en$3(r),new Bt$4(nn$3(3.2404542*n-1.5371385*e-.4985314*r),nn$3(-.969266*n+1.8760108*e+.041556*r),nn$3(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function on$3(t,e,n){const r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const ln$3={forward:sn$3,reverse:an$3,interpolate:function(t,e,n){return{l:Be$3(t.l,e.l,n),a:Be$3(t.a,e.a,n),b:Be$3(t.b,e.b,n),alpha:Be$3(t.alpha,e.alpha,n)}}},hn$3={forward:function(t){const{l:e,a:n,b:r}=sn$3(t),i=Math.atan2(r,n)*Qe$3;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*Ke$3,n=t.c;return an$3({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:on$3(t.h,e.h,n),c:Be$3(t.c,e.c,n),l:Be$3(t.l,e.l,n),alpha:Be$3(t.alpha,e.alpha,n)}}};var un$3=Object.freeze({__proto__:null,lab:ln$3,hcl:hn$3});class cn$3{constructor(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[t,e]of i)this.labels.push(t),this.outputs.push(e)}static interpolationFactor(t,e,n,r){let i=0;if("exponential"===t.name)i=pn$3(e,t.base,n,r);else if("linear"===t.name)i=pn$3(e,1,n,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;i=new Ge$3(s[0],s[1],s[2],s[3]).solve(pn$3(e,1,n,r))}return i}static parse(t,e){let[n,r,i,...s]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);{const t=r.slice(1);if(4!==t.length||t.some((t=>"number"!=typeof t||t<0||t>1)))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,Ft$4),!i)return null;const a=[];let o=null;"interpolate-hcl"===n||"interpolate-lab"===n?o=Mt$4:e.expectedType&&"value"!==e.expectedType.kind&&(o=e.expectedType);for(let t=0;t<s.length;t+=2){const n=s[t],r=s[t+1],i=t+3,l=t+4;if("number"!=typeof n)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',i);if(a.length&&a[a.length-1][0]>=n)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',i);const h=e.parse(r,l,o);if(!h)return null;o=o||h.type,a.push([n,h])}return"number"===o.kind||"color"===o.kind||"array"===o.kind&&"number"===o.itemType.kind&&"number"==typeof o.N?new cn$3(o,n,r,i,a):e.error(`Type ${Ot$4(o)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);const s=He$3(e,r),a=cn$3.interpolationFactor(this.interpolation,r,e[s],e[s+1]),o=n[s].evaluate(t),l=n[s+1].evaluate(t);return"interpolate"===this.operator?Je$3[this.type.kind.toLowerCase()](o,l,a):"interpolate-hcl"===this.operator?hn$3.reverse(hn$3.interpolate(hn$3.forward(o),hn$3.forward(l),a)):ln$3.reverse(ln$3.interpolate(ln$3.forward(o),ln$3.forward(l),a))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)e.push(this.labels[t],this.outputs[t].serialize());return e}}function pn$3(t,e,n,r){const i=r-n,s=t-n;return 0===i?0:1===e?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}var fn$3=cn$3;class dn$3{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const r=e.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const r of t.slice(1)){const t=e.parse(r,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,i.push(t)}const s=r&&i.some((t=>Rt$4(r,t.type)));return new dn$3(s?St$4:n,i)}evaluate(t){let e,n=null,r=0;for(const i of this.args){if(r++,n=i.evaluate(t),n&&n instanceof Kt$3&&!n.available&&(e||(e=n),n=null,r===this.args.length))return e;if(null!==n)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var yn$3=dn$3;class mn$3{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return e.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);const s=e.parse(t[r+1],r+1);if(!s)return null;n.push([i,s])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return r?new mn$3(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}var gn$3=mn$3;class xn$3{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Ft$4),r=e.parse(t[2],2,Et$4(e.expectedType||St$4));return n&&r?new xn$3(r.type.itemType,n,r):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new se$3(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new se$3(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new se$3(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var vn$3=xn$3;class bn$3{constructor(t,e){this.type=zt$3,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,St$4),r=e.parse(t[2],2,St$4);return n&&r?Wt$3(n.type,[zt$3,Pt$4,Ft$4,_t$4,St$4])?new bn$3(n,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot$4(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(null==n)return!1;if(!Vt$3(e,["boolean","string","number","null"]))throw new se$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ot$4(ee$3(e))} instead.`);if(!Vt$3(n,["string","array"]))throw new se$3(`Expected second argument to be of type array or string, but found ${Ot$4(ee$3(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var wn$3=bn$3;class kn$3{constructor(t,e,n){this.type=Ft$4,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,St$4),r=e.parse(t[2],2,St$4);if(!n||!r)return null;if(!Wt$3(n.type,[zt$3,Pt$4,Ft$4,_t$4,St$4]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${Ot$4(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ft$4);return i?new kn$3(n,r,i):null}return new kn$3(n,r)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!Vt$3(e,["boolean","string","number","null"]))throw new se$3(`Expected first argument to be of type boolean, string, number or null, but found ${Ot$4(ee$3(e))} instead.`);if(!Vt$3(n,["string","array"]))throw new se$3(`Expected second argument to be of type array or string, but found ${Ot$4(ee$3(n))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var An$3=kn$3;class _n$3{constructor(t,e,n,r,i,s){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=s}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const i={},s=[];for(let a=2;a<t.length-1;a+=2){let o=t[a];const l=t[a+1];Array.isArray(o)||(o=[o]);const h=e.concat(a);if(0===o.length)return h.error("Expected at least one branch label.");for(const t of o){if("number"!=typeof t&&"string"!=typeof t)return h.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return h.error("Numeric branch labels must be integer values.");if(n){if(h.checkSubtype(n,ee$3(t)))return null}else n=ee$3(t);if(void 0!==i[String(t)])return h.error("Branch labels must be unique.");i[String(t)]=s.length}const u=e.parse(l,a,r);if(!u)return null;r=r||u.type,s.push(u)}const a=e.parse(t[1],1,St$4);if(!a)return null;const o=e.parse(t[t.length-1],t.length-1,r);return o?"value"!==a.type.kind&&e.concat(1).checkSubtype(n,a.type)?null:new _n$3(n,r,a,i,s,o):null}evaluate(t){const e=this.input.evaluate(t);return(ee$3(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],r={};for(const t of e){const e=r[this.cases[t]];void 0===e?(r[this.cases[t]]=n.length,n.push([this.cases[t],[t]])):n[e][1].push(t)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[e,r]of n)t.push(1===r.length?i(r[0]):r.map(i)),t.push(this.outputs[e].serialize());return t.push(this.otherwise.serialize()),t}}var Fn$3=_n$3;class Pn$3{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r=[];for(let i=1;i<t.length-1;i+=2){const s=e.parse(t[i],i,zt$3);if(!s)return null;const a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([s,a]),n=n||a.type}const i=e.parse(t[t.length-1],t.length-1,n);return i?new Pn$3(n,r,i):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every((([t,e])=>e.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((e=>{t.push(e.serialize())})),t}}var zn$3=Pn$3;class Mn$3{constructor(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,St$4),r=e.parse(t[2],2,Ft$4);if(!n||!r)return null;if(!Wt$3(n.type,[Et$4(St$4),Pt$4,St$4]))return e.error(`Expected first argument to be of type array or string, but found ${Ot$4(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ft$4);return i?new Mn$3(n.type,n,r,i):null}return new Mn$3(n.type,n,r)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!Vt$3(e,["string","array"]))throw new se$3(`Expected first argument to be of type array or string, but found ${Ot$4(ee$3(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Tn$3=Mn$3;function Sn$3(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Cn$3(t,e,n,r){return 0===r.compare(e,n)}function Dn$3(t,e,n){const r="=="!==t&&"!="!==t;return class i{constructor(t,e,n){this.type=zt$3,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let s=e.parse(t[1],1,St$4);if(!s)return null;if(!Sn$3(n,s.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${Ot$4(s.type)}'.`);let a=e.parse(t[2],2,St$4);if(!a)return null;if(!Sn$3(n,a.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${Ot$4(a.type)}'.`);if(s.type.kind!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return e.error(`Cannot compare types '${Ot$4(s.type)}' and '${Ot$4(a.type)}'.`);r&&("value"===s.type.kind&&"value"!==a.type.kind?s=new le$3(a.type,[s]):"value"!==s.type.kind&&"value"===a.type.kind&&(a=new le$3(s.type,[a])));let o=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==a.type.kind&&"value"!==s.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(o=e.parse(t[3],3,Ct$4),!o)return null}return new i(s,a,o)}evaluate(i){const s=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const e=ee$3(s),n=ee$3(a);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new se$3(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=ee$3(s),n=ee$3(a);if("string"!==t.kind||"string"!==n.kind)return e(i,s,a)}return this.collator?n(i,s,a,this.collator.evaluate(i)):e(i,s,a)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild((t=>{e.push(t.serialize())})),e}}}const In$3=Dn$3("==",(function(t,e,n){return e===n}),Cn$3),En$3=Dn$3("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!Cn$3(0,e,n,r)})),On$3=Dn$3("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),Ln$3=Dn$3(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),Rn$3=Dn$3("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),Wn$3=Dn$3(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0}));class Vn$3{constructor(t,e,n,r,i,s){this.type=Pt$4,this.number=t,this.locale=e,this.currency=n,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ft$4);if(!n)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=e.parse(r.locale,1,Pt$4),!i))return null;let s=null;if(r.currency&&(s=e.parse(r.currency,1,Pt$4),!s))return null;let a=null;if(r.unit&&(a=e.parse(r.unit,1,Pt$4),!a))return null;let o=null;if(r["min-fraction-digits"]&&(o=e.parse(r["min-fraction-digits"],1,Ft$4),!o))return null;let l=null;return r["max-fraction-digits"]&&(l=e.parse(r["max-fraction-digits"],1,Ft$4),!l)?null:new Vn$3(n,i,s,a,o,l)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Un$3{constructor(t){this.type=Ft$4,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${Ot$4(n.type)} instead.`):new Un$3(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new se$3(`Expected value to be of type string or array, but found ${Ot$4(ee$3(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((e=>{t.push(e.serialize())})),t}}const $n$3={"==":In$3,"!=":En$3,">":Ln$3,"<":On$3,">=":Wn$3,"<=":Rn$3,array:le$3,at:vn$3,boolean:le$3,case:zn$3,coalesce:yn$3,collator:xe$3,format:he$3,image:ue$3,in:wn$3,"index-of":An$3,interpolate:fn$3,"interpolate-hcl":fn$3,"interpolate-lab":fn$3,length:Un$3,let:gn$3,literal:ie$3,match:Fn$3,number:le$3,"number-format":Vn$3,object:le$3,slice:Tn$3,step:qe$3,string:le$3,"to-boolean":fe$3,"to-color":fe$3,"to-number":fe$3,"to-string":fe$3,var:Ue$3,within:Oe$3};function Nn$3(t,[e,n,r,i]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const s=i?i.evaluate(t):1,a=Qt$3(e,n,r,s);if(a)throw new se$3(a);return new Bt$4(e/255*s,n/255*s,r/255*s,s)}function Hn$3(t,e){return t in e}function jn$3(t,e){const n=e[t];return void 0===n?null:n}function qn$3(t){return{type:t}}ge$3.register($n$3,{error:[{kind:"error"},[Pt$4],(t,[e])=>{throw new se$3(e.evaluate(t))}],typeof:[Pt$4,[St$4],(t,[e])=>Ot$4(ee$3(e.evaluate(t)))],"to-rgba":[Et$4(Ft$4,4),[Mt$4],(t,[e])=>e.evaluate(t).toArray()],rgb:[Mt$4,[Ft$4,Ft$4,Ft$4],Nn$3],rgba:[Mt$4,[Ft$4,Ft$4,Ft$4,Ft$4],Nn$3],has:{type:zt$3,overloads:[[[Pt$4],(t,[e])=>Hn$3(e.evaluate(t),t.properties())],[[Pt$4,Tt$4],(t,[e,n])=>Hn$3(e.evaluate(t),n.evaluate(t))]]},get:{type:St$4,overloads:[[[Pt$4],(t,[e])=>jn$3(e.evaluate(t),t.properties())],[[Pt$4,Tt$4],(t,[e,n])=>jn$3(e.evaluate(t),n.evaluate(t))]]},"feature-state":[St$4,[Pt$4],(t,[e])=>jn$3(e.evaluate(t),t.featureState||{})],properties:[Tt$4,[],t=>t.properties()],"geometry-type":[Pt$4,[],t=>t.geometryType()],id:[St$4,[],t=>t.id()],zoom:[Ft$4,[],t=>t.globals.zoom],pitch:[Ft$4,[],t=>t.globals.pitch||0],"distance-from-center":[Ft$4,[],t=>t.distanceFromCenter()],"heatmap-density":[Ft$4,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ft$4,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ft$4,[],t=>t.globals.skyRadialProgress||0],accumulated:[St$4,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ft$4,qn$3(Ft$4),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[Ft$4,qn$3(Ft$4),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:Ft$4,overloads:[[[Ft$4,Ft$4],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Ft$4],(t,[e])=>-e.evaluate(t)]]},"/":[Ft$4,[Ft$4,Ft$4],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Ft$4,[Ft$4,Ft$4],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Ft$4,[],()=>Math.LN2],pi:[Ft$4,[],()=>Math.PI],e:[Ft$4,[],()=>Math.E],"^":[Ft$4,[Ft$4,Ft$4],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Ft$4,[Ft$4],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ft$4,[Ft$4],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ft$4,[Ft$4],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ft$4,[Ft$4],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ft$4,[Ft$4],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ft$4,[Ft$4],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ft$4,[Ft$4],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ft$4,[Ft$4],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ft$4,[Ft$4],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ft$4,[Ft$4],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ft$4,qn$3(Ft$4),(t,e)=>Math.min(...e.map((e=>e.evaluate(t))))],max:[Ft$4,qn$3(Ft$4),(t,e)=>Math.max(...e.map((e=>e.evaluate(t))))],abs:[Ft$4,[Ft$4],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ft$4,[Ft$4],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ft$4,[Ft$4],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ft$4,[Ft$4],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[zt$3,[Pt$4,St$4],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[zt$3,[St$4],(t,[e])=>t.id()===e.value],"filter-type-==":[zt$3,[Pt$4],(t,[e])=>t.geometryType()===e.value],"filter-<":[zt$3,[Pt$4,St$4],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[zt$3,[St$4],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[zt$3,[Pt$4,St$4],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[zt$3,[St$4],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[zt$3,[Pt$4,St$4],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[zt$3,[St$4],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[zt$3,[Pt$4,St$4],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[zt$3,[St$4],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[zt$3,[St$4],(t,[e])=>e.value in t.properties()],"filter-has-id":[zt$3,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[zt$3,[Et$4(Pt$4)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[zt$3,[Et$4(St$4)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[zt$3,[Pt$4,Et$4(St$4)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[zt$3,[Pt$4,Et$4(St$4)],(t,[e,n])=>function(t,e,n,r){for(;n<=r;){const i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:zt$3,overloads:[[[zt$3,zt$3],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[qn$3(zt$3),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:zt$3,overloads:[[[zt$3,zt$3],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[qn$3(zt$3),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[zt$3,[zt$3],(t,[e])=>!e.evaluate(t)],"is-supported-script":[zt$3,[Pt$4],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Pt$4,[Pt$4],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Pt$4,[Pt$4],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Pt$4,qn$3(St$4),(t,e)=>e.map((e=>ne$3(e.evaluate(t)))).join("")],"resolved-locale":[Pt$4,[Ct$4],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Gn$3=$n$3;function Xn$3(t){return{result:"success",value:t}}function Bn$3(t){return{result:"error",value:t}}function Jn$3(t){return!!t.expression&&t.expression.interpolated}function Zn$3(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function Yn$3(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Kn$3(t){return t}function Qn$3(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function tr$3(t,e,n,r,i){return Qn$3(typeof n===i?r[n]:void 0,t.default,e.default)}function er$3(t,e,n){if("number"!==Zn$3(n))return Qn$3(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const i=He$3(t.stops.map((t=>t[0])),n);return t.stops[i][1]}function nr$3(t,e,n){const r=void 0!==t.base?t.base:1;if("number"!==Zn$3(n))return Qn$3(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const s=He$3(t.stops.map((t=>t[0])),n),a=function(t,e,n,r){const i=r-n,s=t-n;return 0===i?0:1===e?s/i:(Math.pow(e,s)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[s][0],t.stops[s+1][0]),o=t.stops[s][1],l=t.stops[s+1][1];let h=Je$3[e.type]||Kn$3;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=un$3[t.colorSpace];h=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),a))}return"function"==typeof o.evaluate?{evaluate(...t){const e=o.evaluate.apply(void 0,t),n=l.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return h(e,n,a)}}:h(o,l,a)}function rr$3(t,e,n){return"color"===e.type?n=Bt$4.parse(n):"formatted"===e.type?n=Yt$3.fromString(n.toString()):"resolvedImage"===e.type?n=Kt$3.fromString(n.toString()):Zn$3(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),Qn$3(n,t.default,e.default)}class ir$3{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ye$3,this._defaultValue=e?function(t){return"color"===t.type&&(Yn$3(t.default)||Array.isArray(t.default))?new Bt$4(0,0,0,0):"color"===t.type?Bt$4.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,r,i,s,a,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,r,i,s,a,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=a||null,this._evaluator.featureDistanceData=o||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new se$3(`Expected value to be one of ${Object.keys(this._enumValues).map((t=>JSON.stringify(t))).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function sr$3(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Gn$3}function ar$3(t,e){const n=new Ne$3(Gn$3,[],e?function(t){const e={color:Mt$4,string:Pt$4,number:Ft$4,enum:Pt$4,boolean:zt$3,formatted:Dt$4,resolvedImage:It$4};return"array"===t.type?Et$4(e[t.value]||St$4,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Xn$3(new ir$3(r,e)):Bn$3(n.errors)}class or$3{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Re$3(e.expression)}evaluateWithoutErrorHandling(t,e,n,r,i,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,s)}evaluate(t,e,n,r,i,s){return this._styleExpression.evaluate(t,e,n,r,i,s)}}class lr$3{constructor(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Re$3(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,n,r,i,s){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,s)}evaluate(t,e,n,r,i,s){return this._styleExpression.evaluate(t,e,n,r,i,s)}interpolationFactor(t,e,n){return this.interpolationType?fn$3.interpolationFactor(this.interpolationType,t,e,n):0}}function hr$3(t,e){if("error"===(t=ar$3(t,e)).result)return t;const n=t.value.expression,r=Le$3(n);if(!r&&!function(t){return"data-driven"===t["property-type"]}(e))return Bn$3([new wt$4("","data expressions not supported")]);const i=We$3(n,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(e))return Bn$3([new wt$4("","zoom expressions not supported")]);const s=function t(e){let n=null;if(e instanceof gn$3)n=t(e.result);else if(e instanceof yn$3){for(const r of e.args)if(n=t(r),n)break}else(e instanceof qe$3||e instanceof fn$3)&&e.input instanceof ge$3&&"zoom"===e.input.name&&(n=e);return n instanceof wt$4||e.eachChild((e=>{const r=t(e);r instanceof wt$4?n=r:!n&&r?n=new wt$4("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new wt$4("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);if(!s&&!i)return Bn$3([new wt$4("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(s instanceof wt$4)return Bn$3([s]);if(s instanceof fn$3&&!Jn$3(e))return Bn$3([new wt$4("",'"interpolate" expressions cannot be used with this property')]);if(!s)return Xn$3(new or$3(r?"constant":"source",t.value));return Xn$3(new lr$3(r?"camera":"composite",t.value,s.labels,s instanceof fn$3?s.interpolation:void 0))}class ur$3{constructor(t,e){this._parameters=t,this._specification=e,vt$4(this,function t(e,n){const r="color"===n.type,i=e.stops&&"object"==typeof e.stops[0][0],s=i||!(i||void 0!==e.property),a=e.type||(Jn$3(n)?"exponential":"interval");if(r&&((e=vt$4({},e)).stops&&(e.stops=e.stops.map((t=>[t[0],Bt$4.parse(t[1])]))),e.default=Bt$4.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!un$3[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);let o,l,h;if("exponential"===a)o=nr$3;else if("interval"===a)o=er$3;else if("categorical"===a){o=tr$3,l=Object.create(null);for(const t of e.stops)l[t[0]]=t[1];h=typeof e.stops[0][0]}else{if("identity"!==a)throw new Error(`Unknown function type "${a}"`);o=rr$3}if(i){const r={},i=[];for(let t=0;t<e.stops.length;t++){const n=e.stops[t],s=n[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},i.push(s)),r[s].stops.push([n[0].value,n[1]])}const s=[];for(const e of i)s.push([r[e].zoom,t(r[e],n)]);const a={name:"linear"};return{kind:"composite",interpolationType:a,interpolationFactor:fn$3.interpolationFactor.bind(void 0,a),zoomStops:s.map((t=>t[0])),evaluate:({zoom:t},r)=>nr$3({stops:s,base:e.base},n,t).evaluate(t,r)}}if(s){const t="exponential"===a?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:fn$3.interpolationFactor.bind(void 0,t),zoomStops:e.stops.map((t=>t[0])),evaluate:({zoom:t})=>o(e,n,t,l,h)}}return{kind:"source",evaluate(t,r){const i=r&&r.properties?r.properties[e.property]:void 0;return void 0===i?Qn$3(e.default,n.default):o(e,n,i,l,h)}}}(this._parameters,this._specification))}static deserialize(t){return new ur$3(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function cr$3(t){if(Array.isArray(t))return t.map(cr$3);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=cr$3(t[n]);return e}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function fr$3(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let e=1;e<t.length;e++)if(fr$3(t[e]))return!0;return!1}const dr$3=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]),yr$3={StyleExpression:ir$3,isExpression:sr$3,isExpressionFilter:function t(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const n of e.slice(1))if(!t(n)&&"boolean"!=typeof n)return!1;return!0;default:return!0}},createExpression:ar$3,createPropertyExpression:hr$3,normalizePropertyExpression:function(t,e){if(Yn$3(t))return new ur$3(t,e);if(sr$3(t)){const n=hr$3(t,e);if("error"===n.result)throw new Error(n.value.map((t=>`${t.key}: ${t.message}`)).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=Bt$4.parse(t)),{kind:"constant",evaluate:()=>n}}},ZoomConstantExpression:or$3,ZoomDependentExpression:lr$3,StylePropertyFunction:ur$3},{isExpression:mr$3,createExpression:gr$3}=yr$3,xr$3={};function vr$3(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const e=t.condition,n=[];for(let t=0;t<e.length;t++)n.push(vr$3(e[t]));return(t,e)=>{for(let r=0;r<n.length;r++)if(n[r](t,e))return!0;return!1}}const e=vr$3(t.condition);if($$4(t.layer))return e;const n=e=>e.layer===t.layer;return(t,r)=>n(t)&&e(t,r)}if(isFeatureFilter(t))return createFilter(t);{let e=function(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const n=t;let r=!0;try{r=function(t){if(!fr$3(t))return t;let e=cr$3(t);return function t(e){let n=!1;const r=[];if("case"===e[0]){for(let t=1;t<e.length-1;t+=2)n=n||fr$3(e[t]),r.push(e[t+1]);r.push(e[e.length-1])}else if("match"===e[0]){n=n||fr$3(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){n=n||fr$3(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}n&&(e.length=0,e.push("any",...r));for(let n=1;n<e.length;n++)t(e[n])}(e),e=function t(e){if(!Array.isArray(e))return e;const n=function(t){if(dr$3.has(t[0]))for(let e=1;e<t.length;e++)if(fr$3(t[e]))return!0;return t}(e);return!0===n?n:n.map((e=>t(e)))}(e),e}(n)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const i=ar$3(r,null);let s=null;if("error"===i.result)throw new Error(i.value.map((t=>`${t.key}: ${t.message}`)).join(", "));s=(t,e,n)=>i.value.evaluate(t,e,{},n);let a=null,o=null;if(r!==n){const t=ar$3(n,null);if("error"===t.result)throw new Error(t.value.map((t=>`${t.key}: ${t.message}`)).join(", "));a=(e,n,r,i,s)=>t.value.evaluate(e,n,{},r,void 0,void 0,i,s),o=!Le$3(t.value.expression)}return{filter:s,dynamicFilter:a||void 0,needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(let n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(r),needFeature:!!o}}(t);return e=e&&e.filter,(t,n)=>(xr$3.zoom=n,e&&e(xr$3,t))}}const br$3={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function wr$3(t,e){br$3.type=e||"number";const n=gr$3(t,br$3);if("success"!==n.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(t)} (${n.value})`);return n.value}function kr$3(t){return mr$3(t)}const Ar$3={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function _r$3(t){return Ar$3[t]}const Fr$3={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},Pr$3={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function zr$3(t){return Fr$3[t]?"string":_r$3(t)?"number":Pr$3[t]?"array":"color"}var Mr$3=Object.freeze({__proto__:null,compileStyle:function(t=[]){return function t(e){if(!Array.isArray(e))return t([e]);const n=[];for(let t=0;t<e.length;t++){let r;r=!0===e[t].filter?function(){return!0}:vr$3(e[t].filter),n.push(U$4({},e[t],{filter:r}))}return n}(t=t.map((t=>{const e=U$4({},t);return e.filter&&e.filter.value&&(e.filter=e.filter.value),e})))},compileFilter:vr$3,createExpression:wr$3,isExpression:kr$3,isInterpolated:_r$3,getExpressionType:zr$3});const Tr$3="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;class Sr$3 extends Array{push(...t){const e=t.length;for(let n=0;n<e;n++)this[this._index++]=t[n]}fill(t,e,n){super.fill(t,e,n),n>this._index&&(this._index=n)}set(t,e){t>=this._index&&(this._index=t+1),this[t]=e}getLength(){return this._index}setLength(t){this._index=t,super.length<t&&(super.length=t)}trySetLength(t){t>this._index&&this.setLength(t)}reset(){this._index=0}}const Cr$3={get:function(t,e){return"length"===e?t.getLength():t[e]}};class Dr$3 extends Array{setLength(t){super.length=t}trySetLength(t){super.length=t}}let Ir$3;class Er$3{static createTypedArray(t,e){return W$4(t,e)}static getInstance(){return Ir$3}constructor(){this._arrays=[],this._index=0}get(){if(!Tr$3)return new Dr$3;const t=this._arrays[this._index]=this._arrays[this._index]||new Proxy(new Sr$3,Cr$3);return t.reset(),this._index++,t}reset(){this._index=0}}Ir$3=new Er$3;const Or$3=[],Lr$3={},Rr$3={},Wr$3={},Vr$3=[],Ur$3=Er$3.getInstance();class $r$3{static isAtlasLoaded(t,e={}){const{iconAtlas:n}=e;return!!(!t||n&&n.positions[t])}static genFnTypes(t){const e={};for(const n in t)if(kr$3(t[n])){const r=(n+"_Fn_0").trim(),i=(n+"Fn").trim(),s=zr$3(n);e[r]=wr$3(t[n],s),e[i]=(t,n)=>{let i;Lr$3.zoom=t,Rr$3.properties=n;try{i=e[r].evaluateWithoutErrorHandling(Lr$3,Rr$3,Wr$3,null,Vr$3)}catch(t){return null}return i}}else if(J$5(t[n])){const s=(n+"_Fn_0").trim(),a=(n+"Fn").trim();_r$3(n)?(e[s]=interpolated(t[n]),e[a]=(t,n)=>{const i=e[s](t,n);return J$5(i)?interpolated(i)(t,n):i}):(e[s]=piecewiseConstant(t[n]),e[a]=(t,n)=>{const r=e[s](t,n);return J$5(r)?piecewiseConstant(r)(t,n):r})}return e}constructor(t,e,n){this.options=n;const i=[];this.symbolDef=e,this.symbol=loadFunctionTypes(e,(()=>(i[0]=n.zoom,i))),this.styledVectors=[],this.properties={},this._fnTypes=n.fnTypes||$r$3.genFnTypes(this.symbolDef),J$5(this.symbolDef.visible)&&(this._visibleFn=interpolated(this.symbolDef.visible)),n.atlas&&(this.iconAtlas=n.atlas.iconAtlas,this.glyphAtlas=n.atlas.glyphAtlas),this.features=this._check(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(t,e,n,r){e<this._minX&&(this._minX=e),e>this._maxX&&(this._maxX=e),n<this._minY&&(this._minY=n),n>this._maxY&&(this._maxY=n),this.needAltitudeAttribute()?(t.aPosition.push(e,n),t.aAltitude.push(r)):(pt$4(Or$3,e,n,r),t.aPosition.push(Or$3[0],Or$3[1],Or$3[2]))}_check(e){if(!e.length)return e;const n="__fea_idx".trim();let r,i=0,s=e[i];for(;!s.geometry;)i++,s=e[i];if(Array.isArray(s.geometry)&&s.properties){let n=s.geometry[0];for(;Array.isArray(n);)n=n[0];n instanceof pointGeometry&&(r=e)}if(!r)if(r=[],Array.isArray(s.geometry))for(let t=0;t<e.length;t++){const n=U$4({},e[t]);r.push(V$4(n))}else for(let t=0;t<e.length;t++){const i=e[t],s=v$2(i);for(let t=0;t<s.length;t++){const e=s[t];e[n]=i[n],r.push(e)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let e=0,n=!1;const{textPitchAlignmentFn:i}=this._fnTypes;!i&&t&&"map"===this.symbolDef.textPitchAlignment&&(n=!0);for(let s=0;s<r.length;s++){const a=Hr$3(r[s]&&r[s].geometry);if(a>e&&(e=a),t&&!n&&i&&r[s].properties){const t=i(null,r[s].properties);"map"===t&&(n=t)}}this.hasMapPitchAlign=n,this.maxPosZ=e}const a=this.options.order;if(a){const t=[];for(let e=0;e<a.length;e++)a[e]&&t.push(vr$3(a[e]));r=r.sort(((e,n)=>{const r=t.length;let i=-1,s=-1;for(let a=0;a<r&&(t[a](e)&&(i=a),t[a](n)&&(s=a),!(i>=0&&i<r&&s>=0&&s<r));a++);return i-s}))}return r}load(t=1){const e="__fea_idx".trim(),n="_debug_info".trim(),r=this._fnTypes,i=this.styledVectors;this.count=0;const a=this.features;if(!a||!a.length)return Promise.resolve(null);const o={},l={},h={zoom:this.options.zoom,isVector3D:!!this.options.center},u=[],c=loadFunctionTypes(this.symbolDef,(()=>(u[0]=h.zoom,u)));let p=0,f=a.length;const d=this.options.debugIndex;try{for(;p<f;p++){const t=a[p];if(!t||!t.geometry)continue;if(N$4(d)&&t[n].index!==d)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const s=this.createStyledVector(t,c,r,h,o,l);s&&s.feature.geometry&&(s.featureIdx=void 0===t[e]?p:t[e],this.count++,i.push(s))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(o,l).then((()=>this.pack(t)))}loadAtlas(t,e){return new Promise(((n,r)=>{this.fetchAtlas(t,e,((t,e)=>{if(t)r(t);else{if(e){const{icons:t,glyphs:n}=e;if(t&&Object.keys(t).length){for(const e in t){const n=t[e],{width:r,height:i,data:s}=n.data;n.data=new T$4({width:r,height:i},s)}this.iconAtlas=new C$2(t)}if(n&&Object.keys(n).length){for(const t in n){const e=n[t];for(const t in e){const n=e[t],{width:r,height:i,data:s}=n.bitmap;n.bitmap=new M$4({width:r,height:i},s)}}this.glyphAtlas=new E$4(n)}}n({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}}))}))}fetchAtlas(t,e,n){Object.keys(t).length>0||Object.keys(e).length>0?this.options.requestor(t,e,n):n()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const e=this.createDataPack(this.styledVectors,t);if(!e)return null;e.properties=this.properties,this.empty&&(e.empty=!0);const n=e.buffers;delete e.buffers;const r={data:e,buffers:n};if(this.iconAtlas){const t=r.data.iconAtlas=Nr$3(this.iconAtlas);if(t.glyphMap)for(const e in t.glyphMap)n.push(t.glyphMap[e].data.data.buffer);n.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=Nr$3(this.glyphAtlas),n.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(t,e,n,r){return new ct$4(t,e,n,r)}createDataPack(t,e){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this._minX=this._minY=1/0,this._maxX=this._maxY=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const n=this.data={};this._arrayPool=Ur$3,Ur$3.reset();let r=this.elements=Ur$3.get();const i=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),s=this.needAltitudeAttribute()?2:3;for(let t=0;t<i.length;t++)n[i[t].name]=Ur$3.get();let a=Ur$3.get(),o=0;const l=Ur$3.get();let h=0,u=!1,c=!0;const p=new Set;for(let r=0,i=t.length;r<i;r++){if(!t[r].feature.geometry)continue;const i=Array.isArray(t[r])?t[r][0].feature.id:t[r].feature.id;c&&(void 0!==Rr$3.id?p&&(p.has(Rr$3.id)?c=!1:p.add(Rr$3.id)):c=!1),N$4(i)&&(Math.abs(i)>h&&(h=Math.abs(i)),i<0&&(u=!0));const f=this.data.aPosition.length;if(Array.isArray(t[r]))for(let n=0;n<t[r].length;n++)this._placeVector(t[r][n],e);else this._placeVector(t[r],e);const d=(n.aPosition.length-f)/s;for(let e=0;e<d;e++)a.push(t[r].featureIdx),N$4(i)&&l.push(i);o=Math.max(o,t[r].featureIdx)}if(this.countOutOfAngle>0&&console.warn("text anchor along line is ignored as anchor's line angle is bigger than textMaxAngle."),this.hasElements()&&!r.length)return null;const f=this.options.center?Float32Array:R$4(o);a=Er$3.createTypedArray(a,f),i[0].type=this.options.positionType?this.options.positionType:L$4(this.maxPos);const d=this.options.center;if(d&&(d[0]||d[1])){const t=n.aPosition;for(let e=0;e<t.length;e+=s)t[e]-=d[0],t[e+1]-=d[1]}const y=function(t,e){const n={};for(let r=0;r<t.length;r++){const i=t[r],s=i.type,a=i.name;n[a]=s===Array?e[a]:W$4(e[a],s)}return n}(i,n);y.aPickingId=a;const m=[];for(const t in y)m.push(y[t].buffer);const g=O$4(this.maxIndex);r=Er$3.createTypedArray(r,g),m.push(r.buffer);const x={data:y,isIdUnique:c,is2D:0===this.maxPosZ,indices:this.hasElements()?r:null,positionSize:s,positionBounding:[this._minX,this._minY,this._maxX,this._maxY],buffers:m,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this._packMarkerPlacement&&(x.markerPlacement=this._packMarkerPlacement),this._packTextPlacement&&(x.textPlacement=this._packTextPlacement),l.length){const t=u?L$4(h):R$4(h);x.featureIds=Er$3.createTypedArray(l,t),m.push(x.featureIds.buffer)}else x.featureIds=[];return x.pickingIdIndiceMap=ut$4(a,x.indices),x}_placeVector(t,e){this._visibleFn&&!this._visibleFn(this.options.zoom,t.feature.properties)||this.placeVector(t,e,this.formatWidth)}addElements(...t){this.maxIndex=Math.max(this.maxIndex,...t),this.elements.push(...t)}hasElements(){return!0}getAltitude(t){const{altitudeProperty:e,defaultAltitude:n,altitudeScale:r}=this.options;let i=st$4(t,e,n);return r&&(i*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(i)),i}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let e=0;for(const n in t)if(X$5(t,n)){const{tl:r,displaySize:i}=t[n],s=Math.max(r[0],r[1],i[0]-1,i[1]-1);s>e&&(e=s)}return e}}function Nr$3(t){let e=t.positions,n=t.image&&t.image.format||"alpha";if(t instanceof C$2){e={};for(const n in t.positions){const r=t.positions[n];e[n]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}n="rgba"}const r=t.image;return{image:{width:r.width,height:r.height,data:r.data,format:n},glyphMap:t.glyphMap,positions:e}}function Hr$3(t){if(!t)return 0;let e=0;if(Array.isArray(t))for(let n=0;n<t.length;n++)if(Array.isArray(t[n])){const r=Hr$3(t[n]);r>e&&(e=r)}else{const r=Math.abs(t[n].z||0);r>e&&(e=r)}else{const n=Math.abs(t.z||0);n>e&&(e=n)}return e}function jr$3(t,e,i,s){const a="__fn_textSize".trim();let o=t.textSize;if($$4(e.textSize))return[16,16];t[a]&&(o=t[a]);const l=[];if(l[0]=q$5(o)?o(s,i):o,isFunctionDefinition(l[0])){const e=l[0].__fn_key=l[0].__fn_key||JSON.stringify(l[0]);t.___fn_in_stops||(t.___fn_in_stops={}),t.___fn_in_stops[e]||(t.___fn_in_stops[e]=interpolated(l[0])),l[0]=(0,t.___fn_in_stops[e])(s,i)}return l[1]=l[0],l}function qr$3(t){const e=t.stops;let n=-1/0;for(let t=0;t<e.length;t++){let r=e[t][1];H$4(e[t][1])&&(r=qr$3(e[t][1])),r>n&&(n=r)}return n}function Gr$3(t,e,n){return[e||"normal",n||"normal","24px",t||"Open Sans Regular"].join(" ")}const Xr$3=/\{[\w-]+(?:\|[\w-]+)*\}/g;function Br$3(t,e){return j$4(t)?t.replace(Xr$3,(function(t){if(!e)return"";if((t=t.substring(1,t.length-1)).indexOf("|")>0){const n=t.split("|");for(let t=0;t<n.length;t++){const r=e[n[t]];if(!$$4(r))return r}return""}const n=e[t];return $$4(n)?"":Array.isArray(n)?n.join():n})):t}var Jr$3=Object.freeze({__proto__:null,getSDFFont:Gr$3,resolveText:Br$3,resolveVarNames:function(t){return t.match(Xr$3)},resolveExpVarNames:function t(e,n){if(2!==n.length||"get"!==n[0])for(let r=0;r<n.length;r++)2===n[r].length&&"get"===n[r][0]?e.push(n[r][1]):Array.isArray(n[r])&&t(e,n[r]);else e.push(n[1])}});const fi$2=t=>t>=11904&&t<=12031,di$2=t=>t>=12032&&t<=12255,yi$2=t=>t>=12272&&t<=12287,mi$2=t=>t>=12288&&t<=12351,gi$2=t=>t>=12352&&t<=12447,xi$2=t=>t>=12448&&t<=12543,vi$2=t=>t>=12544&&t<=12591,ki$2=t=>t>=12704&&t<=12735,Ai$2=t=>t>=12736&&t<=12783,_i$2=t=>t>=12784&&t<=12799,Fi$2=t=>t>=12800&&t<=13055,Pi$2=t=>t>=13056&&t<=13311,zi$2=t=>t>=13312&&t<=19903,Ti$2=t=>t>=19968&&t<=40959,Si$2=t=>t>=40960&&t<=42127,Ci$2=t=>t>=42128&&t<=42191,Li$2=t=>t>=63744&&t<=64255,Ri$2=t=>t>=64336&&t<=65023,Wi$2=t=>t>=65040&&t<=65055,Vi$2=t=>t>=65072&&t<=65103,Ui$2=t=>t>=65104&&t<=65135,$i$2=t=>t>=65136&&t<=65279,Ni$2=t=>t>=65280&&t<=65519;function Hi$2(t){return!((t=>t>=1536&&t<=1791)(t)||(t=>t>=1872&&t<=1919)(t)||(t=>t>=2208&&t<=2303)(t)||Ri$2(t)||$i$2(t))}function ji$2(t){return!!(746===t||747===t||!(t<4352)&&(ki$2(t)||vi$2(t)||Vi$2(t)&&!(t>=65097&&t<=65103)||Li$2(t)||Pi$2(t)||fi$2(t)||Ai$2(t)||!(!mi$2(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||zi$2(t)||Ti$2(t)||Fi$2(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||(t=>t>=44032&&t<=55215)(t)||gi$2(t)||yi$2(t)||(t=>t>=12688&&t<=12703)(t)||di$2(t)||_i$2(t)||xi$2(t)&&12540!==t||!(!Ni$2(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Ui$2(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Wi$2(t)||(t=>t>=19904&&t<=19967)(t)||Si$2(t)||Ci$2(t)))}function qi$2(t){return!(ji$2(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||mi$2(t)||xi$2(t)||(t=>t>=57344&&t<=63743)(t)||Vi$2(t)||Ui$2(t)||Ni$2(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Gi$2(t){return t>=1424&&t<=2303||Ri$2(t)||$i$2(t)}const Xi$2=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function Bi$2(t){for(const e of Xi$2)if(t>=e[0]&&t<=e[1])return!0;return!1}const Ji$2={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function Ki$2(t,e,n,r,i,s,a,o,l,h){let u=t.trim();2===h&&(u=function(t){let e="";for(let n=0;n<t.length;n++){const r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&qi$2(r)&&!Ji$2[t[n+1]]||i&&qi$2(i)&&!Ji$2[t[n-1]]||!Ji$2[t[n]]?t[n]:Ji$2[t[n]]}return e}(u));const c=[],p={positionedGlyphs:c,text:u,top:o[1],bottom:o[1],left:o[0],right:o[0],writingMode:h};let f;return f=function(t,e){const n=[];let r=0;for(let i=0;i<e.length;i++){const s=e[i];n.push(t.substring(r,s)),r=s}return r<t.length&&n.push(t.substring(r,t.length)),n}(u,function(t,e,n,r){if(!n)return[];if(!t)return[];const i=[],s=function(t,e,n,r){let i=0;for(let n=0;n<t.length;n++){const s=r[t.charCodeAt(n)];s&&(i+=s.metrics.advance+e)}return i/Math.max(1,Math.ceil(i/n))}(t,e,n,r);let a=0;for(let n=0;n<t.length;n++){const l=t.charCodeAt(n),h=r[l];h&&!Qi$2[l]&&(a+=h.metrics.advance+e),n<t.length-1&&(ts$3[l]||!((o=l)<11904)&&(ki$2(o)||vi$2(o)||Vi$2(o)||Li$2(o)||Pi$2(o)||fi$2(o)||Ai$2(o)||mi$2(o)||zi$2(o)||Ti$2(o)||Fi$2(o)||Ni$2(o)||gi$2(o)||yi$2(o)||di$2(o)||_i$2(o)||xi$2(o)||Wi$2(o)||Ci$2(o)||Si$2(o)))&&i.push(rs$3(n+1,a,s,i,ns$3(l,t.charCodeAt(n+1)),!1))}var o;return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(rs$3(t.length,a,s,i,0,!0))}(u,a,n,e)),function(t,e,n,r,i,s,a,o,l,h){let u=0,c=0,p=0;const f=t.positionedGlyphs,d="right"===s?1:"left"===s?0:.5;for(let t=0;t<n.length;t++){let i=n[t];if(i=i.trim(),!i.length){c-=r;continue}const s=f.length;for(let t=0;t<i.length;t++){const n=i.charCodeAt(t),r=e[n];r&&(ji$2(n)&&1!==a?(32!==n&&f.push({glyph:n,x:u,y:0,vertical:!0}),u+=l+o):(32!==n&&f.push({glyph:n,x:u,y:c,vertical:!1}),u+=r.metrics.advance+o))}f.length!==s&&(p=Math.max(u-o,p),ss$3(f,e,s,f.length-1,d)),u=0,c-=r}const{horizontalAlign:y,verticalAlign:m}=is$3(i,void 0);!function(t,e,n,r,i,s,a){const o=(e-n)*i,l=-(-r*a+.5)*s;if(o||l)for(let e=0;e<t.length;e++)t[e].x+=o,t[e].y+=l}(f,d,y,m,p,r,n.length);const g=n.length*r;t.top+=-m*g,t.bottom=t.top+g,t.left+=-y*p,t.right=t.left+p}(p,e,f,r,i,s,h,a,l),!!c.length&&p}const Qi$2={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},ts$3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function es$3(t,e,n,r){const i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function ns$3(t,e){let n=0;return 10===t&&(n-=1e4),40!==t&&65288!==t||(n+=50),41!==e&&65289!==e||(n+=50),n}function rs$3(t,e,n,r,i,s){let a=null,o=es$3(e,n,i,s);for(let t=0;t<r.length;t++){const l=r[t],h=es$3(e-l.x,n,i,s)+l.badness;h<=o&&(a=l,o=h)}return{index:t,x:e,priorBreak:a,badness:o}}function is$3(t,e){let n=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":n=e?1:0;break;case"left":case"top-left":case"bottom-left":n=e?0:1}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=e?1:0;break;case"top":case"top-right":case"top-left":r=e?0:1}return{horizontalAlign:n,verticalAlign:r}}function ss$3(t,e,n,r,i){if(!i)return;const s=e[t[r].glyph];if(s){const e=(t[r].x+s.metrics.advance)*i;if(!e)return;for(let i=n;i<=r;i++)t[i].x-=e}}function as$3(t){if(!function(t){for(const e of t)if(Gi$2(e.charCodeAt(0)))return!0;return!1}(t))return t;const e=[],n=[],r=[];let i=0,s=0,a=1,o=1;for(const l of t){const t=l.codePointAt(0);Bi$2(t)?(r.push(l),i++):(a=Gi$2(t)?-1:1,o!==a?(s=i,n.length&&(o>0&&n.reverse(),e.push(...n)),r.length&&(e.splice(s,0,...r),r.length=0),o=a,n.length=0):r.length&&(n.push(...r),r.length=0),n.push(l),i++)}return r.length&&n.push(...r),n.length&&(o>0&&n.reverse(),e.push(...n)),e.reverse().join("")}const os$3=/\{ *([\w_]+) *\}/g;class ls$3{constructor(t,e,n,r,i){this.feature=t,this.symbolDef=e,this.symbol=n,this.options=i,this._thisReplacer=this._replacer.bind(this),this._fnTypes=r}_replacer(t,e){return this.feature.properties[e]||"default"}getShape(t,e){if(this._shape)return this._shape;const{textHorizontalAlignmentFn:n,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:i,markerVerticalAlignmentFn:s,textWrapWidthFn:a}=this._fnTypes;let o;const l=this.symbol,h=this.getIconAndGlyph(),u=this.feature.properties;if(h&&h.glyph){const{font:t,text:i}=h.glyph;if(""===i)return null;const s=this.size[0]/24,c=24,p=l.textKeepUpright,f="map"===l.textRotationAlignment&&"line"===l.textPlacement&&!l.isIconText,d=e.glyphMap[t],y=hs$3(n?n(null,u):l.textHorizontalAlignment,r?r(null,u):l.textVerticalAlignment),m=1.2*c,g=function(t){for(let e=0;e<t.length;e++)if(!Hi$2(t.charAt(e).charCodeAt(0)))return!1;return!0}(i),x=g&&l.textLetterSpacing/s||0,v=[l.textDx/s||0,l.textDy/s||0],b=((a?a(null,u):l.textWrapWidth)||10*c)/s;o={},o.horizontal=Ki$2(i,d,b,m,y,"center",x,v,c,1),g&&f&&p&&(o.vertical=Ki$2(i,d,b,m,y,"center",x,v,c,2))}else if(h&&h.icon){if(!t.positions[h.icon.url])return null;const e=hs$3(i?i(null,u):l.markerHorizontalAlignment,s?s(null,u):l.markerVerticalAlignment);o=function(t,e,n){let{horizontalAlign:r,verticalAlign:i}=is$3(e,n);n?r=1-r:i=1-i;const s=-2048*r,a=-2048*i;return{image:t,top:a,bottom:a+2048,left:s,right:s+2048}}(t.positions[h.icon.url],e,this.options.isVector3D),this.size||(this.size=o.image.displaySize)}return this._shape=o,o}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:e,markerPathFn:i,markerWidthFn:s,markerHeightFn:a,markerFillFn:o,markerFillPatternFileFn:l,markerFillOpacityFn:h,markerTextFitFn:u,markerTextFitPaddingFn:c,markerLineColorFn:p,markerLineWidthFn:f,markerLineOpacityFn:d,markerLineDasharrayFn:y,markerLinePatternFileFn:m,markerPathWidthFn:g,markerPathHeightFn:x,textNameFn:v,textFaceNameFn:b,textStyleFn:w,textWeightFn:k}=this._fnTypes,{zoom:A}=this.options,_={},F=this.symbol,P=this.feature.properties,z=t?t(null,P):F.markerFile,M=e?e(null,P):F.markerType,T=z||M||F.markerPath,S=!$$4(this.symbolDef.textName);let C;if(T){C=function(t,e,n,r,i,s){if($$4(e.markerWidth)&&$$4(e.markerHeight))return null;const a="__fn_markerWidth".trim(),o="__fn_markerHeight".trim();let l=e.markerWidth||0,h=e.markerHeight||0;return H$4(l)&&("identity"!==l.type?l=qr$3(l):(l=t.markerWidth,t[a]&&(l=t[a](r,n)),H$4(l)&&(l="identity"===l.type?i(r,n):qr$3(l)))),H$4(h)&&("identity"!==h.type?h=qr$3(h):(h=t.markerHeight,t[o]&&(h=t[o](r,n)),H$4(h)&&(h="identity"===h.type?s(r,n):qr$3(h)))),[l,h]}(F,this.symbolDef,P,A,s,a)||[0,0];let t=F.markerTextFit;if(u&&(t=u(A,P)),t&&F.text&&"none"!==t){const e=F.text.textSize;let i=F.text.textName;isFunctionDefinition(i)&&(i=interpolated(i)(A,P));const s=Br$3(i,P);if(s){const i="__fn_textSize".trim(),a="__fn_textSize_0".trim();isFunctionDefinition(e)&&!F.text[i]&&(F.text[a]=interpolated(e),F.text[i]=(t,e)=>{const i=F.text[a](t,e);return isFunctionDefinition(i)?interpolated(i)(t,e):i});const o=jr$3(F.text,F.text,P,A);if("width"!==t&&"both"!==t||(C[0]=o[0]*s.length),"height"!==t&&"both"!==t||(C[1]=o[1]),o[0]&&o[1]){let t=F.markerTextFitPadding||[0,0,0,0];c&&(t=c(A,P)),C[0]+=t[1]+t[3],C[1]+=t[0]+t[2]}}else C[0]=C[1]=-1}}if(S&&(C=jr$3(F,this.symbolDef,P,A)),!C)return _;if(C[0]=Math.ceil(C[0]),C[1]=Math.ceil(C[1]),this.size=C,T&&C[0]>=0&&C[1]>=0){let t;if(M){const e={};if(e.markerType=M,"path"===M&&(e.markerPath=i?i(null,P):F.markerPath,e.markerPathWidth=g?g(null,P):F.markerPathWidth,e.markerPathHeight=x?x(null,P):F.markerPathHeight),s){const t=s(null,P);$$4(t)||(e.markerWidth=t)}else F.markerWidth>=0&&(e.markerWidth=F.markerWidth);if(a){const t=a(null,P);$$4(t)||(e.markerHeight=t)}else F.markerHeight>=0&&(e.markerHeight=F.markerHeight);if(o){const t=o(null,P);$$4(t)||(e.markerFill=t)}else F.markerFill&&(e.markerFill=F.markerFill);if(l){const t=l(null,P);$$4(t)||(e.markerFillPatternFile=t)}else F.markerFillPatternFile&&(e.markerFillPatternFile=F.markerFillPatternFile);if(h){const t=h(null,P);$$4(t)||(e.markerFillOpacity=t)}else F.markerFillOpacity>=0&&(e.markerFillOpacity=F.markerFillOpacity);if(p){const t=p(null,P);$$4(t)||(e.markerLineColor=t)}else F.markerLineColor&&(e.markerLineColor=F.markerLineColor);if(f){const t=f(null,P);$$4(t)||(e.markerLineWidth=t)}else F.markerLineWidth>=0&&(e.markerLineWidth=F.markerLineWidth);if(d){const t=d(null,P);$$4(t)||(e.markerLineOpacity=t)}else F.markerLineOpacity>=0&&(e.markerLineOpacity=F.markerLineOpacity);if(y){const t=y(null,P);$$4(t)||(e.markerLineDasharray=t)}else F.markerLineDasharray&&(e.markerLineDasharray=F.markerLineDasharray);if(m){const t=m(null,P);$$4(t)||(e.markerLinePatternFile=t)}else F.markerLinePatternFile&&(e.markerLinePatternFile=F.markerLinePatternFile);t="vector://"+JSON.stringify(e)}else t=z?z.replace(os$3,this._thisReplacer):F.markerPath?function(t,e,n){if(!t.markerPath)return null;let r=1;const i=function(t){const e={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===e.stroke["stroke-width"]&&(e.stroke["stroke-opacity"]=0),e}(t);N$4(t.markerOpacity)&&(r=t.markerOpacity),N$4(t.opacity)&&(r*=t.opacity);const s={};if(i){for(const t in i.stroke)X$5(i.stroke,t)&&($$4(i.stroke[t])||(s[t]=i.stroke[t]));for(const t in i.fill)X$5(i.fill,t)&&($$4(i.fill[t])||(s[t]=i.fill[t]))}const a=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let o;const l=[];for(let t=0;t<a.length;t++)o=j$4(a[t])?{path:a[t]}:a[t],o=U$4({},o,s),o.d=o.path,delete o.path,l.push(o);const h=['<svg version="1.1"','xmlns="http://www.w3.org/2000/svg"'];r<1&&h.push('opacity="'+r+'"'),t.markerPathWidth&&t.markerPathHeight&&h.push('viewBox="0 0 '+t.markerPathWidth+" "+t.markerPathHeight+'"'),h.push('preserveAspectRatio="none"'),e&&h.push('width="'+e+'"'),n&&h.push('height="'+n+'"'),h.push("><defs></defs>");for(let t=0;t<l.length;t++){let e="<path ";for(const n in l[t])X$5(l[t],n)&&(e+=" "+n+'="'+l[t][n]+'"');e+="></path>",h.push(e)}return h.push("</svg>"),"data:image/svg+xml;base64,"+btoa(h.join(" "))}(F,C[0],C[1]):null;_.icon={url:t,size:C}}if(S){const t=v?v(this.options.zoom,P):F.textName;if(t||0===t){const e=Gr$3(b?b(null,P):F.textFaceName,w?w(null,P):F.textStyle,k?k(null,P):F.textWeight);let n=Br$3(t,P);n&&n.length&&(n=as$3(n),_.glyph={font:e,text:n})}}return this.iconGlyph=_,_}}function hs$3(t,e){e&&"middle"!==e||(e="center"),t&&"middle"!==t||(t="center");let n="center"!==e?e:"";return n+="center"!==t?(n.length?"-":"")+t:"",n
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */}function us$3(e,n,r,i,s){const a=[];let o;for(let l=0;l<e.length;l++){const h=e[l];let u,c=!1;for(let e=0;e<h.length-1;e++){let l=h[e],p=h[e+1];l.x<n&&p.x<n||(l.x<n?(o=l,l=new pointGeometry(n,l.y+(n-l.x)/(p.x-l.x)*(p.y-l.y))._round(),l.z=o.z+(n-o.x)/(p.x-o.x)*(p.z-o.z),c=!0):p.x<n&&(o=p,p=new pointGeometry(n,l.y+(n-l.x)/(p.x-l.x)*(p.y-l.y))._round(),p.z=l.z+(n-l.x)/(o.x-l.x)*(o.z-l.z),c=!0),l.y<r&&p.y<r||(l.y<r?(o=l,l=new pointGeometry(l.x+(r-l.y)/(p.y-l.y)*(p.x-l.x),r)._round(),l.z=o.z+(r-o.y)/(p.y-o.y)*(p.z-o.z),c=!0):p.y<r&&(o=p,p=new pointGeometry(l.x+(r-l.y)/(p.y-l.y)*(p.x-l.x),r)._round(),p.z=l.z+(r-l.y)/(o.y-l.y)*(o.z-l.z),c=!0),l.x>=i&&p.x>=i||(l.x>=i?(o=l,l=new pointGeometry(i,l.y+(i-l.x)/(p.x-l.x)*(p.y-l.y))._round(),l.z=o.z+(i-o.x)/(p.x-o.x)*(p.z-o.z),c=!0):p.x>=i&&(o=p,p=new pointGeometry(i,l.y+(i-l.x)/(p.x-l.x)*(p.y-l.y))._round(),p.z=l.z+(i-l.x)/(o.x-l.x)*(o.z-l.z),c=!0),l.y>=s&&p.y>=s||(l.y>=s?(o=l,l=new pointGeometry(l.x+(s-l.y)/(p.y-l.y)*(p.x-l.x),s)._round(),l.z=o.z+(s-o.y)/(p.y-o.y)*(p.z-o.z),c=!0):p.y>=s&&(o=p,p=new pointGeometry(l.x+(s-l.y)/(p.y-l.y)*(p.x-l.x),s)._round(),p.z=l.z+(s-l.y)/(o.y-l.y)*(o.z-l.z),c=!0),u&&l.equals(u[u.length-1])||(u=[l],a.push(u)),c&&(u.clipped=!0),u.push(p)))))}}return a}class cs$3 extends pointGeometry{constructor(t,e,n,r){super(t,e),this.angle=n,void 0!==r&&(this.segment=r)}clone(){return new cs$3(this.x,this.y,this.angle,this.segment)}}
/*!
	 * From mapbox-gl-js
	 * MIT License
	 * https://github.com/mapbox/mapbox-gl-js
	 */function ps$3(t,e,n,r,i){if(void 0===e.segment)return!0;let s=e,a=e.segment+1,o=0;for(;o>-n/2;){if(a--,a<0)return!1;o-=t[a].dist(s),s=t[a]}o+=t[a].dist(t[a+1]),a++;const l=[];let h=0;for(;o<n/2;){const e=t[a],n=t[a+1];if(!n)return!1;let s=t[a-1].angleTo(e)-e.angleTo(n);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:o,angleDelta:s}),h+=s;o-l[0].distance>r;)h-=l.shift().angleDelta;if(h>i)return!1;a++,o+=e.dist(n)}return!0}function fs$3(t,e,n,r,i,s,a,o,l,h,u){const c=function(t,e,n){return t?.6*e*n:0}(r,s,a),p=function(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}(r,i),f=0===t[0].x||t[0].x===l||0===t[0].y||t[0].y===l;return e-p*a<e/4&&(e=p*a+e/4),function t(e,n,r,i,s,a,o,l,h,u,c){let p=0;const f=a/2,d=function(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}(e);let y=0,m=n-r,g=[];for(let t=0;t<e.length-1;t++){const n=e[t],o=e[t+1],l=n.dist(o),x=o.angleTo(n);for(;m+r<y+l;){m+=r;const v=(m-y)/l,b=ds$3(n.x,o.x,v),w=ds$3(n.y,o.y,v),k=ds$3(n.z||0,o.z||0,v);if(b>=0&&b<h&&w>=0&&w<h&&m-f>=0&&m+f<=d){const r=new cs$3(b,w,x,t);r.z=k,u&&(r.axis=[n.y-w,b-n.x],r.angleR=k===(n.z||0)?0:Math.atan(.9*(k-(n.z||0))*c/n.dist(r))),r.line=e,r._round(),!i||ps$3(e,r,a,i,s)?g.push(r):i&&p++}}y+=l}return l||g.length||o||(g=t(e,y/2,r,i,s,a,o,!0,h,u,c)),g.countOutOfAngle=p,g}(t,f?e/2*o%e:(p/2+2*s)*a*o%e,e,c,n,p*a,f,!1,l,h,u)}function ds$3(t,e,n){return t*(1-n)+e*n}function ys$3(t,e){const n=t.length;if(n<=1)return[t];const r=[];let i,s;for(let e=0;e<n;e++){const n=rt$4(t[e]);0!==n&&(t[e].area=Math.abs(n),void 0===s&&(s=n<0),s===n<0?(i&&r.push(i),i=[t[e]]):i.push(t[e]))}if(i&&r.push(i),e>1)for(let t=0;t<r.length;t++)r[t].length<=e||(h(r[t],e,1,r[t].length-1,ms$3),r[t]=r[t].slice(0,e));return r}function ms$3(t,e){return e.area-t.area}function gs$3(t,e,n){const r=e.distSqr(n);if(0===r)return t.distSqr(e);const i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function xs$2(e,n=1,r=!1){let i=1/0,s=1/0,a=-1/0,o=-1/0;const l=e[0];for(let t=0;t<l.length;t++){const e=l[t];(!t||e.x<i)&&(i=e.x),(!t||e.y<s)&&(s=e.y),(!t||e.x>a)&&(a=e.x),(!t||e.y>o)&&(o=e.y)}const h=Math.min(a-i,o-s);let c=h/2;const p=new TinyQueue([],vs$3);if(0===h)return new pointGeometry(i,s);for(let t=i;t<a;t+=h)for(let n=s;n<o;n+=h)p.push(new bs$3(t+c,n+c,c,e));let f=function(t){let e=0,n=0,r=0;const i=t[0];for(let t=0,s=i.length,a=s-1;t<s;a=t++){const s=i[t],o=i[a],l=s.x*o.y-o.x*s.y;n+=(s.x+o.x)*l,r+=(s.y+o.y)*l,e+=3*l}return new bs$3(n/e,r/e,0,t)}(e),d=p.length;for(;p.length;){const t=p.pop();(t.d>f.d||!f.d)&&(f=t,r&&console.log("found best %d after %d probes",Math.round(1e4*t.d)/1e4,d)),t.max-f.d<=n||(c=t.h/2,p.push(new bs$3(t.p.x-c,t.p.y-c,c,e)),p.push(new bs$3(t.p.x+c,t.p.y-c,c,e)),p.push(new bs$3(t.p.x-c,t.p.y+c,c,e)),p.push(new bs$3(t.p.x+c,t.p.y+c,c,e)),d+=4)}return r&&(console.log("num probes: "+d),console.log("best distance: "+f.d)),f.p}function vs$3(t,e){return e.max-t.max}function bs$3(e,n,r,i){this.p=new pointGeometry(e,n),this.h=r,this.d=function(t,e){let n=!1,r=1/0;for(let i=0;i<e.length;i++){const s=e[i];for(let e=0,i=s.length,a=i-1;e<i;a=e++){const i=s[e],o=s[a];i.y>t.y!=o.y>t.y&&t.x<(o.x-i.x)*(t.y-i.y)/(o.y-i.y)+i.x&&(n=!n),r=Math.min(r,gs$3(t,i,o))}}return(n?1:-1)*Math.sqrt(r)}(this.p,i),this.max=this.d+this.h*Math.SQRT2}function ws$3(t,e,n,r,i,s,a,o,l,h){const{feature:u,size:c,symbol:p}=t,f=c?24:0,d=i*(c?c[0]/f:1);if("line"===a){const t=[];t.countOutOfAngle=0;let i=u.geometry;s&&(i=us$3(u.geometry,0,0,s,s));for(let a=0;a<i.length;a++){const u=fs$3(i[a],o,n,p.isIconText?null:r&&r.vertical||r&&r.horizontal||r,null,f,p.isIconText?1:d,1,s||1/0,l,h);if(p.textPlacement&&!p.isIconText)for(let t=0;t<u.length;t++)u[t].startIndex=e.length/3;if(t.push.apply(t,u),p.textPlacement&&!p.isIconText)for(let t=0;t<i[a].length;t++)e.push(i[a][t].x,i[a][t].y,i[a][t].z||0);t.countOutOfAngle+=u.countOutOfAngle||0}return t}return function(t,e,n,r,i){const s=[];if(3===t.type){const a=ys$3(t.geometry,0);for(let t=0;t<a.length;t++){const o=a[t];if("vertex"===e)for(let t=0;t<o.length;t++){const e=o[t];for(let a=0;a<e.length;a++)ot$4(e[a],n)||(s.push(e[a]),r&&(0===a?As$2(e[a],e[a],e[t+1],i):As$2(e[a],e[a-1],e[a],i)))}else if("vertex-first"===e){const t=o[0];t&&t[0]&&!ot$4(t[0],n)&&(s.push(t[0]),r&&As$2(t[0],t[0],t[1],i))}else if("vertex-last"===e||"vertex-firstlast"===e){const t=o[0];if("vertex-firstlast"===e&&t&&t[0]&&!ot$4(t[0],n)&&(s.push(t[0]),r&&As$2(t[0],t[0],t[1],i)),t&&t[t.length-1]&&!ot$4(t[t.length-1],n)){const e=t.length-1;s.push(t[e]),r&&As$2(t[e],t[e-1],t[e],i)}}else{const t=xs$2(o,16);ot$4(t,n)||s.push(t)}}}else if(2===t.type)for(let a=0;a<t.geometry.length;a++){const o=t.geometry[a];if("vertex"===e)for(let t=0;t<o.length;t++)ot$4(o[t],n)||(s.push(o[t]),r&&(0===t?As$2(o[t],o[t],o[t+1],i):As$2(o[t],o[t-1],o[t],i)));else if("vertex-last"===e||"vertex-firstlast"===e){if("vertex-firstlast"!==e||ot$4(o[0],n)||(s.push(o[0]),r&&As$2(o[0],o[0],o[1],i)),o&&o[o.length-1]&&!ot$4(o[o.length-1],n)){const t=o.length-1;s.push(o[t]),r&&As$2(o[t],o[t-1],o[t],i)}}else ot$4(o[0],n)||(s.push(o[0]),r&&As$2(o[0],o[0],o[1],i))}else if(1===t.type)for(let e=0;e<t.geometry.length;e++){const i=t.geometry[e];for(let t=0;t<i.length;t++){const e=i[t];ot$4(e,n)||(r&&(e.xRotation=0,e.yRotation=0,e.zRotation=0),s.push(e))}}return s}(u,a,s)}function As$2(t,e,n,r){if(t.xRotation||t.yRotation||t.zRotation)return t;const i=n.x-e.x,s=e.y-n.y,a=(n.z-e.z)*r,o=Math.atan2(s,i);t.zRotation=o;const l=Math.atan2(a,Math.sqrt(i*i+s*s));return t.xyRotation=l,t}function _s$2(t,e){const n={},r={},i=[];let s=0;function a(e){i.push(t[e]),s++}function o(t,e,n){const s=r[t];return delete r[t],r[e]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(n[0]),s}function l(t,e,r){const s=n[e];return delete n[e],n[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function h(t,e,n){const r=n?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let u=0;u<t.length;u++){const c=t[u],p=c.geometry;if(!p)continue;const f=c.properties[e]?c.properties[e].toString():null;if(!f){a(u);continue}const d=h(f,p),y=h(f,p,!0);if(d in r&&y in n&&r[d]!==n[y]){const t=l(d,y,p),e=o(d,y,i[t].geometry);delete n[d],delete r[y],r[h(f,i[e].geometry,!0)]=e,i[t].geometry=null}else d in r?o(d,y,p):y in n?l(d,y,p):(a(u),n[d]=s-1,r[y]=s-1)}return i.filter((t=>t.geometry))}class Ps$2 extends $r$3{static needMerge(t,e,n){if(!t)return!1;let r="line"===t.textPlacement||"line"===t.markerPlacement;return r||(e.textPlacementFn&&(r="line"===e.textPlacementFn(n)),e.markerPlacementFn&&(r="line"===e.markerPlacementFn(n))),t.mergeOnProperty&&r}static mergeLineFeatures(t,e,n,r){const i="__index".trim();let s=e.textPlacement,a=e.markerPlacement;n.textPlacementFn&&(s=n.textPlacementFn(r)),n.markerPlacementFn&&(a=n.markerPlacementFn(r));const o=function(t,e,n,r,i){const s="__index".trim(),a=$r$3.genFnTypes(e),{mergeOnPropertyFn:o}=a;if(!e.mergeOnProperty||"line"!==r&&"line"!==n)return[];if(!(lt$4(l=e.mergeOnProperty)||"string"!=typeof l&&(null===l.constructor||l.constructor!==String)||"line"!==r&&"line"!==n))return[{features:t,property:e.mergeOnProperty}];var l;const h=[],u={},c=[];for(let a=0;a<t.length;a++){t[a][s]=a;const l=t[a].properties=t[a].properties||{};l.$layer=t[a].layer,l.$type=t[a].type;let p=n;"line"!==p&&(p=r);const f=o?o(i,l):e.mergeOnProperty;"line"!==p||lt$4(f)?c.push(t[a]):(void 0===u[f]&&(u[f]=h.length,h.push({features:[],property:f})),h[u[f]].features.push(t[a]))}return c.length&&h.push({features:c}),h}(t,e,a,s,r);if(o.length){const e=[];for(let n=0;n<o.length;n++)e.push(o[n].property?_s$2(o[n].features,o[n].property):t);if(1===e.length)return e[0];{let t=[];for(let n=0;n<e.length;n++)t=t.concat(e[n]);return t.sort(((t,e)=>t[i]-e[i])),t}}}static splitPointSymbol(t,e=0){const n=[];if(Array.isArray(t)){const e=t;for(let t=0;t<e.length;t++)e[t]&&n.push(...Ps$2.splitPointSymbol(e[t],t));return n}let r=null,i=null;for(const e in t)0===e.indexOf("marker")?(r=r||{},r[e]=t[e]):0===e.indexOf("text")&&(i=i||{},i[e]=t[e]);return r&&(r.isIconText=!0,t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),n.push(r)),i&&(r&&(i.textPlacement=r.markerPlacement,i.textSpacing=r.markerSpacing,i.isIconText=!0),t.mergeOnProperty&&(i.mergeOnProperty=t.mergeOnProperty),n.push(i)),void 0!==t.visible&&(r&&(r.visible=t.visible),i&&(i.visible=t.visible)),r&&(r.markerTextFit&&i&&(r.text={},r.text.textName=i.textName,r.text.textSize=i.textSize),r.index={index:e,type:0}),i&&(i.index={index:e,type:1}),n}static isAtlasLoaded(t,e){const{icon:n,glyph:r}=t,{iconAtlas:i,glyphAtlas:s}=e;if(n&&(!i||!i.positions[n.url]))return!1;if(r){if(!s||!s.positions[r.font])return!1;const t=s.positions[r.font],{text:e}=r;for(let n=0;n<e.length;n++)if(!t[e.charCodeAt(n)])return!1}return!0}constructor(t,e,n){super(t,e,n),this._textPlacement=e.textPlacement,this._fnTypes.textPlacementFn&&(this._textPlacement=this._fnTypes.textPlacementFn(this.options.zoom))}createStyledVector(t,e,n,r,i,s){const a=new ls$3(t,this.symbolDef,e,n,r),o=a.getIconAndGlyph();if(o.icon&&!this.options.atlas){const{url:t,size:e}=o.icon;i[t]||(i[t]=o.icon.size),i[t][0]<e[0]&&(i[t][0]=e[0]),i[t][1]<e[1]&&(i[t][1]=e[1])}if(o.glyph&&!this.options.atlas){const{font:t,text:e}=o.glyph,n=s[t]=s[t]||{};for(let t=0;t<e.length;t++)n[e.charCodeAt(t)]=1;"line"===this._textPlacement&&(s.options={isCharsCompact:!1})}return this.options.allowEmptyPack||o.icon||o.glyph?a:null}getFormat(t){const e=void 0!==t.textName,n=e?this.getPackSDFFormat(t):this.getPackMarkerFormat();e?n.push(...this._getTextFnTypeFormats()):n.push(...this._getMarkerFnTypeFormats());const{markerOpacityFn:r,textOpacityFn:i,markerPitchAlignmentFn:s,textPitchAlignmentFn:a,markerRotationAlignmentFn:o,textRotationAlignmentFn:l,markerRotationFn:h,textRotationFn:u,markerAllowOverlapFn:c,textAllowOverlapFn:p,markerIgnorePlacementFn:f,textIgnorePlacementFn:d}=this._fnTypes;return(r||i)&&n.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(s||a)&&n.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(o||l)&&n.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(h||u)&&n.push({type:Uint16Array,width:1,name:"aRotation"}),(c||p||f||d)&&n.push({type:Uint8Array,width:1,name:"aOverlap"}),n}_is3DPitchText(){return this.hasMapPitchAlign}_getTextFnTypeFormats(){const{textFillFn:t,textSizeFn:e,textHaloFillFn:n,textHaloRadiusFn:r,textHaloOpacityFn:i,textDxFn:s,textDyFn:a}=this._fnTypes,o=[];return t&&o.push({type:Uint8Array,width:4,name:"aTextFill"}),e&&o.push({type:Uint8Array,width:1,name:"aTextSize"}),n&&o.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&o.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),i&&o.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),s&&o.push({type:Int8Array,width:1,name:"aTextDx"}),a&&o.push({type:Int8Array,width:1,name:"aTextDy"}),o}_getMarkerFnTypeFormats(){const{markerWidthFn:t,markerHeightFn:e,markerDxFn:n,markerDyFn:r}=this._fnTypes,i=[];return t&&i.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),e&&i.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),n&&i.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&i.push({type:Int8Array,width:1,name:"aMarkerDy"}),i}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(e,r){const i=e.getShape(this.iconAtlas,this.glyphAtlas);if(!(this.options.allowEmptyPack||i&&i.image||i&&(i.horizontal||i.vertical)))return;const s=this._getAnchors(e,i,r);if(this.countOutOfAngle+=s.countOutOfAngle||0,0===s.length)return;const a=this.data,o=this.needAltitudeAttribute()?2:3;let l=this.data.aPosition.length/o;const h=e.symbol,u=e.feature.properties,c="line"===this._textPlacement&&!h.isIconText,p=void 0!==h.textName,f=p&&c&&function(t){let e=0;for(let n=0;n<t.length;n++)if(ji$2(t.charAt(n).charCodeAt(0)))e=0;else if(e++,e>=1)return!1;return!0}(e.getIconAndGlyph().glyph.text)?1:0,{textFillFn:d,textSizeFn:y,textHaloFillFn:m,textHaloRadiusFn:g,textHaloOpacityFn:x,textDxFn:v,textDyFn:b,textPitchAlignmentFn:w,textRotationAlignmentFn:k,textRotationFn:A,textAllowOverlapFn:_,textIgnorePlacementFn:F,textOpacityFn:P,markerWidthFn:z,markerHeightFn:M,markerDxFn:T,markerDyFn:S,markerPitchAlignmentFn:C,markerRotationAlignmentFn:D,markerRotationFn:I,markerAllowOverlapFn:E,markerIgnorePlacementFn:O,markerOpacityFn:L}=this._fnTypes;let R,W,V,U,$,N,H,j,q,G,X,B,J,Z,Y,K,tt;if(p){const r=e.getIconAndGlyph().glyph.font;R=function(e,n,r){const i=e.positionedGlyphs,s=[];for(let a=0;a<i.length;a++){const o=i[a],l=r[o.glyph];if(!l)continue;const h=l.rect;if(!h)continue;const u=4,c=l.metrics.advance/2,p=l.metrics.height/2,f=n?[o.x+c,0]:[0,0],d=n?[0,o.y-p]:[o.x+c,o.y-p],y=l.metrics.left-u-c+d[0],m=l.metrics.top-u+d[1],g=y+h.w,x=m+h.h,v=new pointGeometry(y,m),b=new pointGeometry(g,m),w=new pointGeometry(y,x),k=new pointGeometry(g,x);if(n&&o.vertical){const e=new pointGeometry(-c,c),n=-Math.PI/2,r=new pointGeometry(5,0);v._rotateAround(n,e)._add(r),b._rotateAround(n,e)._add(r),w._rotateAround(n,e)._add(r),k._rotateAround(n,e)._add(r)}s.push({tl:v,tr:b,bl:w,br:k,tex:h,writingMode:e.writingMode,glyphOffset:f})}return s}(i.horizontal,c,this.glyphAtlas.positions[r]),d&&(W=d(null,u),isFunctionDefinition(W)?(this.dynamicAttrs.aTextFill=1,W=[0,0,0,0]):W=Q$5([],W)),y&&(V=y(this.options.zoom,u),lt$4(V)&&(V=14)),m&&(U=m(null,u),isFunctionDefinition(U)?(this.dynamicAttrs.aTextHaloFill=1,U=[0,0,0,0]):U=Q$5([],U)),g&&($=g(null,u)),x&&(N=255*x(null,u)),v&&(H=v(null,u)||0),b&&(j=b(null,u)||0),w&&(J=+("map"===w(null,u))),k&&(Z=+("map"===k(null,u))),A&&(Y=ht$4(A(null,u),0,360)*Math.PI/180)}else R=i?function(e){const n=e.image,r=e.top-1/n.pixelRatio,i=e.left-1/n.pixelRatio,s=e.bottom+1/n.pixelRatio,a=e.right+1/n.pixelRatio;let o,l,h,u;return o=new pointGeometry(i,r),l=new pointGeometry(a,r),h=new pointGeometry(a,s),u=new pointGeometry(i,s),[{tl:o,tr:l,bl:u,br:h,tex:{x:n.tl[0],y:n.tl[1],w:n.displaySize[0],h:n.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(i):function(){const e=new pointGeometry(0,0),n=new pointGeometry(0,0),r=new pointGeometry(0,0);return[{tl:e,tr:n,bl:new pointGeometry(0,0),br:r,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),z&&(q=z(null,u)),lt$4(q)&&(q=R[0].tex.w),M&&(G=M(null,u)),lt$4(G)&&(G=R[0].tex.h),T&&(X=T(null,u)),S&&(B=S(null,u)),C&&(J=+("map"===C(null,u))),D&&(Z=+("map"===D(null,u))),I&&(Y=ht$4(I(null,u),0,360)*Math.PI/180);isFunctionDefinition(V)&&(this.dynamicAttrs.aTextSize=1),isFunctionDefinition($)&&(this.dynamicAttrs.aTextHaloRadius=1),isFunctionDefinition(N)&&(this.dynamicAttrs.aTextHaloOpacity=1),isFunctionDefinition(H)&&(this.dynamicAttrs.aTextDx=1),isFunctionDefinition(j)&&(this.dynamicAttrs.aTextDy=1),isFunctionDefinition(q)&&(this.dynamicAttrs.aMarkerWidth=1),isFunctionDefinition(G)&&(this.dynamicAttrs.aMarkerHeight=1),isFunctionDefinition(X)&&(this.dynamicAttrs.aMarkerDx=1),isFunctionDefinition(B)&&(this.dynamicAttrs.aMarkerDy=1),isFunctionDefinition(J)&&(this.dynamicAttrs.aPitchAlign=1),isFunctionDefinition(Z)&&(this.dynamicAttrs.aRotationAlign=1),isFunctionDefinition(Y)&&(this.dynamicAttrs.aRotation=1);const et=E||_;et&&(K=et(null,u)||0);const nt=O||F;let rt;nt&&(tt=nt(null,u)||0);const it=P||L;it&&(rt=255*it(this.options.zoom,u));const st=this.options.EXTENT,ut=R.length,{altitudeScale:ct,altitudeProperty:pt,defaultAltitude:ft}=this.options,{altitude:dt}=at$4(e.feature,ct,pt,ft);for(let t=0;t<s.length;t++){const e=s[t],n=e.z||dt||0;if(st!==1/0&&ot$4(e,st))continue;const r=e.x,i=e.y,o=R.length;for(let t=0;t<o;t++){const s=R[t],{tl:o,tr:h,bl:u,br:d,tex:y}=s;this._fillPos(a,r,i,n,10*o.x,10*o.y,y.x,y.y+y.h),p&&this._fillData(a,c,ut,s.glyphOffset,e,f,e.axis,e.angleR),this._fillFnTypeData(a,W,V,U,$,N,H,j,q,G,X,B,rt,J,Z,Y,K,tt),this._fillPos(a,r,i,n,10*h.x,10*h.y,y.x+y.w,y.y+y.h),p&&this._fillData(a,c,ut,s.glyphOffset,e,f,e.axis,e.angleR),this._fillFnTypeData(a,W,V,U,$,N,H,j,q,G,X,B,rt,J,Z,Y,K,tt),this._fillPos(a,r,i,n,10*u.x,10*u.y,y.x,y.y),p&&this._fillData(a,c,ut,s.glyphOffset,e,f,e.axis,e.angleR),this._fillFnTypeData(a,W,V,U,$,N,H,j,q,G,X,B,rt,J,Z,Y,K,tt),this._fillPos(a,r,i,n,10*d.x,10*d.y,y.x+y.w,y.y),p&&this._fillData(a,c,ut,s.glyphOffset,e,f,e.axis,e.angleR),this._fillFnTypeData(a,W,V,U,$,N,H,j,q,G,X,B,rt,J,Z,Y,K,tt),this.addElements(l,l+1,l+2),this.addElements(l+1,l+2,l+3),l+=4;const m=Math.max(Math.abs(r),Math.abs(i),Math.abs(n));m>this.maxPos&&(this.maxPos=m)}}}_fillPos(t,e,n,r,i,s,a,o){this.fillPosition(t,e,n,r),t.aShape.push(i,s),t.aTexCoord.push(a,o)}_fillData(t,e,n,r,i,s,a,o){if(t.aCount.push(n),e){t.aGlyphOffset.push(r[0],r[1]),this._is3DPitchText()&&t.aPitchRotation.push(a[0],a[1],o);const e=i.startIndex;t.aSegment.push(i.segment+e,e,i.line.length),t.aVertical.push(s)}}_fillFnTypeData(t,e,n,r,i,s,a,o,l,h,u,c,p,f,d,y,m,g){const{textFillFn:x,textSizeFn:v,textHaloFillFn:b,textHaloRadiusFn:w,textHaloOpacityFn:k,textDxFn:A,textDyFn:_,textPitchAlignmentFn:F,textRotationAlignmentFn:P,textRotationFn:z,textAllowOverlapFn:M,textIgnorePlacementFn:T,textOpacityFn:S,markerWidthFn:C,markerHeightFn:D,markerDxFn:I,markerDyFn:E,markerPitchAlignmentFn:O,markerRotationAlignmentFn:L,markerRotationFn:R,markerAllowOverlapFn:W,markerIgnorePlacementFn:V,markerOpacityFn:U}=this._fnTypes;x&&t.aTextFill.push(...e),v&&t.aTextSize.push(n),b&&t.aTextHaloFill.push(...r),w&&t.aTextHaloRadius.push(i),k&&t.aTextHaloOpacity.push(s),A&&t.aTextDx.push(a),_&&t.aTextDy.push(o),C&&t.aMarkerWidth.push(l),D&&t.aMarkerHeight.push(h),I&&t.aMarkerDx.push(u),E&&t.aMarkerDy.push(c),(U||S)&&t.aColorOpacity.push(p),(F||O)&&t.aPitchAlign.push(f),(L||P)&&t.aRotationAlign.push(d),(R||z)&&t.aRotation.push(9362*y);const $=W||M,N=V||T;($||N)&&t.aOverlap.push(($?8:0)+4*m+((N?2:0)+g)),i>0&&(this.properties.hasHalo=1)}_getAnchors(t,e,n){const{feature:r,symbol:i}=t,s=this._getPlacement(t,i),a=r.properties,{markerSpacingFn:o,textSpacingFn:l,textMaxAngleFn:h}=this._fnTypes,u=((o?o(null,a):i.markerSpacing)||(l?l(null,a):i.textSpacing)||250)*n;let c=h?h(this.options.zoom,a):i.textMaxAngle;lt$4(c)&&(c=80),c*=Math.PI/180;const p=this.options.EXTENT,f=this.options.altitudeToTileScale,d=this._is3DPitchText();return ws$3(t,this.lineVertex,c,e,n,p,s,u,d,f)}_getPlacement(t,e){let n;return n=this._fnTypes.markerPlacementFn?this._fnTypes.markerPlacementFn(this.options.zoom,t.feature.properties):e.markerPlacement||this._textPlacement,this._packMarkerPlacement||!e.markerPlacement&&!e.isIconText||(this._packMarkerPlacement=n),!this._textPlacement||e.isIconText||this._packTextPlacement||(this._packTextPlacement=n),n}getPackSDFFormat(t){if("line"!==this._textPlacement||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this._is3DPitchText()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class zs$2{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new zs$2(this)}_unit(){return this._div(this.mag()),this}_div(t){return this.x/=t,this.y/=t,this.z/=t,this}_perp(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone()._add(t)}sub(t){return this.clone()._sub(t)}_add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}_sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone()._mult(t)}_mult(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var e=t.x-this.x,n=t.y-this.y,r=t.z-this.z;return e*e+n*n+r*r}_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const Ms$2=Math.cos(Math.PI/180*37.5),Ts$2=Math.pow(2,16)/1,Ss$2=new pointGeometry,Cs$2=new pointGeometry,Ds$2=new pointGeometry;class Is$2 extends $r$3{constructor(t,e,n){super(t,e,n);let r=!1;const{lineDasharrayFn:i,lineDashColorFn:s}=this._fnTypes;this.hasGradient=this.symbol.lineGradientProperty,i&&(r=function(t,e,n){for(let r=0;r<t.length;r++)if(n(e,t[r].properties))return!0;return!1}(t,this.options.zoom,i),r&&(this.dasharrayFn=i)),this.hasDasharray=Ls$2(this.symbol.lineDasharray)||r,this.hasDasharray&&s&&(this.dashColorFn=s)}createStyledVector(t,e,n,r,i){const s=new ct$4(t,e,n,r),a=s.getLineResource();return!this.options.atlas&&a&&(i[a]=[0,0]),s}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:e,lineStrokeColorFn:n,lineColorFn:r,lineOpacityFn:i,lineDxFn:s,lineDyFn:a,linePatternAnimSpeedFn:o,linePatternGapFn:l}=this._fnTypes,h=[...this.getPositionFormat()];if(h.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),h.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&h.push({type:Uint8Array,width:1,name:"aLineWidth"}),e&&h.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&h.push({type:Uint8Array,width:4,name:"aColor"}),n&&h.push({type:Uint8Array,width:4,name:"aStrokeColor"}),i&&h.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&h.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&h.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();h.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(s||a)&&h.push({type:Int8Array,width:2,name:"aLineDxDy"}),(o||l)&&h.push({type:Int8Array,width:2,name:"aLinePattern"}),h}placeVector(t){const{lineJoinFn:e,lineCapFn:r,lineWidthFn:i,lineHeightFn:s,lineStrokeWidthFn:a,lineStrokeColorFn:o,lineColorFn:l,lineOpacityFn:h,lineDxFn:u,lineDyFn:c,linePatternAnimSpeedFn:p,linePatternGapFn:f}=this._fnTypes,d=this.symbol,y=t.feature,m=y.properties;let g=d.lineJoin||"miter",x=d.lineCap||"butt";if(e&&(g=e(this.options.zoom,m)||"miter"),r&&(x=r(this.options.zoom,m)||"butt"),i){let t=i(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLineWidth=1,t=4),$$4(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+d.lineWidth;if(s){let t=s(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLineHeight=1),$$4(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+d.lineHeight||this.feaLineWidth;if(a){let t=a(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLineStrokeWidth=1,t=0),$$4(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=d.lineStrokeWidth||0;if(l&&(this.feaColor=l(this.options.zoom,m)||[255,255,255,255],isFunctionDefinition(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=Q$5([],this.feaColor)),o&&(this.feaStrokeColor=o(this.options.zoom,m)||[0,0,0,255],isFunctionDefinition(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=Q$5([],this.feaStrokeColor)),h){let t=h(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aOpacity=1,t=1),$$4(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,m)||[0,0,0,0];if(isFunctionDefinition(t)&&(this.dynamicAttrs.aDasharray=1,t=[0,0,0,0]),t.length<4){const e=t;1===t.length?t=[e[0],e[0],e[0],e[0]]:2===t.length?t=[e[0],e[1],e[0],e[1]]:3===t.length&&(t=[e[0],e[1],e[2],e[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,m):this.symbol.lineDashColor)||[0,0,0,0];isFunctionDefinition(t)&&(this.dynamicAttrs.aDashColor=1,t=[0,0,0,0]),t=Q$5([],t),this.feaDashColor=t}if(this.iconAtlas){const e=t.getLineResource(),n=this.iconAtlas.glyphMap[e];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],n){const{tl:t,displaySize:n}=this.iconAtlas.positions[e];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=n[0]-3,this.feaTexInfo[3]=n[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(u){let t=u(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),$$4(t)&&(t=0),this.feaLineDx=t}if(c){let t=c(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),$$4(t)&&(t=0),this.feaLineDy=t}if(p){let t=p(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,t=0),$$4(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(f){let t=f(this.options.zoom,m);isFunctionDefinition(t)&&(this.dynamicAttrs.aLinePatternGap=1,t=0),$$4(t)&&(t=0),this.feaLinePatternGap=t}const v=this.options.EXTENT;let b=y.geometry;if(v!==1/0){b=[];const t=[];for(let e=0;e<y.geometry.length;e++){t[0]=y.geometry[e];const n=us$3(t,-1,-1,v+1,v+1);if(3===y.type&&n.length>1){const t=n[0],e=n[n.length-1];Us$2(t[0],e[e.length-1])&&(n[0]=e.concat(t.slice(1)),n.length=n.length-1)}b.push(...n)}}const w=this.needAltitudeAttribute()?2:3;for(let t=0;t<b.length;t++)this.offset=this.data.aPosition.length/w,this._addLine(b[t],y,g,x,2,1.05)}_hasPattern(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}_addLine(t,e,n,r,i,s){const a=this._hasPattern()||Ls$2(this.feaDash)||Ls$2(this.symbol.lineDasharray),o=this.options.isTube;o&&(t=t.map((t=>new zs$2(t)))),this.overscaling=1;const l=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&e.properties&&N$4(e.properties.mapbox_clip_start)&&N$4(e.properties.mapbox_clip_end)){this.clipStart=+e.properties.mapbox_clip_start,this.clipEnd=+e.properties.mapbox_clip_end;for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance()}const h=3===e.type&&!t.clipped;let u=t.length;for(;u>=2&&Us$2(t[u-1],t[u-2]);)u--;let c=0;for(;c<u-1&&Us$2(t[c],t[c+1]);)c++;if(u<(h?3:2))return;"bevel"===n&&(i=1.05);const p=this.overscaling<=16?15*l/(512*this.overscaling):0,f={vertexLength:0,primitiveLength:0,currentNormal:null};let d,y,m,g,x;this.e1=this.e2=-1,h&&(d=t[u-2],x=t[c].sub(d)._unit()._perp());for(let e=c;e<u;e++){if(m=e===u-1?h?t[c+1]:void 0:t[e+1],m&&Us$2(t[e],m))continue;x&&(g=x),d&&(y=d),d=t[e],m&&d.x===m.x&&d.y===m.y&&(d.x+=1e-4),x=m?m.sub(d)._unit()._perp():g,f.dir=y?d.sub(y)._unit():m.sub(d)._unit(),g=g||x,f.currentNormal=g;let l=g.add(x);0===l.x&&0===l.y||l._unit();const v=g.x*x.x+g.y*x.y,b=l.x*x.x+l.y*x.y,w=0!==b?1/b:1/0,k=2*Math.sqrt(2-2*b),A=b<Ms$2&&y&&m,_=g.x*x.y-g.y*x.x>0;if(!o&&A&&e>c){const t=d.dist(y);if(t>2*p){const e=d.sub(d.sub(y)._mult(p/t)._round());e.z=d.z,this.updateDistance(y,e),this.addCurrentVertex(e,g,0,0,f),y=e}}const F=y&&m;f.middleVertex=F;let P=F?n:h?"butt":r;if(F&&"round"===P&&(w<s?P="miter":w<=2&&(P="fakeround")),"miter"===P&&w>i&&!o&&(P="bevel"),"bevel"===P&&(w>2&&(P="flipbevel"),w<i&&(P="miter")),y&&this.updateDistance(y,d),"miter"===P)o?(this.addCurrentVertex(d,g,0,0,f),f.dir=m.sub(d)._unit(),this.addCurrentVertex(d,x,0,0,f)):(l._mult(w),this.addCurrentVertex(d,l,0,0,f),a&&(f.currentNormal=x,this.addCurrentVertex(d,l,0,0,f)));else if("flipbevel"===P){if(w>100)l=x.mult(-1);else{const t=w*g.add(x).mag()/g.sub(x).mag();l._perp()._mult(t*(_?-1:1))}this.addCurrentVertex(d,l,0,0,f),this.addCurrentVertex(d,l.mult(-1),0,0,f)}else if("bevel"===P||"fakeround"===P){const t=-Math.sqrt(w*w-1),e=_?t:0,n=_?0:t;if(y&&this.addCurrentVertex(d,g,e,n,f),"fakeround"===P){const t=Math.round(180*k/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+v*(v*(3.55645-1.43519*v)-3.2452))*t*t+(.848013+v*(.215638*v-1.06021)))}const r=x.sub(g)._mult(n)._add(g)._unit()._mult(_?-1:1);this.addHalfVertex(d,r.x,r.y,!1,_,0,f)}}m&&(f.currentNormal=x,this.addCurrentVertex(d,x,-e,-n,f))}else if("butt"===P)this.addCurrentVertex(d,l,0,0,f);else if("square"===P){const t=y?1:-1;this.addCurrentVertex(d,l,t,t,f)}else"round"===P&&(y&&(this.addCurrentVertex(d,g,0,0,f),this.addCurrentVertex(d,g,1,1,f,!0)),m&&(this.addCurrentVertex(d,x,-1,-1,f,!0),this.addCurrentVertex(d,x,0,0,f)));if(!o&&A&&e<u-1){const t=d.dist(m);if(t>2*p){const e=d.add(m.sub(d)._mult(p/t)._round());e.z=d.z,this.updateDistance(d,e),this.addCurrentVertex(e,x,0,0,f),d=e}}}}addCurrentVertex(t,e,n,r,i,s=!1){const a=e.x+e.y*n,o=e.y-e.x*n,l=e.y*r-e.x,h=-e.y-e.x*r;let u=0,c=0;if(i.middleVertex){Ss$2.x=a,Ss$2.y=o,Cs$2.x=l,Cs$2.y=h;const t=i.currentNormal;if(u=Vs$2(t,Ss$2),0===n&&0===r)c=-u;else{const e=Ds$2;e.x=t.x,e.y=t.y,e._mult(-1),c=Vs$2(e,Cs$2)}}this.addHalfVertex(t,a,o,s,!1,n,i,u),this.addHalfVertex(t,l,h,s,!0,-r,i,c),this.prevVertex&&Us$2(t,this.prevVertex)||(this.prevVertex=t),this.distance>Ts$2/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,e,n,r,i,s))}addHalfVertex({x:t,y:e,z:n},r,i,s,a,o,l,h){this.fillData(this.data,t,e,n||0,r,i,s,a,1*this.scaledDistance,h);const u=l.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,u),l.primitiveLength++),a?this.e2=u:this.e1=u}fillData(t,e,n,r,i,s,a,o,l,h){const{lineWidthFn:u,lineStrokeWidthFn:c,lineStrokeColorFn:p,lineColorFn:f,lineOpacityFn:d,lineDxFn:y,lineDyFn:m,linePatternAnimSpeedFn:g,linePatternGapFn:x}=this._fnTypes;this.fillPosition(t,e,n,r);let v=63*i;v=(Math.sign(v)||1)*((Math.floor(Math.abs(v))>>1<<1)+ +a);let b=63*s;b=(Math.sign(b)||1)*((Math.floor(Math.abs(b))>>1<<1)+ +o),t.aExtrude.push(v,b),(this.iconAtlas||this.hasDasharray)&&t.aExtrude.push(63*h),t.aLinesofar.push(l),u&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),c&&t.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),f&&t.aColor.push(...this.feaColor),p&&t.aStrokeColor.push(...this.feaStrokeColor),d&&t.aOpacity.push(this.feaOpacity),this.dasharrayFn&&t.aDasharray.push(...this.feaDash),this.dashColorFn&&t.aDashColor.push(...this.feaDashColor),this.iconAtlas&&t.aTexInfo.push(...this.feaTexInfo),(y||m)&&t.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||x)&&t.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(e)+1,Math.abs(n)+1)}addElements(t,e,n){super.addElements(this.offset+t,this.offset+e,this.offset+n)}_filterPolygonEdges(t){const e=this.options.EXTENT,n=this.elements;for(let r=0;r<n.length;r+=3)e!==1/0&&(Os$2(this.data.aPosition,n[r],n[r+1],3,e)||Os$2(this.data.aPosition,n[r+1],n[r+2],3,e))||t.push(n[r],n[r+1],n[r+2])}_filterLine(t){if(t.length<=1)return t;const e=[],n=this.options.EXTENT;let r,i=!0;for(r=0;r<t.length-1;r++){const s=Es$2(t[r],t[r+1],n);s&&i||(e.push(t[r]),i=s)}return i||e.push(t[r]),e}updateDistance(t,e){if(this.options.isTube){const n=t.dist(e),r=Z$5(this.options)*(e.z-t.z);this.distance+=Math.sqrt(n*n+r*r)}else this.distance+=t.dist(e);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Ts$2-1):this.distance}}function Es$2(t,e,n){return n!==1/0&&(t.x<0&&e.x<0||t.x>n&&e.x>n||t.y<0&&e.y<0||t.y>n&&e.y>n)}function Os$2(t,e,n,r,i){if(i===1/0)return!1;const s=Math.floor(.5*t[e*r]),a=Math.floor(.5*t[e*r+1]),o=Math.floor(.5*t[n*r]),l=Math.floor(.5*t[n*r+1]);return s===o&&(s<0||s>i)&&a!==l||a===l&&(a<0||a>i)&&s!==o}function Ls$2(t){if(!Array.isArray(t))return!1;for(let e=0;e<t.length;e++)if(t[e])return!0;return!1}const Rs$2=new pointGeometry(0,0),Ws$2=new pointGeometry(0,0);function Vs$2(t,e){const n=t.mag(),r=e.mag();Rs$2.x=e.x,Rs$2.y=e.y;const i=t.angleTo(Ws$2),s=e.angleTo(Ws$2);return Math.sign(s-i)*Math.sqrt(r*r-n*n)}function Us$2(t,e){return t.equals(e)&&t.z===e.z}
/*!
	 * from @turf/bboxClip
	 * https://github.com/Turfjs/turf
	 * MIT LICENSE
	 */const Gs$2=[],Xs$2=[];function Bs$2(e,n){var r,i,s,a,o,l,h;for(i=1;i<=8;i*=2){for(r=[],a=!(Zs$2(s=e[e.length-1],n)&i),o=0;o<e.length;o++){if((h=!(Zs$2(l=e[o],n)&i))!==a){const e=Js$2(s,l,i,n);r.push(void 0!==l.x?new pointGeometry(e[0],e[1]):e)}h&&r.push(l),s=l,a=h}if(!(e=r).length)break}return r}function Js$2(t,e,n,r){return Gs$2[0]=void 0===t.x?t[0]:t.x,Gs$2[1]=void 0===t.y?t[1]:t.y,t=Gs$2,Xs$2[0]=void 0===e.x?e[0]:e.x,Xs$2[1]=void 0===e.y?e[1]:e.y,e=Xs$2,8&n?[t[0]+(e[0]-t[0])*(r[3]-t[1])/(e[1]-t[1]),r[3]]:4&n?[t[0]+(e[0]-t[0])*(r[1]-t[1])/(e[1]-t[1]),r[1]]:2&n?[r[2],t[1]+(e[1]-t[1])*(r[2]-t[0])/(e[0]-t[0])]:1&n?[r[0],t[1]+(e[1]-t[1])*(r[0]-t[0])/(e[0]-t[0])]:null}function Zs$2(t,e){Gs$2[0]=void 0===t.x?t[0]:t.x,Gs$2[1]=void 0===t.y?t[1]:t.y;var n=0;return(t=Gs$2)[0]<e[0]?n|=1:t[0]>e[2]&&(n|=2),t[1]<e[1]?n|=4:t[1]>e[3]&&(n|=8),n}const Ys$2=[0,0,0,0];class Qs$2 extends $r$3{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,e,n,r,i){const s=new ct$4(t,e,n,r),a=s.getPolygonResource();return!this.options.atlas&&a&&(i[a]=[0,0]),s}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:e,polygonOpacityFn:n,uvScaleFn:r,uvOffsetFn:i,polygonPatternUVFn:s}=this._fnTypes;if(this.iconAtlas){const e=this.getIconAtlasMaxValue();t.push({type:e>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return e&&t.push({type:Uint8Array,width:4,name:"aColor"}),n&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),i&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),s&&t.push({type:Float32Array,width:2,name:"aTexCoord"}),t}placeVector(t,e){const n=t.feature;this._addPolygon(n.geometry,n,e)}_addPolygon(t,e){let r,i,s,a;const{polygonFillFn:o,polygonOpacityFn:l,uvScaleFn:h,uvOffsetFn:u,uvOffsetInMeterFn:c,polygonPatternUVFn:d}=this._fnTypes,y=e.properties;o&&(r=o(this.options.zoom,y)||set$3([],255,255,255,255),isFunctionDefinition(r)?(this.dynamicAttrs.aColor=1,r=Ys$2):r=Q$5([],r)),l&&(i=l(this.options.zoom,y),isFunctionDefinition(i)?(this.dynamicAttrs.aOpacity=1,i=255):($$4(i)&&(i=1),i*=255)),h&&(s=h(this.options.zoom,y),isFunctionDefinition(s)?(s=[255,255],this.dynamicAttrs.aUVScale=1):($$4(s)&&(s=[1,1]),s=[255*s[0],255*s[1]])),u&&(c&&c(null,y)?a=[0,0]:(a=u(this.options.zoom,y),isFunctionDefinition(a)?(a=[0,0],this.dynamicAttrs.aUVOffset=1):($$4(a)&&(a=[0,0]),a=[255*a[0],255*a[1]])));const m=!!this.iconAtlas,g=ys$3(t,500),x=[0,0],v=[0,0];if(m){const{polygonPatternFileFn:t}=this._fnTypes,e=t?t(null,y):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[e]){const t=this.iconAtlas.positions[e];x[0]=t.tl[0]+1,x[1]=t.tl[1]+1,v[0]=t.displaySize[0]-3,v[1]=t.displaySize[1]-3}}let b,w=0;d&&(b=d(this.options.zoom,y));const k=this.needAltitudeAttribute()?2:3,A=[-1,-1,e.extent+1,e.extent+1],_=this._flattened=this._flattened||this._arrayPool.get(),F=this._holeIndices=this._holeIndices||this._arrayPool.get();for(let t=0;t<g.length;t++){const e=g[t],n=this.data.aPosition.length/k;_.setLength(0),F.setLength(0);for(let t=0;t<e.length;t++){let n=e[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(n=Bs$2(n,A)),0!==n.length){0!==t&&F.push(_.length/3);for(let t=0;t<n.length;t++){const e=n[t].x,o=n[t].y,l=n[t].z||0;if(this.fillPosition(this.data,e,o,l),m&&this.data.aTexInfo.push(x[0],x[1],v[0],v[1]),void 0!==r&&this.data.aColor.push(r[0],r[1],r[2],r[3]),void 0!==i&&this.data.aOpacity.push(i),void 0!==s&&this.data.aUVScale.push(s[0],s[1]),void 0!==a&&this.data.aUVOffset.push(a[0],a[1]),d){if(b){const t=$$4(b[2*w])?b[0]:b[2*w],e=$$4(b[2*w]+1)?b[1]:b[2*w+1];this.data.aTexCoord.push(t,e)}else this.data.aTexCoord.push(-9999999,-9999999);w++}const h=Math.abs(e),u=Math.abs(o);h>this.maxPos&&(this.maxPos=h),u>this.maxPos&&(this.maxPos=u),_.push(e,o,l)}}}let o=earcut$1.exports(_,F,3);if(_.length&&!o.length){const t=[];for(let e=0;e<_.length;e+=3)t[e]=_[e],t[e+1]=_[e+2],t[e+2]=_[e+1];if(o=earcut$1.exports(t,F,3),!o.length){for(let e=0;e<_.length;e+=3)t[e]=_[e+1],t[e+1]=_[e+2],t[e+2]=_[e];o=earcut$1.exports(t,F,3)}}for(let t=0;t<o.length;t+=3)this.addElements(n+o[t],n+o[t+1],n+o[t+2])}}}class ya$1{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,e){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=e,this.order.push(t)):(this.data[t]=e,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const e=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),e}get(t){return this.has(t)?this.data[t]:null}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}
/*!
	 * based on @mapbox/tiny-sdf
	 * https://github.com/mapbox/tiny-sdf
	 * @License BSD 2-Clause
	 */var ma$1=1e20;function ga$1(t,e,n,r,i,s,a){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=s||"normal",this.fontStyle=a||"normal",this.radius=n||8;var o=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(o,o):document.createElement("canvas"),this.canvas.width=this.canvas.height=o,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(o*o),this.gridInner=new Float64Array(o*o),this.f=new Float64Array(o),this.z=new Float64Array(o+1),this.v=new Uint16Array(o),this.middle=Math.round(o/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function xa$1(t,e,n,r,i,s){for(var a=0;a<e;a++)va$1(t,a,e,n,r,i,s);for(var o=0;o<n;o++)va$1(t,o*e,1,e,r,i,s)}function va$1(t,e,n,r,i,s,a){var o,l,h,u;for(s[0]=0,a[0]=-ma$1,a[1]=ma$1,o=0;o<r;o++)i[o]=t[e+o*n];for(o=1,l=0,h=0;o<r;o++){do{h=(i[o]-i[u=s[l]]+o*o-u*u)/(o-u)/2}while(h<=a[l]&&--l>-1);s[++l]=o,a[l]=h,a[l+1]=ma$1}for(o=0,l=0;o<r;o++){for(;a[l+1]<o;)l++;t[e+o*n]=i[u=s[l]]+(o-u)*(o-u)}}ga$1.prototype.draw=function(t,e,n){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(t,this.buffer,this.buffer);for(var r=this.ctx.getImageData(0,0,e,n),i=new Uint8ClampedArray(e*n),s=0;s<e*n;s++){var a=r.data[4*s+3]/255;this.gridOuter[s]=1===a?0:0===a?ma$1:Math.pow(Math.max(0,.5-a),2),this.gridInner[s]=1===a?ma$1:0===a?0:Math.pow(Math.max(0,a-.5),2)}for(xa$1(this.gridOuter,e,n,this.f,this.v,this.z),xa$1(this.gridInner,e,n,this.f,this.v,this.z),s=0;s<e*n;s++){var o=Math.sqrt(this.gridOuter[s])-Math.sqrt(this.gridInner[s]);i[s]=Math.round(255-255*(o/this.radius+this.cutoff))}return i};let ba$1=0;class wa$1{constructor(t,e=15,n){this.entries={},this._cachedFont={},this._cache=new ya$1(2048,(function(){})),this._framer=t,this._limit=e,this._isCompactChars=n}getGlyphs(t,e){if(!t||!Object.keys(t).length)return void e(null,{glyphs:null});const n=this.entries,r=t.options;let i=!0;r&&(i=!1!==r.isCharsCompact),i=i||this._isCompactChars;const s=(r,s,o)=>{let l=0,h=0;for(const e in t)if("options"!==e){n[e]=n[e]||{},s[e]=s[e]||{};for(const u in t[e]){if(h++,h<=r)continue;const t=e.split(" "),c=i&&"normal"===t[0]&&!ji$2(+u),p=e+":"+u+":"+c;let f;if(this._cache.has(p)?f=this._cache.get(p):(f=this._tinySDF(n[e],t,u,c),this._cache.add(p,f),l++),f=ka$1(f),s[e][u]=f,o.push(f.bitmap.data.buffer),this._framer&&l>this._limit)return void this._framer(a(h,s,o))}}e(null,{glyphs:s,buffers:o})};function a(t,e,n){return()=>{s(t,e,n)}}s(0,{},[])}_tinySDF(t,e,n,r){const i=e[0],s=e[1],a=e.slice(3).join(" ");let o=t.tinySDF,l="normal"!==i?5:2;const h=r?-1:2;if(!o){let e="400";/bolder/i.test(s)?e="1000":/bold/i.test(s)?e="900":/medium/i.test(s)?e="500":/light/i.test(s)&&(e="200"),o=t.tinySDF=new ga$1(24,l,8,.25,a,e,i)}const u=String.fromCharCode(n),c=o.ctx.measureText(u),p=Math.round(c.width),f=o.draw(String.fromCharCode(n),p+2*l,24+2*l);if(ba$1<4){const t="undefined"!=typeof document&&document.getElementById("sdf-debug-"+ba$1++);t&&(t.width=p+2*l,t.height=o.canvas.height,t.getContext("2d").drawImage(o.canvas,0,0))}return{charCode:n,bitmap:{width:p+2*l,height:24+2*l,data:f},metrics:{width:p,height:24,left:1,top:-l,advance:p+l+h}}}}function ka$1(t){const e={width:t.bitmap.width,height:t.bitmap.height,data:new Uint8ClampedArray(t.bitmap.data)};return{charCode:t.charCode,bitmap:e,metrics:U$4({},t.metrics)}}class Aa$1{constructor(t){this.options=t||{},this._requesting={},this._cache=new ya$1(256,(function(){}));const e=document.createElement("canvas");this.ctx=e.getContext("2d",{willReadFrequently:!0})}getIcons(t,e){if(!t||!Object.keys(t).length)return void e(null,{icons:null});const n=Object.keys(t),r={},i=[];let s=0,a=0;const o=this;function l(t,n){r[t]=o._getCache(t,n),r[t]&&"error"!==r[t]?i.push(r[t].data.data.buffer):delete r[t],a++,a===s&&e(null,{icons:r,buffers:i})}function h(t){const e=o._requesting[t.url];for(let n=0;n<e.length;n++)e[n].call(t,t.url,t.size);delete o._requesting[t.url]}function u(){const t=o.ctx;let e,n;try{e=this.width,n=this.height,this.size[0]=e,this.size[1]=n,o._ensureMaxSize(null,this.size),e=this.size[0],n=this.size[1],t.canvas.width=e,t.canvas.height=n,t.imageSmoothingEnabled=!1,t.drawImage(this,0,0,e,n);const r=t.getImageData(0,0,e,n).data;o._addCache(this.url,r,e,n)}catch(t){console.warn(t)}h(this)}function c(t){console.warn(`failed loading icon(${this.index}) at "${this.url}"`),console.warn(t),o.options.iconErrorUrl?this.src=o.options.iconErrorUrl:(o._addCache(this.url),h(this))}let p,f=!1;for(let e=0;e<n.length;e++){const a=n[e],o=t[a];this._ensureMaxSize(a,o);const h=this._getCache(a,o);if(h&&"error"!==h){r[a]=this._getCache(a,o);continue}if("error"===h)continue;let d,y=a;if(0===a.indexOf("vector://")&&(d=JSON.parse(a.substring("vector://".length)),"path"===d.markerType&&(y=t$1.Util.getMarkerPathBase64(d,d.markerWidth,d.markerHeight))),0===a.indexOf("vector://")&&"path"!==d.markerType){p=p||new t$1.Marker([0,0]);const{markerFill:t,markerLineColor:e}=d;t&&Array.isArray(t)&&(d.markerFill=_a$1(t)),e&&Array.isArray(e)&&(d.markerLineColor=_a$1(e)),delete d.markerHorizontalAlignment,delete d.markerVerticalAlignment,delete d.markerDx,delete d.markerDy,delete d.markerPlacement,delete d.markerFile,d.markerWidth=o[0],d.markerHeight=o[1],p.setSymbol(d);const n=p["_getSprite".trim()]();if(n){const t=n.canvas,e=t.width,s=t.height,o=t.getContext("2d").getImageData(0,0,e,s).data;r[a]={data:{data:new Uint8ClampedArray(o),width:e,height:s},url:a},i.push(r[a].data.data.buffer),this._addCache(a,o,e,s)}}else{if(this._requesting[a]){f=!0,s++,this._requesting[a].push(l);continue}this._requesting[a]=[],this._requesting[a].push(l);const t=new Image;t.index=e,t.size=o,t.onload=u,t.onerror=c,t.onabort=c,t.url=a,t.crossOrigin="Anonymous",f=!0,s++,t.src=y}}f||e(null,{icons:r,buffers:i})}_hasCache(t,e,n){const r=this._cache.get(t);return r&&"error"!==r&&r.data.width>=e&&r.data.height>=n}_addCache(t,e,n,r){this._hasCache(t,n,r)||this._cache.add(t,e?{data:{data:e,width:n,height:r},url:t}:"error")}_getCache(t,e){if(!this._hasCache(t,e[0],e[1]))return null;const n=this._cache.get(t);return n?"error"===n?n:{data:{data:new Uint8ClampedArray(n.data.data),width:n.data.width,height:n.data.height},url:n.url}:null}_ensureMaxSize(t,e){if(!e[0]||!e[1])return;const n=this.options.maxSize||2048;let[r,i]=e;const s=r/i;if(t){const e=this._cache.get(t);if(e&&"error"!==e){const{width:t,height:n}=e.data;t>r&&(r=t),n>i&&(i=n)}}r>n&&(i=n/s,r=n),i>n&&(r=n*s,i=n),e[0]=Math.floor(r),e[1]=Math.floor(i)}}function _a$1(t){return 3===t.length&&t.push(1),t.reduce(((t,e,n)=>t+(n<3?255*e+",":e+")")),"rgba(")}var Fa=Object.freeze({__proto__:null,clipPolygon:Bs$2,calculateSignedArea:rt$4,getFeaAltitudeAndHeight:at$4,generatePickingIndiceIndex:ut$4,convertRTLText:as$3,packPosition:pt$4,unpackPosition:function(t,e,n,r){const i=(Math.sign(e)||1)*(Math.abs(e)%ft$4),s=(Math.sign(n)||1)*(Math.abs(n)%ft$4),a=Math.floor(Math.abs(e)/ft$4),o=Math.floor(Math.abs(n)/ft$4);return t[0]=i,t[1]=s,t[2]=Math.sign(r+1e-5)*(2*a+o)*dt$4+r,t},convertGeometry:V$4,getPosArrayType:L$4,getUnsignedArrayType:R$4,getIndexArrayType:O$4});const Pa$1={},za={},Ma$1=[];var Ta$1=Object.freeze({__proto__:null,loadSymbolFnTypes:function t(e,i){if(!e)return null;var s=!1;if(Array.isArray(e)){var a,o=[];for(let n=0;n<e.length;n++)(a=t(e[n],i))?(o.push(a),s=!0):o.push(e[n]);return s?o:e}var l={__fn_types_loaded:!0};const h=[];for(const t in e)X$5(e,t)&&h.push(t);const u=function(t){Object.defineProperty(l,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=interpolated(this["_"+t])),this["__fn_"+t].apply(this,i())},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})},c={},p=function(t,e){Object.defineProperty(l,t,{get:function(){this["__fn_"+t]||(this["__fn_"+t]=wr$3(this["_"+t],e));const n=i()[0];c.zoom=n;try{return this["__fn_"+t].evaluateWithoutErrorHandling(c,Pa$1,za,null,Ma$1)}catch(t){return null}},set:function(e){this["_"+t]=e},configurable:!0,enumerable:!0})};for(let t=0,r=h.length;t<r;t++){const r=h[t];if(isFunctionDefinition(e[r]))s=!0,l["_"+r]=e[r],u(r);else if(kr$3(e[r])){s=!0;const t=zr$3(r);l["_"+r]=e[r],p(r,t)}else l[r]=e[r]}return s?l:e}});const Ca={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1},Da={visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},Ia$1={lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1};function quickselect(arr,k,left,right,compare){quickselectStep(arr,k,left||0,right||arr.length-1,compare||defaultCompare)}function quickselectStep(arr,k,left,right,compare){for(;right>left;){if(right-left>600){var n=right-left+1,m=k-left+1,z=Math.log(n),s=.5*Math.exp(2*z/3),sd=.5*Math.sqrt(z*s*(n-s)/n)*(m-n/2<0?-1:1);quickselectStep(arr,k,Math.max(left,Math.floor(k-m*s/n+sd)),Math.min(right,Math.floor(k+(n-m)*s/n+sd)),compare)}var t=arr[k],i=left,j=right;for(swap(arr,left,k),compare(arr[right],t)>0&&swap(arr,left,right);i<j;){for(swap(arr,i,j),i++,j--;compare(arr[i],t)<0;)i++;for(;compare(arr[j],t)>0;)j--}0===compare(arr[left],t)?swap(arr,left,j):swap(arr,++j,right),j<=k&&(left=j+1),k<=j&&(right=j-1)}}function swap(arr,i,j){var tmp=arr[i];arr[i]=arr[j],arr[j]=tmp}function defaultCompare(a,b){return a<b?-1:a>b?1:0}Object.assign(Da,Ca),Object.assign(Ia$1,Ca);class RBush{constructor(maxEntries=9){this._maxEntries=Math.max(4,maxEntries),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}all(){return this._all(this.data,[])}search(bbox){let node=this.data;const result=[];if(!intersects(bbox,node))return result;const toBBox=this.toBBox,nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?toBBox(child):child;intersects(bbox,childBBox)&&(node.leaf?result.push(child):contains(bbox,childBBox)?this._all(child,result):nodesToSearch.push(child))}node=nodesToSearch.pop()}return result}collides(bbox){let node=this.data;if(!intersects(bbox,node))return!1;const nodesToSearch=[];for(;node;){for(let i=0;i<node.children.length;i++){const child=node.children[i],childBBox=node.leaf?this.toBBox(child):child;if(intersects(bbox,childBBox)){if(node.leaf||contains(bbox,childBBox))return!0;nodesToSearch.push(child)}}node=nodesToSearch.pop()}return!1}load(data){if(!data||!data.length)return this;if(data.length<this._minEntries){for(let i=0;i<data.length;i++)this.insert(data[i]);return this}let node=this._build(data.slice(),0,data.length-1,0);if(this.data.children.length)if(this.data.height===node.height)this._splitRoot(this.data,node);else{if(this.data.height<node.height){const tmpNode=this.data;this.data=node,node=tmpNode}this._insert(node,this.data.height-node.height-1,!0)}else this.data=node;return this}insert(item){return item&&this._insert(item,this.data.height-1),this}clear(){return this.data=createNode([]),this}remove(item,equalsFn){if(!item)return this;let node=this.data;const bbox=this.toBBox(item),path=[],indexes=[];let i,parent,goingUp;for(;node||path.length;){if(node||(node=path.pop(),parent=path[path.length-1],i=indexes.pop(),goingUp=!0),node.leaf){const index=findItem(item,node.children,equalsFn);if(-1!==index)return node.children.splice(index,1),path.push(node),this._condense(path),this}goingUp||node.leaf||!contains(node,bbox)?parent?(i++,node=parent.children[i],goingUp=!1):node=null:(path.push(node),indexes.push(i),i=0,parent=node,node=node.children[0])}return this}toBBox(item){return item}compareMinX(a,b){return a.minX-b.minX}compareMinY(a,b){return a.minY-b.minY}toJSON(){return this.data}fromJSON(data){return this.data=data,this}_all(node,result){const nodesToSearch=[];for(;node;)node.leaf?result.push(...node.children):nodesToSearch.push(...node.children),node=nodesToSearch.pop();return result}_build(items,left,right,height){const N=right-left+1;let node,M=this._maxEntries;if(N<=M)return node=createNode(items.slice(left,right+1)),calcBBox(node,this.toBBox),node;height||(height=Math.ceil(Math.log(N)/Math.log(M)),M=Math.ceil(N/Math.pow(M,height-1))),node=createNode([]),node.leaf=!1,node.height=height;const N2=Math.ceil(N/M),N1=N2*Math.ceil(Math.sqrt(M));multiSelect(items,left,right,N1,this.compareMinX);for(let i=left;i<=right;i+=N1){const right2=Math.min(i+N1-1,right);multiSelect(items,i,right2,N2,this.compareMinY);for(let j=i;j<=right2;j+=N2){const right3=Math.min(j+N2-1,right2);node.children.push(this._build(items,j,right3,height-1))}}return calcBBox(node,this.toBBox),node}_chooseSubtree(bbox,node,level,path){for(;path.push(node),!node.leaf&&path.length-1!==level;){let targetNode,minArea=1/0,minEnlargement=1/0;for(let i=0;i<node.children.length;i++){const child=node.children[i],area=bboxArea(child),enlargement=enlargedArea(bbox,child)-area;enlargement<minEnlargement?(minEnlargement=enlargement,minArea=area<minArea?area:minArea,targetNode=child):enlargement===minEnlargement&&area<minArea&&(minArea=area,targetNode=child)}node=targetNode||node.children[0]}return node}_insert(item,level,isNode){const bbox=isNode?item:this.toBBox(item),insertPath=[],node=this._chooseSubtree(bbox,this.data,level,insertPath);for(node.children.push(item),extend(node,bbox);level>=0&&insertPath[level].children.length>this._maxEntries;)this._split(insertPath,level),level--;this._adjustParentBBoxes(bbox,insertPath,level)}_split(insertPath,level){const node=insertPath[level],M=node.children.length,m=this._minEntries;this._chooseSplitAxis(node,m,M);const splitIndex=this._chooseSplitIndex(node,m,M),newNode=createNode(node.children.splice(splitIndex,node.children.length-splitIndex));newNode.height=node.height,newNode.leaf=node.leaf,calcBBox(node,this.toBBox),calcBBox(newNode,this.toBBox),level?insertPath[level-1].children.push(newNode):this._splitRoot(node,newNode)}_splitRoot(node,newNode){this.data=createNode([node,newNode]),this.data.height=node.height+1,this.data.leaf=!1,calcBBox(this.data,this.toBBox)}_chooseSplitIndex(node,m,M){let index,minOverlap=1/0,minArea=1/0;for(let i=m;i<=M-m;i++){const bbox1=distBBox(node,0,i,this.toBBox),bbox2=distBBox(node,i,M,this.toBBox),overlap=intersectionArea(bbox1,bbox2),area=bboxArea(bbox1)+bboxArea(bbox2);overlap<minOverlap?(minOverlap=overlap,index=i,minArea=area<minArea?area:minArea):overlap===minOverlap&&area<minArea&&(minArea=area,index=i)}return index||M-m}_chooseSplitAxis(node,m,M){const compareMinX=node.leaf?this.compareMinX:compareNodeMinX,compareMinY=node.leaf?this.compareMinY:compareNodeMinY;this._allDistMargin(node,m,M,compareMinX)<this._allDistMargin(node,m,M,compareMinY)&&node.children.sort(compareMinX)}_allDistMargin(node,m,M,compare){node.children.sort(compare);const toBBox=this.toBBox,leftBBox=distBBox(node,0,m,toBBox),rightBBox=distBBox(node,M-m,M,toBBox);let margin=bboxMargin(leftBBox)+bboxMargin(rightBBox);for(let i=m;i<M-m;i++){const child=node.children[i];extend(leftBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(leftBBox)}for(let i=M-m-1;i>=m;i--){const child=node.children[i];extend(rightBBox,node.leaf?toBBox(child):child),margin+=bboxMargin(rightBBox)}return margin}_adjustParentBBoxes(bbox,path,level){for(let i=level;i>=0;i--)extend(path[i],bbox)}_condense(path){for(let siblings,i=path.length-1;i>=0;i--)0===path[i].children.length?i>0?(siblings=path[i-1].children,siblings.splice(siblings.indexOf(path[i]),1)):this.clear():calcBBox(path[i],this.toBBox)}}function findItem(item,items,equalsFn){if(!equalsFn)return items.indexOf(item);for(let i=0;i<items.length;i++)if(equalsFn(item,items[i]))return i;return-1}function calcBBox(node,toBBox){distBBox(node,0,node.children.length,toBBox,node)}function distBBox(node,k,p,toBBox,destNode){destNode||(destNode=createNode(null)),destNode.minX=1/0,destNode.minY=1/0,destNode.maxX=-1/0,destNode.maxY=-1/0;for(let i=k;i<p;i++){const child=node.children[i];extend(destNode,node.leaf?toBBox(child):child)}return destNode}function extend(a,b){return a.minX=Math.min(a.minX,b.minX),a.minY=Math.min(a.minY,b.minY),a.maxX=Math.max(a.maxX,b.maxX),a.maxY=Math.max(a.maxY,b.maxY),a}function compareNodeMinX(a,b){return a.minX-b.minX}function compareNodeMinY(a,b){return a.minY-b.minY}function bboxArea(a){return(a.maxX-a.minX)*(a.maxY-a.minY)}function bboxMargin(a){return a.maxX-a.minX+(a.maxY-a.minY)}function enlargedArea(a,b){return(Math.max(b.maxX,a.maxX)-Math.min(b.minX,a.minX))*(Math.max(b.maxY,a.maxY)-Math.min(b.minY,a.minY))}function intersectionArea(a,b){const minX=Math.max(a.minX,b.minX),minY=Math.max(a.minY,b.minY),maxX=Math.min(a.maxX,b.maxX),maxY=Math.min(a.maxY,b.maxY);return Math.max(0,maxX-minX)*Math.max(0,maxY-minY)}function contains(a,b){return a.minX<=b.minX&&a.minY<=b.minY&&b.maxX<=a.maxX&&b.maxY<=a.maxY}function intersects(a,b){return b.minX<=a.maxX&&b.minY<=a.maxY&&b.maxX>=a.minX&&b.maxY>=a.minY}function createNode(children){return{children,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function multiSelect(arr,left,right,n,compare){const stack=[left,right];for(;stack.length;){if((right=stack.pop())-(left=stack.pop())<=n)continue;const mid=left+Math.ceil((right-left)/n/2)*n;quickselect(arr,mid,left,right,compare),stack.push(left,mid,mid,right)}}
/*!
	* Contains code from jquery.easing
	* BSD License
	* https://github.com/gdsmith/jquery.easing/
	*/var pow=Math.pow,sqrt=Math.sqrt,sin=Math.sin,cos=Math.cos,PI=Math.PI,c1=1.70158,c2=1.525*c1,c3=c1+1,c4=2*PI/3,c5=2*PI/4.5;function bounceOut(x){var n1=7.5625,d1=2.75;return x<1/d1?n1*x*x:x<2/d1?n1*(x-=1.5/d1)*x+.75:x<2.5/d1?n1*(x-=2.25/d1)*x+.9375:n1*(x-=2.625/d1)*x+.984375}function X$4(easing,x){switch(easing=easing.toLowerCase()){case"swing":return function(x){return easeInQuad(x)}(x);case"easeinquad":return easeInQuad(x);case"easeoutquad":return function(x){return 1-(1-x)*(1-x)}(x);case"easeinoutquad":return function(x){return x<.5?2*x*x:1-pow(-2*x+2,2)/2}(x);case"easeincubic":return function(x){return x*x*x}(x);case"easeoutcubic":return function(x){return 1-pow(1-x,3)}(x);case"easeinoutcubic":return function(x){return x<.5?4*x*x*x:1-pow(-2*x+2,3)/2}(x);case"easeinquart":return function(x){return x*x*x*x}(x);case"easeoutquart":return function(x){return 1-pow(1-x,4)}(x);case"easeinoutquart":return function(x){return x<.5?8*x*x*x*x:1-pow(-2*x+2,4)/2}(x);case"easeinquint":return function(x){return x*x*x*x*x}(x);case"easeoutquint":return function(x){return 1-pow(1-x,5)}(x);case"easeinoutquint":return function(x){return x<.5?16*x*x*x*x*x:1-pow(-2*x+2,5)/2}(x);case"easeinsine":return function(x){return 1-cos(x*PI/2)}(x);case"easeoutsine":return function(x){return sin(x*PI/2)}(x);case"easeinoutsine":return function(x){return-(cos(PI*x)-1)/2}(x);case"easeinexpo":return function(x){return 0===x?0:pow(2,10*x-10)}(x);case"easeoutexpo":return function(x){return 1===x?1:1-pow(2,-10*x)}(x);case"easeinoutexpo":return function(x){return 0===x?0:1===x?1:x<.5?pow(2,20*x-10)/2:(2-pow(2,-20*x+10))/2}(x);case"easeincirc":return function(x){return 1-sqrt(1-pow(x,2))}(x);case"easeoutcirc":return function(x){return sqrt(1-pow(x-1,2))}(x);case"easeinoutcirc":return function(x){return x<.5?(1-sqrt(1-pow(2*x,2)))/2:(sqrt(1-pow(-2*x+2,2))+1)/2}(x);case"easeinelastic":return function(x){return 0===x?0:1===x?1:-pow(2,10*x-10)*sin((10*x-10.75)*c4)}(x);case"easeoutelastic":return function(x){return 0===x?0:1===x?1:pow(2,-10*x)*sin((10*x-.75)*c4)+1}(x);case"easeinoutelastic":return function(x){return 0===x?0:1===x?1:x<.5?-pow(2,20*x-10)*sin((20*x-11.125)*c5)/2:pow(2,-20*x+10)*sin((20*x-11.125)*c5)/2+1}(x);case"easeinback":return function(x){return c3*x*x*x-c1*x*x}(x);case"easeoutback":return function(x){return 1+c3*pow(x-1,3)+c1*pow(x-1,2)}(x);case"easeinoutback":return function(x){return x<.5?pow(2*x,2)*(7.189819*x-c2)/2:(pow(2*x-2,2)*((c2+1)*(2*x-2)+c2)+2)/2}(x);case"easeinbounce":return function(x){return 1-bounceOut(1-x)}(x);case"easeoutbounce":return function(x){return bounceOut(x)}(x);case"easeinoutbounce":return function(x){return x<.5?(1-bounceOut(1-2*x))/2:(1+bounceOut(2*x-1))/2}(x)}throw new Error("Unsupported easing function:"+easing)}function easeInQuad(x){return x*x}function VectorTilePlugin(){}const parentProto=VectorTilePlugin.prototype;parentProto.getType=function(){return Object.getPrototypeOf(this).constructor.type},parentProto.isVisible=function(){throw new Error("to be implemented.")},parentProto.prepareRender=function(){throw new Error("to be implemented.")},parentProto.updateCollision=function(){throw new Error("to be implemented.")},parentProto.supportRenderMode=function(){throw new Error("to be implemented.")},parentProto.startFrame=function(){throw new Error("to be implemented.")},parentProto.endFrame=function(){throw new Error("to be implemented.")},parentProto.paintTile=function(){throw new Error("to be implemented.")},parentProto.getShadowMeshes=function(){throw new Error("to be implemented.")},parentProto.updateSceneConfig=function(){throw new Error("to be implemented.")},parentProto.updateDataConfig=function(){throw new Error("to be implemented.")},parentProto.updateSymbol=function(){throw new Error("to be implemented.")},parentProto.pick=function(){throw new Error("to be implemented.")},parentProto.resize=function(){throw new Error("to be implemented.")},parentProto.deleteTile=function(){throw new Error("to be implemented.")},parentProto.remove=function(){throw new Error("to be implemented.")},parentProto.needToRedraw=function(){throw new Error("to be implemented.")},parentProto.needToRetireFrames=function(){throw new Error("to be implemented.")},parentProto.outline=function(){throw new Error("to be implemented.")},parentProto.outlineAll=function(){throw new Error("to be implemented.")},parentProto.needPolygonOffset=function(){throw new Error("to be implemented.")},parentProto.constructor=VectorTilePlugin;const hasOwn=Object.prototype.hasOwnProperty;function registerAt(VectorTileLayer){VectorTileLayer.registerPlugin(this)}
/*!
	 * @maptalks/vt v0.92.3
	 * LICENSE : undefined
	 * (c) 2016-2024 maptalks.org
	 */VectorTilePlugin.extend=function(type,props){const clazz=function(){this.init&&this.init()},proto=Object.create(parentProto);proto.constructor=clazz,clazz.prototype=proto,clazz.type=type;for(const p in props)hasOwn.call(props,p)&&(clazz.prototype[p]=props[p]);return clazz.registerAt=registerAt.bind(clazz),clazz};const q$4='function(t){let n;const e={width:100,height:10};function r(){if(!n){const{width:t,height:r}=e;OffscreenCanvas?n=new OffscreenCanvas(t,r):(n=document.createElement("canvas"),n.width=t,n.height=r)}return n}class i{constructor(t,n={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let r=1/0,i=-1/0;for(let n=0,e=t.length;n<e;n++){const e=t[n][0];r=Math.min(e,r),i=Math.max(e,i)}this.min=r,this.max=i,this.valueOffset=this.max-this.min,this.options=Object.assign({},e,n),this.t()}getImageData(){return this.imgData}t(){const t=r(),{width:n,height:e}=this.options;t.width=n,t.height=e;const i=t.getContext("2d");i.clearRect(0,0,t.width,t.height);const s=i.createLinearGradient(0,0,t.width,0),{colors:o,valueOffset:a}=this;for(let t=0,n=o.length;t<n;t++){const[n,e]=o[t],r=(n-this.min)/a;s.addColorStop(r,e)}i.fillStyle=s,i.fillRect(0,0,t.width,t.height),this.imgData=i.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const n=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let e=Math.round(n*this.imgData.width);e=Math.min(e,this.imgData.width-1);const r=4*e;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}var s;function o(t,n){for(let e=0;e<t.stops.length;e++)if(n===t.stops[e][0])return t.stops[e][1];return t.default}function a(t,n){for(var e=0;e<t.stops.length&&!(n<t.stops[e][0]);e++);return t.stops[Math.max(e-1,0)][1]}function u(t,n){for(var e=void 0!==t.base?t.base:1,r=0;!(r>=t.stops.length||n<=t.stops[r][0]);)r++;return 0===r?t.stops[r][1]:r===t.stops.length?t.stops[r-1][1]:function t(n,e,r,i,s,o){return"function"==typeof s?function(){var a=s.apply(void 0,arguments),u=o.apply(void 0,arguments);return t(n,e,r,i,a,u)}:s.length?function(t,n,e,r,i,s){var o=[];for(let a=0;a<i.length;a++)o[a]=f(t,n,e,r,i[a],s[a]);return o}(n,e,r,i,s,o):f(n,e,r,i,s,o)}(n,e,t.stops[r-1][0],t.stops[r][0],t.stops[r-1][1],t.stops[r][1])}"function"==typeof Map&&(s=new Map);const h={width:100,height:1};function l(t,n){const e=t.stops;if(e&&e.length>1){let t;if(s){const n=JSON.stringify(e);if(!s.has(n)){const t=new i(e,h);s.set(n,t)}t=s.get(n)}else t=new i(e,h);const[r,o,a,u]=t.getColor(n);return[r/255,o/255,a/255,u/255]}return e&&1===e.length?e[0][1]:null}function c(t,n){return function(t,n,e){return void 0!==t?t:void 0!==n?n:void 0!==e?e:null}(n,t.default)}function f(t,n,e,r,i,s){var o,a=r-e,u=t-e;return i*(1-(o=1===n?u/a:(Math.pow(n,u)-1)/(Math.pow(n,a)-1)))+s*o}function d(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function p(t){return g(t,"exponential")}function y(t){return g(t,"interval")}function m(t,n){if(!t)return null;var e=!1;if(Array.isArray(t)){var r,i=[];for(let s=0;s<t.length;s++)(r=m(t[s],n))?(i.push(r),e=!0):i.push(t[s]);return e?i:t}var s,o={__fn_types_loaded:!0},a=[];for(s in t)t.hasOwnProperty(s)&&a.push(s);const u=function(t){Object.defineProperty(o,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=p(this["_"+t])),this["__fn_"+t].apply(this,n())},set:function(n){this["_"+t]=n},configurable:!0,enumerable:!0})};for(let n=0,r=a.length;n<r;n++)d(t[s=a[n]])?(e=!0,o["_"+s]=t[s],u(s)):o[s]=t[s];return e?o:t}function g(t,n){if(!d(t))return function(){return t};let e=!0,r=!0;const i=(t=JSON.parse(JSON.stringify(t))).stops;if(i)for(let t=0;t<i.length;t++)if(d(i[t][1])){const s=g(i[t][1],n);e=e&&s.isZoomConstant,r=r&&s.isFeatureConstant,i[t]=[i[t][0],s]}const s=function t(n,e){var r,i,s;if(d(n)){var h,f=n.stops&&"object"==typeof n.stops[0][0],p=f||void 0!==n.property,y=f||!p,m=n.type||e||"exponential";if("exponential"===m)h=u;else if("interval"===m)h=a;else if("categorical"===m)h=o;else if("identity"===m)h=c;else{if("color-interpolate"!==m)throw new Error(\'Unknown function type "\'+m+\'"\');h=l}if(f){var g={},v=[];for(let t=0;t<n.stops.length;t++){var b=n.stops[t];void 0===g[b[0].zoom]&&(g[b[0].zoom]={zoom:b[0].zoom,type:n.type,property:n.property,default:n.default,stops:[]}),g[b[0].zoom].stops.push([b[0].value,b[1]])}for(let n in g)v.push([g[n].zoom,t(g[n])]);r=function(t,e){const r=u({stops:v,base:n.base},t)(t,e);return"function"==typeof r?r(t,e):r},i=!1,s=!1}else y?(r=function(t){const e=h(n,t);return"function"==typeof e?e(t):e},i=!0,s=!1):(r=function(t,e){const r=h(n,e?e[n.property]:null);return"function"==typeof r?r(t,e):r},i=!1,s=!0)}else r=function(){return n},i=!0,s=!0;return r.isZoomConstant=s,r.isFeatureConstant=i,r}(t,n);return s.isZoomConstant=e&&s.isZoomConstant,s.isFeatureConstant=r&&s.isFeatureConstant,s}let v=0;const b="function"==typeof Object.assign;function w(t,...n){if(b)return Object.assign(t,...n),t;for(let e=0;e<n.length;e++){const r=n[e];for(const n in r)t[n]=r[n]}return t}function M(t){return!k(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function x(t){return"number"==typeof t&&!isNaN(t)}function F(t){return!k(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function A(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function k(t){return null==t}function P(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];if(e)for(let n=0,r=e.length;n<r;n++)t.push(e[n])}return t.length}function S(t){return d(t)&&t.property}const _="function"==typeof fetch&&"function"==typeof AbortController,O={jsonp:function(t,n){const e="_maptalks_jsonp_"+v++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let r=document.createElement("script");return r.type="text/javascript",r.src=t,window[e]=function(t){n(null,t),document.getElementsByTagName("head")[0].removeChild(r),r=null,delete window[e]},document.getElementsByTagName("head")[0].appendChild(r),this},get:function(t,n,e){if(F(n)){const t=e;e=n,n=t}(n=n||{}).method&&(n.method=n.method.toUpperCase());const r="POST"===n.method;if(_){const r=new AbortController,i=n;i.signal=r.signal,i.referrerPolicy=i.referrerPolicy||"origin",i.method=i.method||"GET";const s=new Request(t,i);return n.returnJSON&&s.headers.set("Accept","application/json"),fetch(s).then(r=>{const i=this.s(r,n.returnJSON,n.responseType);i.message?(i.url=t,e(i)):i.then(t=>{"arraybuffer"===n.responseType?e(null,{data:t,cacheControl:r.headers.get("Cache-Control"),expires:r.headers.get("Expires"),contentType:r.headers.get("Content-Type")}):e(null,t)}).catch(n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))})}).catch(n=>{n.code&&n.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,n),e(n))}),r}{const i=O.o(e);if(i.open(n.method||"GET",t,!0),n){for(const t in n.headers)i.setRequestHeader(t,n.headers[t]);i.withCredentials="include"===n.credentials,n.responseType&&(i.responseType=n.responseType)}return i.send(r?n.body:null),i}},s:(t,n,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():n?t.json():t.text(),u:function(t,n){return function(){if(4===t.readyState)if(200===t.status)if("arraybuffer"===t.responseType){0===t.response.byteLength?n({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):n(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")})}else n(null,t.responseText);else n({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`})}},o:function(t){let n;try{n=new XMLHttpRequest}catch(t){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{n=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return n.onreadystatechange=O.u(n,t),n},getArrayBuffer(t,n,e){if(F(n)){const t=e;e=n,n=t}return n||(n={}),n.responseType="arraybuffer",O.get(t,n,e)}};function E(t,n,e,r,i,s){let o=i-e,a=s-r;if(0!==o||0!==a){const u=((t-e)*o+(n-r)*a)/(o*o+a*a);u>1?(e=i,r=s):u>0&&(e+=o*u,r+=a*u)}return o=t-e,a=n-r,o*o+a*a}function I(t,n,e,r,i,s){const o={id:null==t?null:t,type:n,geometry:e,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};i&&(o.layer=i);return function(t,n){const e=t.geometry,r=t.type;if("Point"===r||"MultiPoint"===r||"LineString"===r)$(t,e,n);else if("Polygon"===r)$(t,e[0],n);else if("MultiLineString"===r)for(const r of e)$(t,r,n);else if("MultiPolygon"===r)for(const r of e)$(t,r[0],n)}(o,s?4:3),o}function $(t,n,e){for(let r=0;r<n.length;r+=e)t.minX=Math.min(t.minX,n[r]),t.minY=Math.min(t.minY,n[r+1]),t.maxX=Math.max(t.maxX,n[r]),t.maxY=Math.max(t.maxY,n[r+1])}function C(t,n,e,r){if(r.layer=n,"FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)T(t,e.features[n],r,n);else"Feature"===e.type?T(t,e,r):T(t,{geometry:e},r)}function T(t,n,e,r){if(!n.geometry)return;const i=n.geometry.coordinates,s=n.geometry.type,o=Math.pow(e.tolerance/((1<<e.maxZoom)*e.extent),2);let a=[],u=n.id;if(e.promoteId?u=n.properties[e.promoteId]:e.generateId&&(u=r||0),"Point"===s)z(i,a,e);else if("MultiPoint"===s)for(const t of i)z(t,a,e);else if("LineString"===s)D(i,a,o,!1,e);else if("MultiLineString"===s){if(e.lineMetrics){for(const r of i)a=[],D(r,a,o,!1,e),t.push(I(u,"LineString",a,n.properties,e.layer,e.hasAltitude));return}j(i,a,o,!1,e)}else if("Polygon"===s)j(i,a,o,!0,e);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(const i of n.geometry.geometries)T(t,{id:u,geometry:i,properties:n.properties},e,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const t of i){const n=[];j(t,n,o,!0,e),a.push(n)}}t.push(I(u,s,a,n.properties,e.layer,e.hasAltitude))}function z(t,n,e){n.push(U(t[0]),N(t[1],e.projection),0),e.hasAltitude&&(t.length>2?n.push(t[2]):n.push(0))}function D(t,n,e,r,i){let s,o,a=0;for(let e=0;e<t.length;e++){const u=U(t[e][0]),h=N(t[e][1],i.projection);n.push(u,h,0),i.hasAltitude&&(t[e].length>2?n.push(t[e][2]):n.push(0)),e>0&&(a+=r?(s*h-u*o)/2:Math.sqrt(Math.pow(u-s,2)+Math.pow(h-o,2))),s=u,o=h}const u=i.hasAltitude?4:3,h=n.length-u;n[2]=1,function t(n,e,r,i,s=3){let o=i;const a=r-e>>1;let u,h=r-e;const l=n[e],c=n[e+1],f=n[r],d=n[r+1];for(let t=e+s;t<r;t+=s){const e=E(n[t],n[t+1],l,c,f,d);if(e>o)u=t,o=e;else if(e===o){const n=Math.abs(t-a);n<h&&(u=t,h=n)}}o>i&&(u-e>s&&t(n,e,u,i,s),n[u+2]=o,r-u>s&&t(n,u,r,i,s))}(n,0,h,e,u),n[h+2]=1,n.size=Math.abs(a),n.start=0,n.end=n.size}function j(t,n,e,r,i){for(let s=0;s<t.length;s++){const o=[];D(t[s],o,e,r,i),n.push(o)}}function U(t){return t/360+.5}function N(t,n){switch(n){case"EPSG:4326":return(90-t)/360}const e=Math.sin(t*Math.PI/180),r=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return r<0?0:r>1?1:r}function L(t,n,e,r,i,s,o,a){if(r/=n,s>=(e/=n)&&o<r)return t;if(o<e||s>=r)return null;const u=[];for(const n of t){const t=n.geometry;let s=n.type;const o=0===i?n.minX:n.minY,h=0===i?n.maxX:n.maxY;if(o>=e&&h<r){u.push(n);continue}if(h<e||o>=r)continue;let l=[];if("Point"===s||"MultiPoint"===s)V(t,l,e,r,i,a.hasAltitude);else if("LineString"===s)R(t,l,e,r,i,!1,a.lineMetrics,a.hasAltitude);else if("MultiLineString"===s)W(t,l,e,r,i,!1,a.hasAltitude);else if("Polygon"===s)W(t,l,e,r,i,!0,a.hasAltitude);else if("MultiPolygon"===s)for(const n of t){const t=[];W(n,t,e,r,i,!0,a.hasAltitude),t.length&&l.push(t)}if(l.length){if(a.lineMetrics&&"LineString"===s){for(const t of l)u.push(I(n.id,s,t,n.tags,n.layer,a.hasAltitude));continue}"LineString"!==s&&"MultiLineString"!==s||(1===l.length?(s="LineString",l=l[0]):s="MultiLineString"),"Point"!==s&&"MultiPoint"!==s||(s=3===l.length?"Point":"MultiPoint"),u.push(I(n.id,s,l,n.tags,n.layer,a.hasAltitude))}}return u.length?u:null}function V(t,n,e,r,i,s){const o=s?4:3;for(let a=0;a<t.length;a+=o){const o=t[a+i];o>=e&&o<=r&&(q(n,t[a],t[a+1],t[a+2]),s&&n.push(t[a+3]))}}function R(t,n,e,r,i,s,o,a){let u=H(t);const h=0===i?G:B;let l,c,f=t.start;const d=a?4:3,p=s?t.length:t.length-d;for(let y=0;y<p;y+=d){const m=t[y],g=t[y+1],v=t[y+2];let b,w,M,x;s&&y===p-d?(b=t[0],w=t[1]):(b=t[y+d],w=t[y+d+1]),a&&(M=t[y+3],x=s&&y===p-d?t[3]:t[y+d+3]);const F=0===i?m:g,A=0===i?b:w;let k=!1;o&&(l=Math.sqrt(Math.pow(m-b,2)+Math.pow(g-w,2))),F<e?A>e&&(c=h(u,m,g,b,w,e),a&&u.push(J(M,x,c)),o&&(u.start=f+l*c)):F>r?A<r&&(c=h(u,m,g,b,w,r),a&&u.push(J(M,x,c)),o&&(u.start=f+l*c)):(q(u,m,g,v),a&&u.push(M)),A<e&&F>=e&&(c=h(u,m,g,b,w,e),a&&u.push(J(M,x,c)),k=!0),A>r&&F<=r&&(c=h(u,m,g,b,w,r),a&&u.push(J(M,x,c)),k=!0),!s&&k&&(o&&(u.end=f+l*c),n.push(u),u=H(t)),o&&(f+=l)}let y=t.length-d;if(!s){const n=t[y],s=t[y+1],o=t[y+2],h=0===i?n:s;if(h>=e&&h<=r&&q(u,n,s,o),h>=e&&h<=r&&a){const n=t[y+3];u.push(n)}}y=u.length-d,s&&y>=d&&(u[y]!==u[0]||u[y+1]!==u[1])&&(q(u,u[0],u[1],u[2]),a&&u.push(u[3])),u.length&&n.push(u)}function H(t){const n=[];return n.size=t.size,n.start=t.start,n.end=t.end,n}function W(t,n,e,r,i,s,o){for(const a of t)R(a,n,e,r,i,s,!1,o)}function q(t,n,e,r){t.push(n,e,r)}function G(t,n,e,r,i,s){const o=(s-n)/(r-n);return q(t,s,e+(i-e)*o,1),o}function B(t,n,e,r,i,s){const o=(s-e)/(i-e);return q(t,n+(r-n)*o,s,1),o}function J(t,n,e){return t+(n-t)*e}function X(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=t[i],o=s.type;let a;if("Point"===o||"MultiPoint"===o||"LineString"===o)a=Y(s.geometry,n,e);else if("MultiLineString"===o||"Polygon"===o){a=[];for(const t of s.geometry)a.push(Y(t,n,e))}else if("MultiPolygon"===o){a=[];for(const t of s.geometry){const r=[];for(const i of t)r.push(Y(i,n,e));a.push(r)}}r.push(I(s.id,o,a,s.tags,s.layer,e))}return r}function Y(t,n,e){const r=[];r.size=t.size,void 0!==t.start&&(r.start=t.start,r.end=t.end);const i=e?4:3;for(let s=0;s<t.length;s+=i)r.push(t[s]+n,t[s+1],t[s+2]),e&&r.push(t[s+3]);return r}function Z(t,n,e){if(t.transformed)return t;const r=1<<t.z,i=t.x,s=t.y,o=e?3:2;for(const a of t.features){const t=a.geometry,u=a.type;if(a.geometry=[],1===u)for(let u=0;u<t.length;u+=o)a.geometry.push(K(t[u],t[u+1],n,r,i,s)),e&&a.geometry[a.geometry.length-1].push(t[u+2]);else for(let u=0;u<t.length;u++){const h=[];for(let a=0;a<t[u].length;a+=o)h.push(K(t[u][a],t[u][a+1],n,r,i,s)),e&&h[h.length-1].push(t[u][a+2]);a.geometry.push(h)}}return t.transformed=!0,t}function K(t,n,e,r,i,s){return[Math.round(e*(t*r-i)),Math.round(e*(n*r-s))]}function Q(t,n,e,r,i){const s=n===i.maxZoom?0:i.tolerance/((1<<n)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:t.length,source:null,x:e,y:r,z:n,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const n of t)tt(o,n,s,i);return o}function tt(t,n,e,r){const i=n.geometry,s=n.type,o=[],a=r.hasAltitude?4:3;if(t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),"Point"===s||"MultiPoint"===s)for(let n=0;n<i.length;n+=a)o.push(i[n],i[n+1]),r.hasAltitude&&o.push(i[n+3]),t.numPoints++,t.numSimplified++;else if("LineString"===s)et(o,i,t,e,!1,!1,r);else if("MultiLineString"===s||"Polygon"===s)for(let n=0;n<i.length;n++)et(o,i[n],t,e,"Polygon"===s,0===n,r);else if("MultiPolygon"===s)for(let n=0;n<i.length;n++){const s=i[n];for(let n=0;n<s.length;n++)et(o,s[n],t,e,!0,0===n,r)}if(o.length){let e=n.tags||null;if("LineString"===s&&r.lineMetrics){e={};for(const t in n.tags)e[t]=n.tags[t];e.mapbox_clip_start=i.start/i.size,e.mapbox_clip_end=i.end/i.size}const a={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:e};n.layer&&(a.layer=n.layer),null!==n.id&&(a.id=n.id),t.features.push(a)}}function nt(t,n,e){return 0===t[n+2]&&t[n+3]>0&&e}function et(t,n,e,r,i,s,o){const a=r*r,{hasAltitude:u,disableFilter:h}=o,l=u?4:3;if(!h&&r>0&&n.size<(i?a:r))return void(e.numPoints+=n.length/l);const c=[];for(let t=0;t<n.length;t+=l)(0===r||n[t+2]>a||nt(n,t,u))&&(e.numSimplified++,c.push(n[t],n[t+1]),u&&c.push(n[t+3])),e.numPoints++;i&&function(t,n,e){const r=e?3:2;let i=0;for(let n=0,e=t.length,s=e-r;n<e;s=n,n+=r)i+=(t[n]-t[s])*(t[n+1]+t[s+1]);if(i>0===n){const n=r,i=r-1,s=r-2;for(let o=0,a=t.length;o<a/2;o+=r){const r=t[o],u=t[o+1];let h;e&&(h=t[o+2]),t[o]=t[a-n-o],t[o+1]=t[a-i-o],e&&(t[o+2]=t[a-s-o]),t[a-n-o]=r,t[a-i-o]=u,e&&(t[a-s-o]=h)}}}(c,s,u),t.push(c)}O.getJSON=function(t,n,e){if(F(n)){const t=e;e=n,n=t}const r=function(t,n){const r="string"==typeof n?JSON.parse(n):n||null;e(t,r)};return n&&n.jsonp?O.jsonp(t,r):((n=n||{}).returnJSON=!0,O.get(t,n,r))};const rt={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,hasAltitude:!1,disableFilter:!1,debug:0};class it{constructor(t,n){const e=(n=this.options=function(t,n){for(const e in n)t[e]=n[e];return t}(Object.create(rt),n)).debug;if(e&&console.time("preprocess data"),n.maxZoom<0||n.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(n.promoteId&&n.generateId)throw new Error("promoteId and generateId cannot be used together.");let r=function(t,n){const e=[];if(Array.isArray(t)){for(let r=0;r<t.length;r++)C(e,t[r].layer,t[r].data,n);return e}if("FeatureCollection"===t.type)for(let r=0;r<t.features.length;r++)T(e,t.features[r],n,r);else"Feature"===t.type?T(e,t,n):T(e,{geometry:t},n);return e}(t,n);this.tiles={},this.tileCoords=[],e&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",n.indexMaxZoom,n.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),r=function(t,n){const e=n.buffer/n.extent;let r=t;const i=L(t,1,-1-e,e,0,-1,2,n),s=L(t,1,1-e,2+e,0,-1,2,n);return(i||s)&&(r=L(t,1,-e,1+e,0,-1,2,n)||[],i&&(r=X(i,1,n.hasAltitude).concat(r)),s&&(r=r.concat(X(s,-1,n.hasAltitude)))),r}(r,n),r.length&&this.splitTile(r,0,0,0),e&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(t,n,e,r,i,s,o){const a=[t,n,e,r],u=this.options,h=u.debug;for(;a.length;){r=a.pop(),e=a.pop(),n=a.pop(),t=a.pop();const l=1<<n,c=st(n,e,r);let f=this.tiles[c];if(!f&&(h>1&&console.time("creation"),f=this.tiles[c]=Q(t,n,e,r,u),this.tileCoords.push({z:n,x:e,y:r}),h)){h>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",n,e,r,f.numFeatures,f.numPoints,f.numSimplified),console.timeEnd("creation"));const t="z"+n;this.stats[t]=(this.stats[t]||0)+1,this.total++}if(f.source=t,null==i){if(n===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue}else{if(n===u.maxZoom||n===i)continue;if(null!=i){const t=i-n;if(e!==s>>t||r!==o>>t)continue}}if(f.source=null,0===t.length)continue;h>1&&console.time("clipping");const d=.5*u.buffer/u.extent,p=.5-d,y=.5+d,m=1+d;let g=null,v=null,b=null,w=null,M=L(t,l,e-d,e+y,0,f.minX,f.maxX,u),x=L(t,l,e+p,e+m,0,f.minX,f.maxX,u);t=null,M&&(g=L(M,l,r-d,r+y,1,f.minY,f.maxY,u),v=L(M,l,r+p,r+m,1,f.minY,f.maxY,u),M=null),x&&(b=L(x,l,r-d,r+y,1,f.minY,f.maxY,u),w=L(x,l,r+p,r+m,1,f.minY,f.maxY,u),x=null),h>1&&console.timeEnd("clipping"),a.push(g||[],n+1,2*e,2*r),a.push(v||[],n+1,2*e,2*r+1),a.push(b||[],n+1,2*e+1,2*r),a.push(w||[],n+1,2*e+1,2*r+1)}}getTile(t,n,e){t=+t,n=+n,e=+e;const r=this.options,{extent:i,debug:s}=r,{hasAltitude:o,wrapX:a}=r;if(t<0||t>24)return null;if(a){const e=1<<t;n=n+e&e-1}const u=st(t,n,e);if(this.tiles[u])return Z(this.tiles[u],i,o);s>1&&console.log("drilling down to z%d-%d-%d",t,n,e);let h,l=t,c=n,f=e;for(;!h&&l>0;)l--,c>>=1,f>>=1,h=this.tiles[st(l,c,f)];return h&&h.source?(s>1&&(console.log("found parent tile z%d-%d-%d",l,c,f),console.time("drilling down")),this.splitTile(h.source,l,c,f,t,n,e),s>1&&console.timeEnd("drilling down"),this.tiles[u]?Z(this.tiles[u],i,o):null):null}}function st(t,n,e){return 32*((1<<t)*e+n)+t}function ot(t,n,e,r,i,s,o){const a=e&&Array.isArray(e[0]);for(let u=0,h=e.length;u<h;u++){t[n]=(a?e[u][0]:e[u].x)*r,t[n+1]=(a?e[u][1]:e[u].y)*r,o!==Float32Array&&(t[n]=Math.round(t[n]),t[n+1]=Math.round(t[n+1]));let l=i||0;Array.isArray(i)&&(l=i[u]),l=l?Math.round(r*l):0,t[n+2]=l,n+=3,s&&0!==u&&u!==h-1&&(t[n]=t[n-3],t[n+1]=t[n-2],t[n+2]=t[n-1],n+=3)}return t.trySetLength&&t.trySetLength(n),n}function at(t,n,e,r){const i=t[3*n],s=t[3*n+1],o=t[3*e],a=t[3*e+1];return i===o&&(i<0||i>r)||s===a&&(s<0||s>r)}var ut="undefined"!=typeof Float32Array?Float32Array:Array;function ht(){var t=new ut(3);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function lt(t,n,e){var r=new ut(3);return r[0]=t,r[1]=n,r[2]=e,r}function ct(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t}function ft(t,n,e,r){return t[0]=n,t[1]=e,t[2]=r,t}function dt(t,n,e){return t[0]=n[0]+e[0],t[1]=n[1]+e[1],t[2]=n[2]+e[2],t}function pt(t,n){var e=n[0],r=n[1],i=n[2],s=e*e+r*r+i*i;return s>0&&(s=1/Math.sqrt(s),t[0]=n[0]*s,t[1]=n[1]*s,t[2]=n[2]*s),t}function yt(t,n){return t[0]*n[0]+t[1]*n[1]+t[2]*n[2]}function mt(t,n,e){var r=n[0],i=n[1],s=n[2],o=e[0],a=e[1],u=e[2];return t[0]=i*u-s*a,t[1]=s*o-r*u,t[2]=r*a-i*o,t}var gt=function(t,n,e){return t[0]=n[0]-e[0],t[1]=n[1]-e[1],t[2]=n[2]-e[2],t};function vt(t,n){return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t}function bt(t,n,e,r,i){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t}function wt(t,n,e){return t[0]=n[0]/e[0],t[1]=n[1]/e[1],t[2]=n[2]/e[2],t[3]=n[3]/e[3],t}function Mt(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t[3]=n[3]*e,t}function xt(t,n){return t[0]===n[0]&&t[1]===n[1]&&t[2]===n[2]&&t[3]===n[3]}function Ft(){var t=new ut(4);return ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function At(t,n){var e=n[0]+n[4]+n[8],r=void 0;if(e>0)r=Math.sqrt(e+1),t[3]=.5*r,r=.5/r,t[0]=(n[5]-n[7])*r,t[1]=(n[6]-n[2])*r,t[2]=(n[1]-n[3])*r;else{var i=0;n[4]>n[0]&&(i=1),n[8]>n[3*i+i]&&(i=2);var s=(i+1)%3,o=(i+2)%3;r=Math.sqrt(n[3*i+i]-n[3*s+s]-n[3*o+o]+1),t[i]=.5*r,r=.5/r,t[3]=(n[3*s+o]-n[3*o+s])*r,t[s]=(n[3*s+i]+n[3*i+s])*r,t[o]=(n[3*o+i]+n[3*i+o])*r}return t}!function(){var t=ht()}(),function(){var t,n=(t=new ut(4),ut!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var kt,Pt=Mt,St=function(t,n){var e=n[0],r=n[1],i=n[2],s=n[3],o=e*e+r*r+i*i+s*s;return o>0&&(o=1/Math.sqrt(o),t[0]=e*o,t[1]=r*o,t[2]=i*o,t[3]=s*o),t};function _t(t,n,e){return t[0]=n,t[1]=e,t}function Ot(t,n){var e=n[0]-t[0],r=n[1]-t[1];return Math.sqrt(e*e+r*r)}ht(),lt(1,0,0),lt(0,1,0),Ft(),Ft(),kt=new ut(9),ut!=Float32Array&&(kt[1]=0,kt[2]=0,kt[3]=0,kt[5]=0,kt[6]=0,kt[7]=0),kt[0]=1,kt[4]=1,kt[8]=1;var Et=function(t){var n=t[0],e=t[1];return Math.sqrt(n*n+e*e)};!function(){var t=function(){var t=new ut(2);return ut!=Float32Array&&(t[0]=0,t[1]=0),t}()}();const It=Math.PI/180,$t=6378137*Math.PI/180;function Ct(t,n,e){if("EPSG:3857"===e)return function(t,n){const e=85.0511287798,r=n[0],i=Math.max(Math.min(e,n[1]),-e);let s;s=0===i?0:Math.log(Math.tan((90+i)*It/2))/It;return t[0]=r*$t,t[1]=s*$t,t}(t,n);if("EPSG:4326"===e||"EPSG:4490"===e||"identity"===e)return Tt(t,n);if("baidu"===e)return Tt(t,n);throw new Error("unsupported projection:"+e)}function Tt(t,n){return t[0]=n[0],t[1]=n[1],t}function zt(t,n,e,r,i,s,o,a,u,h,l,c,f,d,p){0===t?function(t,n,e,r,i,s,o,a,u,h){const l=1/(100*s[0]),c=1/(100*s[1]),f=h&&h[0]||0,d=h&&h[1]||0,p=[0,0];for(let i=t;i<n;i+=3){const t=i/3*2,n=r[i]-f,s=r[i+1]-d;e[t]=p[0]+n/o*l/a,e[t+1]=p[1]-s/o*c/u}}(n,e,r,i,0,o,a,u,h,p):1===t&&function(t,n,e,r,i,s,o,a,u,h,l){if(!t)return;let c,f,d,p;0===t[4]?(c=t[0],f=t[1],d=t[2],p=t[3]):(c=t[1],f=t[2],d=t[3],p=t[0]);const y=Ot(c,f),m=Ot(f,d),g=[],v=[],b=[];for(let t=n;t<e;t+=3){const n=t/3*2,e=(s.x/u+i[t]/o)*a,d=s.y/u*a+(l?i[t+1]:-i[t+1])/o*a;_t(g,e,d),"EPSG:4326"!==h&&"EPSG:4490"!==h||Ct(g,g,"EPSG:3857"),Dt(v,g,c,f),Dt(b,g,p,c),r[n]=Ot(c,v)/y,r[n+1]=Ot(c,b)/m}}(l,n,e,r,i,s,a,c,f,d,!!p)}function Dt(t,n,e,r){const i=e[0]-r[0],s=e[1]-r[1];let o=(n[0]-e[0])*(e[0]-r[0])+(n[1]-e[1])*(e[1]-r[1]);return o/=i*i+s*s,t[0]=e[0]+o*i,t[1]=e[1]+o*s,t}function jt(t,n,e,r,i){const s=3*n[e-1],o=3*n[e-1]+1,a=t[s],u=t[o];return h=r,l=i,c=a,f=u,Math.sqrt((c-h)*(c-h)+(f-l)*(f-l));var h,l,c,f}"undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self&&self;var Ut=Nt;function Nt(t,n){this.x=t,this.y=n}function Lt(t,n,e){e=e||{},this.w=t||64,this.h=n||64,this.autoResize=!!e.autoResize,this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0}function Vt(t,n,e){this.x=0,this.y=t,this.w=this.free=n,this.h=e}function Rt(t,n,e,r,i,s,o){this.id=t,this.x=n,this.y=e,this.w=r,this.h=i,this.maxw=s||r,this.maxh=o||i,this.refcount=0}Nt.prototype={clone:function(){return new Nt(this.x,this.y)},add:function(t){return this.clone().m(t)},sub:function(t){return this.clone().M(t)},multByPoint:function(t){return this.clone().F(t)},divByPoint:function(t){return this.clone().A(t)},mult:function(t){return this.clone().k(t)},div:function(t){return this.clone().P(t)},rotate:function(t){return this.clone().S(t)},rotateAround:function(t,n){return this.clone()._(t,n)},matMult:function(t){return this.clone().O(t)},unit:function(){return this.clone().I()},perp:function(){return this.clone().C()},round:function(){return this.clone().T()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var n=t.x-this.x,e=t.y-this.y;return n*n+e*e},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,n){return Math.atan2(this.x*n-this.y*t,this.x*t+this.y*n)},O:function(t){var n=t[0]*this.x+t[1]*this.y,e=t[2]*this.x+t[3]*this.y;return this.x=n,this.y=e,this},m:function(t){return this.x+=t.x,this.y+=t.y,this},M:function(t){return this.x-=t.x,this.y-=t.y,this},k:function(t){return this.x*=t,this.y*=t,this},P:function(t){return this.x/=t,this.y/=t,this},F:function(t){return this.x*=t.x,this.y*=t.y,this},A:function(t){return this.x/=t.x,this.y/=t.y,this},I:function(){return this.P(this.mag()),this},C:function(){var t=this.y;return this.y=this.x,this.x=-t,this},S:function(t){var n=Math.cos(t),e=Math.sin(t),r=n*this.x-e*this.y,i=e*this.x+n*this.y;return this.x=r,this.y=i,this},_:function(t,n){var e=Math.cos(t),r=Math.sin(t),i=n.x+e*(this.x-n.x)-r*(this.y-n.y),s=n.y+r*(this.x-n.x)+e*(this.y-n.y);return this.x=i,this.y=s,this},T:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Nt.convert=function(t){return t instanceof Nt?t:Array.isArray(t)?new Nt(t[0],t[1]):t},Lt.prototype.pack=function(t,n){t=[].concat(t),n=n||{};for(var e,r,i,s,o=[],a=0;a<t.length;a++)if(e=t[a].w||t[a].width,r=t[a].h||t[a].height,i=t[a].id,e&&r){if(!(s=this.packOne(e,r,i)))continue;n.inPlace&&(t[a].x=s.x,t[a].y=s.y,t[a].id=s.id),o.push(s)}return this.shrink(),o},Lt.prototype.packOne=function(t,n,e){var r,i,s,o,a,u,h,l,c={freebin:-1,shelf:-1,waste:1/0},f=0;if("string"==typeof e||"number"==typeof e){if(r=this.getBin(e))return this.ref(r),r;"number"==typeof e&&(this.maxId=Math.max(e,this.maxId))}else e=++this.maxId;for(o=0;o<this.freebins.length;o++){if(n===(r=this.freebins[o]).maxh&&t===r.maxw)return this.allocFreebin(o,t,n,e);n>r.maxh||t>r.maxw||n<=r.maxh&&t<=r.maxw&&(s=r.maxw*r.maxh-t*n)<c.waste&&(c.waste=s,c.freebin=o)}for(o=0;o<this.shelves.length;o++)if(f+=(i=this.shelves[o]).h,!(t>i.free)){if(n===i.h)return this.allocShelf(o,t,n,e);n>i.h||n<i.h&&(s=(i.h-n)*t)<c.waste&&(c.freebin=-1,c.waste=s,c.shelf=o)}return-1!==c.freebin?this.allocFreebin(c.freebin,t,n,e):-1!==c.shelf?this.allocShelf(c.shelf,t,n,e):n<=this.h-f&&t<=this.w?(i=new Vt(f,this.w,n),this.allocShelf(this.shelves.push(i)-1,t,n,e)):this.autoResize?(a=u=this.h,((h=l=this.w)<=a||t>h)&&(l=2*Math.max(t,h)),(a<h||n>a)&&(u=2*Math.max(n,a)),this.resize(l,u),this.packOne(t,n,e)):null},Lt.prototype.allocFreebin=function(t,n,e,r){var i=this.freebins.splice(t,1)[0];return i.id=r,i.w=n,i.h=e,i.refcount=0,this.bins[r]=i,this.ref(i),i},Lt.prototype.allocShelf=function(t,n,e,r){var i=this.shelves[t].alloc(n,e,r);return this.bins[r]=i,this.ref(i),i},Lt.prototype.shrink=function(){if(this.shelves.length>0){for(var t=0,n=0,e=0;e<this.shelves.length;e++){var r=this.shelves[e];n+=r.h,t=Math.max(r.w-r.free,t)}this.resize(t,n)}},Lt.prototype.getBin=function(t){return this.bins[t]},Lt.prototype.ref=function(t){if(1==++t.refcount){var n=t.h;this.stats[n]=1+(0|this.stats[n])}return t.refcount},Lt.prototype.unref=function(t){return 0===t.refcount?0:(0==--t.refcount&&(this.stats[t.h]--,delete this.bins[t.id],this.freebins.push(t)),t.refcount)},Lt.prototype.clear=function(){this.shelves=[],this.freebins=[],this.stats={},this.bins={},this.maxId=0},Lt.prototype.resize=function(t,n){this.w=t,this.h=n;for(var e=0;e<this.shelves.length;e++)this.shelves[e].resize(t);return!0},Vt.prototype.alloc=function(t,n,e){if(t>this.free||n>this.h)return null;var r=this.x;return this.x+=t,this.free-=t,new Rt(e,r,this.y,t,n,t,this.h)},Vt.prototype.resize=function(t){return this.free+=t-this.w,this.w=t,!0};var Ht={exports:{}},Wt={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},qt={exports:{}},Gt=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Bt=Array.prototype.concat,Jt=Array.prototype.slice,Xt=qt.exports=function(t){for(var n=[],e=0,r=t.length;e<r;e++){var i=t[e];Gt(i)?n=Bt.call(n,Jt.call(i)):n.push(i)}return n};Xt.wrap=function(t){return function(){return t(Xt(arguments))}};var Yt=Wt,Zt=qt.exports,Kt=Object.hasOwnProperty,Qt=Object.create(null);for(var tn in Yt)Kt.call(Yt,tn)&&(Qt[Yt[tn]]=tn);var nn=Ht.exports={to:{},get:{}};function en(t,n,e){return Math.min(Math.max(n,t),e)}function rn(t){var n=Math.round(t).toString(16).toUpperCase();return n.length<2?"0"+n:n}nn.get=function(t){var n,e;switch(t.substring(0,3).toLowerCase()){case"hsl":n=nn.get.hsl(t),e="hsl";break;case"hwb":n=nn.get.hwb(t),e="hwb";break;default:n=nn.get.rgb(t),e="rgb"}return n?{model:e,value:n}:null},nn.get.rgb=function(t){if(!t)return null;var n,e,r,i=[0,0,0,1];if(n=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=n[2],n=n[1],e=0;e<3;e++){var s=2*e;i[e]=parseInt(n.slice(s,s+2),16)}r&&(i[3]=parseInt(r,16)/255)}else if(n=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(n=n[1])[3],e=0;e<3;e++)i[e]=parseInt(n[e]+n[e],16);r&&(i[3]=parseInt(r+r,16)/255)}else if(n=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(e=0;e<3;e++)i[e]=parseInt(n[e+1],0);n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}else{if(!(n=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(n=t.match(/^(\\w+)$/))?"transparent"===n[1]?[0,0,0,0]:Kt.call(Yt,n[1])?((i=Yt[n[1]])[3]=1,i):null:null;for(e=0;e<3;e++)i[e]=Math.round(2.55*parseFloat(n[e+1]));n[4]&&(n[5]?i[3]=.01*parseFloat(n[4]):i[3]=parseFloat(n[4]))}for(e=0;e<3;e++)i[e]=en(i[e],0,255);return i[3]=en(i[3],0,1),i},nn.get.hsl=function(t){if(!t)return null;var n=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,en(parseFloat(n[2]),0,100),en(parseFloat(n[3]),0,100),en(isNaN(e)?1:e,0,1)]}return null},nn.get.hwb=function(t){if(!t)return null;var n=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(n){var e=parseFloat(n[4]);return[(parseFloat(n[1])%360+360)%360,en(parseFloat(n[2]),0,100),en(parseFloat(n[3]),0,100),en(isNaN(e)?1:e,0,1)]}return null},nn.to.hex=function(){var t=Zt(arguments);return"#"+rn(t[0])+rn(t[1])+rn(t[2])+(t[3]<1?rn(Math.round(255*t[3])):"")},nn.to.rgb=function(){var t=Zt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},nn.to.rgb.percent=function(){var t=Zt(arguments),n=Math.round(t[0]/255*100),e=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+n+"%, "+e+"%, "+r+"%)":"rgba("+n+"%, "+e+"%, "+r+"%, "+t[3]+")"},nn.to.hsl=function(){var t=Zt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},nn.to.hwb=function(){var t=Zt(arguments),n="";return t.length>=4&&1!==t[3]&&(n=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+n+")"},nn.to.keyword=function(t){return Qt[t.slice(0,3)]};var sn={exports:{}},on=Wt,an={};for(var un in on)on.hasOwnProperty(un)&&(an[on[un]]=un);var hn=sn.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var ln in hn)if(hn.hasOwnProperty(ln)){if(!("channels"in hn[ln]))throw new Error("missing channels property: "+ln);if(!("labels"in hn[ln]))throw new Error("missing channel labels property: "+ln);if(hn[ln].labels.length!==hn[ln].channels)throw new Error("channel and label counts mismatch: "+ln);var cn=hn[ln].channels,fn=hn[ln].labels;delete hn[ln].channels,delete hn[ln].labels,Object.defineProperty(hn[ln],"channels",{value:cn}),Object.defineProperty(hn[ln],"labels",{value:fn})}function dn(t,n){return Math.pow(t[0]-n[0],2)+Math.pow(t[1]-n[1],2)+Math.pow(t[2]-n[2],2)}hn.rgb.hsl=function(t){var n,e,r=t[0]/255,i=t[1]/255,s=t[2]/255,o=Math.min(r,i,s),a=Math.max(r,i,s),u=a-o;return a===o?n=0:r===a?n=(i-s)/u:i===a?n=2+(s-r)/u:s===a&&(n=4+(r-i)/u),(n=Math.min(60*n,360))<0&&(n+=360),e=(o+a)/2,[n,100*(a===o?0:e<=.5?u/(a+o):u/(2-a-o)),100*e]},hn.rgb.hsv=function(t){var n,e,r,i,s,o=t[0]/255,a=t[1]/255,u=t[2]/255,h=Math.max(o,a,u),l=h-Math.min(o,a,u),c=function(t){return(h-t)/6/l+.5};return 0===l?i=s=0:(s=l/h,n=c(o),e=c(a),r=c(u),o===h?i=r-e:a===h?i=1/3+n-r:u===h&&(i=2/3+e-n),i<0?i+=1:i>1&&(i-=1)),[360*i,100*s,100*h]},hn.rgb.hwb=function(t){var n=t[0],e=t[1],r=t[2];return[hn.rgb.hsl(t)[0],100*(1/255*Math.min(n,Math.min(e,r))),100*(r=1-1/255*Math.max(n,Math.max(e,r)))]},hn.rgb.cmyk=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255;return[100*((1-e-(n=Math.min(1-e,1-r,1-i)))/(1-n)||0),100*((1-r-n)/(1-n)||0),100*((1-i-n)/(1-n)||0),100*n]},hn.rgb.keyword=function(t){var n=an[t];if(n)return n;var e,r=1/0;for(var i in on)if(on.hasOwnProperty(i)){var s=dn(t,on[i]);s<r&&(r=s,e=i)}return e},hn.keyword.rgb=function(t){return on[t]},hn.rgb.xyz=function(t){var n=t[0]/255,e=t[1]/255,r=t[2]/255;return[100*(.4124*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.3576*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*n+.7152*e+.0722*r),100*(.0193*n+.1192*e+.9505*r)]},hn.rgb.lab=function(t){var n=hn.rgb.xyz(t),e=n[0],r=n[1],i=n[2];return r/=100,i/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(e-r),200*(r-(i=i>.008856?Math.pow(i,1/3):7.787*i+16/116))]},hn.hsl.rgb=function(t){var n,e,r,i,s,o=t[0]/360,a=t[1]/100,u=t[2]/100;if(0===a)return[s=255*u,s,s];n=2*u-(e=u<.5?u*(1+a):u+a-u*a),i=[0,0,0];for(var h=0;h<3;h++)(r=o+1/3*-(h-1))<0&&r++,r>1&&r--,s=6*r<1?n+6*(e-n)*r:2*r<1?e:3*r<2?n+(e-n)*(2/3-r)*6:n,i[h]=255*s;return i},hn.hsl.hsv=function(t){var n=t[0],e=t[1]/100,r=t[2]/100,i=e,s=Math.max(r,.01);return e*=(r*=2)<=1?r:2-r,i*=s<=1?s:2-s,[n,100*(0===r?2*i/(s+i):2*e/(r+e)),100*((r+e)/2)]},hn.hsv.rgb=function(t){var n=t[0]/60,e=t[1]/100,r=t[2]/100,i=Math.floor(n)%6,s=n-Math.floor(n),o=255*r*(1-e),a=255*r*(1-e*s),u=255*r*(1-e*(1-s));switch(r*=255,i){case 0:return[r,u,o];case 1:return[a,r,o];case 2:return[o,r,u];case 3:return[o,a,r];case 4:return[u,o,r];case 5:return[r,o,a]}},hn.hsv.hsl=function(t){var n,e,r,i=t[0],s=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-s)*o,e=s*a,[i,100*(e=(e/=(n=(2-s)*a)<=1?n:2-n)||0),100*(r/=2)]},hn.hwb.rgb=function(t){var n,e,r,i,s,o,a,u=t[0]/360,h=t[1]/100,l=t[2]/100,c=h+l;switch(c>1&&(h/=c,l/=c),r=6*u-(n=Math.floor(6*u)),0!=(1&n)&&(r=1-r),i=h+r*((e=1-l)-h),n){default:case 6:case 0:s=e,o=i,a=h;break;case 1:s=i,o=e,a=h;break;case 2:s=h,o=e,a=i;break;case 3:s=h,o=i,a=e;break;case 4:s=i,o=h,a=e;break;case 5:s=e,o=h,a=i}return[255*s,255*o,255*a]},hn.cmyk.rgb=function(t){var n=t[0]/100,e=t[1]/100,r=t[2]/100,i=t[3]/100;return[255*(1-Math.min(1,n*(1-i)+i)),255*(1-Math.min(1,e*(1-i)+i)),255*(1-Math.min(1,r*(1-i)+i))]},hn.xyz.rgb=function(t){var n,e,r,i=t[0]/100,s=t[1]/100,o=t[2]/100;return e=-.9689*i+1.8758*s+.0415*o,r=.0557*i+-.204*s+1.057*o,n=(n=3.2406*i+-1.5372*s+-.4986*o)>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,e=e>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(n=Math.min(Math.max(0,n),1)),255*(e=Math.min(Math.max(0,e),1)),255*(r=Math.min(Math.max(0,r),1))]},hn.xyz.lab=function(t){var n=t[0],e=t[1],r=t[2];return e/=100,r/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(e=e>.008856?Math.pow(e,1/3):7.787*e+16/116)-16,500*(n-e),200*(e-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},hn.lab.xyz=function(t){var n,e,r,i=t[0];n=t[1]/500+(e=(i+16)/116),r=e-t[2]/200;var s=Math.pow(e,3),o=Math.pow(n,3),a=Math.pow(r,3);return e=s>.008856?s:(e-16/116)/7.787,n=o>.008856?o:(n-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[n*=95.047,e*=100,r*=108.883]},hn.lab.lch=function(t){var n,e=t[0],r=t[1],i=t[2];return(n=360*Math.atan2(i,r)/2/Math.PI)<0&&(n+=360),[e,Math.sqrt(r*r+i*i),n]},hn.lch.lab=function(t){var n,e=t[0],r=t[1];return n=t[2]/360*2*Math.PI,[e,r*Math.cos(n),r*Math.sin(n)]},hn.rgb.ansi16=function(t){var n=t[0],e=t[1],r=t[2],i=1 in arguments?arguments[1]:hn.rgb.hsv(t)[2];if(0===(i=Math.round(i/50)))return 30;var s=30+(Math.round(r/255)<<2|Math.round(e/255)<<1|Math.round(n/255));return 2===i&&(s+=60),s},hn.hsv.ansi16=function(t){return hn.rgb.ansi16(hn.hsv.rgb(t),t[2])},hn.rgb.ansi256=function(t){var n=t[0],e=t[1],r=t[2];return n===e&&e===r?n<8?16:n>248?231:Math.round((n-8)/247*24)+232:16+36*Math.round(n/255*5)+6*Math.round(e/255*5)+Math.round(r/255*5)},hn.ansi16.rgb=function(t){var n=t%10;if(0===n||7===n)return t>50&&(n+=3.5),[n=n/10.5*255,n,n];var e=.5*(1+~~(t>50));return[(1&n)*e*255,(n>>1&1)*e*255,(n>>2&1)*e*255]},hn.ansi256.rgb=function(t){if(t>=232){var n=10*(t-232)+8;return[n,n,n]}var e;return t-=16,[Math.floor(t/36)/5*255,Math.floor((e=t%36)/6)/5*255,e%6/5*255]},hn.rgb.hex=function(t){var n=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(n.length)+n},hn.hex.rgb=function(t){var n=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!n)return[0,0,0];var e=n[0];3===n[0].length&&(e=e.split("").map((function(t){return t+t})).join(""));var r=parseInt(e,16);return[r>>16&255,r>>8&255,255&r]},hn.rgb.hcg=function(t){var n,e=t[0]/255,r=t[1]/255,i=t[2]/255,s=Math.max(Math.max(e,r),i),o=Math.min(Math.min(e,r),i),a=s-o;return n=a<=0?0:s===e?(r-i)/a%6:s===r?2+(i-e)/a:4+(e-r)/a+4,n/=6,[360*(n%=1),100*a,100*(a<1?o/(1-a):0)]},hn.hsl.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=1,i=0;return(r=e<.5?2*n*e:2*n*(1-e))<1&&(i=(e-.5*r)/(1-r)),[t[0],100*r,100*i]},hn.hsv.hcg=function(t){var n=t[1]/100,e=t[2]/100,r=n*e,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},hn.hcg.rgb=function(t){var n=t[0]/360,e=t[1]/100,r=t[2]/100;if(0===e)return[255*r,255*r,255*r];var i,s=[0,0,0],o=n%1*6,a=o%1,u=1-a;switch(Math.floor(o)){case 0:s[0]=1,s[1]=a,s[2]=0;break;case 1:s[0]=u,s[1]=1,s[2]=0;break;case 2:s[0]=0,s[1]=1,s[2]=a;break;case 3:s[0]=0,s[1]=u,s[2]=1;break;case 4:s[0]=a,s[1]=0,s[2]=1;break;default:s[0]=1,s[1]=0,s[2]=u}return i=(1-e)*r,[255*(e*s[0]+i),255*(e*s[1]+i),255*(e*s[2]+i)]},hn.hcg.hsv=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n),r=0;return e>0&&(r=n/e),[t[0],100*r,100*e]},hn.hcg.hsl=function(t){var n=t[1]/100,e=t[2]/100*(1-n)+.5*n,r=0;return e>0&&e<.5?r=n/(2*e):e>=.5&&e<1&&(r=n/(2*(1-e))),[t[0],100*r,100*e]},hn.hcg.hwb=function(t){var n=t[1]/100,e=n+t[2]/100*(1-n);return[t[0],100*(e-n),100*(1-e)]},hn.hwb.hcg=function(t){var n=t[1]/100,e=1-t[2]/100,r=e-n,i=0;return r<1&&(i=(e-r)/(1-r)),[t[0],100*r,100*i]},hn.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},hn.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},hn.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},hn.gray.hsl=hn.gray.hsv=function(t){return[0,0,t[0]]},hn.gray.hwb=function(t){return[0,100,t[0]]},hn.gray.cmyk=function(t){return[0,0,0,t[0]]},hn.gray.lab=function(t){return[t[0],0,0]},hn.gray.hex=function(t){var n=255&Math.round(t[0]/100*255),e=((n<<16)+(n<<8)+n).toString(16).toUpperCase();return"000000".substring(e.length)+e},hn.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var pn=sn.exports;function yn(t){var n=function(){for(var t={},n=Object.keys(pn),e=n.length,r=0;r<e;r++)t[n[r]]={distance:-1,parent:null};return t}(),e=[t];for(n[t].distance=0;e.length;)for(var r=e.pop(),i=Object.keys(pn[r]),s=i.length,o=0;o<s;o++){var a=i[o],u=n[a];-1===u.distance&&(u.distance=n[r].distance+1,u.parent=r,e.unshift(a))}return n}function mn(t,n){return function(e){return n(t(e))}}function gn(t,n){for(var e=[n[t].parent,t],r=pn[n[t].parent][t],i=n[t].parent;n[i].parent;)e.unshift(n[i].parent),r=mn(pn[n[i].parent][i],r),i=n[i].parent;return r.conversion=e,r}var vn=sn.exports,bn=function(t){for(var n=yn(t),e={},r=Object.keys(n),i=r.length,s=0;s<i;s++){var o=r[s];null!==n[o].parent&&(e[o]=gn(o,n))}return e},wn={};Object.keys(vn).forEach((function(t){wn[t]={},Object.defineProperty(wn[t],"channels",{value:vn[t].channels}),Object.defineProperty(wn[t],"labels",{value:vn[t].labels});var n=bn(t);Object.keys(n).forEach((function(e){var r=n[e];wn[t][e]=function(t){var n=function(n){if(null==n)return n;arguments.length>1&&(n=Array.prototype.slice.call(arguments));var e=t(n);if("object"==typeof e)for(var r=e.length,i=0;i<r;i++)e[i]=Math.round(e[i]);return e};return"conversion"in t&&(n.conversion=t.conversion),n}(r),wn[t][e].raw=function(t){var n=function(n){return null==n?n:(arguments.length>1&&(n=Array.prototype.slice.call(arguments)),t(n))};return"conversion"in t&&(n.conversion=t.conversion),n}(r)}))}));var Mn=wn,xn=Ht.exports,Fn=Mn,An=[].slice,kn=["keyword","gray","hex"],Pn={};Object.keys(Fn).forEach((function(t){Pn[An.call(Fn[t].labels).sort().join("")]=t}));var Sn={};function _n(t,n){if(!(this instanceof _n))return new _n(t,n);if(n&&n in kn&&(n=null),n&&!(n in Fn))throw new Error("Unknown model: "+n);var e,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof _n)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var i=xn.get(t);if(null===i)throw new Error("Unable to parse color from string: "+t);this.model=i.model,r=Fn[this.model].channels,this.color=i.value.slice(0,r),this.valpha="number"==typeof i.value[r]?i.value[r]:1}else if(t.length){this.model=n||"rgb",r=Fn[this.model].channels;var s=An.call(t,0,r);this.color=$n(s,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in Pn))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=Pn[a];var u=Fn[this.model].labels,h=[];for(e=0;e<u.length;e++)h.push(t[u[e]]);this.color=$n(h)}if(Sn[this.model])for(r=Fn[this.model].channels,e=0;e<r;e++){var l=Sn[this.model][e];l&&(this.color[e]=l(this.color[e]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function On(t,n,e){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(Sn[t]||(Sn[t]=[]))[n]=e})),t=t[0],function(r){var i;return arguments.length?(e&&(r=e(r)),(i=this[t]()).color[n]=r,i):(i=this[t]().color[n],e&&(i=e(i)),i)}}function En(t){return function(n){return Math.max(0,Math.min(t,n))}}function In(t){return Array.isArray(t)?t:[t]}function $n(t,n){for(var e=0;e<n;e++)"number"!=typeof t[e]&&(t[e]=0);return t}_n.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var n=this.model in xn.to?this:this.rgb(),e=1===(n=n.round("number"==typeof t?t:1)).valpha?n.color:n.color.concat(this.valpha);return xn.to[n.model](e)},percentString:function(t){var n=this.rgb().round("number"==typeof t?t:1),e=1===n.valpha?n.color:n.color.concat(this.valpha);return xn.to.rgb.percent(e)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},n=Fn[this.model].channels,e=Fn[this.model].labels,r=0;r<n;r++)t[e[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new _n(this.color.map(function(t){return function(n){return function(t,n){return Number(t.toFixed(n))}(n,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new _n(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:On("rgb",0,En(255)),green:On("rgb",1,En(255)),blue:On("rgb",2,En(255)),hue:On(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:On("hsl",1,En(100)),lightness:On("hsl",2,En(100)),saturationv:On("hsv",1,En(100)),value:On("hsv",2,En(100)),chroma:On("hcg",1,En(100)),gray:On("hcg",2,En(100)),white:On("hwb",1,En(100)),wblack:On("hwb",2,En(100)),cyan:On("cmyk",0,En(100)),magenta:On("cmyk",1,En(100)),yellow:On("cmyk",2,En(100)),black:On("cmyk",3,En(100)),x:On("xyz",0,En(100)),y:On("xyz",1,En(100)),z:On("xyz",2,En(100)),l:On("lab",0,En(100)),a:On("lab",1),b:On("lab",2),keyword:function(t){return arguments.length?new _n(t):Fn[this.model].keyword(this.color)},hex:function(t){return arguments.length?new _n(t):xn.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,n=[],e=0;e<t.length;e++){var r=t[e]/255;n[e]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*n[0]+.7152*n[1]+.0722*n[2]},contrast:function(t){var n=this.luminosity(),e=t.luminosity();return n>e?(n+.05)/(e+.05):(e+.05)/(n+.05)},level:function(t){var n=this.contrast(t);return n>=7.1?"AAA":n>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),n=0;n<3;n++)t.color[n]=255-t.color[n];return t},lighten:function(t){var n=this.hsl();return n.color[2]+=n.color[2]*t,n},darken:function(t){var n=this.hsl();return n.color[2]-=n.color[2]*t,n},saturate:function(t){var n=this.hsl();return n.color[1]+=n.color[1]*t,n},desaturate:function(t){var n=this.hsl();return n.color[1]-=n.color[1]*t,n},whiten:function(t){var n=this.hwb();return n.color[1]+=n.color[1]*t,n},blacken:function(t){var n=this.hwb();return n.color[2]+=n.color[2]*t,n},grayscale:function(){var t=this.rgb().color,n=.3*t[0]+.59*t[1]+.11*t[2];return _n.rgb(n,n,n)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var n=this.hsl(),e=n.color[0];return e=(e=(e+t)%360)<0?360+e:e,n.color[0]=e,n},mix:function(t,n){if(!t||!t.rgb)throw new Error(\'Argument to "mix" was not a Color instance, but rather an instance of \'+typeof t);var e=t.rgb(),r=this.rgb(),i=void 0===n?.5:n,s=2*i-1,o=e.alpha()-r.alpha(),a=((s*o==-1?s:(s+o)/(1+s*o))+1)/2,u=1-a;return _n.rgb(a*e.red()+u*r.red(),a*e.green()+u*r.green(),a*e.blue()+u*r.blue(),e.alpha()*i+r.alpha()*(1-i))}},Object.keys(Fn).forEach((function(t){if(-1===kn.indexOf(t)){var n=Fn[t].channels;_n.prototype[t]=function(){if(this.model===t)return new _n(this);if(arguments.length)return new _n(arguments,t);var e="number"==typeof arguments[n]?n:this.valpha;return new _n(In(Fn[this.model][t].raw(this.color)).concat(e),t)},_n[t]=function(e){return"number"==typeof e&&(e=$n(An.call(arguments),n)),new _n(e,t)}}}));var Cn=_n;\n/*!\n        Feature Filter by\n\n        (c) mapbox 2016 and maptalks 2018\n        www.mapbox.com | www.maptalks.org\n        License: MIT, header required.\n    */const Tn=["Unknown","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon","GeometryCollection"];function zn(t){return new Function("f","var p = (f && f.properties || {}); return "+Dn(t))}function Dn(t){if(!t)return"true";const n=t[0];if(t.length<=1)return"any"===n?"false":"true";return`(${"=="===n?Un(t[1],t[2],"===",!1):"!="===n?Un(t[1],t[2],"!==",!1):"<"===n||">"===n||"<="===n||">="===n?Un(t[1],t[2],n,!0):"any"===n?Ln(t.slice(1),"||"):"all"===n?Ln(t.slice(1),"&&"):"none"===n?Hn(Ln(t.slice(1),"||")):"in"===n?Vn(t[1],t.slice(2)):"!in"===n?Hn(Vn(t[1],t.slice(2))):"has"===n?Rn(t[1]):"!has"===n?Hn(Rn(t[1])):"contains"===n?function(t,n,e){const r=jn(t);return void 0!==e?`(${r} + \'\').indexOf("${n}") === ${e}`:`(${r} + \'\').indexOf("${n}") >= 0`}(t[1],t[2],t[3]):"true"})`}function jn(t){return"$"===t[0]?"f."+t.substring(1):"p["+JSON.stringify(t)+"]"}function Un(t,n,e,r){if("object"==typeof(i=t)&&i&&t.op)return function(t,n,e,r){const i=t.property,s=t.op;let o=jn(i);return"length"!==s?(console.error(`not support ${s} op`),"false"):(o=`((${o}+=\'\').length)`,Nn(o,i,n,e,r))}(t,n,e,r);var i;return Nn(jn(t),t,n,e,r)}function Nn(t,n,e,r,i){const s="$type"===n?Tn.indexOf(e):JSON.stringify(e);return(i?`typeof ${t}=== typeof ${s}&&`:"")+t+r+s}function Ln(t,n){return t.map(Dn).join(n)}function Vn(t,n){"$type"===t&&(n=n.map(t=>Tn.indexOf(t)));const e=JSON.stringify(n.sort(Wn)),r=jn(t);return n.length<=200?`${e}.indexOf(${r}) !== -1`:`function(v, a, i, j) {\\n        while (i <= j) { var m = (i + j) >> 1;\\n            if (a[m] === v) return true; if (a[m] > v) j = m - 1; else i = m + 1;\\n        }\\n    return false; }(${r}, ${e},0,${n.length-1})`}function Rn(t){return"$id"===t?\'"id" in f\':JSON.stringify(t)+" in p"}function Hn(t){return`!(${t})`}function Wn(t,n){return t<n?-1:t>n?1:0}var qn={exports:{}};qn.exports=function(){function t(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function n(t,n){return t<n?-1:t>n?1:0}return function(e,r,i,s,o){!function n(e,r,i,s,o){for(;s>i;){if(s-i>600){var a=s-i+1,u=r-i+1,h=Math.log(a),l=.5*Math.exp(2*h/3),c=.5*Math.sqrt(h*l*(a-l)/a)*(u-a/2<0?-1:1),f=Math.max(i,Math.floor(r-u*l/a+c)),d=Math.min(s,Math.floor(r+(a-u)*l/a+c));n(e,r,f,d,o)}var p=e[r],y=i,m=s;for(t(e,i,r),o(e[s],p)>0&&t(e,i,s);y<m;){for(t(e,y,m),y++,m--;o(e[y],p)<0;)y++;for(;o(e[m],p)>0;)m--}0===o(e[i],p)?t(e,i,m):(m++,t(e,m,s)),m<=r&&(i=m+1),r<=m&&(s=m-1)}}(e,r,i||0,s||e.length-1,o||n)}}();var Gn=qn.exports;class Bn{constructor(t=[],n=Jn){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this.D(t)}push(t){this.data.push(t),this.length++,this.j(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this.D(0)),t}peek(){return this.data[0]}j(t){const{data:n,compare:e}=this,r=n[t];for(;t>0;){const i=t-1>>1,s=n[i];if(e(r,s)>=0)break;n[t]=s,t=i}n[t]=r}D(t){const{data:n,compare:e}=this,r=this.length>>1,i=n[t];for(;t<r;){let r=1+(t<<1),s=n[r];const o=r+1;if(o<this.length&&e(n[o],s)<0&&(r=o,s=n[o]),e(s,i)>=0)break;n[t]=s,t=r}n[t]=i}}function Jn(t,n){return t<n?-1:t>n?1:0}\n/*!\n     * Contains code from google filament\n     * https://github.com/google/filament/\n     * License Apache-2.0\n     */const Xn=[],Yn=[],Zn=[],Kn=[];function Qn(t,n,e){const r=mt(Yn,n,e);t=At(t,function(t,n,e,r,i,s,o,a,u,h){return t[0]=n,t[1]=e,t[2]=r,t[3]=i,t[4]=s,t[5]=o,t[6]=a,t[7]=u,t[8]=h,t}(Xn,e[0],e[1],e[2],...r,...n));if((t=function(t){return t[3]<0?Pt(t,t,-1):t}(t=St(t,t)))[3]<1/32767){t[3]=1/32767;const n=Math.sqrt(.9999999990686206);t[0]*=n,t[1]*=n,t[2]*=n}const i=e[3]>0?mt(Zn,e,n):mt(Zn,n,e);return yt(mt(Kn,e,n),i)<0&&Pt(t,t,-1),t}const te=[];function ne(t,n,e){const r=e||[];r.setLength&&r.setLength(t.length);const i=te;i.length<t.length/3&&(i.length=t.length/3),i.fill(0,0,t.length/3);const s=void 0===n.length?n:n.length;for(let e=0;e<s/3;e++)void 0===n.length?he(t,3*e,3*e+1,3*e+2,r,i):he(t,n[3*e],n[3*e+1],n[3*e+2],r,i);for(let t=0;t<r.length;t+=3){const n=i[t/3];0!==n?(r[t]/=n,r[t+1]/=n,r[t+2]/=n):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}const ee=[],re=[],ie=[],se=[],oe=[],ae=[],ue=[];function he(t,n,e,r,i,s){ft(se,t[3*n],t[3*n+1],t[3*n+2]),ft(oe,t[3*e],t[3*e+1],t[3*e+2]),ft(ae,t[3*r],t[3*r+1],t[3*r+2]);const o=gt(ee,ae,oe),a=gt(re,se,oe),u=mt(ie,o,a);pt(ue,u),i[3*n]=i[3*n]||0,i[3*e]=i[3*e]||0,i[3*r]=i[3*r]||0,i[3*n+1]=i[3*n+1]||0,i[3*e+1]=i[3*e+1]||0,i[3*r+1]=i[3*r+1]||0,i[3*n+2]=i[3*n+2]||0,i[3*e+2]=i[3*e+2]||0,i[3*r+2]=i[3*r+2]||0,i[3*n]+=ue[0],i[3*e]+=ue[0],i[3*r]+=ue[0],i[3*n+1]+=ue[1],i[3*e+1]+=ue[1],i[3*r+1]+=ue[1],i[3*n+2]+=ue[2],i[3*e+2]+=ue[2],i[3*r+2]+=ue[2],s[n]+=1,s[e]+=1,s[r]+=1}\n/*!\n     * Contains code from THREE.JS\n     * https://github.com/mrdoob/three.js/\n     * License MIT\n     * \n     * Generate tangents per vertex.\n     */function le(t,n,e){return t[0]=n[e],t[1]=n[e+1],t[2]=n[e+2],t}function ce(t,n,e){return t[0]=n[e],t[1]=n[e+1],t}var fe={exports:{}};function de(t,n,e){e=e||2;var r,i,s,o,a,u,h,l=n&&n.length,c=l?n[0]*e:t.length,f=pe(t,0,c,e,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=function(t,n,e,r){var i,s,o,a,u,h=[];for(i=0,s=n.length;i<s;i++)o=n[i]*r,a=i<s-1?n[i+1]*r:t.length,(u=pe(t,o,a,r,!1))===u.next&&(u.steiner=!0),h.push(ke(u));for(h.sort(Me),i=0;i<h.length;i++)e=xe(h[i],e);return e}(t,n,f,e)),t.length>80*e){r=s=t[0],i=o=t[1];for(var p=e;p<c;p+=e)(a=t[p])<r&&(r=a),(u=t[p+1])<i&&(i=u),a>s&&(s=a),u>o&&(o=u);h=0!==(h=Math.max(s-r,o-i))?32767/h:0}return me(f,d,e,r,i,h,0),d}function pe(t,n,e,r,i){var s,o;if(i===Ue(t,n,e,r)>0)for(s=n;s<e;s+=r)o=ze(s,t[s],t[s+1],o);else for(s=e-r;s>=n;s-=r)o=ze(s,t[s],t[s+1],o);return o&&Oe(o,o.next)&&(De(o),o=o.next),o}function ye(t,n){if(!t)return t;n||(n=t);var e,r=t;do{if(e=!1,r.steiner||!Oe(r,r.next)&&0!==_e(r.prev,r,r.next))r=r.next;else{if(De(r),(r=n=r.prev)===r.next)break;e=!0}}while(e||r!==n);return n}function me(t,n,e,r,i,s,o){if(t){!o&&s&&function(t,n,e,r){var i=t;do{0===i.z&&(i.z=Ae(i.x,i.y,n,e,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var n,e,r,i,s,o,a,u,h=1;do{for(e=t,t=null,s=null,o=0;e;){for(o++,r=e,a=0,n=0;n<h&&(a++,r=r.nextZ);n++);for(u=h;a>0||u>0&&r;)0!==a&&(0===u||!r||e.z<=r.z)?(i=e,e=e.nextZ,a--):(i=r,r=r.nextZ,u--),s?s.nextZ=i:t=i,i.prevZ=s,s=i;e=r}s.nextZ=null,h*=2}while(o>1)}(i)}(t,r,i,s);for(var a,u,h=t;t.prev!==t.next;)if(a=t.prev,u=t.next,s?ve(t,r,i,s):ge(t))n.push(a.i/e|0),n.push(t.i/e|0),n.push(u.i/e|0),De(t),t=u.next,h=u.next;else if((t=u)===h){o?1===o?me(t=be(ye(t),n,e),n,e,r,i,s,2):2===o&&we(t,n,e,r,i,s):me(ye(t),n,e,r,i,s,1);break}}}function ge(t){var n=t.prev,e=t,r=t.next;if(_e(n,e,r)>=0)return!1;for(var i=n.x,s=e.x,o=r.x,a=n.y,u=e.y,h=r.y,l=i<s?i<o?i:o:s<o?s:o,c=a<u?a<h?a:h:u<h?u:h,f=i>s?i>o?i:o:s>o?s:o,d=a>u?a>h?a:h:u>h?u:h,p=r.next;p!==n;){if(p.x>=l&&p.x<=f&&p.y>=c&&p.y<=d&&Pe(i,a,s,u,o,h,p.x,p.y)&&_e(p.prev,p,p.next)>=0)return!1;p=p.next}return!0}function ve(t,n,e,r){var i=t.prev,s=t,o=t.next;if(_e(i,s,o)>=0)return!1;for(var a=i.x,u=s.x,h=o.x,l=i.y,c=s.y,f=o.y,d=a<u?a<h?a:h:u<h?u:h,p=l<c?l<f?l:f:c<f?c:f,y=a>u?a>h?a:h:u>h?u:h,m=l>c?l>f?l:f:c>f?c:f,g=Ae(d,p,n,e,r),v=Ae(y,m,n,e,r),b=t.prevZ,w=t.nextZ;b&&b.z>=g&&w&&w.z<=v;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Pe(a,l,u,c,h,f,b.x,b.y)&&_e(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Pe(a,l,u,c,h,f,w.x,w.y)&&_e(w.prev,w,w.next)>=0)return!1;w=w.nextZ}for(;b&&b.z>=g;){if(b.x>=d&&b.x<=y&&b.y>=p&&b.y<=m&&b!==i&&b!==o&&Pe(a,l,u,c,h,f,b.x,b.y)&&_e(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;w&&w.z<=v;){if(w.x>=d&&w.x<=y&&w.y>=p&&w.y<=m&&w!==i&&w!==o&&Pe(a,l,u,c,h,f,w.x,w.y)&&_e(w.prev,w,w.next)>=0)return!1;w=w.nextZ}return!0}function be(t,n,e){var r=t;do{var i=r.prev,s=r.next.next;!Oe(i,s)&&Ee(i,r,r.next,s)&&Ce(i,s)&&Ce(s,i)&&(n.push(i.i/e|0),n.push(r.i/e|0),n.push(s.i/e|0),De(r),De(r.next),r=t=s),r=r.next}while(r!==t);return ye(r)}function we(t,n,e,r,i,s){var o=t;do{for(var a=o.next.next;a!==o.prev;){if(o.i!==a.i&&Se(o,a)){var u=Te(o,a);return o=ye(o,o.next),u=ye(u,u.next),me(o,n,e,r,i,s,0),void me(u,n,e,r,i,s,0)}a=a.next}o=o.next}while(o!==t)}function Me(t,n){return t.x-n.x}function xe(t,n){var e=function(t,n){var e,r=n,i=t.x,s=t.y,o=-1/0;do{if(s<=r.y&&s>=r.next.y&&r.next.y!==r.y){var a=r.x+(s-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>o&&(o=a,e=r.x<r.next.x?r:r.next,a===i))return e}r=r.next}while(r!==n);if(!e)return null;var u,h=e,l=e.x,c=e.y,f=1/0;r=e;do{i>=r.x&&r.x>=l&&i!==r.x&&Pe(s<c?i:o,s,l,c,s<c?o:i,s,r.x,r.y)&&(u=Math.abs(s-r.y)/(i-r.x),Ce(r,t)&&(u<f||u===f&&(r.x>e.x||r.x===e.x&&Fe(e,r)))&&(e=r,f=u)),r=r.next}while(r!==h);return e}(t,n);if(!e)return n;var r=Te(e,t);return ye(r,r.next),ye(e,e.next)}function Fe(t,n){return _e(t.prev,t,n.prev)<0&&_e(n.next,t,t.next)<0}function Ae(t,n,e,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-e)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=(n-r)*i|0)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function ke(t){var n=t,e=t;do{(n.x<e.x||n.x===e.x&&n.y<e.y)&&(e=n),n=n.next}while(n!==t);return e}function Pe(t,n,e,r,i,s,o,a){return(i-o)*(n-a)>=(t-o)*(s-a)&&(t-o)*(r-a)>=(e-o)*(n-a)&&(e-o)*(s-a)>=(i-o)*(r-a)}function Se(t,n){return t.next.i!==n.i&&t.prev.i!==n.i&&!function(t,n){var e=t;do{if(e.i!==t.i&&e.next.i!==t.i&&e.i!==n.i&&e.next.i!==n.i&&Ee(e,e.next,t,n))return!0;e=e.next}while(e!==t);return!1}(t,n)&&(Ce(t,n)&&Ce(n,t)&&function(t,n){var e=t,r=!1,i=(t.x+n.x)/2,s=(t.y+n.y)/2;do{e.y>s!=e.next.y>s&&e.next.y!==e.y&&i<(e.next.x-e.x)*(s-e.y)/(e.next.y-e.y)+e.x&&(r=!r),e=e.next}while(e!==t);return r}(t,n)&&(_e(t.prev,t,n.prev)||_e(t,n.prev,n))||Oe(t,n)&&_e(t.prev,t,t.next)>0&&_e(n.prev,n,n.next)>0)}function _e(t,n,e){return(n.y-t.y)*(e.x-n.x)-(n.x-t.x)*(e.y-n.y)}function Oe(t,n){return t.x===n.x&&t.y===n.y}function Ee(t,n,e,r){var i=$e(_e(t,n,e)),s=$e(_e(t,n,r)),o=$e(_e(e,r,t)),a=$e(_e(e,r,n));return i!==s&&o!==a||(!(0!==i||!Ie(t,e,n))||(!(0!==s||!Ie(t,r,n))||(!(0!==o||!Ie(e,t,r))||!(0!==a||!Ie(e,n,r)))))}function Ie(t,n,e){return n.x<=Math.max(t.x,e.x)&&n.x>=Math.min(t.x,e.x)&&n.y<=Math.max(t.y,e.y)&&n.y>=Math.min(t.y,e.y)}function $e(t){return t>0?1:t<0?-1:0}function Ce(t,n){return _e(t.prev,t,t.next)<0?_e(t,n,t.next)>=0&&_e(t,t.prev,n)>=0:_e(t,n,t.prev)<0||_e(t,t.next,n)<0}function Te(t,n){var e=new je(t.i,t.x,t.y),r=new je(n.i,n.x,n.y),i=t.next,s=n.prev;return t.next=n,n.prev=t,e.next=i,i.prev=e,r.next=e,e.prev=r,s.next=r,r.prev=s,r}function ze(t,n,e,r){var i=new je(t,n,e);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function De(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function je(t,n,e){this.i=t,this.x=n,this.y=e,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ue(t,n,e,r){for(var i=0,s=n,o=e-r;s<e;s+=r)i+=(t[o]-t[s])*(t[s+1]+t[o+1]),o=s;return i}fe.exports=de,fe.exports.default=de,de.deviation=function(t,n,e,r){var i=n&&n.length,s=i?n[0]*e:t.length,o=Math.abs(Ue(t,0,s,e));if(i)for(var a=0,u=n.length;a<u;a++){var h=n[a]*e,l=a<u-1?n[a+1]*e:t.length;o-=Math.abs(Ue(t,h,l,e))}var c=0;for(a=0;a<r.length;a+=3){var f=r[a]*e,d=r[a+1]*e,p=r[a+2]*e;c+=Math.abs((t[f]-t[p])*(t[d+1]-t[f+1])-(t[f]-t[d])*(t[p+1]-t[f+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},de.flatten=function(t){for(var n=t[0][0].length,e={vertices:[],holes:[],dimensions:n},r=0,i=0;i<t.length;i++){for(var s=0;s<t[i].length;s++)for(var o=0;o<n;o++)e.vertices.push(t[i][s][o]);i>0&&(r+=t[i-1].length,e.holes.push(r))}return e};var Ne=fe.exports;\n/*!\n     * @maptalks/vector-packer v0.92.1\n     * LICENSE : UNLICENSED\n     * (c) 2016-2024 maptalks.com\n     */const Le={Point:1,LineString:2,Polygon:3,MultiPoint:4,MultiLineString:5,MultiPolygon:6};function Ve(t,n={}){var e=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)Re(e,t.features[r],n,r);else Re(e,"Feature"===t.type?t:{geometry:t},n);return e}function Re(t,n,e,r){if(n.geometry&&n.geometry.geometry){var i=n.geometry.coordinates,s=n.geometry.type,o=[],a=n.id;if(e.promoteId?a=n.properties[e.promoteId]:e.generateId&&(a=r||0),"Point"===s)He(i,o);else if("MultiPoint"===s)for(var u=0;u<i.length;u++)He(i[u],o);else if("LineString"===s)qe([i],o);else if("MultiLineString"===s){if(e.lineMetrics){for(u=0;u<i.length;u++)We(i[u],o=[]),t.push(Ge(a,"LineString",o,n.properties));return}qe(i,o)}else if("Polygon"===s)qe(i,o);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(u=0;u<n.geometry.geometries.length;u++)Re(t,{id:a,geometry:n.geometry.geometries[u],properties:n.properties},e,r);return}return void console.warn(`Input data type(${s}) is not a valid GeoJSON geometry type.`)}for(u=0;u<i.length;u++){var h=[];qe(i[u],h),o.push(h)}}t.push(Ge(a,s,o,n.properties))}}function He(t,n){const e=new Ut(t[0],t[1]);e.z=100*(t[2]||0),n.push([e])}function We(t,n){for(let e=0;e<t.length;e++){const r=new Ut(t[e][0],t[e][1]);r.z=100*(t[e][2]||0),n.push(r)}}function qe(t,n,e,r){for(var i=0;i<t.length;i++){var s=[];We(t[i],s),n.push(s)}}function Ge(t,n,e,r){return{id:void 0===t?null:t,type:Le[n],geometry:e,properties:r}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */function Be(t,{width:n,height:e},r,i){if(i){if(i.length!==n*e*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(n*e*r);return t.width=n,t.height=e,t.data=i,t}function Je(t,{width:n,height:e},r){if(n===t.width&&e===t.height)return;const i=Be({},{width:n,height:e},r);Xe(t,i,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,n),height:Math.min(t.height,e)},r),t.width=n,t.height=e,t.data=i.data}function Xe(t,n,e,r,i,s){if(0===i.width||0===i.height)return n;if(i.width>t.width||i.height>t.height||e.x>t.width-i.width||e.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>n.width||i.height>n.height||r.x>n.width-i.width||r.y>n.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const o=t.data,a=n.data;if(o===a)return n;for(let u=0;u<i.height;u++){const h=((e.y+u)*t.width+e.x)*s,l=((r.y+u)*n.width+r.x)*s;for(let t=0;t<i.width*s;t++)a[l+t]=o[h+t]}return n}class Ye{constructor(t,n){Be(this,t,1,n)}resize(t){Je(this,t,1)}clone(){return new Ye({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){Xe(t,n,e,r,i,1)}}class Ze{constructor(t,n){Be(this,t,4,n)}resize(t){Je(this,t,4)}clone(){return new Ze({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,e,r,i){Xe(t,n,e,r,i,4)}}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     */class Ke{constructor(t,n,{pixelRatio:e}){this.paddedRect=t,this.pixelRatio=e||1,this.padding=n}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.pixelRatio,(this.paddedRect.h-2*this.padding)/this.pixelRatio]}}class Qe{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n=Object.keys(t).length,e={},r=new Lt(0,0,{autoResize:!0}),i=[],s=n>1?1:0;for(const n in t){const r=t[n],o={x:0,y:0,w:r.data.width+2*s,h:r.data.height+2*s};i.push(o),e[n]=new Ke(o,s,r)}if(r.pack(i,{inPlace:!0}),!tr(r.w)||!tr(r.h)){const t=nr(r.w),n=nr(r.h);r.resize(t,n)}const o=new Ze({width:r.w,height:r.h});for(const n in t){const r=t[n],i=e[n].paddedRect;Ze.copy(r.data,o,{x:0,y:0},{x:i.x+s,y:i.y+s},r.data)}this.image=o,this.positions=e}}function tr(t){return 0==(t&t-1)&&0!==t}function nr(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}\n/*!\n     * Codes from mapbox-gl-js\n     * github.com/mapbox/mapbox-gl-js\n     * MIT License\n     * TODO potpack\n     */class er{constructor(t){this.glyphMap=t,this.build()}build(){const t=this.glyphMap,n={},e=new Lt(0,0,{autoResize:!0}),r=[];for(const e in t){const i=t[e],s=n[e]={};for(const t in i){const n=i[+t];if(!n||0===n.bitmap.width||0===n.bitmap.height)continue;const e={x:0,y:0,w:n.bitmap.width+2,h:n.bitmap.height+2};r.push(e),s[t]={rect:e,metrics:n.metrics}}}e.pack(r,{inPlace:!0});const i=new Ye({width:e.w,height:e.h});for(const e in t){const r=t[e];for(const t in r){const s=r[+t];if(!s||0===s.bitmap.width||0===s.bitmap.height)continue;const o=n[e][t].rect;Ye.copy(s.bitmap,i,{x:0,y:0},{x:o.x+1,y:o.y+1},s.bitmap)}}this.image=i,this.positions=n}}function rr(t){return t<65536?Uint16Array:Uint32Array}function ir(t){return(t=Math.abs(t))<128?Int8Array:t<32768?Int16Array:Float32Array}function sr(t){return t<256?Uint8Array:t<65536?Uint16Array:Float32Array}function or(t,n){const e=new n(t.length),r=e.length;for(let n=0;n<r;n++)e[n]=t[n];return e}function ar(t){const n=t.type,e=[];if(1===n||4===n)for(let n=0;n<t.geometry.length;n++)He(t.geometry[n],e);else if(2===n)qe(t.geometry,e);else if(3===n)qe(t.geometry,e);else if(5===n)qe(t.geometry,e);else if(6===n)for(let n=0;n<t.geometry.length;n++){const r=[];qe(t.geometry[n],r),e.push(r)}return t.geometry=e,t}function ur(t){for(let n=1;n<arguments.length;n++){const e=arguments[n];for(const n in e)t[n]=e[n]}return t}function hr(t){return null==t}function lr(t){return"number"==typeof t&&!isNaN(t)}function cr(t){return"object"==typeof t&&!!t}function fr(t){return!hr(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function dr(t){return!hr(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}const pr=Object.prototype.hasOwnProperty;function yr(t,n){return pr.call(t,n)}const mr=Math.PI/180;function gr(t){return t&&d(t)&&t.property}function vr(t){const{verticalCentimeterToPoint:n,tileRatio:e}=t;return n*e}function br(t){return"centimeter"===t||"cm"===t?1:"millimeter"===t||"mm"===t?.1:100}const wr={};function Mr(t,n){if(!Array.isArray(n)){if(n&&void 0!==n.r&&void 0!==n.g&&void 0!==n.b)return t[0]=255*n.r,t[1]=255*n.g,t[2]=255*n.b,t[3]=void 0!==n.a?255*n.a:255,t;n=wr[n]=wr[n]||Cn(n).unitArray()}for(let e=0;e<n.length;e++)t[e]=255*n[e];return 3===n.length&&(t[3]=255),t}const xr={textFill:1,textSize:1,textOpacity:1,textDx:1,textDy:1,markerWidth:1,markerHeight:1,markerOpacity:1,markerDx:1,markerDy:1,lineWidth:1,lineColor:1,lineOpacity:1,polygonFill:1,polygonOpacity:1,polygonPatternFileWidth:1,polygonPatternFileOrigin:1},Fr={textName:1,markerTextFitPadding:1,markerTextFit:1,lineGradientProperty:1};var Ar=Object.freeze({__proto__:null,now:function(){return Date.now()},extend:ur,isNil:hr,isNumber:lr,isInteger:function(t){return(0|t)===t},isObject:cr,isString:fr,isFunction:dr,hasOwn:yr,join:function(t,n){return t.join?t.join(n||","):Array.prototype.join.call(t,n||",")},toRadian:function(t){return t*mr},toDegree:function(t){return t/mr},evaluate:function(t,n,e){return dr(t)?t(void 0!==e?e:null,n):t},isFnTypeSymbol:gr,getAltitudeToLocal:vr,getTubeSizeScale:br,normalizeColor:Mr,checkIfIdentityZoomDependent:function(t,n,e){if(Array.isArray(e)||(e=Object.values(e)),!e||!e.length)return!1;if(!xr[t])return!1;for(let t=0;t<e.length;t++){const r=e[t]&&(e[t].feature||e[t]);if(!r)continue;const i=r.properties&&r.properties[n];if(i&&d(i)&&!p(i).isZoomConstant)return!0}return!1},checkIfZoomFnTypeSymbol:function(t){return!!xr[t]||!!Fr[t]}});function kr(t){let n=0;for(let e,r,i=0,s=t.length,o=s-1;i<s;o=i++)if(e=t[i],r=t[o],void 0!==e.x){if(e.z||r.z)return 1;n+=(r.x-e.x)*(e.y+r.y)}else{if(e[2]||r[2])return 1;n+=(r[0]-e[0])*(e[1]+r[1])}return n}function Pr(t,n,e,r,i){const s=t[n*r],o=t[n*r+1],a=t[e*r],u=t[e*r+1];return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function Sr(t,n,e){let r=e;return n&&t&&(r=+t[n]),isNaN(r)&&(r=e||0),100*r}function _r(t,n,e,r,i,s,o){n||0===n||(n=1);const a=Sr(t.properties,e,r),u=a*n;let h=(s?100*s:0)||a;return i?h=Sr(t.properties,i,s):o&&(h=a-Sr(t.properties,o,s)),h*=n,{altitude:u,height:h}}function Or(t,n){return n<1/0&&(t.x<0||t.x>n||t.y<0||t.y>n)}function Er(t){return null==t}function Ir(t,n,e){if(t===e||t===n)return t;const r=e-n;return((t-n)%r+r)%r+n}function $r(t,n){if(!n)return null;const e=new Map;for(let r=0;r<n.length;r++){const i=n[r],s=t[i];let o=e.get(s);o||(o=[],e.set(s,o)),o.push(i)}return e}class Cr{constructor(t,n,e,r){this.feature=t,this.symbol=n,this.fnTypes=e,this.options=r}getPolygonResource(){let t=this.symbol.polygonPatternFile;const{polygonPatternFileFn:n}=this.fnTypes;return this.U(t,n)}getLineResource(){let t=this.symbol.linePatternFile;const{linePatternFileFn:n}=this.fnTypes;return this.U(t,n)}U(t,n){return n&&(t=n(this.options.zoom,this.feature.properties)),t}}function Tr(t,n,e,r){const i=Math.abs(r)>>15,s=i>>1,o=i%2;let a=r%Math.pow(2,15);const u=n+(s<<14)*Math.sign(n),h=e+(o<<14)*Math.sign(e);return t[0]=u,t[1]=h,a=Math.round(a),t[2]=0===a?r<0?-1:0:a,t}const zr=Math.pow(2,14),Dr=Math.pow(2,15);\n/*!\n     * a compact version of mapbox-gl-style-spec\n     * based on mapbox-gl-style-spec@13.28.0\n     * https://github.com/mapbox/mapbox-gl-js/tree/main/src/style-spec\n     * LICENSE : ISC\n     */var jr,Ur,Nr="undefined"!=typeof undefinedThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof undefined?global:"undefined"!=typeof self?self:{},Lr={exports:{}};function Vr(t,...n){for(const e of n)for(const n in e)t[n]=e[n];return t}\n/*! https://mths.be/punycode v1.3.2 by @mathias */jr=Lr,Ur=Lr.exports,function(t){var n=Ur&&!Ur.nodeType&&Ur,e=jr&&!jr.nodeType&&jr,r="object"==typeof Nr&&Nr;r.global!==r&&r.window!==r&&r.self!==r||(t=r);var i,s,o=2147483647,a=/^xn--/,u=/[^\\x20-\\x7E]/,h=/[\\x2E\\u3002\\uFF0E\\uFF61]/g,l={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},c=Math.floor,f=String.fromCharCode;function d(t){throw RangeError(l[t])}function p(t,n){for(var e=t.length,r=[];e--;)r[e]=n(t[e]);return r}function y(t,n){var e=t.split("@"),r="";return e.length>1&&(r=e[0]+"@",t=e[1]),r+p((t=t.replace(h,".")).split("."),n).join(".")}function m(t){for(var n,e,r=[],i=0,s=t.length;i<s;)(n=t.charCodeAt(i++))>=55296&&n<=56319&&i<s?56320==(64512&(e=t.charCodeAt(i++)))?r.push(((1023&n)<<10)+(1023&e)+65536):(r.push(n),i--):r.push(n);return r}function g(t){return p(t,(function(t){var n="";return t>65535&&(n+=f((t-=65536)>>>10&1023|55296),t=56320|1023&t),n+f(t)})).join("")}function v(t,n){return t+22+75*(t<26)-((0!=n)<<5)}function b(t,n,e){var r=0;for(t=e?c(t/700):t>>1,t+=c(t/n);t>455;r+=36)t=c(t/35);return c(r+36*t/(t+38))}function w(t){var n,e,r,i,s,a,u,h,l,f,p,y=[],m=t.length,v=0,w=128,M=72;for((e=t.lastIndexOf("-"))<0&&(e=0),r=0;r<e;++r)t.charCodeAt(r)>=128&&d("not-basic"),y.push(t.charCodeAt(r));for(i=e>0?e+1:0;i<m;){for(s=v,a=1,u=36;i>=m&&d("invalid-input"),((h=(p=t.charCodeAt(i++))-48<10?p-22:p-65<26?p-65:p-97<26?p-97:36)>=36||h>c((o-v)/a))&&d("overflow"),v+=h*a,!(h<(l=u<=M?1:u>=M+26?26:u-M));u+=36)a>c(o/(f=36-l))&&d("overflow"),a*=f;M=b(v-s,n=y.length+1,0==s),c(v/n)>o-w&&d("overflow"),w+=c(v/n),v%=n,y.splice(v++,0,w)}return g(y)}function M(t){var n,e,r,i,s,a,u,h,l,p,y,g,w,M,x,F=[];for(g=(t=m(t)).length,n=128,e=0,s=72,a=0;a<g;++a)(y=t[a])<128&&F.push(f(y));for(r=i=F.length,i&&F.push("-");r<g;){for(u=o,a=0;a<g;++a)(y=t[a])>=n&&y<u&&(u=y);for(u-n>c((o-e)/(w=r+1))&&d("overflow"),e+=(u-n)*w,n=u,a=0;a<g;++a)if((y=t[a])<n&&++e>o&&d("overflow"),y==n){for(h=e,l=36;!(h<(p=l<=s?1:l>=s+26?26:l-s));l+=36)F.push(f(v(p+(x=h-p)%(M=36-p),0))),h=c(x/M);F.push(f(v(h,0))),s=b(e,w,r==i),e=0,++r}++e,++n}return F.join("")}if(i={version:"1.3.2",ucs2:{decode:m,encode:g},decode:w,encode:M,toASCII:function(t){return y(t,(function(t){return u.test(t)?"xn--"+M(t):t}))},toUnicode:function(t){return y(t,(function(t){return a.test(t)?w(t.slice(4).toLowerCase()):t}))}},n&&e)if(jr.exports==n)e.exports=i;else for(s in i)i.hasOwnProperty(s)&&(n[s]=i[s]);else t.punycode=i}(Nr);class Rr extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}var Hr=Rr;class Wr{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[t,e]of n)this.bindings[t]=e}concat(t){return new Wr(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}var qr=Wr;const Gr={kind:"null"},Br={kind:"number"},Jr={kind:"string"},Xr={kind:"boolean"},Yr={kind:"color"},Zr={kind:"object"},Kr={kind:"value"},Qr={kind:"collator"},ti={kind:"formatted"},ni={kind:"resolvedImage"};function ei(t,n){return{kind:"array",itemType:t,N:n}}function ri(t){if("array"===t.kind){const n=ri(t.itemType);return"number"==typeof t.N?`array<${n}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${n}>`}return t.kind}const ii=[Gr,Br,Jr,Xr,Yr,ti,Zr,ei(Kr),ni];function si(t,n){if("error"===n.kind)return null;if("array"===t.kind){if("array"===n.kind&&(0===n.N&&"value"===n.itemType.kind||!si(t.itemType,n.itemType))&&("number"!=typeof t.N||t.N===n.N))return null}else{if(t.kind===n.kind)return null;if("value"===t.kind)for(const t of ii)if(!si(t,n))return null}return`Expected ${ri(t)} but found ${ri(n)} instead.`}function oi(t,n){return n.some(n=>n.kind===t.kind)}function ai(t,n){return n.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var ui,hi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function li(t){return(t=Math.round(t))<0?0:t>255?255:t}function ci(t){return li("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function fi(t){return function(t){return t<0?0:t>1?1:t}("%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))}function di(t,n,e){return e<0?e+=1:e>1&&(e-=1),6*e<1?t+(n-t)*e*6:2*e<1?n:3*e<2?t+(n-t)*(2/3-e)*6:t}try{ui={}.parseCSSColor=function(t){var n,e=t.replace(/ /g,"").toLowerCase();if(e in hi)return hi[e].slice();if("#"===e[0])return 4===e.length?(n=parseInt(e.substr(1),16))>=0&&n<=4095?[(3840&n)>>4|(3840&n)>>8,240&n|(240&n)>>4,15&n|(15&n)<<4,1]:null:7===e.length&&(n=parseInt(e.substr(1),16))>=0&&n<=16777215?[(16711680&n)>>16,(65280&n)>>8,255&n,1]:null;var r=e.indexOf("("),i=e.indexOf(")");if(-1!==r&&i+1===e.length){var s=e.substr(0,r),o=e.substr(r+1,i-(r+1)).split(","),a=1;switch(s){case"rgba":if(4!==o.length)return null;a=fi(o.pop());case"rgb":return 3!==o.length?null:[ci(o[0]),ci(o[1]),ci(o[2]),a];case"hsla":if(4!==o.length)return null;a=fi(o.pop());case"hsl":if(3!==o.length)return null;var u=(parseFloat(o[0])%360+360)%360/360,h=fi(o[1]),l=fi(o[2]),c=l<=.5?l*(h+1):l+h-l*h,f=2*l-c;return[li(255*di(f,c,u+1/3)),li(255*di(f,c,u)),li(255*di(f,c,u-1/3)),a];default:return null}}return null}}catch(t){}class pi{constructor(t,n,e,r=1){this.r=t,this.g=n,this.b=e,this.a=r}static parse(t){if(!t)return;if(t instanceof pi)return t;if("string"!=typeof t)return;const n=ui(t);return n?new pi(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[t,n,e,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(n)},${Math.round(e)},${r})`}toArray(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*n/r,255*e/r,r]}toArray01(){const{r:t,g:n,b:e,a:r}=this;return 0===r?[0,0,0,0]:[t/r,n/r,e/r,r]}toArray01PremultipliedAlpha(){const{r:t,g:n,b:e,a:r}=this;return[t,n,e,r]}}pi.black=new pi(0,0,0,1),pi.white=new pi(1,1,1,1),pi.transparent=new pi(0,0,0,0),pi.red=new pi(1,0,0,1),pi.blue=new pi(0,0,1,1);var yi=pi;class mi{constructor(t,n,e){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=e,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class gi{constructor(t,n,e,r,i){this.text=t.normalize?t.normalize():t,this.image=n,this.scale=e,this.fontStack=r,this.textColor=i}}class vi{constructor(t){this.sections=t}static fromString(t){return new vi([new gi(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof vi?t:vi.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const n of this.sections){if(n.image){t.push(["image",n.image.name]);continue}t.push(n.text);const e={};n.fontStack&&(e["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(e["font-scale"]=n.scale),n.textColor&&(e["text-color"]=["rgba"].concat(n.textColor.toArray())),t.push(e)}return t}}class bi{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new bi({name:t,available:!1}):null}serialize(){return["image",this.name]}}function wi(t,n,e,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof n&&n>=0&&n<=255&&"number"==typeof e&&e>=0&&e<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,n,e,r].join(", ")}]: \'a\' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,n,e,r]:[t,n,e]).join(", ")}]: \'r\', \'g\', and \'b\' must be between 0 and 255.`}function Mi(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof yi)return!0;if(t instanceof mi)return!0;if(t instanceof vi)return!0;if(t instanceof bi)return!0;if(Array.isArray(t)){for(const n of t)if(!Mi(n))return!1;return!0}if("object"==typeof t){for(const n in t)if(!Mi(t[n]))return!1;return!0}return!1}function xi(t){if(null===t)return Gr;if("string"==typeof t)return Jr;if("boolean"==typeof t)return Xr;if("number"==typeof t)return Br;if(t instanceof yi)return Yr;if(t instanceof mi)return Qr;if(t instanceof vi)return ti;if(t instanceof bi)return ni;if(Array.isArray(t)){const n=t.length;let e;for(const n of t){const t=xi(n);if(e){if(e===t)continue;e=Kr;break}e=t}return ei(e||Kr,n)}return Zr}function Fi(t){const n=typeof t;return null===t?"":"string"===n||"number"===n||"boolean"===n?String(t):t instanceof yi||t instanceof vi||t instanceof bi?t.toString():JSON.stringify(t)}class Ai{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(2!==t.length)return n.error(`\'literal\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Mi(t[1]))return n.error("invalid value");const e=t[1];let r=xi(e);const i=n.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new Ai(r,e)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof yi?["rgba"].concat(this.value.toArray()):this.value instanceof vi?this.value.serialize():this.value}}var ki=Ai,Pi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Si={string:Jr,number:Br,boolean:Xr,object:Zr};class _i{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let e,r=1;const i=t[0];if("array"===i){let i,s;if(t.length>2){const e=t[1];if("string"!=typeof e||!(e in Si)||"object"===e)return n.error(\'The item type argument of "array" must be one of string, number, boolean\',1);i=Si[e],r++}else i=Kr;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return n.error(\'The length argument to "array" must be a positive integer literal\',2);s=t[2],r++}e=ei(i,s)}else e=Si[i];const s=[];for(;r<t.length;r++){const e=n.parse(t[r],r,Kr);if(!e)return null;s.push(e)}return new _i(e,s)}evaluate(t){for(let n=0;n<this.args.length;n++){const e=this.args[n].evaluate(t);if(!si(this.type,xi(e)))return e;if(n===this.args.length-1)throw new Pi(`Expected value to be of type ${ri(this.type)}, but found ${ri(xi(e))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,n=[t.kind];if("array"===t.kind){const e=t.itemType;if("string"===e.kind||"number"===e.kind||"boolean"===e.kind){n.push(e.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&n.push(r)}}return n.concat(this.args.map(t=>t.serialize()))}}var Oi=_i;class Ei{constructor(t){this.type=ti,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[1];if(!Array.isArray(e)&&"object"==typeof e)return n.error("First argument must be an image or text section.");const r=[];let i=!1;for(let e=1;e<=t.length-1;++e){const s=t[e];if(i&&"object"==typeof s&&!Array.isArray(s)){i=!1;let t=null;if(s["font-scale"]&&(t=n.parse(s["font-scale"],1,Br),!t))return null;let e=null;if(s["text-font"]&&(e=n.parse(s["text-font"],1,ei(Jr)),!e))return null;let o=null;if(s["text-color"]&&(o=n.parse(s["text-color"],1,Yr),!o))return null;const a=r[r.length-1];a.scale=t,a.font=e,a.textColor=o}else{const s=n.parse(t[e],1,Kr);if(!s)return null;const o=s.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return n.error("Formatted text type must be \'string\', \'value\', \'image\' or \'null\'.");i=!0,r.push({content:s,scale:null,font:null,textColor:null})}}return new Ei(r)}evaluate(t){return new vi(this.sections.map(n=>{const e=n.content.evaluate(t);return xi(e)===ni?new gi("",e,null,null,null):new gi(Fi(e),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const n of this.sections){t.push(n.content.serialize());const e={};n.scale&&(e["font-scale"]=n.scale.serialize()),n.font&&(e["text-font"]=n.font.serialize()),n.textColor&&(e["text-color"]=n.textColor.serialize()),t.push(e)}return t}}class Ii{constructor(t){this.type=ni,this.input=t}static parse(t,n){if(2!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,Jr);return e?new Ii(e):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),e=bi.fromString(n);return e&&t.availableImages&&(e.available=t.availableImages.indexOf(n)>-1),e}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const $i={"to-boolean":Xr,"to-color":Yr,"to-number":Br,"to-string":Jr};class Ci{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const e=t[0];if(("to-boolean"===e||"to-string"===e)&&2!==t.length)return n.error("Expected one argument.");const r=$i[e],i=[];for(let e=1;e<t.length;e++){const r=n.parse(t[e],e,Kr);if(!r)return null;i.push(r)}return new Ci(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let n,e;for(const r of this.args){if(n=r.evaluate(t),e=null,n instanceof yi)return n;if("string"==typeof n){const e=t.parseColor(n);if(e)return e}else if(Array.isArray(n)&&(e=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:wi(n[0],n[1],n[2],n[3]),!e))return new yi(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Pi(e||`Could not parse color from value \'${"string"==typeof n?n:String(JSON.stringify(n))}\'`)}if("number"===this.type.kind){let n=null;for(const e of this.args){if(n=e.evaluate(t),null===n)return 0;const r=Number(n);if(!isNaN(r))return r}throw new Pi(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?vi.fromString(Fi(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?bi.fromString(Fi(this.args[0].evaluate(t))):Fi(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Ei([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ii(this.args[0]).serialize();const t=["to-"+this.type.kind];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Ti=Ci;const zi=["Unknown","Point","LineString","Polygon"];var Di=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this.L={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?zi[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,n=this.featureDistanceData.scale,{x:e,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(e*n-t[0])+this.featureDistanceData.bearing[1]*(r*n-t[1])}return 0}parseColor(t){let n=this.L[t];return n||(n=this.L[t]=yi.parse(t)),n}};class ji{constructor(t,n,e,r){this.name=t,this.type=n,this.V=e,this.args=r}evaluate(t){return this.V(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,n){const e=t[0],r=ji.definitions[e];if(!r)return n.error(`Unknown expression "${e}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,s=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,o=s.filter(([n])=>!Array.isArray(n)||n.length===t.length-1);let a=null;for(const[r,s]of o){a=new hs(n.registry,n.path,null,n.scope);const o=[];let u=!1;for(let n=1;n<t.length;n++){const e=t[n],i=Array.isArray(r)?r[n-1]:r.type,s=a.parse(e,1+o.length,i);if(!s){u=!0;break}o.push(s)}if(!u)if(Array.isArray(r)&&r.length!==o.length)a.error(`Expected ${r.length} arguments, but found ${o.length} instead.`);else{for(let t=0;t<o.length;t++){const n=Array.isArray(r)?r[t]:r.type,e=o[t];a.concat(t+1).checkSubtype(n,e.type)}if(0===a.errors.length)return new ji(e,i,s,o)}}if(1===o.length)n.errors.push(...a.errors);else{const e=(o.length?o:s).map(([t])=>{return n=t,Array.isArray(n)?`(${n.map(ri).join(", ")})`:`(${ri(n.type)}...)`;var n}).join(" | "),r=[];for(let e=1;e<t.length;e++){const i=n.parse(t[e],1+r.length);if(!i)return null;r.push(ri(i.type))}n.error(`Expected arguments of type ${e}, but found (${r.join(", ")}) instead.`)}return null}static register(t,n){ji.definitions=n;for(const e in n)t[e]=ji}}var Ui=ji;class Ni{constructor(t,n,e){this.type=Qr,this.locale=e,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(2!==t.length)return n.error("Expected one argument.");const e=t[1];if("object"!=typeof e||Array.isArray(e))return n.error("Collator options argument must be an object.");const r=n.parse(void 0!==e["case-sensitive"]&&e["case-sensitive"],1,Xr);if(!r)return null;const i=n.parse(void 0!==e["diacritic-sensitive"]&&e["diacritic-sensitive"],1,Xr);if(!i)return null;let s=null;return e.locale&&(s=n.parse(e.locale,1,Jr),!s)?null:new Ni(r,i,s)}evaluate(t){return new mi(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Li(t,n){t[0]=Math.min(t[0],n[0]),t[1]=Math.min(t[1],n[1]),t[2]=Math.max(t[2],n[0]),t[3]=Math.max(t[3],n[1])}function Vi(t,n){return!(t[0]<=n[0]||t[2]>=n[2]||t[1]<=n[1]||t[3]>=n[3])}function Ri(t,n){const e=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,n.z);return[Math.round(e*i*8192),Math.round(r*i*8192)]}function Hi(t,n,e){const r=t[0]-n[0],i=t[1]-n[1],s=t[0]-e[0],o=t[1]-e[1];return r*o-s*i==0&&r*s<=0&&i*o<=0}function Wi(t,n){let e=!1;for(let o=0,a=n.length;o<a;o++){const a=n[o];for(let n=0,o=a.length;n<o-1;n++){if(Hi(t,a[n],a[n+1]))return!1;(i=a[n])[1]>(r=t)[1]!=(s=a[n+1])[1]>r[1]&&r[0]<(s[0]-i[0])*(r[1]-i[1])/(s[1]-i[1])+i[0]&&(e=!e)}}var r,i,s;return e}function qi(t,n){for(let e=0;e<n.length;e++)if(Wi(t,n[e]))return!0;return!1}function Gi(t,n,e,r){const i=r[0]-e[0],s=r[1]-e[1],o=(t[0]-e[0])*s-i*(t[1]-e[1]),a=(n[0]-e[0])*s-i*(n[1]-e[1]);return o>0&&a<0||o<0&&a>0}function Bi(t,n,e){for(const h of e)for(let e=0;e<h.length-1;++e)if(void 0,void 0,0!=(a=[(o=h[e+1])[0]-(s=h[e])[0],o[1]-s[1]])[0]*(u=[(i=n)[0]-(r=t)[0],i[1]-r[1]])[1]-a[1]*u[0]&&Gi(r,i,s,o)&&Gi(s,o,r,i))return!0;var r,i,s,o,a,u;return!1}function Ji(t,n){for(let e=0;e<t.length;++e)if(!Wi(t[e],n))return!1;for(let e=0;e<t.length-1;++e)if(Bi(t[e],t[e+1],n))return!1;return!0}function Xi(t,n){for(let e=0;e<n.length;e++)if(Ji(t,n[e]))return!0;return!1}function Yi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=[];for(let r=0;r<t[i].length;r++){const o=Ri(t[i][r],e);Li(n,o),s.push(o)}r.push(s)}return r}function Zi(t,n,e){const r=[];for(let i=0;i<t.length;i++){const s=Yi(t[i],n,e);r.push(s)}return r}function Ki(t,n,e,r){if(t[0]<e[0]||t[0]>e[2]){const n=.5*r;let i=t[0]-e[0]>n?-r:e[0]-t[0]>n?r:0;0===i&&(i=t[0]-e[2]>n?-r:e[2]-t[0]>n?r:0),t[0]+=i}Li(n,t)}function Qi(t,n,e,r){const i=8192*Math.pow(2,r.z),s=[8192*r.x,8192*r.y],o=[];if(!t)return o;for(const r of t)for(const t of r){const r=[t.x+s[0],t.y+s[1]];Ki(r,n,e,i),o.push(r)}return o}function ts(t,n,e,r){const i=8192*Math.pow(2,r.z),s=[8192*r.x,8192*r.y],o=[];if(!t)return o;for(const e of t){const t=[];for(const r of e){const e=[r.x+s[0],r.y+s[1]];Li(n,e),t.push(e)}o.push(t)}if(n[2]-n[0]<=i/2){(a=n)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of o)for(const r of t)Ki(r,n,e,i)}var a;return o}class ns{constructor(t,n){this.type=Xr,this.geojson=t,this.geometries=n}static parse(t,n){if(2!==t.length)return n.error(`\'within\' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Mi(t[1])){const n=t[1];if("FeatureCollection"===n.type)for(let t=0;t<n.features.length;++t){const e=n.features[t].geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new ns(n,n.features[t].geometry)}else if("Feature"===n.type){const t=n.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new ns(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new ns(n,n)}return n.error("\'within\' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=Yi(n.coordinates,r,i),o=Qi(t.geometry(),e,r,i);if(!Vi(e,r))return!1;for(const t of o)if(!Wi(t,s))return!1}if("MultiPolygon"===n.type){const s=Zi(n.coordinates,r,i),o=Qi(t.geometry(),e,r,i);if(!Vi(e,r))return!1;for(const t of o)if(!qi(t,s))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,n){const e=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===n.type){const s=Yi(n.coordinates,r,i),o=ts(t.geometry(),e,r,i);if(!Vi(e,r))return!1;for(const t of o)if(!Ji(t,s))return!1}if("MultiPolygon"===n.type){const s=Zi(n.coordinates,r,i),o=ts(t.geometry(),e,r,i);if(!Vi(e,r))return!1;for(const t of o)if(!Xi(t,s))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var es=ns;function rs(t){if(t instanceof Ui){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof es)return!1;let n=!0;return t.eachChild(t=>{n&&!rs(t)&&(n=!1)}),n}function is(t){if(t instanceof Ui&&"feature-state"===t.name)return!1;let n=!0;return t.eachChild(t=>{n&&!is(t)&&(n=!1)}),n}function ss(t,n){if(t instanceof Ui&&n.indexOf(t.name)>=0)return!1;let e=!0;return t.eachChild(t=>{e&&!ss(t,n)&&(e=!1)}),e}class os{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(2!==t.length||"string"!=typeof t[1])return n.error("\'var\' expression requires exactly one string literal argument.");const e=t[1];return n.scope.has(e)?new os(e,n.scope.get(e)):n.error(`Unknown variable "${e}". Make sure "${e}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var as=os;class us{constructor(t,n=[],e,r=new qr,i=[]){this.registry=t,this.path=n,this.key=n.map(t=>`[${t}]`).join(""),this.scope=r,this.errors=i,this.expectedType=e}parse(t,n,e,r,i={}){return n?this.concat(n,e,r).R(t,i):this.R(t,i)}R(t,n){function e(t,n,e){return"assert"===e?new Oi(n,[t]):"coerce"===e?new Ti(n,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error(\'Expected an array with at least one element. If you wanted a literal array, use ["literal", []].\');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=e(r,t,n.typeAnnotation||"coerce");else r=e(r,t,n.typeAnnotation||"assert")}if(!(r instanceof ki)&&"resolvedImage"!==r.type.kind&&function t(n){if(n instanceof as)return t(n.boundExpression);if(n instanceof Ui&&"error"===n.name)return!1;if(n instanceof Ni)return!1;if(n instanceof es)return!1;const e=n instanceof Ti||n instanceof Oi;let r=!0;return n.eachChild(n=>{r=e?r&&t(n):r&&n instanceof ki}),!!r&&(rs(n)&&ss(n,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}(r)){const n=new Di;try{r=new ki(r.type,r.evaluate(n))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"\'undefined\' value invalid. Use null instead.":"object"==typeof t?\'Bare objects invalid. Use ["literal", {...}] instead.\':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,e){const r="number"==typeof t?this.path.concat(t):this.path,i=e?this.scope.concat(e):this.scope;return new us(this.registry,r,n||null,i,this.errors)}error(t,...n){const e=`${this.key}${n.map(t=>`[${t}]`).join("")}`;this.errors.push(new Hr(e,t))}checkSubtype(t,n){const e=si(t,n);return e&&this.error(e),e}}var hs=us;function ls(t,n){const e=t.length-1;let r,i,s=0,o=e,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),r=t[a],i=t[a+1],r<=n){if(a===e||n<i)return a;s=a+1}else{if(!(r>n))throw new Pi("Input is not a number.");o=a-1}return 0}class cs{constructor(t,n,e){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[t,n]of e)this.labels.push(t),this.outputs.push(n)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const e=n.parse(t[1],1,Br);if(!e)return null;const r=[];let i=null;n.expectedType&&"value"!==n.expectedType.kind&&(i=n.expectedType);for(let e=1;e<t.length;e+=2){const s=1===e?-1/0:t[e],o=t[e+1],a=e,u=e+1;if("number"!=typeof s)return n.error(\'Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',a);if(r.length&&r[r.length-1][0]>=s)return n.error(\'Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.\',a);const h=n.parse(o,u,i);if(!h)return null;i=i||h.type,r.push([s,h])}return new cs(i,e,r)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;return r>=n[i-1]?e[i-1].evaluate(t):e[ls(n,r)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&t.push(this.labels[n]),t.push(this.outputs[n].serialize());return t}}var fs=cs,ds=ps;function ps(t,n,e,r){this.cx=3*t,this.bx=3*(e-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*n,this.by=3*(r-n)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=n,this.p2x=e,this.p2y=r}function ys(t,n,e){return t*(1-e)+n*e}ps.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,n){if(void 0===n&&(n=1e-6),t<0)return 0;if(t>1)return 1;for(var e=t,r=0;r<8;r++){var i=this.sampleCurveX(e)-t;if(Math.abs(i)<n)return e;var s=this.sampleCurveDerivativeX(e);if(Math.abs(s)<1e-6)break;e-=i/s}var o=0,a=1;for(e=t,r=0;r<20&&(i=this.sampleCurveX(e),!(Math.abs(i-t)<n));r++)t>i?o=e:a=e,e=.5*(a-o)+o;return e},solve:function(t,n){return this.sampleCurveY(this.solveCurveX(t,n))}};var ms=Object.freeze({__proto__:null,number:ys,color:function(t,n,e){return new yi(ys(t.r,n.r,e),ys(t.g,n.g,e),ys(t.b,n.b,e),ys(t.a,n.a,e))},array:function(t,n,e){return t.map((t,r)=>ys(t,n[r],e))}});const gs=6/29*3*(6/29),vs=Math.PI/180,bs=180/Math.PI;function ws(t){return t>.008856451679035631?Math.pow(t,1/3):t/gs+4/29}function Ms(t){return t>6/29?t*t*t:gs*(t-4/29)}function xs(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Fs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function As(t){const n=Fs(t.r),e=Fs(t.g),r=Fs(t.b),i=ws((.4124564*n+.3575761*e+.1804375*r)/.95047),s=ws((.2126729*n+.7151522*e+.072175*r)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-ws((.0193339*n+.119192*e+.9503041*r)/1.08883)),alpha:t.a}}function ks(t){let n=(t.l+16)/116,e=isNaN(t.a)?n:n+t.a/500,r=isNaN(t.b)?n:n-t.b/200;return n=1*Ms(n),e=.95047*Ms(e),r=1.08883*Ms(r),new yi(xs(3.2404542*e-1.5371385*n-.4985314*r),xs(-.969266*e+1.8760108*n+.041556*r),xs(.0556434*e-.2040259*n+1.0572252*r),t.alpha)}function Ps(t,n,e){const r=n-t;return t+e*(r>180||r<-180?r-360*Math.round(r/360):r)}const Ss={forward:As,reverse:ks,interpolate:function(t,n,e){return{l:ys(t.l,n.l,e),a:ys(t.a,n.a,e),b:ys(t.b,n.b,e),alpha:ys(t.alpha,n.alpha,e)}}},_s={forward:function(t){const{l:n,a:e,b:r}=As(t),i=Math.atan2(r,e)*bs;return{h:i<0?i+360:i,c:Math.sqrt(e*e+r*r),l:n,alpha:t.a}},reverse:function(t){const n=t.h*vs,e=t.c;return ks({l:t.l,a:Math.cos(n)*e,b:Math.sin(n)*e,alpha:t.alpha})},interpolate:function(t,n,e){return{h:Ps(t.h,n.h,e),c:ys(t.c,n.c,e),l:ys(t.l,n.l,e),alpha:ys(t.alpha,n.alpha,e)}}};var Os=Object.freeze({__proto__:null,lab:Ss,hcl:_s});class Es{constructor(t,n,e,r,i){this.type=t,this.operator=n,this.interpolation=e,this.input=r,this.labels=[],this.outputs=[];for(const[t,n]of i)this.labels.push(t),this.outputs.push(n)}static interpolationFactor(t,n,e,r){let i=0;if("exponential"===t.name)i=Is(n,t.base,e,r);else if("linear"===t.name)i=Is(n,1,e,r);else if("cubic-bezier"===t.name){const s=t.controlPoints;i=new ds(s[0],s[1],s[2],s[3]).solve(Is(n,1,e,r))}return i}static parse(t,n){let[e,r,i,...s]=t;if(!Array.isArray(r)||0===r.length)return n.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return n.error("Unknown interpolation type "+String(r[0]),1,0);{const t=r.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(i=n.parse(i,2,Br),!i)return null;const o=[];let a=null;"interpolate-hcl"===e||"interpolate-lab"===e?a=Yr:n.expectedType&&"value"!==n.expectedType.kind&&(a=n.expectedType);for(let t=0;t<s.length;t+=2){const e=s[t],r=s[t+1],i=t+3,u=t+4;if("number"!=typeof e)return n.error(\'Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.\',i);if(o.length&&o[o.length-1][0]>=e)return n.error(\'Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.\',i);const h=n.parse(r,u,a);if(!h)return null;a=a||h.type,o.push([e,h])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Es(a,e,r,i,o):n.error(`Type ${ri(a)} is not interpolatable.`)}evaluate(t){const n=this.labels,e=this.outputs;if(1===n.length)return e[0].evaluate(t);const r=this.input.evaluate(t);if(r<=n[0])return e[0].evaluate(t);const i=n.length;if(r>=n[i-1])return e[i-1].evaluate(t);const s=ls(n,r),o=Es.interpolationFactor(this.interpolation,r,n[s],n[s+1]),a=e[s].evaluate(t),u=e[s+1].evaluate(t);return"interpolate"===this.operator?ms[this.type.kind.toLowerCase()](a,u,o):"interpolate-hcl"===this.operator?_s.reverse(_s.interpolate(_s.forward(a),_s.forward(u),o)):Ss.reverse(Ss.interpolate(Ss.forward(a),Ss.forward(u),o))}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,t,this.input.serialize()];for(let t=0;t<this.labels.length;t++)n.push(this.labels[t],this.outputs[t].serialize());return n}}function Is(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}var $s=Es;class Cs{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let e=null;const r=n.expectedType;r&&"value"!==r.kind&&(e=r);const i=[];for(const r of t.slice(1)){const t=n.parse(r,1+i.length,e,void 0,{typeAnnotation:"omit"});if(!t)return null;e=e||t.type,i.push(t)}const s=r&&i.some(t=>si(r,t.type));return new Cs(s?Kr:e,i)}evaluate(t){let n,e=null,r=0;for(const i of this.args){if(r++,e=i.evaluate(t),e&&e instanceof bi&&!e.available&&(n||(n=e),e=null,r===this.args.length))return n;if(null!==e)break}return e}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Ts=Cs;class zs{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const e=[];for(let r=1;r<t.length-1;r+=2){const i=t[r];if("string"!=typeof i)return n.error(`Expected string, but found ${typeof i} instead.`,r);if(/[^a-zA-Z0-9_]/.test(i))return n.error("Variable names must contain only alphanumeric characters or \'_\'.",r);const s=n.parse(t[r+1],r+1);if(!s)return null;e.push([i,s])}const r=n.parse(t[t.length-1],t.length-1,n.expectedType,e);return r?new zs(e,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[n,e]of this.bindings)t.push(n,e.serialize());return t.push(this.result.serialize()),t}}var Ds=zs;class js{constructor(t,n,e){this.type=t,this.index=n,this.input=e}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const e=n.parse(t[1],1,Br),r=n.parse(t[2],2,ei(n.expectedType||Kr));return e&&r?new js(r.type.itemType,e,r):null}evaluate(t){const n=this.index.evaluate(t),e=this.input.evaluate(t);if(n<0)throw new Pi(`Array index out of bounds: ${n} < 0.`);if(n>=e.length)throw new Pi(`Array index out of bounds: ${n} > ${e.length-1}.`);if(n!==Math.floor(n))throw new Pi(`Array index must be an integer, but found ${n} instead.`);return e[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Us=js;class Ns{constructor(t,n){this.type=Xr,this.needle=t,this.haystack=n}static parse(t,n){if(3!==t.length)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const e=n.parse(t[1],1,Kr),r=n.parse(t[2],2,Kr);return e&&r?oi(e.type,[Xr,Jr,Br,Gr,Kr])?new Ns(e,r):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(e.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(null==e)return!1;if(!ai(n,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${ri(xi(n))} instead.`);if(!ai(e,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${ri(xi(e))} instead.`);return e.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Ls=Ns;class Vs{constructor(t,n,e){this.type=Br,this.needle=t,this.haystack=n,this.fromIndex=e}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const e=n.parse(t[1],1,Kr),r=n.parse(t[2],2,Kr);if(!e||!r)return null;if(!oi(e.type,[Xr,Jr,Br,Gr,Kr]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${ri(e.type)} instead`);if(4===t.length){const i=n.parse(t[3],3,Br);return i?new Vs(e,r,i):null}return new Vs(e,r)}evaluate(t){const n=this.needle.evaluate(t),e=this.haystack.evaluate(t);if(!ai(n,["boolean","string","number","null"]))throw new Pi(`Expected first argument to be of type boolean, string, number or null, but found ${ri(xi(n))} instead.`);if(!ai(e,["string","array"]))throw new Pi(`Expected second argument to be of type array or string, but found ${ri(xi(e))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return e.indexOf(n,r)}return e.indexOf(n)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Rs=Vs;class Hs{constructor(t,n,e,r,i,s){this.inputType=t,this.type=n,this.input=e,this.cases=r,this.outputs=i,this.otherwise=s}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let e,r;n.expectedType&&"value"!==n.expectedType.kind&&(r=n.expectedType);const i={},s=[];for(let o=2;o<t.length-1;o+=2){let a=t[o];const u=t[o+1];Array.isArray(a)||(a=[a]);const h=n.concat(o);if(0===a.length)return h.error("Expected at least one branch label.");for(const t of a){if("number"!=typeof t&&"string"!=typeof t)return h.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return h.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return h.error("Numeric branch labels must be integer values.");if(e){if(h.checkSubtype(e,xi(t)))return null}else e=xi(t);if(void 0!==i[String(t)])return h.error("Branch labels must be unique.");i[String(t)]=s.length}const l=n.parse(u,o,r);if(!l)return null;r=r||l.type,s.push(l)}const o=n.parse(t[1],1,Kr);if(!o)return null;const a=n.parse(t[t.length-1],t.length-1,r);return a?"value"!==o.type.kind&&n.concat(1).checkSubtype(e,o.type)?null:new Hs(e,r,o,i,s,a):null}evaluate(t){const n=this.input.evaluate(t);return(xi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),e=[],r={};for(const t of n){const n=r[this.cases[t]];void 0===n?(r[this.cases[t]]=e.length,e.push([this.cases[t],[t]])):e[n][1].push(t)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[n,r]of e)t.push(1===r.length?i(r[0]):r.map(i)),t.push(this.outputs[n].serialize());return t.push(this.otherwise.serialize()),t}}var Ws=Hs;class qs{constructor(t,n,e){this.type=t,this.branches=n,this.otherwise=e}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let e;n.expectedType&&"value"!==n.expectedType.kind&&(e=n.expectedType);const r=[];for(let i=1;i<t.length-1;i+=2){const s=n.parse(t[i],i,Xr);if(!s)return null;const o=n.parse(t[i+1],i+1,e);if(!o)return null;r.push([s,o]),e=e||o.type}const i=n.parse(t[t.length-1],t.length-1,e);return i?new qs(e,r,i):null}evaluate(t){for(const[n,e]of this.branches)if(n.evaluate(t))return e.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,e]of this.branches)t(n),t(e);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(n=>{t.push(n.serialize())}),t}}var Gs=qs;class Bs{constructor(t,n,e,r){this.type=t,this.input=n,this.beginIndex=e,this.endIndex=r}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const e=n.parse(t[1],1,Kr),r=n.parse(t[2],2,Br);if(!e||!r)return null;if(!oi(e.type,[ei(Kr),Jr,Kr]))return n.error(`Expected first argument to be of type array or string, but found ${ri(e.type)} instead`);if(4===t.length){const i=n.parse(t[3],3,Br);return i?new Bs(e.type,e,r,i):null}return new Bs(e.type,e,r)}evaluate(t){const n=this.input.evaluate(t),e=this.beginIndex.evaluate(t);if(!ai(n,["string","array"]))throw new Pi(`Expected first argument to be of type array or string, but found ${ri(xi(n))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return n.slice(e,r)}return n.slice(e)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Js=Bs;function Xs(t,n){return"=="===t||"!="===t?"boolean"===n.kind||"string"===n.kind||"number"===n.kind||"null"===n.kind||"value"===n.kind:"string"===n.kind||"number"===n.kind||"value"===n.kind}function Ys(t,n,e,r){return 0===r.compare(n,e)}function Zs(t,n,e){const r="=="!==t&&"!="!==t;return class i{constructor(t,n,e){this.type=Xr,this.lhs=t,this.rhs=n,this.collator=e,this.hasUntypedArgument="value"===t.type.kind||"value"===n.type.kind}static parse(t,n){if(3!==t.length&&4!==t.length)return n.error("Expected two or three arguments.");const e=t[0];let s=n.parse(t[1],1,Kr);if(!s)return null;if(!Xs(e,s.type))return n.concat(1).error(`"${e}" comparisons are not supported for type \'${ri(s.type)}\'.`);let o=n.parse(t[2],2,Kr);if(!o)return null;if(!Xs(e,o.type))return n.concat(2).error(`"${e}" comparisons are not supported for type \'${ri(o.type)}\'.`);if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error(`Cannot compare types \'${ri(s.type)}\' and \'${ri(o.type)}\'.`);r&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Oi(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Oi(s.type,[o])));let a=null;if(4===t.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return n.error("Cannot use collator to compare non-string types.");if(a=n.parse(t[3],3,Qr),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const n=xi(s),e=xi(o);if(n.kind!==e.kind||"string"!==n.kind&&"number"!==n.kind)throw new Pi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${n.kind}, ${e.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=xi(s),e=xi(o);if("string"!==t.kind||"string"!==e.kind)return n(i,s,o)}return this.collator?e(i,s,o,this.collator.evaluate(i)):n(i,s,o)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const n=[t];return this.eachChild(t=>{n.push(t.serialize())}),n}}}const Ks=Zs("==",(function(t,n,e){return n===e}),Ys),Qs=Zs("!=",(function(t,n,e){return n!==e}),(function(t,n,e,r){return!Ys(0,n,e,r)})),to=Zs("<",(function(t,n,e){return n<e}),(function(t,n,e,r){return r.compare(n,e)<0})),no=Zs(">",(function(t,n,e){return n>e}),(function(t,n,e,r){return r.compare(n,e)>0})),eo=Zs("<=",(function(t,n,e){return n<=e}),(function(t,n,e,r){return r.compare(n,e)<=0})),ro=Zs(">=",(function(t,n,e){return n>=e}),(function(t,n,e,r){return r.compare(n,e)>=0}));class io{constructor(t,n,e,r,i,s){this.type=Jr,this.number=t,this.locale=n,this.currency=e,this.unit=r,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(t,n){if(3!==t.length)return n.error("Expected two arguments.");const e=n.parse(t[1],1,Br);if(!e)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=n.parse(r.locale,1,Jr),!i))return null;let s=null;if(r.currency&&(s=n.parse(r.currency,1,Jr),!s))return null;let o=null;if(r.unit&&(o=n.parse(r.unit,1,Jr),!o))return null;let a=null;if(r["min-fraction-digits"]&&(a=n.parse(r["min-fraction-digits"],1,Br),!a))return null;let u=null;return r["max-fraction-digits"]&&(u=n.parse(r["max-fraction-digits"],1,Br),!u)?null:new io(e,i,s,o,a,u)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class so{constructor(t){this.type=Br,this.input=t}static parse(t,n){if(2!==t.length)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const e=n.parse(t[1],1);return e?"array"!==e.type.kind&&"string"!==e.type.kind&&"value"!==e.type.kind?n.error(`Expected argument of type string or array, but found ${ri(e.type)} instead.`):new so(e):null}evaluate(t){const n=this.input.evaluate(t);if("string"==typeof n)return n.length;if(Array.isArray(n))return n.length;throw new Pi(`Expected value to be of type string or array, but found ${ri(xi(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(n=>{t.push(n.serialize())}),t}}const oo={"==":Ks,"!=":Qs,">":no,"<":to,">=":ro,"<=":eo,array:Oi,at:Us,boolean:Oi,case:Gs,coalesce:Ts,collator:Ni,format:Ei,image:Ii,in:Ls,"index-of":Rs,interpolate:$s,"interpolate-hcl":$s,"interpolate-lab":$s,length:so,let:Ds,literal:ki,match:Ws,number:Oi,"number-format":io,object:Oi,slice:Js,step:fs,string:Oi,"to-boolean":Ti,"to-color":Ti,"to-number":Ti,"to-string":Ti,var:as,within:es};function ao(t,[n,e,r,i]){n=n.evaluate(t),e=e.evaluate(t),r=r.evaluate(t);const s=i?i.evaluate(t):1,o=wi(n,e,r,s);if(o)throw new Pi(o);return new yi(n/255*s,e/255*s,r/255*s,s)}function uo(t,n){return t in n}function ho(t,n){const e=n[t];return void 0===e?null:e}function lo(t){return{type:t}}Ui.register(oo,{error:[{kind:"error"},[Jr],(t,[n])=>{throw new Pi(n.evaluate(t))}],typeof:[Jr,[Kr],(t,[n])=>ri(xi(n.evaluate(t)))],"to-rgba":[ei(Br,4),[Yr],(t,[n])=>n.evaluate(t).toArray()],rgb:[Yr,[Br,Br,Br],ao],rgba:[Yr,[Br,Br,Br,Br],ao],has:{type:Xr,overloads:[[[Jr],(t,[n])=>uo(n.evaluate(t),t.properties())],[[Jr,Zr],(t,[n,e])=>uo(n.evaluate(t),e.evaluate(t))]]},get:{type:Kr,overloads:[[[Jr],(t,[n])=>ho(n.evaluate(t),t.properties())],[[Jr,Zr],(t,[n,e])=>ho(n.evaluate(t),e.evaluate(t))]]},"feature-state":[Kr,[Jr],(t,[n])=>ho(n.evaluate(t),t.featureState||{})],properties:[Zr,[],t=>t.properties()],"geometry-type":[Jr,[],t=>t.geometryType()],id:[Kr,[],t=>t.id()],zoom:[Br,[],t=>t.globals.zoom],pitch:[Br,[],t=>t.globals.pitch||0],"distance-from-center":[Br,[],t=>t.distanceFromCenter()],"heatmap-density":[Br,[],t=>t.globals.heatmapDensity||0],"line-progress":[Br,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Br,[],t=>t.globals.skyRadialProgress||0],accumulated:[Kr,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Br,lo(Br),(t,n)=>{let e=0;for(const r of n)e+=r.evaluate(t);return e}],"*":[Br,lo(Br),(t,n)=>{let e=1;for(const r of n)e*=r.evaluate(t);return e}],"-":{type:Br,overloads:[[[Br,Br],(t,[n,e])=>n.evaluate(t)-e.evaluate(t)],[[Br],(t,[n])=>-n.evaluate(t)]]},"/":[Br,[Br,Br],(t,[n,e])=>n.evaluate(t)/e.evaluate(t)],"%":[Br,[Br,Br],(t,[n,e])=>n.evaluate(t)%e.evaluate(t)],ln2:[Br,[],()=>Math.LN2],pi:[Br,[],()=>Math.PI],e:[Br,[],()=>Math.E],"^":[Br,[Br,Br],(t,[n,e])=>Math.pow(n.evaluate(t),e.evaluate(t))],sqrt:[Br,[Br],(t,[n])=>Math.sqrt(n.evaluate(t))],log10:[Br,[Br],(t,[n])=>Math.log(n.evaluate(t))/Math.LN10],ln:[Br,[Br],(t,[n])=>Math.log(n.evaluate(t))],log2:[Br,[Br],(t,[n])=>Math.log(n.evaluate(t))/Math.LN2],sin:[Br,[Br],(t,[n])=>Math.sin(n.evaluate(t))],cos:[Br,[Br],(t,[n])=>Math.cos(n.evaluate(t))],tan:[Br,[Br],(t,[n])=>Math.tan(n.evaluate(t))],asin:[Br,[Br],(t,[n])=>Math.asin(n.evaluate(t))],acos:[Br,[Br],(t,[n])=>Math.acos(n.evaluate(t))],atan:[Br,[Br],(t,[n])=>Math.atan(n.evaluate(t))],min:[Br,lo(Br),(t,n)=>Math.min(...n.map(n=>n.evaluate(t)))],max:[Br,lo(Br),(t,n)=>Math.max(...n.map(n=>n.evaluate(t)))],abs:[Br,[Br],(t,[n])=>Math.abs(n.evaluate(t))],round:[Br,[Br],(t,[n])=>{const e=n.evaluate(t);return e<0?-Math.round(-e):Math.round(e)}],floor:[Br,[Br],(t,[n])=>Math.floor(n.evaluate(t))],ceil:[Br,[Br],(t,[n])=>Math.ceil(n.evaluate(t))],"filter-==":[Xr,[Jr,Kr],(t,[n,e])=>t.properties()[n.value]===e.value],"filter-id-==":[Xr,[Kr],(t,[n])=>t.id()===n.value],"filter-type-==":[Xr,[Jr],(t,[n])=>t.geometryType()===n.value],"filter-<":[Xr,[Jr,Kr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<i}],"filter-id-<":[Xr,[Kr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<r}],"filter->":[Xr,[Jr,Kr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>i}],"filter-id->":[Xr,[Kr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>r}],"filter-<=":[Xr,[Jr,Kr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[Xr,[Kr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e<=r}],"filter->=":[Xr,[Jr,Kr],(t,[n,e])=>{const r=t.properties()[n.value],i=e.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[Xr,[Kr],(t,[n])=>{const e=t.id(),r=n.value;return typeof e==typeof r&&e>=r}],"filter-has":[Xr,[Kr],(t,[n])=>n.value in t.properties()],"filter-has-id":[Xr,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Xr,[ei(Jr)],(t,[n])=>n.value.indexOf(t.geometryType())>=0],"filter-id-in":[Xr,[ei(Kr)],(t,[n])=>n.value.indexOf(t.id())>=0],"filter-in-small":[Xr,[Jr,ei(Kr)],(t,[n,e])=>e.value.indexOf(t.properties()[n.value])>=0],"filter-in-large":[Xr,[Jr,ei(Kr)],(t,[n,e])=>function(t,n,e,r){for(;e<=r;){const i=e+r>>1;if(n[i]===t)return!0;n[i]>t?r=i-1:e=i+1}return!1}(t.properties()[n.value],e.value,0,e.value.length-1)],all:{type:Xr,overloads:[[[Xr,Xr],(t,[n,e])=>n.evaluate(t)&&e.evaluate(t)],[lo(Xr),(t,n)=>{for(const e of n)if(!e.evaluate(t))return!1;return!0}]]},any:{type:Xr,overloads:[[[Xr,Xr],(t,[n,e])=>n.evaluate(t)||e.evaluate(t)],[lo(Xr),(t,n)=>{for(const e of n)if(e.evaluate(t))return!0;return!1}]]},"!":[Xr,[Xr],(t,[n])=>!n.evaluate(t)],"is-supported-script":[Xr,[Jr],(t,[n])=>{const e=t.globals&&t.globals.isSupportedScript;return!e||e(n.evaluate(t))}],upcase:[Jr,[Jr],(t,[n])=>n.evaluate(t).toUpperCase()],downcase:[Jr,[Jr],(t,[n])=>n.evaluate(t).toLowerCase()],concat:[Jr,lo(Kr),(t,n)=>n.map(n=>Fi(n.evaluate(t))).join("")],"resolved-locale":[Jr,[Qr],(t,[n])=>n.evaluate(t).resolvedLocale()]});var co=oo;function fo(t){return{result:"success",value:t}}function po(t){return{result:"error",value:t}}function yo(t){return!!t.expression&&t.expression.interpolated}function mo(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function go(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function vo(t){return t}function bo(t,n,e){return void 0!==t?t:void 0!==n?n:void 0!==e?e:void 0}function wo(t,n,e,r,i){return bo(typeof e===i?r[e]:void 0,t.default,n.default)}function Mo(t,n,e){if("number"!==mo(e))return bo(t.default,n.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[r-1][0])return t.stops[r-1][1];const i=ls(t.stops.map(t=>t[0]),e);return t.stops[i][1]}function xo(t,n,e){const r=void 0!==t.base?t.base:1;if("number"!==mo(e))return bo(t.default,n.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(e<=t.stops[0][0])return t.stops[0][1];if(e>=t.stops[i-1][0])return t.stops[i-1][1];const s=ls(t.stops.map(t=>t[0]),e),o=function(t,n,e,r){const i=r-e,s=t-e;return 0===i?0:1===n?s/i:(Math.pow(n,s)-1)/(Math.pow(n,i)-1)}(e,r,t.stops[s][0],t.stops[s+1][0]),a=t.stops[s][1],u=t.stops[s+1][1];let h=ms[n.type]||vo;if(t.colorSpace&&"rgb"!==t.colorSpace){const n=Os[t.colorSpace];h=(t,e)=>n.reverse(n.interpolate(n.forward(t),n.forward(e),o))}return"function"==typeof a.evaluate?{evaluate(...t){const n=a.evaluate.apply(void 0,t),e=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==e)return h(n,e,o)}}:h(a,u,o)}function Fo(t,n,e){return"color"===n.type?e=yi.parse(e):"formatted"===n.type?e=vi.fromString(e.toString()):"resolvedImage"===n.type?e=bi.fromString(e.toString()):mo(e)===n.type||"enum"===n.type&&n.values[e]||(e=void 0),bo(e,t.default,n.default)}class Ao{constructor(t,n){this.expression=t,this.H={},this.W=new Di,this.q=n?function(t){return"color"===t.type&&(go(t.default)||Array.isArray(t.default))?new yi(0,0,0,0):"color"===t.type?yi.parse(t.default)||null:void 0===t.default?null:t.default}(n):null,this.G=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(t,n,e,r,i,s,o,a){return this.W.globals=t,this.W.feature=n,this.W.featureState=e,this.W.canonical=r||null,this.W.availableImages=i||null,this.W.formattedSection=s,this.W.featureTileCoord=o||null,this.W.featureDistanceData=a||null,this.expression.evaluate(this.W)}evaluate(t,n,e,r,i,s,o,a){this.W.globals=t,this.W.feature=n||null,this.W.featureState=e||null,this.W.canonical=r||null,this.W.availableImages=i||null,this.W.formattedSection=s||null,this.W.featureTileCoord=o||null,this.W.featureDistanceData=a||null;try{const t=this.expression.evaluate(this.W);if(null==t||"number"==typeof t&&t!=t)return this.q;if(this.G&&!(t in this.G))throw new Pi(`Expected value to be one of ${Object.keys(this.G).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this.H[t.message]||(this.H[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this.q}}}function ko(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in co}function Po(t,n){const e=new hs(co,[],n?function(t){const n={color:Yr,string:Jr,number:Br,enum:Jr,boolean:Xr,formatted:ti,resolvedImage:ni};return"array"===t.type?ei(n[t.value]||Kr,t.length):n[t.type]}(n):void 0),r=e.parse(t,void 0,void 0,void 0,n&&"string"===n.type?{typeAnnotation:"coerce"}:void 0);return r?fo(new Ao(r,n)):po(e.errors)}class So{constructor(t,n){this.kind=t,this.B=n,this.isStateDependent="constant"!==t&&!is(n.expression)}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.B.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.B.evaluate(t,n,e,r,i,s)}}class _o{constructor(t,n,e,r){this.kind=t,this.zoomStops=e,this.B=n,this.isStateDependent="camera"!==t&&!is(n.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,n,e,r,i,s){return this.B.evaluateWithoutErrorHandling(t,n,e,r,i,s)}evaluate(t,n,e,r,i,s){return this.B.evaluate(t,n,e,r,i,s)}interpolationFactor(t,n,e){return this.interpolationType?$s.interpolationFactor(this.interpolationType,t,n,e):0}}function Oo(t,n){if("error"===(t=Po(t,n)).result)return t;const e=t.value.expression,r=rs(e);if(!r&&!function(t){return"data-driven"===t["property-type"]}(n))return po([new Hr("","data expressions not supported")]);const i=ss(e,["zoom","pitch","distance-from-center"]);if(!i&&!function(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}(n))return po([new Hr("","zoom expressions not supported")]);const s=function t(n){let e=null;if(n instanceof Ds)e=t(n.result);else if(n instanceof Ts){for(const r of n.args)if(e=t(r),e)break}else(n instanceof fs||n instanceof $s)&&n.input instanceof Ui&&"zoom"===n.input.name&&(e=n);return e instanceof Hr||n.eachChild(n=>{const r=t(n);r instanceof Hr?e=r:!e&&r?e=new Hr("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\'):e&&r&&e!==r&&(e=new Hr("",\'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.\'))}),e}(e);if(!s&&!i)return po([new Hr("",\'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.\')]);if(s instanceof Hr)return po([s]);if(s instanceof $s&&!yo(n))return po([new Hr("",\'"interpolate" expressions cannot be used with this property\')]);if(!s)return fo(new So(r?"constant":"source",t.value));const o=s instanceof $s?s.interpolation:void 0;return fo(new _o(r?"camera":"composite",t.value,s.labels,o))}class Eo{constructor(t,n){this.J=t,this.X=n,Vr(this,function t(n,e){const r="color"===e.type,i=n.stops&&"object"==typeof n.stops[0][0],s=i||!(i||void 0!==n.property),o=n.type||(yo(e)?"exponential":"interval");if(r&&((n=Vr({},n)).stops&&(n.stops=n.stops.map(t=>[t[0],yi.parse(t[1])])),n.default=yi.parse(n.default?n.default:e.default)),n.colorSpace&&"rgb"!==n.colorSpace&&!Os[n.colorSpace])throw new Error("Unknown color space: "+n.colorSpace);let a,u,h;if("exponential"===o)a=xo;else if("interval"===o)a=Mo;else if("categorical"===o){a=wo,u=Object.create(null);for(const t of n.stops)u[t[0]]=t[1];h=typeof n.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);a=Fo}if(i){const r={},i=[];for(let t=0;t<n.stops.length;t++){const e=n.stops[t],s=e[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:n.type,property:n.property,default:n.default,stops:[]},i.push(s)),r[s].stops.push([e[0].value,e[1]])}const s=[];for(const n of i)s.push([r[n].zoom,t(r[n],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:$s.interpolationFactor.bind(void 0,o),zoomStops:s.map(t=>t[0]),evaluate:({zoom:t},r)=>xo({stops:s,base:n.base},e,t).evaluate(t,r)}}if(s){const t="exponential"===o?{name:"exponential",base:void 0!==n.base?n.base:1}:null;return{kind:"camera",interpolationType:t,interpolationFactor:$s.interpolationFactor.bind(void 0,t),zoomStops:n.stops.map(t=>t[0]),evaluate:({zoom:t})=>a(n,e,t,u,h)}}return{kind:"source",evaluate(t,r){const i=r&&r.properties?r.properties[n.property]:void 0;return void 0===i?bo(n.default,e.default):a(n,e,i,u,h)}}}(this.J,this.X))}static deserialize(t){return new Eo(t.J,t.X)}static serialize(t){return{J:t.J,X:t.X}}}function Io(t){if(Array.isArray(t))return t.map(Io);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const n={};for(const e in t)n[e]=Io(t[e]);return n}return function(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}(t)}function $o(t){if(!Array.isArray(t))return!1;if(function(t){return"pitch"===t||"distance-from-center"===t}(t[0]))return!0;for(let n=1;n<t.length;n++)if($o(t[n]))return!0;return!1}const Co=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]),To={StyleExpression:Ao,isExpression:ko,isExpressionFilter:function t(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":return n.length>=2&&"$id"!==n[1]&&"$type"!==n[1];case"in":return n.length>=3&&("string"!=typeof n[1]||Array.isArray(n[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==n.length||Array.isArray(n[1])||Array.isArray(n[2]);case"any":case"all":for(const e of n.slice(1))if(!t(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}},createExpression:Po,createPropertyExpression:Oo,normalizePropertyExpression:function(t,n){if(go(t))return new Eo(t,n);if(ko(t)){const e=Oo(t,n);if("error"===e.result)throw new Error(e.value.map(t=>`${t.key}: ${t.message}`).join(", "));return e.value}{let e=t;return"string"==typeof t&&"color"===n.type&&(e=yi.parse(t)),{kind:"constant",evaluate:()=>e}}},ZoomConstantExpression:So,ZoomDependentExpression:_o,StylePropertyFunction:Eo},{isExpression:zo,createExpression:Do}=To,jo={};function Uo(t){if(!0===t)return function(){return!0};if(t&&t.condition){if("any"===t.type){const n=t.condition,e=[];for(let t=0;t<n.length;t++)e.push(Uo(n[t]));return(t,n)=>{for(let r=0;r<e.length;r++)if(e[r](t,n))return!0;return!1}}const n=Uo(t.condition);if(hr(t.layer))return n;const e=n=>n.layer===t.layer;return(t,r)=>e(t)&&n(t,r)}if(function t(n){if(!0===n||!1===n)return!0;if(!Array.isArray(n)||0===n.length)return!1;switch(n[0]){case"has":case"!has":return 2===n.length&&("string"==typeof n[1]||n[1].property&&n[1].op);case"in":case"!in":return n.length>=2&&("string"==typeof n[1]||n[1].property&&n[1].op);case"==":case"!=":case">":case">=":case"<":case"<=":return 3===n.length&&("string"==typeof n[1]||n[1].property&&n[1].op);case"none":case"any":case"all":for(const e of n.slice(1))if(!t(e)&&"boolean"!=typeof e)return!1;return!0;case"contains":return!0;default:return!1}}(t))return zn(t);{let n=function(t,n="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};const e=t;let r=!0;try{r=function(t){if(!$o(t))return t;let n=Io(t);return function t(n){let e=!1;const r=[];if("case"===n[0]){for(let t=1;t<n.length-1;t+=2)e=e||$o(n[t]),r.push(n[t+1]);r.push(n[n.length-1])}else if("match"===n[0]){e=e||$o(n[1]);for(let t=2;t<n.length-1;t+=2)r.push(n[t+1]);r.push(n[n.length-1])}else if("step"===n[0]){e=e||$o(n[1]);for(let t=1;t<n.length-1;t+=2)r.push(n[t+1])}e&&(n.length=0,n.push("any",...r));for(let e=1;e<n.length;e++)t(n[e])}(n),n=function t(n){if(!Array.isArray(n))return n;const e=function(t){if(Co.has(t[0]))for(let n=1;n<t.length;n++)if($o(t[n]))return!0;return t}(n);return!0===e?e:e.map(n=>t(n))}(n),n}(e)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\\nand paste the contents of this message in the report.\\nThank you!\\nFilter Expression:\\n${JSON.stringify(e,null,2)}\\n        `)}const i=Po(r,null);let s=null;if("error"===i.result)throw new Error(i.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=(t,n,e)=>i.value.evaluate(t,n,{},e);let o=null,a=null;if(r!==e){const t=Po(e,null);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));o=(n,e,r,i,s)=>t.value.evaluate(n,e,{},r,void 0,void 0,i,s),a=!rs(t.value.expression)}return s=s,{filter:s,dynamicFilter:o||void 0,needGeometry:function t(n){if(!Array.isArray(n))return!1;if("within"===n[0])return!0;for(let e=1;e<n.length;e++)if(t(n[e]))return!0;return!1}(r),needFeature:!!a}}(t);return n=n&&n.filter,(t,e)=>(jo.zoom=e,n&&n(jo,t))}}const No={type:"number","property-type":"data-driven",expression:{parameters:["zoom","feature"]}};function Lo(t,n){No.type=n||"number";const e=Do(t,No);if("success"!==e.result)throw new Error(`Invalid maplibre spec expression: ${JSON.stringify(t)} (${e.value})`);return e.value}function Vo(t){return zo(t)}const Ro={lineWidth:1,lineStrokeWidth:1,lineDx:1,lineDy:1,lineOpacity:1,linePatternAnimSpeed:1,markerWidth:1,markerHeight:1,markerDx:1,markerDy:1,markerSpacing:1,markerOpacity:1,markerRotation:1,textWrapWidth:1,textSpacing:1,textSize:1,textHaloRadius:1,textHaloOpacity:1,textDx:1,textDy:1,textOpacity:1,textRotation:1,polygonOpacity:1};function Ho(t){return Ro[t]}const Wo={markerPlacement:1,markerFile:1,mergeOnProperty:1,markerTextFit:1,markerType:1,markerHorizontalAlignment:1,markerVerticalAlignment:1,markerRotationAlignment:1,markerPitchAlignment:1,markerFillPatternFile:1,markerLinePatternFile:1,textName:1,textPlacement:1,textFaceName:1,textStyle:1,textHorizontalAlignment:1,textVerticalAlignment:1,textRotationAlignment:1,textPitchAlignment:1,lineJoin:1,lineCap:1,linePatternFile:1,polygonPatternFile:1},qo={lineDasharray:1,markerLineDasharray:1,uvScale:1,uvOffset:1};function Go(t){return Wo[t]?"string":Ho(t)?"number":qo[t]?"array":"color"}var Bo=Object.freeze({__proto__:null,compileStyle:function(t=[]){return function t(n){if(!Array.isArray(n))return t([n]);const e=[];for(let t=0;t<n.length;t++){let r;r=!0===n[t].filter?function(){return!0}:Uo(n[t].filter),e.push(ur({},n[t],{filter:r}))}return e}(t=t.map(t=>{const n=ur({},t);return n.filter&&n.filter.value&&(n.filter=n.filter.value),n}))},compileFilter:Uo,createExpression:Lo,isExpression:Vo,isInterpolated:Ho,getExpressionType:Go});const Jo="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;class Xo extends Array{push(...t){const n=t.length;for(let e=0;e<n;e++)this[this.Y++]=t[e]}fill(t,n,e){super.fill(t,n,e),e>this.Y&&(this.Y=e)}set(t,n){t>=this.Y&&(this.Y=t+1),this[t]=n}getLength(){return this.Y}setLength(t){this.Y=t,super.length<t&&(super.length=t)}trySetLength(t){t>this.Y&&this.setLength(t)}reset(){this.Y=0}}const Yo={get:function(t,n){return"length"===n?t.getLength():t[n]}};class Zo extends Array{setLength(t){super.length=t}trySetLength(t){super.length=t}}let Ko;class Qo{static createTypedArray(t,n){return or(t,n)}static getInstance(){return Ko}constructor(){this.Z=[],this.Y=0}get(){if(!Jo)return new Zo;const t=this.Z[this.Y]=this.Z[this.Y]||new Proxy(new Xo,Yo);return t.reset(),this.Y++,t}reset(){this.Y=0}}Ko=new Qo;const ta=[],na={},ea={},ra={},ia=[],sa=Qo.getInstance();class oa{static isAtlasLoaded(t,n={}){const{iconAtlas:e}=n;return!!(!t||e&&e.positions[t])}static genFnTypes(t){const n={};for(const e in t)if(Vo(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim(),s=Go(e);n[r]=Lo(t[e],s),n[i]=(t,e)=>{let i;na.zoom=t,ea.properties=e;try{i=n[r].evaluateWithoutErrorHandling(na,ea,ra,null,ia)}catch(t){return null}return i}}else if(gr(t[e])){const r=(e+"_Fn_0").trim(),i=(e+"Fn").trim();Ho(e)?(n[r]=p(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return gr(i)?p(i)(t,e):i}):(n[r]=y(t[e]),n[i]=(t,e)=>{const i=n[r](t,e);return gr(i)?y(i)(t,e):i})}return n}constructor(t,n,e){this.options=e;const r=[];this.symbolDef=n,this.symbol=m(n,()=>(r[0]=e.zoom,r)),this.styledVectors=[],this.properties={},this.K=e.fnTypes||oa.genFnTypes(this.symbolDef),gr(this.symbolDef.visible)&&(this.tt=p(this.symbolDef.visible)),e.atlas&&(this.iconAtlas=e.atlas.iconAtlas,this.glyphAtlas=e.atlas.glyphAtlas),this.features=this.nt(t)}needAltitudeAttribute(){return this.options.forceAltitudeAttribute||this.maxPosZ>=Math.pow(2,17)||this.options.positionType===Float32Array}getPositionFormat(){return this.needAltitudeAttribute()?[{type:Int16Array,width:2,name:"aPosition"},{type:Float32Array,width:1,name:"aAltitude"}]:[{type:Int16Array,width:3,name:"aPosition"}]}fillPosition(t,n,e,r){n<this.et&&(this.et=n),n>this.rt&&(this.rt=n),e<this.it&&(this.it=e),e>this.st&&(this.st=e),this.needAltitudeAttribute()?(t.aPosition.push(n,e),t.aAltitude.push(r)):(Tr(ta,n,e,r),t.aPosition.push(ta[0],ta[1],ta[2]))}nt(t){if(!t.length)return t;const n="__fea_idx".trim();let e,r=0,i=t[r];for(;!i.geometry;)r++,i=t[r];if(Array.isArray(i.geometry)&&i.properties){let n=i.geometry[0];for(;Array.isArray(n);)n=n[0];n instanceof Ut&&(e=t)}if(!e)if(e=[],Array.isArray(i.geometry))for(let n=0;n<t.length;n++){const r=ur({},t[n]);e.push(ar(r))}else for(let r=0;r<t.length;r++){const i=t[r],s=Ve(i);for(let t=0;t<s.length;t++){const r=s[t];r[n]=i[n],e.push(r)}}if(this.maxPosZ=0,!this.options.forceAltitudeAttribute){const t="line"===this.symbolDef.textPlacement;let n=0,r=!1;const{textPitchAlignmentFn:i}=this.K;!i&&t&&"map"===this.symbolDef.textPitchAlignment&&(r=!0);for(let s=0;s<e.length;s++){const o=ua(e[s]&&e[s].geometry);if(o>n&&(n=o),t&&!r&&i&&e[s].properties){const t=i(null,e[s].properties);"map"===t&&(r=t)}}this.hasMapPitchAlign=r,this.maxPosZ=n}const s=this.options.order;if(s){const t=[];for(let n=0;n<s.length;n++)s[n]&&t.push(Uo(s[n]));e=e.sort((n,e)=>{const r=t.length;let i=-1,s=-1;for(let o=0;o<r&&(t[o](n)&&(i=o),t[o](e)&&(s=o),!(i>=0&&i<r&&s>=0&&s<r));o++);return i-s})}return e}load(t=1){const n="__fea_idx".trim(),e="_debug_info".trim(),r=this.K,i=this.styledVectors;this.count=0;const s=this.features;if(!s||!s.length)return Promise.resolve(null);const o={},a={},u={zoom:this.options.zoom,isVector3D:!!this.options.center},h=[],l=m(this.symbolDef,()=>(h[0]=u.zoom,h));let c=0,f=s.length;const d=this.options.debugIndex;try{for(;c<f;c++){const t=s[c];if(!t||!t.geometry)continue;if(lr(d)&&t[e].index!==d)continue;t.properties||(t.properties={}),t.properties.$layer=t.layer,t.properties.$type=t.type;const h=this.createStyledVector(t,l,r,u,o,a);h&&h.feature.geometry&&(h.featureIdx=void 0===t[n]?c:t[n],this.count++,i.push(h))}}catch(t){return Promise.reject(t)}return this.options.atlas?Promise.resolve(this.pack(t)):this.loadAtlas(o,a).then(()=>this.pack(t))}loadAtlas(t,n){return new Promise((e,r)=>{this.fetchAtlas(t,n,(t,n)=>{if(t)r(t);else{if(n){const{icons:t,glyphs:e}=n;if(t&&Object.keys(t).length){for(const n in t){const e=t[n],{width:r,height:i,data:s}=e.data;e.data=new Ze({width:r,height:i},s)}this.iconAtlas=new Qe(t)}if(e&&Object.keys(e).length){for(const t in e){const n=e[t];for(const t in n){const e=n[t],{width:r,height:i,data:s}=e.bitmap;e.bitmap=new Ye({width:r,height:i},s)}}this.glyphAtlas=new er(e)}}e({glyphAtlas:this.glyphAtlas,iconAtlas:this.iconAtlas})}})})}fetchAtlas(t,n,e){Object.keys(t).length>0||Object.keys(n).length>0?this.options.requestor(t,n,e):e()}pack(t){if(!this.count)return null;if(null==t)throw new Error("layout scale is undefined");const n=this.createDataPack(this.styledVectors,t);if(!n)return null;n.properties=this.properties,this.empty&&(n.empty=!0);const e=n.buffers;delete n.buffers;const r={data:n,buffers:e};if(this.iconAtlas){const t=r.data.iconAtlas=aa(this.iconAtlas);if(t.glyphMap)for(const n in t.glyphMap)e.push(t.glyphMap[n].data.data.buffer);e.push(r.data.iconAtlas.image.data.buffer)}return this.glyphAtlas&&(r.data.glyphAtlas=aa(this.glyphAtlas),e.push(r.data.glyphAtlas.image.data.buffer)),r}createStyledVector(t,n,e,r){return new Cr(t,n,e,r)}createDataPack(t,n){if(!t||!t.length)return null;this.maxIndex=0,this.maxPos=0,this.et=this.it=1/0,this.rt=this.st=-1/0,this.maxAltitude=0,this.dynamicAttrs={};const e=this.data={};this.ot=sa,sa.reset();let r=this.elements=sa.get();const i=this.getFormat(Array.isArray(t[0])?t[0][0].symbol:t[0].symbol),s=this.needAltitudeAttribute()?2:3;for(let t=0;t<i.length;t++)e[i[t].name]=sa.get();let o=sa.get(),a=0;const u=sa.get();let h=0,l=!1,c=!0;const f=new Set;for(let r=0,i=t.length;r<i;r++){if(!t[r].feature.geometry)continue;const i=Array.isArray(t[r])?t[r][0].feature.id:t[r].feature.id;c&&(void 0!==ea.id?f&&(f.has(ea.id)?c=!1:f.add(ea.id)):c=!1),lr(i)&&(Math.abs(i)>h&&(h=Math.abs(i)),i<0&&(l=!0));const d=this.data.aPosition.length;if(Array.isArray(t[r]))for(let e=0;e<t[r].length;e++)this.ut(t[r][e],n);else this.ut(t[r],n);const p=(e.aPosition.length-d)/s;for(let n=0;n<p;n++)o.push(t[r].featureIdx),lr(i)&&u.push(i);a=Math.max(a,t[r].featureIdx)}if(this.countOutOfAngle>0&&console.warn("text anchor along line is ignored as anchor\'s line angle is bigger than textMaxAngle."),this.hasElements()&&!r.length)return null;const d=this.options.center?Float32Array:sr(a);o=Qo.createTypedArray(o,d),i[0].type=this.options.positionType?this.options.positionType:ir(this.maxPos);const p=this.options.center;if(p&&(p[0]||p[1])){const t=e.aPosition;for(let n=0;n<t.length;n+=s)t[n]-=p[0],t[n+1]-=p[1]}const y=function(t,n){const e={};for(let r=0;r<t.length;r++){const i=t[r],s=i.type,o=i.name;e[o]=s===Array?n[o]:or(n[o],s)}return e}(i,e);y.aPickingId=o;const m=[];for(const t in y)m.push(y[t].buffer);const g=rr(this.maxIndex);r=Qo.createTypedArray(r,g),m.push(r.buffer);const v={data:y,isIdUnique:c,is2D:0===this.maxPosZ,indices:this.hasElements()?r:null,positionSize:s,positionBounding:[this.et,this.it,this.rt,this.st],buffers:m,symbolIndex:this.symbolDef.index||{index:0},dynamicAttributes:this.dynamicAttrs};if(this.ht&&(v.markerPlacement=this.ht),this.lt&&(v.textPlacement=this.lt),u.length){const t=l?ir(h):sr(h);v.featureIds=Qo.createTypedArray(u,t),m.push(v.featureIds.buffer)}else v.featureIds=[];return v.pickingIdIndiceMap=$r(o,v.indices),v}ut(t,n){this.tt&&!this.tt(this.options.zoom,t.feature.properties)||this.placeVector(t,n,this.formatWidth)}addElements(...t){this.maxIndex=Math.max(this.maxIndex,...t),this.elements.push(...t)}hasElements(){return!0}getAltitude(t){const{altitudeProperty:n,defaultAltitude:e,altitudeScale:r}=this.options;let i=Sr(t,n,e);return r&&(i*=r),this.maxAltitude=Math.max(this.maxAltitude,Math.abs(i)),i}getIconAtlasMaxValue(){const t=this.iconAtlas.positions;let n=0;for(const e in t)if(yr(t,e)){const{tl:r,displaySize:i}=t[e],s=Math.max(r[0],r[1],i[0]-1,i[1]-1);s>n&&(n=s)}return n}}function aa(t){let n=t.positions,e=t.image&&t.image.format||"alpha";if(t instanceof Qe){n={};for(const e in t.positions){const r=t.positions[e];n[e]={paddedRect:r.paddedRect,pixelRatio:r.pixelRatio,tl:r.tl,br:r.br,displaySize:r.displaySize}}e="rgba"}const r=t.image;return{image:{width:r.width,height:r.height,data:r.data,format:e},glyphMap:t.glyphMap,positions:n}}function ua(t){if(!t)return 0;let n=0;if(Array.isArray(t))for(let e=0;e<t.length;e++)if(Array.isArray(t[e])){const r=ua(t[e]);r>n&&(n=r)}else{const r=Math.abs(t[e].z||0);r>n&&(n=r)}else{const e=Math.abs(t.z||0);e>n&&(n=e)}return n}function ha(t,n,e,r){const i="__fn_textSize".trim();let s=t.textSize;if(hr(n.textSize))return[16,16];t[i]&&(s=t[i]);const o=[];if(o[0]=dr(s)?s(r,e):s,d(o[0])){const n=o[0].ct=o[0].ct||JSON.stringify(o[0]);t.ft||(t.ft={}),t.ft[n]||(t.ft[n]=p(o[0])),o[0]=(0,t.ft[n])(r,e)}return o[1]=o[0],o}function la(t){const n=t.stops;let e=-1/0;for(let t=0;t<n.length;t++){let r=n[t][1];cr(n[t][1])&&(r=la(n[t][1])),r>e&&(e=r)}return e}function ca(t,n,e){return[n||"normal",e||"normal","24px",t||"Open Sans Regular"].join(" ")}const fa=/\\{[\\w-]+(?:\\|[\\w-]+)*\\}/g;function da(t,n){return fr(t)?t.replace(fa,(function(t){if(!n)return"";if((t=t.substring(1,t.length-1)).indexOf("|")>0){const e=t.split("|");for(let t=0;t<e.length;t++){const r=n[e[t]];if(!hr(r))return r}return""}const e=n[t];return hr(e)?"":Array.isArray(e)?e.join():e})):t}var pa=Object.freeze({__proto__:null,getSDFFont:ca,resolveText:da,resolveVarNames:function(t){return t.match(fa)},resolveExpVarNames:function t(n,e){if(2!==e.length||"get"!==e[0])for(let r=0;r<e.length;r++)2===e[r].length&&"get"===e[r][0]?n.push(e[r][1]):Array.isArray(e[r])&&t(n,e[r]);else n.push(e[1])}});const ya=t=>t>=11904&&t<=12031,ma=t=>t>=12032&&t<=12255,ga=t=>t>=12272&&t<=12287,va=t=>t>=12288&&t<=12351,ba=t=>t>=12352&&t<=12447,wa=t=>t>=12448&&t<=12543,Ma=t=>t>=12544&&t<=12591,xa=t=>t>=12704&&t<=12735,Fa=t=>t>=12736&&t<=12783,Aa=t=>t>=12784&&t<=12799,ka=t=>t>=12800&&t<=13055,Pa=t=>t>=13056&&t<=13311,Sa=t=>t>=13312&&t<=19903,_a=t=>t>=19968&&t<=40959,Oa=t=>t>=40960&&t<=42127,Ea=t=>t>=42128&&t<=42191,Ia=t=>t>=63744&&t<=64255,$a=t=>t>=64336&&t<=65023,Ca=t=>t>=65040&&t<=65055,Ta=t=>t>=65072&&t<=65103,za=t=>t>=65104&&t<=65135,Da=t=>t>=65136&&t<=65279,ja=t=>t>=65280&&t<=65519;function Ua(t){return!((t=>t>=1536&&t<=1791)(t)||(t=>t>=1872&&t<=1919)(t)||(t=>t>=2208&&t<=2303)(t)||$a(t)||Da(t))}function Na(t){return!!(746===t||747===t||!(t<4352)&&(xa(t)||Ma(t)||Ta(t)&&!(t>=65097&&t<=65103)||Ia(t)||Pa(t)||ya(t)||Fa(t)||!(!va(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Sa(t)||_a(t)||ka(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||(t=>t>=44032&&t<=55215)(t)||ba(t)||ga(t)||(t=>t>=12688&&t<=12703)(t)||ma(t)||Aa(t)||wa(t)&&12540!==t||!(!ja(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!za(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Ca(t)||(t=>t>=19904&&t<=19967)(t)||Oa(t)||Ea(t)))}function La(t){return!(Na(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||va(t)||wa(t)||(t=>t>=57344&&t<=63743)(t)||Ta(t)||za(t)||ja(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Va(t){return t>=1424&&t<=2303||$a(t)||Da(t)}const Ra=[[9,9],[32,32],[5760,5760],[8192,8198],[8200,8202],[8287,12288],[6158,6158],[8203,8205]];function Ha(t){for(const n of Ra)if(t>=n[0]&&t<=n[1])return!0;return!1}const Wa={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\\\":"","]":"","^":"",dt:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function qa(t,n,e,r,i,s,o,a,u,h){let l=t.trim();2===h&&(l=function(t){let n="";for(let e=0;e<t.length;e++){const r=t.charCodeAt(e+1)||null,i=t.charCodeAt(e-1)||null;n+=r&&La(r)&&!Wa[t[e+1]]||i&&La(i)&&!Wa[t[e-1]]||!Wa[t[e]]?t[e]:Wa[t[e]]}return n}(l));const c=[],f={positionedGlyphs:c,text:l,top:a[1],bottom:a[1],left:a[0],right:a[0],writingMode:h};let d;return d=function(t,n){const e=[];let r=0;for(let i=0;i<n.length;i++){const s=n[i];e.push(t.substring(r,s)),r=s}return r<t.length&&e.push(t.substring(r,t.length)),e}(l,function(t,n,e,r){if(!e)return[];if(!t)return[];const i=[],s=function(t,n,e,r){let i=0;for(let e=0;e<t.length;e++){const s=r[t.charCodeAt(e)];s&&(i+=s.metrics.advance+n)}return i/Math.max(1,Math.ceil(i/e))}(t,n,e,r);let o=0;for(let e=0;e<t.length;e++){const u=t.charCodeAt(e),h=r[u];h&&!Ga[u]&&(o+=h.metrics.advance+n),e<t.length-1&&(Ba[u]||!((a=u)<11904)&&(xa(a)||Ma(a)||Ta(a)||Ia(a)||Pa(a)||ya(a)||Fa(a)||va(a)||Sa(a)||_a(a)||ka(a)||ja(a)||ba(a)||ga(a)||ma(a)||Aa(a)||wa(a)||Ca(a)||Ea(a)||Oa(a)))&&i.push(Ya(e+1,o,s,i,Xa(u,t.charCodeAt(e+1)),!1))}var a;return function t(n){return n?t(n.priorBreak).concat(n.index):[]}(Ya(t.length,o,s,i,0,!0))}(l,o,e,n)),function(t,n,e,r,i,s,o,a,u,h){let l=0,c=0,f=0;const d=t.positionedGlyphs,p="right"===s?1:"left"===s?0:.5;for(let t=0;t<e.length;t++){let i=e[t];if(i=i.trim(),!i.length){c-=r;continue}const s=d.length;for(let t=0;t<i.length;t++){const e=i.charCodeAt(t),r=n[e];r&&(Na(e)&&1!==o?(32!==e&&d.push({glyph:e,x:l,y:0,vertical:!0}),l+=u+a):(32!==e&&d.push({glyph:e,x:l,y:c,vertical:!1}),l+=r.metrics.advance+a))}d.length!==s&&(f=Math.max(l-a,f),Ka(d,n,s,d.length-1,p)),l=0,c-=r}const{horizontalAlign:y,verticalAlign:m}=Za(i,void 0);!function(t,n,e,r,i,s,o){const a=(n-e)*i,u=-(-r*o+.5)*s;if(a||u)for(let n=0;n<t.length;n++)t[n].x+=a,t[n].y+=u}(d,p,y,m,f,r,e.length);const g=e.length*r;t.top+=-m*g,t.bottom=t.top+g,t.left+=-y*f,t.right=t.left+f}(f,n,d,r,i,s,h,o,u),!!c.length&&f}const Ga={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ba={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Ja(t,n,e,r){const i=Math.pow(t-n,2);return r?t<n?i/2:2*i:i+Math.abs(e)*e}function Xa(t,n){let e=0;return 10===t&&(e-=1e4),40!==t&&65288!==t||(e+=50),41!==n&&65289!==n||(e+=50),e}function Ya(t,n,e,r,i,s){let o=null,a=Ja(n,e,i,s);for(let t=0;t<r.length;t++){const u=r[t],h=Ja(n-u.x,e,i,s)+u.badness;h<=a&&(o=u,a=h)}return{index:t,x:n,priorBreak:o,badness:a}}function Za(t,n){let e=.5,r=.5;switch(t){case"right":case"top-right":case"bottom-right":e=n?1:0;break;case"left":case"top-left":case"bottom-left":e=n?0:1}switch(t){case"bottom":case"bottom-right":case"bottom-left":r=n?1:0;break;case"top":case"top-right":case"top-left":r=n?0:1}return{horizontalAlign:e,verticalAlign:r}}function Ka(t,n,e,r,i){if(!i)return;const s=n[t[r].glyph];if(s){const n=(t[r].x+s.metrics.advance)*i;if(!n)return;for(let i=e;i<=r;i++)t[i].x-=n}}function Qa(t){if(!function(t){for(const n of t)if(Va(n.charCodeAt(0)))return!0;return!1}(t))return t;const n=[],e=[],r=[];let i=0,s=0,o=1,a=1;for(const u of t){const t=u.codePointAt(0);Ha(t)?(r.push(u),i++):(o=Va(t)?-1:1,a!==o?(s=i,e.length&&(a>0&&e.reverse(),n.push(...e)),r.length&&(n.splice(s,0,...r),r.length=0),a=o,e.length=0):r.length&&(e.push(...r),r.length=0),e.push(u),i++)}return r.length&&e.push(...r),e.length&&(a>0&&e.reverse(),n.push(...e)),n.reverse().join("")}const tu=/\\{ *([\\w_]+) *\\}/g;class nu{constructor(t,n,e,r,i){this.feature=t,this.symbolDef=n,this.symbol=e,this.options=i,this.pt=this.yt.bind(this),this.K=r}yt(t,n){return this.feature.properties[n]||"default"}getShape(t,n){if(this.gt)return this.gt;const{textHorizontalAlignmentFn:e,textVerticalAlignmentFn:r,markerHorizontalAlignmentFn:i,markerVerticalAlignmentFn:s,textWrapWidthFn:o}=this.K;let a;const u=this.symbol,h=this.getIconAndGlyph(),l=this.feature.properties;if(h&&h.glyph){const{font:t,text:i}=h.glyph;if(""===i)return null;const s=this.size[0]/24,c=24,f=u.textKeepUpright,d="map"===u.textRotationAlignment&&"line"===u.textPlacement&&!u.isIconText,p=n.glyphMap[t],y=eu(e?e(null,l):u.textHorizontalAlignment,r?r(null,l):u.textVerticalAlignment),m=1.2*c,g=function(t){for(let n=0;n<t.length;n++)if(!Ua(t.charAt(n).charCodeAt(0)))return!1;return!0}(i),v=g&&u.textLetterSpacing/s||0,b=[u.textDx/s||0,u.textDy/s||0],w=((o?o(null,l):u.textWrapWidth)||10*c)/s;a={},a.horizontal=qa(i,p,w,m,y,"center",v,b,c,1),g&&d&&f&&(a.vertical=qa(i,p,w,m,y,"center",v,b,c,2))}else if(h&&h.icon){if(!t.positions[h.icon.url])return null;const n=eu(i?i(null,l):u.markerHorizontalAlignment,s?s(null,l):u.markerVerticalAlignment);a=function(t,n,e){let{horizontalAlign:r,verticalAlign:i}=Za(n,e);e?r=1-r:i=1-i;const s=-2048*r,o=-2048*i;return{image:t,top:o,bottom:o+2048,left:s,right:s+2048}}(t.positions[h.icon.url],n,this.options.isVector3D),this.size||(this.size=a.image.displaySize)}return this.gt=a,a}getIconAndGlyph(){if(this.iconGlyph)return this.iconGlyph;const{markerFileFn:t,markerTypeFn:n,markerPathFn:e,markerWidthFn:r,markerHeightFn:i,markerFillFn:s,markerFillPatternFileFn:o,markerFillOpacityFn:a,markerTextFitFn:u,markerTextFitPaddingFn:h,markerLineColorFn:l,markerLineWidthFn:c,markerLineOpacityFn:f,markerLineDasharrayFn:y,markerLinePatternFileFn:m,markerPathWidthFn:g,markerPathHeightFn:v,textNameFn:b,textFaceNameFn:w,textStyleFn:M,textWeightFn:x}=this.K,{zoom:F}=this.options,A={},k=this.symbol,P=this.feature.properties,S=t?t(null,P):k.markerFile,_=n?n(null,P):k.markerType,O=S||_||k.markerPath,E=!hr(this.symbolDef.textName);let I;if(O){I=function(t,n,e,r,i,s){if(hr(n.markerWidth)&&hr(n.markerHeight))return null;const o="__fn_markerWidth".trim(),a="__fn_markerHeight".trim();let u=n.markerWidth||0,h=n.markerHeight||0;return cr(u)&&("identity"!==u.type?u=la(u):(u=t.markerWidth,t[o]&&(u=t[o](r,e)),cr(u)&&(u="identity"===u.type?i(r,e):la(u)))),cr(h)&&("identity"!==h.type?h=la(h):(h=t.markerHeight,t[a]&&(h=t[a](r,e)),cr(h)&&(h="identity"===h.type?s(r,e):la(h)))),[u,h]}(k,this.symbolDef,P,F,r,i)||[0,0];let t=k.markerTextFit;if(u&&(t=u(F,P)),t&&k.text&&"none"!==t){const n=k.text.textSize;let e=k.text.textName;d(e)&&(e=p(e)(F,P));const r=da(e,P);if(r){const e="__fn_textSize".trim(),i="__fn_textSize_0".trim();d(n)&&!k.text[e]&&(k.text[i]=p(n),k.text[e]=(t,n)=>{const e=k.text[i](t,n);return d(e)?p(e)(t,n):e});const s=ha(k.text,k.text,P,F);if("width"!==t&&"both"!==t||(I[0]=s[0]*r.length),"height"!==t&&"both"!==t||(I[1]=s[1]),s[0]&&s[1]){let t=k.markerTextFitPadding||[0,0,0,0];h&&(t=h(F,P)),I[0]+=t[1]+t[3],I[1]+=t[0]+t[2]}}else I[0]=I[1]=-1}}if(E&&(I=ha(k,this.symbolDef,P,F)),!I)return A;if(I[0]=Math.ceil(I[0]),I[1]=Math.ceil(I[1]),this.size=I,O&&I[0]>=0&&I[1]>=0){let t;if(_){const n={};if(n.markerType=_,"path"===_&&(n.markerPath=e?e(null,P):k.markerPath,n.markerPathWidth=g?g(null,P):k.markerPathWidth,n.markerPathHeight=v?v(null,P):k.markerPathHeight),r){const t=r(null,P);hr(t)||(n.markerWidth=t)}else k.markerWidth>=0&&(n.markerWidth=k.markerWidth);if(i){const t=i(null,P);hr(t)||(n.markerHeight=t)}else k.markerHeight>=0&&(n.markerHeight=k.markerHeight);if(s){const t=s(null,P);hr(t)||(n.markerFill=t)}else k.markerFill&&(n.markerFill=k.markerFill);if(o){const t=o(null,P);hr(t)||(n.markerFillPatternFile=t)}else k.markerFillPatternFile&&(n.markerFillPatternFile=k.markerFillPatternFile);if(a){const t=a(null,P);hr(t)||(n.markerFillOpacity=t)}else k.markerFillOpacity>=0&&(n.markerFillOpacity=k.markerFillOpacity);if(l){const t=l(null,P);hr(t)||(n.markerLineColor=t)}else k.markerLineColor&&(n.markerLineColor=k.markerLineColor);if(c){const t=c(null,P);hr(t)||(n.markerLineWidth=t)}else k.markerLineWidth>=0&&(n.markerLineWidth=k.markerLineWidth);if(f){const t=f(null,P);hr(t)||(n.markerLineOpacity=t)}else k.markerLineOpacity>=0&&(n.markerLineOpacity=k.markerLineOpacity);if(y){const t=y(null,P);hr(t)||(n.markerLineDasharray=t)}else k.markerLineDasharray&&(n.markerLineDasharray=k.markerLineDasharray);if(m){const t=m(null,P);hr(t)||(n.markerLinePatternFile=t)}else k.markerLinePatternFile&&(n.markerLinePatternFile=k.markerLinePatternFile);t="vector://"+JSON.stringify(n)}else t=S?S.replace(tu,this.pt):k.markerPath?function(t,n,e){if(!t.markerPath)return null;let r=1;const i=function(t){const n={stroke:{stroke:t.markerLineColor,"stroke-width":t.markerLineWidth,"stroke-opacity":t.markerLineOpacity,"stroke-dasharray":null,"stroke-linecap":"butt","stroke-linejoin":"round"},fill:{fill:t.markerFill,"fill-opacity":t.markerFillOpacity}};return 0===n.stroke["stroke-width"]&&(n.stroke["stroke-opacity"]=0),n}(t);lr(t.markerOpacity)&&(r=t.markerOpacity),lr(t.opacity)&&(r*=t.opacity);const s={};if(i){for(const t in i.stroke)yr(i.stroke,t)&&(hr(i.stroke[t])||(s[t]=i.stroke[t]));for(const t in i.fill)yr(i.fill,t)&&(hr(i.fill[t])||(s[t]=i.fill[t]))}const o=Array.isArray(t.markerPath)?t.markerPath:[t.markerPath];let a;const u=[];for(let t=0;t<o.length;t++)a=fr(o[t])?{path:o[t]}:o[t],a=ur({},a,s),a.d=a.path,delete a.path,u.push(a);const h=[\'<svg version="1.1"\',\'xmlns="http://www.w3.org/2000/svg"\'];r<1&&h.push(\'opacity="\'+r+\'"\'),t.markerPathWidth&&t.markerPathHeight&&h.push(\'viewBox="0 0 \'+t.markerPathWidth+" "+t.markerPathHeight+\'"\'),h.push(\'preserveAspectRatio="none"\'),n&&h.push(\'width="\'+n+\'"\'),e&&h.push(\'height="\'+e+\'"\'),h.push("><defs></defs>");for(let t=0;t<u.length;t++){let n="<path ";for(const e in u[t])yr(u[t],e)&&(n+=" "+e+\'="\'+u[t][e]+\'"\');n+="></path>",h.push(n)}return h.push("</svg>"),"data:image/svg+xml;base64,"+btoa(h.join(" "))}(k,I[0],I[1]):null;A.icon={url:t,size:I}}if(E){const t=b?b(this.options.zoom,P):k.textName;if(t||0===t){const n=ca(w?w(null,P):k.textFaceName,M?M(null,P):k.textStyle,x?x(null,P):k.textWeight);let e=da(t,P);e&&e.length&&(e=Qa(e),A.glyph={font:n,text:e})}}return this.iconGlyph=A,A}}function eu(t,n){n&&"middle"!==n||(n="center"),t&&"middle"!==t||(t="center");let e="center"!==n?n:"";return e+="center"!==t?(e.length?"-":"")+t:"",e\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */}function ru(t,n,e,r,i){const s=[];let o;for(let a=0;a<t.length;a++){const u=t[a];let h,l=!1;for(let t=0;t<u.length-1;t++){let a=u[t],c=u[t+1];a.x<n&&c.x<n||(a.x<n?(o=a,a=new Ut(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y)).T(),a.z=o.z+(n-o.x)/(c.x-o.x)*(c.z-o.z),l=!0):c.x<n&&(o=c,c=new Ut(n,a.y+(n-a.x)/(c.x-a.x)*(c.y-a.y)).T(),c.z=a.z+(n-a.x)/(o.x-a.x)*(o.z-a.z),l=!0),a.y<e&&c.y<e||(a.y<e?(o=a,a=new Ut(a.x+(e-a.y)/(c.y-a.y)*(c.x-a.x),e).T(),a.z=o.z+(e-o.y)/(c.y-o.y)*(c.z-o.z),l=!0):c.y<e&&(o=c,c=new Ut(a.x+(e-a.y)/(c.y-a.y)*(c.x-a.x),e).T(),c.z=a.z+(e-a.y)/(o.y-a.y)*(o.z-a.z),l=!0),a.x>=r&&c.x>=r||(a.x>=r?(o=a,a=new Ut(r,a.y+(r-a.x)/(c.x-a.x)*(c.y-a.y)).T(),a.z=o.z+(r-o.x)/(c.x-o.x)*(c.z-o.z),l=!0):c.x>=r&&(o=c,c=new Ut(r,a.y+(r-a.x)/(c.x-a.x)*(c.y-a.y)).T(),c.z=a.z+(r-a.x)/(o.x-a.x)*(o.z-a.z),l=!0),a.y>=i&&c.y>=i||(a.y>=i?(o=a,a=new Ut(a.x+(i-a.y)/(c.y-a.y)*(c.x-a.x),i).T(),a.z=o.z+(i-o.y)/(c.y-o.y)*(c.z-o.z),l=!0):c.y>=i&&(o=c,c=new Ut(a.x+(i-a.y)/(c.y-a.y)*(c.x-a.x),i).T(),c.z=a.z+(i-a.y)/(o.y-a.y)*(o.z-a.z),l=!0),h&&a.equals(h[h.length-1])||(h=[a],s.push(h)),l&&(h.clipped=!0),h.push(c)))))}}return s}class iu extends Ut{constructor(t,n,e,r){super(t,n),this.angle=e,void 0!==r&&(this.segment=r)}clone(){return new iu(this.x,this.y,this.angle,this.segment)}}\n/*!\n     * From mapbox-gl-js\n     * MIT License\n     * https://github.com/mapbox/mapbox-gl-js\n     */function su(t,n,e,r,i){if(void 0===n.segment)return!0;let s=n,o=n.segment+1,a=0;for(;a>-e/2;){if(o--,o<0)return!1;a-=t[o].dist(s),s=t[o]}a+=t[o].dist(t[o+1]),o++;const u=[];let h=0;for(;a<e/2;){const n=t[o],e=t[o+1];if(!e)return!1;let s=t[o-1].angleTo(n)-n.angleTo(e);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:a,angleDelta:s}),h+=s;a-u[0].distance>r;)h-=u.shift().angleDelta;if(h>i)return!1;o++,a+=n.dist(e)}return!0}function ou(t,n,e,r,i,s,o,a,u,h,l){const c=function(t,n,e){return t?.6*n*e:0}(r,s,o),f=function(t,n){return Math.max(t?t.right-t.left:0,n?n.right-n.left:0)}(r,i),d=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return n-f*o<n/4&&(n=f*o+n/4),function t(n,e,r,i,s,o,a,u,h,l,c){let f=0;const d=o/2,p=function(t){let n=0;for(let e=0;e<t.length-1;e++)n+=t[e].dist(t[e+1]);return n}(n);let y=0,m=e-r,g=[];for(let t=0;t<n.length-1;t++){const e=n[t],a=n[t+1],u=e.dist(a),v=a.angleTo(e);for(;m+r<y+u;){m+=r;const b=(m-y)/u,w=au(e.x,a.x,b),M=au(e.y,a.y,b),x=au(e.z||0,a.z||0,b);if(w>=0&&w<h&&M>=0&&M<h&&m-d>=0&&m+d<=p){const r=new iu(w,M,v,t);r.z=x,l&&(r.axis=[e.y-M,w-e.x],r.angleR=x===(e.z||0)?0:Math.atan(.9*(x-(e.z||0))*c/e.dist(r))),r.line=n,r.T(),!i||su(n,r,o,i,s)?g.push(r):i&&f++}}y+=u}return u||g.length||a||(g=t(n,y/2,r,i,s,o,a,!0,h,l,c)),g.countOutOfAngle=f,g}(t,d?n/2*a%n:(f/2+2*s)*o*a%n,n,c,e,f*o,d,!1,u,h,l)}function au(t,n,e){return t*(1-e)+n*e}function uu(t,n){const e=t.length;if(e<=1)return[t];const r=[];let i,s;for(let n=0;n<e;n++){const e=kr(t[n]);0!==e&&(t[n].area=Math.abs(e),void 0===s&&(s=e<0),s===e<0?(i&&r.push(i),i=[t[n]]):i.push(t[n]))}if(i&&r.push(i),n>1)for(let t=0;t<r.length;t++)r[t].length<=n||(Gn(r[t],n,1,r[t].length-1,hu),r[t]=r[t].slice(0,n));return r}function hu(t,n){return n.area-t.area}function lu(t,n,e){const r=n.distSqr(e);if(0===r)return t.distSqr(n);const i=((t.x-n.x)*(e.x-n.x)+(t.y-n.y)*(e.y-n.y))/r;return t.distSqr(i<0?n:i>1?e:e.sub(n).k(i).m(n))}function cu(t,n=1,e=!1){let r=1/0,i=1/0,s=-1/0,o=-1/0;const a=t[0];for(let t=0;t<a.length;t++){const n=a[t];(!t||n.x<r)&&(r=n.x),(!t||n.y<i)&&(i=n.y),(!t||n.x>s)&&(s=n.x),(!t||n.y>o)&&(o=n.y)}const u=Math.min(s-r,o-i);let h=u/2;const l=new Bn([],fu);if(0===u)return new Ut(r,i);for(let n=r;n<s;n+=u)for(let e=i;e<o;e+=u)l.push(new du(n+h,e+h,h,t));let c=function(t){let n=0,e=0,r=0;const i=t[0];for(let t=0,s=i.length,o=s-1;t<s;o=t++){const s=i[t],a=i[o],u=s.x*a.y-a.x*s.y;e+=(s.x+a.x)*u,r+=(s.y+a.y)*u,n+=3*u}return new du(e/n,r/n,0,t)}(t),f=l.length;for(;l.length;){const r=l.pop();(r.d>c.d||!c.d)&&(c=r,e&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,f)),r.max-c.d<=n||(h=r.h/2,l.push(new du(r.p.x-h,r.p.y-h,h,t)),l.push(new du(r.p.x+h,r.p.y-h,h,t)),l.push(new du(r.p.x-h,r.p.y+h,h,t)),l.push(new du(r.p.x+h,r.p.y+h,h,t)),f+=4)}return e&&(console.log("num probes: "+f),console.log("best distance: "+c.d)),c.p}function fu(t,n){return n.max-t.max}function du(t,n,e,r){this.p=new Ut(t,n),this.h=e,this.d=function(t,n){let e=!1,r=1/0;for(let i=0;i<n.length;i++){const s=n[i];for(let n=0,i=s.length,o=i-1;n<i;o=n++){const i=s[n],a=s[o];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(e=!e),r=Math.min(r,lu(t,i,a))}}return(e?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}function pu(t,n,e,r,i,s,o,a,u,h){const{feature:l,size:c,symbol:f}=t,d=c?24:0,p=i*(c?c[0]/d:1);if("line"===o){const t=[];t.countOutOfAngle=0;let i=l.geometry;s&&(i=ru(l.geometry,0,0,s,s));for(let o=0;o<i.length;o++){const l=ou(i[o],a,e,f.isIconText?null:r&&r.vertical||r&&r.horizontal||r,null,d,f.isIconText?1:p,1,s||1/0,u,h);if(f.textPlacement&&!f.isIconText)for(let t=0;t<l.length;t++)l[t].startIndex=n.length/3;if(t.push.apply(t,l),f.textPlacement&&!f.isIconText)for(let t=0;t<i[o].length;t++)n.push(i[o][t].x,i[o][t].y,i[o][t].z||0);t.countOutOfAngle+=l.countOutOfAngle||0}return t}return yu(l,o,s)}function yu(t,n,e,r,i){const s=[];if(3===t.type){const o=uu(t.geometry,0);for(let t=0;t<o.length;t++){const a=o[t];if("vertex"===n)for(let t=0;t<a.length;t++){const n=a[t];for(let o=0;o<n.length;o++)Or(n[o],e)||(s.push(n[o]),r&&(0===o?mu(n[o],n[o],n[t+1],i):mu(n[o],n[o-1],n[o],i)))}else if("vertex-first"===n){const t=a[0];t&&t[0]&&!Or(t[0],e)&&(s.push(t[0]),r&&mu(t[0],t[0],t[1],i))}else if("vertex-last"===n||"vertex-firstlast"===n){const t=a[0];if("vertex-firstlast"===n&&t&&t[0]&&!Or(t[0],e)&&(s.push(t[0]),r&&mu(t[0],t[0],t[1],i)),t&&t[t.length-1]&&!Or(t[t.length-1],e)){const n=t.length-1;s.push(t[n]),r&&mu(t[n],t[n-1],t[n],i)}}else{const t=cu(a,16);Or(t,e)||s.push(t)}}}else if(2===t.type)for(let o=0;o<t.geometry.length;o++){const a=t.geometry[o];if("vertex"===n)for(let t=0;t<a.length;t++)Or(a[t],e)||(s.push(a[t]),r&&(0===t?mu(a[t],a[t],a[t+1],i):mu(a[t],a[t-1],a[t],i)));else if("vertex-last"===n||"vertex-firstlast"===n){if("vertex-firstlast"!==n||Or(a[0],e)||(s.push(a[0]),r&&mu(a[0],a[0],a[1],i)),a&&a[a.length-1]&&!Or(a[a.length-1],e)){const t=a.length-1;s.push(a[t]),r&&mu(a[t],a[t-1],a[t],i)}}else Or(a[0],e)||(s.push(a[0]),r&&mu(a[0],a[0],a[1],i))}else if(1===t.type)for(let n=0;n<t.geometry.length;n++){const i=t.geometry[n];for(let t=0;t<i.length;t++){const n=i[t];Or(n,e)||(r&&(n.xRotation=0,n.yRotation=0,n.zRotation=0),s.push(n))}}return s}function mu(t,n,e,r){if(t.xRotation||t.yRotation||t.zRotation)return t;const i=e.x-n.x,s=n.y-e.y,o=(e.z-n.z)*r,a=Math.atan2(s,i);t.zRotation=a;const u=Math.atan2(o,Math.sqrt(i*i+s*s));return t.xyRotation=u,t}function gu(t,n){const e={},r={},i=[];let s=0;function o(n){i.push(t[n]),s++}function a(t,n,e){const s=r[t];return delete r[t],r[n]=s,i[s].geometry[0].pop(),i[s].geometry[0]=i[s].geometry[0].concat(e[0]),s}function u(t,n,r){const s=e[n];return delete e[n],e[t]=s,i[s].geometry[0].shift(),i[s].geometry[0]=r[0].concat(i[s].geometry[0]),s}function h(t,n,e){const r=e?n[0][n[0].length-1]:n[0][0];return`${t}:${r.x}:${r.y}`}for(let l=0;l<t.length;l++){const c=t[l],f=c.geometry;if(!f)continue;const d=c.properties[n]?c.properties[n].toString():null;if(!d){o(l);continue}const p=h(d,f),y=h(d,f,!0);if(p in r&&y in e&&r[p]!==e[y]){const t=u(p,y,f),n=a(p,y,i[t].geometry);delete e[p],delete r[y],r[h(d,i[n].geometry,!0)]=n,i[t].geometry=null}else p in r?a(p,y,f):y in e?u(p,y,f):(o(l),e[p]=s-1,r[y]=s-1)}return i.filter(t=>t.geometry)}class vu extends oa{static needMerge(t,n,e){if(!t)return!1;let r="line"===t.textPlacement||"line"===t.markerPlacement;return r||(n.textPlacementFn&&(r="line"===n.textPlacementFn(e)),n.markerPlacementFn&&(r="line"===n.markerPlacementFn(e))),t.mergeOnProperty&&r}static mergeLineFeatures(t,n,e,r){const i="__index".trim();let s=n.textPlacement,o=n.markerPlacement;e.textPlacementFn&&(s=e.textPlacementFn(r)),e.markerPlacementFn&&(o=e.markerPlacementFn(r));const a=function(t,n,e,r,i){const s="__index".trim(),o=oa.genFnTypes(n),{mergeOnPropertyFn:a}=o;if(!n.mergeOnProperty||"line"!==r&&"line"!==e)return[];if(!(Er(u=n.mergeOnProperty)||"string"!=typeof u&&(null===u.constructor||u.constructor!==String)||"line"!==r&&"line"!==e))return[{features:t,property:n.mergeOnProperty}];var u;const h=[],l={},c=[];for(let o=0;o<t.length;o++){t[o][s]=o;const u=t[o].properties=t[o].properties||{};u.$layer=t[o].layer,u.$type=t[o].type;let f=e;"line"!==f&&(f=r);const d=a?a(i,u):n.mergeOnProperty;"line"!==f||Er(d)?c.push(t[o]):(void 0===l[d]&&(l[d]=h.length,h.push({features:[],property:d})),h[l[d]].features.push(t[o]))}return c.length&&h.push({features:c}),h}(t,n,o,s,r);if(a.length){const n=[];for(let e=0;e<a.length;e++)n.push(a[e].property?gu(a[e].features,a[e].property):t);if(1===n.length)return n[0];{let t=[];for(let e=0;e<n.length;e++)t=t.concat(n[e]);return t.sort((t,n)=>t[i]-n[i]),t}}}static splitPointSymbol(t,n=0){const e=[];if(Array.isArray(t)){const n=t;for(let t=0;t<n.length;t++)n[t]&&e.push(...vu.splitPointSymbol(n[t],t));return e}let r=null,i=null;for(const n in t)0===n.indexOf("marker")?(r=r||{},r[n]=t[n]):0===n.indexOf("text")&&(i=i||{},i[n]=t[n]);return r&&(r.isIconText=!0,t.mergeOnProperty&&(r.mergeOnProperty=t.mergeOnProperty),e.push(r)),i&&(r&&(i.textPlacement=r.markerPlacement,i.textSpacing=r.markerSpacing,i.isIconText=!0),t.mergeOnProperty&&(i.mergeOnProperty=t.mergeOnProperty),e.push(i)),void 0!==t.visible&&(r&&(r.visible=t.visible),i&&(i.visible=t.visible)),r&&(r.markerTextFit&&i&&(r.text={},r.text.textName=i.textName,r.text.textSize=i.textSize),r.index={index:n,type:0}),i&&(i.index={index:n,type:1}),e}static isAtlasLoaded(t,n){const{icon:e,glyph:r}=t,{iconAtlas:i,glyphAtlas:s}=n;if(e&&(!i||!i.positions[e.url]))return!1;if(r){if(!s||!s.positions[r.font])return!1;const t=s.positions[r.font],{text:n}=r;for(let e=0;e<n.length;e++)if(!t[n.charCodeAt(e)])return!1}return!0}constructor(t,n,e){super(t,n,e),this.vt=n.textPlacement,this.K.textPlacementFn&&(this.vt=this.K.textPlacementFn(this.options.zoom))}createStyledVector(t,n,e,r,i,s){const o=new nu(t,this.symbolDef,n,e,r),a=o.getIconAndGlyph();if(a.icon&&!this.options.atlas){const{url:t,size:n}=a.icon;i[t]||(i[t]=a.icon.size),i[t][0]<n[0]&&(i[t][0]=n[0]),i[t][1]<n[1]&&(i[t][1]=n[1])}if(a.glyph&&!this.options.atlas){const{font:t,text:n}=a.glyph,e=s[t]=s[t]||{};for(let t=0;t<n.length;t++)e[n.charCodeAt(t)]=1;"line"===this.vt&&(s.options={isCharsCompact:!1})}return this.options.allowEmptyPack||a.icon||a.glyph?o:null}getFormat(t){const n=void 0!==t.textName,e=n?this.getPackSDFFormat(t):this.getPackMarkerFormat();n?e.push(...this.bt()):e.push(...this.wt());const{markerOpacityFn:r,textOpacityFn:i,markerPitchAlignmentFn:s,textPitchAlignmentFn:o,markerRotationAlignmentFn:a,textRotationAlignmentFn:u,markerRotationFn:h,textRotationFn:l,markerAllowOverlapFn:c,textAllowOverlapFn:f,markerIgnorePlacementFn:d,textIgnorePlacementFn:p}=this.K;return(r||i)&&e.push({type:Uint8Array,width:1,name:"aColorOpacity"}),(s||o)&&e.push({type:Uint8Array,width:1,name:"aPitchAlign"}),(a||u)&&e.push({type:Uint8Array,width:1,name:"aRotationAlign"}),(h||l)&&e.push({type:Uint16Array,width:1,name:"aRotation"}),(c||f||d||p)&&e.push({type:Uint8Array,width:1,name:"aOverlap"}),e}Mt(){return this.hasMapPitchAlign}bt(){const{textFillFn:t,textSizeFn:n,textHaloFillFn:e,textHaloRadiusFn:r,textHaloOpacityFn:i,textDxFn:s,textDyFn:o}=this.K,a=[];return t&&a.push({type:Uint8Array,width:4,name:"aTextFill"}),n&&a.push({type:Uint8Array,width:1,name:"aTextSize"}),e&&a.push({type:Uint8Array,width:4,name:"aTextHaloFill"}),r&&a.push({type:Uint8Array,width:1,name:"aTextHaloRadius"}),i&&a.push({type:Uint8Array,width:1,name:"aTextHaloOpacity"}),s&&a.push({type:Int8Array,width:1,name:"aTextDx"}),o&&a.push({type:Int8Array,width:1,name:"aTextDy"}),a}wt(){const{markerWidthFn:t,markerHeightFn:n,markerDxFn:e,markerDyFn:r}=this.K,i=[];return t&&i.push({type:this.options.markerWidthType||Uint8Array,width:1,name:"aMarkerWidth"}),n&&i.push({type:this.options.markerHeightType||Uint8Array,width:1,name:"aMarkerHeight"}),e&&i.push({type:Int8Array,width:1,name:"aMarkerDx"}),r&&i.push({type:Int8Array,width:1,name:"aMarkerDy"}),i}createDataPack(){if(!this.iconAtlas&&!this.glyphAtlas){if(!this.options.allowEmptyPack)return null;this.empty=!0}this.countOutOfAngle=0,this.lineVertex=[];const t=super.createDataPack.apply(this,arguments);return t?(t.lineVertex=new Int16Array(this.lineVertex),t.buffers.push(t.lineVertex.buffer),t):null}placeVector(t,n){const e=t.getShape(this.iconAtlas,this.glyphAtlas);if(!(this.options.allowEmptyPack||e&&e.image||e&&(e.horizontal||e.vertical)))return;const r=this.xt(t,e,n);if(this.countOutOfAngle+=r.countOutOfAngle||0,0===r.length)return;const i=this.data,s=this.needAltitudeAttribute()?2:3;let o=this.data.aPosition.length/s;const a=t.symbol,u=t.feature.properties,h="line"===this.vt&&!a.isIconText,l=void 0!==a.textName,c=l&&h&&function(t){let n=0;for(let e=0;e<t.length;e++)if(Na(t.charAt(e).charCodeAt(0)))n=0;else if(n++,n>=1)return!1;return!0}(t.getIconAndGlyph().glyph.text)?1:0,{textFillFn:f,textSizeFn:p,textHaloFillFn:y,textHaloRadiusFn:m,textHaloOpacityFn:g,textDxFn:v,textDyFn:b,textPitchAlignmentFn:w,textRotationAlignmentFn:M,textRotationFn:x,textAllowOverlapFn:F,textIgnorePlacementFn:A,textOpacityFn:k,markerWidthFn:P,markerHeightFn:S,markerDxFn:_,markerDyFn:O,markerPitchAlignmentFn:E,markerRotationAlignmentFn:I,markerRotationFn:$,markerAllowOverlapFn:C,markerIgnorePlacementFn:T,markerOpacityFn:z}=this.K;let D,j,U,N,L,V,R,H,W,q,G,B,J,X,Y,Z,K;if(l){const n=t.getIconAndGlyph().glyph.font;D=function(t,n,e){const r=t.positionedGlyphs,i=[];for(let s=0;s<r.length;s++){const o=r[s],a=e[o.glyph];if(!a)continue;const u=a.rect;if(!u)continue;const h=4,l=a.metrics.advance/2,c=a.metrics.height/2,f=n?[o.x+l,0]:[0,0],d=n?[0,o.y-c]:[o.x+l,o.y-c],p=a.metrics.left-h-l+d[0],y=a.metrics.top-h+d[1],m=p+u.w,g=y+u.h,v=new Ut(p,y),b=new Ut(m,y),w=new Ut(p,g),M=new Ut(m,g);if(n&&o.vertical){const t=new Ut(-l,l),n=-Math.PI/2,e=new Ut(5,0);v._(n,t).m(e),b._(n,t).m(e),w._(n,t).m(e),M._(n,t).m(e)}i.push({tl:v,tr:b,bl:w,br:M,tex:u,writingMode:t.writingMode,glyphOffset:f})}return i}(e.horizontal,h,this.glyphAtlas.positions[n]),f&&(j=f(null,u),d(j)?(this.dynamicAttrs.aTextFill=1,j=[0,0,0,0]):j=Mr([],j)),p&&(U=p(this.options.zoom,u),Er(U)&&(U=14)),y&&(N=y(null,u),d(N)?(this.dynamicAttrs.aTextHaloFill=1,N=[0,0,0,0]):N=Mr([],N)),m&&(L=m(null,u)),g&&(V=255*g(null,u)),v&&(R=v(null,u)||0),b&&(H=b(null,u)||0),w&&(J=+("map"===w(null,u))),M&&(X=+("map"===M(null,u))),x&&(Y=Ir(x(null,u),0,360)*Math.PI/180)}else D=e?function(t){const n=t.image,e=t.top-1/n.pixelRatio,r=t.left-1/n.pixelRatio,i=t.bottom+1/n.pixelRatio,s=t.right+1/n.pixelRatio;let o,a,u,h;return o=new Ut(r,e),a=new Ut(s,e),u=new Ut(s,i),h=new Ut(r,i),[{tl:o,tr:a,bl:h,br:u,tex:{x:n.tl[0],y:n.tl[1],w:n.displaySize[0],h:n.displaySize[1]},writingMode:void 0,glyphOffset:[0,0]}]}(e):function(){const t=new Ut(0,0),n=new Ut(0,0),e=new Ut(0,0);return[{tl:t,tr:n,bl:new Ut(0,0),br:e,tex:{x:0,y:0,w:0,h:0},writingMode:void 0,glyphOffset:[0,0]}]}(),P&&(W=P(null,u)),Er(W)&&(W=D[0].tex.w),S&&(q=S(null,u)),Er(q)&&(q=D[0].tex.h),_&&(G=_(null,u)),O&&(B=O(null,u)),E&&(J=+("map"===E(null,u))),I&&(X=+("map"===I(null,u))),$&&(Y=Ir($(null,u),0,360)*Math.PI/180);d(U)&&(this.dynamicAttrs.aTextSize=1),d(L)&&(this.dynamicAttrs.aTextHaloRadius=1),d(V)&&(this.dynamicAttrs.aTextHaloOpacity=1),d(R)&&(this.dynamicAttrs.aTextDx=1),d(H)&&(this.dynamicAttrs.aTextDy=1),d(W)&&(this.dynamicAttrs.aMarkerWidth=1),d(q)&&(this.dynamicAttrs.aMarkerHeight=1),d(G)&&(this.dynamicAttrs.aMarkerDx=1),d(B)&&(this.dynamicAttrs.aMarkerDy=1),d(J)&&(this.dynamicAttrs.aPitchAlign=1),d(X)&&(this.dynamicAttrs.aRotationAlign=1),d(Y)&&(this.dynamicAttrs.aRotation=1);const Q=C||F;Q&&(Z=Q(null,u)||0);const tt=T||A;let nt;tt&&(K=tt(null,u)||0);const et=k||z;et&&(nt=255*et(this.options.zoom,u));const rt=this.options.EXTENT,it=D.length,{altitudeScale:st,altitudeProperty:ot,defaultAltitude:at}=this.options,{altitude:ut}=_r(t.feature,st,ot,at);for(let t=0;t<r.length;t++){const n=r[t],e=n.z||ut||0;if(rt!==1/0&&Or(n,rt))continue;const s=n.x,a=n.y,u=D.length;for(let t=0;t<u;t++){const r=D[t],{tl:u,tr:f,bl:d,br:p,tex:y}=r;this.Ft(i,s,a,e,10*u.x,10*u.y,y.x,y.y+y.h),l&&this.At(i,h,it,r.glyphOffset,n,c,n.axis,n.angleR),this.kt(i,j,U,N,L,V,R,H,W,q,G,B,nt,J,X,Y,Z,K),this.Ft(i,s,a,e,10*f.x,10*f.y,y.x+y.w,y.y+y.h),l&&this.At(i,h,it,r.glyphOffset,n,c,n.axis,n.angleR),this.kt(i,j,U,N,L,V,R,H,W,q,G,B,nt,J,X,Y,Z,K),this.Ft(i,s,a,e,10*d.x,10*d.y,y.x,y.y),l&&this.At(i,h,it,r.glyphOffset,n,c,n.axis,n.angleR),this.kt(i,j,U,N,L,V,R,H,W,q,G,B,nt,J,X,Y,Z,K),this.Ft(i,s,a,e,10*p.x,10*p.y,y.x+y.w,y.y),l&&this.At(i,h,it,r.glyphOffset,n,c,n.axis,n.angleR),this.kt(i,j,U,N,L,V,R,H,W,q,G,B,nt,J,X,Y,Z,K),this.addElements(o,o+1,o+2),this.addElements(o+1,o+2,o+3),o+=4;const m=Math.max(Math.abs(s),Math.abs(a),Math.abs(e));m>this.maxPos&&(this.maxPos=m)}}}Ft(t,n,e,r,i,s,o,a){this.fillPosition(t,n,e,r),t.aShape.push(i,s),t.aTexCoord.push(o,a)}At(t,n,e,r,i,s,o,a){if(t.aCount.push(e),n){t.aGlyphOffset.push(r[0],r[1]),this.Mt()&&t.aPitchRotation.push(o[0],o[1],a);const n=i.startIndex;t.aSegment.push(i.segment+n,n,i.line.length),t.aVertical.push(s)}}kt(t,n,e,r,i,s,o,a,u,h,l,c,f,d,p,y,m,g){const{textFillFn:v,textSizeFn:b,textHaloFillFn:w,textHaloRadiusFn:M,textHaloOpacityFn:x,textDxFn:F,textDyFn:A,textPitchAlignmentFn:k,textRotationAlignmentFn:P,textRotationFn:S,textAllowOverlapFn:_,textIgnorePlacementFn:O,textOpacityFn:E,markerWidthFn:I,markerHeightFn:$,markerDxFn:C,markerDyFn:T,markerPitchAlignmentFn:z,markerRotationAlignmentFn:D,markerRotationFn:j,markerAllowOverlapFn:U,markerIgnorePlacementFn:N,markerOpacityFn:L}=this.K;v&&t.aTextFill.push(...n),b&&t.aTextSize.push(e),w&&t.aTextHaloFill.push(...r),M&&t.aTextHaloRadius.push(i),x&&t.aTextHaloOpacity.push(s),F&&t.aTextDx.push(o),A&&t.aTextDy.push(a),I&&t.aMarkerWidth.push(u),$&&t.aMarkerHeight.push(h),C&&t.aMarkerDx.push(l),T&&t.aMarkerDy.push(c),(L||E)&&t.aColorOpacity.push(f),(k||z)&&t.aPitchAlign.push(d),(D||P)&&t.aRotationAlign.push(p),(j||S)&&t.aRotation.push(9362*y);const V=U||_,R=N||O;(V||R)&&t.aOverlap.push((V?8:0)+4*m+((R?2:0)+g)),i>0&&(this.properties.hasHalo=1)}xt(t,n,e){const{feature:r,symbol:i}=t,s=this.Pt(t,i),o=r.properties,{markerSpacingFn:a,textSpacingFn:u,textMaxAngleFn:h}=this.K,l=((a?a(null,o):i.markerSpacing)||(u?u(null,o):i.textSpacing)||250)*e;let c=h?h(this.options.zoom,o):i.textMaxAngle;Er(c)&&(c=80),c*=Math.PI/180;const f=this.options.EXTENT,d=this.options.altitudeToTileScale,p=this.Mt();return pu(t,this.lineVertex,c,n,e,f,s,l,p,d)}Pt(t,n){let e;return e=this.K.markerPlacementFn?this.K.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement||this.vt,this.ht||!n.markerPlacement&&!n.isIconText||(this.ht=e),!this.vt||n.isIconText||this.lt||(this.lt=e),e}getPackSDFFormat(t){if("line"!==this.vt||t.isIconText)return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"}];{const t=[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"},{type:Uint8Array,width:1,name:"aCount"},{type:Int16Array,width:2,name:"aGlyphOffset"},{type:Uint16Array,width:3,name:"aSegment"},{type:Uint8Array,width:1,name:"aVertical"}];return this.Mt()&&t.push({type:Float32Array,width:3,name:"aPitchRotation"}),t}}getPackMarkerFormat(){return[...this.getPositionFormat(),{type:Int16Array,width:2,name:"aShape"},{type:Uint16Array,width:2,name:"aTexCoord"}]}}class bu{constructor(t){this.x=t.x,this.y=t.y,this.z=t.z||0}clone(){return new bu(this)}I(){return this.P(this.mag()),this}P(t){return this.x/=t,this.y/=t,this.z/=t,this}C(){var t=this.y;return this.y=this.x,this.x=-t,this}mag(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}add(t){return this.clone().m(t)}sub(t){return this.clone().M(t)}m(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}M(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}equals(t){return this.x===t.x&&this.y===t.y&&this.z===t.z}mult(t){return this.clone().k(t)}k(t){return this.x*=t,this.y*=t,this.z*=t,this}dist(t){return Math.sqrt(this.distSqr(t))}distSqr(t){var n=t.x-this.x,e=t.y-this.y,r=t.z-this.z;return n*n+e*e+r*r}T(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}angleTo(t){return Math.atan2(this.y-t.y,this.x-t.x)}}const wu=Math.cos(Math.PI/180*37.5),Mu=Math.pow(2,16)/1,xu=new Ut,Fu=new Ut,Au=new Ut;class ku extends oa{constructor(t,n,e){super(t,n,e);let r=!1;const{lineDasharrayFn:i,lineDashColorFn:s}=this.K;this.hasGradient=this.symbol.lineGradientProperty,i&&(r=function(t,n,e){for(let r=0;r<t.length;r++)if(e(n,t[r].properties))return!0;return!1}(t,this.options.zoom,i),r&&(this.dasharrayFn=i)),this.hasDasharray=_u(this.symbol.lineDasharray)||r,this.hasDasharray&&s&&(this.dashColorFn=s)}createStyledVector(t,n,e,r,i){const s=new Cr(t,n,e,r),o=s.getLineResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const{lineWidthFn:t,lineStrokeWidthFn:n,lineStrokeColorFn:e,lineColorFn:r,lineOpacityFn:i,lineDxFn:s,lineDyFn:o,linePatternAnimSpeedFn:a,linePatternGapFn:u}=this.K,h=[...this.getPositionFormat()];if(h.push(this.iconAtlas||this.hasDasharray?{type:Int8Array,width:3,name:"aExtrude"}:{type:Int8Array,width:2,name:"aExtrude"}),h.push({type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}),t&&h.push({type:Uint8Array,width:1,name:"aLineWidth"}),n&&h.push({type:Uint8Array,width:1,name:"aLineStrokeWidth"}),r&&h.push({type:Uint8Array,width:4,name:"aColor"}),e&&h.push({type:Uint8Array,width:4,name:"aStrokeColor"}),i&&h.push({type:Uint8Array,width:1,name:"aOpacity"}),this.dasharrayFn&&h.push({type:Uint8Array,width:4,name:"aDasharray"}),this.dashColorFn&&h.push({type:Uint8Array,width:4,name:"aDashColor"}),this.iconAtlas){const t=this.getIconAtlasMaxValue();h.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return(s||o)&&h.push({type:Int8Array,width:2,name:"aLineDxDy"}),(a||u)&&h.push({type:Int8Array,width:2,name:"aLinePattern"}),h}placeVector(t){const{lineJoinFn:n,lineCapFn:e,lineWidthFn:r,lineHeightFn:i,lineStrokeWidthFn:s,lineStrokeColorFn:o,lineColorFn:a,lineOpacityFn:u,lineDxFn:h,lineDyFn:l,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.K,p=this.symbol,y=t.feature,m=y.properties;let g=p.lineJoin||"miter",v=p.lineCap||"butt";if(n&&(g=n(this.options.zoom,m)||"miter"),e&&(v=e(this.options.zoom,m)||"butt"),r){let t=r(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLineWidth=1,t=4),hr(t)&&(t=4),this.feaLineWidth=+t}else this.feaLineWidth=+p.lineWidth;if(i){let t=i(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLineHeight=1),hr(t)&&(t=this.feaLineWidth),this.feaLineHeight=+t}else this.feaLineHeight=+p.lineHeight||this.feaLineWidth;if(s){let t=s(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLineStrokeWidth=1,t=0),hr(t)&&(t=0),this.feaLineStrokeWidth=t}else this.feaLineStrokeWidth=p.lineStrokeWidth||0;if(a&&(this.feaColor=a(this.options.zoom,m)||[255,255,255,255],d(this.feaColor)?(this.dynamicAttrs.aColor=1,this.feaColor=[0,0,0,0]):this.feaColor=Mr([],this.feaColor)),o&&(this.feaStrokeColor=o(this.options.zoom,m)||[0,0,0,255],d(this.feaStrokeColor)?(this.dynamicAttrs.aStrokeColor=1,this.feaStrokeColor=[0,0,0,0]):this.feaStrokeColor=Mr([],this.feaStrokeColor)),u){let t=u(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aOpacity=1,t=1),hr(t)&&(t=1),this.feaOpacity=255*t}if(this.dasharrayFn){let t=this.dasharrayFn(this.options.zoom,m)||[0,0,0,0];if(d(t)&&(this.dynamicAttrs.aDasharray=1,t=[0,0,0,0]),t.length<4){const n=t;1===t.length?t=[n[0],n[0],n[0],n[0]]:2===t.length?t=[n[0],n[1],n[0],n[1]]:3===t.length&&(t=[n[0],n[1],n[2],n[2]])}this.feaDash=t}if(this.dashColorFn){let t=(this.dashColorFn?this.dashColorFn(this.options.zoom,m):this.symbol.lineDashColor)||[0,0,0,0];d(t)&&(this.dynamicAttrs.aDashColor=1,t=[0,0,0,0]),t=Mr([],t),this.feaDashColor=t}if(this.iconAtlas){const n=t.getLineResource(),e=this.iconAtlas.glyphMap[n];if(this.feaTexInfo=this.feaTexInfo||[0,0,0,0],e){const{tl:t,displaySize:e}=this.iconAtlas.positions[n];this.feaTexInfo[0]=t[0]+1,this.feaTexInfo[1]=t[1]+1,this.feaTexInfo[2]=e[0]-3,this.feaTexInfo[3]=e[1]-3}else this.feaTexInfo[0]=this.feaTexInfo[1]=this.feaTexInfo[2]=this.feaTexInfo[3]=0}if(h){let t=h(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),hr(t)&&(t=0),this.feaLineDx=t}if(l){let t=l(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLineDxDy=1,t=0),hr(t)&&(t=0),this.feaLineDy=t}if(c){let t=c(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLinePatternAnimSpeed=1,t=0),hr(t)&&(t=0),0!==t&&(this.properties.hasPatternAnim=1),this.feaPatternAnimSpeed=t}if(f){let t=f(this.options.zoom,m);d(t)&&(this.dynamicAttrs.aLinePatternGap=1,t=0),hr(t)&&(t=0),this.feaLinePatternGap=t}const b=this.options.EXTENT;let w=y.geometry;if(b!==1/0){w=[];const t=[];for(let n=0;n<y.geometry.length;n++){t[0]=y.geometry[n];const e=ru(t,-1,-1,b+1,b+1);if(3===y.type&&e.length>1){const t=e[0],n=e[e.length-1];$u(t[0],n[n.length-1])&&(e[0]=n.concat(t.slice(1)),e.length=e.length-1)}w.push(...e)}}const M=this.needAltitudeAttribute()?2:3;for(let t=0;t<w.length;t++)this.offset=this.data.aPosition.length/M,this.St(w[t],y,g,v,2,1.05)}_t(){return this.iconAtlas&&this.feaTexInfo[2]&&this.feaTexInfo[3]}St(t,n,e,r,i,s){const o=this._t()||_u(this.feaDash)||_u(this.symbol.lineDasharray),a=this.options.isTube;a&&(t=t.map(t=>new bu(t))),this.overscaling=1;const u=this.options.EXTENT;if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.prevVertex=null,this.symbol.lineGradientProperty&&n.properties&&lr(n.properties.mapbox_clip_start)&&lr(n.properties.mapbox_clip_end)){this.clipStart=+n.properties.mapbox_clip_start,this.clipEnd=+n.properties.mapbox_clip_end;for(let n=0;n<t.length-1;n++)this.totalDistance+=t[n].dist(t[n+1]);this.updateScaledDistance()}const h=3===n.type&&!t.clipped;let l=t.length;for(;l>=2&&$u(t[l-1],t[l-2]);)l--;let c=0;for(;c<l-1&&$u(t[c],t[c+1]);)c++;if(l<(h?3:2))return;"bevel"===e&&(i=1.05);const f=this.overscaling<=16?15*u/(512*this.overscaling):0,d={vertexLength:0,primitiveLength:0,currentNormal:null};let p,y,m,g,v;this.e1=this.e2=-1,h&&(p=t[l-2],v=t[c].sub(p).I().C());for(let n=c;n<l;n++){if(m=n===l-1?h?t[c+1]:void 0:t[n+1],m&&$u(t[n],m))continue;v&&(g=v),p&&(y=p),p=t[n],m&&p.x===m.x&&p.y===m.y&&(p.x+=1e-4),v=m?m.sub(p).I().C():g,d.dir=y?p.sub(y).I():m.sub(p).I(),g=g||v,d.currentNormal=g;let u=g.add(v);0===u.x&&0===u.y||u.I();const b=g.x*v.x+g.y*v.y,w=u.x*v.x+u.y*v.y,M=0!==w?1/w:1/0,x=2*Math.sqrt(2-2*w),F=w<wu&&y&&m,A=g.x*v.y-g.y*v.x>0;if(!a&&F&&n>c){const t=p.dist(y);if(t>2*f){const n=p.sub(p.sub(y).k(f/t).T());n.z=p.z,this.updateDistance(y,n),this.addCurrentVertex(n,g,0,0,d),y=n}}const k=y&&m;d.middleVertex=k;let P=k?e:h?"butt":r;if(k&&"round"===P&&(M<s?P="miter":M<=2&&(P="fakeround")),"miter"===P&&M>i&&!a&&(P="bevel"),"bevel"===P&&(M>2&&(P="flipbevel"),M<i&&(P="miter")),y&&this.updateDistance(y,p),"miter"===P)a?(this.addCurrentVertex(p,g,0,0,d),d.dir=m.sub(p).I(),this.addCurrentVertex(p,v,0,0,d)):(u.k(M),this.addCurrentVertex(p,u,0,0,d),o&&(d.currentNormal=v,this.addCurrentVertex(p,u,0,0,d)));else if("flipbevel"===P){if(M>100)u=v.mult(-1);else{const t=M*g.add(v).mag()/g.sub(v).mag();u.C().k(t*(A?-1:1))}this.addCurrentVertex(p,u,0,0,d),this.addCurrentVertex(p,u.mult(-1),0,0,d)}else if("bevel"===P||"fakeround"===P){const t=-Math.sqrt(M*M-1),n=A?t:0,e=A?0:t;if(y&&this.addCurrentVertex(p,g,n,e,d),"fakeround"===P){const t=Math.round(180*x/Math.PI/20);for(let n=1;n<t;n++){let e=n/t;if(.5!==e){const t=e-.5;e+=e*t*(e-1)*((1.0904+b*(b*(3.55645-1.43519*b)-3.2452))*t*t+(.848013+b*(.215638*b-1.06021)))}const r=v.sub(g).k(e).m(g).I().k(A?-1:1);this.addHalfVertex(p,r.x,r.y,!1,A,0,d)}}m&&(d.currentNormal=v,this.addCurrentVertex(p,v,-n,-e,d))}else if("butt"===P)this.addCurrentVertex(p,u,0,0,d);else if("square"===P){const t=y?1:-1;this.addCurrentVertex(p,u,t,t,d)}else"round"===P&&(y&&(this.addCurrentVertex(p,g,0,0,d),this.addCurrentVertex(p,g,1,1,d,!0)),m&&(this.addCurrentVertex(p,v,-1,-1,d,!0),this.addCurrentVertex(p,v,0,0,d)));if(!a&&F&&n<l-1){const t=p.dist(m);if(t>2*f){const n=p.add(m.sub(p).k(f/t).T());n.z=p.z,this.updateDistance(p,n),this.addCurrentVertex(n,v,0,0,d),p=n}}}}addCurrentVertex(t,n,e,r,i,s=!1){const o=n.x+n.y*e,a=n.y-n.x*e,u=n.y*r-n.x,h=-n.y-n.x*r;let l=0,c=0;if(i.middleVertex){xu.x=o,xu.y=a,Fu.x=u,Fu.y=h;const t=i.currentNormal;if(l=Iu(t,xu),0===e&&0===r)c=-l;else{const n=Au;n.x=t.x,n.y=t.y,n.k(-1),c=Iu(n,Fu)}}this.addHalfVertex(t,o,a,s,!1,e,i,l),this.addHalfVertex(t,u,h,s,!0,-r,i,c),this.prevVertex&&$u(t,this.prevVertex)||(this.prevVertex=t),this.distance>Mu/2&&0===this.totalDistance&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,e,r,i,s))}addHalfVertex({x:t,y:n,z:e},r,i,s,o,a,u,h){this.fillData(this.data,t,n,e||0,r,i,s,o,1*this.scaledDistance,h);const l=u.vertexLength++;this.e1>=0&&this.e2>=0&&(this.addElements(this.e1,this.e2,l),u.primitiveLength++),o?this.e2=l:this.e1=l}fillData(t,n,e,r,i,s,o,a,u,h){const{lineWidthFn:l,lineStrokeWidthFn:c,lineStrokeColorFn:f,lineColorFn:d,lineOpacityFn:p,lineDxFn:y,lineDyFn:m,linePatternAnimSpeedFn:g,linePatternGapFn:v}=this.K;this.fillPosition(t,n,e,r);let b=63*i;b=(Math.sign(b)||1)*((Math.floor(Math.abs(b))>>1<<1)+ +o);let w=63*s;w=(Math.sign(w)||1)*((Math.floor(Math.abs(w))>>1<<1)+ +a),t.aExtrude.push(b,w),(this.iconAtlas||this.hasDasharray)&&t.aExtrude.push(63*h),t.aLinesofar.push(u),l&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),c&&t.aLineStrokeWidth.push(Math.round(2*this.feaLineStrokeWidth)),d&&t.aColor.push(...this.feaColor),f&&t.aStrokeColor.push(...this.feaStrokeColor),p&&t.aOpacity.push(this.feaOpacity),this.dasharrayFn&&t.aDasharray.push(...this.feaDash),this.dashColorFn&&t.aDashColor.push(...this.feaDashColor),this.iconAtlas&&t.aTexInfo.push(...this.feaTexInfo),(y||m)&&t.aLineDxDy.push(this.feaLineDx||0,this.feaLineDy||0),(g||v)&&t.aLinePattern.push(127*(this.feaPatternAnimSpeed||0),10*(this.feaLinePatternGap||0)),this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}addElements(t,n,e){super.addElements(this.offset+t,this.offset+n,this.offset+e)}Ot(t){const n=this.options.EXTENT,e=this.elements;for(let r=0;r<e.length;r+=3)n!==1/0&&(Su(this.data.aPosition,e[r],e[r+1],3,n)||Su(this.data.aPosition,e[r+1],e[r+2],3,n))||t.push(e[r],e[r+1],e[r+2])}Et(t){if(t.length<=1)return t;const n=[],e=this.options.EXTENT;let r,i=!0;for(r=0;r<t.length-1;r++){const s=Pu(t[r],t[r+1],e);s&&i||(n.push(t[r]),i=s)}return i||n.push(t[r]),n}updateDistance(t,n){if(this.options.isTube){const e=t.dist(n),r=vr(this.options)*(n.z-t.z);this.distance+=Math.sqrt(e*e+r*r)}else this.distance+=t.dist(n);this.updateScaledDistance()}updateScaledDistance(){this.scaledDistance=this.totalDistance>0?(this.clipStart+(this.clipEnd-this.clipStart)*this.distance/this.totalDistance)*(Mu-1):this.distance}}function Pu(t,n,e){return e!==1/0&&(t.x<0&&n.x<0||t.x>e&&n.x>e||t.y<0&&n.y<0||t.y>e&&n.y>e)}function Su(t,n,e,r,i){if(i===1/0)return!1;const s=Math.floor(.5*t[n*r]),o=Math.floor(.5*t[n*r+1]),a=Math.floor(.5*t[e*r]),u=Math.floor(.5*t[e*r+1]);return s===a&&(s<0||s>i)&&o!==u||o===u&&(o<0||o>i)&&s!==a}function _u(t){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(t[n])return!0;return!1}const Ou=new Ut(0,0),Eu=new Ut(0,0);function Iu(t,n){const e=t.mag(),r=n.mag();Ou.x=n.x,Ou.y=n.y;const i=t.angleTo(Eu),s=n.angleTo(Eu);return Math.sign(s-i)*Math.sqrt(r*r-e*e)}function $u(t,n){return t.equals(n)&&t.z===n.z}class Cu extends ku{constructor(t,n,e){super(t,n,e),this.It=e.altitudeProperty}getFormat(){const{lineColorFn:t,lineWidthFn:n}=this.K,e=[{type:this.maxPosZ>=Math.pow(2,15)?Float32Array:Int16Array,width:3,name:"aPosition"},{type:Uint16Array,width:1,name:"aLinesofar"},{type:Uint8Array,width:1,name:"aUp"},{type:Int16Array,width:3,name:"aExtrudedPosition"},{type:Int8Array,width:2,name:"aExtrude"}];return t&&e.push({type:Uint8Array,width:4,name:"aColor"}),n&&e.push({type:Uint8Array,width:1,name:"aLineWidth"}),this.It&&e.push({type:Array,width:1,name:"aLineHeight"}),e}placeVector(t){const n=t.feature;if(this.It){const{altitudeScale:t,altitudeProperty:e,defaultAltitude:r,heightProperty:i,defaultHeight:s,minHeightProperty:o}=this.options,{altitude:a,height:u}=_r(n,t,e,r,i,s,o);this.feaAltitude=a,this.feaMinHeight=(a-u)/a*32767,a>this.maxAltitude&&(this.maxAltitude=a)}return super.placeVector(t)}needAltitudeAttribute(){return!1}St(t,n,e,r,i,s){const o=this.data.aPosition.length/3;super.St(t,n,e,r,i,s);const a=this.data.aPosition.length/3,u=this.data.aPosition.length/3-this.offset;if(3!==n.type&&u>0&&!1!==this.options.side){const t=!1!==this.options.top?1:0,n=t+4;let e=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/e;for(let t=0;t<r;t++)n.push(n[o*r+3*r+t])}e=this.data.aPosition.length/3;for(const t in this.data){const r=this.data[t],i=r.length/e;for(let t=0;t<i;t++)r.push(r[o*i+i*n+t])}e=this.data.aPosition.length/3;for(const t in this.data){const r=this.data[t],i=r.length/e;for(let t=0;t<i;t++)r.push(r[o*i+i*(n+3)+t])}super.addElements(t+1,u+1,u),super.addElements(u,u+1,u+2);const r=this.data.aPosition.length/3-this.offset;e=this.data.aPosition.length/3;for(const t in this.data){const n=this.data[t],r=n.length/e;for(let t=0;t<r;t++)n.push(n[a*r-r+t])}e=this.data.aPosition.length/3;for(const t in this.data){const r=this.data[t],i=r.length/e;for(let t=0;t<i;t++)r.push(r[a*i-n*i-i+t])}e=this.data.aPosition.length/3;for(const t in this.data){const r=this.data[t],i=r.length/e;for(let t=0;t<i;t++)r.push(r[a*i-n*i-3*i+t])}super.addElements(r,u-3,r+1),super.addElements(u-3,r+2,r+1)}}fillData(t,n,e,r,i,s,o,a,u){const h=!1!==this.options.top,l=!1!==this.options.side,c=this.feaLineWidth||this.symbol.lineWidth/2*(this.options.EXTENT/this.options.tileSize),f=63*i,d=63*s,p=c*i+n,y=c*s+e;this.$t(t,n,e,i,s,o,a,u,p,y,f,d),l&&(h&&this.$t(t,n,e,i,s,o,a,u,p,y,f,d),this.$t(t,n,e,i,s,o,a,u,p,y,f,d),this.Ct(t,n,e,i,s,o,a,u,p,y,f,d),this.Ct(t,n,e,i,s,o,a,u,p,y,f,d)),this.maxPos=Math.max(this.maxPos,Math.abs(n),Math.abs(e))}$t(t,n,e,r,i,s,o,a,u,h,l,c){const{lineColorFn:f,lineWidthFn:d}=this.K;t.aPosition.push(n,e,32767),t.aLinesofar.push(a),t.aUp.push(+o),t.aExtrudedPosition.push(u,h,1),t.aExtrude.push(l,c),f&&t.aColor.push(...this.feaColor),d&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.It&&t.aLineHeight.push(this.feaAltitude)}Ct(t,n,e,r,i,s,o,a,u,h,l,c){const{lineColorFn:f,lineWidthFn:d}=this.K;t.aPosition.push(n,e,this.feaMinHeight||0),t.aLinesofar.push(a),t.aUp.push(+o),t.aExtrudedPosition.push(u,h,1),t.aExtrude.push(l,c),f&&t.aColor.push(...this.feaColor),d&&t.aLineWidth.push(Math.round(2*this.feaLineWidth)),this.It&&t.aLineHeight.push(this.feaAltitude)}addElements(t,n,e){const r=!1!==this.options.top,i=!1!==this.options.side,s=(r?1:0)+(i?4:0);if(t*=s,n*=s,this.data.aUp[this.offset+(e*=s)+4]){if(r&&super.addElements(n,t,e),i){const t=r?1:0;super.addElements(n+t,e+t,e+t+2),super.addElements(n+t+1,e+t+1+2,n+t+1+2)}}else if(r&&super.addElements(t,e,n),i){const n=r?1:0;super.addElements(t+n,t+n+2,e+n),super.addElements(t+n+1+2,e+n+1+2,e+n+1)}}createDataPack(t,n){this.maxAltitude=0;const e=super.createDataPack(t,n);if(!e)return e;const{data:r,indices:i}=e;this.getFormat().reduce((t,n)=>(t[n.name]={size:n.width},t),{}).aPickingId={size:1};const{aExtrudedPosition:s,aPosition:o,aLinesofar:a,aUp:u,aExtrude:h,aColor:l,aLineHeight:c,aLineWidth:f}=r,d={},p=ne(s,i);let y,m=!0;for(let t=0;t<p.length;t++)p[t]=-p[t],p[t]%1!=0&&(m=!1);if(!1!==this.options.top&&this.symbol.material&&function(t){for(const n in t)if(n.indexOf("Texture")>=0&&t[n])return!0;return!1}(this.symbol.material)&&(y=function(t,n,e){const r=[];for(let i=0;i<t.length;i+=3){const t=n[i/3];r.push(t/256,e[i/3]?1:0)}return r}(s,a,u)),d.aPosition=o,y&&(d.aTexCoord0=new Float32Array(y)),d.aNormal=m?new Int8Array(p):new Float32Array(p),d.aPickingId=r.aPickingId,d.aExtrude=h,l&&(d.aColor=l),f&&(d.aLineWidth=f),c){const t=ir(this.maxAltitude);d.aLineHeight=new t(c)}const g=[];for(const t in d)g.push(d[t].buffer);return e.data=d,e.buffers=g,e}}const Tu=Math.pow(2,16)/1;class zu extends oa{getFormat(){return[...this.getPositionFormat()]}placeVector(t){const n=t.feature,e=3===n.type,r=n.geometry,i=this.elements;e&&(this.elements=[]);const s=this.needAltitudeAttribute()?2:3;for(let t=0;t<r.length;t++)this.offset=this.data.aPosition.length/s,this.St(r[t],n),e&&(this.Ot(i),this.elements=[]);e&&(this.elements=i)}St(t,n){const e=3===n.type;let r=t.length;for(;r>=2&&t[r-1].equals(t[r-2]);)r--;let i,s,o,a=0;for(;a<r-1&&t[a].equals(t[a+1]);)a++;if(!(r<(e?3:2))){this.distance=0,this.vertexLength=0,this.primitiveLength=0,this.e1=this.e2=this.e3=-1,e&&(i=t[r-2]);for(let n=a;n<r;n++)o=e&&n===r-1?t[a+1]:t[n+1],o&&t[n].equals(o)||(i&&(s=i),i=t[n],s&&(this.distance+=i.dist(s)),this.addCurrentVertex(i,this.distance))}}addCurrentVertex(t,n){const e=this.vertexLength++;this.addLineVertex(this.data,t,n),e>=1&&this.addElements(e-1,e),n>Tu&&(this.distance=0,this.addCurrentVertex(t,this.distance))}addLineVertex(t,n){this.fillPosition(t,n.x,n.y,n.z||0),this.maxPos=Math.max(this.maxPos,Math.abs(n.x),Math.abs(n.y))}addElements(t,n){super.addElements(this.offset+t,this.offset+n)}Ot(t){const n=this.options.EXTENT,e=this.elements;for(let r=0;r<e.length;r+=2)Pr(this.data.aPosition,e[r],e[r+1],3,n)||t.push(e[r],e[r+1])}}const Du=45*Math.PI/100;class ju extends oa{getFormat(){const{markerFillFn:t}=this.K;let n;return n="line"===this.symbol.markerRotationAlignment?[...this.getPositionFormat(),{type:Float32Array,width:1,name:"aXYRotation"},{type:Float32Array,width:1,name:"aZRotation"}]:[...this.getPositionFormat()],t&&n.push({type:Uint8Array,width:4,name:"aColor"}),n}placeVector(t){const n=t.feature.properties,{markerFillFn:e}=this.K;let r;e&&(r=e(this.options.zoom,n)||[255,255,255,255],d(r)?(this.dynamicAttrs.aColor=1,r=[0,0,0,0]):r=Mr([],r));const i="line"===this.symbol.markerRotationAlignment,s=this.xt(t,this.symbol.markerSpacing||250,this.symbol.markerPlacement||"point",i);for(let t=0;t<s.length;t++){const n=s[t];this.fillPosition(this.data,n.x,n.y,n.z),i&&(this.data.aXYRotation.push(n.xyRotation||0),this.data.aZRotation.push(n.zRotation||0)),r&&this.data.aColor.push(...r);const e=Math.max(Math.abs(n.x),Math.abs(n.y));e>this.maxPos&&(this.maxPos=e)}}xt(t,n,e,r){const i=t.feature,s=this.options.EXTENT;if("line"===e){const t=[];let e=i.geometry;s&&(e=ru(i.geometry,0,0,s,s));for(let r=0;r<e.length;r++){const i=ou(e[r],n,Du,null,null,24,1,1,s||1/0);t.push.apply(t,i)}return t}return yu(i,e,s,r,this.options.altitudeToTileScale)}hasElements(){return!1}}\n/*!\n     * from @turf/bboxClip\n     * https://github.com/Turfjs/turf\n     * MIT LICENSE\n     */const Uu=[],Nu=[];function Lu(t,n){var e,r,i,s,o,a,u;for(r=1;r<=8;r*=2){for(e=[],s=!(Ru(i=t[t.length-1],n)&r),o=0;o<t.length;o++){if((u=!(Ru(a=t[o],n)&r))!==s){const t=Vu(i,a,r,n);e.push(void 0!==a.x?new Ut(t[0],t[1]):t)}u&&e.push(a),i=a,s=u}if(!(t=e).length)break}return e}function Vu(t,n,e,r){return Uu[0]=void 0===t.x?t[0]:t.x,Uu[1]=void 0===t.y?t[1]:t.y,t=Uu,Nu[0]=void 0===n.x?n[0]:n.x,Nu[1]=void 0===n.y?n[1]:n.y,n=Nu,8&e?[t[0]+(n[0]-t[0])*(r[3]-t[1])/(n[1]-t[1]),r[3]]:4&e?[t[0]+(n[0]-t[0])*(r[1]-t[1])/(n[1]-t[1]),r[1]]:2&e?[r[2],t[1]+(n[1]-t[1])*(r[2]-t[0])/(n[0]-t[0])]:1&e?[r[0],t[1]+(n[1]-t[1])*(r[0]-t[0])/(n[0]-t[0])]:null}function Ru(t,n){Uu[0]=void 0===t.x?t[0]:t.x,Uu[1]=void 0===t.y?t[1]:t.y;var e=0;return(t=Uu)[0]<n[0]?e|=1:t[0]>n[2]&&(e|=2),t[1]<n[1]?e|=4:t[1]>n[3]&&(e|=8),e}const Hu=[0,0,0,0];class Wu extends oa{constructor(...t){super(...t),this.lineElements=[]}createStyledVector(t,n,e,r,i){const s=new Cr(t,n,e,r),o=s.getPolygonResource();return!this.options.atlas&&o&&(i[o]=[0,0]),s}getFormat(){const t=[...this.getPositionFormat()],{polygonFillFn:n,polygonOpacityFn:e,uvScaleFn:r,uvOffsetFn:i,polygonPatternUVFn:s}=this.K;if(this.iconAtlas){const n=this.getIconAtlasMaxValue();t.push({type:n>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return n&&t.push({type:Uint8Array,width:4,name:"aColor"}),e&&t.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&t.push({type:Uint16Array,width:2,name:"aUVScale"}),i&&t.push({type:Uint8Array,width:2,name:"aUVOffset"}),s&&t.push({type:Float32Array,width:2,name:"aTexCoord"}),t}placeVector(t,n){const e=t.feature;this.Tt(e.geometry,e,n)}Tt(t,n){let e,r,i,s;const{polygonFillFn:o,polygonOpacityFn:a,uvScaleFn:u,uvOffsetFn:h,uvOffsetInMeterFn:l,polygonPatternUVFn:c}=this.K,f=n.properties;o&&(e=o(this.options.zoom,f)||bt([],255,255,255,255),d(e)?(this.dynamicAttrs.aColor=1,e=Hu):e=Mr([],e)),a&&(r=a(this.options.zoom,f),d(r)?(this.dynamicAttrs.aOpacity=1,r=255):(hr(r)&&(r=1),r*=255)),u&&(i=u(this.options.zoom,f),d(i)?(i=[255,255],this.dynamicAttrs.aUVScale=1):(hr(i)&&(i=[1,1]),i=[255*i[0],255*i[1]])),h&&(l&&l(null,f)?s=[0,0]:(s=h(this.options.zoom,f),d(s)?(s=[0,0],this.dynamicAttrs.aUVOffset=1):(hr(s)&&(s=[0,0]),s=[255*s[0],255*s[1]])));const p=!!this.iconAtlas,y=uu(t,500),m=[0,0],g=[0,0];if(p){const{polygonPatternFileFn:t}=this.K,n=t?t(null,f):this.symbol.polygonPatternFile;if(this.iconAtlas.glyphMap[n]){const t=this.iconAtlas.positions[n];m[0]=t.tl[0]+1,m[1]=t.tl[1]+1,g[0]=t.displaySize[0]-3,g[1]=t.displaySize[1]-3}}let v,b=0;c&&(v=c(this.options.zoom,f));const w=this.needAltitudeAttribute()?2:3,M=[-1,-1,n.extent+1,n.extent+1],x=this.zt=this.zt||this.ot.get(),F=this.Dt=this.Dt||this.ot.get();for(let t=0;t<y.length;t++){const n=y[t],o=this.data.aPosition.length/w;x.setLength(0),F.setLength(0);for(let t=0;t<n.length;t++){let o=n[t];if(this.options.EXTENT!==1/0&&0===this.maxPosZ&&(o=Lu(o,M)),0!==o.length){0!==t&&F.push(x.length/3);for(let t=0;t<o.length;t++){const n=o[t].x,a=o[t].y,u=o[t].z||0;if(this.fillPosition(this.data,n,a,u),p&&this.data.aTexInfo.push(m[0],m[1],g[0],g[1]),void 0!==e&&this.data.aColor.push(e[0],e[1],e[2],e[3]),void 0!==r&&this.data.aOpacity.push(r),void 0!==i&&this.data.aUVScale.push(i[0],i[1]),void 0!==s&&this.data.aUVOffset.push(s[0],s[1]),c){if(v){const t=hr(v[2*b])?v[0]:v[2*b],n=hr(v[2*b]+1)?v[1]:v[2*b+1];this.data.aTexCoord.push(t,n)}else this.data.aTexCoord.push(-9999999,-9999999);b++}const h=Math.abs(n),l=Math.abs(a);h>this.maxPos&&(this.maxPos=h),l>this.maxPos&&(this.maxPos=l),x.push(n,a,u)}}}let a=Ne(x,F,3);if(x.length&&!a.length){const t=[];for(let n=0;n<x.length;n+=3)t[n]=x[n],t[n+1]=x[n+2],t[n+2]=x[n+1];if(a=Ne(t,F,3),!a.length){for(let n=0;n<x.length;n+=3)t[n]=x[n+1],t[n+1]=x[n+2],t[n+2]=x[n];a=Ne(t,F,3)}}for(let t=0;t<a.length;t+=3)this.addElements(o+a[t],o+a[t+1],o+a[t+2])}}}const qu=[{type:Int16Array,width:3,name:"aPosition"}];class Gu extends oa{getFormat(){return qu}placeVector(t,n){const e=this.xt(t,n);if(0===e.length)return;const r=this.data,i=this.getAltitude(t.feature.properties);let s=r.aPosition.length/qu[0].width;for(let t=0;t<e.length;t++){const n=e[t];r.aPosition.push(2*n.x+0,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+0,i),r.aPosition.push(2*n.x+1,2*n.y+1,i),r.aPosition.push(2*n.x+0,2*n.y+1,i),this.addElements(s,s+1,s+2),this.addElements(s,s+2,s+3),s+=4;const o=Math.max(Math.abs(2*n.x+1),Math.abs(2*n.y+1));o>this.maxPos&&(this.maxPos=o)}}xt(t,n){const{feature:e,symbol:r}=t,i=this.Pt(t,r),s=e.properties,{markerSpacingFn:o}=this.K,a=((o?o(null,s):r.markerSpacing)||250)*n;return pu(t,null,null,n,this.options.EXTENT,i,a)}Pt(t,n){return this.K.markerPlacementFn?this.K.markerPlacementFn(this.options.zoom,t.feature.properties):n.markerPlacement}}class Bu extends ku{constructor(t,n,e){(n=ur({},n)).lineJoin="miter",n.lineCap="butt",super(t,n,e),this.options.radialSegments%2==1&&this.options.radialSegments--}getFormat(){const{lineWidthFn:t,lineColorFn:n,lineOpacityFn:e,linePatternAnimSpeedFn:r,linePatternGapFn:i}=this.K,s=[...this.getPositionFormat(),{type:Int8Array,size:4,name:"aTubeNormal"},{type:this.options.positionType||Uint16Array,width:1,name:"aLinesofar"}];if(this.iconAtlas){s.push({type:Int8Array,width:1,name:"aNormalDistance"});const t=this.getIconAtlasMaxValue();s.push({type:t>255?Uint16Array:Uint8Array,width:4,name:"aTexInfo"})}return t&&s.push({type:Uint16Array,width:1,name:"aLineWidth"}),n&&s.push({type:Uint8Array,width:4,name:"aColor"}),e&&s.push({type:Uint8Array,width:1,name:"aOpacity"}),r&&s.push({type:Int8Array,width:1,name:"aLinePatternAnimSpeed"}),i&&s.push({type:Int8Array,width:1,name:"aLinePatternGap"}),s}addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:h,z:l}=t,c=1*this.scaledDistance,f=this.options.radialSegments/2,{x:d,y:p,z:y}=o.dir,m=function(t,n,e,r,i,s,o,a){ft(Ju,e,r,i),ft(Xu,s,o,0),mt(Yu,Ju,Xu),pt(Xu,Xu),pt(Yu,Yu),Zu[n]||(Zu[n]=[]);const u=Zu[n];for(var h=0;h<n;h++){const t=Math.PI*h/n,e=1-Math.abs(t-0)/(Math.PI/2);u[h]=u[h]||[],Ku(Xu,Yu,u[h],1,t,e*(a?-1:1))}return u}(0,f,d,p,y,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,h,l||0,m,i,c,a)}fillTubeElements(t){const n=this.options.radialSegments/2,e=this.needAltitudeAttribute()?2:3,r=this.data.aPosition.length/e;for(let e=0;e<n;e++){const i=e+r-2*n;let s,o;e===n-1&&t?(s=e+r-2*n+1,o=e+r-2*n-2*n+1):(s=e+r+1,o=e+r+1-2*n),super.addElements(e+r-this.offset,s-this.offset,i-this.offset),super.addElements(i-this.offset,s-this.offset,o-this.offset)}}fillData(t,n,e,r,i,s,o,a){const{lineWidthFn:u,lineColorFn:h,lineOpacityFn:l,linePatternAnimSpeedFn:c,linePatternGapFn:f}=this.K,d=i.length;for(let s=0;s<d;s++){if(this.fillPosition(t,n,e,r),Mt(i[s],i[s],63),t.aTubeNormal.push(...i[s]),t.aLinesofar.push(o),this.iconAtlas&&(t.aNormalDistance.push(63*a),t.aTexInfo.push(...this.feaTexInfo)),u){const n=br(this.options.metric);let e=this.feaLineWidth*n;isNaN(e)&&(e=0),t.aLineWidth.push(Math.round(e))}h&&t.aColor.push(...this.feaColor),l&&t.aOpacity.push(this.feaOpacity),c&&t.aLinePatternAnimSpeed.push(127*(this.feaPatternAnimSpeed||0)),f&&t.aLinePatternGap.push(10*(this.feaLinePatternGap||0))}this.maxPos=Math.max(this.maxPos,Math.abs(n)+1,Math.abs(e)+1)}createDataPack(t,n){const e=super.createDataPack(t,n);return e&&(e.is2D=!1),e}}const Ju=[],Xu=[],Yu=[],Zu={};function Ku(t,n,e,r,i,s){return bt(e,r*(Math.cos(i)*t[0]+Math.sin(i)*n[0]),r*(Math.cos(i)*t[1]+Math.sin(i)*n[1]),r*(Math.cos(i)*t[2]+Math.sin(i)*n[2]),s),e}class Qu extends Bu{addHalfVertex(t,n,e,r,i,s,o,a){const{x:u,y:h,z:l}=t,c=1*this.scaledDistance,{x:f,y:d,z:p}=o.dir,y=function(t,n,e,r,i,s,o,a){ft(nh,e,r,i),ft(eh,s,o,0),mt(rh,nh,eh),pt(eh,eh),pt(rh,rh),_t(th,t,n);const u=Et(th)/t,h=Math.atan(n/t);let l=Math.PI/2+(Math.PI/2-h);return ih[0]||(ih[0]=[]),Ku(eh,rh,ih[0],u,l,a?1:-1),l+=2*h,ih[1]||(ih[1]=[]),Ku(eh,rh,ih[1],u,l,a?1:-1),ih}(this.feaLineWidth,this.feaLineHeight,f,d,p,n,e,i);this.prevVertex&&this.fillTubeElements(i),this.fillData(this.data,u,h,l||0,y,i,c,a)}}const th=[],nh=[],eh=[],rh=[],ih=[];class sh{constructor(t){this.max=t,this.reset()}reset(){return this.data={},this.order=[],this}clear(){this.reset()}add(t,n){return this.has(t)?(this.order.splice(this.order.indexOf(t),1),this.data[t]=n,this.order.push(t)):(this.data[t]=n,this.order.push(t),this.order.length>this.max&&this.getAndRemove(this.order[0])),this}has(t){return t in this.data}keys(){return this.order}getAndRemove(t){if(!this.has(t))return null;const n=this.data[t];return delete this.data[t],this.order.splice(this.order.indexOf(t),1),n}get(t){return this.has(t)?this.data[t]:null}remove(t){return this.has(t)?(delete this.data[t],this.order.splice(this.order.indexOf(t),1),this):this}setMaxSize(t){for(this.max=t;this.order.length>this.max;)this.getAndRemove(this.order[0]);return this}}\n/*!\n     * based on @mapbox/tiny-sdf\n     * https://github.com/mapbox/tiny-sdf\n     * @License BSD 2-Clause\n     */var oh=1e20;function ah(t,n,e,r,i,s,o){this.fontSize=t||24,this.buffer=void 0===n?3:n,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=s||"normal",this.fontStyle=o||"normal",this.radius=e||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas="undefined"==typeof document?new OffscreenCanvas(a,a):document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontStyle+" "+this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function uh(t,n,e,r,i,s){for(var o=0;o<n;o++)hh(t,o,n,e,r,i,s);for(var a=0;a<e;a++)hh(t,a*n,1,n,r,i,s)}function hh(t,n,e,r,i,s,o){var a,u,h,l;for(s[0]=0,o[0]=-oh,o[1]=oh,a=0;a<r;a++)i[a]=t[n+a*e];for(a=1,u=0,h=0;a<r;a++){do{h=(i[a]-i[l=s[u]]+a*a-l*l)/(a-l)/2}while(h<=o[u]&&--u>-1);s[++u]=a,o[u]=h,o[u+1]=oh}for(a=0,u=0;a<r;a++){for(;o[u+1]<a;)u++;t[n+a*e]=i[l=s[u]]+(a-l)*(a-l)}}ah.prototype.draw=function(t,n,e){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.textBaseline="top",this.ctx.fillText(t,this.buffer,this.buffer);for(var r=this.ctx.getImageData(0,0,n,e),i=new Uint8ClampedArray(n*e),s=0;s<n*e;s++){var o=r.data[4*s+3]/255;this.gridOuter[s]=1===o?0:0===o?oh:Math.pow(Math.max(0,.5-o),2),this.gridInner[s]=1===o?oh:0===o?0:Math.pow(Math.max(0,o-.5),2)}for(uh(this.gridOuter,n,e,this.f,this.v,this.z),uh(this.gridInner,n,e,this.f,this.v,this.z),s=0;s<n*e;s++){var a=Math.sqrt(this.gridOuter[s])-Math.sqrt(this.gridInner[s]);i[s]=Math.round(255-255*(a/this.radius+this.cutoff))}return i};let lh=0;class ch{constructor(t,n=15,e){this.entries={},this.jt={},this.Ut=new sh(2048,(function(){})),this.Nt=t,this.Lt=n,this.Vt=e}getGlyphs(t,n){if(!t||!Object.keys(t).length)return void n(null,{glyphs:null});const e=this.entries,r=t.options;let i=!0;r&&(i=!1!==r.isCharsCompact),i=i||this.Vt;const s=(r,s,a)=>{let u=0,h=0;for(const n in t)if("options"!==n){e[n]=e[n]||{},s[n]=s[n]||{};for(const l in t[n]){if(h++,h<=r)continue;const t=n.split(" "),c=i&&"normal"===t[0]&&!Na(+l),f=n+":"+l+":"+c;let d;if(this.Ut.has(f)?d=this.Ut.get(f):(d=this.Rt(e[n],t,l,c),this.Ut.add(f,d),u++),d=fh(d),s[n][l]=d,a.push(d.bitmap.data.buffer),this.Nt&&u>this.Lt)return void this.Nt(o(h,s,a))}}n(null,{glyphs:s,buffers:a})};function o(t,n,e){return()=>{s(t,n,e)}}s(0,{},[])}Rt(t,n,e,r){const i=n[0],s=n[1],o=n.slice(3).join(" ");let a=t.tinySDF,u="normal"!==i?5:2;const h=r?-1:2;if(!a){let n="400";/bolder/i.test(s)?n="1000":/bold/i.test(s)?n="900":/medium/i.test(s)?n="500":/light/i.test(s)&&(n="200"),a=t.tinySDF=new ah(24,u,8,.25,o,n,i)}const l=String.fromCharCode(e),c=a.ctx.measureText(l),f=Math.round(c.width),d=a.draw(String.fromCharCode(e),f+2*u,24+2*u);if(lh<4){const t="undefined"!=typeof document&&document.getElementById("sdf-debug-"+lh++);t&&(t.width=f+2*u,t.height=a.canvas.height,t.getContext("2d").drawImage(a.canvas,0,0))}return{charCode:e,bitmap:{width:f+2*u,height:24+2*u,data:d},metrics:{width:f,height:24,left:1,top:-u,advance:f+u+h}}}}function fh(t){const n={width:t.bitmap.width,height:t.bitmap.height,data:new Uint8ClampedArray(t.bitmap.data)};return{charCode:t.charCode,bitmap:n,metrics:ur({},t.metrics)}}var dh=Object.freeze({__proto__:null,clipPolygon:Lu,calculateSignedArea:kr,getFeaAltitudeAndHeight:_r,generatePickingIndiceIndex:$r,convertRTLText:Qa,packPosition:Tr,unpackPosition:function(t,n,e,r){const i=(Math.sign(n)||1)*(Math.abs(n)%zr),s=(Math.sign(e)||1)*(Math.abs(e)%zr),o=Math.floor(Math.abs(n)/zr),a=Math.floor(Math.abs(e)/zr);return t[0]=i,t[1]=s,t[2]=Math.sign(r+1e-5)*(2*o+a)*Dr+r,t},convertGeometry:ar,getPosArrayType:ir,getUnsignedArrayType:sr,getIndexArrayType:rr});const ph={},yh={},mh=[];Object.freeze({__proto__:null,loadSymbolFnTypes:function t(n,e){if(!n)return null;var r=!1;if(Array.isArray(n)){var i,s=[];for(let o=0;o<n.length;o++)(i=t(n[o],e))?(s.push(i),r=!0):s.push(n[o]);return r?s:n}var o={__fn_types_loaded:!0};const a=[];for(const t in n)yr(n,t)&&a.push(t);const u=function(t){Object.defineProperty(o,t,{get:function(){return this["__fn_"+t]||(this["__fn_"+t]=p(this["_"+t])),this["__fn_"+t].apply(this,e())},set:function(n){this["_"+t]=n},configurable:!0,enumerable:!0})},h={},l=function(t,n){Object.defineProperty(o,t,{get:function(){this["__fn_"+t]||(this["__fn_"+t]=Lo(this["_"+t],n));const r=e()[0];h.zoom=r;try{return this["__fn_"+t].evaluateWithoutErrorHandling(h,ph,yh,null,mh)}catch(t){return null}},set:function(n){this["_"+t]=n},configurable:!0,enumerable:!0})};for(let t=0,e=a.length;t<e;t++){const e=a[t];if(d(n[e]))r=!0,o["_"+e]=n[e],u(e);else if(Vo(n[e])){r=!0;const t=Go(e);o["_"+e]=n[e],l(e,t)}else o[e]=n[e]}return r?o:n}});const gh={polygonPatternFile:1,markerFile:1,markerPlacement:1,markerSpacing:1,textName:1,textStyle:1,textFaceName:1,textWeight:1,textPlacement:1,textSpacing:1,lineJoin:1,lineCap:1,linePatternFile:1};Object.assign({visible:1,textHorizontalAlignment:1,textVerticalAlignment:1,textWrapWidth:1,markerHorizontalAlignment:1,markerVerticalAlignment:1},gh),Object.assign({lineDasharray:1,topPolygonFill:1,bottomPolygonFill:1},gh);new Float32Array([-1e12])[0];const vh="maptalks_ombb";function bh(t,n,e,r,i,s,o,a,u,h,l,c,f,d,p,y,m){const g=n.length,v=i/3;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-o;i+=g;for(let e=2,r=g;e<r;e+=3)t[i+e-2]=n[e-2],t[i+e-1]=n[e-1],t[i+e-0]=n[e]-a;i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,t.trySetLength(i+g),t.copyWithin(i,i-2*g,i-g),i+=g,(e=e||[]).push(g/3);for(let n=0;n<e.length;n++){wh(v+(e[n-1]||0),v+e[n],t,g/3,u,r,h,l,c,f,s,d,p,y,m)}return i}function wh(t,n,e,r,i,s,o,a,u,h,l,c,f,d,p){const y=s.length;let m,g;for(let o=t,a=n;o<a-1;o++)m=o,g=o+1,i!==1/0&&at(e,m,g,i)||((o-t)%2==1&&(m+=2*r,g+=2*r),p?(s.push(m+r,g,m),s.push(g+r,g,m+r)):(s.push(m+r,m,g),s.push(g,g+r,m+r)));o&&function(t,n,e,r,i,s,o,a,u,h,l){let c,f=0,d=0,p=0,y=0;const m=l?[1,3,4]:[2,3,4];for(let l=s.length-1;l>=0;l--){const g=s[l],v=3*g+1,b=3*g+2,w=i[3*g],M=i[v],x=i[b];f||d||(f=Math.max(i[b],i[3*s[l-3]+2]),d=Math.min(i[b],i[3*s[l-3]+2]),c=f-d);let F=p;const A=l%6;0===t?(5===A&&(y=jt(i,s,l,w,M)),F=A===m[0]||A===m[1]||A===m[2]?p:p+y):1===t&&(A===m[0]||A===m[1]||A===m[2]?F=0:5===A?(y=jt(i,s,l,w,M),F=y):F=y);const k=F/u*(1/(100*h))/o;let P;P=1===n?x===f?1:0:"bottom"===e?x===f?c/100/a:0:x===f?0:-c/100/a,r[2*g]=k,r[2*g+1]=P,0===A&&(p+=y)}}(a,u,h,l,e,s.slice(y,s.length),c[0],c[1],f,d,p)}function Mh(t){const n=[t[0]];let e=t[0];for(let r=1;r<t.length;r++)Array.isArray(t[r])?t[r][0]===e[0]&&t[r][1]===e[1]&&t[r][2]===e[2]||n.push(t[r]):t[r].x===e.x&&t[r].y===e.y&&t[r].z===e.z||n.push(t[r]),e=t[r];return n}const xh=Qo.getInstance();function Fh(t,n,e,r,i,s,o,a,u,h,l,c,f,m,g,v){void 0===n.top&&(n.top=!0),void 0===n.side&&(n.side=!0),xh.reset();const{altitudeScale:b,altitudeProperty:w,defaultAltitude:M,heightProperty:F,minHeightProperty:A,defaultHeight:k,tangent:_,uv:O,topUVMode:E,sideUVMode:I,sideVerticalUVMode:$,top:C,side:T,textureYOrigin:z,topThickness:D}=n,j=!!v,U=function(t,n,{altitudeScale:e,altitudeProperty:r,defaultAltitude:i,heightProperty:s,minHeightProperty:o,defaultHeight:a},{center:u,side:h,top:l,topThickness:c,uvOrigin:f,uv:d,uvSize:p,topUVMode:y,sideUVMode:m,sideVerticalUVMode:g,textureYOrigin:v,tileRatio:b,centimeterToPoint:w,verticalCentimeterToPoint:M,positionType:F,res:A,glScale:k,projectionCode:S},_,O){let E=n/t[0].extent;n===1/0&&(E=1);const I=n===1/0,$=O.get(),C=O.get(),T=O.get(),z=O.get(),D=O.get(),j=O.get(),U=O.get(),N=!!d,L=!!l,V=!!h,R=N?O.get():null;function H(t,e,r,i,s,o){let a=e;if(L){const i=Ne(z,r,3);if(0===i.length)return e;if(P(D,z),e+=z.length,o)for(let n=2,e=i.length;n<e;n+=3)i[n]+=t/3,i[n-1]+=t/3,i[n-2]+=t/3;else{let n;for(let e=2,r=i.length;e<r;e+=3)n=i[e-1],i[e-1]=i[e]+t/3,i[e]=n+t/3,i[e-2]+=t/3}P(j,i),N&&zt(y||0,t,e,R,D,f,w,b,p[0],p[1],s,A,k,S,u),c>0&&!V&&(e=bh(D,z,r,j,e,R,0,c,n,N,m||0,g||0,v,p,b,M,o)),U.setLength(e/3),U.fill(1,a/3,e/3)}if(V){L&&(c=0),a=e,e=bh(D,z,r,j,e,R,c,i,n,N,m||0,g||0,v,p,b,M,o),U.setLength(e/3);const t=z.length/3;U.fill(1,a/3,a/3+t),U.fill(0,a/3+t,a/3+2*t),U.fill(1,a/3+2*t,a/3+3*t),U.fill(0,a/3+3*t,e/3)}return e}let W=0,q=0;const G=[-1,-1,n+1,n+1];let B=0,J=t.length;x(_)&&(B=_,J=_+1);let X=0,Y=!1;const Z=O.get();for(;B<J;B++){const u=t[B],h=u.id;x(h)&&(Math.abs(h)>X&&(X=Math.abs(h)),h<0&&(Y=!0));const l=u.geometry,c=u.properties[vh];let f=Array.isArray(c&&c[0]&&c[0][0])?c[0]:c;const{altitude:d,height:p}=dh.getFeaAltitudeAndHeight(u,e,r,i,s,a,o);W=Math.max(Math.abs(d),W);const y=D.length;let m=0,g=q;Z.setLength(0),z.setLength(0);const v=dh.calculateSignedArea(l[0])<0;for(let t=0,e=l.length;t<e;t++){let r=l[t];v&&(r=r.reverse()),r=Mh(r);const i=dh.calculateSignedArea(r)<0;if(!i&&t>0&&(m++,f=c&&c[m],q=H(g,q,Z,p*E,f,I),z.setLength(0),Z.setLength(0),g=q),n!==1/0&&(r=dh.clipPolygon(r,G)),!r.length){t===e-1&&(q=H(g,q,Z,p*E,f,I));continue}const s=r.length;Array.isArray(r[0])?r[0][0]===r[s-1][0]&&r[0][1]===r[s-1][1]||r.push([r[0][0],r[0][1]]):r[0].x===r[s-1].x&&r[0].y===r[s-1].y||r.push(r[0]),i&&Z.push(z.length/3),ot(z,z.length,r,E,d,!1,F),t===e-1&&(q=H(g,q,Z,p*E,f,I))}const b=D.length-y,w="__fea_idx".trim();for(let t=0;t<b/3;t++)C.push(void 0===u[w]?B:u[w]),$.push(B),x(h)&&T.push(h)}const K=dh.getUnsignedArrayType(C.length?C[C.length-1]:0),Q={maxAltitude:W,vertices:D,verticeTypes:U,indices:j,pickingIds:Qo.createTypedArray(C,K),featureIndexes:$};if(T.length){const t=Y?dh.getPosArrayType(X):dh.getUnsignedArrayType(X);Q.featureIds=Qo.createTypedArray(T,t)}else Q.featureIds=[];return R&&(R.setLength(D.length/3*2),Q.uvs=R),Q}(t,e,{altitudeScale:b,altitudeProperty:w,defaultAltitude:M||0,heightProperty:F,minHeightProperty:A,defaultHeight:k||0},{center:v,top:C,side:T,topThickness:10*D||0,uv:O||_,uvSize:[i,i],uvOrigin:r,topUVMode:E,sideUVMode:I,sideVerticalUVMode:$,textureYOrigin:z,tileRatio:a,centimeterToPoint:u,verticalCentimeterToPoint:h,positionType:g,res:s,glScale:o,projectionCode:f},m,xh),N=[],L=U.vertices.length/3,V=dh.getIndexArrayType(L),R=Qo.createTypedArray(U.indices,V);delete U.indices,N.push(R.buffer,U.pickingIds.buffer);const H=_?xh.get():new Float32Array(3*L);H.setLength&&H.setLength(3*L);const W=ne(U.vertices,R,H);let q=!0;for(let t=0;t<W.length;t++){j||(W[t]=-W[t]);const n=W[t]%1;1-Math.abs(n)>1e-6?q=!1:0!==n&&(W[t]=Math.round(W[t]))}if(U.normals=W,_){let t=xh.get();t.setLength(4*L),t=function(t,n,e,r,i){const s=t.length/3,o=i||new Array(4*s),a=[],u=[];for(let t=0;t<s;t++)a[t]=[0,0,0],u[t]=[0,0,0];const h=[0,0,0],l=[0,0,0],c=[0,0,0],f=[0,0],d=[0,0],p=[0,0],y=[0,0,0],m=[0,0,0];function g(n,r,i){le(h,t,3*n),le(l,t,3*r),le(c,t,3*i),ce(f,e,2*n),ce(d,e,2*r),ce(p,e,2*i);const s=l[0]-h[0],o=c[0]-h[0],g=l[1]-h[1],v=c[1]-h[1],b=l[2]-h[2],w=c[2]-h[2],M=d[0]-f[0],x=p[0]-f[0],F=d[1]-f[1],A=p[1]-f[1],k=1/(M*A-x*F);ft(y,(A*s-F*o)*k,(A*g-F*v)*k,(A*b-F*w)*k),ft(m,(M*o-x*s)*k,(M*v-x*g)*k,(M*w-x*b)*k),dt(a[n],a[n],y),dt(a[r],a[r],y),dt(a[i],a[i],y),dt(u[n],u[n],m),dt(u[r],u[r],m),dt(u[i],u[i],m)}for(let t=0,n=r.length;t<n;t+=3)g(r[t+0],r[t+1],r[t+2]);const v=[],b=[],w=[],M=[];let x,F,A;function k(t){le(w,n,3*t),ct(M,w),F=a[t],ct(v,F),gt(v,v,function(t,n,e){return t[0]=n[0]*e,t[1]=n[1]*e,t[2]=n[2]*e,t}(w,w,yt(w,F))),pt(v,v),mt(b,M,F),A=yt(b,u[t]),x=A<0?-1:1,o[4*t]=v[0],o[4*t+1]=v[1],o[4*t+2]=v[2],o[4*t+3]=x}for(let t=0,n=r.length;t<n;t+=3)k(r[t+0]),k(r[t+1]),k(r[t+2]);return o}(U.vertices,U.normals,U.uvs,R,t),t=function(t,n){const e=new Float32Array(n.length),r=[],i=[],s=[];for(let o=0;o<n.length;o+=4){const a=o/4*3;ft(i,t[a]||0,t[a+1]||0,t[a+2]||0),bt(r,n[o]||0,n[o+1]||0,n[o+2]||0,n[o+3]||0),Qn(s,i,r),vt(e.subarray(o,o+4),s)}return e}(U.normals,t),U.tangents=t,N.push(t.buffer),delete U.normals}if(U.normals&&(q&&(U.normals=Qo.createTypedArray(U.normals,Int8Array)),N.push(U.normals.buffer)),U.uvs){const t=U.uvs;U.uvs=Qo.createTypedArray(t,Float32Array),N.push(U.uvs.buffer)}if(v){const t=U.vertices;for(let n=0;n<t.length;n+=3)t[n]-=v[0],t[n+1]-=v[1]}const G=g||dh.getPosArrayType(Math.max(512,U.maxAltitude)),B=function(t,n,e,r){const i={},s={};if(S(n.polygonFill)){let o=y(n.polygonFill);const a=new Uint8Array(4*r.length);a.fill(255);for(let n=0;n<r.length;n++){const s=t[r[n]],u=s.properties||{};u.$layer=s.layer,u.$type=s.type;let h=o(e,u);d(h)&&(i.aColor=1,o=y(h),h=o(e,u)),delete u.$layer,delete u.$type,Ar.normalizeColor(Ah,h),a[4*n]=Ah[0],a[4*n+1]=Ah[1],a[4*n+2]=Ah[2],a[4*n+3]=Ah[3]}s.aColor=a}if(S(n.polygonOpacity)){let o=p(n.polygonOpacity);const a=new Uint8Array(r.length);a.fill(255);for(let n=0;n<r.length;n++){const s=t[r[n]],u=s.properties||{};u.$layer=s.layer,u.$type=s.type;let h=o(e,u);d(h)&&(i.aOpacity=1,o=y(h),h=o(e,u)),delete u.$layer,delete u.$type,a[n]=255*h}s.aOpacity=a}return s.dynamicAttributes=i,s}(t,l,c,U.featureIndexes),J=function(t,n,e,r,i){const s=[[],[]],o=S(r.topPolygonFill),a=S(r.bottomPolygonFill),u=[255,255,255,255];if(o||a){let h=o&&y(r.topPolygonFill),l=a&&y(r.bottomPolygonFill),c=null,f=null,p=null,m=null;for(let r=0;r<n.length;r++){if(1===t[r]&&!o||0===t[r]&&!a)continue;const g=1===t[r];if(g&&n[r]===c){t[r]=p;continue}if(!g&&n[r]===f){t[r]=m;continue}const v=e[n[r]],b=v.properties||{};b.$layer=v.layer,b.$type=v.type;let w=g?h:l,M=w(i,b);d(M)&&(w=y(M),M=w(i,b)),delete b.$layer,delete b.$type,Ar.normalizeColor(Ah,M),wt(Ah,Ah,u);let x=kh(s,Ah);x<0&&(x=s.length,s.push(vt([],Ah))),t[r]=x,g?(c=n[r],p=x):(f=n[r],m=x)}}return s.slice(2)}(U.verticeTypes,U.featureIndexes,t,l,c),X={data:{data:{aVertexColorType:J.length<=252?Qo.createTypedArray(U.verticeTypes,Uint8Array):Qo.createTypedArray(U.verticeTypes,Uint16Array),aPosition:Qo.createTypedArray(U.vertices,G),aNormal:U.normals,aTexCoord0:U.uvs,aTangent:U.tangents,aPickingId:U.pickingIds},indices:R,properties:{maxAltitude:U.maxAltitude},dynamicAttributes:B.dynamicAttributes,vertexColors:J},buffers:N};return U.featureIds.length?(X.data.featureIds=U.featureIds,N.push(X.data.featureIds.buffer)):X.data.featureIds=[],B.aColor&&(X.data.data.aColor=B.aColor,X.buffers.push(B.aColor.buffer)),B.aOpacity&&(X.data.data.aOpacity=B.aOpacity,X.buffers.push(B.aOpacity.buffer)),X.buffers.push(X.data.data.aPosition.buffer),X.data.pickingIdIndiceMap=dh.generatePickingIndiceIndex(X.data.data.aPickingId,X.data.indices),X}const Ah=[];function kh(t,n){for(let e=0;e<t.length;e++)if(xt(n,t[e]))return e;return-1}function Ph(t,n,e,r,{altitudeScale:i,altitudeProperty:s,defaultAltitude:o,heightProperty:a,minHeightProperty:u,defaultHeight:h,bottom:l}){const c=l,f=n/t[0].extent,p=2*function(t,n){let e=0;for(let r=0,i=t.length;r<i;r++){const i=t[r];if(x(i.geometry[0][0])){const t=3*i.geometry.length;e+=n?2*t-6:t}else for(let t=0,r=i.geometry.length;t<r;t++){let r=3*i.geometry[t].length;3===i.type&&(r-=3),e+=n?2*r-6:r}}return e}(t)+3*t.length*2,y=[],m=new Int16Array(p),g=new Uint8Array(m.length/3*4);d(e)&&(e=Bo.compileFilter(e));const v=[];function b(t,e,r){const i=e-t,s=m.subarray(t,e),o=m.subarray(e,e+i);o.set(s);for(let t=2,n=o.length;t<n;t+=3)o[t]=s[t]-r;const a=t/3,u=i/3;let h,l;for(let t=a,e=u+a;t<e;t++)t<e-1?(h=t,l=t+1):(h=t,l=a),at(m,h,l,n)||(v.push(h,l),c&&v.push(h+u,l+u),Sh(m,h,n)||v.push(h,h+u));return e+i}let w=0,M=0;const F="__fea_idx".trim(),A=[];for(let n=0,l=t.length;n<l;n++){const l=t[n],c=l.geometry;if(e){let t;t="function"==typeof e?e(l&&l.properties):e,Ar.normalizeColor(A,t)}else ft(A,255,255,255);const d=w/3*4,{altitude:p,height:x}=dh.getFeaAltitudeAndHeight(l,i,s,o,a,h,u);M=Math.max(Math.abs(p),M);let k=w;for(let t=0,n=c.length;t<n;t++){let n=c[t];const e=n.length;n[0][0]===n[e-1][0]&&n[0][1]===n[e-1][1]&&(n=n.slice(0,e-1)),w=ot(m,k,n,f,p),w=b(k,w,x*f),k=w}const P=k/3*4;for(let t=d;t<P;t+=4)g[t]=A[0],g[t+1]=A[1],g[t+2]=A[2],g[t+3]=255*(r||1);const S=v.length-y.length;for(let t=0;t<S;t++)y.push(l[F])}const k=v.reduce((t,n)=>Math.max(t,n),0),P=new(dh.getIndexArrayType(k))(v),S=dh.getUnsignedArrayType(t.length);return{aPosition:new(dh.getPosArrayType(Math.max(512,M)))(m),indices:P,aPickingId:new S(y),aColor:g}}function Sh(t,n,e){const r=t[3*n],i=t[3*n+1];return r<0||r>e||i<0||i>e}function _h(t,n,e,r){const i=Ph(t,n,e.lineColor,e.lineOpacity,r),s=[i.aPosition.buffer,i.indices.buffer,i.aPickingId.buffer],o=i.indices;return delete i.indices,{data:{data:i,indices:o},buffers:s}}let Oh=!1;try{const t=new OffscreenCanvas(1,1);t.getContext("2d").fillText("hello",0,0),Oh=!0}catch(t){Oh=!1}var Eh=Oh;const Ih="__original_properties",$h="__fn-type_properties";class Ch{constructor(t,n,e,r,i){this.id=t,this.options=n,this.upload=e,this.Ht(n.style),this.requests={},this.Ut=r,this.Wt=0,this.loadings=i}updateStyle(t,n){this.options.style=t,this.Wt=t.styleCounter,this.Ht(t),n()}updateOptions(t,n){this.options=w(this.options,t),n()}loadTile(t,n){const e=this.loadings,r=t.tileInfo.url,i=this.options.debugTile;if(i){const{x:e,y:r,z:s}=t.tileInfo;let o=!1;for(let t=0;t<i.length;t++)if(e===i[t].x&&r===i[t].y&&s===i[t].z){o=!0;break}if(!o)return void n()}if(e[r])return void e[r].push({context:t,callback:n,ref:this});e[r]=[{context:t,callback:n,ref:this}];const s=this.options.featureIdProperty;this.requests[r]=this.getTileFeatures(t,(n,i,o,a)=>{const u=e[r];if(delete e[r],this.checkIfCanceled(r))return delete this.requests[r],void this.qt(u,null,{canceled:!0});if(delete this.requests[r],(this.options.debug||s)&&i)for(let n=0;n<i.length;n++)if(this.options.debug&&(i[n]._debug_info={index:n,id:i[n].id,tileId:t.tileInfo.id}),s){const t=A(s)?s[i[n].layer]:s,e=i[n].properties;i[n].id=e&&e[t]||null}if(n)this.qt(u,n);else if(i&&i.length){if(u)for(let t=0;t<u.length;t++)this.Gt.call(u[t].ref,u[t].context,u[t].callback,r,o,i,a)}else this.qt(u)})}Gt(t,n,e,r,i,s){this.Bt(r,i,t).then(e=>{e.canceled?n(null,{canceled:!0}):(e.data.style=t.styleCounter,s&&w(e.data,s),n(null,e.data,e.buffers))}).catch(t=>{n(t)})}abortTile(t,n){delete this.requests[t],this.Jt(t),n()}Jt(t){const n=this.loadings[t];if(n)for(let t=0;t<n.length;t++)n[t].callback(null,{canceled:!0});delete this.loadings[t]}qt(t,n,e){if(t)for(let r=0;r<t.length;r++)t[r].callback(n,e)}checkIfCanceled(t){return!this.requests[t]}onRemove(){this.loadings={},delete this.Ut,this.requests={}}fetchIconGlyphs(t,n,e){if(this.options.workerGlyph&&Eh){const r=[];if(t&&Object.keys(t).length){const n=new Promise(n=>{this.upload("fetchIconGlyphs",{icons:t},null,(t,e)=>{n({err:t,iconData:e})})});r.push(n)}if(n&&Object.keys(n).length){const t=new Promise(t=>{this.Xt||(this.Xt=new ch),this.Xt.getGlyphs(n,(n,e)=>{t({err:n,glyphData:e})})});r.push(t)}Promise.all(r).then(t=>{const n={icons:null,glyphs:null};for(let r=0;r<t.length;r++){if(t[r].err)return void e(t[r].err);t[r].iconData?n.icons=t[r].iconData.icons:t[r].glyphData&&(n.glyphs=t[r].glyphData.glyphs)}return n}).then(t=>{e(null,t)})}else this.upload("fetchIconGlyphs",{icons:t,glyphs:n},null,e)}Bt(t,n,e){if(!n.length)return Promise.resolve({data:null,buffers:[]});const{glScale:r,tileInfo:i}=e,s=!this.options.style.style.length&&!this.options.style.featureStyle.length;let o=this.pluginConfig.slice(0);s&&(o=this.Yt(t)),this.featurePlugins&&P(o,this.featurePlugins);const a={};for(let t=0;t<o.length;t++)Lh(n,e.tileInfo.z,o[t],a);const u=[],h=[];for(let t=0;t<n.length;t++){const e=n[t],r=a[t];if(r){h.fill(null);let t=0;for(const n in r){let i=0;const s=r[n].values();for(const t of s){let r=h[i];r||(r=Wh(e),h[i]=r),r.properties[n]=t,i++}i>t&&(t=i)}for(let n=0;n<t;n++)u.push(h[n])}else u.push(e)}const l=(n=u)[0].extent,c=i.z,f={x:i.extent2d.xmin*r,y:i.extent2d.ymax*r},d=[],p=[],y=[],m=this.options,g=[],v={},b=[Promise.resolve(e.styleCounter)];let M=0,x=-1;const F=[];let A=!1;for(let t=0;t<o.length;t++){x++;const r=o[t];r.type!==M&&(x=0,M=r.type);const a=0===r.type?d:p;if(r.symbol&&!1===r.symbol.visible){a[x]=null;continue}Bh(r.symbol,F,t),A=A||F[t]&&F[t].size>0;const{tileFeatures:u,tileFeaIndexes:h}=this.Zt(c,r.type,r.filter,n,v,t);if(!u.length){a[x]=null;continue}const m=h[h.length-1],k=dh.getIndexArrayType(m);a[x]={styledFeatures:new k(h)},y.push({idx:t,typeIdx:x}),g.push(a[x].styledFeatures.buffer);const P=w({},e,{extent:l,zoom:c,tilePoint:f});if(this.options.debugTile){const t=this.options.debugTile;for(let n=0;n<t.length;n++){const{x:e,y:r,z:s}=t[n];if(i.x===e&&i.y===r&&i.z===s){P.debugIndex=t[n].index;break}}}let S=this.Kt(u,r,P);s&&(S=S.then(t=>{if(!t)return null;if(t.data)t.data.layer=u[0].layer;else if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]&&t[n].data&&(t[n].data.layer=u[0].layer);return t})),b.push(S)}return Promise.all(b).then(([e,...r])=>{function i(t,n){if(void 0===t.data.ref&&(t.data.type=o[y[n].idx].renderPlugin.dataConfig.type,t.data.filter=o[y[n].idx].filter.def,t.buffers&&t.buffers.length))for(let n=0;n<t.buffers.length;n++)g.push(t.buffers[n])}if(e!==this.Wt)return{canceled:!0};for(let t=0;t<r.length;t++){if(!r[t])continue;const n=r[t],e=0===o[y[t].idx].type?d:p;if(Array.isArray(n)){const r=[];for(let e=0;e<n.length;e++)n[e]&&(i(n[e],t),(void 0===n[e].data.ref||n[n[e].data.ref])&&r.push(n[e].data));r.length&&(e[y[t].typeIdx].data=r)}else i(n,t),e[y[t].typeIdx].data=n.data}const s={},a=t;if(m.features||m.schema||A){let t,e=!1;for(let r=0,i=n.length;r<i;r++)if(t=n[r],a[t.layer].properties||(a[t.layer].properties=Dh(t.properties)),t&&(m.features||A&&v[r]))if("id"===m.features)s[r]=t.id;else{m.pickingGeometry||delete t.geometry,delete t.extent,delete t.properties.$layer,delete t.properties.$type,delete t.__index;const n=t.originalFeature;if(n){const n=t.properties,e=w({},t.originalFeature);delete n[Ih],e.customProps=w({},n),t=e}const i=w({},t);if(!m.features){const i=v[r];for(let r=0;r<i.length;r++){const i=F[r];i&&i.forEach(r=>{const i=n?n.properties:t.properties;i[$h]||(i[$h]=new Set),i[$h].add(r),e=!0})}}s[r]=i}if(e)for(const t in s){const n=s[t];if(n.properties[$h]){const t=n.properties[$h];delete n.properties[$h];for(const e in n.properties)t.has(e)||delete n.properties[e]}}}return{data:{schema:a,data:d,featureData:p,extent:l,features:s},buffers:g}}).catch(t=>{console.error(t)})}Kt(t,n,e){let r=t;const i=n.renderPlugin.dataConfig,s=n.symbol,o=this.options.tileSize,{extent:a,glScale:u,zScale:h,zoom:l,tilePoint:c,centimeterToPoint:f,verticalCentimeterToPoint:d}=e,p=a/o,y=i.type,m=e.debugIndex;let g=w({},i,{EXTENT:a,zoom:l,debugIndex:m,features:this.options.features});if("3d-extrusion"===y){const t=jh(s);t&&(i.uv=1,2===t&&(i.tangent=1));const n=this.options.projectionCode,o=s.material&&s.material.textureWidth||23.25;return Promise.all([Promise.resolve(Fh(r,i,a,c,o,e.tileInfo.res,u,a/this.options.tileSize,f,d,s,l,n,m))])}if("3d-wireframe"===y)return Promise.all([Promise.resolve(_h(r,a,s,i))]);if("point"===y){g=w(g,{requestor:this.fetchIconGlyphs.bind(this),altitudeToTileScale:h*a/this.options.tileSize/u});const t=vu.splitPointSymbol(s),n=oa.genFnTypes(t[0]);return vu.needMerge(t[0],n,l)&&(r=vu.mergeLineFeatures(r,t[0],n,l)),Promise.all(t.map((t,e)=>(0===e?g.fnTypes=n:delete g.fnTypes,new vu(r,t,g).load(p))))}if("native-point"===y){const t=h*a/this.options.tileSize/u;return g.altitudeToTileScale=t,Uh(r,s,g,ju,a/o)}if("line"===y)return g=w(g,{requestor:this.fetchIconGlyphs.bind(this),tileRatio:p}),Uh(r,s,g,ku);if("native-line"===y)return Uh(r,s,g,zu);if("fill"===y)return g=w(g,{requestor:this.fetchIconGlyphs.bind(this)}),Uh(r,s,g,Wu);if("line-extrusion"===y){delete s.lineGradientProperty,s.lineJoin="miter",s.lineCap="butt";const t=jh(s);if(t&&(i.uv=1,2===t&&(i.tangent=1)),g=w(g,{tileSize:o,zScale:h,glScale:u}),t){const t=[];if(!1!==i.top){const n=w({},g);n.side=!1,t.push(new Cu(r,s,n))}return!1!==i.side&&(g.side=!0,g.top=!1,t.push(new Cu(r,s,g))),Promise.all(t.map(t=>t.load()))}return Promise.all([new Cu(r,s,g).load()])}if("circle"===y)return Uh(r,s,g,Gu);if("round-tube"===y||"square-tube"===y){const t="round-tube"===y?Bu:Qu;return g=w(g,{requestor:this.fetchIconGlyphs.bind(this),radialSegments:"round-tube"===y?i.radialSegments||8:4,centimeterToPoint:f,verticalCentimeterToPoint:d,tileRatio:p,isTube:!0}),Uh(r,s,g,t)}return Promise.resolve([])}Zt(t,n,e,r,i,s){const o="__fea_idx".trim(),a=[],u=[],h=r.length;for(let l=0;l<h;l++)if((1===n||void 0===r[l].id||!this.styledFeatures[r[l].id])&&((!e.def||"default"===e.def)&&!i[l]||!0===e.def||e.def&&(void 0!==e.def.condition||Array.isArray(e.def))&&e(r[l],t))){const t=r[l];if(void 0===t[o]&&(t[o]=l),i[l]||(i[l]=[]),i[l].push(s),u.push(t),a.push(l),1===n)break}return{tileFeatures:u,tileFeaIndexes:a}}Ht(t){const{style:n,featureStyle:e}=t,r={};e.forEach(t=>{Array.isArray(t.id)?(t.id.forEach(t=>{r[t]=1}),t.filter=["in","$id",...t.id]):(r[t.id]=1,t.filter=["==","$id",t.id])});const i=Bo.compileStyle(n);for(let t=0;t<n.length;t++)i[t].filter&&(i[t].filter.def=n[t].filter?n[t].filter.value||n[t].filter:void 0),i[t].type=0;const s=[],o=Bo.compileStyle(e);for(let t=0;t<e.length;t++)o[t].type=1,o[t].filter.def=e[t].filter?e[t].filter.value||e[t].filter:void 0,o[t].renderPlugin&&s.push(o[t]);this.pluginConfig=i,this.featurePlugins=s,this.styledFeatures=r}Yt(t){let n=this.Qt;this.Qt||(n=this.Qt={});const e=["","Point","LineString","Polygon","MultiPoint","MultiLineString","MultiPolygon"],r=[];for(const i in t){const s=i;if(!n[i]){const r=[];for(let n=0;n<t[i].types.length;n++){const o=t[i].types[n],a=["all",["==","$layer",s],["==","$type",e[o]]],u={filter:zn(a),renderPlugin:Th(o),symbol:zh(o)};u.filter.def=a,u.type=0,r.push(u)}n[s]=r}r.push(...n[s])}return r}}function Th(t){switch(t){case 1:return{type:"native-point",dataConfig:{type:"native-point",only2D:!0}};case 2:return{type:"native-line",dataConfig:{type:"native-line",only2D:!0}};case 3:return{type:"fill",dataConfig:{type:"fill",only2D:!0}}}return null}function zh(t){switch(t){case 1:return{markerFill:"#f00",markerSize:10};case 2:return{lineColor:"#fff"};case 3:return{polygonFill:"#00f",polygonOpacity:.4}}return null}function Dh(t){if(Array.isArray(t)||!A(t))return{};const n={};for(const e in t){const r=t[e];M(r)?n[e]="string":x(r)?n[e]="number":!0===r||!1===r?n[e]="boolean":Array.isArray(r)?n[e]="array":n[e]="object"}return n}function jh(t){if(!t)return 0;let n=0;for(const e in t){if(("normalTexture"===e||"bumpTexture"===e)&&t[e])return 2;if(e.indexOf("Texture")>0&&t[e])n=1;else if(A(t[e])){const r=jh(t[e]);if(2===r)return r;1===r&&(n=1)}}return n}function Uh(t,n,e,r,i){const s={},o=Array.isArray(n)?n:[n];let a=-1;for(let t=0;t<o.length;t++)s[t]=Nh(o[t]),!s[t]&&o[t]&&-1===a&&(a=t);const u=[];for(let n=0;n<o.length;n++)o[n]&&(o[n].index={index:n},s[n]||n===a?u.push(new r(t,o[n],e).load(i)):u.push({data:{ref:a,symbolIndex:{index:n}}}));return Promise.all(u)}function Nh(t){if(!t)return 0;for(const n in t)if(S(t[n]))return 1;return 0}function Lh(t,n,e,r){const i=e.customProperties;if(!i)return t;if(i)for(let t=0;t<i.length;t++)i[t].fn=Bo.compileFilter(i[t].filter);for(let e=0;e<i.length;e++)for(let s=0,o=t.length;s<o;s++)if(i[e].fn(t[s],n))for(const t in i[e].properties){const n=i[e].properties[t];k(n)||(r[s]||(r[s]={}),r[s][t]||(r[s][t]=new Set),r[s][t].add(n))}}const Vh={get:(t,n)=>n in t?t[n]:t.originalFeature[n],has:(t,n)=>n in t||n in t.originalFeature},Rh={get:function(t,n){return n in t?t[n]:t[Ih][n]},has:(t,n)=>n in t||n in t[Ih]},Hh={};function Wh(t){const n={};n.originalFeature=t;const e=new Proxy(n,Vh);return e.properties=new Proxy({},Rh),e.properties[Ih]=t.properties||Hh,e}function qh(t,n,e){t[n]||(t[n]=new Set),t[n].add(e)}const Gh=[];function Bh(t,n,e){if(!t)return Gh;for(const r in t){if(!t[r]||!Ar.checkIfZoomFnTypeSymbol(r))continue;if(S(t[r]))qh(n,e,t[r].property);else{if("lineGradientProperty"===r){qh(n,e,t[r]);continue}if("textName"===r)if(M(t[r])){const i=pa.resolveVarNames(t[r]);if(i)for(let t=0;t<i.length;t++)qh(n,e,i[t])}else if(Bo.isExpression(t[r])){const i=[];pa.resolveExpVarNames(i,t[r]);for(let t=0;t<i.length;t++)qh(n,e,i[t])}}const i=t[r].stops;if(i&&i.length)for(let t=0;t<i.length;t++)S(i[t][1])&&qh(n,t,i[t][1].property)}return n[e]}function Jh(t,n){Xh(t.geometry,n)}function Xh(t,n){if(t)switch(t.type){case"Point":Yh(t.coordinates,n);break;case"MultiPoint":case"LineString":Zh(t.coordinates,n);break;case"MultiLineString":!function(t,n){for(let e=0,r=t.length;e<r;e++)Zh(t[e],n)}(t.coordinates,n);break;case"Polygon":Kh(t.coordinates,n);break;case"MultiPolygon":!function(t,n){for(let e=0,r=t.length;e<r;e++)Kh(t[e],n)}(t.coordinates,n);break;case"GeometryCollection":const e=t.geometries.length;for(let r=0;r<e;r++)Xh(t.geometries[r],n)}}function Yh(t,n){n[0]=Math.min(n[0],t[0]),n[1]=Math.min(n[1],t[1]),n[2]=Math.max(n[2],t[0]),n[3]=Math.max(n[3],t[1])}function Zh(t,n){for(let e=0,r=t.length;e<r;e++)Yh(t[e],n)}function Kh(t,n){t.length&&Zh(t[0],n)}function Qh(t,n,e,r,i){!function t(n,e,r,i,s){for(;i>r;){if(i-r>600){var o=i-r+1,a=e-r+1,u=Math.log(o),h=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*h*(o-h)/o)*(a-o/2<0?-1:1),c=Math.max(r,Math.floor(e-a*h/o+l)),f=Math.min(i,Math.floor(e+(o-a)*h/o+l));t(n,e,c,f,s)}var d=n[e],p=r,y=i;for(tl(n,r,e),s(n[i],d)>0&&tl(n,r,i);p<y;){for(tl(n,p,y),p++,y--;s(n[p],d)<0;)p++;for(;s(n[y],d)>0;)y--}0===s(n[r],d)?tl(n,r,y):(y++,tl(n,y,i)),y<=e&&(r=y+1),e<=y&&(i=y-1)}}(t,n,e||0,r||t.length-1,i||nl)}function tl(t,n,e){var r=t[n];t[n]=t[e],t[e]=r}function nl(t,n){return t<n?-1:t>n?1:0}class el{constructor(t=9){this.tn=Math.max(4,t),this.nn=Math.max(2,Math.ceil(.4*this.tn)),this.clear()}all(){return this.en(this.data,[])}search(t){let n=this.data;const e=[];if(!pl(t,n))return e;const r=this.toBBox,i=[];for(;n;){for(let s=0;s<n.children.length;s++){const o=n.children[s],a=n.leaf?r(o):o;pl(t,a)&&(n.leaf?e.push(o):dl(t,a)?this.en(o,e):i.push(o))}n=i.pop()}return e}collides(t){let n=this.data;if(!pl(t,n))return!1;const e=[];for(;n;){for(let r=0;r<n.children.length;r++){const i=n.children[r],s=n.leaf?this.toBBox(i):i;if(pl(t,s)){if(n.leaf||dl(t,s))return!0;e.push(i)}}n=e.pop()}return!1}load(t){if(!t||!t.length)return this;if(t.length<this.nn){for(let n=0;n<t.length;n++)this.insert(t[n]);return this}let n=this.rn(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this.sn(this.data,n);else{if(this.data.height<n.height){const t=this.data;this.data=n,n=t}this.an(n,this.data.height-n.height-1,!0)}else this.data=n;return this}insert(t){return t&&this.an(t,this.data.height-1),this}clear(){return this.data=yl([]),this}remove(t,n){if(!t)return this;let e=this.data;const r=this.toBBox(t),i=[],s=[];let o,a,u;for(;e||i.length;){if(e||(e=i.pop(),a=i[i.length-1],o=s.pop(),u=!0),e.leaf){const r=rl(t,e.children,n);if(-1!==r)return e.children.splice(r,1),i.push(e),this.un(i),this}u||e.leaf||!dl(e,r)?a?(o++,e=a.children[o],u=!1):e=null:(i.push(e),s.push(o),o=0,a=e,e=e.children[0])}return this}toBBox(t){return t}compareMinX(t,n){return t.minX-n.minX}compareMinY(t,n){return t.minY-n.minY}toJSON(){return this.data}fromJSON(t){return this.data=t,this}en(t,n){const e=[];for(;t;)t.leaf?n.push(...t.children):e.push(...t.children),t=e.pop();return n}rn(t,n,e,r){const i=e-n+1;let s,o=this.tn;if(i<=o)return s=yl(t.slice(n,e+1)),il(s,this.toBBox),s;r||(r=Math.ceil(Math.log(i)/Math.log(o)),o=Math.ceil(i/Math.pow(o,r-1))),s=yl([]),s.leaf=!1,s.height=r;const a=Math.ceil(i/o),u=a*Math.ceil(Math.sqrt(o));ml(t,n,e,u,this.compareMinX);for(let i=n;i<=e;i+=u){const n=Math.min(i+u-1,e);ml(t,i,n,a,this.compareMinY);for(let e=i;e<=n;e+=a){const i=Math.min(e+a-1,n);s.children.push(this.rn(t,e,i,r-1))}}return il(s,this.toBBox),s}hn(t,n,e,r){for(;r.push(n),!n.leaf&&r.length-1!==e;){let e,r=1/0,i=1/0;for(let s=0;s<n.children.length;s++){const o=n.children[s],a=hl(o),u=cl(t,o)-a;u<i?(i=u,r=a<r?a:r,e=o):u===i&&a<r&&(r=a,e=o)}n=e||n.children[0]}return n}an(t,n,e){const r=e?t:this.toBBox(t),i=[],s=this.hn(r,this.data,n,i);for(s.children.push(t),ol(s,r);n>=0&&i[n].children.length>this.tn;)this.cn(i,n),n--;this.dn(r,i,n)}cn(t,n){const e=t[n],r=e.children.length,i=this.nn;this.pn(e,i,r);const s=this.yn(e,i,r),o=yl(e.children.splice(s,e.children.length-s));o.height=e.height,o.leaf=e.leaf,il(e,this.toBBox),il(o,this.toBBox),n?t[n-1].children.push(o):this.sn(e,o)}sn(t,n){this.data=yl([t,n]),this.data.height=t.height+1,this.data.leaf=!1,il(this.data,this.toBBox)}yn(t,n,e){let r,i=1/0,s=1/0;for(let o=n;o<=e-n;o++){const n=sl(t,0,o,this.toBBox),a=sl(t,o,e,this.toBBox),u=fl(n,a),h=hl(n)+hl(a);u<i?(i=u,r=o,s=h<s?h:s):u===i&&h<s&&(s=h,r=o)}return r||e-n}pn(t,n,e){const r=t.leaf?this.compareMinX:al,i=t.leaf?this.compareMinY:ul;this.mn(t,n,e,r)<this.mn(t,n,e,i)&&t.children.sort(r)}mn(t,n,e,r){t.children.sort(r);const i=this.toBBox,s=sl(t,0,n,i),o=sl(t,e-n,e,i);let a=ll(s)+ll(o);for(let r=n;r<e-n;r++){const n=t.children[r];ol(s,t.leaf?i(n):n),a+=ll(s)}for(let r=e-n-1;r>=n;r--){const n=t.children[r];ol(o,t.leaf?i(n):n),a+=ll(o)}return a}dn(t,n,e){for(let r=e;r>=0;r--)ol(n[r],t)}un(t){for(let n,e=t.length-1;e>=0;e--)0===t[e].children.length?e>0?(n=t[e-1].children,n.splice(n.indexOf(t[e]),1)):this.clear():il(t[e],this.toBBox)}}function rl(t,n,e){if(!e)return n.indexOf(t);for(let r=0;r<n.length;r++)if(e(t,n[r]))return r;return-1}function il(t,n){sl(t,0,t.children.length,n,t)}function sl(t,n,e,r,i){i||(i=yl(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(let s=n;s<e;s++){const n=t.children[s];ol(i,t.leaf?r(n):n)}return i}function ol(t,n){return t.minX=Math.min(t.minX,n.minX),t.minY=Math.min(t.minY,n.minY),t.maxX=Math.max(t.maxX,n.maxX),t.maxY=Math.max(t.maxY,n.maxY),t}function al(t,n){return t.minX-n.minX}function ul(t,n){return t.minY-n.minY}function hl(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function ll(t){return t.maxX-t.minX+(t.maxY-t.minY)}function cl(t,n){return(Math.max(n.maxX,t.maxX)-Math.min(n.minX,t.minX))*(Math.max(n.maxY,t.maxY)-Math.min(n.minY,t.minY))}function fl(t,n){const e=Math.max(t.minX,n.minX),r=Math.max(t.minY,n.minY),i=Math.min(t.maxX,n.maxX),s=Math.min(t.maxY,n.maxY);return Math.max(0,i-e)*Math.max(0,s-r)}function dl(t,n){return t.minX<=n.minX&&t.minY<=n.minY&&n.maxX<=t.maxX&&n.maxY<=t.maxY}function pl(t,n){return n.minX<=t.maxX&&n.minY<=t.maxY&&n.maxX>=t.minX&&n.maxY>=t.minY}function yl(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function ml(t,n,e,r,i){const s=[n,e];for(;s.length;){if((e=s.pop())-(n=s.pop())<=r)continue;const o=n+Math.ceil((e-n)/r/2)*r;Qh(t,o,n,e,i),s.push(n,o,o,e)}}var gl={exports:{}},vl=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=(r-e)/2,u=0,h=a-1;u<a;h=u++){var l=n[e+2*u+0],c=n[e+2*u+1],f=n[e+2*h+0],d=n[e+2*h+1];c>s!=d>s&&i<(f-l)*(s-c)/(d-c)+l&&(o=!o)}return o},bl=function(t,n,e,r){var i=t[0],s=t[1],o=!1;void 0===e&&(e=0),void 0===r&&(r=n.length);for(var a=r-e,u=0,h=a-1;u<a;h=u++){var l=n[u+e][0],c=n[u+e][1],f=n[h+e][0],d=n[h+e][1];c>s!=d>s&&i<(f-l)*(s-c)/(d-c)+l&&(o=!o)}return o};gl.exports=function(t,n,e,r){return n.length>0&&Array.isArray(n[0])?bl(t,n,e,r):vl(t,n,e,r)};var wl=gl.exports.nested=bl;gl.exports.flat=vl;function Ml(t,n,e,r,i){let s,o,a,u,h=n[0],l=r[0],c=0,f=0;l>h==l>-h?(s=h,h=n[++c]):(s=l,l=r[++f]);let d=0;if(c<t&&f<e)for(l>h==l>-h?(o=h+s,a=s-(o-h),h=n[++c]):(o=l+s,a=s-(o-l),l=r[++f]),s=o,0!==a&&(i[d++]=a);c<t&&f<e;)l>h==l>-h?(o=s+h,u=o-s,a=s-(o-u)+(h-u),h=n[++c]):(o=s+l,u=o-s,a=s-(o-u)+(l-u),l=r[++f]),s=o,0!==a&&(i[d++]=a);for(;c<t;)o=s+h,u=o-s,a=s-(o-u)+(h-u),h=n[++c],s=o,0!==a&&(i[d++]=a);for(;f<e;)o=s+l,u=o-s,a=s-(o-u)+(l-u),l=r[++f],s=o,0!==a&&(i[d++]=a);return 0===s&&0!==d||(i[d++]=s),d}function xl(t){return new Float64Array(t)}const Fl=xl(4),Al=xl(8),kl=xl(12),Pl=xl(16),Sl=xl(4);function _l(t,n,e,r,i,s){const o=(n-s)*(e-i),a=(t-i)*(r-s),u=o-a;if(0===o||0===a||o>0!=a>0)return u;const h=Math.abs(o+a);return Math.abs(u)>=33306690738754716e-32*h?u:-function(t,n,e,r,i,s,o){let a,u,h,l,c,f,d,p,y,m,g,v,b,w,M,x,F,A;const k=t-i,P=e-i,S=n-s,_=r-s;w=k*_,f=134217729*k,d=f-(f-k),p=k-d,f=134217729*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=S*P,f=134217729*S,d=f-(f-S),p=S-d,f=134217729*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Fl[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Fl[1]=b-(g+c)+(c-x),A=v+g,c=A-v,Fl[2]=v-(A-c)+(g-c),Fl[3]=A;let O=function(t,n){let e=n[0];for(let r=1;r<t;r++)e+=n[r];return e}(4,Fl),E=22204460492503146e-32*o;if(O>=E||-O>=E)return O;if(c=t-k,a=t-(k+c)+(c-i),c=e-P,h=e-(P+c)+(c-i),c=n-S,u=n-(S+c)+(c-s),c=r-_,l=r-(_+c)+(c-s),0===a&&0===u&&0===h&&0===l)return O;if(E=11093356479670487e-47*o+33306690738754706e-32*Math.abs(O),O+=k*l+_*a-(S*h+P*u),O>=E||-O>=E)return O;w=a*_,f=134217729*a,d=f-(f-a),p=a-d,f=134217729*_,y=f-(f-_),m=_-y,M=p*m-(w-d*y-p*y-d*m),x=u*P,f=134217729*u,d=f-(f-u),p=u-d,f=134217729*P,y=f-(f-P),m=P-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Sl[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Sl[1]=b-(g+c)+(c-x),A=v+g,c=A-v,Sl[2]=v-(A-c)+(g-c),Sl[3]=A;const I=Ml(4,Fl,4,Sl,Al);w=k*l,f=134217729*k,d=f-(f-k),p=k-d,f=134217729*l,y=f-(f-l),m=l-y,M=p*m-(w-d*y-p*y-d*m),x=S*h,f=134217729*S,d=f-(f-S),p=S-d,f=134217729*h,y=f-(f-h),m=h-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Sl[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Sl[1]=b-(g+c)+(c-x),A=v+g,c=A-v,Sl[2]=v-(A-c)+(g-c),Sl[3]=A;const $=Ml(I,Al,4,Sl,kl);w=a*l,f=134217729*a,d=f-(f-a),p=a-d,f=134217729*l,y=f-(f-l),m=l-y,M=p*m-(w-d*y-p*y-d*m),x=u*h,f=134217729*u,d=f-(f-u),p=u-d,f=134217729*h,y=f-(f-h),m=h-y,F=p*m-(x-d*y-p*y-d*m),g=M-F,c=M-g,Sl[0]=M-(g+c)+(c-F),v=w+g,c=v-w,b=w-(v-c)+(g-c),g=b-x,c=b-g,Sl[1]=b-(g+c)+(c-x),A=v+g,c=A-v,Sl[2]=v-(A-c)+(g-c),Sl[3]=A;const C=Ml($,kl,4,Sl,Pl);return Pl[C-1]}(t,n,e,r,i,s,h)}function Ol(t,n,e){n=Math.max(0,void 0===n?2:n),e=e||0;var r=function(t){for(var n=t[0],e=t[0],r=t[0],i=t[0],s=0;s<t.length;s++){var o=t[s];o[0]<n[0]&&(n=o),o[0]>r[0]&&(r=o),o[1]<e[1]&&(e=o),o[1]>i[1]&&(i=o)}var a=[n,e,r,i],u=a.slice();for(s=0;s<t.length;s++)wl(t[s],a)||u.push(t[s]);return function(t){t.sort(Vl);for(var n=[],e=0;e<t.length;e++){for(;n.length>=2&&zl(n[n.length-2],n[n.length-1],t[e])<=0;)n.pop();n.push(t[e])}for(var r=[],i=t.length-1;i>=0;i--){for(;r.length>=2&&zl(r[r.length-2],r[r.length-1],t[i])<=0;)r.pop();r.push(t[i])}return r.pop(),n.pop(),n.concat(r)}(u)}(t),i=new el(16);i.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},i.compareMinX=function(t,n){return t[0]-n[0]},i.compareMinY=function(t,n){return t[1]-n[1]},i.load(t);for(var s,o=[],a=0;a<r.length;a++){var u=r[a];i.remove(u),s=jl(u,s),o.push(s)}var h=new el(16);for(a=0;a<o.length;a++)h.insert(Dl(o[a]));for(var l=n*n,c=e*e;o.length;){var f=o.shift(),d=f.p,p=f.next.p,y=Ul(d,p);if(!(y<c)){var m=y/l;(u=El(i,f.prev.p,d,p,f.next.next.p,m,h))&&Math.min(Ul(u,d),Ul(u,p))<=m&&(o.push(f),o.push(jl(u,f)),i.remove(u),h.remove(f),h.insert(Dl(f)),h.insert(Dl(f.next)))}}f=s;var g=[];do{g.push(f.p),f=f.next}while(f!==s);return g.push(f.p),g}function El(t,n,e,r,i,s,o){for(var a=new Bn([],Il),u=t.data;u;){for(var h=0;h<u.children.length;h++){var l=u.children[h],c=u.leaf?Nl(l,e,r):$l(e,r,l);c>s||a.push({node:l,dist:c})}for(;a.length&&!a.peek().node.children;){var f=a.pop(),d=f.node,p=Nl(d,n,e),y=Nl(d,r,i);if(f.dist<p&&f.dist<y&&Tl(e,d,o)&&Tl(r,d,o))return d}(u=a.pop())&&(u=u.node)}return null}function Il(t,n){return t.dist-n.dist}function $l(t,n,e){if(Cl(t,e)||Cl(n,e))return 0;var r=Ll(t[0],t[1],n[0],n[1],e.minX,e.minY,e.maxX,e.minY);if(0===r)return 0;var i=Ll(t[0],t[1],n[0],n[1],e.minX,e.minY,e.minX,e.maxY);if(0===i)return 0;var s=Ll(t[0],t[1],n[0],n[1],e.maxX,e.minY,e.maxX,e.maxY);if(0===s)return 0;var o=Ll(t[0],t[1],n[0],n[1],e.minX,e.maxY,e.maxX,e.maxY);return 0===o?0:Math.min(r,i,s,o)}function Cl(t,n){return t[0]>=n.minX&&t[0]<=n.maxX&&t[1]>=n.minY&&t[1]<=n.maxY}function Tl(t,n,e){for(var r,i,s,o,a=Math.min(t[0],n[0]),u=Math.min(t[1],n[1]),h=Math.max(t[0],n[0]),l=Math.max(t[1],n[1]),c=e.search({minX:a,minY:u,maxX:h,maxY:l}),f=0;f<c.length;f++)if(r=c[f].p,i=c[f].next.p,s=t,r!==(o=n)&&i!==s&&zl(r,i,s)>0!=zl(r,i,o)>0&&zl(s,o,r)>0!=zl(s,o,i)>0)return!1;return!0}function zl(t,n,e){return _l(t[0],t[1],n[0],n[1],e[0],e[1])}function Dl(t){var n=t.p,e=t.next.p;return t.minX=Math.min(n[0],e[0]),t.minY=Math.min(n[1],e[1]),t.maxX=Math.max(n[0],e[0]),t.maxY=Math.max(n[1],e[1]),t}function jl(t,n){var e={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return n?(e.next=n.next,e.prev=n,n.next.prev=e,n.next=e):(e.prev=e,e.next=e),e}function Ul(t,n){var e=t[0]-n[0],r=t[1]-n[1];return e*e+r*r}function Nl(t,n,e){var r=n[0],i=n[1],s=e[0]-r,o=e[1]-i;if(0!==s||0!==o){var a=((t[0]-r)*s+(t[1]-i)*o)/(s*s+o*o);a>1?(r=e[0],i=e[1]):a>0&&(r+=s*a,i+=o*a)}return(s=t[0]-r)*s+(o=t[1]-i)*o}function Ll(t,n,e,r,i,s,o,a){var u,h,l,c,f=e-t,d=r-n,p=o-i,y=a-s,m=t-i,g=n-s,v=f*f+d*d,b=f*p+d*y,w=p*p+y*y,M=f*m+d*g,x=p*m+y*g,F=v*w-b*b,A=F,k=F;0===F?(h=0,A=1,c=x,k=w):(c=v*x-b*M,(h=b*x-w*M)<0?(h=0,c=x,k=w):h>A&&(h=A,c=x+b,k=w)),c<0?(c=0,-M<0?h=0:-M>v?h=A:(h=-M,A=v)):c>k&&(c=k,-M+b<0?h=0:-M+b>v?h=A:(h=-M+b,A=v));var P=(1-(l=0===c?0:c/k))*i+l*o-((1-(u=0===h?0:h/A))*t+u*e),S=(1-l)*s+l*a-((1-u)*n+u*r);return P*P+S*S}function Vl(t,n){return t[0]===n[0]?t[1]-n[1]:t[0]-n[0]}class Rl{constructor(t,n){this.x=t,this.y=n}clone(){return new Rl(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new Rl(this.x-t.x,this.y-t.y)}distance(t){const n=this.x-t.x,e=this.y-t.y;return Math.sqrt(n*n+e*e)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new Rl(this.y,-this.x)}}function Hl(t,n,e,r){const i=n.x*r.y-n.y*r.x,s=e.x-t.x,o=e.y-t.y,a=(s*r.y-o*r.x)/i;return new Rl(t.x+a*n.x,t.y+a*n.y)}const Wl=[],ql=[];function Gl(t){if(x(t[0]&&t[0].x)){const n=[];let e=0;for(let r=0;r<t.length;r++)ql[e]?(ql[e][0]=t[r].x,ql[e][1]=t[r].y):ql[e]=[t[r].x,t[r].y],n.push(ql[e]),e++;t=n}try{const n=Ol(t,1/0);let e=[1/0,1/0],r=[-1/0,-1/0];for(let t=0;t<n.length;t++)n[t][0]<e[0]&&(e[0]=n[t][0]),n[t][0]>r[0]&&(r[0]=n[t][0]),n[t][1]<e[1]&&(e[1]=n[t][1]),n[t][1]>r[1]&&(r[1]=n[t][1]);const i=[];let s=[],o=0;for(let t=0;t<n.length;t++)t===n.length-1&&n[t][0]===n[0][0]&&n[t][1]===n[0][1]||(Ct(i,n[t],"EPSG:3857"),Wl[o]?(Wl[o].x=i[0],Wl[o].y=i[1]):Wl[o]=new Rl(i[0],i[1]),s.push(Wl[o]),o++);dh.calculateSignedArea(s)<0&&(s=s.reverse());const a=function(t){let n,e=Number.MAX_VALUE;const r=function(t,r,i,s,o,a,u,h){var l=Hl(t,r,o,a),c=Hl(i,s,o,a),f=Hl(u,h,t,r),d=Hl(u,h,i,s),p=l.distance(c)*l.distance(f);0!==p&&p<e&&(n=[l,f,d,c],e=p)};var i=[];for(let n=0;n<t.length;n++)i.push(t[(n+1)%t.length].diff(t[n])),i[n].normalize();var s,o,a,u,h=new Rl(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),l=new Rl(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let n=0;n<t.length;n++){var c=t[n];c.x<h.x&&(h.x=c.x,s=n),c.x>l.x&&(l.x=c.x,o=n),c.y<h.y&&(h.y=c.y,u=n),c.y>l.y&&(l.y=c.y,a=n)}var f=new Rl(0,-1),d=new Rl(0,1),p=new Rl(-1,0),y=new Rl(1,0);for(let n=0;n<t.length;n++){var m=[Math.acos(f.dot(i[s])),Math.acos(d.dot(i[o])),Math.acos(p.dot(i[a])),Math.acos(y.dot(i[u]))];switch(m.indexOf(Math.min.apply(Math,m))){case 0:(d=(f=i[s].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),s=(s+1)%t.length;break;case 1:(f=(d=i[o].clone()).clone()).negate(),(y=(p=f.orthogonal()).clone()).negate(),o=(o+1)%t.length;break;case 2:(y=(p=i[a].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),a=(a+1)%t.length;break;case 3:(p=(y=i[u].clone()).clone()).negate(),(d=(f=y.orthogonal()).clone()).negate(),u=(u+1)%t.length}r(t[s],f,t[o],d,t[a],p,t[u],y)}return n}(s);if(!a||4!==a.length)return null;const u=a[0].distance(a[1]),h=a[1].distance(a[2]),l=a.map(t=>[t.x,t.y]);return l.push(+(h>u)),l}catch(t){return null}}const Bl=[];function Jl(t,n){const e=Array.isArray(t&&t[0]&&t[0][0]);for(let r=0;r<t.length;r++)e?t[r]=Jl(t[r]):(Ct(Bl,t[r],n),t[r][0]=Bl[0],t[r][1]=Bl[1]);return t}class Xl extends Ch{constructor(t,n,e,r,i,s){super(t,n,e,r,i),(n=n||{}).extent||(n.extent=8192),this.zoomOffset=0,n.tileSize&&(this.zoomOffset=-function(t){if(Math.log2)return Math.log2(t);const n=Math.log(t)*Math.LOG2E,e=Math.round(n);return Math.abs(e-n)<1e-14?e:n}(n.tileSize/256)),this.setData(n.data,s)}setData(t,n){if(delete this.index,!t)return void n();const e={maxZoom:24,tolerance:this.options.simplifyTolerance,extent:this.options.extent,buffer:x(this.options.tileBuffer)?this.options.tileBuffer:64,hasAltitude:!!this.options.hasAltitude,debug:0,lineMetrics:!0,indexMaxZoom:5,indexMaxPoints:1e5,disableFilter:!0};if(this.options.projection&&(e.projection=this.options.projection,"EPSG:4490"===e.projection&&(e.projection="EPSG:4326")),M(t)&&"{"!=t.substring(0,1)||t.url){const r=t.url?t.url:t;O.getJSON(r,t.url?t:{},(t,i)=>{if(t&&(console.error("Failed to fetch geojson:"+r),n(t)),!i)return void n(null,{extent:null,idMap:{}});let s=i;if(this.options.convertFn){s=new Function("data",this.options.convertFn+"\\nreturn convert(data)")(s)}const o=Array.isArray(s)?s:s.features;this.gn(o);const{first1000:a,idMap:u}=this.vn(o);this.bn(a,u,s,e,n)})}else{"string"==typeof t&&(t=JSON.parse(t));const r=Array.isArray(t)?t:t.features;this.gn(r);let i=r;r&&r.length>1e3&&(i=r.slice(0,1e3)),this.bn(i,null,t,e,n)}}gn(t){if(this.options.generateOMBB&&t)for(let n=0;n<t.length;n++){const e=t[n];if(e&&e.geometry&&e.geometry.coordinates)if("Polygon"===e.geometry.type){const t=e.geometry.coordinates[0];if(!t)continue;const n=Gl(t,t.length);e.properties=e.properties||{},e.properties[vh]=n}else if("MultiPolygon"===e.geometry.type){const t=e.geometry.coordinates;for(let n=0;n<t.length;n++){if(!t[n])continue;const r=t[n][0];if(!r)continue;const i=Gl(r,r.length);e.properties=e.properties||{},e.properties[vh]=e.properties[vh]||[],e.properties[vh][n]=i}}}}bn(t,n,e,r,i){try{const s=t&&t.length?function(t){let n=[Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY,Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY];switch(t.type){case"FeatureCollection":const e=t.features.length;for(let r=0;r<e;r++)Jh(t.features[r],n);break;case"Feature":Jh(t,n);break;default:Xh(t,n)}return n}({type:"FeatureCollection",features:t}):null;this.index=function(t,n){return new it(t,n)}(e,this.options.geojsonvt||r),i(null,{extent:s,idMap:n})}catch(t){console.warn(t),i({error:t.message})}}vn(t){const n=[],e={};let r=0;const i=this.options.featureIdProperty;return t&&t.forEach(t=>{!function(t){if(t&&("Feature"!==t.type||t.geometry)){if(x(t.id)||(t.id=r++),i){let n=i;A(i)&&(n=i[t.layer||"0"]),t.id=t.properties[n]}e[t.id]=w({},t),t.geometry?(e[t.id].geometry=w({},t.geometry),e[t.id].geometry.coordinates=null):t.coordinates&&(e[t.id].coordinates=null),n.length<1e3&&n.push(t)}}(t)}),{first1000:n,idMap:e}}getTileFeatures(t,n){const e=t.tileInfo,r=[];if(!this.index)return setTimeout((function(){n({loading:!0})}),1),1;const i=this.index.getTile(e.z+this.zoomOffset,e.x,e.y);if(!i||0===i.features.length)return setTimeout((function(){n(null,r,[])}),1),1;const s=[];for(let t=0,n=i.features.length;t<n;t++){const n=i.features[t];let e=n.layer;void 0===e&&(e="0"),s[e]={types:{}};s[e].types[n.type]=1,n.tags=n.tags||{},n.geometry.converted||(dh.convertGeometry(n),n.geometry.converted=1),r.push({type:n.type,layer:e,id:n.id,geometry:n.geometry,properties:n.tags,extent:this.options.extent})}for(const t in s)s[t].types=Object.keys(s[t].types).map(t=>+t);return setTimeout((function(){n(null,r,s)}),1),1}onRemove(){super.onRemove(),delete this.index}}var Yl={\n/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */\nread:function(t,n,e,r,i){var s,o,a=8*i-r-1,u=(1<<a)-1,h=u>>1,l=-7,c=e?i-1:0,f=e?-1:1,d=t[n+c];for(c+=f,s=d&(1<<-l)-1,d>>=-l,l+=a;l>0;s=256*s+t[n+c],c+=f,l-=8);for(o=s&(1<<-l)-1,s>>=-l,l+=r;l>0;o=256*o+t[n+c],c+=f,l-=8);if(0===s)s=1-h;else{if(s===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),s-=h}return(d?-1:1)*o*Math.pow(2,s-r)},write:function(t,n,e,r,i,s){var o,a,u,h=8*s-i-1,l=(1<<h)-1,c=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:s-1,p=r?1:-1,y=n<0||0===n&&1/n<0?1:0;for(n=Math.abs(n),isNaN(n)||n===1/0?(a=isNaN(n)?1:0,o=l):(o=Math.floor(Math.log(n)/Math.LN2),n*(u=Math.pow(2,-o))<1&&(o--,u*=2),(n+=o+c>=1?f/u:f*Math.pow(2,1-c))*u>=2&&(o++,u/=2),o+c>=l?(a=0,o=l):o+c>=1?(a=(n*u-1)*Math.pow(2,i),o+=c):(a=n*Math.pow(2,c-1)*Math.pow(2,i),o=0));i>=8;t[e+d]=255&a,d+=p,a/=256,i-=8);for(o=o<<i|a,h+=i;h>0;t[e+d]=255&o,d+=p,o/=256,h-=8);t[e+d-p]|=128*y}},Zl=Ql,Kl=Yl;function Ql(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ql.Varint=0,Ql.Fixed64=1,Ql.Bytes=2,Ql.Fixed32=5;var tc="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function nc(t){return t.type===Ql.Bytes?t.readVarint()+t.pos:t.pos+1}function ec(t,n,e){return e?4294967296*n+(t>>>0):4294967296*(n>>>0)+(t>>>0)}function rc(t,n,e){var r=n<=16383?1:n<=2097151?2:n<=268435455?3:Math.floor(Math.log(n)/(7*Math.LN2));e.realloc(r);for(var i=e.pos-1;i>=t;i--)e.buf[i+r]=e.buf[i]}function ic(t,n){for(var e=0;e<t.length;e++)n.writeVarint(t[e])}function sc(t,n){for(var e=0;e<t.length;e++)n.writeSVarint(t[e])}function oc(t,n){for(var e=0;e<t.length;e++)n.writeFloat(t[e])}function ac(t,n){for(var e=0;e<t.length;e++)n.writeDouble(t[e])}function uc(t,n){for(var e=0;e<t.length;e++)n.writeBoolean(t[e])}function hc(t,n){for(var e=0;e<t.length;e++)n.writeFixed32(t[e])}function lc(t,n){for(var e=0;e<t.length;e++)n.writeSFixed32(t[e])}function cc(t,n){for(var e=0;e<t.length;e++)n.writeFixed64(t[e])}function fc(t,n){for(var e=0;e<t.length;e++)n.writeSFixed64(t[e])}function dc(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+16777216*t[n+3]}function pc(t,n,e){t[e]=n,t[e+1]=n>>>8,t[e+2]=n>>>16,t[e+3]=n>>>24}function yc(t,n){return(t[n]|t[n+1]<<8|t[n+2]<<16)+(t[n+3]<<24)}Ql.prototype={destroy:function(){this.buf=null},readFields:function(t,n,e){for(e=e||this.length;this.pos<e;){var r=this.readVarint(),i=r>>3,s=this.pos;this.type=7&r,t(i,n,this),this.pos===s&&this.skip(r)}return n},readMessage:function(t,n){return this.readFields(t,n,this.readVarint()+this.pos)},readFixed32:function(){var t=dc(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=yc(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=dc(this.buf,this.pos)+4294967296*dc(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=dc(this.buf,this.pos)+4294967296*yc(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Kl.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Kl.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var n,e,r=this.buf;return n=127&(e=r[this.pos++]),e<128?n:(n|=(127&(e=r[this.pos++]))<<7,e<128?n:(n|=(127&(e=r[this.pos++]))<<14,e<128?n:(n|=(127&(e=r[this.pos++]))<<21,e<128?n:function(t,n,e){var r,i,s=e.buf;if(i=s[e.pos++],r=(112&i)>>4,i<128)return ec(t,r,n);if(i=s[e.pos++],r|=(127&i)<<3,i<128)return ec(t,r,n);if(i=s[e.pos++],r|=(127&i)<<10,i<128)return ec(t,r,n);if(i=s[e.pos++],r|=(127&i)<<17,i<128)return ec(t,r,n);if(i=s[e.pos++],r|=(127&i)<<24,i<128)return ec(t,r,n);if(i=s[e.pos++],r|=(1&i)<<31,i<128)return ec(t,r,n);throw new Error("Expected varint not more than 10 bytes")}(n|=(15&(e=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,n=this.pos;return this.pos=t,t-n>=12&&tc?function(t,n,e){return tc.decode(t.subarray(n,e))}(this.buf,n,t):function(t,n,e){var r="",i=n;for(;i<e;){var s,o,a,u=t[i],h=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>e)break;1===l?u<128&&(h=u):2===l?128==(192&(s=t[i+1]))&&(h=(31&u)<<6|63&s)<=127&&(h=null):3===l?(s=t[i+1],o=t[i+2],128==(192&s)&&128==(192&o)&&((h=(15&u)<<12|(63&s)<<6|63&o)<=2047||h>=55296&&h<=57343)&&(h=null)):4===l&&(s=t[i+1],o=t[i+2],a=t[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&((h=(15&u)<<18|(63&s)<<12|(63&o)<<6|63&a)<=65535||h>=1114112)&&(h=null)),null===h?(h=65533,l=1):h>65535&&(h-=65536,r+=String.fromCharCode(h>>>10&1023|55296),h=56320|1023&h),r+=String.fromCharCode(h),i+=l}return r}(this.buf,n,t)},readBytes:function(){var t=this.readVarint()+this.pos,n=this.buf.subarray(this.pos,t);return this.pos=t,n},readPackedVarint:function(t,n){if(this.type!==Ql.Bytes)return t.push(this.readVarint(n));var e=nc(this);for(t=t||[];this.pos<e;)t.push(this.readVarint(n));return t},readPackedSVarint:function(t){if(this.type!==Ql.Bytes)return t.push(this.readSVarint());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ql.Bytes)return t.push(this.readBoolean());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ql.Bytes)return t.push(this.readFloat());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ql.Bytes)return t.push(this.readDouble());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ql.Bytes)return t.push(this.readFixed32());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ql.Bytes)return t.push(this.readSFixed32());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ql.Bytes)return t.push(this.readFixed64());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ql.Bytes)return t.push(this.readSFixed64());var n=nc(this);for(t=t||[];this.pos<n;)t.push(this.readSFixed64());return t},skip:function(t){var n=7&t;if(n===Ql.Varint)for(;this.buf[this.pos++]>127;);else if(n===Ql.Bytes)this.pos=this.readVarint()+this.pos;else if(n===Ql.Fixed32)this.pos+=4;else{if(n!==Ql.Fixed64)throw new Error("Unimplemented type: "+n);this.pos+=8}},writeTag:function(t,n){this.writeVarint(t<<3|n)},realloc:function(t){for(var n=this.length||16;n<this.pos+t;)n*=2;if(n!==this.length){var e=new Uint8Array(n);e.set(this.buf),this.buf=e,this.length=n}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pc(this.buf,-1&t,this.pos),pc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pc(this.buf,-1&t,this.pos),pc(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,n){var e,r;t>=0?(e=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(e=~(-t%4294967296))?e=e+1|0:(e=0,r=r+1|0));if(t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn\'t fit into 10 bytes");n.realloc(10),function(t,n,e){e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos++]=127&t|128,t>>>=7,e.buf[e.pos]=127&t}(e,0,n),function(t,n){var e=(7&t)<<4;if(n.buf[n.pos++]|=e|((t>>>=3)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;if(n.buf[n.pos++]=127&t|((t>>>=7)?128:0),!t)return;n.buf[n.pos++]=127&t}(r,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var n=this.pos;this.pos=function(t,n,e){for(var r,i,s=0;s<n.length;s++){if((r=n.charCodeAt(s))>55295&&r<57344){if(!i){r>56319||s+1===n.length?(t[e++]=239,t[e++]=191,t[e++]=189):i=r;continue}if(r<56320){t[e++]=239,t[e++]=191,t[e++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[e++]=239,t[e++]=191,t[e++]=189,i=null);r<128?t[e++]=r:(r<2048?t[e++]=r>>6|192:(r<65536?t[e++]=r>>12|224:(t[e++]=r>>18|240,t[e++]=r>>12&63|128),t[e++]=r>>6&63|128),t[e++]=63&r|128)}return e}(this.buf,t,this.pos);var e=this.pos-n;e>=128&&rc(n,e,this),this.pos=n-1,this.writeVarint(e),this.pos+=e},writeFloat:function(t){this.realloc(4),Kl.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Kl.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var n=t.length;this.writeVarint(n),this.realloc(n);for(var e=0;e<n;e++)this.buf[this.pos++]=t[e]},writeRawMessage:function(t,n){this.pos++;var e=this.pos;t(n,this);var r=this.pos-e;r>=128&&rc(e,r,this),this.pos=e-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,n,e){this.writeTag(t,Ql.Bytes),this.writeRawMessage(n,e)},writePackedVarint:function(t,n){n.length&&this.writeMessage(t,ic,n)},writePackedSVarint:function(t,n){n.length&&this.writeMessage(t,sc,n)},writePackedBoolean:function(t,n){n.length&&this.writeMessage(t,uc,n)},writePackedFloat:function(t,n){n.length&&this.writeMessage(t,oc,n)},writePackedDouble:function(t,n){n.length&&this.writeMessage(t,ac,n)},writePackedFixed32:function(t,n){n.length&&this.writeMessage(t,hc,n)},writePackedSFixed32:function(t,n){n.length&&this.writeMessage(t,lc,n)},writePackedFixed64:function(t,n){n.length&&this.writeMessage(t,cc,n)},writePackedSFixed64:function(t,n){n.length&&this.writeMessage(t,fc,n)},writeBytesField:function(t,n){this.writeTag(t,Ql.Bytes),this.writeBytes(n)},writeFixed32Field:function(t,n){this.writeTag(t,Ql.Fixed32),this.writeFixed32(n)},writeSFixed32Field:function(t,n){this.writeTag(t,Ql.Fixed32),this.writeSFixed32(n)},writeFixed64Field:function(t,n){this.writeTag(t,Ql.Fixed64),this.writeFixed64(n)},writeSFixed64Field:function(t,n){this.writeTag(t,Ql.Fixed64),this.writeSFixed64(n)},writeVarintField:function(t,n){this.writeTag(t,Ql.Varint),this.writeVarint(n)},writeSVarintField:function(t,n){this.writeTag(t,Ql.Varint),this.writeSVarint(n)},writeStringField:function(t,n){this.writeTag(t,Ql.Bytes),this.writeString(n)},writeFloatField:function(t,n){this.writeTag(t,Ql.Fixed32),this.writeFloat(n)},writeDoubleField:function(t,n){this.writeTag(t,Ql.Fixed64),this.writeDouble(n)},writeBooleanField:function(t,n){this.writeVarintField(t,Boolean(n))}};var mc=Ut,gc=vc;function vc(t,n,e,r,i){this.properties={},this.extent=e,this.type=0,this.wn=t,this.Mn=-1,this.xn=r,this.Fn=i,t.readFields(bc,this,n)}function bc(t,n,e){1==t?n.id=e.readVarint():2==t?function(t,n){var e=t.readVarint()+t.pos;for(;t.pos<e;){var r=n.xn[t.readVarint()],i=n.Fn[t.readVarint()];n.properties[r]=i}}(e,n):3==t?n.type=e.readVarint():4==t&&(n.Mn=e.pos)}function wc(t){for(var n,e,r=0,i=0,s=t.length,o=s-1;i<s;o=i++)n=t[i],r+=((e=t[o]).x-n.x)*(n.y+e.y);return r}vc.types=["Unknown","Point","LineString","Polygon"],vc.prototype.loadGeometry=function(){var t=this.wn;t.pos=this.Mn;for(var n,e=t.readVarint()+t.pos,r=1,i=0,s=0,o=0,a=[];t.pos<e;){if(i<=0){var u=t.readVarint();r=7&u,i=u>>3}if(i--,1===r||2===r)s+=t.readSVarint(),o+=t.readSVarint(),1===r&&(n&&a.push(n),n=[]),n.push(new mc(s,o));else{if(7!==r)throw new Error("unknown command "+r);n&&n.push(n[0].clone())}}return n&&a.push(n),a},vc.prototype.bbox=function(){var t=this.wn;t.pos=this.Mn;for(var n=t.readVarint()+t.pos,e=1,r=0,i=0,s=0,o=1/0,a=-1/0,u=1/0,h=-1/0;t.pos<n;){if(r<=0){var l=t.readVarint();e=7&l,r=l>>3}if(r--,1===e||2===e)(i+=t.readSVarint())<o&&(o=i),i>a&&(a=i),(s+=t.readSVarint())<u&&(u=s),s>h&&(h=s);else if(7!==e)throw new Error("unknown command "+e)}return[o,u,a,h]},vc.prototype.toGeoJSON=function(t,n,e){var r,i,s=this.extent*Math.pow(2,e),o=this.extent*t,a=this.extent*n,u=this.loadGeometry(),h=vc.types[this.type];function l(t){for(var n=0;n<t.length;n++){var e=t[n],r=180-360*(e.y+a)/s;t[n]=[360*(e.x+o)/s-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var c=[];for(r=0;r<u.length;r++)c[r]=u[r][0];l(u=c);break;case 2:for(r=0;r<u.length;r++)l(u[r]);break;case 3:for(u=function(t){var n=t.length;if(n<=1)return[t];for(var e,r,i=[],s=0;s<n;s++){var o=wc(t[s]);0!==o&&(void 0===r&&(r=o<0),r===o<0?(e&&i.push(e),e=[t[s]]):e.push(t[s]))}e&&i.push(e);return i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)l(u[r][i])}1===u.length?u=u[0]:h="Multi"+h;var f={type:"Feature",geometry:{type:h,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var Mc=gc,xc=Fc;function Fc(t,n){this.version=1,this.name=null,this.extent=4096,this.length=0,this.wn=t,this.xn=[],this.Fn=[],this.An=[],t.readFields(Ac,this,n),this.length=this.An.length}function Ac(t,n,e){15===t?n.version=e.readVarint():1===t?n.name=e.readString():5===t?n.extent=e.readVarint():2===t?n.An.push(e.pos):3===t?n.xn.push(e.readString()):4===t&&n.Fn.push(function(t){var n=null,e=t.readVarint()+t.pos;for(;t.pos<e;){var r=t.readVarint()>>3;n=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return n}(e))}Fc.prototype.feature=function(t){if(t<0||t>=this.An.length)throw new Error("feature index out of bounds");this.wn.pos=this.An[t];var n=this.wn.readVarint()+this.wn.pos;return new Mc(this.wn,n,this.extent,this.xn,this.Fn)};var kc=xc;function Pc(t,n,e){if(3===t){var r=new kc(e,e.readVarint()+e.pos);r.length&&(n[r.name]=r)}}var Sc=function(t,n){this.layers=t.readFields(Pc,{},n)};class _c extends Ch{constructor(t,n,e,r,i,s){super(t,n,e,r,i),n=n||{},s()}getTileFeatures(t,n){const e=t.tileInfo.url,r=t.fetchOptions||{};if(this.Ut.has(e)){const{err:t,data:r}=this.Ut.get(e);return setTimeout(()=>{this.kn(e,t,r,n)},1)}return r.referrer=t.referrer,O.getArrayBuffer(e,r,(t,r)=>{this.Ut&&(t?t.loading||this.Ut.add(e,{err:t,data:r&&r.data}):r&&r.data&&this.Ut.add(e,{err:null,data:r.data}),this.kn(e,t,r&&r.data,n))})}kn(t,n,e,r){if(n)return void r(n);let i;try{i=new Sc(new Zl(e))}catch(n){return void r(n.message,[],[])}const s=[];if(!i.layers)return void r(null,s,[]);const o={};let a;for(const t in i.layers)if(u=i.layers,h=t,Object.prototype.hasOwnProperty.call(u,h)){o[t]={types:{}};const e=o[t].types;for(let r=0,o=i.layers[t].length;r<o;r++)try{a=i.layers[t].feature(r),e[a.type]=1;const n={type:a.type,layer:t,geometry:a.loadGeometry(),properties:a.properties,extent:a.extent};void 0!==a.id&&(n.id=a.id);let o=n.properties[vh];o&&(M(o)&&(o=JSON.parse(o)),n.properties[vh]=Jl(o,"EPSG:3857")),s.push(n)}catch(n){console.warn("error when load vt geometry:",n)}}var u,h;for(const t in o)o[t].types=Object.keys(o[t].types).map(t=>+t);r(null,s,o,{byteLength:e.byteLength})}abortTile(t,n){const e=this.requests[t];delete this.requests[t],e&&e.abort&&e.abort(),this.Jt(t),n()}onRemove(){super.onRemove();for(const t in this.requests){const n=this.requests[t];n&&n.abort&&n.abort()}this.requests={}}}let Oc=0;const Ec=new sh(128);class Ic{constructor(t){this.Pn={},this.Sn={},this.workerId=t}addLayer({actorId:t,mapId:n,layerId:e,params:r},i){if(this._n(n,e))return;const s=this.On(n,e),o=r.type,a=r.options,u=this.send.bind(this,t);this.Pn[s]="GeoJSONVectorTileLayer"===o?new Xl(e,a,u,Ec,{},i):new _c(e,a,u,Ec,{},i)}removeLayer({mapId:t,layerId:n},e){const r=this._n(t,n),i=this.On(t,n);delete this.Pn[i],r&&r.onRemove(e)}loadTile({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.loadTile(e,r)}abortTile({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.abortTile&&i.abortTile(e.url,r)}removeTile({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.removeTile(e,r)}updateStyle({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.updateStyle(e,r)}updateOptions({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.updateOptions(e,r)}setData({mapId:t,layerId:n,params:e},r){const i=this._n(t,n);i&&i.setData(e.data,r)}receive(t){const n=t.callback,e=this.Sn[n];delete this.Sn[n],e&&t.error?e(new Error(t.error)):e&&e(null,t.data)}send(t,n,e,r,i){const s=i?`${t}-${Oc++}`:null;i&&(this.Sn[s]=i),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:n,params:e,callback:String(s)},r||[])}On(t,n){return`${t}-${n}`}_n(t,n){const e=this.On(t,n);return this.Pn[e]}En(){Ec.reset()}}t.initialize=function(){},t.onmessage=function(t,n){const e=t.data;if(this.dispatcher||(this.dispatcher=new Ic(t.workerId)),"<response>"===t.type)this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t);else{const r=e.command;this.dispatcher[r]({actorId:t.actorId,mapId:e.mapId,layerId:e.layerId,params:e.params},(t,e,i)=>{t&&404!==t.status&&204!==t.status&&console.error(r,t),n(t,e,i)})}},Object.defineProperty(t,"In",{value:!0})}';let J$4=0;function K$4(){return J$4++}const Z$4="function"==typeof Object.assign;function Q$4(t,...e){if(Z$4)return Object.assign(t,...e),t;for(let n=0;n<e.length;n++){const i=e[n];for(const e in i)t[e]=i[e]}return t}function tt$3(t){return!rt$3(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function et$3(t){return"number"==typeof t&&!isNaN(t)}function nt$3(t){return!rt$3(t)&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function it$3(t){return!Array.isArray(t)&&"object"==typeof t&&!!t}function rt$3(t){return null==t}function st$3(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,i=n.length;e<i;e++)t.push(n[e])}return t.length}function ot$3(t){return isFunctionDefinition(t)&&t.property}function at$3(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function lt$3(t,e){let n;if(e.altitudeToPoint){n=e.altitudeToPoint(100,t);const i=e.options.heightFactor;i&&1!==i&&(n/=i)}else n=e.distanceToPointAtRes(100,0,t).x;return n/100/100}const ht$3=["GeoJSONVectorTileLayer"];class ut$3 extends t__namespace.worker.Actor{constructor(t,e){super(t);const n=e.getMap().id;this.t=e,this.i=n,this.s="vt_"+K$4();const i=e.getJSONType();this.o=ht$3.indexOf(i)>=0,this.l={},this.h=new Aa$1({iconErrorUrl:e.options.iconErrorUrl,maxSize:e.options.maxIconSize});const r=!e.getRenderer().isEnableWorkAround("win-intel-gpu-crash");this.u=new wa$1((t=>{e.getMap().getRenderer().callInNextFrame(t)}),e.options.glyphSdfLimitPerFrame,r)}initialize(t){t(null)}addLayer(t){const e=this.t,n=e.getWorkerOptions()||{},i=this.s,r=e.getJSONType(),s={mapId:this.i,layerId:i,command:"addLayer",params:{type:r,options:n}};this.o?(void 0===this.l[i]&&(this.l[i]=this.getDedicatedWorker()),this.send(s,null,t,this.l[i])):this.broadcast(s,null,t)}abortTile(t,e){const n=this.s,i={mapId:this.i,layerId:n,command:"abortTile",params:{url:t}};this.o?(void 0===this.l[n]&&(this.l[n]=this.getDedicatedWorker()),this.send(i,null,e,this.l[n])):this.broadcast(i,null,e)}removeLayer(t){const e=this.s,n={mapId:this.i,layerId:e,command:"removeLayer"};this.o?(void 0!==this.l[e]&&this.send(n,null,t,this.l[e]),delete this.l[e]):this.broadcast(n,null,t)}updateStyle(t,e){const n=this.s,i={mapId:this.i,layerId:n,command:"updateStyle",params:t};this.o?void 0!==this.l[n]&&this.send(i,null,e,this.l[n]):this.broadcast(i,null,e)}updateOptions(t,e){const n=this.s,i={mapId:this.i,layerId:n,command:"updateOptions",params:t};this.o?void 0!==this.l[n]&&this.send(i,null,e,this.l[n]):this.broadcast(i,null,e)}loadTile(t,e){const n=Q$4({},t);n.tileInfo=function(t){const e={};for(const n in t)null!=t[n]&&(e[n]=t[n].toJSON?t[n].toJSON():t[n]);return e}(t.tileInfo);const i=this.s,r={mapId:this.i,layerId:i,command:"loadTile",params:n},{x:s,y:o}=t.tileInfo;this.send(r,null,e,void 0===this.l[i]?this.workers[(s+o)%this.workers.length].id:this.l[i])}remove(){super.remove(),this.l={}}fetchIconGlyphs({icons:t,glyphs:e},n){this.u.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}setData(t,e){const n=this.s;this.send({mapId:this.i,layerId:n,command:"setData",params:{data:t}},null,e,this.l[n])}m(t){return t.id}}const ct$3={},ft$3={collision:!0,fading:!1,fadingDuration:224,fadeInDelay:600,fadeOutDelay:100,uniquePlacement:!1,depthFunc:"always"};class dt$3{constructor(t,e,n){this.v=t,this.A=e,this._=n||[0,1,0]}draw(t,e,n,i,r){if(this.S||this.M(),!this.P){this.P=this.v.buffer(pt$3(i));this.T=this.v.buffer(mt$3(i,i/n))}if(i!==this.k){const t=i/n;this.P(pt$3(i)),this.T(mt$3(i,t))}this.k=i;let s=this.O;if(!s){const t=this.A.getDevicePixelRatio()>1?2:1;s=this.O=document.createElement("canvas"),s.width=512*t,s.height=64*t;const e=s.getContext("2d");e.font="36px monospace",e.scale(t,t),this.I=this.v.texture({width:s.width,height:s.height,data:s})}const o=s.getContext("2d");o.clearRect(0,0,s.width,s.height),o.fillStyle=`rgba(${this._.map((t=>255*t)).join()})`,o.fillText(t,20,36),this.I({width:s.width,height:s.height,data:s}),this.S({transform:e,data:this.P,texData:this.F,debugLine:1,primitive:"lines",framebuffer:r||null,image:this.I,count:8}),this.S({transform:e,data:this.T,texData:this.F,debugLine:0,primitive:"triangle strip",framebuffer:r||null,image:this.I,count:4})}delete(){this.I&&(this.I.destroy(),delete this.I),this.F&&(this.F.destroy(),delete this.F),this.P&&(this.P.destroy(),this.T.destroy(),delete this.P,delete this.T),this.S&&(this.S.destroy(),delete this.S)}M(){this.F=this.v.buffer(new Uint8Array([0,0,0,1,1,0,1,1,0,0,0,1,1,0,1,1])),this.S=this.v({vert:"\n                attribute vec2 aPosition;\n                attribute vec2 aTexCoord;\n                uniform mat4 transform;\n\n                varying vec2 vTexCoord;\n                void main()\n                {\n                    gl_Position = transform * vec4(aPosition, 0.0, 1.0);\n                    vTexCoord = aTexCoord;\n                }\n            ",frag:"\n                precision mediump float;\n                uniform sampler2D uImage;\n                uniform vec3 uColor;\n                uniform float uOpacity;\n                uniform float uDebugLine;\n\n                varying vec2 vTexCoord;\n\n                void main()\n                {\n                    if (uDebugLine == 1.) {\n                        gl_FragColor = vec4(uColor, 1.0) * uOpacity;\n                    } else {\n                        gl_FragColor = texture2D(uImage, vTexCoord) * uOpacity;\n                    }\n                    gl_FragColor *= gl_FragColor.a;\n                }\n            ",attributes:{aPosition:this.v.prop("data"),aTexCoord:this.v.prop("texData")},uniforms:{transform:this.v.prop("transform"),uColor:this._,uOpacity:1,uDebugLine:this.v.prop("debugLine"),uImage:this.v.prop("image")},count:this.v.prop("count"),primitive:this.v.prop("primitive"),depth:{enable:!1,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},stencil:{enable:!1},viewport:{x:0,y:0,width:()=>this.A.getRenderer().canvas.width,height:()=>this.A.getRenderer().canvas.height},framebuffer:this.v.prop("framebuffer")})}}function pt$3(t){return new Uint16Array([0,0,0,t,0,t,t,t,t,t,t,0,t,0,0,0])}function mt$3(t,e){return new Uint16Array([0,t-64*e,0,t,512*e,t-64*e,512*e,t])}const yt$3=new Uint8Array([0,0,0,1,1,0,1,0,0,1,1,1]),gt$3=[];class vt$3{constructor(t,e,i){this.v=t,(this.C=new Q$7({aPosition:yt$3},null,yt$3.length/2,{positionSize:2})).generateBuffers(t),this.D=new Ke$5,this.R=[],this.L=0,this.N=e,this.A=i,this.M(t)}start(){this.L=0,this.D.clear()}add(t,e,n){const s=this.H(n);s.setUniform("ref",t),set$4(gt$3,e,e,1);const o=s.localTransform;fromScaling(o,gt$3),mul$5(o,n,o),s.setLocalTransform(o),this.D.addMesh(s)}render(t){this.V.render(this.U,{projViewMatrix:this.A.projViewMatrix},this.D,t)}H(){const t=this.L++;return this.R[t]||(this.R[t]=new Be$5(this.C)),this.R[t]}M(t){const e=this.N,i={viewport:{x:0,y:0,width:()=>e.width,height:()=>e.height},stencil:{enable:!0,mask:255,func:{cmp:"always",ref:(t,e)=>e.ref,mask:255},op:{fail:"replace",zfail:"replace",zpass:"replace"}},depth:{enable:!0,func:"always",mask:!1},colorMask:[!1,!1,!1,!1]};this.U=new vn$4({vert:"\n#define SHADER_NAME TILE_STENCIL_VERT\nattribute vec2 aPosition;\nuniform mat4 projViewModelMatrix;\n\nvoid main()\n{\n    gl_Position = projViewModelMatrix * vec4(aPosition, 0.0, 1.0);\n}\n",frag:"\n#define SHADER_NAME TILE_STENCIL_FRAG\nvoid main()\n{\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 0.1);\n}\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:i}),this.V=new B$6(t)}remove(){this.C.dispose();for(let t=0;t<this.R.length;t++)this.R[t].dispose();this.R.length=0,this.U.dispose()}}const xt$3=new Float32Array([-1e12])[0],bt$3="__fea_idx".trim();function At$3(e,n,i,r,s,o){const a={};if(function(t){if(!t)return!1;for(const e in t)if(null!=t[e])return!0;return!1}(e))for(let l=0,h=(n||e).length;l<h;l++){let h=n?e[n[l]]:e[l];"id"===s.options.features&&s.getFeature&&(h=s.getFeature(h),h.layer=i),s instanceof t__namespace.TileLayer&&(h=Pt$3(h,o)),a[n?n[l]:h[bt$3]]={feature:h,symbol:r}}return a}const wt$3="__original_properties",_t$3="__external_properties",St$3={get:function(t,e){return e in t?t[e]:t[wt$3][e]||t[_t$3]&&t[_t$3][e]},has:function(t,e){return e in t||e in t[wt$3]||t[_t$3]&&e in t[_t$3]}},Mt$3={};function Pt$3(t,e){const n=t.properties;if(n&&n[wt$3])return t;e&&(t=Q$4({},t)),t.customProps=t.customProps||{};const i=t.customProps;return i.$layer=t.layer,i.$type=t.type,i[wt$3]=n||Mt$3,t.properties=new Proxy(i,St$3),t}function Tt$3(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function kt$3(t,e,n){return Math.min(n,Math.max(e,t))}function Ot$3(t,e,n){if(t===n||t===e)return t;const i=n-e;return((t-e)%i+i)%i+e}function It$3(t){return null==t}function Ft$3(t){return JSON.parse(JSON.stringify(t))}function Ct$3(t,e,n,i,r,s){e in t||Object.defineProperty(t,e,{enumerable:!0,get:function(){const t=It$3(n[i])||isFunctionDefinition(n[i])?r:n[i];return s?s(t):t}})}const Et$3=[];function Dt$3(t){for(let e=0;e<t.length;e++)Et$3[e]=t[e],Et$3[e]*=255;return 3===t.length&&(Et$3[3]=255),Et$3}function Rt$3(t,e=4){return Lt$3.bind(this,t,e)}function Lt$3(t,e,n){if(Array.isArray(n))return 3===n.length&&4===e&&n.push(1),n;if(t&&t[n])return t[n];if(void 0!==n.r&&void 0!==n.g&&void 0!==n.b&&void 0!==n.a)return[n.r,n.g,n.b,n.a];const i=color(n).unitArray();return 3===i.length&&4===e&&i.push(1),t&&(t[n]=i),i}function Nt$3(t,e,n,i){if(t.fill)t.fill(e,n,i);else for(let r=n;r<i;r++)t[r]=e}function Ht$2(t){return"number"==typeof t&&!isNaN(t)}function zt$2(t){return t&&(t.markerFile||t.markerType)&&void 0!==t.textName}function Vt$2(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Ut$2(t){const e=[t[0]];let n=t[0];for(let i=1;i<t.length;i++)t[i]!==n&&(e.push(t[i]),n=t[i]);return e}const jt$2=new t__namespace.Coordinate(0,0);function Bt$3(t,e,n,i,r){const s=t.distanceToPointAtRes(e,e,i,n,jt$2);return r?s.y:s.x}const Gt$2=[],Wt$2=[0,0,0,0],Xt$2=new t__namespace.Point(0,0),Yt$2={color:Wt$2,depth:1,stencil:0},$t$2=t=>t.isTerrainSkin(),qt$2=t=>t.isTerrainVector();class Jt$2 extends t__namespace.renderer.TileLayerCanvasRenderer{supportRenderMode(){return!0}constructor(t){super(t),this.ready=!1,this.j=0,this.B={},this.G={},this.W={}}getTileLevelValue(t,e){if(this.isBackTile(t.id)){const n=t.z,i=5;return n-e>=0?e+i-n:i+(e-n)}return 0}getWorkerConnection(){return this.X}getStyleCounter(){return this.j}setStyle(t){if(this.Y&&this.Y.update(),this.X){this.j++,this.$();const e=this.layer.q();e.styleCounter=this.j,this.X.updateStyle(e,(e=>{if(e)throw new Error(e);t||(this.J=!0,this.K(),this.setToRedraw()),this.layer.fire("refreshstyle")}))}else this.K()}$(){if(this.Z)for(const t in this.Z){const e=this.Z[t];e&&this.deleteTile(e)}this.Z=this.tilesInView;const t=this.tileCache;for(const e in this.Z){const n=this.Z[e];n&&n.info&&t.getAndRemove(n.info.id)}t.reset(),this.tilesInView={},this.tilesLoading={},this.B={},this._parentTiles=[],this._childTiles=[]}updateOptions(t){this.X&&this.X.updateOptions(this.layer.getWorkerOptions(),(e=>{if(e)throw new Error(e);(t.features||t.pickingGeometry||t.altitudeProperty)&&(this.clear(),this.tt(),this.K()),this.setToRedraw()}))}updateSceneConfig(t,e,n){const i=0===t?this.et():this.nt();if(!i||!i[e])return;this.J=!0;const r=this.layer.q(),s=this.layer.it(t,r);i[e].config=s[e].renderPlugin,i[e].updateSceneConfig({sceneConfig:n}),this.setToRedraw()}updateDataConfig(t,e,n,i){const r=0===t?this.et():this.nt();r&&r[e]&&(this.J=!0,r[e].updateDataConfig(n,i)?this.setStyle():this.setToRedraw())}updateSymbol(t,e,n){const i=0===t?this.et():this.nt();if(!i||!i[e])return!1;const r=this.layer.q(),s=this.layer.it(t,r),o=i[e];o.style=s[e];const a=o.updateSymbol(n,s[e].symbol);return!a&&function t(e){if(Array.isArray(e)){const n=e;for(let e=0;e<n.length;e++)if(t(n[e]))return!0}for(const t in e)if(isFunctionDefinition(e[t])||Mr$3.isExpression(e[t]))return!0;return!1}(n)&&this.setStyle(!0),this.setToRedraw(),a}needToRedraw(){const t=super.needToRedraw();if(!t){const t=this.rt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRedraw())return!0}return t}needRetireFrames(){if(this.J)return!0;const t=this.rt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRetireFrames())return!0;return!1}isAnimating(){const t=this.rt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].isAnimating())return!0;return!1}needToRefreshTerrainTileOnZooming(){const t=this.rt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].needToRefreshTerrainTileOnZooming())return!0;return!1}st(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const{gl:t,regl:e,attributes:n}=this.ot(this.canvas);this.gl=t,this.regl=e,this.glOptions=n}if(t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.lt=new dt$3(this.regl,this.getMap()),this.ht(),this.Y=new jt$4(this.regl,this.layer),!this.consumeTile){const t=this.getMap().VERSION;throw new Error(`Incompatible version of maptalks: ${t}, upgrade maptalks >= v1.0.0-rc.14`)}}ot(t){const e=this.layer,n=e.options.glOptions||{alpha:!0,depth:!0,antialias:this.layer.options.antialias};n.preserveDrawingBuffer=!0,n.stencil=!0;const i=this.ut(t,n);return{gl:i,attributes:n,regl:a$2({gl:i,attributes:n,extensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives"],optionalExtensions:e.options.glExtensions||["OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_draw_buffers","EXT_shader_texture_lod","EXT_frag_depth"]})}}ht(){this.X||(this.X=new ut$3("@maptalks/vt",this.layer)),this.X.addLayer(((t,e)=>{this.layer&&(this.ready=!0,this.layer.onWorkerReady(t,e),this.layer.fire("workerready"),this.setToRedraw())}))}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear(this.glOptions.depth?{color:Wt$2,depth:1,stencil:0}:{color:Wt$2,stencil:0})}isDrawable(){return!0}checkResources(){return Gt$2}_drawTiles(t,e,n,i,r){if(super._drawTiles(t,e,n,i,r),this.Z)if(Object.keys(this.Z).length)for(const t in this.Z){const e=this.Z[t];this.tileCache.has(e.id)||this._drawTile(e.info,e.image,r)}else this.ct(),delete this.Z}ct(){const t=this.j,e=[],n=[];for(const n in this.G)+n!==t&&(e.push(n),this.et(n).forEach((t=>{t.remove()})));for(const e in this.W)+e!==t&&(n.push(e),this.nt(e).forEach((t=>{t.remove()})));for(let t=0;t<e.length;t++)delete this.G[e[t]];for(let t=0;t<n.length;t++)delete this.W[n[t]]}draw(t,e){this.ft!==t&&(this.J=!1,this.dt());const n=this.layer;if(this.prepareCanvas(),!this.ready||!n.ready)return void this.completeRender();let i=this.G[this.j];i||(this.K(),this.dt(),i=this.et());const r=this.nt();n.isDefaultRender()||i.length||r.length?(n.options.collision&&n.clearCollisionIndex(),this.pt=t,this.yt=this.gt(this.getMap().getGLRes()),this.vt=e||{},this.xt(t),super.draw(t),this.ft!==t&&this.bt(t),this.At(t),this.completeRender(),this.ft=t):this.completeRender()}dt(){this.rt().forEach(((t,e)=>{t&&(t.renderIndex=e)}))}bt(){const t=this.rt();this.wt=this.wt||[];let e=0;for(let n=t.length-1;n>=0;n--){const i=t[n];i.isVisible()&&i.hasMesh()&&(this.wt[n]=e,i.needPolygonOffset()&&e++)}this.Y.isEnable()&&e++,this._t=e}getFrameTimestamp(){return this.pt}drawOnInteracting(t,e,n){this.draw(e,n)}drawOutline(t){(this.St||this.Mt)&&(this.Mt?this.paintOutlineAll(t):this.St.forEach((e=>{this[e[0]](t,...e[1])})))}getAnalysisMeshes(){return this.getShadowMeshes()}getShadowMeshes(){const t=[];return this.Pt().forEach((e=>{if(!e)return;if(!this.Tt(e))return;const n=e.getShadowMeshes();if(Array.isArray(n))for(let e=0;e<n.length;e++)t.push(n[e])})),t}isForeground(t){return!(!this.kt||!this.kt[t.properties.tile.id])}Ot(e){const n=this.layer;let i=n._getTileZoom(this.getMap().getZoom());const r=n.getMinZoom(),s=n.getMaxZoom();return i=t__namespace.Util.clamp(i,r,s),i-e.properties.tile.z}isTileNearCamera(t){return this.Ot(t)<=1}isBackTile(t){return!(!this.It||!this.It[t])}loadTile(e){const{url:n}=e,i=this.B[n];if(i)i.keys[e.id]||(i.tiles.push(e),i.keys[e.id]=1);else{const i=this.getMap(),r=Xt$2.set(e.extent2d.xmin,e.extent2d.ymax),s=i.pointAtResToCoord(new t__namespace.Point(r),e.res),o=[Bt$3(i,1,s,e.res)/100,Bt$3(i,1,s,e.res,1)/100],a=this.getCentimeterToPoint(e.z),l=this.getTileGLScale(e.z);this.B[n]={keys:{},tiles:[e]},this.B[n].keys[e.id]=1;const u=window&&window.location.href;this.X.loadTile({tileInfo:{res:e.res,x:e.x,y:e.y,z:e.z,url:e.url,id:e.id,extent2d:e.extent2d},glScale:l,zScale:this.yt,centimeterToPoint:o,verticalCentimeterToPoint:a,fetchOptions:this.layer.options.fetchOptions,styleCounter:this.j,referrer:u},this.Ft.bind(this,n))}return{}}getTileGLScale(t){const e=this.getMap();return this.layer.getSpatialReference().getResolution(t)/e.getGLRes()}getCentimeterToPoint(t){const e=this.getMap();return lt$3(this.layer.getSpatialReference().getResolution(t),e)}getRenderedFeatures(){const t=[],e=this.tileCache.keys();for(let n=0;n<e.length;n++){const i=this.tileCache.get(e[n]);if(!i||!i.info||!i.image)continue;const{info:r,image:s}=i,o=ee$2(s);t.push({tile:{id:r.id,x:r.x,y:r.y,z:r.z,url:r.url},current:!!this.tilesInView[r.id],features:o})}return t}Ft(t,e,n){if(this.setToRedraw(),!this.B[t])return;if(n&&n.canceled)return;const i=this.layer,r=i.isDefaultRender(),{tiles:s}=this.B[t];if(delete this.B[t],e){if(e.status&&(404===e.status||204===e.status))for(let t=0;t<s.length;t++){this.onTileError(ct$3,s[t])}return}if(!n){for(let t=0;t<s.length;t++){this.consumeTile({Ct:!0},s[t])}return}if(n.style!==this.j)return;let o=!1;const a=n.features,l=[];for(let t=0;t<n.data.length;t++){const e=n.data[t];if(!e||!e.data||!e.styledFeatures.length)continue;const{isUpdated:i,layer:r}=this.Et(0,t,e,a,l);l.push(r),i&&(o=i)}for(let t=0;t<n.featureData.length;t++){const e=n.featureData[t];e&&e.data&&e.styledFeatures.length&&this.Et(1,t,e,a)}o&&i.Dt();const u=this.layer.getDataSchema(s[0].z);if(this.Rt(u,n.schema),delete n.features,r&&n.data.length!==l.length){const t=n.data;n.data=[];for(let e=0;e<t.length;e++)t[e]&&t[e].features&&n.data.push(t[e])}n.layers=l;for(let t=0;t<s.length;t++){const e=s[t];if(0===t&&i.options.debugTileData){const{x:t,y:n,z:r}=e;console.log("tile",{layerId:i.getId(),x:t,y:n,z:r,layers:Qt$2(Object.values(a))})}const r=0===t?n:Kt$2(n);for(let t=0;t<r.data.length;t++){if(!r.data[t])continue;const n=r.data[t].features;for(const t in n)n[t].tile=e}e.extent=r&&r.extent,this.onTileLoad(r,e)}this.layer.fire("datareceived",{url:t})}Et(t,e,n,i){const{style:r,isUpdated:s}=this.Lt(t,e,n.data),o=this.layer,a=o.isDefaultRender(),h=At$3(i,n.styledFeatures,e,r.symbol,o,!(!o.getData||!o.getData()));delete n.styledFeatures,n.features=h;let u=n.data;return Array.isArray(u)&&(u=u[0]),{isUpdated:s,layer:a?{layer:u.layer,type:u.type}:null}}Rt(t,e){for(const n in e){t[n]||(t[n]={types:e[n].types,properties:{}});const i=e[n].properties,r=t[n].properties;for(const t in i)(!r[t]||r[t]&&"object"!==i[t]&&"object"===r[t])&&(r[t]=i[t])}}Lt(t,e,n){Array.isArray(n)&&(n=n[0]);const i=this.layer;let r,s=!1;if(i.isDefaultRender()&&0===t){let t=this.Nt;t||(t=this.Nt={});const e=n.layer,i=n.type;t[e]||(t[e]=[]);const o=("plugin_"+i).trim();t[e][o]?r=t[e][o]:(r=this.Ht(i),r.filter=n.filter,t[e].push(r),t[e][o]=r,s=!0)}else{const o=i.q(),a=i.it(t,o),l=this.et();if(r=a[e],!r.renderPlugin){s=!0;const{plugin:t,symbol:i,renderPlugin:o}=this.Ht(n.type);l[e]=t,r.symbol=i,r.renderPlugin=o}}return{style:r,isUpdated:s}}rt(t){const e=t&&t.style;let n=this.et(e)||[];this.layer.isDefaultRender()&&this.Nt&&(n=[],t?t.layers&&t.layers.forEach((t=>{if(!t)return;const e=("plugin_"+t.type).trim();n.push(this.Nt[t.layer][e].plugin)})):Object.keys(this.Nt).forEach((t=>{for(let e=0;e<this.Nt[t].length;e++)n.push(this.Nt[t][e].plugin)})));const i=this.nt(e);return i&&i.length&&(n=n.slice(),st$3(n,i)),n}Pt(){if(this.layer.isDefaultRender()&&this.Nt){const t=[];return Object.keys(this.Nt).forEach((e=>{for(let n=0;n<this.Nt[e].length;n++)t.push(this.Nt[e][n].plugin)})),t}const t=[];for(const e in this.G)t.push(...this.G[e]);for(const e in this.W)t.push(...this.W[e]);return t}et(t){return rt$3(t)&&(t=this.j),this.G[t]||Gt$2}nt(t){return rt$3(t)&&(t=this.j),this.W[t]||Gt$2}xt(t,e){const n=!!this.zt,i=this.layer.isDefaultRender()&&this.Nt,r=this.vt;this.Pt().forEach(((s,o)=>{if(!s||e&&!e(s))return;if(!this.Tt(o))return;const u={regl:this.regl,layer:this.layer,symbol:i?s.defaultSymbol:s.style&&s.style.symbol,gl:this.gl,isRenderingTerrain:n,sceneConfig:s.config?s.config.sceneConfig:null,dataConfig:s.config?s.config.dataConfig:null,pluginIndex:o,timestamp:t};r&&Q$4(u,r),s.startFrame(u)}))}At(t){const e=this.vt,n=e.renderMode,i=e&&e.renderTarget&&e.renderTarget.fbo,r=this.getMap().cameraPosition,s=this.Pt(),o=!!this.zt,a=!e.timestamp||e.isFinalRender;s.forEach(this.layer.options.collision&&!e.isPostProcess?e=>{if(!this.Tt(e)||!e.hasMesh())return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(o&&!qt$2(e))return;const i=this.Vt(e,0,r,t);e.prepareRender(i),e.updateCollision(i)}:e=>{if(!this.Tt(e)||!e.hasMesh())return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(o&&!qt$2(e))return;const i=this.Vt(e,0,r,t);e.prepareRender(i)});let h=!1;if(this.ft!==e.timestamp&&!o){const e=this.layer.getPolygonOffset()+this.layer.getPolygonOffsetCount(),n=this.Vt(null,e,r,t);n.offsetFactor=e,n.offsetUnits=e,this.Y.paint(n)}s.forEach(((e,s)=>{if(!this.Ut(e))return;if(n&&"default"!==n&&!e.supportRenderMode(n))return;if(o&&!qt$2(e))return;this.regl.clear({stencil:255,framebuffer:i}),this.isEnableTileStencil()&&e.painter&&!e.painter.needClearStencil()&&this.jt(i);const l=this.Vt(e,this.wt[s]||0,r,t),u=e.endFrame(l);u&&u.redraw&&this.setToRedraw(),h=!0})),h&&this.layer.fire("canvasisdirty"),a&&this.Bt()}getPolygonOffsetCount(){return this._t||0}Bt(){if(this.layer.options.debug){const t=this.vt,e=[],n=this.getMap().projViewMatrix;for(const i in this.tilesInView){const s=this.tilesInView[i].info,o=s.transform,a=this.tilesInView[i].image.extent,l=t&&t.renderTarget;if(o&&a){const t=this.getDebugInfo(s.id),i=multiply$5(e,n,o),h=this.layer.getTileSize().width;this.lt.draw(t,i,h,a,l&&l.fbo)}}}}Ut(t){if(!t)return!0;const e=this.vt,n=this.Tt(t),i=e&&e.states&&e.states.includesChanged,r=this.Gt(t.painter.scene.getMeshes());return n&&(i||r)?r?2:1:0}Vt(t,e,n,i){const r=!!this.zt,s=r&&t&&$t$2(t),l={regl:this.regl,layer:this.layer,gl:this.gl,isRenderingTerrain:r,isRenderingTerrainSkin:s,sceneConfig:t&&t.config.sceneConfig,pluginIndex:t&&t.renderIndex,polygonOffsetIndex:e,cameraPosition:n,timestamp:i},h=this.vt;return h&&Q$4(l,h),l}Gt(t){if(!t)return!1;const e=this.vt&&this.vt.sceneFilter;return e?t.filter((t=>e(t)||t.properties.hlBloomMesh&&e(t.properties.hlBloomMesh))).length>0:t.length>0}jt(t){const e=this.isEnableTileStencil(),n=this.getCurrentTileZoom();let i=this.Wt;i||(i=this.Wt=new vt$3(this.regl,this.canvas,this.getMap())),i.start();const{tiles:r}=this.Xt;let{parentTiles:s,childTiles:o}=this.Xt,a=1;o=o.sort(Zt$2);for(let t=0;t<o.length;t++)this.Yt(o[t].info,e?a:this.getTileLevelValue(o[t].info.z,n)),a++;s=s.sort(Zt$2);for(let t=0;t<s.length;t++)this.Yt(s[t].info,e?a:this.getTileLevelValue(s[t].info.z,n)),a++;const l=r.sort(Zt$2);for(let t=l.length-1;t>=0;t--)this.Yt(l[t].info,e?a:this.getTileLevelValue(l[t].info.z,n)),a++;i.render(t)}Yt(t,e){const n=Xt$2.set(t.extent2d.xmin,t.extent2d.ymax),i=t.transform=t.transform||this.calculateTileMatrix(n,t.z,t.extent);t.stencilRef=e,this.Wt.add(e,t.extent,i)}onDrawTileStart(t){super.onDrawTileStart(t);const{tiles:e,childTiles:n,parentTiles:i}=t;this.kt={},this.It={};for(let t=0;t<e.length;t++)this.kt[e[t].info.id]=1;for(let t=0;t<n.length;t++)this.It[n[t].info.id]=1;for(let t=0;t<i.length;t++)this.It[i[t].info.id]=1;this.Xt=t}isEnableTileStencil(){if(this.layer.options.altitude)return!1;const t=this.rt();for(let e=0;e<t.length;e++)if(t[e]&&t[e].painter&&!t[e].painter.isOnly2D())return!1;return!0}setTerrainHelper(t){this.zt=t}getTerrainHelper(){return this.zt}drawTileOnTerrain(...t){Jt$2.prototype.drawTile.call(this,...t)}createTerrainTexture(t){const e=this.layer.getTileSize().width,n=2*e,i=2*e,r=t.texture({min:"linear",mag:"linear",type:"uint8",width:n,height:i});this.$t||(this.$t=t.renderbuffer({width:n,height:i,format:"depth24 stencil8"}));const s={width:n,height:i,colors:[r],colorFormat:"rgba",ignoreStatusCheck:!0};s.depthStencil=this.$t;const o=t.framebuffer(s);return o.colorTex=r,o}deleteTerrainTexture(t){t.destroy(),t.colorTex&&(t.colorTex.destroy(),delete t.colorTex)}renderTerrainSkin(t,e,n){const i=this.ft,r=this.vt,s=this.layer.getTileSize().width;this.xt(i);for(let e=0;e<n.length;e++){const i=n[e].texture;this.vt={renderTarget:{fbo:i}},Yt$2.framebuffer=i,t.clear(Yt$2),this.vt.viewport=te$2(s),this.qt(n[e].tile,i)}this.Jt(n),this.vt=r}qt(t){const{info:e,image:n}=t;this.drawTile(e,n,$t$2)}Jt(t){const e=this.Pt(),n=this.getMap().cameraPosition,i=this.ft||0;e.forEach(this.layer.options.collision?t=>{if(!this.Tt(t)||!t.hasMesh())return;if(!$t$2(t)||!this.layer.options.awareOfTerrain)return;const e=this.Vt(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e),t.updateCollision(e)}:t=>{if(!this.Tt(t)||!t.hasMesh())return;if(!$t$2(t)||!this.layer.options.awareOfTerrain)return;const e=this.Vt(t,0,n,i);e.isRenderingTerrainSkin=!0,t.prepareRender(e)}),e.forEach(((e,n)=>{if(!this.Ut(e)||!$t$2(e))return;for(let e=0;e<t.length;e++){this.regl.clear({stencil:255,framebuffer:t[e].texture})}const r=this.Vt(e,this.wt[n]||0,[0,0,0],this.ft);r.isRenderingTerrainSkin=!0,e.endFrame(r)}))}drawTile(t,e,n){if(!e.cache)return;const i=!!this.zt,r=e.cache,s=Xt$2.set(t.extent2d.xmin,t.extent2d.ymax),o=t.transform=t.transform||this.calculateTileMatrix(s,t.z,t.extent),a=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(s,t.z),l=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(s,t.z,t.extent),h=this.vt,u=[];st$3(u,e.data),st$3(u,e.featureData),this.rt(e).forEach(((s,c)=>{if(!s||n&&!n(s))return;if(!u[c])return;if(!r[c])return;const f=i&&$t$2(s),m={regl:this.regl,layer:this.layer,gl:this.gl,sceneConfig:s.config.sceneConfig,pluginIndex:c,tileCache:r[c],tileData:u[c],tileTransform:f?l:o,tileVectorTransform:o,tileTranslationMatrix:a,tileExtent:e.extent,timestamp:this.pt,tileInfo:t,tileZoom:this._tileZoom,bloom:this.vt&&this.vt.bloom,isRenderingTerrain:i,isRenderingTerrainSkin:f};f&&h&&h.renderTarget&&(m.renderTarget=h.renderTarget);const y=s.paintTile(m);!this.J&&(y.retire||y.redraw)&&s.supportRenderMode("taa")&&(this.J=!0),y.redraw&&this.setToRedraw()})),e&&e.style===this.j&&this.Kt(t),this.setCanvasUpdated()}Zt(t,e){if(!e.loadTime||e.Ct)return;let n=e.cache;n||(n=e.cache={});const i=!!this.zt,r=Xt$2.set(t.extent2d.xmin,t.extent2d.ymax),s=t.transform=t.transform||this.calculateTileMatrix(r,t.z,e.extent),o=t.tileTranslationMatrix=t.tileTranslationMatrix||this.calculateTileTranslationMatrix(r,t.z),a=t.terrainTransform=t.terrainTransform||this.calculateTerrainTileMatrix(r,t.z,t.extent),l=[];st$3(l,e.data),st$3(l,e.featureData),this.rt(e).forEach(((r,h)=>{if(!r)return;if(!l[h])return;const u=i&&$t$2(r),c=this.regl,f=this.gl;n[h]||(n[h]={});const p=r.createTile({regl:c,layer:this.layer,gl:f,sceneConfig:r.config.sceneConfig,pluginIndex:h,tileCache:n[h],tileData:l[h],tileTransform:u?a:s,tileVectorTransform:s,isRenderingTerrain:i,isRenderingTerrainSkin:u,tileTranslationMatrix:o,tileExtent:e.extent,timestamp:this.pt,tileInfo:t,tileZoom:this._tileZoom});n[h].geometry&&(e.data[h]=1),!this.J&&p.retire&&r.supportRenderMode("taa")&&(this.J=!0)}))}checkTileInQueue(t){return t.style===this.j}pick(t,e,n){const i=[];return this.layer.isVisible()?(this.rt().forEach((r=>{if(!r)return;if(!this.Tt(r))return;const s=r.pick(t,e,n.tolerance);s&&(s.type=r.getType(),i.push(s))})),i):i}deleteTile(t){if(t){if(t.image&&!t.image.Ct){const n=this.et(t.image&&t.image.style);n&&n.forEach(((e,n)=>{e&&e.deleteTile({pluginIndex:n,regl:this.regl,layer:this.layer,gl:this.gl,tileCache:t.image.cache?t.image.cache[n]:{},tileInfo:t.info,tileData:t.image})})),t.image.cache={}}t.info&&(delete t.info.completeTerrainQuery,delete t.info.terrainQueryStatus),super.deleteTile(t)}}abortTileLoading(t,e){e&&e.url&&(this.X&&this.X.abortTile(e.url),delete this.B[e.url]),super.abortTileLoading(t,e)}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||(this.pickingFBO.resize(e.width,e.height),this.rt().forEach((t=>{t&&t.resize(e.width,e.height)}))))}onRemove(){this.Wt&&this.Wt.remove(),this.X&&(this.X.removeLayer((t=>{if(t)throw t})),this.X.remove(),delete this.X),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.lt&&(this.lt.delete(),delete this.lt),this.$t&&(this.$t.destroy(),delete this.$t),this.Y&&(this.Y.dispose(),delete this.Y),super.onRemove&&super.onRemove(),this.tt()}tt(){this.Pt().forEach((t=>{t.remove()})),this.plugins={}}hitDetect(t){if(!this.gl||!this.layer.options.hitDetect)return!1;const e=this.gl,n=new Uint8Array(4);return e.readPixels(t.x,this.canvas.height-t.y,1,1,e.RGBA,e.UNSIGNED_BYTE,n),n[3]>0}K(){const{style:t,featureStyle:e}=this.layer.q(),n=t.map(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for style at "+e);const i=this.Qt(n);return i.styleCounter=this.j,i.style=t,i})),i=[];e.forEach(((t,e)=>{const n=t.renderPlugin;if(!n)return null;if(!n.type)throw new Error("invalid plugin type for features at "+e);const r=this.Qt(n);return r.style=t,r.styleCounter=this.j,i.push(r),r}));const r=this.j;return this.G[r]=n,this.W[r]=i,this.layer.fire("pluginsinited"),(this.te&&this.te.size||this.layer.te)&&(this.layer.te&&this.layer.ee(),this.getMap().getRenderer().callInNextFrame((()=>{this.rt().forEach((t=>{t.highlight(this.te)}))}))),n}Qt(t){const e=this.layer.constructor.getPlugins()[t.type];if(!e)throw new Error(`Plugin for (${t.type}) is not loaded.`);const n=new e;return n.config=t,n.config.sceneConfig||(n.config.sceneConfig={}),n}ut(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let r=0;r<n.length;++r){try{i=t.getContext(n[r],e)}catch(t){}if(i)break}return i}gt(t){return lt$3(t,this.getMap())}debugFBO(t,e){const n=document.getElementById(t),i=e.width,r=e.height;n.width=i,n.height=r;const s=n.getContext("2d"),o=this.regl.read({framebuffer:e}),a=r/2|0,l=4*i;for(let t=0;t<o.length;t++)o[t]*=255;const h=new Uint8Array(4*i);for(let t=0;t<a;++t){const e=t*l,n=(r-t-1)*l;h.set(o.subarray(e,e+l)),o.copyWithin(e,n,n+l),o.set(h,n)}const u=new ImageData(i,r);u.data.set(o),s.putImageData(u,0,0)}Ht(t){let e;switch(t){case"native-line":e={type:"native-line",dataConfig:{type:"native-line",only2D:!0}};break;case"native-point":e={type:"native-point",dataConfig:{type:"native-point",only2D:!0}};break;case"fill":e={type:"fill",dataConfig:{type:"fill",only2D:!0},sceneConfig:{antialias:!0}};break;default:e=null}const n=function(t){switch(t){case"native-point":return{markerFill:"#f00",markerSize:6,markerOpacity:.5};case"native-line":return{lineColor:"#bbb",lineOpacity:.5};case"fill":return{polygonFill:"#76a6f0",polygonOpacity:.8}}return null}(t),i=this.Qt(e);return i.defaultSymbol=n,{plugin:i,symbol:n,renderPlugin:e}}Tt(){return!0}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&function(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}(this.gl)}getZScale(){return this.yt}outline(t,e){e&&(Array.isArray(e)||(e=[e]),this.St||(this.St=[]),this.St.push(["paintOutline",[t,e]]),this.setToRedraw())}outlineFeatures(t){t&&(Array.isArray(t)||(t=[t]),this.St||(this.St=[]),this.St.push(["paintOutline",[null,t]]),this.setToRedraw())}outlineBatch(t){this.St||(this.St=[]),this.St.push(["paintBatchOutline",[t]]),this.setToRedraw()}outlineAll(){this.Mt=!0,this.setToRedraw()}paintOutlineAll(t){const e=this.rt();for(let n=0;n<e.length;n++)e[n].outlineAll(t)}paintOutline(t,e,n){if(!rt$3(e)){const i=e,r=this.rt();if(!r[i]||r[i].painter&&!r[i].painter.isVisible())return;return void r[i].outline(t,n)}const i=this.rt();for(let e=0;e<n.length;e++){const r=n[e];for(let e=0;e<i.length;e++)i[e].style&&i[e].style.id===r&&i[e].outline(t,[r])}}paintBatchOutline(t,e){const n=this.rt();!n[e]||n[e].painter&&!n[e].painter.isVisible()||n[e].outlineAll(t)}cancelOutline(){delete this.St,delete this.Mt,this.setToRedraw()}setZIndex(){return this.setToRedraw(),this.J=!0,super.setZIndex.apply(this,arguments)}consumeTile(t,e){this.Kt(e),super.consumeTile(t,e),this.Zt(e,t)}onTileError(t,e){this.Kt(e),super.onTileError(t,e)}Kt(t){const{id:e}=t;if(this.Z&&this.Z[e]){this.deleteTile(this.Z[e]),delete this.Z[e]}}highlight(t){if(this.te||(this.te=new Map),Array.isArray(t))for(let e=0;e<t.length;e++)rt$3(t[e].name)&&!rt$3(t[e].id)&&(t[e]=Q$4({},t[e]),t[e].name=t[e].id),this.te.set(t[e].name,t[e]);else rt$3(t.name)&&!rt$3(t.id)&&((t=Q$4({},t)).name=t.id),this.te.set(t.name,t);this.rt().forEach((t=>{t.highlight(this.te)}))}cancelHighlight(t){if(this.te){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.te.delete(t[e]);else this.te.delete(t);this.rt().forEach((t=>{t.highlight(this.te)}))}}cancelAllHighlight(){delete this.te,this.rt().forEach((t=>{t.cancelAllHighlight()}))}ne(){const t=this.layer.options.opacity;return this.st()?rt$3(t)?1:t:1}}function Kt$2(t){let e;Array.isArray(t.data)?(e=[],st$3(e,t.data)):(e={},Q$4(e,t.data));const n=Q$4({},t);return n.data=e,n}function Zt$2(t,e){return e.info.z-t.info.z}function Qt$2(t){const e={};for(let n=0;n<t.length;n++){const i=t[n].layer||"default";e[i]||(e[i]=[]),e[i].push(t[n])}return e}function te$2(t){return{x:0,y:0,width:2*t,height:2*t}}function ee$2(t){if(!t.cache)return[];for(const e in t.cache){const n=t.cache[e];if(n.geometry)for(let t=0;t<n.geometry.length;t++){const e=n.geometry[t]&&n.geometry[t].geometry;if(e&&e.properties&&e.properties.features){const t=e.properties.features.empty;delete e.properties.features.empty;const n=Object.values(e.properties.features);return void 0!==t&&(e.properties.features.empty=t),n}}}return[]}function ne$2(t,e,n){for(let i=0;i<t.length;i++){const r=t[i],s=Q$4({},r),{renderPlugin:o}=r,a=Q$4({},o);a.sceneConfig&&!Object.keys(a.sceneConfig).length&&delete a.sceneConfig;let l=-1;for(let t=n.length-1;t>=0;t--)if(fastDeepEqual(a,n[t])){l=t;break}l<0&&(l=n.length,n.push(a)),s.renderPlugin=l,e.push(s)}}Jt$2.include({calculateTileMatrix:function(){const t=new Array(3),e=new Array(3),n=new Array(3);return function(s,o,a){const l=this.getTileGLScale(o),h=s,u=this.layer.getTileSize().width,c=identity$2([]);return scale$5(c,c,set$4(t,l,l,this.yt)),translate$1(c,c,set$4(e,h.x,h.y,0)),scale$5(c,c,set$4(n,u/a,-u/a,1)),c}}(),calculateTerrainTileMatrix:function(){const t=new Array(3);return function(e,n,s){const o=identity$2([]),a=s/2;return scale$5(o,o,set$4(t,1/a,-1/a,0)),translate$1(o,o,set$4(t,-a,-a,0)),o}}(),calculateTileTranslationMatrix:function(){const t=new Array(3);return function(e,n){const s=this.getTileGLScale(n),o=e,a=identity$2([]);return translate$1(a,a,set$4(t,o.x*s,o.y*s,0)),a}}()});const ie$2="function"==typeof fetch&&"function"==typeof AbortController,re$2={jsonp:function(t,e){const n="_maptalks_jsonp_"+K$4();t.match(/\?/)?t+="&callback="+n:t+="?callback="+n;let i=document.createElement("script");return i.type="text/javascript",i.src=t,window[n]=function(t){e(null,t),document.getElementsByTagName("head")[0].removeChild(i),i=null,delete window[n]},document.getElementsByTagName("head")[0].appendChild(i),this},get:function(t,e,n){if(nt$3(e)){const t=n;n=e,e=t}(e=e||{}).method&&(e.method=e.method.toUpperCase());const i="POST"===e.method;if(ie$2){const i=new AbortController,r=e;r.signal=i.signal,r.referrerPolicy=r.referrerPolicy||"origin",r.method=r.method||"GET";const s=new Request(t,r);return e.returnJSON&&s.headers.set("Accept","application/json"),fetch(s).then((i=>{const r=this.ie(i,e.returnJSON,e.responseType);r.message?(r.url=t,n(r)):r.then((t=>{n(null,"arraybuffer"===e.responseType?{data:t,cacheControl:i.headers.get("Cache-Control"),expires:i.headers.get("Expires"),contentType:i.headers.get("Content-Type")}:t)})).catch((e=>{e.code&&e.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,e),n(e))}))})).catch((e=>{e.code&&e.code===DOMException.ABORT_ERR||(console.error("Fetch error:",t,e),n(e))})),i}{const r=re$2.re(n);if(r.open(e.method||"GET",t,!0),e){for(const t in e.headers)r.setRequestHeader(t,e.headers[t]);r.withCredentials="include"===e.credentials,e.responseType&&(r.responseType=e.responseType)}return r.send(i?e.body:null),r}},ie:(t,e,n)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===n?t.arrayBuffer():e?t.json():t.text(),se:function(t,e){return function(){4===t.readyState&&(200===t.status?"arraybuffer"===t.responseType?0===t.response.byteLength?e({status:200,statusText:t.statusText,message:"http status 200 returned without content."}):e(null,{data:t.response,cacheControl:t.getResponseHeader("Cache-Control"),expires:t.getResponseHeader("Expires"),contentType:t.getResponseHeader("Content-Type")}):e(null,t.responseText):e({status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}))}},re:function(t){let e;try{e=new XMLHttpRequest}catch(t){try{e=new ActiveXObject("Msxml2.XMLHTTP")}catch(t){try{e=new ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}}return e.onreadystatechange=re$2.se(e,t),e},getArrayBuffer(t,e,n){if(nt$3(e)){const t=n;n=e,e=t}return e||(e={}),e.responseType="arraybuffer",re$2.get(t,e,n)},getJSON:function(t,e,n){if(nt$3(e)){const t=n;n=e,e=t}const i=function(t,e){const i="string"==typeof e?JSON.parse(e):e||null;n(t,i)};return e&&e.jsonp?re$2.jsonp(t,i):((e=e||{}).returnJSON=!0,re$2.get(t,e,i))}},se$2=new t__namespace.Point(0,0),oe$2=new t__namespace.Coordinate(0,0),ae$2=[null,0],le$2=[];class he$2 extends t__namespace.TileLayer{static loadFrom(t,e){return fetch(t,e||{}).then((t=>t.json())).then((t=>he$2.fromJSON(t)))}constructor(t,e){super(t,e),this.VERSION=he$2.VERSION;this.setStyle(e&&e.style)}onAdd(){const t=this.getMap();this.oe();const e=this.getSpatialReference().toJSON().projection,n=t.getSpatialReference().toJSON().projection;if((e&&e.toLowerCase())!==(n&&n.toLowerCase()))throw new Error(`VectorTileLayer's projection(${e}) must be the same with map(${n}).`)}setFeatureState(t,e){if(rt$3(t.id))throw new Error("missing id in first parameter of setFeatureState.");this.ae||(this.ae={});const n=t.layer||"0";let i=this.ae[n];return this.ae[n]||(i=this.ae[n]=new Map),i.set(t.id,e),this.le(),this}removeFeatureState(t,e){if(rt$3(t.id))throw new Error("missing id in first parameter of removeFeatureState.");if(!this.ae)return this;const i=this.ae[t.layer||"0"];if(!i)return this;if(e){const n=i.get(t.id);if(it$3(e))for(const t in e)delete n[t];else delete n[e];i.set(t.id,n)}else i.delete(t.id);return this.le(),this}getFeatureState(t){if(rt$3(t.id))throw new Error("missing id in first parameter of getFeatureState.");if(!this.ae)return null;return this.ae[t.layer||"0"].get(t.id)}le(){const t=this.getRenderer();if(!t)return;const e=t.getFrameTimestamp();this.he=e}ue(){return this.he}ce(t){return this.he&&this.he!==t}oe(){const t=this.getMap().getProjection(),e="EPSG:4326"===t.code||"EPSG:4490"===t.code,n="EPSG:3857"===t.code;this.options.spatialReference||512===this.getTileSize().width&&(n?this.options.spatialReference="preset-vt-3857":e&&(this.options.spatialReference="preset-vt-4326")),this.options.tileSystem||(this.options.tms?n?this.options.tileSystem=[1,1,-6378137*Math.PI,-6378137*Math.PI]:e&&(this.options.tileSystem=[1,1,-180,-90]):e&&(this.options.tileSystem=[1,-1,-180,90]))}onWorkerReady(){}onConfig(t){const e=this.getRenderer();e&&e.updateOptions(t)}getWorkerOptions(){const t=this.getMap();return{debug:this.options.debug,debugTile:this.options.debugTile,altitudeProperty:this.options.altitudeProperty,tileSize:this.getTileSize().width,baseRes:t.getGLRes(),style:this.isDefaultRender()?{style:[],featureStyle:[]}:this.q(),features:this.options.debugTileData||this.options.features,schema:this.options.schema,pickingGeometry:this.options.pickingGeometry,projectionCode:this.getSpatialReference().getProjection().code,workerGlyph:this.options.workerGlyph,featureIdProperty:this.options.featureIdProperty}}setStyle(t){if(t&&(tt$3(t)||t.url)){const e=t,n=e.lastIndexOf("/"),i=n<0?".":e.substring(0,n);return this.ready=!1,re$2.getJSON(t.url?t.url:t,t.url?t:{},((t,n)=>{if(t)throw this.setStyle([]),t;let r;n.style?(r=n,r.$root||(r.$root=i)):r={$root:i,style:n},this.options.style=e,this.fe(r)})),this}return this.options.style=t,this.fe(t),this}de(t,e,n,i){const r=i/this.getTileSize().width;return t.set(n.x+e.x/r,n.y-e.y/r)}queryTilePointTerrain(t,e,n,i,r){const s=this.getRenderer(),o=s&&s.getTerrainHelper();if(!s||!o)return ae$2[0]=null,ae$2[1]=0,ae$2;const a=this.de(se$2,t,n,i);return e&&o.queryTileTerrainByPointAtRes?o.queryTileTerrainByPointAtRes(a,r,e.id,e,le$2):(ae$2[0]=null,ae$2[1]=0,ae$2)}queryTerrainTiles(t){const e=this.getRenderer(),n=e&&e.getTerrainHelper();return e&&n?n.getTerrainTiles(t):null}fe(t){if(this.pe=null,t&&t.$root){let e=t.$root;e&&"/"===e[e.length-1]&&(e=e.substring(0,e.length-1)),this.pe=e,this.me=function(t){return"{$root}"===t?e:null}}this.ready=!0,t=t||[],Array.isArray(t)?t={style:t}:t.renderPlugin&&(t={style:[t]}),t=function(t){if(!t.plugins)return t;const{plugins:e,styles:n}=t;let{style:i,featureStyle:r}=n;i=i||[],r=r||[];const s=new Array(i.length);for(let t=0;t<i.length;t++)s[t]=Q$4({},i[t]),s[t].renderPlugin=e[i[t].renderPlugin];const o=new Array(r.length);for(let t=0;t<r.length;t++)o[t]=Q$4({},r[t]),o[t].renderPlugin=e[r[t].renderPlugin];const a={style:s,featureStyle:o};return t.$root&&(a.$root=t.$root),a}(t=JSON.parse(JSON.stringify(t))),this.ye=t.featureStyle||[],this.ge=function(t){if(!t||!Array.isArray(t))return[];const e=[];for(let n=0;n<t.length;n++){const i=t[n].style;if(i&&Array.isArray(i)&&i.length)for(let r=0;r<i.length;r++){const s=Q$4({},t[n],i[r]);i[r].ve=e.length,delete s.style,e.push(s)}else e.push(Q$4({},t[n]))}return e}(t.featureStyle),this.xe=t.style||[];const e=t.background||{};this.be={enable:e.enable||!1,color:ce$2(e.color)||[0,0,0,0],opacity:fe$2(e.opacity,1),patternFile:e.patternFile,depthRange:e.depthRange},this.validateStyle(),this.me&&this.Ae(),this.Dt();const n=this.getRenderer();n&&n.setStyle(),this.fire("setstyle",{style:this.getStyle(),computedStyle:this.getComputedStyle()})}getPolygonOffsetCount(){const t=this.getRenderer();return t?t.getPolygonOffsetCount():0}getPolygonOffset(){return this.we||0}setPolygonOffset(t,e){return this.we=t,this._e=e,this}getTotalPolygonOffset(){return this._e}getRenderedFeatures(){const t=this.getRenderer();return t?t.getRenderedFeatures():[]}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t,e){const n=this.getRenderer();return n?(n.outline(t,e),this):this}outlineBatch(t){const e=this.getRenderer();return e?(e.outlineBatch(t),this):this}outlineFeatures(t){const e=this.getRenderer();return e?(e.outlineFeatures(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}highlight(t){this.Se(t);const e=this.getRenderer();return e?(e.highlight(t),this):(this.te||(this.te=[]),this.te.push(t),this)}Se(t){if(Array.isArray(t))for(let e=0;e<t.length;e++)this.Se(t[e]);else{if(t.filter){if(!this.options.features)throw new Error("options.features must be turned on to support filter in highlight");if(!t.name)throw new Error("A name is required for highlight with filter")}if(rt$3(t.filter)&&rt$3(t.id))throw new Error("id or filter must be provided for highlight")}}ee(){if(this.te){for(let t=0;t<this.te.length;t++)this.highlight(this.te[t]);delete this.te}}cancelHighlight(t){const e=this.getRenderer();return e?(e.cancelHighlight(t),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}Ae(){t__namespace.Util.convertStylePath(this.xe,this.me),t__namespace.Util.convertStylePath(this.ge,this.me)}updateSceneConfig(t,e){return tt$3(t)&&(t=this.Me(t)),this.Pe(0,t,e)}updateFeatureSceneConfig(t,e,n){return this.Pe(1,t,n,e)}Pe(t,e,n,i){const r=this.it(t);if(!r)return this;let s,o=e;if(r[e].renderPlugin.sceneConfig||(r[e].renderPlugin.sceneConfig={}),Q$4(r[e].renderPlugin.sceneConfig,n),void 0!==i){de$2(this.ye,e,i),o=this.ye[e].style[i].ve;const t=r[o].renderPlugin;t.sceneConfig||(t.sceneConfig={}),s=t.sceneConfig}else pe$2(r,e),s=r[e].renderPlugin.sceneConfig;if(Q$4(s,n),Array.isArray(this.options.style)){const t=this.options.style[e].renderPlugin;t.sceneConfig||(t.sceneConfig={}),Q$4(t.sceneConfig,n)}else{const r=this.it(t,this.options.style);let s;void 0!==i?(de$2(r,e,i),s=r[e].style[i].renderPlugin):(pe$2(r,e),s=r[e].renderPlugin),s.sceneConfig||(s.sceneConfig={}),Q$4(s.sceneConfig,n)}const a=this.getRenderer();return a&&a.updateSceneConfig(t,o,n),0===t?this.fire("updatesceneconfig",{index:e,sceneConfig:n}):1===t&&this.fire("updatefeaturesceneconfig",{index:e,styleIdx:i,sceneConfig:n}),this}updateDataConfig(t,e){return tt$3(t)&&(t=this.Me(t)),this.Te(0,t,e)}updateFeatureDataConfig(t,e,n){return this.Te(1,t,n,e)}Te(t,e,n,i){const r=this.it(t);if(!r)return this;let s,o=e;void 0!==i?(de$2(this.ye,e,i),o=this.ye[e].style[i].ve,s=r[o].renderPlugin.dataConfig):(pe$2(r,e),s=r[e].renderPlugin.dataConfig);const a=Q$4({},s);if(Q$4(s,n),Array.isArray(this.options.style))Q$4(this.options.style[e].renderPlugin.dataConfig,n);else{const r=this.it(t,this.options.style);let s;void 0!==i?(de$2(r,e,i),s=r[e].style[i].renderPlugin):(pe$2(r,e),s=r[e].renderPlugin),s.dataConfig||(s.dataConfig={}),Q$4(s.dataConfig,n)}const l=this.getRenderer();return l&&l.updateDataConfig(t,o,n,a),0===t?this.fire("updatedataconfig",{index:e,dataConfig:n}):1===t&&this.fire("updatefeaturedataconfig",{index:e,styleIdx:i,dataConfig:n}),this}updateSymbol(t,e){return tt$3(t)&&(t=this.Me(t)),this.ke(0,t,e)}updateFeatureSymbol(t,e,n){return this.ke(1,t,n,e)}ke(e,n,i,r){const s=this.it(e);if(!s)return this;let o=n;void 0!==r&&(de$2(this.ye,n,r),o=this.ye[n].style[r].ve);const a=s[o];if(!a)throw new Error("No style defined at "+n);const l=this,h=this.me;function u(i,s,o){if(!i)return!1;h&&(i=JSON.parse(JSON.stringify(i)),t__namespace.Util.parseSymbolPath(i,h));const a=Object.keys(i);let u=!1;for(let t=0;t<a.length;t++){const e=a[t];if(ue$2(s[e])||ue$2(i[e])){u=!0;break}}for(const e in i)at$3(i,e)&&(!t__namespace.Util.isObject(i[e])||Array.isArray(i[e])||isFunctionDefinition(i[e])?s[e]=i[e]:(s[e]||(s[e]={}),Q$4(s[e],i[e])));let c=l.options.style;if(tt$3(c))return u;Array.isArray(c)||(c=l.it(e,l.options.style));const f=JSON.parse(JSON.stringify(s));return void 0!==r?(de$2(c,n,r),void 0===o?c[n].style[r].symbol=f:c[n].style[r].symbol[o]=f):(pe$2(c,n),void 0===o?c[n].symbol=f:c[n].symbol[o]=f),u}const c=this.getRenderer();if(!c)return u(),this.Dt(),this;let f=!1;const d=a.symbol;if(Array.isArray(i))for(let t=0;t<i.length;t++){const e=u(i[t],d[t],t);e&&(f=e)}else u(i,d);return this.Dt(),f?c.setStyle():(f=c.updateSymbol(e,o,i),f&&c.setStyle()),0===e?this.fire("updatesymbol",{index:n,symbol:i}):1===e&&this.fire("updatefeaturesymbol",{index:n,featureStyleIndex:r,symbol:i}),this}it(t,e){return e?0===t?e.style:e.featureStyle:0===t?this.xe:this.ge}isDefaultRender(){return!!this.Oe&&this.options.defaultRendering}validateStyle(){this.Oe=!1;let t=this.xe;this.options.style||(this.Oe=!0,t=this.xe=[]),Array.isArray(t)||(t=this.xe=[t]);for(let e=0;e<t.length;e++){let n=t[e].filter;if(n&&n.value&&(n=n.value),n||console.warn(`render plugin at ${e} doesn't define filter, its filter will be set to 'default' by default.`),void 0!==n&&"default"!==n&&!0!==n&&!Array.isArray(n)&&void 0===n.condition)throw new Error(`Invalid filter at ${e} : ${JSON.stringify(n)}`)}}getStyle(){return this.options.style?JSON.parse(JSON.stringify(this.options.style)):null}Me(t){const e=this.xe;if(!e)return-1;for(let n=0;n<e.length;n++)if(e[n].name===t)return n;throw new Error("No style defined with name: "+t)}getGroundConfig(){this.Ie||(this.Ie={enable:!0,renderPlugin:{type:"fill",sceneConfig:{}},symbol:{polygonFill:[0,0,0,0],polygonOpacity:1}});const t=this.q().background||{};return this.Ie.enable=t.enable,this.Ie.symbol.polygonFill=t.color,this.Ie.symbol.polygonOpacity=t.opacity,this.Ie.symbol.polygonPatternFile=t.patternFile,this.Ie.renderPlugin.sceneConfig.depthRange=t.depthRange,this.Ie}getComputedStyle(){return JSON.parse(JSON.stringify(this.q()))}q(){return{background:this.be,style:this.xe||[],featureStyle:this.ge||[]}}identify(e,n={}){const i=this.getMap(),r=this.getRenderer();if(!i||!r)return[];const s=i.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(s,n)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=n.getDevicePixelRatio(),s=i.pick(t.x*r,t.y*r,e);return this.options.features&&"id"!==this.options.features?this.Fe(s):s}Fe(t){if(!this.getRenderer())return t;const e=this._getTileConfig(),n=this.getSpatialReference();for(let i=0;i<t.length;i++){let r=t[i];if(!r||!r.data)continue;const{tile:s}=r.data,{x:o,y:a,z:l,extent:h}=s,u=n.getResolution(l),c=e.getTilePointNW(o,a,u),f=r.data.feature&&r.data.feature.geometry;if(f){r.data=Q$4({},r.data),r.data.feature=Q$4({},r.data.feature);const t=r.data.feature.type;r.data.feature.type="Feature",r.data.feature.geometry=this.Ce(t,f,c,h,u)}}return t}Ce(t,e,n,i,r){let s,o;if(1===t)e.length<=1?(s="Point",o=this.Ee(e,n,i,r)[0]||[]):(s="MultiPoint",o=this.Ee(e,n,i,r));else if(2===t)e.length<=1?(s="LineString",o=this.Ee(e,n,i,r)[0]||[]):(s="MultiLineString",o=this.Ee(e,n,i,r));else if(3===t){let t;o=[];let a=0;for(let s=0;s<e.length;s++)Fa.calculateSignedArea(e[s])>0&&(a++,t&&t.length&&o.push(t),t=[]),t.push(this.Ee(e[s],n,i,r));t.length&&o.push(t),a<=1?(s="Polygon",o=o[0]):s="MultiPolygon"}return{type:s,coordinates:o}}Ee(t,e,n,i){const r=n/this.getTileSize().width,s=this.getMap(),o=[];for(let a=0;a<t.length;a++)Array.isArray(t[a])?o.push(this.Ee(t[a],e,n,i)):(se$2.x=e.x+t[a].x/r,se$2.y=e.y-t[a].y/r,s.pointAtResToCoord(se$2,i,oe$2),o.push(oe$2.toArray()));return o}getDataSchema(t){return this.De||(this.De={}),rt$3(t)||this.De[t]||(this.De[t]={}),rt$3(t)?this.De:this.De[t]}onRemove(){super.onRemove()}static fromJSON(t){return t&&"VectorTileLayer"===t.type?new he$2(t.id,t.options):null}Dt(){}static registerPlugin(t){he$2.plugins||(he$2.plugins={}),he$2.plugins[t.type]=t}static getPlugins(){return he$2.plugins||{}}static compressStyleJSON(t){return Array.isArray(t)&&t.length?function(t){Array.isArray(t)&&(t={style:t,featureStyle:[]});const e=[],n=[],i=[];ne$2(t.style,e,i),ne$2(t.featureStyle,n,i);const r={plugins:i,styles:{style:e,featureStyle:n}};return t.$root&&(r.$root=t.$root),r}(t):t}}function ue$2(t){return!(!t||!t.properties)}function ce$2(t){return t?(Array.isArray(t)||(t=color(t).unitArray()),3===t.length&&t.push(1),t):null}function fe$2(t,e){return null==t?e:t}function de$2(t,e,n){if(!t[e]||!t[e].style||!t[e].style[n])throw new Error(`No plugin defined at feature style of ${e} - ${n}`)}function pe$2(t,e){if(!t[e])throw new Error("No plugin defined at style of "+e)}he$2.prototype._getTileZoom=function(e){return e=Math.floor(e),t__namespace.TileLayer.prototype._getTileZoom.call(this,e)},he$2.registerJSONType("VectorTileLayer"),he$2.mergeOptions({renderer:"gl",altitudeProperty:"altitude",forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,tileSize:512,features:!1,schema:!1,cascadeTiles:!0,collision:!0,collisionBuffserSize:0,picking:!0,pickingPoint:!0,pickingGeometry:!1,glyphSdfLimitPerFrame:15,tileLimitPerFrame:1,loadingLimitOnInteracting:5,loadingLimit:0,antialias:!1,iconErrorUrl:null,collisionFrameLimit:1.5,defaultRendering:!0,textGamma:1,maxIconSize:254,workarounds:{"win-intel-gpu-crash":!1},pyramidMode:1,styleScale:1,enableAltitude:!0,fadeAnimation:!1,debugTileData:!1,fetchOptions:null,awareOfTerrain:!0,altitudeQueryTimeLimitPerFrame:3,workerGlyph:!0,featureIdProperty:null}),he$2.registerRenderer("gl",Jt$2),he$2.registerRenderer("canvas",null);const me$2={projection:"EPSG:4326",fullExtent:{top:90,left:-180,bottom:-90,right:180},resolutions:function(){const t=[];for(let e=0;e<22;e++)t[e]=45/(128*Math.pow(2,e));return t}()};t__namespace.SpatialReference.registerPreset("preset-vt-4326",me$2),t__namespace.SpatialReference.registerPreset("preset-4326-512",me$2);class ye$2 extends he$2{getTileUrl(t,e,n){const i=this.getMap().getResolution(n);return super.getTileUrl(t,e,function(t){return 19-Math.log(t/ge$2)/Math.LN2}(i))}static fromJSON(t){return t&&"MapboxVectorTileLayer"===t.type?new ye$2(t.id,t.options):null}}ye$2.registerJSONType("MapboxVectorTileLayer");const ge$2=12756274*Math.PI/(256*Math.pow(2,20));class ve$2 extends he$2{constructor(t,e={}){e.spatialReference=null,super(t,e),this.setData(e.data)}oe(){}getWorkerOptions(){const t=super.getWorkerOptions();let e=this.options.data;return e=tt$3(e)||e&&e.url?be$2(e):this.features,t.data=e,t.tileBuffer=this.options.tileBuffer,t.extent=this.options.extent,t.hasAltitude=this.options.enableAltitude,t.simplifyTolerance=this.options.simplifyTolerance,t.projection=this.getSpatialReference().getProjection().code,t.generateOMBB=this.options.generateOMBB,t.convertFn=this.options.convertFn?this.options.convertFn+"":null,t}_initTileConfig(){const t=this.getSpatialReference();t&&t.getProjection()&&("EPSG:4326"===t.getProjection().code||"EPSG:4490"===t.getProjection().code)&&(this.options.tileSystem=[1,-1,-180,90]),super._initTileConfig()}setData(t){return this.options.data=t,t&&(tt$3(t)||t.url)?(!!this.getRenderer()&&this.Re(),this):(this.Le(t),this.Re(),this)}Le(t){return this.options.convertFn&&(t=new Function("data",this.options.convertFn+"\nreturn convert(data)")(t)),this.features=t,this.Ne(),this}Re(){const t=this.getRenderer();if(t){const e=t.getWorkerConnection();if(e){let n=this.options.data;n=tt$3(n)||n.url?be$2(n):this.features,e.setData(n,((e,n)=>{t.clear(),this.onWorkerReady(null,n),t.setToRedraw(),setTimeout((()=>{t.setToRedraw()}),500)}))}}}getExtent(){return this.He}onWorkerReady(t,e){t?this.fire("dataerror",{error:t}):(e&&(e.extent&&this.ze(e.extent),e.idMap&&(this.Ve=e.idMap)),this.fire("dataload",{extent:e&&e.extent}))}ze(e){this.He=new t__namespace.Extent(...e)}Ue(t,e){tt$3(t)?re$2.getJSON(t,e):re$2.getJSON(t.url,t,e)}getData(){return this.features||null}getTileUrl(t,e,n){return this.getId()+","+t+","+e+","+n}getFeature(t){return this.Ve[t]}static fromJSON(t){return t&&"GeoJSONVectorTileLayer"===t.type?new ve$2(t.id,t.options):null}Ne(){if(!this.features)return;if(this.features=JSON.parse(JSON.stringify(this.features)),!this.features)return;let t=0;this.Ve={};const e=this.options.featureIdProperty,n=this.features;Array.isArray(n)?n.forEach((n=>{if(n){if(et$3(n.id)||(n.id=t++),e){let t=e;it$3(e)&&(t=e[n.layer||"0"]),n.id=n.properties[t]}this.Ve[n.id]=n}})):n.features&&n.features.forEach((n=>{if(n){if(et$3(n.id)||(n.id=t++),e){let t=e;it$3(e)&&(t=e[n.layer||"0"]),n.id=n.properties[t]}this.Ve[n.id]=n}}))}}function xe$2(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function be$2(t){return t.url?t.url=xe$2(t.url):t=xe$2(t),t}ve$2.registerJSONType("GeoJSONVectorTileLayer"),ve$2.mergeOptions({features:"id",tileBuffer:64,extent:8192,pyramidMode:1,simplifyTolerance:3,tileStackDepth:0,generateOMBB:!0});const Ae$2=new t__namespace.Size(1,1);class we$2 extends t__namespace.OverlayLayer{static registerPainter(t,e){we$2.painters||(we$2.painters={}),we$2.painters[t]=e}static get3DPainterClass(t){return we$2.painters[t]}getEvents(){let t;return t=super.getEvents?super.getEvents():{},t.spatialreferencechange=this.je,t}onConfig(t){if(super.onConfig(t),void 0!==t.enableBloom){const e=this.getRenderer();e&&e.updateBloom(t.enableBloom)}}updateSymbol(t,e){if(!this.options.style)throw new Error("can't call update symbol when style is not set");const n=Array.isArray(this.options.style)?this.options.style:this.options.style.style;if(!n[t])throw new Error("invalid style at "+t);return Q$4(n[t].symbol,e),this.setStyle(this.options.style),this}getPolygonOffsetCount(){return this.isEmpty()||this.options.altitude?0:1}getPolygonOffset(){return this.options.altitude?0:this.we||0}setPolygonOffset(t,e){return this.we=t,this._e=e,this}getTotalPolygonOffset(){return this._e}identify(e,n={}){const i=this.getMap(),r=this.getRenderer();if(!i||!r)return[];const s=i.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(s,n)}identifyAtPoint(t,e={}){const n=this.getMap(),i=this.getRenderer();if(!n||!i)return[];const r=this.getMap().getDevicePixelRatio();return i.pick(t.x*r,t.y*r,e)}getComputedStyle(){return{style:this.getStyle()||[]}}outlineAll(){const t=this.getRenderer();return t?(t.outlineAll(),this):this}outline(t){if(!Array.isArray(t)||!t.length)return this;const e=this.getRenderer();return e?(e.outline(t),this):this}cancelOutline(){const t=this.getRenderer();return t?(t.cancelOutline(),this):this}toJSON(){const t={type:this.getJSONType(),id:this.getId(),options:this.config(),geometries:[]},e=this.getGeometries();for(let n=0,i=e.length;n<i;n++){const i=e[n].toJSON();t.geometries.push(i)}return t}getTileSize(){return Ae$2}je(){const t=this.getRenderer();t&&t.je()}}we$2.mergeOptions({picking:!0,pickingPoint:!0,renderer:"gl",collision:!1,collisionBufferSize:0,textGamma:1,geometryEvents:!0,styleScale:1,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,meshRenderOrder:0,enableBloom:!1,enableAltitude:!0,workarounds:{"win-intel-gpu-crash":!0}});const _e$2={markerFile:{type:"identity",default:null,property:"_symbol_markerFile"},markerWidth:{type:"identity",default:null,property:"_symbol_markerWidth"},markerHeight:{type:"identity",default:null,property:"_symbol_markerHeight"},markerPathWidth:{type:"identity",default:20,property:"_symbol_markerPathWidth"},markerPathHeight:{type:"identity",default:20,property:"_symbol_markerPathHeight"},markerDx:{type:"identity",default:null,property:"_symbol_markerDx"},markerDy:{type:"identity",default:null,property:"_symbol_markerDy"},markerType:{type:"identity",default:null,property:"_symbol_markerType"},markerPath:{type:"identity",default:null,property:"_symbol_markerPath"},markerFill:{type:"identity",default:null,property:"_symbol_markerFill"},markerFillPatternFile:{type:"identity",default:null,property:"_symbol_markerFillPatternFile"},markerFillOpacity:{type:"identity",default:null,property:"_symbol_markerFillOpacity"},markerLineColor:{type:"identity",default:null,property:"_symbol_markerLineColor"},markerLineWidth:{type:"identity",default:null,property:"_symbol_markerLineWidth"},markerLineOpacity:{type:"identity",default:null,property:"_symbol_markerLineOpacity"},markerLineDasharray:{type:"identity",default:null,property:"_symbol_markerLineDasharray"},markerLinePatternFile:{type:"identity",default:null,property:"_symbol_markerLinePatternFile"},markerVerticalAlignment:{type:"identity",default:"top",property:"_symbol_markerVerticalAlignment"},markerHorizontalAlignment:{type:"identity",default:"middle",property:"_symbol_markerHorizontalAlignment"},markerOpacity:{type:"identity",default:1,property:"_symbol_markerOpacity"},markerPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_markerPitchAlignment"},markerRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_markerRotationAlignment"},markerRotation:{type:"identity",default:0,property:"_symbol_markerRotation"},markerAllowOverlap:{type:"identity",default:0,property:"_symbol_markerAllowOverlap"},markerIgnorePlacement:{type:"identity",default:0,property:"_symbol_markerIgnorePlacement"},markerTextFit:{type:"identity",default:null,property:"_symbol_markerTextFit"},markerSpacing:{type:"identity",default:250,property:"_symbol_markerSpacing"},markerTextFitPadding:{type:"identity",default:null,property:"_symbol_markerTextFitPadding"},markerPlacement:{type:"identity",default:"point",property:"_symbol_markerPlacement"}},Se$2={textName:{type:"identity",default:null,property:"_symbol_textName"},textFaceName:{type:"identity",default:null,property:"_symbol_textFaceName"},textWeight:{type:"identity",default:null,property:"_symbol_textWeight"},textStyle:{type:"identity",default:null,property:"_symbol_textStyle"},textWrapWidth:{type:"identity",default:null,property:"_symbol_textWrapWidth"},textHorizontalAlignment:{type:"identity",default:null,property:"_symbol_textHorizontalAlignment"},textVerticalAlignment:{type:"identity",default:null,property:"_symbol_textVerticalAlignment"},textFill:{type:"identity",default:null,property:"_symbol_textFill"},textSize:{type:"identity",default:null,property:"_symbol_textSize"},textHaloRadius:{type:"identity",default:null,property:"_symbol_textHaloRadius"},textHaloFill:{type:"identity",default:null,property:"_symbol_textHaloFill"},textHaloOpacity:{type:"identity",default:1,property:"_symbol_textHaloOpacity"},textDx:{type:"identity",default:0,property:"_symbol_textDx"},textDy:{type:"identity",default:0,property:"_symbol_textDy"},textOpacity:{type:"identity",default:1,property:"_symbol_textOpacity"},textPitchAlignment:{type:"identity",default:"viewport",property:"_symbol_textPitchAlignment"},textRotationAlignment:{type:"identity",default:"viewport",property:"_symbol_textRotationAlignment"},textRotation:{type:"identity",default:0,property:"_symbol_textRotation"},textAllowOverlap:{type:"identity",default:0,property:"_symbol_textAllowOverlap"},textIgnorePlacement:{type:"identity",default:0,property:"_symbol_textIgnorePlacement"},textSpacing:{type:"identity",default:250,property:"_symbol_textSpacing"},textPlacement:{type:"identity",default:"point",property:"_symbol_textPlacement"}},Me$2={lineWidth:{type:"identity",default:2,property:"_symbol_lineWidth"},lineStrokeWidth:{type:"identity",default:0,property:"_symbol_lineStrokeWidth"},lineColor:{type:"identity",default:[1,1,1,1],property:"_symbol_lineColor"},lineStrokeColor:{type:"identity",default:[0,0,0,0],property:"_symbol_lineStrokeColor"},lineDx:{type:"identity",default:0,property:"_symbol_lineDx"},lineDy:{type:"identity",default:0,property:"_symbol_lineDy"},linePatternFile:{type:"identity",default:null,property:"_symbol_linePatternFile"},linePatternAnimSpeed:{type:"identity",default:0,property:"_symbol_linePatternAnimSpeed"},linePatternGap:{type:"identity",default:0,property:"_symbol_linePatternGap"},lineOpacity:{type:"identity",default:1,property:"_symbol_lineOpacity"},lineJoin:{type:"identity",default:null,property:"_symbol_lineJoin"},lineCap:{type:"identity",default:null,property:"_symbol_lineCap"},lineDasharray:{type:"identity",default:null,property:"_symbol_lineDasharray"},lineDashColor:{type:"identity",default:null,property:"_symbol_lineDashColor"}},Pe$2=new t__namespace.Point(0,0),Te$2="_vector3dlayer_id",ke$2="_line_gradient_property".trim();function Oe$2(e,n,i){const r="__fea_idx".trim(),s=e.getMap(),o=s.getGLRes();let a=e.getCoordinates();const l=[],h=[];let u=1;if(e instanceof t__namespace.Marker||e instanceof t__namespace.MultiPoint){e instanceof t__namespace.Marker&&(a=[a]);for(let t=0;t<a.length;t++)s.coordToPointAtRes(a[t],o,Pe$2),l.push([Pe$2.x,Pe$2.y,a[t].z||0]),h.push([a[t].x,a[t].y])}else if(e instanceof t__namespace.LineString||e instanceof t__namespace.MultiLineString){u=2,e instanceof t__namespace.LineString&&(a=[a]);for(let t=0;t<a.length;t++){l[t]=[],h[t]=[];for(let e=0;e<a[t].length;e++)s.coordToPointAtRes(a[t][e],o,Pe$2),l[t].push([Pe$2.x,Pe$2.y,a[t][e].z||0]),h[t].push([a[t][e].x,a[t][e].y])}}else if(e instanceof t__namespace.Polygon||e instanceof t__namespace.MultiPolygon){u=3,e instanceof t__namespace.Circle||e instanceof t__namespace.Rectangle||e instanceof t__namespace.Ellipse||e instanceof t__namespace.Sector?a=[[e.getShell()]]:e instanceof t__namespace.Polygon&&(a=[a]);let n=0;for(let t=0;t<a.length;t++)for(let e=0;e<a[t].length;e++){l[n]=[],h[n]=[];for(let i=0;i<a[t][e].length;i++)s.coordToPointAtRes(a[t][e][i],o,Pe$2),l[n].push([Pe$2.x,Pe$2.y,a[t][e][i].z||0]),h[n].push([a[t][e][i].x,a[t][e][i].y]);n++}}const c=e.getProperties()?Object.assign({},e.getProperties()):{},f=e._getInternalSymbol()||function(e){return e instanceof t__namespace.Marker||e instanceof t__namespace.MultiPoint?{markerType:"ellipse",markerWidth:8,markerHeight:0,markerFill:"#000"}:e instanceof t__namespace.LineString||e instanceof t__namespace.MultiLineString?{lineColor:"#000",lineWidth:1}:e instanceof t__namespace.Polygon||e instanceof t__namespace.MultiPolygon?{polygonFill:"#fff",lineColor:"#000",lineWidth:1}:void 0}(e),d=i?Array.isArray(i)?i[0].id:i.id:n.id++;if(Array.isArray(f)&&f.length){const t=[],s=f.length;for(let o=0;o<s;o++){const a=o===s-1?c:Q$4({},c),p=Ie$2(f[o],a);for(const t in f[o])at$3(f[o],t)&&(a[("_symbol_"+t).trim()]=f[o][t]);p&&(f[o].lineGradientProperty=p);const m=i&&i[o]?i[o][r]:n.pickingId++,y={type:u,id:d,properties:a,visible:e.isVisible(),geometry:l,coordinates:h,extent:1/0};y[r]=m,t.push(y)}return t}if(f){const t=Ie$2(f,c);for(const t in f)at$3(f,t)&&(c[("_symbol_"+t).trim()]=f[t]);t&&(f.lineGradientProperty=t)}const p=i?i.id:n.pickingId++,m={type:u,id:d,properties:c,visible:e.isVisible(),geometry:l,coordinates:h,extent:1/0};return m[r]=p,m}function Ie$2(t,e){const n=t.lineGradientProperty;return n&&(e[ke$2]=e[n],e.mapbox_clip_start=0,e.mapbox_clip_end=1,delete e[n]),n}let Fe$2=1;const Ce$2="_symbol_".trim(),Ee$2="__fea_idx".trim();let De$2=new Float32Array(1);const Re$2=[];class Le$2 extends t__namespace.renderer.CanvasRenderer{constructor(...t){super(...t),this.features={},this.Be={},this.L=0,this.Ge={},this.We={},this.Xe={},this.Ye={},this.$e={},this.qe=!0,this.Je={id:0,pickingId:0},this.Ke={}}hasNoAARendering(){return!0}needToRedraw(){return super.needToRedraw()||this.painter&&this.painter.needToRedraw()||this.Ze&&this.Ze.needToRedraw()||this.Qe&&this.Qe.needToRedraw()}getAnalysisMeshes(){return this.painter&&this.painter.getAnalysisMeshes()||Re$2}getRayCastData(){return null}draw(t,e){this.pt=t;const n=this.layer;this.prepareCanvas(),this.yt=this.gt(this.getMap().getGLRes()),this.vt=e||{};const i=this.vt.renderMode,r=this.tn();if(this.xt(r,i),this.qe)this.buildMesh(),this.en(),this.nn(),this.Ke={},this.in=!1,this.qe=!1,this.rn=!1;else if(this.in){const t=this.atlas,e=this.sn,n=this.an;delete this.atlas,delete this.sn,delete this.an,this.buildMesh(t),this.en(e),this.nn(n),this.in=!1,this.rn=!1}else if(this.rn){const t=this.an;delete this.an,this.nn(t),this.rn=!1}if(!this.meshes&&!this.ln&&!this.hn)return void this.completeRender();this.un&&(this.cn(),this.un=!1),this.dn();const s=!i||"default"===i;let o=0;0===this.layer.options.meshRenderOrder&&this.pn(r,o,i);let a=0;if(this.hn&&(s||this.Qe.supportRenderMode(i))){this.Qe.startFrame(r),this.Qe.addMesh(this.hn,null,{bloom:this.vt.bloom}),this.Qe.prepareRender(r);const t=r.polygonOffsetIndex||0;o=this.meshes&&this.meshes.length?o-1:o,r.polygonOffsetIndex=(r.polygonOffsetIndex||0)+o,a=this.Qe.render(r).drawCount,r.polygonOffsetIndex=t}if(1===this.layer.options.meshRenderOrder&&this.pn(r,a?o-1:o,i),this.ln&&(s||this.Ze.supportRenderMode(i))){const e=!this.vt.timestamp||this.vt.isFinalRender,i=!this.mn||this.mn!==t;n.options.collision&&i&&n.clearCollisionIndex();const s=this.layer.options.sceneConfig;this.Ze.sceneConfig.collision=!s||!!rt$3(s.collision)||s.collision,this.Ze.startFrame(r),this.Ze.addMesh(this.ln,null,{bloom:this.vt.bloom}),this.Ze.prepareRender(r),n.options.collision&&i&&(this.Ze.updateCollision(r),e&&(this.mn=t)),this.Ze.render(r)}(s||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("canvasisdirty"))}xt(t,e){this.painter&&(!e||"default"===e||this.painter.supportRenderMode(e))&&this.painter.startFrame(t)}pn(t,e,n){return this.painter&&this.meshes&&(!n||"default"===n||this.painter.supportRenderMode(n))?(this.painter.addMesh(this.meshes,null,{bloom:t&&t.bloom}),this.painter.prepareRender(t),t.polygonOffsetIndex=(t.polygonOffsetIndex||0)+e,this.painter.render(t)):{redraw:!1,drawCount:0}}supportRenderMode(){return!0}isForeground(){return!0}tn(){const t={regl:this.regl,layer:this.layer,symbol:this.yn,gl:this.gl,sceneConfig:this.layer.options.sceneConfig,pluginIndex:0,cameraPosition:this.getMap().cameraPosition,timestamp:this.getFrameTimestamp()};return this.vt&&Q$4(t,this.vt),t}drawOnInteracting(t,e,n){this.draw(e,n)}getFrameTimestamp(){return this.pt}gn(t,e){(t=t||e)===e&&(e=null);const n=[],i=[0,0,0,0];this.layer._sortGeometries();const r=this.layer.getGeometries();for(let s=0;s<r.length;s++){const o=r[s][Te$2];if(!this.features[o])continue;const a=this.features[o];if(Array.isArray(a))for(let r=0;r<a.length;r++){const s=a[r],o=s[Ee$2];(!t||t[o]||e&&(!e||e[o]))&&(s.visible||(this.un=!0),this.vn(s.geometry,i,s.coordinates),n.push(s))}else{a.visible||(this.un=!0);const r=a[Ee$2];if(t&&!t[r]&&(!e||e&&!e[r]))continue;this.vn(a.geometry,i,a.coordinates),n.push(a)}}if(n.length||(this.meshes&&this.painter&&(this.painter.deleteMesh(this.meshes),delete this.meshes),this.ln&&(this.Ze.deleteMesh(this.ln),delete this.ln),this.hn&&(this.Qe.deleteMesh(this.hn),delete this.hn)),i[3]&&(i[0]/=i[3],i[1]/=i[3]),isNaN(i[0])||isNaN(i[1]))throw new Error("invalid geometry coordinates for "+this.layer.getJSONType());return{features:n,center:i}}buildMesh(){}createVectorPacks(t,e,n,i,r,s){return t&&i&&i.length?new e(i,n,{zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.requestor,atlas:r,center:s,positionType:Float32Array}).load():Promise.resolve(null)}createMesh(t,e,n,i,r,s){return this.createVectorPacks(t,e,n,i,r,s).then((o=>this.xn(o,t,e,n,i,r,s)))}xn(t,e,n,s,o,a,l){if(!t)return null;const h=e.createGeometries([t.data],At$3(o,null,0,s,this.layer));for(let t=0;t<h.length;t++)h[t]&&this.bn(h[t].geometry);const u=identity$2([]);translate$1(u,u,set$4([],l[0],l[1],0)),scale$5(u,u,set$4([],1,1,this.yt));const c=e.createMeshes(h,u,{tilePoint:[l[0],l[1]]});for(let t=0;t<c.length;t++){const e=c[t];e.properties.level=0,e.properties.tileTransform=u;const n=e.defines;n.ENABLE_TILE_STENCIL=1,e.setDefines(n),e.properties.meshKey=this.layer.getId()}return{meshes:c,atlas:{iconAtlas:t.data.iconAtlas}}}vn(t,e,n){for(let i=0;i<t.length;i++)if(Array.isArray(t[i][0]))for(let r=0;r<t[i].length;r++)if(Array.isArray(t[i][r][0]))for(let s=0;s<t[i][r].length;s++)isNaN(+t[i][r][s][0])||isNaN(+t[i][r][s][1])||this.An(e,t[i][r][s][0],t[i][r][s][1],t[i][r][s][2],1,n[i][r][s]);else isNaN(+t[i][r][0])||isNaN(+t[i][r][1])||this.An(e,t[i][r][0],t[i][r][1],t[i][r][2],1,n[i][r]);else isNaN(+t[i][0])||isNaN(+t[i][1])||this.An(e,t[i][0],t[i][1],t[i][2],1,n[i])}An(t,e,n,i,r,s){let o=!1;(s[0]>180||s[0]<-180)&&(o=!0,console.warn(`Layer(${this.layer.getId()}) has invalid longitude value: ${s[0]}`)),(s[1]>90||s[1]<-90)&&(o=!0,console.warn(`Layer(${this.layer.getId()}) has invalid latitude value: ${s[1]}`)),o||(t[0]+=e,t[1]+=n,t[2]+=i||0,t[3]+=r)}bn(t){const e=this.getMap(),n=t.properties;Object.defineProperty(n,"tileResolution",{enumerable:!0,get:function(){return e.getGLRes()}}),n.tileRatio=1,n.z=1,n.tileExtent=1,n.elements=t.elements,n.aPickingId=t.data.aPickingId}wn(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&He$2(this.gl)}prepareRequestors(){if(this.h)return;const t=this.layer;this.h=new Aa$1({iconErrorUrl:t.options.iconErrorUrl});const e=!this.wn("win-intel-gpu-crash");this.u=new wa$1((e=>{t.getMap().getRenderer().callInNextFrame(e)}),t.options.glyphSdfLimitPerFrame,e),this.requestor=this._n.bind(this),this.Sn=this.Mn.bind(this)}_n(t,e,n){const i=[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&i.push(...e.buffers),n(null,{icons:e.icons},i)}))}Mn(t,e,n){this.u.getGlyphs(e,((e,i)=>{if(e)throw e;const r=i.buffers||[];this.h.getIcons(t,((t,e)=>{if(t)throw t;e.buffers&&e.buffers.length&&r.push(...e.buffers),n(null,{icons:e.icons,glyphs:i.glyphs},r)}))}))}en(t){const e=Object.keys(this.Xe),n=Object.keys(this.Ye);if(!e.length&&!n.length)return void(this.ln&&(this.Ze.deleteMesh(this.ln),delete this.ln));const{features:s,center:o}=this.gn(this.Xe,this.Ye),a=[],l=[];for(let t=0;t<s.length;t++){const e=s[t][Ee$2];this.Xe[e]&&a.push(s[t]),this.Ye[e]&&l.push(s[t])}if(!a.length&&!l.length)return void(this.ln&&(this.Ze.deleteMesh(this.ln),delete this.ln));const h=this.un;this.Pn=o;const u=this.Tn(a,l,t,o);this.sn={};const c=[],f=[];this.kn=!0,Promise.all(u).then((t=>{if(this.ln&&(this.Ze.deleteMesh(this.ln),delete this.ln),!t||!t.length)return void this.setToRedraw();const e=this.Ze.createGeometries(t.map((t=>(t&&t.data&&(t.data.isIdUnique=!0),t&&t.data))),this.Ge);for(let n=0;n<e.length;n++)this.bn(e[n].geometry,t[n]&&t[n].data);const n=t[0]&&t[0].data.iconAtlas,s=t[0]&&t[0].data.glyphAtlas||t[1]&&t[1].data.glyphAtlas;n&&(this.sn.iconAtlas=n),s&&(this.sn.glyphAtlas=s);const a=identity$2([]);translate$1(a,a,set$4(f,o[0],o[1],0)),scale$5(a,a,set$4(c,1,1,this.yt));const l=this.Ze.createMeshes(e,a);for(let t=0;t<l.length;t++)l[t].geometry.properties.originElements=l[t].geometry.properties.elements.slice(),l[t].properties.level=0,l[t].material.set("flipY",1),l[t].properties.meshKey=Fe$2++;this.ln=l,h&&(this.un=!0),this.kn=!1,this.setToRedraw(),this.layer.fire("buildmarkermesh")}))}cn(){if(this.ln&&(this.On(this.ln[0],this.Xe),this.On(this.ln[1],this.Ye),this.ln[0]&&this.Ze.prepareCollideIndex(this.ln[0].geometry),this.ln[1]&&this.Ze.prepareCollideIndex(this.ln[1].geometry)),this.hn)for(let t=0;t<this.hn.length;t++)this.On(this.hn[t],this.$e);if(this.meshes)for(let t=0;t<this.meshes.length;t++)this.On(this.meshes[t],this.Ge)}On(t,e){if(!t)return;const{aPickingId:n,originElements:i}=t.geometry.properties,r=[];for(let t=0;t<i.length;t++){const s=n[i[t]];e[s]&&e[s].feature.visible&&r.push(i[t])}const s=t.geometry.properties.elements=new i.constructor(r);t.geometry.setElements(s)}Tn(t,e,n,i){const r={zoom:this.getMap().getZoom(),EXTENT:1/0,requestor:this.Sn,atlas:n,center:i,positionType:Float32Array,defaultAltitude:0,forceAltitudeAttribute:!0,markerWidthType:Uint16Array,markerHeightType:Uint16Array},s=Q$4({},r);return r.allowEmptyPack=1,Ps$2.splitPointSymbol(this.In).map(((n,i)=>new Ps$2(0===i?t:e,n,0===i?r:s).load()))}updateMesh(){}Fn(t){const e=t._getInternalSymbol(),n={zoom:this.getMap().getZoom(),isVector3D:!0},i=this.Cn(t);if(!this.ln)return!1;let r=this.features[i];Array.isArray(r)||(r=[r]);const s=[],o=[],a=[],l=this.getMap().getZoom();let h,u;h=Array.isArray(e)?e.map((t=>t?loadFunctionTypes(t,(()=>(s[0]=l,s))):t)):loadFunctionTypes(e,(()=>(s[0]=l,s))),u=Array.isArray(e)?e.map((t=>t?$r$3.genFnTypes(t):t)):$r$3.genFnTypes(e);for(let t=0;t<r.length;t++){if(!r[t])continue;const i=Array.isArray(e)?e[t]:e,s=Array.isArray(h)?h[t]:h,o=Array.isArray(u)?u[t]:u,a=new ls$3(r,i,s,o,n).getIconAndGlyph();if(!this.sn||!Ps$2.isAtlasLoaded(a,this.sn))return this.En(),this.setToRedraw(),!1}for(let t=0;t<r.length;t++){const e=r[t][Ee$2];this.Xe[e]&&o.push(r[t]),this.Ye[e]&&a.push(r[t])}const c=r[0].id,f=this.Tn(o,a,this.sn,this.Pn),d=this.ln;return Promise.all(f).then((t=>{for(let e=0;e<t.length;e++){if(!t[e])continue;t[e].data&&(t[e].data.isIdUnique=!0);const n=d[e],i=n.geometry.properties.aFeaIds.indexOf(c);if(i<0)continue;const r=t[e].data.featureIds.length,s=t[e].data.dynamicAttributes;for(const o in t[e].data.data){if("aPickingId"===o)continue;if(s[o])continue;const a=t[e].data.data[o];a&&n.geometry.updateSubData(o,a,i*a.length/r)}}this.setToRedraw()})),!0}Dn(t){return this.Rn(t,this.hn,this.an,this.Ln,this.Qe,Is$2,Me$2,this.Nn)}Rn(t,e,n,i,r,s,o,a){if(!e)return!1;if(!n)return this.En(),this.setToRedraw(),!1;const l=t._getInternalSymbol(),h={zoom:this.getMap().getZoom()};let c=this.features[t[Te$2]];Array.isArray(c)||(c=[c]);const f=[];for(let t=0;t<c.length;t++){const e=c[t];if(!e)continue;const i=Array.isArray(l)?l[t]:l,r=$r$3.genFnTypes(i),o=new ct$4(c,i,r,h),a=s===Is$2?o.getLineResource():o.getPolygonResource();if(!$r$3.isAtlasLoaded(a,n[t]))return this.En(),this.setToRedraw(),!1;f.push(e)}const d=c[0].id,p=a.call(this,f);for(let t=0;t<p.length;t++)if(p[t].length){const n=e.filter((e=>e.feaGroupIndex===t));if(!n.length)return this.En(),this.setToRedraw(),!1;if(n[0].geometry.properties.aFeaIds.indexOf(d)<0)return this.En(),this.setToRedraw(),!1}const m=Q$4({},o),y=p.map((t=>this.createVectorPacks(r,s,m,t,n[0],i)));return Promise.all(y).then((t=>{for(let n=0;n<t.length;n++){let i;if(Array.isArray(e)){for(let t=0;t<e.length;t++)if(e[t].feaGroupIndex===n){i=e[t];break}}else i=e;i&&this.Hn(i,d,t[n])}})),!0}Hn(t,e,n){const i=t.geometry.properties.aFeaIds,r=i.indexOf(e);if(!(r<0)){if(n){const e=n.data.dynamicAttributes,i=n.data.featureIds.length,s=n.data.data;for(const n in s)if(!e[n]&&at$3(s,n)&&s[n]){const e=s[n];t.geometry.updateSubData(n,e,r*e.length/i)}}else{let n=r+1;for(;i[n]===e;)n++;const s=n-r,o=t.geometry.desc.positionSize;De$2.length!==3*s&&(De$2=new Float32Array(s*o),De$2.fill(-1/0,0)),t.geometry.updateSubData(t.geometry.desc.positionAttribute,De$2,r*o)}this.layer.fire("updatemesh"),this.setToRedraw()}}nn(t){if(!Object.keys(this.$e).length)return void(this.hn&&(this.Qe.deleteMesh(this.hn),delete this.hn));const{features:e,center:n}=this.gn(this.$e);if(!e.length)return;const i=this.un;this.Ln=n;const r=this.Nn(e),s=Q$4({},Me$2),o=r.map(((e,i)=>this.createMesh(this.Qe,Is$2,s,e,t&&t[i],n)));this.zn=!0,Promise.all(o).then((t=>{this.hn&&this.Qe.deleteMesh(this.hn);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){for(let t=0;t<r.length;t++){const n=r[t];n.feaGroupIndex=i,e.push(n),n.geometry.properties.originElements=n.geometry.properties.elements.slice()}n[i]=t[i].atlas}}this.hn=e,this.an=n,i&&(this.un=i),this.zn=!1,this.setToRedraw(),this.layer.fire("buildlinemesh")}))}Nn(t){const e=(Ce$2+"lineDasharray").trim(),n=(Ce$2+"linePatternFile").trim(),i=[],r=[],s=[];for(let o=0;o<t.length;o++){const a=t[o],l=a.properties&&a.properties[e];l&&Ge$2(l)?s.push(a):a.properties&&a.properties[n]?r.push(a):i.push(a)}return[i,r,s]}Vn(){this.in=!0,this.setToRedraw()}En(){this.qe=!0,this.setToRedraw()}Un(t){const e=this.layer.getId();for(let n=0;n<t.length;n++){const i=t[n];let r=!1;for(let t=0;t<this.GeometryTypes.length;t++)if(i instanceof this.GeometryTypes[t]){r=!0;break}if(!r)throw new Error(`${i.getJSONType()} can't be added to ${this.layer.getJSONType()}(id:${e}).`);this.Cn(i)}}Cn(t){void 0===t[Te$2]&&(t[Te$2]=this.L++);const e=t[Te$2];this.features[e]&&this.jn(e),this.features[e]=Oe$2(t,this.Je,this.features[e]);return this.Bn(this.features[e],e),this.Be[e]=t,e}Bn(t,e){if(!t)return;const n=Array.isArray(t)?t[0].id:t.id;if(this.We[n]=t,Array.isArray(t))for(let n=0;n<t.length;n++){const i=t[n][Ee$2];if(t[n][Te$2]=e,this.Ge[i]={feature:t[n]},this.Ge[i][Te$2]=e,!this.needCheckPointLineSymbols())continue;const r={feature:t[n]};(ze$2(t[n])||Ve$2(t[n]))&&(this.Xe[i]=r),Ve$2(t[n])&&(this.Ye[i]=r),Be$2(t[n])&&(this.$e[i]=r)}else{t[Te$2]=e;const n={feature:t},i=t[Ee$2];if(this.Ge[i]=n,!this.needCheckPointLineSymbols())return;(ze$2(t)||Ve$2(t))&&(this.Xe[i]=n),Ve$2(t)&&(this.Ye[i]=n),Be$2(t)&&(this.$e[i]=n)}}needCheckPointLineSymbols(){return!0}jn(t){const e=this.features[t];if(e)if(Array.isArray(e))for(let t=0;t<e.length;t++){const n=e[t][Ee$2];delete this.We[e[t].id],delete this.Ge[n],delete this.Xe[n],delete this.Ye[n],delete this.$e[n]}else{const t=e[Ee$2];delete this.We[e.id],delete this.Ge[t],delete this.Xe[t],delete this.Ye[t],delete this.$e[t]}}pick(t,e,n){const i=[];return this.layer.isVisible()?([this.painter,this.Ze,this.Qe].forEach((r=>{if(!r)return;const s=r.pick(t,e,n.tolerance);if(s&&s.data&&s.data.feature){const e=this.Be[s.data.feature[Te$2]];n&&n.includeInternals?i.push(e):(s.geometry=e,delete s.plugin,delete s.data,delete s.point,i.push(s))}})),i):i}Gn(t){const n=this.features[t[Te$2]];return Array.isArray(n)?n[0][Ee$2]:n[Ee$2]}dn(){let t=!1;for(const e in this.Ke){const n=this.Ke[e],i=this.Gn(n);if(!this.kn&&(this.Xe[i]||this.Ye[i])){const e=this.Fn(n);t=t||e}if(!this.zn&&this.$e[i]){const e=this.Dn(n);t=t||e}if(!this.Wn){const e=this.updateMesh(n);t=t||e}}this.Ke={},t&&(Ne$2(this),this.layer.fire("partialupdate"))}Xn(t){this.Cn(t),this.En(),Ne$2(this)}onGeometryAdd(t){this.setToRedraw(),this.canvas&&t&&t.length&&(this.Un(t),this.En(),Ne$2(this))}onGeometryRemove(t){if(t&&t.length){for(let e=0;e<t.length;e++){const n=t[e][Te$2];void 0!==n&&(delete this.Be[n],this.jn(n),delete this.features[n])}this.En(),Ne$2(this)}}onGeometrySymbolChange(t){const e=t.target._getParent()||t.target,n=e[Te$2];if(void 0===n)return;let i=t.properties;if(Array.isArray(i)){const t={};for(let e=0;e<i.length;e++)i[e]&&Q$4(t,i[e]);i=t}else if(i&&void 0!==i[0]){const t={};for(const e in i)i[e]&&Q$4(t,i[e]);i=t}for(const t in i)if(at$3(i,t)&&Ia$1[t])return void this.Xn(e);const r=e._getInternalSymbol(),s=this.features[n];if(this.Cn(e),s)if(function(t,e){return Array.isArray(t)?!!Array.isArray(e)&&t.length===e.length:!Array.isArray(e)}(r,s)){if(Array.isArray(r)){for(let t=0;t<r.length;t++)if(!We$2(r[t],s[t]))return void this.Xn(e)}else if(!We$2(r,s))return void this.Xn(e);this.onGeometryPositionChange(t)}else this.Xn(e);else this.Xn(e)}onGeometryShapeChange(t){const e=t.target._getParent()||t.target;void 0!==e[Te$2]&&(this.Un([e]),this.Vn(),Ne$2(this))}onGeometryPositionChange(t){const e=t.target._getParent()||t.target,n=e[Te$2];void 0!==n&&(this.Un([e]),this.Ke[n]=e,Ne$2(this))}onGeometryZIndexChange(t){void 0!==(t.target._getParent()||t.target)[Te$2]&&this.En()}onGeometryShow(t){void 0!==(t.target._getParent()||t.target)[Te$2]&&this.Yn(t)}onGeometryHide(t){void 0!==(t.target._getParent()||t.target)[Te$2]&&this.Yn(t)}Yn(t){const e=t.target,i=this.features[e[Te$2]];if(i){const t=e.isVisible();if(Array.isArray(i)){if(t===i[0].visible)return;for(let e=0;e<i.length;e++)i[e].visible=t}else{if(t===i.visible)return;i.visible=t}this.$n(),Ne$2(this)}}$n(){this.un=!0}onGeometryPropertiesChange(t){const e=t.target._getParent()||t.target,n=e[Te$2];void 0!==n&&(this.features[n]=Oe$2(e,this.Je),this.Bn(this.features[n],n),this.En(),Ne$2(this))}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;t?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):this.ot(),t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.prepareRequestors(),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=this.createPainter();const e=we$2.get3DPainterClass("icon");let n=e.getBloomSymbol();const i=Q$4({},_e$2,Se$2);i.markerPerspectiveRatio=this.layer.options.markerPerspectiveRatio||0,this.qn(i,n),this.In=i;const r=Q$4({},ft$3,this.layer.options.sceneConfig||{});this.Ze=new e(this.regl,this.layer,i,r,0),this.Ze.setTextShaderDefines({REVERSE_MAP_ROTATION_ON_PITCH:1});const s=we$2.get3DPainterClass("line"),o=Q$4({},Me$2);n=s.getBloomSymbol(),this.qn(o,n),this.Jn=o;const a=Q$4({},this.layer.options.sceneConfig||{});void 0===a.depthMask&&(a.depthMask=!0),this.Qe=new s(this.regl,this.layer,o,a,0),this.layer.getGeometries()&&this.onGeometryAdd(this.layer.getGeometries())}st(){return!!(this.canvas&&this.canvas.gl&&this.canvas.gl.wrap)}qn(t,e){for(let n=0;n<e.length;n++)t[e[n]]=this.layer.options.enableBloom}updateBloom(t){this.Ze&&this.Kn(this.Ze,this.In,t),this.Qe&&this.Kn(this.Qe,this.Jn,t),this.painter&&this.Kn(this.painter,this.painterSymbol,t)}Kn(t,e,n){const i=t.constructor.getBloomSymbol().reduce(((t,i)=>(t[i]=n,e[i]=n,t)),{});t.updateSymbol(i,e)}createPainter(){}ot(){const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0,antialias:!1};t.preserveDrawingBuffer=!0,t.stencil=!0,this.glOptions=t,this.gl=this.gl||this.ut(this.canvas,t),this.regl=a$2({gl:this.gl,attributes:t,extensions:L$6.WEBGL_EXTENSIONS,optionalExtensions:L$6.WEBGL_OPTIONAL_EXTENSIONS})}ut(t,e){const n=["webgl","experimental-webgl"];let i=null;for(let r=0;r<n.length;++r){try{i=t.getContext(n[r],e)}catch(t){}if(i)break}return i}clearCanvas(){super.clearCanvas(),this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:255})}resizeCanvas(t){super.resizeCanvas(t);const e=this.canvas;e&&(!this.pickingFBO||this.pickingFBO.width===e.width&&this.pickingFBO.height===e.height||this.pickingFBO.resize(e.width,e.height),this.painter&&this.painter.resize(e.width,e.height))}onRemove(){super.onRemove(),this.painter&&(this.painter.delete(),delete this.painter),this.Ze&&(this.Ze.delete(),delete this.Ze),this.Qe&&(this.Qe.delete(),delete this.Qe)}drawOutline(t){if(this.Mt&&(this.painter&&this.painter.outlineAll(t),this.Ze.outlineAll(t),this.Qe.outlineAll(t)),this.Zn)for(let e=0;e<this.Zn.length;e++)this.painter&&this.painter.outline(t,this.Zn[e]),this.Ze.outline(t,this.Zn[e]),this.Qe.outline(t,this.Zn[e])}outlineAll(){this.Mt=!0,this.setToRedraw()}outline(t){this.Zn||(this.Zn=[]);const e=[];for(let n=0;n<t.length;n++){const i=this.layer.getGeometryById(t[n]);if(i){const t=this.features[i[Te$2]];if(Array.isArray(t))for(let n=0;n<t.length;n++)e.push(t[n].id);else e.push(t.id)}}this.Zn.push(e),this.setToRedraw()}cancelOutline(){delete this.Mt,delete this.Zn,this.setToRedraw()}isEnableWorkAround(t){return"win-intel-gpu-crash"===t&&this.layer.options.workarounds["win-intel-gpu-crash"]&&He$2(this.gl)}gt(t){return lt$3(t,this.getMap())}je(){const t=this.layer.getGeometries();t&&this.Un(t),this.En()}ne(){const t=this.layer.options.opacity;return this.st()?rt$3(t)?1:t:1}}function Ne$2(t){t.setToRedraw()}function He$2(t){const e=t.getExtension("WEBGL_debug_renderer_info");if(e&&"undefined"!=typeof navigator){const n=t.getParameter(e.UNMASKED_RENDERER_WEBGL),i="Win32"===navigator.platform||"Win64"===navigator.platform;if(n&&n.toLowerCase().indexOf("intel")>=0&&i)return!0}return!1}function ze$2({properties:t}){const e=(Ce$2+"markerFile").trim(),n=(Ce$2+"markerType").trim();return t[e]||t[n]}function Ve$2({properties:t}){return t[(Ce$2+"textName").trim()]}const Ue$2=(Ce$2+"lineWidth").trim(),je$2="_line_gradient_property".trim();function Be$2(t){return 2===t.type&&!t.properties[je$2]||3===t.type&&void 0!==t.properties[Ue$2]}function Ge$2(t){if(!Array.isArray(t))return 0;let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function We$2(t,e){if(Object.keys(t).sort().join()!==Object.keys(e.properties||{}).filter((t=>0===t.indexOf(Ce$2))).map((t=>t.substring(Ce$2.length))).sort().join())return!1;for(const n in t)if(at$3(t,n)){const i=(Ce$2+n).trim();if(isFunctionDefinition(t[n])!==isFunctionDefinition(e.properties[i]))return!1}return!0}function Xe$2(e,n,i){if(!e||e.type!==n)return null;const r=new i(e.id,e.options),s=e.geometries,o=[];for(let e=0;e<s.length;e++){const n=t__namespace.Geometry.fromJSON(s[e]);n&&o.push(n)}return r.addGeometry(o),r}class Ye$2 extends we$2{static fromJSON(t){return Xe$2(t,"PointLayer",Ye$2)}constructor(...t){super(...t),this.options.sceneConfig||(this.options.sceneConfig=Q$4({},ft$3))}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}}Ye$2.mergeOptions({glyphSdfLimitPerFrame:15,iconErrorUrl:null,workarounds:{"win-intel-gpu-crash":!0},collision:!1,collisionFrameLimit:1}),Ye$2.registerJSONType("PointLayer"),Ye$2.registerRenderer("canvas",null),Ye$2.registerRenderer("gl",class extends Le$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.Marker,t__namespace.MultiPoint]}onGeometryAdd(t){t&&(Array.isArray(t)?t.forEach((t=>{t.options.maxMarkerWidth=t.options.maxMarkerHeight=255})):t.options.maxMarkerWidth=t.options.maxMarkerHeight=255,super.onGeometryAdd(t))}});class $e$2 extends we$2{static fromJSON(t){return Xe$2(t,"LineStringLayer",$e$2)}}$e$2.mergeOptions({meshRenderOrder:1}),$e$2.registerJSONType("LineStringLayer");const qe$2="_line_gradient_property".trim();$e$2.registerRenderer("gl",class extends Le$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.LineString,t__namespace.MultiLineString]}createPainter(){const t=we$2.get3DPainterClass("line-gradient");this.painterSymbol=Q$4({},{lineGradientProperty:qe$2},Me$2),this.qn(this.painterSymbol,t.getBloomSymbol());const e=Q$4({},this.layer.options.sceneConfig||{});return void 0===e.depthMask&&(e.depthMask=!0),new t(this.regl,this.layer,this.painterSymbol,e,0)}buildMesh(){let{features:t,center:e}=this.gn();if(t=t.filter((t=>!!t.properties[qe$2])),!t.length)return;const n=this.un;this.Qn=e;const i=Q$4({},this.painterSymbol),r=this.createMesh(this.painter,Is$2,i,t,null,e);this.Wn=!0,r.then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes);const e=[],i=t&&t.meshes;if(i){e.push(...i);for(let t=0;t<i.length;t++)i[t].feaGroupIndex=0,i[t].geometry.properties.originElements=i[t].geometry.properties.elements.slice()}this.meshes=e,n&&(this.un=n),this.Wn=!1,this.setToRedraw()}))}}),$e$2.registerRenderer("canvas",null);class Je$2 extends we$2{static fromJSON(t){return Xe$2(t,"PolygonLayer",Je$2)}}Je$2.registerJSONType("PolygonLayer");const Ke$2={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonPatternFile:{type:"identity",default:void 0,property:"_symbol_polygonPatternFile"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},uvScale:{type:"identity",default:[1,1],property:"_symbol_uvScale"},uvOffset:{type:"identity",default:[0,0],property:"_symbol_uvOffset"},uvOffsetInMeter:{type:"identity",default:!1,property:"_symbol_uvOffsetInMeter"},polygonPatternFileWidth:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileWidth"},polygonPatternFileHeight:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileHeight"},polygonPatternFileOrigin:{type:"identity",default:void 0,property:"_symbol_polygonPatternFileOrigin"},polygonPatternUV:{type:"identity",default:void 0,property:"_symbol_polygonPatternUV"}};class Ze$2 extends Le$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.Polygon,t__namespace.MultiPolygon]}getPolygonOffsetCount(){return this.options.altitude>0?0:2}buildMesh(t){const{features:e,center:n}=this.gn();if(!e.length)return;const i=this.un;this.Qn=n;const r=this.ti(e),s=Q$4({},Ke$2),o=r.map(((e,i)=>this.createMesh(this.painter,Qs$2,s,e,t&&t[i],n)));this.Wn=!0,Promise.all(o).then((t=>{this.meshes&&this.painter.deleteMesh(this.meshes),t=function(t){const e=[];for(let n=0;n<t.length;n++)Array.isArray(t[n])?e.push(...t[n]):e.push(t[n]);return e}(t);const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i]&&t[i].meshes;if(r){e.push(...r);for(let t=0;t<r.length;t++)r[t].feaGroupIndex=i,r[t].geometry.properties.originElements=r[t].geometry.properties.elements.slice(),1===i&&(r[t].transparent=!0);n[i]=t[i].atlas}}this.meshes=e,this.atlas=n,i&&(this.un=i),this.Wn=!1,this.setToRedraw(),this.layer.fire("buildmesh")}))}getRayCastData(t,e){const n=this.painter.getRayCastData(t,e);if(!n||!n.feature)return null;return this.Be[n.feature[Te$2]]}ti(t){const e=[],n=[];for(let i=0;i<t.length;i++){const r=t[i];r.properties&&r.properties._symbol_polygonOpacity<1?n.push(r):e.push(r)}return[e,n]}createPainter(){const t=we$2.get3DPainterClass("fill"),e=this.painterSymbol=Q$4({},Ke$2);return this.qn(e,t.getBloomSymbol()),new t(this.regl,this.layer,e,this.layer.options.sceneConfig,0)}updateMesh(t){return this.Rn(t,this.meshes,this.atlas,this.Qn,this.painter,Qs$2,Ke$2,this.ti)}}function Qe$2(t,e,n,i,r,s,o){const a=n&&Array.isArray(n[0]);for(let l=0,h=n.length;l<h;l++){t[e]=(a?n[l][0]:n[l].x)*i,t[e+1]=(a?n[l][1]:n[l].y)*i,o!==Float32Array&&(t[e]=Math.round(t[e]),t[e+1]=Math.round(t[e+1]));let u=r||0;Array.isArray(r)&&(u=r[l]),u=u?Math.round(i*u):0,t[e+2]=u,e+=3,s&&0!==l&&l!==h-1&&(t[e]=t[e-3],t[e+1]=t[e-2],t[e+2]=t[e-1],e+=3)}return t.trySetLength&&t.trySetLength(e),e}function tn$2(t,e,n,i){const r=t[3*e],s=t[3*e+1];return r===t[3*n]&&(r<0||r>i)||s===t[3*n+1]&&(s<0||s>i)}Je$2.registerRenderer("gl",Ze$2),Je$2.registerRenderer("canvas",null);const en$2=Math.PI/180,nn$2=6378137*Math.PI/180;function rn$2(t,e,n){if("EPSG:3857"===n)return function(t,e){const n=85.0511287798,i=e[0],r=Math.max(Math.min(n,e[1]),-n);let s;return s=0===r?0:Math.log(Math.tan((90+r)*en$2/2))/en$2,t[0]=i*nn$2,t[1]=s*nn$2,t}(t,e);if("EPSG:4326"===n||"EPSG:4490"===n||"identity"===n)return sn$2(t,e);if("baidu"===n)return sn$2(t,e);throw new Error("unsupported projection:"+n)}function sn$2(t,e){return t[0]=e[0],t[1]=e[1],t}function an$2(t,e,n,i){const r=n[0]-i[0],s=n[1]-i[1];let o=(e[0]-n[0])*(n[0]-i[0])+(e[1]-n[1])*(n[1]-i[1]);return o/=r*r+s*s,t[0]=n[0]+o*r,t[1]=n[1]+o*s,t}function ln$2(t,e,n,i,r){return h=i,u=r,c=t[3*e[n-1]],f=t[3*e[n-1]+1],Math.sqrt((c-h)*(c-h)+(f-u)*(f-u));var h,u,c,f}function hn$2(t,e,n,i,r,s,o,a,l,h,u,c,f,d,p,m,y){const g=e.length,v=r/3;for(let n=2,i=g;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-o;r+=g;for(let n=2,i=g;n<i;n+=3)t[r+n-2]=e[n-2],t[r+n-1]=e[n-1],t[r+n-0]=e[n]-a;t.trySetLength((r+=g)+g),t.copyWithin(r,r-2*g,r-g),t.trySetLength((r+=g)+g),t.copyWithin(r,r-2*g,r-g),r+=g,(n=n||[]).push(g/3);for(let e=0;e<n.length;e++)un$2(v+(n[e-1]||0),v+n[e],t,g/3,l,i,h,u,c,f,s,d,p,m,y);return r}function un$2(t,e,n,i,r,s,o,a,l,h,u,c,f,d,p){const m=s.length;let y,g;for(let o=t,a=e;o<a-1;o++)y=o,g=o+1,r!==1/0&&tn$2(n,y,g,r)||((o-t)%2==1&&(y+=2*i,g+=2*i),p?(s.push(y+i,g,y),s.push(g+i,g,y+i)):(s.push(y+i,y,g),s.push(g,g+i,y+i)));o&&function(t,e,n,i,r,s,o,a,l,h,u){let c,f=0,d=0,p=0,m=0;const y=u?[1,3,4]:[2,3,4];for(let u=s.length-1;u>=0;u--){const g=s[u],x=3*g+2,b=r[3*g],A=r[3*g+1],w=r[x];f||d||(f=Math.max(r[x],r[3*s[u-3]+2]),d=Math.min(r[x],r[3*s[u-3]+2]),c=f-d);let _=p;const S=u%6;0===t?(5===S&&(m=ln$2(r,s,u,b,A)),_=S===y[0]||S===y[1]||S===y[2]?p:p+m):1===t&&(S===y[0]||S===y[1]||S===y[2]?_=0:5===S?(m=ln$2(r,s,u,b,A),_=m):_=m);let P;P=1===e?w===f?1:0:"bottom"===n?w===f?c/100/a:0:w===f?0:-c/100/a,i[2*g]=_/l*(1/(100*h))/o,i[2*g+1]=P,0===S&&(p+=m)}}(a,l,h,u,n,s.slice(m,s.length),c[0],c[1],f,d,p)}function cn$2(t){const e=[t[0]];let n=t[0];for(let i=1;i<t.length;i++)Array.isArray(t[i])?t[i][0]===n[0]&&t[i][1]===n[1]&&t[i][2]===n[2]||e.push(t[i]):t[i].x===n.x&&t[i].y===n.y&&t[i].z===n.z||e.push(t[i]),n=t[i];return e}const fn$2=Er$3.getInstance();function dn$2(t,e,n,i,r,s,o,a,l,h,u,c,f,d,m,v){void 0===e.top&&(e.top=!0),void 0===e.side&&(e.side=!0),fn$2.reset();const{altitudeScale:x,altitudeProperty:b,defaultAltitude:w,heightProperty:_,minHeightProperty:S,defaultHeight:M,tangent:P,uv:T,topUVMode:k,sideUVMode:F,sideVerticalUVMode:C,top:E,side:D,textureYOrigin:R,topThickness:L}=e,N=!!v,H=function(t,e,{altitudeScale:n,altitudeProperty:i,defaultAltitude:r,heightProperty:s,minHeightProperty:o,defaultHeight:a},{center:l,side:h,top:u,topThickness:c,uvOrigin:f,uv:d,uvSize:p,topUVMode:m,sideUVMode:y,sideVerticalUVMode:g,textureYOrigin:v,tileRatio:x,centimeterToPoint:b,verticalCentimeterToPoint:w,positionType:_,res:S,glScale:M,projectionCode:P},T,k){let I=e/t[0].extent;e===1/0&&(I=1);const F=e===1/0,C=k.get(),E=k.get(),D=k.get(),R=k.get(),L=k.get(),N=k.get(),H=k.get(),z=!!d,V=!!u,j=!!h,B=z?k.get():null;function G(t,n,i,r,s,o){let a=n;if(V){const r=earcut$1.exports(R,i,3);if(0===r.length)return n;if(st$3(L,R),n+=R.length,o)for(let e=2,n=r.length;e<n;e+=3)r[e]+=t/3,r[e-1]+=t/3,r[e-2]+=t/3;else{let e;for(let n=2,i=r.length;n<i;n+=3)e=r[n-1],r[n-1]=r[n]+t/3,r[n]=e+t/3,r[n-2]+=t/3}st$3(N,r),z&&function(t,e,n,i,r,s,o,a,l,h,u,c,f,d,p){0===t?function(t,e,n,i,r,s,o,a,l,h){const u=1/(100*s[0]),c=1/(100*s[1]),f=h&&h[0]||0,d=h&&h[1]||0,p=[0,0];for(let r=t;r<e;r+=3){const t=r/3*2,s=i[r+1]-d;n[t]=p[0]+(i[r]-f)/o*u/a,n[t+1]=p[1]-s/o*c/l}}(e,n,i,r,0,o,a,l,h,p):1===t&&function(t,e,n,i,r,s,o,a,l,h,u){if(!t)return;let c,f,d,p;0===t[4]?(c=t[0],f=t[1],d=t[2],p=t[3]):(c=t[1],f=t[2],d=t[3],p=t[0]);const m=distance(c,f),y=distance(f,d),g=[],v=[],x=[];for(let t=e;t<n;t+=3){const e=t/3*2;set(g,(s.x/l+r[t]/o)*a,s.y/l*a+(u?r[t+1]:-r[t+1])/o*a),"EPSG:4326"!==h&&"EPSG:4490"!==h||rn$2(g,g,"EPSG:3857"),an$2(v,g,c,f),an$2(x,g,p,c),i[e]=distance(c,v)/m,i[e+1]=distance(c,x)/y}}(u,e,n,i,r,s,a,c,f,d,!!p)}(m||0,t,n,B,L,f,b,x,p[0],p[1],s,S,M,P,l),c>0&&!j&&(n=hn$2(L,R,i,N,n,B,0,c,e,z,y||0,g||0,v,p,x,w,o)),H.setLength(n/3),H.fill(1,a/3,n/3)}if(j){V&&(c=0),a=n,n=hn$2(L,R,i,N,n,B,c,r,e,z,y||0,g||0,v,p,x,w,o),H.setLength(n/3);const t=R.length/3;H.fill(1,a/3,a/3+t),H.fill(0,a/3+t,a/3+2*t),H.fill(1,a/3+2*t,a/3+3*t),H.fill(0,a/3+3*t,n/3)}return n}let W=0,X=0;const Y=[-1,-1,e+1,e+1];let $=0,q=t.length;et$3(T)&&($=T,q=T+1);let J=0,K=!1;const Z=k.get();for(;$<q;$++){const l=t[$],h=l.id;et$3(h)&&(Math.abs(h)>J&&(J=Math.abs(h)),h<0&&(K=!0));const u=l.geometry,c=l.properties.maptalks_ombb;let f=Array.isArray(c&&c[0]&&c[0][0])?c[0]:c;const{altitude:d,height:p}=Fa.getFeaAltitudeAndHeight(l,n,i,r,s,a,o);W=Math.max(Math.abs(d),W);const m=L.length;let y=0,g=X;Z.setLength(0),R.setLength(0);const v=Fa.calculateSignedArea(u[0])<0;for(let t=0,n=u.length;t<n;t++){let i=u[t];v&&(i=i.reverse()),i=cn$2(i);const r=Fa.calculateSignedArea(i)<0;if(!r&&t>0&&(y++,f=c&&c[y],X=G(g,X,Z,p*I,f,F),R.setLength(0),Z.setLength(0),g=X),e!==1/0&&(i=Fa.clipPolygon(i,Y)),!i.length){t===n-1&&(X=G(g,X,Z,p*I,f,F));continue}const s=i.length;Array.isArray(i[0])?i[0][0]===i[s-1][0]&&i[0][1]===i[s-1][1]||i.push([i[0][0],i[0][1]]):i[0].x===i[s-1].x&&i[0].y===i[s-1].y||i.push(i[0]),r&&Z.push(R.length/3),Qe$2(R,R.length,i,I,d,!1,_),t===n-1&&(X=G(g,X,Z,p*I,f,F))}const x=L.length-m,b="__fea_idx".trim();for(let t=0;t<x/3;t++)E.push(void 0===l[b]?$:l[b]),C.push($),et$3(h)&&D.push(h)}const Q=Fa.getUnsignedArrayType(E.length?E[E.length-1]:0),tt={maxAltitude:W,vertices:L,verticeTypes:H,indices:N,pickingIds:Er$3.createTypedArray(E,Q),featureIndexes:C};if(D.length){const t=K?Fa.getPosArrayType(J):Fa.getUnsignedArrayType(J);tt.featureIds=Er$3.createTypedArray(D,t)}else tt.featureIds=[];return B&&(B.setLength(L.length/3*2),tt.uvs=B),tt}(t,n,{altitudeScale:x,altitudeProperty:b,defaultAltitude:w||0,heightProperty:_,minHeightProperty:S,defaultHeight:M||0},{center:v,top:E,side:D,topThickness:10*L||0,uv:T||P,uvSize:[r,r],uvOrigin:i,topUVMode:k,sideUVMode:F,sideVerticalUVMode:C,textureYOrigin:R,tileRatio:a,centimeterToPoint:l,verticalCentimeterToPoint:h,positionType:m,res:s,glScale:o,projectionCode:f},d,fn$2),W=[],X=H.vertices.length/3,Y=Fa.getIndexArrayType(X),$=Er$3.createTypedArray(H.indices,Y);delete H.indices,W.push($.buffer,H.pickingIds.buffer);const q=P?fn$2.get():new Float32Array(3*X);q.setLength&&q.setLength(3*X);const J=buildNormals(H.vertices,$,q);let K=!0;for(let t=0;t<J.length;t++){N||(J[t]=-J[t]);const e=J[t]%1;1-Math.abs(e)>1e-6?K=!1:0!==e&&(J[t]=Math.round(J[t]))}if(H.normals=J,P){let t=fn$2.get();t.setLength(4*X),t=buildTangents(H.vertices,H.normals,H.uvs,$,t),t=function(t,e){const n=new Float32Array(e.length),i=[],r=[],s=[];for(let o=0;o<e.length;o+=4){const a=o/4*3;set$4(r,t[a]||0,t[a+1]||0,t[a+2]||0),set$3(i,e[o]||0,e[o+1]||0,e[o+2]||0,e[o+3]||0),packTangentFrame(s,r,i),copy$3(n.subarray(o,o+4),s)}return n}(H.normals,t),H.tangents=t,W.push(t.buffer),delete H.normals}if(H.normals&&(K&&(H.normals=Er$3.createTypedArray(H.normals,Int8Array)),W.push(H.normals.buffer)),H.uvs){H.uvs=Er$3.createTypedArray(H.uvs,Float32Array),W.push(H.uvs.buffer)}if(v){const t=H.vertices;for(let e=0;e<t.length;e+=3)t[e]-=v[0],t[e+1]-=v[1]}const Z=m||Fa.getPosArrayType(Math.max(512,H.maxAltitude)),Q=function(t,e,n,i){const r={},s={};if(ot$3(e.polygonFill)){let o=piecewiseConstant(e.polygonFill);const a=new Uint8Array(4*i.length);a.fill(255);for(let e=0;e<i.length;e++){const s=t[i[e]],l=s.properties||{};l.$layer=s.layer,l.$type=s.type;let h=o(n,l);isFunctionDefinition(h)&&(r.aColor=1,o=piecewiseConstant(h),h=o(n,l)),delete l.$layer,delete l.$type,nt$4.normalizeColor(pn$2,h),a[4*e]=pn$2[0],a[4*e+1]=pn$2[1],a[4*e+2]=pn$2[2],a[4*e+3]=pn$2[3]}s.aColor=a}if(ot$3(e.polygonOpacity)){let o=interpolated(e.polygonOpacity);const a=new Uint8Array(i.length);a.fill(255);for(let e=0;e<i.length;e++){const s=t[i[e]],l=s.properties||{};l.$layer=s.layer,l.$type=s.type;let h=o(n,l);isFunctionDefinition(h)&&(r.aOpacity=1,o=piecewiseConstant(h),h=o(n,l)),delete l.$layer,delete l.$type,a[e]=255*h}s.aOpacity=a}return s.dynamicAttributes=r,s}(t,u,c,H.featureIndexes),tt=function(t,e,n,i,r){const s=[[],[]],o=ot$3(i.topPolygonFill),a=ot$3(i.bottomPolygonFill),l=[255,255,255,255];if(o||a){let h=o&&piecewiseConstant(i.topPolygonFill),u=a&&piecewiseConstant(i.bottomPolygonFill),c=null,f=null,d=null,m=null;for(let i=0;i<e.length;i++){if(1===t[i]&&!o||0===t[i]&&!a)continue;const g=1===t[i];if(g&&e[i]===c){t[i]=d;continue}if(!g&&e[i]===f){t[i]=m;continue}const v=n[e[i]],x=v.properties||{};x.$layer=v.layer,x.$type=v.type;let b=g?h:u,A=b(r,x);isFunctionDefinition(A)&&(b=piecewiseConstant(A),A=b(r,x)),delete x.$layer,delete x.$type,nt$4.normalizeColor(pn$2,A),divide$1(pn$2,pn$2,l);let w=mn$2(s,pn$2);w<0&&(w=s.length,s.push(copy$3([],pn$2))),t[i]=w,g?(c=e[i],d=w):(f=e[i],m=w)}}return s.slice(2)}(H.verticeTypes,H.featureIndexes,t,u,c),nt={data:{data:{aVertexColorType:Er$3.createTypedArray(H.verticeTypes,tt.length<=252?Uint8Array:Uint16Array),aPosition:Er$3.createTypedArray(H.vertices,Z),aNormal:H.normals,aTexCoord0:H.uvs,aTangent:H.tangents,aPickingId:H.pickingIds},indices:$,properties:{maxAltitude:H.maxAltitude},dynamicAttributes:Q.dynamicAttributes,vertexColors:tt},buffers:W};return H.featureIds.length?(nt.data.featureIds=H.featureIds,W.push(nt.data.featureIds.buffer)):nt.data.featureIds=[],Q.aColor&&(nt.data.data.aColor=Q.aColor,nt.buffers.push(Q.aColor.buffer)),Q.aOpacity&&(nt.data.data.aOpacity=Q.aOpacity,nt.buffers.push(Q.aOpacity.buffer)),nt.buffers.push(nt.data.data.aPosition.buffer),nt.data.pickingIdIndiceMap=Fa.generatePickingIndiceIndex(nt.data.data.aPickingId,nt.data.indices),nt}const pn$2=[];function mn$2(t,e){for(let n=0;n<t.length;n++)if(exactEquals$3(e,t[n]))return n;return-1}class yn$2{constructor(t=[],e=gn$2){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let t=(this.length>>1)-1;t>=0;t--)this.ei(t)}push(t){this.data.push(t),this.length++,this.ni(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this.ei(0)),t}peek(){return this.data[0]}ni(t){const{data:e,compare:n}=this,i=e[t];for(;t>0;){const r=t-1>>1,s=e[r];if(n(i,s)>=0)break;e[t]=s,t=r}e[t]=i}ei(t){const{data:e,compare:n}=this,i=this.length>>1,r=e[t];for(;t<i;){let i=1+(t<<1),s=e[i];const o=i+1;if(o<this.length&&n(e[o],s)<0&&(i=o,s=e[o]),n(s,r)>=0)break;e[t]=s,t=i}e[t]=r}}function gn$2(t,e){return t<e?-1:t>e?1:0}var vn$2={exports:{}},xn$2=function(t,e,n,i){var r=t[0],s=t[1],o=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var a=(i-n)/2,l=0,h=a-1;l<a;h=l++){var u=e[n+2*l+0],c=e[n+2*l+1],d=e[n+2*h+1];c>s!=d>s&&r<(e[n+2*h+0]-u)*(s-c)/(d-c)+u&&(o=!o)}return o},bn$2=function(t,e,n,i){var r=t[0],s=t[1],o=!1;void 0===n&&(n=0),void 0===i&&(i=e.length);for(var a=i-n,l=0,h=a-1;l<a;h=l++){var u=e[l+n][0],c=e[l+n][1],d=e[h+n][1];c>s!=d>s&&r<(e[h+n][0]-u)*(s-c)/(d-c)+u&&(o=!o)}return o};vn$2.exports=function(t,e,n,i){return e.length>0&&Array.isArray(e[0])?bn$2(t,e,n,i):xn$2(t,e,n,i)};var An$2=vn$2.exports.nested=bn$2;function wn$2(t,e,n,i,r){let s,o,a,l,h=e[0],u=i[0],c=0,f=0;u>h==u>-h?(s=h,h=e[++c]):(s=u,u=i[++f]);let d=0;if(c<t&&f<n)for(u>h==u>-h?(o=h+s,a=s-(o-h),h=e[++c]):(o=u+s,a=s-(o-u),u=i[++f]),s=o,0!==a&&(r[d++]=a);c<t&&f<n;)u>h==u>-h?(o=s+h,l=o-s,a=s-(o-l)+(h-l),h=e[++c]):(o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++f]),s=o,0!==a&&(r[d++]=a);for(;c<t;)o=s+h,l=o-s,a=s-(o-l)+(h-l),h=e[++c],s=o,0!==a&&(r[d++]=a);for(;f<n;)o=s+u,l=o-s,a=s-(o-l)+(u-l),u=i[++f],s=o,0!==a&&(r[d++]=a);return 0===s&&0!==d||(r[d++]=s),d}function _n$2(t){return new Float64Array(t)}vn$2.exports.flat=xn$2;const Sn$2=_n$2(4),Mn$2=_n$2(8),Pn$2=_n$2(12),Tn$2=_n$2(16),kn$2=_n$2(4);function Fn$2(t,e,n,i,r,s,o){for(var a=new yn$2([],Cn$2),l=t.data;l;){for(var h=0;h<l.children.length;h++){var u=l.children[h],c=l.leaf?Vn$2(u,n,i):En$2(n,i,u);c>s||a.push({node:u,dist:c})}for(;a.length&&!a.peek().node.children;){var f=a.pop(),d=f.node,p=Vn$2(d,e,n),m=Vn$2(d,i,r);if(f.dist<p&&f.dist<m&&Rn$2(n,d,o)&&Rn$2(i,d,o))return d}(l=a.pop())&&(l=l.node)}return null}function Cn$2(t,e){return t.dist-e.dist}function En$2(t,e,n){if(Dn$2(t,n)||Dn$2(e,n))return 0;var i=Un$2(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===i)return 0;var r=Un$2(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===r)return 0;var s=Un$2(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===s)return 0;var o=Un$2(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===o?0:Math.min(i,r,s,o)}function Dn$2(t,e){return t[0]>=e.minX&&t[0]<=e.maxX&&t[1]>=e.minY&&t[1]<=e.maxY}function Rn$2(t,e,n){for(var i,r,s,o,a=Math.min(t[0],e[0]),l=Math.min(t[1],e[1]),h=Math.max(t[0],e[0]),u=Math.max(t[1],e[1]),c=n.search({minX:a,minY:l,maxX:h,maxY:u}),f=0;f<c.length;f++)if(r=c[f].next.p,s=t,(i=c[f].p)!==(o=e)&&r!==s&&Ln$2(i,r,s)>0!=Ln$2(i,r,o)>0&&Ln$2(s,o,i)>0!=Ln$2(s,o,r)>0)return!1;return!0}function Ln$2(t,e,n){return function(t,e,n,i,r,s){const o=(e-s)*(n-r),a=(t-r)*(i-s),l=o-a;if(0===o||0===a||o>0!=a>0)return l;const h=Math.abs(o+a);return Math.abs(l)>=33306690738754716e-32*h?l:-function(t,e,n,i,r,s,o){let a,l,h,u,c,f,d,p,m,y,g,v,x,b,A,w,_,S;const M=t-r,P=n-r,T=e-s,k=i-s;b=M*k,f=134217729*M,d=f-(f-M),p=M-d,f=134217729*k,m=f-(f-k),y=k-m,A=p*y-(b-d*m-p*m-d*y),w=T*P,f=134217729*T,d=f-(f-T),p=T-d,f=134217729*P,m=f-(f-P),y=P-m,_=p*y-(w-d*m-p*m-d*y),g=A-_,c=A-g,Sn$2[0]=A-(g+c)+(c-_),v=b+g,c=v-b,x=b-(v-c)+(g-c),g=x-w,c=x-g,Sn$2[1]=x-(g+c)+(c-w),S=v+g,c=S-v,Sn$2[2]=v-(S-c)+(g-c),Sn$2[3]=S;let O=function(t,e){let n=e[0];for(let i=1;i<4;i++)n+=e[i];return n}(0,Sn$2),I=22204460492503146e-32*o;if(O>=I||-O>=I)return O;if(c=t-M,a=t-(M+c)+(c-r),c=n-P,h=n-(P+c)+(c-r),c=e-T,l=e-(T+c)+(c-s),c=i-k,u=i-(k+c)+(c-s),0===a&&0===l&&0===h&&0===u)return O;if(I=11093356479670487e-47*o+33306690738754706e-32*Math.abs(O),O+=M*u+k*a-(T*h+P*l),O>=I||-O>=I)return O;b=a*k,f=134217729*a,d=f-(f-a),p=a-d,f=134217729*k,m=f-(f-k),y=k-m,A=p*y-(b-d*m-p*m-d*y),w=l*P,f=134217729*l,d=f-(f-l),p=l-d,f=134217729*P,m=f-(f-P),y=P-m,_=p*y-(w-d*m-p*m-d*y),g=A-_,c=A-g,kn$2[0]=A-(g+c)+(c-_),v=b+g,c=v-b,x=b-(v-c)+(g-c),g=x-w,c=x-g,kn$2[1]=x-(g+c)+(c-w),S=v+g,c=S-v,kn$2[2]=v-(S-c)+(g-c),kn$2[3]=S;const F=wn$2(4,Sn$2,4,kn$2,Mn$2);b=M*u,f=134217729*M,d=f-(f-M),p=M-d,f=134217729*u,m=f-(f-u),y=u-m,A=p*y-(b-d*m-p*m-d*y),w=T*h,f=134217729*T,d=f-(f-T),p=T-d,f=134217729*h,m=f-(f-h),y=h-m,_=p*y-(w-d*m-p*m-d*y),g=A-_,c=A-g,kn$2[0]=A-(g+c)+(c-_),v=b+g,c=v-b,x=b-(v-c)+(g-c),g=x-w,c=x-g,kn$2[1]=x-(g+c)+(c-w),S=v+g,c=S-v,kn$2[2]=v-(S-c)+(g-c),kn$2[3]=S;const C=wn$2(F,Mn$2,4,kn$2,Pn$2);b=a*u,f=134217729*a,d=f-(f-a),p=a-d,f=134217729*u,m=f-(f-u),y=u-m,A=p*y-(b-d*m-p*m-d*y),w=l*h,f=134217729*l,d=f-(f-l),p=l-d,f=134217729*h,m=f-(f-h),y=h-m,_=p*y-(w-d*m-p*m-d*y),g=A-_,c=A-g,kn$2[0]=A-(g+c)+(c-_),v=b+g,c=v-b,x=b-(v-c)+(g-c),g=x-w,c=x-g,kn$2[1]=x-(g+c)+(c-w),S=v+g,c=S-v,kn$2[2]=v-(S-c)+(g-c),kn$2[3]=S;const E=wn$2(C,Pn$2,4,kn$2,Tn$2);return Tn$2[E-1]}(t,e,n,i,r,s,h)}(t[0],t[1],e[0],e[1],n[0],n[1])}function Nn$2(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function Hn$2(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function zn$2(t,e){var n=t[0]-e[0],i=t[1]-e[1];return n*n+i*i}function Vn$2(t,e,n){var i=e[0],r=e[1],s=n[0]-i,o=n[1]-r;if(0!==s||0!==o){var a=((t[0]-i)*s+(t[1]-r)*o)/(s*s+o*o);a>1?(i=n[0],r=n[1]):a>0&&(i+=s*a,r+=o*a)}return(s=t[0]-i)*s+(o=t[1]-r)*o}function Un$2(t,e,n,i,r,s,o,a){var l,h,u,c,f=n-t,d=i-e,p=o-r,m=a-s,y=t-r,g=e-s,v=f*f+d*d,x=f*p+d*m,b=p*p+m*m,A=f*y+d*g,w=p*y+m*g,_=v*b-x*x,S=_,M=_;0===_?(h=0,S=1,c=w,M=b):(c=v*w-x*A,(h=x*w-b*A)<0?(h=0,c=w,M=b):h>S&&(h=S,c=w+x,M=b)),c<0?(c=0,-A<0?h=0:-A>v?h=S:(h=-A,S=v)):c>M&&(c=M,-A+x<0?h=0:-A+x>v?h=S:(h=-A+x,S=v));var P=(1-(u=0===c?0:c/M))*r+u*o-((1-(l=0===h?0:h/S))*t+l*n),T=(1-u)*s+u*a-((1-l)*e+l*i);return P*P+T*T}function jn$2(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}class Bn$2{constructor(t,e){this.x=t,this.y=e}clone(){return new Bn$2(this.x,this.y)}normalize(){const t=this.length();this.x/=t,this.y/=t}negate(){this.x=-this.x,this.y=-this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}diff(t){return new Bn$2(this.x-t.x,this.y-t.y)}distance(t){const e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}orthogonal(){return new Bn$2(this.y,-this.x)}}function Gn$2(t,e,n,i){const a=((n.x-t.x)*i.y-(n.y-t.y)*i.x)/(e.x*i.y-e.y*i.x);return new Bn$2(t.x+a*e.x,t.y+a*e.y)}const Wn$2=[],Xn$2=[];function Yn$2(t){if(et$3(t[0]&&t[0].x)){const e=[];let n=0;for(let i=0;i<t.length;i++)Xn$2[n]?(Xn$2[n][0]=t[i].x,Xn$2[n][1]=t[i].y):Xn$2[n]=[t[i].x,t[i].y],e.push(Xn$2[n]),n++;t=e}try{const e=function(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;var i=function(t){for(var e=t[0],n=t[0],i=t[0],r=t[0],s=0;s<t.length;s++){var o=t[s];o[0]<e[0]&&(e=o),o[0]>i[0]&&(i=o),o[1]<n[1]&&(n=o),o[1]>r[1]&&(r=o)}var a=[e,n,i,r],l=a.slice();for(s=0;s<t.length;s++)An$2(t[s],a)||l.push(t[s]);return function(t){t.sort(jn$2);for(var e=[],n=0;n<t.length;n++){for(;e.length>=2&&Ln$2(e[e.length-2],e[e.length-1],t[n])<=0;)e.pop();e.push(t[n])}for(var i=[],r=t.length-1;r>=0;r--){for(;i.length>=2&&Ln$2(i[i.length-2],i[i.length-1],t[r])<=0;)i.pop();i.push(t[r])}return i.pop(),e.pop(),e.concat(i)}(l)}(t),r=new RBush(16);r.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},r.compareMinX=function(t,e){return t[0]-e[0]},r.compareMinY=function(t,e){return t[1]-e[1]},r.load(t);for(var s,o=[],a=0;a<i.length;a++){var l=i[a];r.remove(l),s=Hn$2(l,s),o.push(s)}var h=new RBush(16);for(a=0;a<o.length;a++)h.insert(Nn$2(o[a]));for(var u=e*e,c=n*n;o.length;){var f=o.shift(),d=f.p,p=f.next.p,m=zn$2(d,p);if(!(m<c)){var y=m/u;(l=Fn$2(r,f.prev.p,d,p,f.next.next.p,y,h))&&Math.min(zn$2(l,d),zn$2(l,p))<=y&&(o.push(f),o.push(Hn$2(l,f)),r.remove(l),h.remove(f),h.insert(Nn$2(f)),h.insert(Nn$2(f.next)))}}f=s;var g=[];do{g.push(f.p),f=f.next}while(f!==s);return g.push(f.p),g}(t,1/0);let n=[1/0,1/0],i=[-1/0,-1/0];for(let t=0;t<e.length;t++)e[t][0]<n[0]&&(n[0]=e[t][0]),e[t][0]>i[0]&&(i[0]=e[t][0]),e[t][1]<n[1]&&(n[1]=e[t][1]),e[t][1]>i[1]&&(i[1]=e[t][1]);const r=[];let s=[],o=0;for(let t=0;t<e.length;t++)t===e.length-1&&e[t][0]===e[0][0]&&e[t][1]===e[0][1]||(rn$2(r,e[t],"EPSG:3857"),Wn$2[o]?(Wn$2[o].x=r[0],Wn$2[o].y=r[1]):Wn$2[o]=new Bn$2(r[0],r[1]),s.push(Wn$2[o]),o++);Fa.calculateSignedArea(s)<0&&(s=s.reverse());const a=function(t){let e,n=Number.MAX_VALUE;const i=function(t,i,r,s,o,a,l,h){var u=Gn$2(t,i,o,a),c=Gn$2(r,s,o,a),f=Gn$2(l,h,t,i),d=Gn$2(l,h,r,s),p=u.distance(c)*u.distance(f);0!==p&&p<n&&(e=[u,f,d,c],n=p)};var r=[];for(let e=0;e<t.length;e++)r.push(t[(e+1)%t.length].diff(t[e])),r[e].normalize();var s,o,a,l,h=new Bn$2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),u=new Bn$2(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(let e=0;e<t.length;e++){var c=t[e];c.x<h.x&&(h.x=c.x,s=e),c.x>u.x&&(u.x=c.x,o=e),c.y<h.y&&(h.y=c.y,l=e),c.y>u.y&&(u.y=c.y,a=e)}var f=new Bn$2(0,-1),d=new Bn$2(0,1),p=new Bn$2(-1,0),m=new Bn$2(1,0);for(let e=0;e<t.length;e++){var y=[Math.acos(f.dot(r[s])),Math.acos(d.dot(r[o])),Math.acos(p.dot(r[a])),Math.acos(m.dot(r[l]))];switch(y.indexOf(Math.min.apply(Math,y))){case 0:(d=(f=r[s].clone()).clone()).negate(),(m=(p=f.orthogonal()).clone()).negate(),s=(s+1)%t.length;break;case 1:(f=(d=r[o].clone()).clone()).negate(),(m=(p=f.orthogonal()).clone()).negate(),o=(o+1)%t.length;break;case 2:(m=(p=r[a].clone()).clone()).negate(),(d=(f=m.orthogonal()).clone()).negate(),a=(a+1)%t.length;break;case 3:(p=(m=r[l].clone()).clone()).negate(),(d=(f=m.orthogonal()).clone()).negate(),l=(l+1)%t.length}i(t[s],f,t[o],d,t[a],p,t[l],m)}return e}(s);if(!a||4!==a.length)return null;const l=a[0].distance(a[1]),h=a[1].distance(a[2]),u=a.map((t=>[t.x,t.y]));return u.push(+(h>l)),u}catch(t){return null}}class $n$2 extends we$2{static fromJSON(t){return Xe$2(t,"ExtrudePolygonLayer",$n$2)}getPolygonOffsetCount(){return 0}getPolygonOffset(){return 0}onConfig(t){const e=this.getRenderer();return e&&e.onConfig(t),super.onConfig(t)}updateMaterial(t){this.options.material||(this.options.material={}),t?Q$4(this.options.material,t):this.options.material=null;const e=this.getRenderer();return e&&e.updateMaterial(t),this}updateSideMaterial(t){let e=!1;this.options.sideMaterial||(this.options.sideMaterial={},e=!0),t?Q$4(this.options.sideMaterial,t):this.options.sideMaterial=null;const n=this.getRenderer();return n&&(e&&n.ii(),n.updateSideMaterial(t)),this}updateDataConfig(t){if(!t)return this;this.options.dataConfig||(this.options.dataConfig={});const e=JSON.parse(JSON.stringify(this.options.dataConfig));Q$4(this.options.dataConfig,t);const n=this.getRenderer();return n&&n.updateDataConfig(t,e),this}}$n$2.registerJSONType("ExtrudePolygonLayer"),$n$2.mergeOptions({cullFace:!1,castShadow:!0});const qn$2={polygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_polygonFill"},polygonOpacity:{type:"identity",default:1,property:"_symbol_polygonOpacity"},topPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_topPolygonFill"},bottomPolygonFill:{type:"identity",default:[1,1,1,1],property:"_symbol_bottomPolygonFill"}},Jn$2={defaultAltitude:20},Kn$2=t=>1===t.properties.top;$n$2.registerRenderer("gl",class extends Ze$2{constructor(...e){super(...e),this.GeometryTypes=[t__namespace.Polygon,t__namespace.MultiPolygon]}ti(t){return[t]}onConfig(t){this.painter&&(rt$3(t.cullFace)||this.painter.updateSceneConfig({cullFace:t.cullFace}))}updateMaterial(t){this.painter&&(this.painter.ri(t),this.layer.options.sideMaterial||this.sidePainter.ri(t),this.setToRedraw())}ii(){this.sidePainter&&this.sidePainter.deleteMaterial()}updateSideMaterial(t){this.sidePainter&&(t?this.sidePainter.ri(t):(this.sidePainter.deleteMaterial(),this.sidePainter.ri(this.layer.options.material)),this.setToRedraw())}updateDataConfig(t,e){this.painter&&(this.painter.updateDataConfig(t,e),this.En())}updateBloom(t){super.updateBloom(t),this.sidePainter&&this.Kn(this.sidePainter,this.sidePainterSymbol,t)}needCheckPointLineSymbols(){return!1}draw(t,e){return super.draw(t,e)}createPainter(){const t=we$2.get3DPainterClass("lit");this.painterSymbol=Q$4({},qn$2),this.sidePainterSymbol=Q$4({},qn$2),this.qn(this.painterSymbol,t.getBloomSymbol());const e=Q$4({},Jn$2,this.layer.options.dataConfig||{});this.layer.options.material&&(this.painterSymbol.material=this.layer.options.material),this.sidePainterSymbol.material=this.layer.options.sideMaterial?this.layer.options.sideMaterial:this.layer.options.material;const n={cullFace:this.layer.options.cullFace};Object.defineProperty(n,"castShadow",{enumerable:!0,get:()=>this.layer.options.castShadow});const i=Q$4({},e);i.upsideUpTexture=!0;const r=new t(this.regl,this.layer,this.painterSymbol,n,0,i);return this.sidePainter=new t(this.regl,this.layer,this.sidePainterSymbol,n,0,e),r}xt(...t){super.xt(...t);const e=this.painter;this.painter=this.sidePainter,super.xt(...t),this.painter=e}pn(...t){const e=t[0],n=e.sceneFilter;e.sceneFilter=t=>(!n||n(t))&&Kn$2(t);const i=super.pn(...t);e.sceneFilter=t=>(!n||n(t))&&Kn$2(t);const r=this.painter;this.painter=this.sidePainter;const s=e.sceneFilter=t=>(!n||n(t))&&(t=>1===t.properties.side)(t);return super.pn(...t),this.painter=r,e.sceneFilter=n,{redraw:i.redraw||s.redraw,drawCount:(i.drawCount||0)+(s.drawCount||0)}}createMesh(t,e,n,i,r,s){const o=[];this.si=s;const a=this.oi(i,n,!0,!1),l=this.oi(i,n,!1,!0);if(a){const r=this.xn(a,t,e,n,i,null,s);r.meshes[0].properties.top=1,o.push(r)}if(l){const r=this.xn(l,t,e,n,i,null,s);r.meshes[0].properties.side=1,o.push(r)}return o}oi(e,n,i,r){const s=this.getMap();n=qn$2;const o=this.si,a=s.getZoom(),l=new t__namespace.Point(0,0),h=new t__namespace.Coordinate(0,0),u=Q$4({},Jn$2,this.layer.options.dataConfig);if(u.tangent=1,u.top&&(u.top=i),u.side&&(u.side=r),!1===u.top&&!1===u.side)return null;if(!e.length)return null;const c=s.getGLRes(),f=s.getProjection().code,d=i?this.painterSymbol&&this.painterSymbol.material:this.sidePainterSymbol&&this.sidePainterSymbol.material,p=d&&d.textureWidth||23.25,m=[Bt$3(s,1,h,c)/100,Bt$3(s,1,h,c,1)/100];return dn$2(e,u,1/0,l,p,s.getGLRes(),1,1,m,this.yt,n,a,f,void 0,Float32Array,o)}updateMesh(t){let n=this.features[t[Te$2]];if(!n)return;const i=this.oi([n],this.painterSymbol,!0,!1);let r=0;i&&i.data&&this.Hn(this.meshes[r++],n.id,i);const s=this.oi([n],this.painterSymbol,!1,!0);s&&s.data&&this.Hn(this.meshes[r++],n.id,s)}Cn(e){if(e.getProperties()||e.setProperties({}),!e.getProperties().maptalks_ombb){const n=e.getCoordinates();if(e instanceof t__namespace.MultiPolygon){const t=[];for(let e=0;e<n.length;e++){t[e]=Yn$2(n[e]&&n[e][0])}e.getProperties().maptalks_ombb=t}else{const t=Yn$2(n[0]);e.getProperties().maptalks_ombb=t}}return super.Cn(e)}resizeCanvas(t){super.resizeCanvas(t),this.sidePainter&&this.sidePainter.resize(this.canvas.width,this.canvas.height)}onRemove(){super.onRemove(),this.sidePainter&&(this.sidePainter.delete(),delete this.sidePainter)}drawOutline(t){if(super.drawOutline(t),this.Mt&&this.sidePainter&&this.sidePainter.outlineAll(t),this.Zn)for(let e=0;e<this.Zn.length;e++)this.sidePainter&&this.sidePainter.outline(t,this.Zn[e])}getShadowMeshes(){return this.painter?this.painter.getShadowMeshes():[]}}),$n$2.registerRenderer("canvas",null);const Zn$2={redraw:!1,retire:!1},Qn$2=[];let ti$1=1;function ei$1(t,e){return VectorTilePlugin.extend(t,{init:function(){this.ai={}},isVisible(){return this.painter&&this.painter.isVisible()},supportRenderMode:function(t){return this.painter.supportRenderMode(t)},hasMesh(){return this.painter&&this.painter.hasMesh()},startFrame:function(t){const r=t.sceneConfig;let a=this.painter;if(!a){a=this.painter=new e(t.regl,t.layer,t.symbol,r,t.pluginIndex,t.dataConfig)}this.ai||(this.ai={});const l=r.excludes;this.li?l!==this.li&&(this.hi=l?createFilter(l):null,this.li=l):l&&(this.li=l),a.startFrame(t),this.ui={}},updateCollision:function(t){const e=this.painter;return e&&e.isVisible()?e.updateCollision(t):null},prepareRender:function(t){const e=this.painter;return e&&e.isVisible()?e.prepareRender(t):null},endFrame:function(t){const e=this.painter;return e&&e.isVisible()?e.render(t):null},getShadowMeshes(){const t=this.painter;return t&&t.getShadowMeshes&&t.getShadowMeshes()||Qn$2},createTile:function(t){const{tileCache:e,tileData:n}=t;let i=!1;const r=this.painter;if(!r)return{retire:i};const s=this.ci(t);let o=e.geometry;if(!o){const s=n.features,a=n.data;if(!a||!a.length)return{retire:i};const l=a;if(this.painter.colorSymbol&&!function(t){if(!t)return!0;for(const e in t)return!1;return!0}(s))for(let t=0;t<a.length;t++){const e=this.fi(s,a[t].data.aPickingId,a[t].indices,a[t].data.aPosition,a[t].positionSize);a[t].data.aColor=e}o=e.geometry=r.createGeometries(l,s);for(let e=0;e<o.length;e++)o[e]&&o[e].geometry&&(i=!0,o[e].geometry.properties.features=s,this.bn(o[e].geometry,t))}let a=this.H(s);if(!a){const{meshes:e,retire:n}=this.di(o,t);i||(i=n),a=e}return{retire:i}},di(t,e){const{layer:n,tileInfo:i,tileExtent:r,tileTransform:s,tileTranslationMatrix:o,tileVectorTransform:a,tileZoom:l,sceneConfig:h}=e;let u=!1;const d=this.painter.createMeshes(t,s,{tileExtent:r,tilePoint:[i.extent2d.xmin,i.extent2d.ymax],tileZoom:l,tileTranslationMatrix:o,tileVectorTransform:a},e);if(d.length){const t=n.getRenderer().isEnableTileStencil();for(let n=0;n<d.length;n++)d[n]&&(u=!0,this.pi(d[n],s,e.timestamp,ti$1++,t));h.animation&&(d.mi=e.timestamp);const i=this.ci(e);this.ai[i]=d}return{meshes:d,retire:u}},paintTile:function(t){const{tileCache:e,tileInfo:n,tileZoom:i,sceneConfig:r}=t,s=this.painter;if(!s)return Zn$2;let o=e.geometry;if(!o)return Zn$2;let a=!1;const l=this.ci(t);let h=this.H(l);if(!h){const{meshes:e,retire:n}=this.di(o,t);a||(a=n),h=e}if(!h.length)return Zn$2;const u=s.getTileLevelValue(n,i);h.forEach((t=>{t.properties.tile=n,t.properties.level=u}));let c=!1;if(!this.ui[l]){let e=null,n=r.animation;if(n){const i=t.sceneConfig.animationDuration||800,r=(t.timestamp-h.mi)/i;h.mi-h[0].properties.createTime<i&&r<1&&(!0!==n&&1!==n||(n="linear"),e="linear"===n?r:X$4(n,r),c=!0)}s.addMesh(h,e,t),this.ui[l]=1}return{redraw:c,retire:a}},pi:function(t,e,n,i,r){if(t.properties.tileTransform=e,t.properties.createTime=n,t.properties.meshKey=i,t.needUpdateShadow=!0,r){const e=t.defines||{};e.ENABLE_TILE_STENCIL=1,t.setDefines(e),"stencilRef"in t.uniforms||Object.defineProperty(t.uniforms,"stencilRef",{enumerable:!0,get:function(){return t.properties.tile&&void 0!==t.properties.tile.stencilRef?t.properties.tile.stencilRef:t.properties.level}})}},bn:function(t,e){const{layer:n,tileInfo:i}=e,r=n.getMap(),s=(n.getSpatialReference?n.getSpatialReference():r.getSpatialReference()).getResolution(i.z),o=e.tileExtent/n.getTileSize().width;t.properties.tileResolution=s,t.properties.tileRatio=o,t.properties.z=i.z,t.properties.tileExtent=e.tileExtent},updateSceneConfig:function(t){const e=this.painter;e&&e.updateSceneConfig(t.sceneConfig)},updateDataConfig:function(t,e){const n=this.painter;return!n||n.updateDataConfig(t,e)},updateSymbol:function(t,e){const n=this.painter;if(!n)return!1;if(n.shouldDeleteMeshOnUpdateSymbol(t)){if(this.ai)for(const t in this.ai)n.deleteMesh(this.ai[t],!0);delete this.ai,delete this.ui}return n.updateSymbol(t,e)},pick:function(t,e,n){return this.painter&&this.painter.pick?this.painter.pick(t,e,n):null},deleteTile:function(t){if(!this.ai)return;const e=this.ci(t),n=this.ai[e];n&&this.painter&&this.painter.deleteMesh(n),delete this.ai[e],this.ui&&delete this.ui[e]},remove:function(){const t=this.painter;if(t&&this.ai){for(const e in this.ai)t.deleteMesh(this.ai[e]);t.delete(),delete this.painter}delete this.ai,delete this.ui},resize:function(t,e){const n=this.painter;n&&n.resize(t,e)},needToRedraw:function(){return!!this.painter&&this.painter.needToRedraw()},needToRetireFrames:function(){return!!this.painter&&this.painter.needToRetireFrames()},isAnimating(){return!!this.painter&&this.painter.isAnimating()},needToRefreshTerrainTileOnZooming:function(){return!!this.painter&&this.painter.needToRefreshTerrainTileOnZooming()},isTerrainSkin:function(){return!!this.painter&&this.painter.isTerrainSkin()},isTerrainVector:function(){return!!this.painter&&this.painter.isTerrainVector()},fi:function(t,e,n,i,r=3){if(!i||!t||!e.length)return null;const s=new Uint8Array(i.length/r*4);let o,a;const l=this.painter.colorSymbol,h={};let u;for(let n=0,i=e.length;n<i;n++){const i=e[n];if(o=t[i].symbol,a=h[i],!a)if(l){let e;e="function"==typeof l?l(t[i].feature&&t[i].feature.properties):l,e=color(e),a=h[i]=e.array()}else a=h[i]=[255,255,255];u=4*n,s[u]=a[0],s[u+1]=a[1],s[u+2]=a[2],s[u+3]=255*(o[this.painter.opacitySymbol]||1)}return s},ci:function(t){const e=t.tileInfo;return e.meshKey||(e.meshKey=ti$1++),e.meshKey},H:function(t){return this.ai[t]},yi(t,e){if(Array.isArray(t))t.forEach(((t,n)=>{const{features:i}=t.properties;this.gi(t,e[n],i)}));else{const{features:n}=t.properties;this.gi(t,Array.isArray(e)?e[0]:e,n)}},gi(t,e,n){const i=e.featureIndexes||e.data.featureIndexes;if(i)if(this.hi){const r=e.indices;let s=null,o=!1;const a=[];for(let t=0;t<r.length;t++){const e=n[i[r[t]]];null!==s&&s===r[t]||(o=this.hi(e.feature),s=r[t]),o||a.push(r[t])}t.setElements(new e.indices.constructor(a))}else t.setElements(e.indices)},outline(t,e){const n=this.painter;n&&n.outline(t,e)},outlineAll(t){const e=this.painter;e&&e.outlineAll(t)},needPolygonOffset(){const t=this.painter;return t&&t.needPolygonOffset()},highlight(t){const e=this.painter,n=this.style.name,i=this.renderIndex;if(t){const e=[];if(t.forEach(((t,r)=>{null!=t.plugin&&(Array.isArray(t.plugin)?t.plugin.length&&t.plugin.indexOf(n)<0&&t.plugin.indexOf(i)<0&&e.push(r):t.plugin!==n&&t.plugin!==i&&e.push(r))})),e.length){const n=new Map(t);for(let t=0;t<e.length;t++)n.delete(e[t]);t=n}}return e&&e.highlight(t)},cancelAllHighlight(){const t=this.painter;return t&&t.cancelAllHighlight()}})}class ni$1{constructor(){this.vi=1}write(t,e){const n=t.gl,i=this.vi++;return t.stencilFunc(n.ALWAYS,i,255),t.draw(e),i}start(t){const e=t.gl;e.clearStencil(255),e.clear(e.STENCIL_BUFFER_BIT),this.vi=1,t.start()}end(t){t.end()}}function ii$1(t){return!t||(void 0!==t.empty||(t.empty=function(t){for(const e in t)return!1;return!0}(t)),t.empty)}const ri$1="_fn_type_";function si$1(t,e,n){if(!ii$1(t.properties.features))for(let i=0;i<n.length;i++){const{symbolName:r}=n[i];(t.xi=t.xi||{})[r]=e[r],oi$1(t,e,n[i])}}function oi$1(t,e,n){const i=function(t){const e=t.properties;let n=e.aPickingId;return n||(n=e.aPickingId=new t.data.aPickingId.constructor(t.data.aPickingId)),n}(t),{attrName:r,symbolName:s,related:o}=n;let a=t.data[r];return a?yi$1(e[s])||function(t,e){if(!Array.isArray(t))return!1;for(let n=0;n<t.length;n++)if(yi$1(e[t[n]]))return!0;return!1}(o,e)?(yi$1(e[s])&&ai$1(t,e,n),a):(t.deleteData(r),li$1(t,r),null):yi$1(e[s])?(a=t.data[r]=new n.type(n.width*i.length),function(t,e,n,i){const{attrName:r}=i,s=(ri$1+r+"Index").trim();ai$1(e,n,i);di$1(e,e.properties[s],i)}(0,t,e,n),a):null}function ai$1(t,e,n){const{attrName:i,symbolName:r}=n,s=t.properties,o=(ri$1+i+"Index").trim(),a=(ri$1+i).trim();if(s[o]&&s[a])return;const l=function(t){if(!t)return fi$1;const e=[];for(let n=0;n<t.length;n++)isFunctionDefinition(t[n][1])&&!interpolated(t[n][1]).isZoomConstant&&e.push(t[n][0]);return e}(e[r].stops),h="identity"===e[r].type&&nt$4.checkIfIdentityZoomDependent(r,e[r].property,s.features);if(!h&&!l.length)return void li$1(t,i);const{features:u,aPickingId:c}=s,f=function(t,e,n,i,r){const s=[];let o=0,a=e[0];for(let l=1,h=e.length;l<h;l++)e[l]===a&&l!==h-1||((r||ci$1(t[a].feature,n,i))&&s.push(o,l===h-1?h:l),a=e[l],o=l);return s}(u,c,e[r].property,l,h);if(!f.length)return void li$1(t,i);const d=t.data[i];s[o]=f,s[a]=d.BYTES_PER_ELEMENT?new d.constructor(d):new n.type(d.length)}function li$1(t,e){const n=t.properties,i=(ri$1+e+"Index").trim(),r=(ri$1+e).trim();delete n[i],delete n[r]}function hi$1(t,e,n,i,r){if(!i)return;const s=i.geometry;if(!s)return;if(ii$1(s.properties.features))return;const o=i.geometry.properties.layer;for(let a=0;a<n.length;a++){const l=n[a],h=l.attrName;if(!(ui$1(s,e,l)||o.ce&&o.ce(i.geometry.bi))){const{aPickingId:t}=s.properties;if(!t||s.Ai===r)continue;const e=(ri$1+h+"Index").trim(),n=s.properties[e];if(!n)continue;di$1(s,n,l);continue}const u=oi$1(s,e,l),c=l.define;if(u){const e=(ri$1+h+"Index").trim();if(di$1(s,s.properties[e],l),o.ue&&(s.bi=o.ue()),c){const t=i.defines;t[c]=1,i.setDefines(t)}s.generateBuffers(t)}else if(c){const t=i.defines;t[c]&&(delete t[c],i.setDefines(t))}}s.Ai=r}function ui$1(t,e,n){const i=e[n.symbolName],r=t.xi;return!fastDeepEqual(i,r[n.symbolName])&&(r[n.symbolName]=i,!0)}function ci$1(t,e,n){for(let i=0;i<n.length;i++)if("$"===e[0]&&t[e.substring(1)]===n[i]||t.properties[e]===n[i])return!0;return!1}const fi$1=[];function di$1(t,e,n){const{attrName:i,evaluate:r}=n,{aPickingId:s,features:o}=t.properties;let a;if(e){const n=(ri$1+i).trim();a=t.properties[n];const l=a.length/s.length,h=e.length;for(let n=0;n<h;n+=2){const i=e[n],h=e[n+1];let u=o[s[i]];u&&u.feature&&mi$1(a,u,r,i,h,l,t)}}else{if(a=t.data[i],function(t){return Array.isArray(t)||t.constructor===Float32Array||t.constructor===Float64Array||t.constructor===Uint8Array||t.constructor===Int8Array||t.constructor===Uint16Array||t.constructor===Int16Array||t.constructor===Uint32Array||t.constructor===Int32Array||t.constructor===Uint8ClampedArray}(a))a.dirty=!0;else{const e=(ri$1+i).trim();a=t.properties[e],a||(a=t.properties[e]=new n.type(n.width*s.length),a.dirty=!0)}const e=a.length/s.length,l=s.length;let h=0;for(let n=0;n<l;n++){if(s[n]===s[h]&&n<l-1)continue;let i=o[s[h]];i&&i.feature&&(mi$1(a,i,r,h,n===l-1?l:n,e,t),h=n)}}a.dirty&&(t.updateData(i,a),a.dirty=!1)}const pi$1={};function mi$1(t,e,n,i,r,s,o){const a=(e=e.feature).properties||{};void 0===a.$layer&&(e.properties||(e.properties=a),a.$layer=e.layer,a.$type=e.type);const l=o.properties.layer;if(l.getFeatureState&&(pi$1.layer=e.layer,pi$1.id=e.id,e[_t$3]&&(e[_t$3]=null),!It$3(e.id))){const t=l.getFeatureState(pi$1);e.properties[_t$3]=t}const h=n(a,o,t,i*s);if(Array.isArray(h)){let e=!1;for(let n=0;n<s;n++)if(t[i*s+n]!==h[n]){e=!0;break}if(e){for(let e=i*s;e<r*s;e+=s)t.set(h,e);t.dirty=!0}}else t[i]!==h&&(Nt$3(t,h,i,r),t.dirty=!0)}function yi$1(t){return nt$4.isFnTypeSymbol(t)}var gi$1=vi$1;function vi$1(t,e){this.x=t,this.y=e}vi$1.prototype={clone:function(){return new vi$1(this.x,this.y)},add:function(t){return this.clone().wi(t)},sub:function(t){return this.clone()._i(t)},multByPoint:function(t){return this.clone().Si(t)},divByPoint:function(t){return this.clone().Mi(t)},mult:function(t){return this.clone().Pi(t)},div:function(t){return this.clone().Ti(t)},rotate:function(t){return this.clone().ki(t)},rotateAround:function(t,e){return this.clone().Oi(t,e)},matMult:function(t){return this.clone().Ii(t)},unit:function(){return this.clone().Fi()},perp:function(){return this.clone().Ci()},round:function(){return this.clone().Ei()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},Ii:function(t){var n=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=n,this},wi:function(t){return this.x+=t.x,this.y+=t.y,this},_i:function(t){return this.x-=t.x,this.y-=t.y,this},Pi:function(t){return this.x*=t,this.y*=t,this},Ti:function(t){return this.x/=t,this.y/=t,this},Si:function(t){return this.x*=t.x,this.y*=t.y,this},Mi:function(t){return this.x/=t.x,this.y/=t.y,this},Fi:function(){return this.Ti(this.mag()),this},Ci:function(){var t=this.y;return this.y=this.x,this.x=-t,this},ki:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},Oi:function(t,e){var n=Math.cos(t),i=Math.sin(t),s=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=s,this},Ei:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},vi$1.convert=function(t){return t instanceof vi$1?t:Array.isArray(t)?new vi$1(t[0],t[1]):t};const xi$1=[];function bi$1(t,e,n,i,r){return set$3(xi$1,e[0],e[1],e[2],1),transformMat4$1(xi$1,xi$1,n),t[2]=xi$1[3],scale$3(xi$1,xi$1,1/xi$1[3]),t[0]=(xi$1[0]+1)*i/2,t[1]=(1-xi$1[1])*r/2,t}const Ai$1=[],wi$1=[],_i$1=[],Si$1=[-99999,-99999],Mi$1=new t__namespace.Point(0,0),Pi$1=[];function Ti$1(t,e,n,r,s,o,a,l){const{res:h,extent:u,extent2d:c}=n.properties.tile,{xmin:f,ymax:d}=c,p=f+r.x*s,m=d-r.y*s;let y=null;if(l)for(let t=0;t<l.length;t++)if(ki$1(l[t],p,m,h)){y=l[t];break}if(!y)return Si$1;const g=Mi$1.set(f,d),v=o.queryTilePointTerrain(r,y,g,u,h),x=null===v[0]?xt$3:v[0];if(x){let n=set$4(Pi$1,r.x,r.y,0);return n[2]+=100*x,n=bi$1(t,n,a,e.width,e.height),n}return t[0]=r.x,t[1]=r.y,t}function ki$1(t,e,n,i){const r=Mi$1.set(e,n)._multi(i/t.res);return t.extent2d.contains(r)}const{loginIBLResOnCanvas:Oi$1,logoutIBLResOnCanvas:Ii$1,getIBLResOnCanvas:Fi$1}=fi$4.PBRUtils,Ci$1=[],Ei$1=[],Di$1=new t__namespace.Point(0,0),Ri$1=new t__namespace.Point(0,0),Li$1=new Float32Array(1),Ni$1=[],Hi$1=t=>0===t.properties.level,zi$1=t=>t.properties.level>0;class Vi$1{static getBloomSymbol(){return["bloom"]}constructor(t,e,i,r,s,o){this.Di=!0,this.regl=t,this.layer=e,this.canvas=t._gl.canvas,this.sceneConfig=r||{},this.dataConfig=o||{},this.pluginIndex=s,this.scene=new Ke$5,this.pickingFBO=e.getRenderer().pickingFBO,this.Ri=new ni$1,this.level0Filter=Hi$1,this.levelNFilter=zi$1,this.loginTextureCache(),this.symbolDef=Array.isArray(i)?i.map((t=>Ft$3(t))):[Ft$3(i)],this.Li(),this.pickingViewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.sortByCommandKey=Ui$1.bind(this),this.colorCache={},this.Ni=this.symbolDef.map((t=>!(!t||!1!==t.visible)))}hasMesh(){const t=this.scene&&this.scene.getMeshes();return this.isVisible()&&t&&!!t.length}getMap(){return this.layer?this.layer.getMap():null}getTileLevelValue(t,e){const n=this.layer.getRenderer();return n.getTileLevelValue&&n.getTileLevelValue(t,e)||0}getAnalysisMeshes(){return this.getShadowMeshes?this.getShadowMeshes():Ni$1}isVisible(){const{minZoom:t,maxZoom:e}=this.sceneConfig,n=this.getMap().getZoom();if(!It$3(t)&&n<t)return!1;if(!It$3(e)&&n>e)return!1;const i=this.Hi;if(i.length)for(let t=0;t<i.length;t++)if(i[t]&&!i[t].isFeatureConstant)return!0;const r=this.getSymbols();for(let t=0;t<r.length;t++){const e=r[t].visible;if(!1!==e&&0!==e)return!0}return!1}isMeshVisible(t){const e=t&&t.properties&&t.properties.symbolIndex;if(!e)return!1;const n=this.Hi,i=e.index;let r;if(n[i]){if(!n[i].isFeatureConstant)return!0;r=n[i](this.getMap().getZoom())}else r=this.getSymbol(e).visible;return!1!==r&&0!==r}isAnimating(){return!1}needToRedraw(){return this.isAnimating()||this.zi}needToRetireFrames(){return this.J}needToRefreshTerrainTileOnZooming(){return!0}isTerrainSkin(){return this.layer.options.awareOfTerrain}isTerrainVector(){return!1}isShadowIncludeChanged(t){const e=t&&t.isRenderingTerrain&&this.isTerrainSkin();return t&&t.states&&t.states.includesChanged.shadow||e&&this.Vi}fillIncludes(t,e,n){if(delete this.Vi,n&&n.isRenderingTerrain&&this.isTerrainSkin())return;const i=n&&n.includes;if(i){let r="";for(const s in i)i[s]&&(r+=s,n[s].uniformDeclares&&e.push(...n[s].uniformDeclares),n[s].defines&&Tt$3(t,n[s].defines));this.Vi=r}}setIncludeUniformValues(t,e){if(e&&e.isRenderingTerrain&&this.isTerrainSkin())return;const n=e&&e.includes;if(n)for(const i in n)n[i]&&e[i].renderUniforms&&Tt$3(t,e[i].renderUniforms)}createGeometries(t,e){if(!t.length)return Ni$1;const n=[];for(let i=0;i<t.length;i++)if(t[i])if(void 0!==t[i].ref)n.push(n[t[i].ref]?{geometry:n[t[i].ref].geometry,symbolIndex:t[i].symbolIndex,ref:t[i].ref}:null);else{t[i]&&!t[i].is2D&&(this.Di=!1);const r=this.createGeometry(t[i],e,i);if(r&&r.geometry){const s=r.geometry.properties,{pickingIdMap:o,idPickingMap:a,hasFeaIds:l}=this.Ui(t[i]);l&&(s.feaIdPickingMap=o,s.feaPickingIdMap=a),s.symbolIndex=r.symbolIndex,s.features=e,s.is2D=t[i].is2D,s.layer=this.layer,s.positionBounding=t[i].positionBounding,this.postCreateGeometry(r,n)}n.push(r)}return n}isOnly2D(){return this.Di}postCreateGeometry(){}Ui(t){if(!t)return{};if(Array.isArray(t)&&!(t=t[0]))return{};const e=t.featureIds,n={},i={},r=e&&e.length;if(r)for(let r=0;r<e.length;r++){const s=t.data.aPickingId[r];void 0===n[s]&&(n[s]=e[r],i[e[r]]||(i[e[r]]=[]),i[e[r]].push(t.data.aPickingId[r]))}return{hasFeaIds:r,idPickingMap:n,pickingIdMap:i}}createGeometry(){throw new Error("not implemented")}createMeshes(t,e,n,i){const r=this.layer.options.awareOfTerrain,s=[];for(let o=0;o<t.length;o++){if(!t[o])continue;if(r&&i&&i.isRenderingTerrain&&this.isTerrainVector()){const e=t[o],n=e&&e.geometry;this.ji(n,n.data,n.properties,n.positionSize||n.desc.positionSize,i)}let a=this.createMesh(t[o],e,n,i||{});Array.isArray(a)?(a=a.filter((t=>!!t)),s.push(...a)):a&&s.push(a)}return s}createMesh(){throw new Error("not implemented")}getAltitudeOffsetMatrix(){const t=100*(this.dataConfig.altitudeOffset||0),e=identity$2([]);return set$4(Ei$1,0,0,t),translate$1(e,e,Ei$1),e}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).bloom}forbiddenTerrainUpscale(){return!0}addMesh(t,e,n){if(n.isRenderingTerrain&&this.isTerrainSkin()&&this.forbiddenTerrainUpscale()){const t=this.getMap().getResolution();if(n.tileInfo.res/t>3)return}const i=n.isRenderingTerrain&&this.isTerrainVector(),r=this.getRenderFBO(n);t=t.filter((t=>this.isMeshVisible(t))),i&&(t=t.filter((t=>t.geometry&&t.geometry.data.aTerrainAltitude)));const s=void 0===this.sceneConfig.castShadow||!!this.sceneConfig.castShadow,o=!(!n||!n.bloom);t.forEach((t=>{const e=this.isBloom(t)&&o;t.bloom=e,t.castShadow=s;let a=!1;const l=t.defines||{};if(!!l.HAS_BLOOM!==e&&(a=!0,e?l.HAS_BLOOM=1:delete l.HAS_BLOOM),i){if(t.geometry.data.aTerrainAltitude){const e=t.geometry;this.ji(e,e.data,e.properties,e.desc.positionSize,n)}t.geometry.data.aTerrainAltitude&&!l.HAS_TERRAIN_ALTITUDE&&(l.HAS_TERRAIN_ALTITUDE=1,a=!0)}else l.HAS_TERRAIN_ALTITUDE&&(delete l.HAS_TERRAIN_ALTITUDE,a=!0);a&&t.setDefines(l),r?t.setUniform("targetFramebuffer",r):t.uniforms.targetFramebuffer&&(t.uniforms.targetFramebuffer=null),this.Bi(t)})),this.scene.addMesh(t)}updateCollision(){}render(t){return this.pluginIndex=t.pluginIndex,this.polygonOffsetIndex=t.polygonOffsetIndex,this.paint(t),{redraw:this.zi,drawCount:this.Gi}}prepareRender(t){if(this.ft===t.timestamp)return;if(!this.createFnTypeConfig)return;const e=this.scene.getMeshes();if(!e||!e.length)return;const n=t&&t.sceneFilter,i=this.getMap().getZoom();for(let r=0;r<e.length;r++){if(!e[r]||!e[r].geometry)continue;if(n&&!n(e[r]))continue;const{symbolIndex:s}=e[r].properties,o=this.getSymbolDef(s);if(!o)continue;this.ft=t.timestamp;const a=this.getFnTypeConfig(s);hi$1(this.regl,o,a,e[r],i)}}paint(t){const e=this.layer.getMap();if(!e)return{redraw:!1};this.Wi=t;const n=this.getUniformValues(e,t);return this.callShader(n,t),{redraw:this.zi}}setToRedraw(t){t&&(this.J=t),this.zi=!0}callShader(t,e){this.callCurrentTileShader(t,e),this.callBackgroundTileShader(t,e)}callCurrentTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.level0Filter,e.sceneFilter]:this.level0Filter),this.callRenderer(this.shader,t,e)}callBackgroundTileShader(t,e){this.shader&&(this.shader.filter=e&&e.sceneFilter?[this.levelNFilter,e.sceneFilter]:this.levelNFilter),this.scene.getMeshes().sort(ji$1),this.callRenderer(this.shader,t,e)}callRenderer(t,e,n){const i=this.scene.getMeshes(),r=[];i.forEach((t=>{t.properties.hlBloomMesh&&n&&n.bloom&&r.push(t.properties.hlBloomMesh),r.push(t)})),this.Xi(e),this.scene.setMeshes(r),this.Gi+=this.renderer.render(t,e,this.scene,this.getRenderFBO(n)),this.scene.setMeshes(i)}Xi(t){const e=this.layer.options.altitude||0,n=this.layer.getRenderer();t.layerOpacity=n.ne(),t.minAltitude=e}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}needPolygonOffset(){return!1}getPolygonOffset(){const t=this.layer;return{factor:()=>t.getPolygonOffset()+(this.polygonOffsetIndex||0),units:()=>t.getPolygonOffset()+(this.polygonOffsetIndex||0)}}getBlendFunc(){return{src:()=>this.sceneConfig.blendSrc||"one",dst:()=>this.sceneConfig.blendDst||"one minus src alpha"}}pick(t,e,n=3){if(!this.layer.options.picking||!1===this.sceneConfig.picking)return null;if(!this.pickingFBO||!this.picking)return null;const i=this.getMap(),r=this.getUniformValues(i);this.Xi(r);for(let s=0;s<this.picking.length;s++){const o=this.picking[s];o.render(this.scene.getMeshes(),r,!0);let a={};o.getRenderedMeshes().length&&(a=o.pick(t,e,n,r,{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:this.layer.options.pickingPoint&&!1!==this.sceneConfig.pickingPoint,logDepthBufFC:2/(Math.log(i.cameraFar+1)/Math.LN2)}));const{meshId:l,pickingId:h,point:u}=a,c=(0===l||l)&&o.getMeshAt(l);if(!c||!c.geometry)continue;let f=c.geometry.properties;return f.features||(f=c.properties),u&&u.length&&(u[0]=Math.round(1e5*u[0])/1e5,u[1]=Math.round(1e5*u[1])/1e5,u[2]=Math.round(1e5*u[2])/1e5),{data:this.Yi(f&&f.features&&f.features[h]),point:u,coordinate:a.coordinate,plugin:this.pluginIndex}}return null}Yi(t){const e=t&&t.feature;if(!e||!e.customProps)return t;const n=Tt$3({},t);return n.feature=Tt$3({},t.feature),delete n.feature.customProps,n.feature.properties=Tt$3({},e.properties,e.properties[wt$3],e.properties[_t$3]),delete n.feature.properties[_t$3],delete n.feature.properties[wt$3],delete n.feature.properties.$layer,delete n.feature.properties.$type,n}updateSceneConfig(){}updateDataConfig(t){return Tt$3(this.dataConfig,t),!0}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++){if(!t[n].isValid())continue;const i=t[n].geometry;!e&&i&&i.dispose(),t[n].material&&t[n].material.dispose(),t[n].dispose(),Ws$3.deleteHighlightBloomMesh(t[n])}else{if(!t.isValid())return;!e&&t.geometry&&t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose(),Ws$3.deleteHighlightBloomMesh(t)}}startFrame(t){this.$i||(this.init(t),this.$i=!0),this.ft!==t.timestamp&&(this.zi=!1,this.J=!1,this.Gi=0),this.scene.clear()}resize(){}delete(){if(this.scene.clear(),this.shader&&this.shader.dispose(),this.picking){for(let t=0;t<this.picking.length;t++)this.picking[t].dispose();delete this.picking}if(this.qi){for(let t=0;t<this.qi.length;t++)this.qi[t].dispose();delete this.qi}delete this.Ji,this.logoutTextureCache()}updateSymbol(t,e){Array.isArray(t)||(t=[t],e=[e]);let n=!1;for(let i=0;i<t.length;i++)if(t[i]){const r=this.Ki(i,t[i],e[i]);r&&(n=r)}return delete this.Zi,this.setToRedraw(!1),n}Qi(t,e){for(const n in e)if(Vt$2(e,n)){if(nt$4.isFnTypeSymbol(e[n])&&!this.layer.options.features&&(!t[n]||t[n].property!==e[n].property))return!0;if(Da[n]&&!fastDeepEqual(e[n],t[n]))return!0}return!1}Ki(t,e,n){if(!this.tr)return!1;const i=this.Qi(this.symbolDef[t]||{},n);if(this.Ni[t]&&!1!==n.visible)return this.Ni[t]=!1,!0;this.symbolDef[t]=Ft$3(n);const r=this.tr[t];for(const t in r)delete r[t];const s=this.getMap(),o=[],a=Ta$1.loadSymbolFnTypes(this.symbolDef[t],(()=>(o[0]=s.getZoom(),o)));for(const t in a){const e=Object.getOwnPropertyDescriptor(a,t);e.get?Object.defineProperty(r,t,{get:e.get,set:e.set,configurable:!0,enumerable:!0}):r[t]=a[t]}return isFunctionDefinition(n.visible)&&(this.Hi[t]=interpolated(n.visible)),i}getSymbolDef(t){return this.symbolDef[t.index]}getSymbols(){return this.tr}getSymbol(t){return this.tr[t.index]}Li(){const t=this.getMap(),e=[],n=()=>(e[0]=t.getZoom(),e);this.tr=[],this.Hi=[];for(let t=0;t<this.symbolDef.length;t++)this.tr[t]=Ta$1.loadSymbolFnTypes(Tt$3({},this.symbolDef[t]),n),this.symbolDef[t]&&isFunctionDefinition(this.symbolDef[t].visible)&&(this.Hi[t]=interpolated(this.symbolDef[t].visible))}getFnTypeConfig(t){this.Zi||(this.Zi=[]);const e=t.index;if(!this.Zi[e]){const n=this.getSymbolDef(t),i=this.getMap();this.Zi[e]=this.createFnTypeConfig(i,n)}return this.Zi[e]}er(){delete this.Zi}loginTextureCache(){const t="__gl_textures".trim(),e=this.getMap();e[t]||(e[t]={count:0}),e[t].count++}logoutTextureCache(){const t="__gl_textures".trim(),e=this.getMap(),n=this.nr;if(n)for(const i in n)Vt$2(n,i)&&e[t][i]&&(e[t][i].count--,e[t][i].count<=0&&delete e[t][i]);e[t].count--,e[t].count<=0&&(e[t]={})}getCachedTexture(t){const e="__gl_textures".trim(),n=this.getMap()[e][t];return n?n.data:null}addCachedTexture(t,e){const n="__gl_textures".trim(),i=this.getMap();let r=i[n][t];r?r.data=e:r=i[n][t]={data:e,count:0},this.nr||(this.nr={}),r.data.then||this.nr[t]||(r.count++,this.nr[t]=1)}disposeCachedTexture(t){let e;if(e="string"==typeof t?t:t.url,!this.nr||!this.nr[e])return;const n="__gl_textures".trim();delete this.nr[e];const i=this.getMap();i[n][e]&&(i[n][e].count--,i[n][e].count<=0&&delete i[n][e])}shouldDeleteMeshOnUpdateSymbol(){return!1}needClearStencil(){return!1}supportRenderMode(t){return"taa"===t||"fxaa"===t}ir(t){const e=this.scene.getMeshes();if(!e.length)return;const n=e.map((t=>({transform:t.localTransform,level:t.properties.level,mesh:t}))).sort(this.rr),i=this.getMap().projViewMatrix;this.Ri.start(t);const s={};for(let e=0;e<n.length;e++){const o=n[e].mesh;let a=s[o.properties.tile.id];void 0===a&&(multiply$5(Ci$1,i,n[e].transform),a=this.Ri.write(t,Ci$1),s[o.properties.tile.id]=a),o.setUniform("ref",a)}this.Ri.end(t),this.regl.sr()}rr(t,e){return e.level-t.level}outline(t,e){const n={};for(let i=0;i<e.length;i++)It$3(e[i])||n[e[i]]||(this.or(t,e[i]),n[e[i]]=1)}or(t,e){if(!this.picking)return;if(this.ar||(this.ar=new Ke$5),!this.qi&&(this.lr(),!this.qi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const i=this.getUniformValues(this.getMap(),this.Wi);this.Xi(i);const r=this.hr(e);if(r.length)for(let n=0;n<r.length;n++){const s=r[n].geometry.properties.feaIdPickingMap;if(s){const o=s[e];if(o){const e={};this.ar.setMeshes(r[n]);for(let n=0;n<o.length;n++){const r=o[n];if(!e[r]){e[r]=1,i.highlightPickingId=r;for(let e=0;e<this.qi.length;e++)this.renderer.render(this.qi[e],i,this.ar,t)}}}}}}hr(t){const e=[],n=this.scene.getMeshes();for(let i=0;i<n.length;i++){const r=n[i],s=r.geometry.properties.feaIdPickingMap;s&&void 0!==s[t]&&e.push(r)}return e}outlineAll(t){if(!this.picking)return;if(!this.qi&&(this.lr(),!this.qi))return void console.warn(`Plugin at ${this.pluginIndex} doesn't support outline.`);const e=this.getUniformValues(this.getMap(),this.Wi);this.Xi(e),e.highlightPickingId=-1;for(let n=0;n<this.qi.length;n++)this.renderer.render(this.qi[n],e,this.scene,t)}lr(){if(!this.picking)return;const t=this.layer.getRenderer().canvas;this.qi=[];for(let e=0;e<this.picking.length;e++){const i=this.picking[e].getPickingVert(),r={ENABLE_PICKING:1,HAS_PICKING_ID:1},s=this.picking[e].getUniformDeclares().slice(0);void 0!==s.uPickingId&&(r.HAS_PICKING_ID=2),this.qi[e]=new vn$4({vert:i,frag:"precision highp float;\nuniform float highlightPickingId;\nvarying float vPickingId;\nvoid main() {\n  if(highlightPickingId < .0 || floor(highlightPickingId + .5) == floor(vPickingId + .5)) {\n    gl_FragColor = vec4(1.);\n  } else {\n    discard;\n  }\n}",uniforms:s,defines:r,extraCommandProps:{viewport:{x:0,y:0,width:()=>t.width,height:()=>t.height},depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}),this.qi[e].filter=this.picking[e].filter}}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}updateIBLDefines(t){const e=t.shaderDefines;let n=!1;this.hasIBL()?e[["HAS_IBL_LIGHTING"]]||(e.HAS_IBL_LIGHTING=1,n=!0):e[["HAS_IBL_LIGHTING"]]&&(delete e.HAS_IBL_LIGHTING,n=!0),n&&(t.shaderDefines=e)}getIBLRes(){const t=this.layer.getRenderer().canvas;return Fi$1(t)}createIBLTextures(){const t=this.layer.getRenderer().canvas;Oi$1(t,this.regl,this.getMap()),this.setToRedraw(!0),this.layer.fire("iblupdated")}disposeIBLTextures(){const t=this.layer.getRenderer().canvas;Ii$1(t,this.getMap())}evaluateInFnTypeConfig(t,e,n,i,r){let s=this.ur;s||(s=this.ur={});const o=function(t){let e=0;const n=t&&t.length||0;if(!n)return e;let i;for(let r=0;r<n;r++)i=t.charCodeAt(r),e=(e<<5)-e+i,e&=e;return e}(JSON.stringify(t));let a=s[o];return a||(a=s[o]=r?piecewiseConstant(t):interpolated(t)),a(n.getZoom(),i)}highlight(t){this.te=t,this.cr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}cancelAllHighlight(){this.te=null,this.cr=this.layer.getRenderer().getFrameTimestamp(),this.setToRedraw(!0)}dr(t,e){const{featureIds:n,pickingIdIndiceMap:i}=e;t.properties.aFeaIds=n,t.properties.pickingIdIndiceMap=i}Bi(t){if(t&&t.properties.isHalo)return;const{pickingIdIndiceMap:e}=t.geometry.properties,n=this.te?function(t,e,n){const{aPickingId:i,feaIdPickingMap:r,features:s}=t.geometry.properties,o=new Map,a=n.keys();for(const t of a){const a=n.get(t);if(a)if(It$3(a.id)){if(a.filter&&i){let t=null;for(let n=0;n<i.length;n++){i[n]!==t&&(t=i[n]);const r=s[t];a.filter(r&&r.feature,e)&&o.set(t,a)}}}else{const t=r[a.id];if(!t||!t.length)continue;for(let e=0;e<t.length;e++)o.set(t[e],a)}}return o}(t,this.layer,this.te):null;Ws$3.highlightMesh(this.regl,t,n,this.cr,e)}ji(t,e,n,i,r){let s=n.aAnchor;if(!s){const{aPosition:t}=e;s=n.aAnchor=t.slice(0)}let o=n.aTerrainAltitude;o||(o=n.aTerrainAltitude=new Float32Array(s.length/i),o.fill(xt$3)),this.pr(o,s,r.tileInfo,0,o.length-1),e.aTerrainAltitude?o.dirty&&this.mr(t,o):e.aTerrainAltitude=o,o.dirty=!1}mr(t,e){t&&t.updateData&&t.updateData("aTerrainAltitude",e)}pr(e,n,i,r,s){const{res:o,extent:a,extent2d:l,id:h}=i,u=this.pluginIndex,c=h+"-"+u;if(i.completeTerrainQuery||(i.completeTerrainQuery=[]),i.completeTerrainQuery[u])return;if(!i.completeTerrainQuery[u]&&this.Ji&&this.Ji.has(c)){const t=this.Ji.getAndRemove(c);return this.Ji.add(c,t),e.set(t.altitudeData),i.terrainTileInfos=t.terrainTileInfos,e.dirty=!0,void(i.completeTerrainQuery[u]=!0)}const f=this.layer,d=f.getMap(),p=f.getRenderer(),m=p&&p.getTerrainHelper();let y=i.terrainTileInfos;y||(y=i.terrainTileInfos=this.layer.queryTerrainTiles(i)),i.terrainQueryStatus||(i.terrainQueryStatus=[]);let g=!1,v=[];for(let t=0;t<i.terrainTileInfos.length;t++)if(v[t]=+m.isTerrainTileLoaded(i.terrainTileInfos[t].id),v[t]&&i.terrainQueryStatus[u]&&!i.terrainQueryStatus[u][t]){g=!0;break}if(!g&&i.terrainQueryStatus[u])return;const x=f.constructor;if(d.isInteracting()){const t=p.getFrameTimestamp();x.altitudeQueryFrameTimestamp!==t&&(x.altitudeQueryFrameTimestamp=t,x.altitudeQueryFrameTime=0);if(x.altitudeQueryFrameTime>f.options.altitudeQueryTimeLimitPerFrame)return}const b=performance.now();i.terrainQueryStatus[u]=v;const{xmin:A,ymax:w}=l,_=Di$1.set(A,w),S=this.layer.getTileSize().width/i.extent,M=n.length/e.length;let P=e.queryResult;P||(P=e.queryResult=new Map);let T=!0;for(let t=r;t<=s;t++){let i=n[t*M];i<0?i=0:i>a&&(i=a);let r=n[t*M+1];r<0?r=0:r>a&&(r=a);const s=i+r*a;let l,h,u=P.get(s);if(u||0===u)e[t]!==u&&(e[t]=u,e.dirty=!0);else{for(let t=0;t<y.length;t++)if(ki$1(y[t],A+S*i,w-S*r,o)){l=y[t];break}l&&(m.getRenderer().isTileCached(l.id)||e[t]===xt$3)&&(Ri$1.set(i,r),h=this.layer.queryTilePointTerrain(Ri$1,l,_,a,o)),u=e[t],h&&(u=null===h[0]?xt$3:h[0],Li$1[0]=u,u=Li$1[0]),e[t]!==u&&(e[t]=u,e.dirty=!0),h&&h[1]?P.set(s,u):T=!1}}x.altitudeQueryFrameTime=(x.altitudeQueryFrameTime||0)+(performance.now()-b),i.completeTerrainQuery[u]=T,T&&(this.Ji||(this.Ji=new t__namespace.LRUCache(4*this.layer.options.maxCacheSize)),this.Ji.add(c,{altitudeData:e,terrainTileInfos:y}))}}function Ui$1(t,e){const n=t&&t.getCommandKey(this.regl)||"",i=e&&e.getCommandKey(this.regl)||"";return n.localeCompare(i)}function ji$1(t,e){return t.properties.level-e.properties.level}class Bi$1 extends Vi$1{createGeometry(t,e){if(!t.data)return{geometry:null,symbolIndex:t.symbolIndex};t.iconAtlas&&t.iconAtlas.image&&(t.iconAtlas.image.dataType=t.type,t.iconAtlas.image.type="icon"),t.glyphAtlas&&t.glyphAtlas.image&&(t.glyphAtlas.image.type="glyph");const i=Tt$3({},t.data),r={primitive:this.getPrimitive(),positionSize:t.positionSize};i.aAltitude&&(r.altitudeAttribute="aAltitude");const s=new Q$7(i,t.indices,0,r);return s.properties={features:e},t.iconAtlas&&(s.properties.iconAtlas=t.iconAtlas.image,s.properties.iconPositions=t.iconAtlas.positions),t.glyphAtlas&&(s.properties.glyphAtlas=t.glyphAtlas.image),ii$1(e)||(s.properties.aFeaIds=t.featureIds,this.dr(s,t)),t.markerPlacement&&(s.properties.markerPlacement=t.markerPlacement),t.textPlacement&&(s.properties.textPlacement=t.textPlacement),Tt$3(s.properties,t.properties),{geometry:s,symbolIndex:t.symbolIndex}}getRayCastData(t,e){const{features:n,aFeaIds:i}=t.geometry.properties;return n&&i?n[i[e]]:null}getPrimitive(){return"triangles"}getRenderFBO(t){return t&&t.renderTarget&&t.renderTarget.fbo}supportRenderMode(t){return"noAa"===t}drawDebugAtlas(t){if(document.getElementById("MAPTALKS_ICON_DEBUG")){const e=document.getElementById("MAPTALKS_ICON_DEBUG");let n;if(e.width=t.width,e.height=t.height,e.style.width=t.width+"px",e.style.height=t.height+"px","alpha"===t.format){n=new Uint8ClampedArray(4*t.data.length);for(let e=0;e<t.data.length;e++)n[4*e+3]=t.data[e]}else n=new Uint8ClampedArray(t.data);const i=e.getContext("2d");i.imageSmoothingEnabled=!1,i.putImageData(new ImageData(n,t.width,t.height),0,0)}}}var Gi$1="#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#include <fbo_picking_vert>\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n  fbo_picking_setData(gl_Position.w, true);\n}";function Wi$1(t,e,i,r){if(r){const t=N$6.resizeToPowerOfTwo(e.data,e.width,e.height);e.data=t}const o={width:e.width,height:e.height,data:e.data,format:e.format,mag:"linear",min:r?"linear mipmap linear":"linear",flipY:i,premultiplyAlpha:!0};if("icon"===e.type){const t="point"!==e.dataType?"repeat":"clamp";o.wrapS=t,o.wrapT=t}return t.texture(o)}const Xi$1=[0,0],Yi$1=[];function $i$1(t){if(!t.properties.iconPositions)return Xi$1;let e,n=0;for(const i in t.properties.iconPositions)if(e=i,n++,n>1)return Xi$1;if(!e)return Xi$1;const i=t.properties.iconPositions[e],s=i.displaySize[1];return Yi$1[0]=i.displaySize[0],Yi$1[1]=s,Yi$1}const qi$1=identity$2([]),Ji$1={polygonFill:[1,1,1,1],polygonOpacity:1,uvScale:[1,1],uvOffset:[0,0],patternWidth:[0,0],patternOffset:[0,0]},Ki$1=[],Zi$1=new t__namespace.Coordinate(0,0),Qi$1=new t__namespace.Coordinate(0,0),tr$2=new t__namespace.Coordinate(0,0),er$2=[];class nr$2 extends Bi$1{static getBloomSymbol(){return["polygonBloom"]}prepareSymbol(t){const e=t.polygonFill;Array.isArray(e)&&(3===e.length&&e.push(1),t.polygonFill=e.map((t=>255*t)))}supportRenderMode(t){return this.sceneConfig.antialias||void 0===this.sceneConfig.antialias?"fxaa"===t||"fxaaBeforeTaa"===t:super.supportRenderMode(t)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[nr$2.getBloomSymbol()[0]]}forbiddenTerrainUpscale(){return!0}needPolygonOffset(){return!0}getAnalysisMeshes(){return this.isVisible()?this.scene.getMeshes().filter((t=>0===t.properties.level)):Ki$1}createMesh(e,i,r){const s=this.getMap(),{tilePoint:o}=r,{geometry:a,symbolIndex:l,ref:u}=e,c=this.layer instanceof t__namespace.TileLayer,f=this.layer.getTileSize().width,d=a.properties.tileExtent/f,m=a.properties.tileResolution,y=s.pointAtResToCoord(Zi$1.set(o[0],o[1]),m),g={tileExtent:a.properties.tileExtent,tileRatio:d},v=this.getSymbol(l),x=this.getSymbolDef(l);if(isFunctionDefinition(x.polygonPatternFileOrigin)&&this.yr(x,e,c?[0,0]:o,m),(isFunctionDefinition(x.polygonPatternFileWidth)||isFunctionDefinition(x.polygonPatternFileWidth))&&this.gr(x,e,c?d:1,y,m),x.uvOffsetInMeter&&isFunctionDefinition(x.uvOffset)&&this.vr(x,e,y,m),Ct$3(g,"polygonFill",v,"polygonFill",Ji$1.polygonFill,Rt$3(this.colorCache)),Ct$3(g,"polygonOpacity",v,"polygonOpacity",Ji$1.polygonOpacity),Ct$3(g,"uvScale",v,"uvScale",Ji$1.uvScale),void 0===u){const t=this.getFnTypeConfig(l);si$1(a,x,t),a.generateBuffers(this.regl)}const b=a.properties.iconAtlas;if(b&&a.data.aTexInfo){const t=[];Object.defineProperty(g,"uvOrigin",{enumerable:!0,get:()=>{if(a.data.aPatternOrigin)return o;const e=v.polygonPatternFileOrigin;return e?(Zi$1.set(e[0],e[1]),s.coordToPointAtRes(Zi$1,m,Qi$1),set(t,o[0]-Qi$1.x,o[1]-Qi$1.y)):o}});const e=[];Object.defineProperty(g,"patternWidth",{enumerable:!0,get:()=>{if(a.data.aPatternWidth)return Ji$1.patternWidth;const t=x.polygonPatternFileWidth,n=x.polygonPatternFileHeight;if(!t&&!n)return Ji$1.patternWidth;const[i,r]=this.xr(er$2,t,n,c?d:1,y,m);return set(e,i,r)}}),Object.defineProperty(g,"uvOffset",{enumerable:!0,get:()=>a.data.aPatternOffset||x.uvOffsetInMeter?Ji$1.uvOffset:v.uvOffset||Ji$1.uvOffset});const n=[];Object.defineProperty(g,"patternOffset",{enumerable:!0,get:()=>{if(a.data.aPatternOffset)return Ji$1.uvOffset;if(!x.uvOffsetInMeter)return Ji$1.uvOffset;const t=x.uvOffset;if(!t)return Ji$1.uvOffset;const e=Bt$3(s,t[0],y,m),i=Bt$3(s,t[1],y,m);return set(n,e,i)}}),Object.defineProperty(g,"tileScale",{enumerable:!0,get:function(){return x.polygonPatternFileWidth||x.polygonPatternFileHeight?1:a.properties.tileResolution/s.getResolution()}}),g.polygonPatternFile=Wi$1(this.regl,b,!1,!1),g.atlasSize=[b.width,b.height],this.drawDebugAtlas(b)}const A=new Ce$5(g,Ji$1),w=new Be$5(a,A,{castShadow:!1,picking:!0}),_={};return b&&a.data.aTexInfo&&(_.HAS_PATTERN=1),b&&a.data.aTexCoord&&(_.HAS_TEX_COORD=1,_.INVALID_TEX_COORD="-9999999.0"),a.data.aAltitude&&(_.HAS_ALTITUDE=1),a.data.aColor&&(_.HAS_COLOR=1),a.data.aOpacity&&(_.HAS_OPACITY=1),a.data.aUVScale&&(_.HAS_UV_SCALE=1),a.data.aUVOffset&&(_.HAS_UV_OFFSET=1),a.data.aPatternOrigin&&(_.HAS_PATTERN_ORIGIN=1),a.data.aPatternWidth&&(_.HAS_PATTERN_WIDTH=1),a.data.aPatternOffset&&(_.HAS_PATTERN_OFFSET=1),c&&(_.IS_VT=1),w.setDefines(_),w.setLocalTransform(i),w.properties.symbolIndex=l,w}gr(t,e,n,i,r){if(!(e=e&&e.geometry))return;const s=e.properties.features;if(ii$1(s))return;const o=t.polygonPatternFileWidth,a=t.polygonPatternFileHeight,l=interpolated(t.polygonPatternFileOrigin);let h,u;isFunctionDefinition(o)&&(h=interpolated(o)),isFunctionDefinition(a)&&(u=interpolated(a));const{aPickingId:c,aPatternOrigin:f}=e.data,m=new Float32Array(2*c.length);let y,v,x;for(let t=0,e=c.length;t<e;t++){let e,d;if(c[t]===y){m[2*t]=v,m[2*t+1]=x;continue}const p=s[c[t]];if(e=h?h(null,p.feature.properties):o,d=u?u(null,p.feature.properties):a,y=c[t],e||d){let s=i;if(f){const t=l(null,p.feature.properties);t&&(s=tr$2.set(t[0],t[1]))}const[o,a]=this.xr(er$2,e,d,n,s,r);v=m[2*t]=o,x=m[2*t+1]=a}else v=m[2*t]=0,x=m[2*t+1]=0}e.data.aPatternWidth=m}vr(t,e,n,i){if(!(e=e&&e.geometry))return;const r=e.properties.features;if(ii$1(r))return;const s=this.getMap();let o=isFunctionDefinition(t.uvOffsetInMeter)&&piecewiseConstant(t.uvOffsetInMeter);const a=interpolated(t.uvOffset),l=interpolated(t.polygonPatternFileOrigin),{aPickingId:h,aPatternOrigin:u}=e.data,f=new Float32Array(2*h.length);let d,m,v;for(let t=0,e=h.length;t<e;t++){if(h[t]===d){f[2*t]=m,f[2*t+1]=v;continue}const e=r[h[t]],c=a(null,e.feature.properties);let p=!0;if(o&&(p=o(null,e.feature.properties)),d=h[t],c&&p){let r=n;if(u){const t=l(null,e.feature.properties);t&&(r=tr$2.set(t[0],t[1]))}const o=Bt$3(s,c[0],r,i),a=Bt$3(s,c[0],r,i);m=f[2*t]=o,v=f[2*t+1]=a}else m=f[2*t]=0,v=f[2*t+1]=0}e.data.aPatternOffset=f}yr(t,e,n,i){if(!(e=e&&e.geometry))return;const r=e.properties.features;if(ii$1(r))return;const s=this.getMap(),o=interpolated(t.polygonPatternFileOrigin),a=e.data.aPickingId,h=new Float32Array(2*a.length);let u,c,f;for(let t=0,e=a.length;t<e;t++){if(a[t]===u){h[2*t]=c,h[2*t+1]=f;continue}u=a[t];const e=o(null,r[u].feature.properties);e?(Zi$1.set(e[0],e[1]),s.coordToPointAtRes(Zi$1,i,Qi$1),c=h[2*t]=Qi$1.x,f=h[2*t+1]=Qi$1.y):(c=h[2*t]=n[0],f=h[2*t+1]=n[1])}e.data.aPatternOrigin=h}createFnTypeConfig(t,e){const n=piecewiseConstant(e.polygonFill),i=interpolated(e.polygonOpacity),r=interpolated(e.uvScale),s=interpolated(e.uvOffset),o=new Uint8Array(1),a=new Uint16Array(2),l=new Uint8Array(2);return[{attrName:"aColor",symbolName:"polygonFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Dt$3(r),r}},{attrName:"aOpacity",symbolName:"polygonOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),o[0]=255*r,o[0]}},{attrName:"aUVScale",symbolName:"uvScale",type:Uint16Array,width:2,define:"HAS_UV_SCALE",evaluate:e=>{const n=r(t.getZoom(),e);return a[0]=255*n[0],a[1]=255*n[1],a}},{attrName:"aUVOffset",symbolName:"uvOffset",type:Uint8Array,width:2,define:"HAS_UV_OFFSET",evaluate:e=>{const n=s(t.getZoom(),e);return l[0]=255*n[0],l[1]=255*n[1],l}}]}paint(t){this.isShadowIncludeChanged(t)&&(this.shader.dispose(),this.br(t)),super.paint(t)}isEnableStencil(t){const e=this.layer.getRenderer();return!(t&&t.isRenderingTerrain&&this.isTerrainSkin()||!e.isEnableTileStencil||!e.isEnableTileStencil())&&"VectorTileLayer"===this.layer.getJSONType()}init(t){const i=this.canvas,s={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:i?i.width:1,height:(t,e)=>e.viewport?e.viewport.height:i?i.height:1};this.renderer=new B$6(this.regl);const o=this.layer.getRenderer(),a={viewport:s,stencil:{enable:()=>this.isEnableStencil(t),func:{cmp:()=>o.isEnableTileStencil&&o.isEnableTileStencil()?"=":"<=",ref:(t,e)=>o.isEnableTileStencil&&o.isEnableTileStencil()?e.stencilRef:e.level},op:{fail:"keep",zfail:"keep",zpass:()=>o.isEnableTileStencil&&o.isEnableTileStencil()?"zero":"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:(t,e)=>{if(!It$3(this.sceneConfig.depthMask))return!!this.sceneConfig.depthMask;if(e.hasSSRGround)return!0;if(e.meshConfig.transparent)return!1;const n=e.polygonOpacity;return!(Ht$2(n)&&n<1)},func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};if(this.br(t,a),this.pickingFBO){const t=[];this.picking=[new Cr$4(this.renderer,{vert:Gi$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return multiply$5(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:a},this.pickingFBO,this.getMap())]}}br(t,e){const i=[],s=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(i,e.projViewMatrix,e.modelMatrix),i}}],o={};this.fillIncludes(o,s,t),this.shader=new vn$4({vert:"#define SHADER_NAME FILL\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef IS_VT\nuniform mat4 modelMatrix;\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_TEX_COORD\nattribute vec2 aTexCoord;\n#endif\nattribute vec4 aTexInfo;\nuniform vec2 patternWidth;\nuniform vec2 patternOffset;\nuniform vec2 uvOrigin;\nuniform vec2 uvScale;\n#ifdef IS_VT\nuniform float tileRatio;\nuniform float tileScale;\n#else\nuniform float glScale;\n#endif\n#ifdef HAS_UV_SCALE\nattribute vec2 aUVScale;\nvarying vec2 vUVScale;\n#endif\n#ifdef HAS_UV_OFFSET\nattribute vec2 aUVOffset;\nvarying vec2 vUVOffset;\n#endif\n#ifdef HAS_PATTERN_WIDTH\nattribute vec2 aPatternWidth;\n#endif\n#ifdef HAS_PATTERN_ORIGIN\nattribute vec2 aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nattribute vec2 aPatternOffset;\n#endif\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d, vec2 e) {\n  \n#ifdef IS_VT\nfloat f = d.x / e.x;\n  float h = d.y / e.y;\n  return vec2(f, h);\n#else\nfloat i = glScale;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  i = mix(glScale, 1., j);\n#endif\nvec2 k = uvOrigin;\n#ifdef HAS_PATTERN_ORIGIN\nk = aPatternOrigin;\n#endif\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nk += l;\n  float f = (d.x - k.x) * i / e.x;\n  float h = (d.y - k.y) * i / e.y;\n  return vec2(f, -h);\n#endif\n}\nvec2 m(vec4 n, vec2 o) {\n  \n#ifdef IS_VT\n#ifdef HAS_PATTERN_OFFSET\nvec2 l = aPatternOffset;\n#else\nvec2 l = patternOffset;\n#endif\nvec2 k = uvOrigin + l;\n#ifdef HAS_PATTERN_ORIGIN\nk = k - aPatternOrigin;\n#endif\nfloat j = sign(length(patternWidth));\n  vec2 A = mix(o, patternWidth, j);\n#ifdef HAS_PATTERN_WIDTH\nA = aPatternWidth;\n#endif\n#ifdef HAS_UV_SCALE\nvec2 B = aUVScale / 255.;\n#else\nvec2 B = uvScale;\n#endif\nvec2 C = k * tileScale * B * vec2(1., -1.) / A;\n  return C / B + c(n.xy * tileScale / tileRatio, A);\n#else\nvec2 A = o;\n#ifdef HAS_PATTERN_WIDTH\nfloat j = sign(length(aPatternWidth));\n  A = mix(o, aPatternWidth, j);\n#endif\nvec4 D = modelMatrix * n;\n  return c(D.xy, A);\n#endif\n}\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <vt_position_vert>\n#include <highlight_vert>\nvoid main() {\n  vec3 E = unpackVTPosition();\n  vec4 n = vec4(E, 1.);\n  gl_Position = projViewModelMatrix * n;\n#ifdef HAS_PATTERN\nvec2 o = aTexInfo.zw + 1.;\n  vTexInfo = vec4(aTexInfo.xy, o);\n#ifdef HAS_TEX_COORD\nif(aTexCoord.x == INVALID_TEX_COORD) {\n    vTexCoord = m(n, o);\n  } else {\n    vTexCoord = aTexCoord;\n  }\n#else\nvTexCoord = m(n, o);\n#endif\n#ifdef HAS_UV_SCALE\nvUVScale = aUVScale / 255.;\n#endif\n#ifdef HAS_UV_OFFSET\nvUVOffset = aUVOffset / 255.;\n#endif\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\nhighlight_setVarying();\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(n);\n#endif\n}",frag:"#define SHADER_NAME FILL\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_PATTERN\n#ifdef HAS_UV_SCALE\nvarying vec2 vUVScale;\n#else\nuniform highp vec2 uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvarying vec2 vUVOffset;\n#else\nuniform vec2 uvOffset;\n#endif\n#endif\n#ifdef HAS_PATTERN\nuniform sampler2D polygonPatternFile;\nuniform vec2 atlasSize;\nvarying vec2 vTexCoord;\nvarying vec4 vTexInfo;\nvec2 c() {\n  \n#ifdef HAS_UV_SCALE\nvec2 d = vUVScale;\n#else\nvec2 d = uvScale;\n#endif\n#ifdef HAS_UV_OFFSET\nvec2 e = vUVOffset;\n#else\nvec2 e = uvOffset;\n#endif\nvec2 f = mod(vTexCoord * d + e, 1.);\n  vec2 h = vTexInfo.xy;\n  vec2 i = vTexInfo.zw;\n  return (h + f * i) / atlasSize;\n}\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec4 polygonFill;\n#endif\n#include <highlight_frag>\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float polygonOpacity;\n#endif\nuniform float layerOpacity;\nuniform float tileExtent;\nvoid main() {\n  \n#ifdef HAS_COLOR\nvec4 j = vColor;\n#else\nvec4 j = polygonFill;\n#endif\n#ifdef HAS_PATTERN\nif(vTexInfo.z * vTexInfo.w > 1.) {\n    vec2 f = c();\n    j = texture2D(polygonPatternFile, f);\n  }\n#endif\n#ifdef HAS_OPACITY\ngl_FragColor = j * vOpacity;\n#else\ngl_FragColor = j * polygonOpacity;\n#endif\ngl_FragColor *= layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat k = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, k);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:s,defines:o,extraCommandProps:e})}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i={projViewMatrix:n?qi$1:t.projViewMatrix,glScale:e&&e.isRenderingTerrainSkin?1:1/t.getGLScale(),viewport:n&&e&&e.viewport,hasSSRGround:e&&e.hasSSRGround};return this.setIncludeUniformValues(i,e),i}xr(t,e,n,i,r,s){let o,a;const l=this.getMap();return e&&(o=Bt$3(l,e,r,s)),n&&(a=Bt$3(l,n,r,s,1)),o=o||a,a=a||o,t[0]=o,t[1]=a,t}}var ir$2="#define SHADER_NAME LINE\n#define AA_CLIP_LIMIT 2.0\n#define AA_LINE_WIDTH 16.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define ANTIALIASING 1.0 / DEVICE_PIXEL_RATIO / 2.0\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\n#ifdef PICKING_MODE\n#include <gl2_vert>\n#endif\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY)\nattribute vec3 aExtrude;\n#else\nattribute vec2 aExtrude;\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nattribute float aLinesofar;\nvarying highp float vLinesofar;\n#endif\nuniform float cameraToCenterDistance;\n#if defined(HAS_STROKE_WIDTH)\nattribute float aLineStrokeWidth;\n#else\nuniform float lineStrokeWidth;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform mat4 modelMatrix;\nuniform float tileResolution;\nuniform float resolution;\nuniform float tileRatio;\nuniform float isRenderingTerrain;\n#if defined(HAS_LINE_DX) || defined(HAS_LINE_DY)\nattribute vec2 aLineDxDy;\n#endif\n#ifndef HAS_LINE_DX\nuniform float lineDx;\n#endif\n#ifndef HAS_LINE_DY\nuniform float lineDy;\n#endif\nuniform vec2 canvasSize;\nuniform float layerScale;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef USE_LINE_OFFSET\nattribute vec2 aExtrudeOffset;\n#endif\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#ifndef PICKING_MODE\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_PATTERN\n#if defined(HAS_PATTERN_ANIM) || defined(HAS_PATTERN_GAP)\nattribute vec2 aLinePattern;\n#endif\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#endif\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nattribute vec4 aDasharray;\nvarying vec4 vDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nattribute vec4 aDashColor;\nvarying vec4 vDashColor;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nattribute vec4 aStrokeColor;\nvarying vec4 vStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\nvarying float vOpacity;\n#endif\n#ifdef HAS_GRADIENT\nattribute float aGradIndex;\nvarying float vGradIndex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvarying vec3 vVertex;\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  float d = mod(abs(aExtrude.x), 2.);\n  float e = mod(abs(aExtrude.y), 2.);\n  vNormal = vec2(d, e * 2. - 1.);\n  vec4 f = vec4(c, 1.);\n  vec4 h = projViewModelMatrix * positionMatrix * f;\n  if(isRenderingTerrain == 1.) {\n    vVertex = (positionMatrix * f).xyz;\n  } else {\n    vVertex = (modelMatrix * positionMatrix * f).xyz;\n  }\n#ifdef HAS_STROKE_WIDTH\nfloat i = aLineStrokeWidth / 2. * layerScale;\n#else\nfloat i = lineStrokeWidth;\n#endif\n#ifdef HAS_LINE_WIDTH\nfloat j = aLineWidth / 2. * layerScale;\n#else\nfloat j = lineWidth * layerScale;\n#endif\nfloat k = j / 2. + i;\n  float l = sign(i) * j / 2.;\n  float m = l + sign(l) * ANTIALIASING;\n  float n = k + sign(k) * ANTIALIASING;\n#ifdef USE_LINE_OFFSET\nvec2 o = lineOffset * (vNormal.y * (aExtrude.xy - aExtrudeOffset) + aExtrudeOffset);\n  vec2 u = (n * aExtrude.xy + o) / EXTRUDE_SCALE;\n#else\nvec2 v = aExtrude.xy / EXTRUDE_SCALE;\n  vec2 u = n * v;\n#endif\nfloat A = tileResolution / resolution;\n  vec4 B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n  gl_Position = projViewModelMatrix * positionMatrix * B;\n  if(isRenderingTerrain == .0) {\n    float C = min(AA_CLIP_LIMIT / canvasSize.x, AA_CLIP_LIMIT / canvasSize.y);\n    float D = distance(gl_Position.xy / gl_Position.w, h.xy / h.w) - C;\n    if(D * j < .0) {\n      float E = -D / C;\n      float F = E * E * E * E * AA_LINE_WIDTH;\n      u += F * v;\n      n += F / 6.;\n      B = vec4(c + vec3(u, .0) * tileRatio / A, 1.);\n      gl_Position = projViewModelMatrix * positionMatrix * B;\n    }\n  }\n#ifdef HAS_LINE_DX\nfloat G = aLineDxDy[0];\n#else\nfloat G = lineDx;\n#endif\n#ifdef HAS_LINE_DY\nfloat H = aLineDxDy[1];\n#else\nfloat H = lineDy;\n#endif\nfloat I = gl_Position.w;\n  gl_Position.xy += vec2(G, H) * 2. / canvasSize * I;\n#ifndef PICKING_MODE\nvWidth = vec2(n, m);\n  if(isRenderingTerrain == 1.) {\n    vGammaScale = 1.;\n  } else {\n    vGammaScale = I / cameraToCenterDistance;\n  }\n#ifndef ENABLE_TILE_STENCIL\nvPosition = c.xy;\n#ifdef USE_LINE_OFFSET\nvPosition += tileRatio * o / EXTRUDE_SCALE;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT)\n#ifdef HAS_GRADIENT\nvLinesofar = aLinesofar / MAX_LINE_DISTANCE;\n  vGradIndex = aGradIndex;\n#else\nfloat J = aLinesofar - k * aExtrude.z / EXTRUDE_SCALE / A * tileRatio;\n  vLinesofar = J / tileRatio * A;\n#endif\n#endif\n#ifndef HAS_GRADIENT\n#ifdef HAS_COLOR\nvColor = aColor;\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvDasharray = aDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvDashColor = aDashColor / 255.;\n#endif\n#endif\n#ifdef HAS_PATTERN\nvTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n#ifdef HAS_PATTERN_ANIM\nvLinePatternAnimSpeed = aLinePattern[0] / 127.;\n#endif\n#ifdef HAS_PATTERN_GAP\nvLinePatternGap = aLinePattern[1] / 10.0;\n#endif\n#endif\n#endif\n#ifdef HAS_STROKE_COLOR\nvStrokeColor = aStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(B);\n#endif\nhighlight_setVarying();\n#else\nfbo_picking_setData(I, true);\n#endif\n}";const rr$2=identity$2([]),sr$2=[];class or$2 extends Bi$1{static getBloomSymbol(){return["lineBloom"]}prepareSymbol(t){const e=t.lineColor;Array.isArray(e)&&(3===e.length&&e.push(1),t.lineColor=e.map((t=>255*t)));const n=t.lineStrokeColor;Array.isArray(n)&&(3===n.length&&n.push(1),t.lineStrokeColor=n.map((t=>255*t)));const i=t.lineDashColor;Array.isArray(i)&&(3===i.length&&i.push(1),t.lineDashColor=i.map((t=>255*t)))}isAnimating(){if(this.Ar)return!0;const t=this.getSymbols(),e=this.sceneConfig.trailAnimation;if(e&&e.enable)return!0;for(let e=0;e<t.length;e++)if(t[e].linePatternFile&&t[e].linePatternAnimSpeed)return!0;return!1}needToRedraw(){return!!super.needToRedraw()||!!this.isAnimating()}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[or$2.getBloomSymbol()[0]]}needPolygonOffset(){return!0}createMesh(e,i){if(!e.geometry)return null;const{geometry:r,symbolIndex:s,ref:o}=e,a=this.getSymbolDef(s);void 0===o&&si$1(r,a,this.getFnTypeConfig(s));const l=this.getSymbol(s),h={tileResolution:r.properties.tileResolution,tileRatio:r.properties.tileRatio,tileExtent:r.properties.tileExtent};this.setLineUniforms(l,h),Ct$3(h,"lineColor",l,"lineColor","#fff",Rt$3(this.colorCache)),Ct$3(h,"linePatterGapColor",l,"linePatterGapColor",[0,0,0,0],Rt$3(this.colorCache)),Ct$3(h,"lineStrokeColor",l,"lineStrokeColor",[0,0,0,0],Rt$3(this.colorCache)),Ct$3(h,"lineDasharray",l,"lineDasharray",[0,0,0,0],(t=>{let e;if(t&&t.length){const n=t;1===t.length?e=[n[0],n[0],n[0],n[0]]:2===t.length?e=[n[0],n[1],n[0],n[1]]:3===t.length?e=[n[0],n[1],n[2],n[2]]:4===t.length?e=t:t.length>4&&(e=t.slice(0,4))}return e||[0,0,0,0]})),Ct$3(h,"lineDashColor",l,"lineDashColor",[0,0,0,0],Rt$3(this.colorCache));const u=r.properties.iconAtlas,c=this.layer instanceof t__namespace.TileLayer;u&&(h.linePatternFile=Wi$1(this.regl,u,!1,!1),h.atlasSize=u?[u.width,u.height]:[0,0],h.flipY=c?-1:1,this.drawDebugAtlas(u)),void 0===o&&r.generateBuffers(this.regl);const f=new Ce$5(h),d=new Be$5(r,f,{castShadow:!1,picking:!0});d.setLocalTransform(i),d.positionMatrix=this.getAltitudeOffsetMatrix();const p={};return u&&(p.HAS_PATTERN=1),d.properties.symbolIndex=s,this.wr(d,p),r.data.aColor&&(p.HAS_COLOR=1),r.data.aStrokeColor&&(p.HAS_STROKE_COLOR=1),this.setMeshDefines(p,r,a),r.data.aAltitude&&(p.HAS_ALTITUDE=1),d.setDefines(p),d}addMesh(...t){delete this.Ar;const e=t[0];Array.isArray(e)&&e.forEach((t=>{this._r(t)})),super.addMesh(...t)}_r(t){if(!t.geometry.aLineWidth&&t.material.get("lineWidth")<=0||!t.geometry.aOpacity&&t.material.get("lineOpacity")<=0)return;const e=t.defines;this.wr(t,e),t.setDefines(e),t.geometry.properties.hasPatternAnim&&(this.Ar=1)}wr(t,e){const n=t.geometry,i=this.getSymbol(t.properties.symbolIndex);n.data.aDasharray||Array.isArray(i.lineDasharray)&&i.lineDasharray.reduce(((t,e)=>t+e),0)>0?(e.HAS_DASHARRAY=1,n.data.aDasharray&&(e.HAS_DASHARRAY_ATTR=1),n.data.aDashColor&&(e.HAS_DASHARRAY_COLOR=1)):e.HAS_DASHARRAY&&delete e.HAS_DASHARRAY}setLineUniforms(t,e){Ct$3(e,"lineWidth",t,"lineWidth",2),Ct$3(e,"lineOpacity",t,"lineOpacity",1),Ct$3(e,"lineStrokeWidth",t,"lineStrokeWidth",0),Ct$3(e,"lineBlur",t,"lineBlur",.7),Ct$3(e,"lineOffset",t,"lineOffset",0),Ct$3(e,"lineDx",t,"lineDx",0),Ct$3(e,"lineDy",t,"lineDy",0),Ct$3(e,"linePatternAnimSpeed",t,"linePatternAnimSpeed",0),Ct$3(e,"linePatternGap",t,"linePatternGap",0)}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),e.data.aLineStrokeWidth&&(t.HAS_STROKE_WIDTH=1),yi$1(n.lineDx)&&(t.HAS_LINE_DX=1),yi$1(n.lineDy)&&(t.HAS_LINE_DY=1),yi$1(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),yi$1(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){this.isShadowIncludeChanged(t)&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}createFnTypeConfig(t,e){const n=piecewiseConstant(e.lineColor),i=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),s=this.createShapeFnTypeConfigs(t,e),o=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Dt$3(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,s)=>{let a=i(t.getZoom(),e);return It$3(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),o[0]=a/127,o[1]=r[s+1],o}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,s)=>{let a=r(t.getZoom(),e);return It$3(a)&&(a=0),o[1]=10*a,o[0]=i[s],o}}].concat(s)}createShapeFnTypeConfigs(t,e){const n=interpolated(e.lineWidth),i=interpolated(e.lineOpacity),r=interpolated(e.lineStrokeWidth),s=interpolated(e.lineDx),o=interpolated(e.lineDy),a=new Uint16Array(1),l=new Int8Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e)),a[0]=Math.round(2*r),a[0]}},{attrName:"aLineStrokeWidth",symbolName:"lineStrokeWidth",type:Uint8Array,width:1,define:"HAS_STROKE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return a[0]=Math.round(2*n),a[0]}},{attrName:"aLineDxDy",symbolName:"lineDx",type:Int8Array,width:2,define:"HAS_LINE_DX",evaluate:e=>{const n=s(t.getZoom(),e);return l[0]=n,l[0]}},{attrName:"aLineDxDy",symbolName:"lineDy",type:Int8Array,width:2,define:"HAS_LINE_DY",evaluate:e=>{const n=o(t.getZoom(),e);return l[0]=n,l[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),a[0]=255*r,a[0]}}]}updateSceneConfig(t){t.trailAnimation&&this.createShader(this.Sr)}init(t){this.renderer=new B$6(this.regl),this.createShader(t),this.pickingFBO&&(this.picking=[new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+ir$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())])}createShader(t){this.Sr=t;const e=[],i={};this.fillIncludes(i,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const s=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(s,e.projViewMatrix,e.modelMatrix),s}}),this.shader=new vn$4({vert:ir$2,frag:"#define SHADER_NAME LINE\n#define DEVICE_PIXEL_RATIO 1.0\nprecision highp float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\nuniform lowp float blendSrcIsOne;\nuniform lowp float lineBlur;\nuniform float isRenderingTerrain;\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform lowp vec4 lineColor;\n#endif\n#include <highlight_frag>\n#ifdef HAS_STROKE_COLOR\nvarying vec4 vStrokeColor;\n#else\nuniform lowp vec4 lineStrokeColor;\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\n#ifdef HAS_PATTERN\nuniform sampler2D linePatternFile;\nuniform vec2 atlasSize;\nuniform float flipY;\n#ifdef HAS_PATTERN_ANIM\nvarying float vLinePatternAnimSpeed;\n#else\nuniform float linePatternAnimSpeed;\n#endif\n#ifdef HAS_PATTERN_GAP\nvarying float vLinePatternGap;\n#else\nuniform float linePatternGap;\n#endif\nuniform vec4 linePatterGapColor;\nvarying vec4 vTexInfo;\nvec2 c(vec2 d) {\n  vec2 e = mod(d, 1.);\n  vec2 f = vTexInfo.xy;\n  vec2 h = vTexInfo.zw;\n  return (f + e * h) / atlasSize;\n}\n#endif\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\nuniform float tileExtent;\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvarying vec4 vDasharray;\n#else\nuniform vec4 lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvarying vec4 vDashColor;\n#else\nuniform vec4 lineDashColor;\n#endif\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nvarying highp float vLinesofar;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\n#endif\n#if defined(HAS_TRAIL) || defined(HAS_PATTERN)\nuniform float currentTime;\n#endif\nfloat i(float j, float k) {\n  float l = k / 2.;\n  float m = abs(j - l);\n  float n = (.1 + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  return clamp(min(m + n, l - m) / n, .0, 1.);\n}\nvarying vec3 vVertex;\nuniform vec3 cameraPosition;\nuniform float cameraToCenterDistance;\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat o = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(o == .0) {\n    discard;\n  }\n#endif\n#if defined(HAS_PATTERN) || defined(HAS_DASHARRAY) || defined(HAS_GRADIENT) || defined(HAS_TRAIL)\nfloat u = vLinesofar;\n#endif\nfloat v = length(vNormal) * vWidth.s;\n#ifdef HAS_PATTERN\nvec2 h = vTexInfo.zw;\n  float A = sign(h.x * h.y);\n  float B = mix(lineBlur, .0, A);\n#else\nfloat B = lineBlur;\n#endif\nfloat n = (B + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float C = clamp(min(v - (vWidth.t - n), vWidth.s - v) / n, .0, 1.);\n#ifdef HAS_COLOR\nvec4 D = vColor / 255.;\n#else\nvec4 D = lineColor;\n#endif\n#ifdef HAS_PATTERN\nif(A == 1.) {\n    \n#ifdef HAS_PATTERN_GAP\nfloat E = vLinePatternGap;\n#else\nfloat E = linePatternGap;\n#endif\n#ifdef HAS_PATTERN_ANIM\nfloat F = vLinePatternAnimSpeed;\n#else\nfloat F = linePatternAnimSpeed;\n#endif\nfloat G = h.x * vWidth.s * 2. / h.y;\n    float H = G * (1. + E);\n    u += mod(currentTime * -F * .2, H);\n    float I = mod(u / H, 1.);\n    float J = mod((flipY * vNormal.y + 1.) / 2., 1.);\n    vec4 K = texture2D(linePatternFile, c(vec2(I * (1. + E), J)));\n    float L = clamp(sign(1. / (1. + E) - I) + .000001, .0, 1.);\n    K = mix(linePatterGapColor, K, L);\n    D *= K;\n  }\n#endif\n#ifdef HAS_DASHARRAY\n#ifdef HAS_DASHARRAY_ATTR\nvec4 M = vDasharray;\n#else\nvec4 M = lineDasharray;\n#endif\n#ifdef HAS_DASHARRAY_COLOR\nvec4 N = vDashColor;\n#else\nvec4 N = lineDashColor;\n#endif\nfloat k = M[0] + M[1] + M[2] + M[3];\n  float j = mod(u, k);\n  float O = max(sign(M[0] - j), .0);\n  float P = j - M[0] - M[1];\n  float Q = max(sign(P), .0) * max(sign(M[2] - P), .0);\n  float R = O + Q;\n  float S = i(j, M[0]);\n  float T = i(P, M[2]);\n  float U = S * O + T * Q;\n  D = D * (1. - U) + N * U;\n#endif\n#ifdef HAS_STROKE_COLOR\nvec4 V = vStrokeColor / 255.;\n#else\nvec4 V = lineStrokeColor;\n#endif\nV = mix(D, V, sign(vWidth.t));\n  D = V * C + max(sign(vWidth.t - v), .0) * D * (1. - C);\n#ifdef HAS_TRAIL\nfloat W = mod(u - currentTime * trailSpeed * .1, trailCircle);\n  float X = W < trailLength ? mix(.0, 1., W / trailLength) : .0;\n  D *= X;\n#endif\n#ifdef HAS_OPACITY\nfloat Y = vOpacity;\n#else\nfloat Y = lineOpacity;\n#endif\ngl_FragColor = D * Y * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat Z = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, Z);\n#endif\nfloat ba;\n  if(isRenderingTerrain == 1.) {\n    ba = 1.;\n  } else {\n    ba = clamp(cameraToCenterDistance * 1.5 / distance(vVertex, cameraPosition), .0, 1.);\n  }\n  gl_FragColor *= ba;\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:i,extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.layer.getRenderer().isEnableTileStencil&&this.layer.getRenderer().isEnableTileStencil(),e=this.canvas;return{viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},stencil:{enable:!1,func:{cmp:()=>t?"=":"<=",ref:(e,n)=>t?n.stencilRef:n.level},op:{fail:"keep",zfail:"keep",zpass:()=>t?"zero":"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!1,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.getTileSize().width,r=n?rr$2:t.projViewMatrix,s=t.viewMatrix,o=t.cameraToCenterDistance,a=t.getResolution(),l=set(sr$2,t.width,t.height);n&&set(l,i,i);const u=this.getBlendFunc().src(),c=this.sceneConfig.trailAnimation||{},f={layerScale:this.layer.options.styleScale||1,projViewMatrix:r,viewMatrix:s,cameraToCenterDistance:o,resolution:a,canvasSize:l,trailSpeed:c.speed||1,trailLength:c.trailLength||500,trailCircle:c.trailCircle||1e3,currentTime:this.layer.getRenderer().getFrameTimestamp()||0,blendSrcIsOne:+!(1!==u&&"one"!==u),cameraPosition:t.cameraPosition,viewport:n&&e&&e.viewport,isRenderingTerrain:+!!n};return this.setIncludeUniformValues(f,e),f}}class ar$2 extends or$2{postCreateGeometry(t){const{symbolIndex:e,geometry:n}=t,{features:i}=n.properties,r=this.getSymbol(e).lineGradientProperty,s=n.data.aPickingId,o=new Uint8Array(s.length),a=[];let l=s[0];const h=i[l].feature.properties;a.push(h&&h[r]||0);for(let t=1;t<s.length;t++)s[t]!==l&&(l=s[t],a.push(h&&h[r]||0)),o[t]=a.length-1;n.data.aGradIndex=o,n.properties.gradients=a}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:s}=t,o=this.getSymbolDef(r);void 0===s&&si$1(i,o,this.getFnTypeConfig(r));const a={tileResolution:i.properties.tileResolution,tileRatio:i.properties.tileRatio,tileExtent:i.properties.tileExtent},l=this.getSymbol(r);this.setLineUniforms(l,a);const h=i.properties.gradients;let u=2*h.length;hr$2(u)||(u=ur$2(u));const c=this.regl.texture({width:256,height:u,data:lr$2(h),format:"rgba",mag:"linear",min:"linear",flipY:!1});a.lineGradientTexture=c,a.lineGradientTextureHeight=c.height,void 0===s&&i.generateBuffers(this.regl);const f=new Ce$5(a),d=new Be$5(i,f,{castShadow:!1,picking:!0});d.setLocalTransform(e);const p={HAS_GRADIENT:1};return i.data.aAltitude&&(p.HAS_ALTITUDE=1),this.setMeshDefines(p,i,o),d.setDefines(p),d.properties.symbolIndex=r,d}createFnTypeConfig(t,e){return this.createShapeFnTypeConfigs(t,e)}createShader(t){this.Sr=t;const e=[],i={};this.fillIncludes(i,e,t),this.sceneConfig.trailAnimation&&this.sceneConfig.trailAnimation.enable&&(i.HAS_TRAIL=1);const s=[];e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(s,e.projViewMatrix,e.modelMatrix),s}}),this.shader=new vn$4({vert:ir$2,frag:"#define SHADER_NAME LINE_GRADIENT\n#define DEVICE_PIXEL_RATIO 1.0\n#define MAX_LINE_COUNT 128.0\nprecision mediump float;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_frag>\n#endif\n#ifdef HAS_OPACITY\nvarying float vOpacity;\n#else\nuniform lowp float lineOpacity;\n#endif\nuniform float layerOpacity;\nuniform lowp float lineBlur;\nuniform float lineGradientTextureHeight;\nuniform float tileExtent;\nuniform sampler2D lineGradientTexture;\nvarying vec2 vNormal;\nvarying vec2 vWidth;\nvarying float vGammaScale;\nvarying highp float vLinesofar;\nvarying float vGradIndex;\n#ifndef ENABLE_TILE_STENCIL\nvarying vec2 vPosition;\n#endif\n#ifdef HAS_TRAIL\nuniform float trailSpeed;\nuniform float trailLength;\nuniform float trailCircle;\nuniform float currentTime;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifndef ENABLE_TILE_STENCIL\nfloat c = sign(tileExtent - min(tileExtent, abs(vPosition.x))) * sign(1. + sign(vPosition.x)) * sign(tileExtent - min(tileExtent, abs(vPosition.y))) * sign(1. + sign(vPosition.y));\n  if(c == .0) {\n    discard;\n  }\n#endif\nfloat d = length(vNormal) * vWidth.s;\n  float e = (lineBlur + 1. / DEVICE_PIXEL_RATIO) * vGammaScale;\n  float f = clamp(min(d - (vWidth.t - e), vWidth.s - d) / e, .0, 1.);\n  float h = vLinesofar;\n  vec4 i = texture2D(lineGradientTexture, vec2(h, (vGradIndex * 2. + .5) / lineGradientTextureHeight)) * f;\n  i *= max(sign(MAX_LINE_COUNT - vGradIndex), .0);\n#ifdef HAS_TRAIL\nfloat j = mod(h - currentTime * trailSpeed * .1, trailCircle);\n  float k = j < trailLength ? mix(.0, 1., j / trailLength) : .0;\n  i *= k;\n#endif\n#ifdef HAS_OPACITY\nfloat l = vOpacity;\n#else\nfloat l = lineOpacity;\n#endif\ngl_FragColor = i * l * layerOpacity;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nfloat m = shadow_computeShadow();\n  gl_FragColor.rgb = shadow_blend(gl_FragColor.rgb, m);\n#endif\ngl_FragColor = highlight_blendColor(gl_FragColor);\n}",uniforms:e,defines:i,extraCommandProps:this.getExtraCommandProps()})}}function lr$2(t){t.length>128&&(console.warn("Line count in a tile exceeds maximum limit (128) for line-gradient render plugin."),t=t.slice(0,128));const e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=2*t.length,hr$2(e.height)||(e.height=ur$2(2*t.length));for(let e=0;e<t.length;e++){const i=t[e],r=n.createLinearGradient(0,0,256,0);for(let t=0;t<i.length;t+=2)r.addColorStop(+i[t],i[t+1]);n.fillStyle=r;const s=e%256;n.fillRect(0,2*s,256,2*s+2)}return n.canvas}function hr$2(t){return 0==(t&t-1)&&0!==t}function ur$2(t){return Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}class cr$2{constructor(t){this.R=t||[],this.properties={}}set meshes(t){this.R=t}get meshes(){return this.R}}const mr$2=new Uint8Array(1),yr$2=[],gr$2={collides:0,boxes:[]},vr$2=[],xr$2=[];class br$2 extends Bi$1{createGeometry(...t){const e=super.createGeometry(...t);if(!e||!e.geometry)return e;const{geometry:n}=e,i=t[0];return n.properties.collideIds=i.featureIds&&i.featureIds.length&&i.isIdUnique?i.featureIds:i.data.aPickingId,n.properties.uniqueCollideIds=Ut$2(n.properties.collideIds),e}supportRenderMode(t){const e=this.sceneConfig.renderToPointRenderTarget;return e||void 0===e?"point"===t:"fxaa"===t||"fxaaAfterTaa"===t}addMesh(t,e,n){if(t&&!this.isEnableCollision()){let e=t;Array.isArray(e)||(vr$2[0]=t,e=vr$2);for(let t=0;t<e.length;t++){const n=e[t].defines;delete n.ENABLE_COLLISION,e[t].setDefines(n);const{elements:i,visElemts:r}=e[t].geometry.properties;r&&void 0!==r.count&&r.count!==i.length&&(e[t].geometry.setElements(i),r.count=i.length)}}return super.addMesh(t,e,n)}startMeshCollision(t){const{meshKey:e}=t.properties,{renderer:n}=this.Mr,i=n.isForeground(t instanceof cr$2?t.meshes[0]:t);if(t.properties.isForeground=i,t instanceof cr$2&&t.meshes.length)for(let e=0;e<t.meshes.length;e++)t.meshes[e].properties.isForeground=i;this.Pr=performance.now(),this.Tr=this.kr(),this.Or=this.Ir(e)}endMeshCollision(e){const n=this.Fr.tags[e];if(this.Tr&&n&&this.Or){const e=this.getMap();this.Cr||(this.Cr=new t__namespace.Coordinate(0,0),this.Er=new t__namespace.Coordinate(0,0)),n.anchor0=e.containerPointToCoord(this.Dr,this.Cr),n.anchor1=e.containerPointToCoord(this.Rr,this.Er),n.anchor0.z=e.getZoom(),n.anchor0.width=e.width,n.anchor0.height=e.height}this.getMap().collisionFrameTime+=performance.now()-this.Pr}Ir(t){const e=this.getMap(),n=e.getZoom(),[i,r]=this.Lr(t);return!i||!r||i.z!==n||i.width!==e.width||i.height!==e.height||i.distanceTo(this.Dr)>3||r.distanceTo(this.Rr)>3}Nr(){const e=this.getMap();this.Hr={},this.Dr=new t__namespace.Point(e.width/2,e.height/3),this.Rr=new t__namespace.Point(e.width/2,2*e.height/3),delete this.Tr,this.Fr||(this.Fr={tags:{}}),this.Mr={layer:this.layer,renderer:this.layer.getRenderer(),frameTimestamp:this.layer.getRenderer().getFrameTimestamp(),map:this.getMap(),zoom:e.getZoom(),collisionTags:this.Fr.tags,isEnableUniquePlacement:this.isEnableUniquePlacement()}}zr(){}Vr(t,e){const n=this.Fr;return n.tags[t]&&n.tags[t][e]}Ur(t,e,n){const i=this.Fr;i.tags[t]=i.tags[t]||[],i.tags[t][e]=n}kr(){const t=this.getMap();if(!t.isInteracting())return!0;return t.collisionFrameTime<=this.layer.options.collisionFrameLimit}Lr(t){const e="__meshAnchorKey".trim(),n=this.Fr.tags[t];if(n&&n.anchor0){const{anchor0:t,anchor1:i}=n,r=t[e]=t[e]||t.x+","+t.y,s=i[e]=i[e]||i.x+","+i.y;let o=this.Hr[r],a=this.Hr[s];if(!o||!a){const e=this.getMap();o=this.Hr[r]=e.coordToContainerPoint(t),a=this.Hr[s]=e.coordToContainerPoint(i)}return o.z=t.z,yr$2[0]=o,yr$2[1]=a,o.width=t.width,o.height=t.height,yr$2}return yr$2[0]=yr$2[1]=null,yr$2}updateBoxCollisionFading(t,e,n,i,r){const{layer:s,renderer:o,zoom:a,collisionTags:l,isEnableUniquePlacement:h}=this.Mr,{meshKey:u,isForeground:c}=e.properties;if(h&&this.jr(u,r))return!1;const f=n.length;let d=l[u]&&l[u][r];const p=d,m=this.Br&&d;if((!m||0===d.collides)&&t){const t=m&&0===d.collides;if(this.Tr||t)if((this.Or||d&&d.z!==a)&&(d=null),d){if(d.boxes&&d.boxes.length){const{boxes:t,isAllowOverlap:e}=d;let n=0;if(!e){let e=0;for(let i=0;i<t.length;i++)if(!n){const r=this.isCollides(t[i]);if(-1===r)e++;else if(1===r){n=1;break}}e===t.length&&(n=-1)}d.collides=n}}else{d=p||{collides:0,boxes:[]},d.boxes.length=0,d.z=a;let t=0;for(let e=0;e<f;e++){const{mesh:s,allElements:o,boxCount:a,start:l,end:h}=n[e],u=this.Gr(s,o,a,l,h,i,r);u.isAllowOverlap&&(d.isAllowOverlap=1),0===t&&(t=u.collides),u.boxes&&d.boxes.push(...u.boxes)}d.collides=t,this.Ur(u,r,d)}}let y=t&&d&&0===d.collides,g=1,v=!1;if(this.sceneConfig.fading){const t=this.Wr(e);if(this.Xr)t[r]=y?1:-1;else if(c&&delete e.Yr,g=this.$r(c,y,t,r),c?(g>0&&(y=!0),v=this.isBoxFading(e,r),v&&this.setToRedraw()):y||(this.qr(t,r),g=0),y){const n=e.Yr;if(n&&1===g&&t[r]>0){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;It$3(e)&&(e=224),It$3(t)&&(t=100);const i=kt$3(1-(o.getFrameTimestamp()-n-t)/e,0,1);g*=i,i>0&&this.setToRedraw()}}}if(d&&s.options.debugCollision&&this.addCollisionDebugBox(d.boxes,d.collides?0:1),y||v){const{mesh:t,start:e}=n[0],i=this.getSymbol(t.properties.symbolIndex);!this.Jr(i,t,e)&&d&&d.boxes&&this.Kr(d.boxes,t)}if(y){const t=mr$2[0]=255*g;for(let e=0;e<f;e++){const{mesh:i,allElements:r,start:s,end:o,boxIndex:a}=n[e];this.setCollisionOpacity(i,r,t,s,o,a)}}return y&&g>0}isMeshIterable(){return!0}setCollisionOpacity(t,e,n,i,r){this.Zr(t,n,e[i],e[r-1])}Zr(t,e,n,i){const{aOpacity:r}=t.geometry.properties;if(!r)return;const s=n;if(r[s]!==e){const t=i;for(let n=s;n<=t;n++)r[n]=e;r.dirty=!0}}isBoxFading(t,e){const{frameTimestamp:n}=this.Mr;let i=this.sceneConfig.fadingDuration;return It$3(i)&&(i=224),n-Math.abs(this.Wr(t)[e])<i}Gr(t,e,n,i,r,s,o){const a=this.getSymbol(t.properties.symbolIndex),l=this.Jr(a,t,e[i]),h=this.Qr(a,t,e[i]);if(!this.isEnableCollision()||l&&h)return gr$2;const u=this.isBoxCollides(t,e,n,i,r,s,o);return h&&(u.collides=0,u.isAllowOverlap=1),u}Jr(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propIgnorePlacement];const r=i[n];return r<2?1==+t[this.propIgnorePlacement]:r%8%2}Qr(t,e,n){if(!this.isEnableCollision())return!0;const i=e.geometry.properties.aOverlap;if(!i)return 1==+t[this.propAllowOverlap];const r=i[n];return r<2?1==+t[this.propAllowOverlap]:(r>>2)%2}Kr(t){if(Array.isArray(t[0]))for(let e=0;e<t.length;e++)this.insertCollisionBox(t[e]);else this.insertCollisionBox(t)}$r(t,e,n,i){let{fadingDuration:r,fadeInDelay:s,fadeOutDelay:o}=this.sceneConfig;It$3(r)&&(r=224),It$3(s)&&(s=600),It$3(o)&&(o=100);const{frameTimestamp:a}=this.Mr;let l=n[i],h=e?1:0;if(!l)return e&&t&&(n[i]=a+s),0;if(a<Math.abs(l)&&(!e&&l>0||e&&l<0)){const t=a-r;n[i]=l=e?t:-t}return a-Math.abs(l)<r?h=l>0?(a-l)/r:1-(a+l)/r:e?(l<0&&(n[i]=l=a+s),h=(a-l)/r):(l>0&&(n[i]=l=-(a+o)),h=1-(a+l)/r),(h<0||h>1)&&(h=kt$3(h,0,1)),h}Wr(t){this.ts||(this.ts={});const{meshKey:e}=t.properties;if(!this.ts[e]){const{frameTimestamp:t}=this.Mr;this.ts[e]={timestamp:t}}return this.ts[e]}es(t){if(!this.ns)return void(this.ns=t);const e=this.scene.getMeshes();if(e&&e.length){for(let n=0;n<e.length;n++){const i=this.Wr(e[n]);i.timestamp<this.ns?delete e[n]._fading_timestamps:i.timestamp=t}this.ns=t}}qr(t,e){if(!t)return;const{frameTimestamp:n}=this.Mr;let{fadingDuration:i}=this.sceneConfig;It$3(i)&&(i=224),t[e]=-(n-i-1)}deleteMesh(t,e){if(t){if(Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].properties.meshKey;this.Fr&&delete this.Fr.tags[n],this.ts&&delete this.ts[n]}else{const e=t.properties.meshKey;this.Fr&&delete this.Fr.tags[e],this.ts&&delete this.ts[e]}super.deleteMesh(t,e)}}delete(t){this.rs&&(this.rs.geometry.dispose(),this.ss.dispose(),this.rs.dispose(),delete this.rs,delete this.ss,delete this.os),delete this.Fr,super.delete(t)}isCollides(t){const e=this.layer,n=e.getMap(),i=n.getDevicePixelRatio();if(scale$3(xr$2,t,1/i),n.isOffscreen(xr$2))return-1;const r=e.getCollisionIndex(),s=this.sceneConfig.collisionBufferSize||e.options.collisionBufferSize||0;return s&&(t=_r$2(xr$2,t,s)),+r.collides(t)}insertCollisionBox(t){const e=this.layer,n=e.getCollisionIndex(),i=this.sceneConfig.collisionBufferSize||e.options.collisionBufferSize||0;let r=t;i&&(r=t.as=t.as||[],t=_r$2(r,t,i)),n.insertBox(r)}addCollisionDebugBox(t,e){if(t&&t.length)if(Array.isArray(t[0]))for(let n=0;n<t.length;n++){this.ls(t[n],e)}else this.ls(t,e)}ls(t,e){if(!t)return;const n=this.hs=this.hs||{aPosition:[],aVisible:[],indices:[]},i=this.sceneConfig.collisionBufferSize||this.layer.options.collisionBufferSize||0;i&&(t=_r$2(xr$2,t,i));const r=this.getMap(),s=r.getDevicePixelRatio();if(scale$3(xr$2,t,1/s),r.isOffscreen(xr$2))return;const o=n.aPosition.length/2;n.aPosition.push(t[0],t[1],t[2],t[1],t[2],t[3],t[0],t[3]),n.aVisible.push(e,e,e,e),n.indices.push(o,o+1,o+1,o+2,o+2,o+3,o+3,o)}updateCollision(t){super.updateCollision(t),this.Nr(),this.us(),this.cs&&this.cs.length&&(this.fs(),this.cs&&(this.setToRedraw(),this.scene.addMesh(this.cs))),(this.getMap().isZooming()||this.cs&&this.cs.length)&&(this.ds(),this.ps(this.scene.getMeshes()))}paint(t){const e=super.paint(t);return this.ms(t),!1===this.Tr&&this.setToRedraw(),e}shouldIgnoreBackground(){return!this.getMap().isZooming()&&!this.cs}us(){const t=this.getMap(),e=t.isZooming();if(!e&&this.Br){const t=this.layer.getRenderer();this.cs=this.scene.getMeshes().filter((e=>!t.isForeground(e)&&!e.properties.isLinePlacement))}else e&&!this.Br&&(this.ys=t.getResolution());if(e)this.gs&&(clearTimeout(this.gs),delete this.Xr,delete this.gs),this.Xr=this.ys&&t.getResolution()>this.ys;else if(this.Br&&!this.gs){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;It$3(t)&&(t=100),It$3(e)&&(e=224),this.gs=setTimeout((()=>{delete this.Xr,delete this.gs}),t+e+1)}this.Br=e}ms(t){if(!this.hs||!this.layer.options.debugCollision)return;this.os||this.vs();const{aPosition:e,aVisible:i,indices:r}=this.hs;if(!this.rs){const t=new Q$7({aPosition:[],aVisible:[]},[],0,{positionSize:2,primitive:"lines"});this.rs=new Be$5(t),this.xs=new Ke$5,this.xs.addMesh(this.rs)}const s=this.rs.geometry;s.updateData("aPosition",new Float32Array(e)),s.updateData("aVisible",new Uint8Array(i)),s.setElements(r),this.os.render(this.ss,{size:[this.canvas.width,this.canvas.height]},this.xs,this.getRenderFBO(t)),delete this.hs}vs(){this.os=new B$6(this.regl);const e=this.canvas;this.ss=new vn$4({vert:"attribute vec2 aPosition;\nattribute float aVisible;\nuniform vec2 size;\nvarying vec4 vColor;\nvoid main() {\n  vec2 c = (aPosition / size - .5) * 2. * vec2(1., -1.);\n  gl_Position = vec4(c, .0, 1.);\n  vColor = mix(vec4(1., .0, .0, 1.5) * .5, vec4(.0, 1., .0, 1.) * .4, aVisible);\n}",frag:"precision mediump float;\nvarying vec4 vColor;\nvoid main() {\n  gl_FragColor = vec4(vColor.rgb, .5);\n}",uniforms:["size"],extraCommandProps:{viewport:{x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1},depth:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}})}fs(){let{fadeOutDelay:t,fadingDuration:e}=this.sceneConfig;It$3(t)&&(t=100),It$3(e)&&(e=224);const n=this.layer.getRenderer(),i=n.getCurrentTileZoom(),r=n.getFrameTimestamp(),s=[];for(let o=0;o<this.cs.length;o++){const a=this.cs[o],l=a.properties.tile;!a.Yr&&n.isBackTile(l.id)&&(a.Yr=r);a.properties.level=l.z-i>0?2*(l.z-i)-1:2*(i-l.z),n.isForeground(a)||a.Yr&&r-a.Yr>t+e?delete a.Yr:s.push(a)}delete this.cs,s.length&&(this.cs=s)}isEnableCollision(){return this.layer.options.collision&&!!this.sceneConfig.collision}isEnableUniquePlacement(){return this.isEnableCollision()&&this.sceneConfig.uniquePlacement}isMeshUniquePlaced(t){return this.isMeshIterable(t)}ds(){if(!this.isEnableUniquePlacement())return;const t=this.scene.getMeshes(),e=(t,e,n,i)=>{const{start:r,end:s}=e[0],o=t.geometry.properties,a=o.elements;let l=o.uniquePlacements;if(l||(l=o.uniquePlacements=[]),void 0===l[i]){const e=this.getUniqueEntryKey(t,a[r],i);l[i]=e?{key:e,index:i,start:a[r],end:a[s-1]}:null}};for(let n=0;n<t.length;n++){const i=t[n];this.isMeshUniquePlaced(i)&&this.forEachBox(i,e)}}ps(t){if(!this.isEnableUniquePlacement())return;const e=this.getMap().getZoom();let n=!this.bs||this.As!==e;if(!n)for(let e=0;e<t.length;e++)if(!this.bs[t[e].properties.meshKey]){n=!0;break}if(!n)return;this.As=e,this.ws={},this.bs={},t=t.sort(wr$2);const i=this.getMap().getGLScale(),r={};for(let e=0;e<t.length;e++){const n=t[e];if(!n.geometry)continue;const{meshKey:s}=n.properties;this.bs[s]=1;const{uniquePlacements:o}=n.geometry.properties;if(o)for(let t=0;t<o.length;t++){if(!o[t])continue;const{key:e,index:s}=o[t],a=this.Wr(n),l=Ar$2(e,i),h=r[l];if(h){const t=h.length,e=h[t-3].properties.meshKey,i=h[t-2],r=h[t-1];this.ws[e]=this.ws[e]||{},this.ws[e][r]=1,this._s(a,s,i,r),h.push(n,a,s)}else r[l]=[n,a,s]}}for(const t in r){const e=r[t];if(e.length<=6)continue;const n=e.length,i=e[n-2][e[n-1]];if(e[1][e[2]]!==i)for(let t=0;t<n-6;t+=3)e[t+1][e[t+2]]=i}}_s(t,e,n,i){if(void 0!==n[i])if(void 0===t[e])t[e]=n[i];else{let r=t[e];Math.abs(n[i])>Math.abs(r)?t[e]=n[i]:n[i]=t[e]}else void 0!==t[e]&&(n[i]=t[e])}jr(t,e){return this.ws&&this.ws[t]&&this.ws[t][e]}Ss(t,e){const{symbolIndex:n}=t.properties,i=n.type||0;let r=t.properties._collidesBoxes;r||(r=t.properties._collidesBoxes=[]);let s=r[n.index];s||(s=t.properties._collidesBoxes=[]),s[i]||(s[i]=[]),s=s[i];const o=e/6;if(!s[o]){const t=[];s[o]={boxes:t,collision:{boxes:t}}}return s[o]}Ms(t){let e=this.Ps;if(e||(e=this.Ps=[]),!e[t]){e[t]=[];for(let n=0;n<t;n++)e[t][n]={}}return e[t]}Ts(t){return!t||!t.geometry||!(!t.geometry.properties.glyphAtlas||!t.material.get("isHalo")||t.geometry.data.aTextHaloRadius&&t.geometry.properties.hasHalo)&&(!(!t.geometry.data.aTextHaloRadius||t.geometry.properties.hasHalo)||!this.getSymbol(t.geometry.properties.symbolIndex).textHaloRadius)}}function Ar$2(t,e){return Math.round(t[0]/e/10)*Math.round(t[1]/e/10)*(t[2]?Math.round(t[2]/10):1)+"-"+t[3]}function wr$2(t,e){const n=e.properties.level-t.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}function _r$2(t,e,n){return t[0]=e[0]-n,t[1]=e[1]-n,t[2]=e[2]+n,t[3]=e[3]+n,t}var Sr$2="#include <gl2_vert>\n#define SHADER_NAME MARKER\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_MARKER_WIDTH\nattribute float aMarkerWidth;\n#else\nuniform float markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nattribute float aMarkerHeight;\n#else\nuniform float markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nattribute float aMarkerDx;\n#else\nuniform float markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nattribute float aMarkerDy;\n#else\nuniform float markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#ifdef HAS_ROTATION\nattribute float aRotation;\n#else\nuniform float markerRotation;\n#endif\n#ifdef HAS_PAD_OFFSET\nattribute float aPadOffsetX;\nattribute float aPadOffsetY;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerPerspectiveRatio;\nuniform vec2 iconSize;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#include <vt_position_vert>\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vOpacity;\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_MARKER_WIDTH\nfloat d = aMarkerWidth;\n#else\nfloat d = markerWidth;\n#endif\n#ifdef HAS_MARKER_HEIGHT\nfloat e = aMarkerHeight;\n#else\nfloat e = markerHeight;\n#endif\n#ifdef HAS_MARKER_DX\nfloat f = aMarkerDx;\n#else\nfloat f = markerDx;\n#endif\n#ifdef HAS_MARKER_DY\nfloat h = aMarkerDy;\n#else\nfloat h = markerDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat i = aPitchAlign;\n#else\nfloat i = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat j = aRotationAlign;\n#else\nfloat j = rotateWithMap;\n#endif\ngl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float k = gl_Position.w;\n  float l;\n  if(isRenderingTerrain == 1. && i == 1.) {\n    l = 1.;\n  } else {\n    float m = (1. - cameraToCenterDistance / k) * markerPerspectiveRatio;\n    l = clamp(.5 + .5 * (1. - m), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat n = -aRotation / 9362. - mapRotation * j;\n#else\nfloat n = -markerRotation - mapRotation * j;\n#endif\nif(i == 1.) {\n    n += mapRotation;\n  }\n  float o = sin(n);\n  float u = cos(n);\n  mat2 v = mat2(u, -1. * o, o, u);\n  vec2 A = (aShape / 10.0);\n  if(i == 1. && flipY == .0) {\n    A *= vec2(1., -1.);\n  }\n#ifdef HAS_PAD_OFFSET\nA = (A / iconSize * vec2(d, e) + vec2(aPadOffsetX - 1., aPadOffsetY)) * layerScale;\n#else\nA = A / iconSize * vec2(d, e) * layerScale;\n#endif\nA = v * A;\n  if(i == .0) {\n    vec2 B = A * 2. / canvasSize;\n    gl_Position.xy += B * l * k;\n  } else {\n    float C;\n    if(isRenderingTerrain == 1.) {\n      C = 1.;\n    } else {\n      C = k / cameraToCenterDistance;\n    }\n    vec2 B = A;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(B, .0) * tileRatio / zoomScale * C * l, 1.);\n  }\n  gl_Position.xy += vec2(f, -h) * 2. / canvasSize * k;\n#ifndef PICKING_MODE\nvTexCoord = aTexCoord / texSize;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool D = aOpacity == 255.;\n#else\nbool D = true;\n#endif\nfbo_picking_setData(gl_Position.w, D);\n#endif\n}";const Mr$2=[],Pr$2=[],Tr$2=[],kr$2=[],Or$2=[],Ir$2=[];function Fr$2(t,e,n,r,s,o,l,u,c,f,d,p,m,y){const{tileRatio:g,tileResolution:v}=c,x=g/(v/f.getResolution())*(d/f.cameraToCenterDistance)*p;scale(n,n,x),scale(r,r,x),scale(s,s,x),scale(o,o,x),set$4(Mr$2,n[0],n[1],m?n[2]/y:0),set$4(Pr$2,r[0],r[1],m?r[2]/y:0),set$4(Tr$2,s[0],s[1],m?s[2]/y:0),set$4(kr$2,o[0],o[1],m?o[2]/y:0),add$4(Mr$2,Mr$2,e),add$4(Pr$2,Pr$2,e),add$4(Tr$2,Tr$2,e),add$4(kr$2,kr$2,e),bi$1(n,Mr$2,l,f.width,f.height),bi$1(r,Pr$2,l,f.width,f.height),bi$1(s,Tr$2,l,f.width,f.height),bi$1(o,kr$2,l,f.width,f.height),set(Or$2,Math.min(n[0],r[0],s[0],o[0]),Math.min(n[1],r[1],s[1],o[1])),set(Ir$2,Math.max(n[0],r[0],s[0],o[0]),Math.max(n[1],r[1],s[1],o[1])),set$3(t,Or$2[0]+u[0],Or$2[1]+u[1],Ir$2[0]+u[0],Ir$2[1]+u[1])}function Cr$2(t,e,n,i,r,s,o,l){1!==l&&(scale(n,n,l),scale(i,i,l),scale(r,r,l),scale(s,s,l)),set(Or$2,Math.min(n[0],i[0],r[0],s[0]),Math.min(n[1],i[1],r[1],s[1])),set(Ir$2,Math.max(n[0],i[0],r[0],s[0]),Math.max(n[1],i[1],r[1],s[1])),set$3(t,e[0]+Or$2[0]+o[0],e[1]+Or$2[1]-o[1],e[0]+Ir$2[0]+o[0],e[1]+Ir$2[1]-o[1])}function Er$2(t,e,n,i,r){e-=n*i,1===r&&(e+=n);const s=Math.sin(e),o=Math.cos(e);return set$8(t,o,-s,s,o)}const Dr$2=[],Rr$2=[],Lr$2=[],Nr$2=[],Hr$2=[],zr$2=[],Vr$2=[],Ur$2=[],jr$2=[1,-1],Br$2=[1,1];function Gr$2(t,e,n,r,s){const o=e.material.uniforms,a=s.cameraToCenterDistance,l=e.geometry.properties,u=this.getSymbol(l.symbolIndex),c=e.geometry.desc.positionSize,f=l.aAnchor,d=set$4(Dr$2,f[n*c],f[n*c+1],2===c?0:f[n*c+2]),{aTerrainAltitude:p}=l;if(p){const t=100*p[2*n];t&&(d[2]+=t)}let m=bi$1(Rr$2,d,r,s.width,s.height);const y=m[2];let g=1;o.markerPerspectiveRatio&&(g=kt$3(.5+.5*(1-(1-a/y)*o.markerPerspectiveRatio),0,4));const{aShape:v,aMarkerDx:x,aMarkerDy:b,aMarkerWidth:A,aMarkerHeight:w,aPitchAlign:_,aRotationAlign:S,aRotation:M}=l,k=_?_[n]:o.pitchWithMap,O=S?S[n]:o.rotateWithMap,I=set(Ur$2,(x?x[n]:u.markerDx)||0,-((b?b[n]:u.markerDy)||0));let F=set(Nr$2,v[2*n]/10,v[2*n+1]/10),C=set(Hr$2,v[2*n+2]/10,v[2*n+3]/10),E=set(zr$2,v[2*n+4]/10,v[2*n+5]/10),D=set(Vr$2,v[2*n+6]/10,v[2*n+7]/10);0===o.flipY&&1===k&&(multiply(F,F,jr$2),multiply(C,C,jr$2),multiply(E,E,jr$2),multiply(D,D,jr$2));const[R,L]=$i$1(e.geometry);let N=A?A[n]:u.markerWidth;It$3(N)&&(N=R||15);let H=w?w[n]:u.markerHeight;It$3(H)&&(H=L||15);const z=set(Br$2,N/2048,H/2048);mul(F,F,z),mul(C,C,z),mul(E,E,z),mul(D,D,z);const V=-(M?M[n]/9362:-(u.markerRotation||0)*Math.PI/180),U=s.getBearing()*Math.PI/180;if(U*O||V){const t=Er$2(Lr$2,V,U,O,k);F=transformMat2(F,F,t),C=transformMat2(C,C,t),E=transformMat2(E,E,t),D=transformMat2(D,D,t)}1===k?Fr$2(t,d,F,C,E,D,r,I,o,s,y,g):(multiply(F,F,jr$2),multiply(C,C,jr$2),multiply(E,E,jr$2),multiply(D,D,jr$2),Cr$2(t,m,F,C,E,D,I,g));const j=this.getMap().getDevicePixelRatio();return 1!==j&&(t[0]*=j,t[1]*=j,t[2]*=j,t[3]*=j),t}const Wr$2=[],Xr$2=[],Yr$2=[],$r$2=[],qr$2=[],Jr$2=[],Kr$2=[1,-1];function Zr$2(t,e,n,r,s,o,a,l,u){const c=r.material.uniforms,f=u.cameraToCenterDistance,d=r.geometry.properties,p=this.getSymbol(d.symbolIndex),m="line"===p.textPlacement&&!zt$2(p),y=n[2];let g=1;c.textPerspectiveRatio&&(g=kt$3(.5+.5*(1-(1-f/y)*c.textPerspectiveRatio),0,4));const{aTextDx:v,aTextDy:x,aPitchAlign:b,aRotationAlign:A,aRotation:w}=r.geometry.properties,M=b?b[a]:c.pitchWithMap,P=A?A[a]:c.rotateWithMap,T=set(Jr$2,(v?v[a]:p.textDx)||0,-((x?x[a]:p.textDy)||0));if(m){const{aOffset:r,aShape:s}=d,o=r.length!==s.length;let f,p,m,v;if(o?(f=set$4(Xr$2,r[3*a]/10,r[3*a+1]/10,r[3*a+2]/10),p=set$4(Yr$2,r[3*a+3]/10,r[3*a+4]/10,r[3*a+5]/10),m=set$4($r$2,r[3*a+6]/10,r[3*a+7]/10,r[3*a+8]/10),v=set$4(qr$2,r[3*a+9]/10,r[3*a+10]/10,r[3*a+11]/10)):(f=set(Xr$2,r[2*a]/10,r[2*a+1]/10),p=set(Yr$2,r[2*a+2]/10,r[2*a+3]/10),m=set($r$2,r[2*a+4]/10,r[2*a+5]/10),v=set(qr$2,r[2*a+6]/10,r[2*a+7]/10)),1===M){const n=lt$3(u.getResolution(),u);Fr$2(t,e,f,p,m,v,l,T,c,u,y,g,o,n)}else multiply(f,f,Kr$2),multiply(p,p,Kr$2),multiply(m,m,Kr$2),multiply(v,v,Kr$2),Cr$2(t,n,f,p,m,v,T,g)}else{const{aShape:i}=d;let r=set(Xr$2,i[2*a]/10,-i[2*a+1]/10),o=set(Yr$2,i[2*a+2]/10,-i[2*a+3]/10),f=set($r$2,i[2*a+4]/10,-i[2*a+5]/10),v=set(qr$2,i[2*a+6]/10,-i[2*a+7]/10);0===c.flipY&&1===M&&(multiply(r,r,Kr$2),multiply(o,o,Kr$2),multiply(f,f,Kr$2),multiply(v,v,Kr$2));const x=w?w[a]/9362:(p.textRotation||0)*Math.PI/180,b=m?0:u.getBearing()*Math.PI/180;if(x||b){const t=Er$2(Wr$2,x,b,P,M);r=transformMat2(r,r,t),o=transformMat2(o,o,t),f=transformMat2(f,f,t),v=transformMat2(v,v,t)}const A=s/24;scale(r,r,A),scale(o,o,A),scale(f,f,A),scale(v,v,A),1===M?Fr$2(t,e,r,o,f,v,l,T,c,u,y,g):Cr$2(t,n,r,o,f,v,T,g)}t[0]-=(o=o||0)+1,t[1]-=o+1,t[2]+=o+1,t[3]+=o+1;const k=this.getMap().getDevicePixelRatio();return 1!==k&&(t[0]*=k,t[1]*=k,t[2]*=k,t[3]*=k),t}function Qr$2(t,e,n){const r=e.geometry.desc.positionSize,{aAnchor:s,aAltitude:o,aTerrainAltitude:a}=e.geometry.properties,l=n*r;if(o?set$4(t,s[l],s[l+1],o[n]):3===r?Fa.unpackPosition(t,s[l],s[l+1],s[l+2]):set$4(t,s[l],s[l+1],0),a){const e=100*a[2*n];e&&(t[2]+=e)}return t}const ts$2={textFill:[0,0,0,1],textOpacity:1,textPitchAlignment:0,textRotationAlignment:0,textHaloRadius:0,textHaloFill:[1,1,1,1],textHaloBlur:0,textHaloOpacity:1,textPerspectiveRatio:0,textSize:14,textDx:0,textDy:0,textRotation:0};function es$2(t,e,i,r,s,o,a,l,h){const u=[];if(e.isDisposed()||0===e.data.aPosition.length)return u;const c=e.properties.glyphAtlas;if(!c)return u;if(0===r.textSize||0===r.textOpacity)return u;if(si$1(e,r,o),!e.properties.aCount){ns$2.call(this,e,a||h,l);const{aTextSize:t,aTextDx:n,aTextDy:i,aPitchAlign:r,aRotationAlign:s,aRotation:o,aOverlap:u,aAltitude:c}=e.data;if(t){const n=(ri$1+"aTextSize").trim();e.properties.aTextSize=e.properties[n]||new t.constructor(t)}if(n){const t=(ri$1+"aTextDx").trim();e.properties.aTextDx=e.properties[t]||new n.constructor(n)}if(i){const t=(ri$1+"aTextDy").trim();e.properties.aTextDy=e.properties[t]||new i.constructor(i)}if(r){const t=(ri$1+"aPitchAlign").trim();e.properties.aPitchAlign=e.properties[t]||new r.constructor(r)}if(s){const t=(ri$1+"aRotationAlign").trim();e.properties.aRotationAlign=e.properties[t]||new s.constructor(s)}if(o){const t=(ri$1+"aRotation").trim();e.properties.aRotation=e.properties[t]||new o.constructor(o)}if(u){const t=(ri$1+"aOverlap").trim();e.properties.aOverlap=e.properties[t]||new u.constructor(u)}if(c){const t=(ri$1+"aAltitude").trim();e.properties.aAltitude=e.properties[t]||new c.constructor(c)}}const f=Wi$1(t,c,!1),d={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:f,texSize:[c.width,c.height]};is$2(e,d,s);let p=!1;s.textOpacity<1&&(p=!0),e.properties.memorySize=e.getMemorySize(),e.generateBuffers(t,{excludeElementsInVAO:!0});const m=new Ce$5(d,ts$2),y=new Be$5(e,m,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});if(y.setLocalTransform(i),y.setUniform("alphaTest",.01),d.isHalo&&(y.properties.isHalo=!0),a&&y.setDefines({ENABLE_COLLISION:1}),u.push(y),d.isHalo){const t={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio,texture:f,texSize:[c.width,c.height],isHalo:0};is$2(e,t,s);const r=new Ce$5(t,ts$2),o=new Be$5(e,r,{disableVAO:!0,transparent:p,castShadow:!1,picking:!0});o.setUniform("alphaTest",.01),o.properties.haloMesh=y,Object.defineProperty(o.properties,"textSize",{enumerable:!0,get:function(){return t.textSize}}),a&&o.setDefines({ENABLE_COLLISION:1}),o.setLocalTransform(i),u.push(o)}return u.forEach((t=>{const n=t.defines||{};e.data.aTextFill&&(n.HAS_TEXT_FILL=1),e.data.aTextSize&&(n.HAS_TEXT_SIZE=1),e.data.aColorOpacity&&(n.HAS_OPACITY=1),e.data.aTextHaloFill&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_FILL=1),e.data.aTextHaloRadius&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_RADIUS=1),e.data.aTextHaloOpacity&&t.material.uniforms.isHalo&&(n.HAS_TEXT_HALO_OPACITY=1),e.data.aTextDx&&(n.HAS_TEXT_DX=1),e.data.aTextDy&&(n.HAS_TEXT_DY=1),e.data.aPitchAlign&&(n.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(n.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(n.HAS_ROTATION=1),e.data.aAltitude&&(n.HAS_ALTITUDE=1),e.properties.aOffset&&e.properties.aShape&&e.properties.aOffset.length!==e.properties.aShape.length&&(n.HAS_OFFSET_Z=1),t.setDefines(n),t.properties.symbolIndex=e.properties.symbolIndex})),u}function ns$2(t,e,n){const i=this.getSymbol(t.properties.symbolIndex),r="line"===t.properties.textPlacement&&!zt$2(i),{aPosition:s,aShape:o}=t.data,a=s.length/t.desc.positionSize;if(t.properties.aPickingId=t.data.aPickingId,t.properties.aCount=t.data.aCount,delete t.data.aCount,(e||r)&&(t.properties.aAnchor=s,t.properties.aShape=o),t.properties.visElemts||(t.properties.elements=t.elements,t.properties.visElemts=new t.elements.constructor(t.elements.length)),r){const{aVertical:e,aSegment:n,aGlyphOffset:i,aPitchRotation:r}=t.data,s=!!r;t.properties.aGlyphOffset=i,t.properties.aPitchRotation=r,t.properties.aSegment=n,t.properties.aVertical=e,delete t.data.aSegment,delete t.data.aVertical,delete t.data.aGlyphOffset,delete t.data.aPitchRotation;const a=o.length/2*(s?3:2);t.data.aOffset={usage:"dynamic",data:new Int16Array(a)},t.properties.aOffset=new Int16Array(a)}if(e){t.data.aOpacity={usage:"dynamic",data:new Uint8Array(a)},t.properties.aOpacity=new Uint8Array(a),n&&(t.properties.aOpacity.fill(255,0),t.data.aOpacity.data.fill(255,0));const{aTextHaloRadius:e}=t.data;if(e&&!t.properties.aTextHaloRadius){const n=(ri$1+"aTextHaloRadius").trim();t.properties.aTextHaloRadius=t.properties[n]||new e.constructor(e)}}}function is$2(t,e,n){void 0===e.isHalo&&(e.isHalo=1),Ct$3(e,"textOpacity",n,"textOpacity",ts$2.textOpacity),Ct$3(e,"textFill",n,"textFill",ts$2.textFill,Rt$3()),Ct$3(e,"textHaloFill",n,"textHaloFill",ts$2.textHaloFill,Rt$3()),Ct$3(e,"textHaloBlur",n,"textHaloBlur",ts$2.textHaloBlur),Ct$3(e,"textHaloRadius",n,"textHaloRadius",ts$2.textHaloRadius),Ct$3(e,"textHaloOpacity",n,"textHaloOpacity",ts$2.textHaloOpacity),Ct$3(e,"textPerspectiveRatio",n,"textPerspectiveRatio",ts$2.textPerspectiveRatio,(e=>"line"===t.properties.textPlacement?1:e)),Ct$3(e,"rotateWithMap",n,"textRotationAlignment",ts$2.textRotationAlignment,(t=>+("map"===t))),Ct$3(e,"pitchWithMap",n,"textPitchAlignment",ts$2.textPitchAlignment,(t=>+("map"===t))),Ct$3(e,"textSize",n,"textSize",ts$2.textSize),Ct$3(e,"textDx",n,"textDx",ts$2.textDx),Ct$3(e,"textDy",n,"textDy",ts$2.textDy),Ct$3(e,"textRotation",n,"textRotation",ts$2.textRotation,(t=>t*Math.PI/180))}function rs$2(t,e){const n=[];return{uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5(n,e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!1,mask:255,func:{cmp:"<",ref:(t,e)=>2*e.level+(e.isHalo||0)+1,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:e.depthRange||[0,1],func:e.depthFunc||"always",mask:!1},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}function ss$2(t,e){const n=interpolated(e.textFill),i=interpolated(e.textSize),r=interpolated(e.textHaloFill),s=interpolated(e.textHaloRadius),o=interpolated(e.textHaloOpacity),a=interpolated(e.textDx),l=interpolated(e.textDy),h=interpolated(e.textOpacity),u=piecewiseConstant(e.textPitchAlignment),c=piecewiseConstant(e.textRotationAlignment),f=interpolated(e.textRotation),d=piecewiseConstant(e.textAllowOverlapFn),m=piecewiseConstant(e.textIgnorePlacement),v={},x=new Int16Array(1),b=new Uint16Array(1);return[{attrName:"aTextFill",symbolName:"textFill",define:"HAS_TEXT_FILL",type:Uint8Array,width:4,evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=v[r]=v[r]||color(r).unitArray()),r=Dt$3(r),r}},{attrName:"aTextSize",symbolName:"textSize",define:"HAS_TEXT_SIZE",type:Uint8Array,width:1,evaluate:(e,n)=>{let r=i(t.getZoom(),e)||ts$2.textSize;return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e)),x[0]=r,x[0]}},{attrName:"aTextHaloFill",symbolName:"textHaloFill",define:"HAS_TEXT_HALO_FILL",type:Uint8Array,width:4,evaluate:e=>{let n=r(t.getZoom(),e);return Array.isArray(n)||(n=v[n]=v[n]||color(n).unitArray()),n=Dt$3(n),n}},{attrName:"aTextHaloRadius",symbolName:"textHaloRadius",define:"HAS_TEXT_HALO_RADIUS",type:Uint8Array,width:1,evaluate:e=>{const n=s(t.getZoom(),e);return x[0]=n,x[0]}},{attrName:"aTextHaloOpacity",symbolName:"textHaloOpacity",define:"HAS_TEXT_HALO_OPACITY",type:Uint8Array,width:1,evaluate:e=>{const n=o(t.getZoom(),e);return x[0]=n,x[0]}},{attrName:"aTextDx",symbolName:"textDx",define:"HAS_TEXT_DX",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=a(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),x[0]=i,x[0]}},{attrName:"aTextDy",symbolName:"textDy",define:"HAS_TEXT_DY",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=l(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),x[0]=i,x[0]}},{attrName:"aColorOpacity",symbolName:"textOpacity",define:"HAS_OPACITY",type:Uint8Array,width:1,evaluate:(e,n)=>{let i=h(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),x[0]=255*i,x[0]}},{attrName:"aPitchAlign",symbolName:"textPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===u(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"textRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===c(t.getZoom(),e))},{attrName:"aRotation",symbolName:"textRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=Ot$3(f(t.getZoom(),e),0,360)*Math.PI/180;return b[0]=9362*n,b[0]}},{attrName:"aOverlap",symbolName:"textAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=d(t.getZoom(),n)||0,r=(m?m(t.getZoom(),n):e.textIgnorePlacement)||0;return i=1<<3+4*i,r=(m?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"textIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(d?d(t.getZoom(),n):e.textAllowOverlap)||0,r=m(t.getZoom(),n)||0;return i=(d?8:0)+4*i,r=1<<1+r,i+r}}]}const os$2=[],as$2=[],ls$2=[],hs$2=[];function us$2(t,e,n,i,r,s,o){t=1===t?1:0;const a=this.getMap(),l=e.geometry.properties,h=this.getSymbol(l.symbolIndex),u="line"===l.textPlacement&&!zt$2(h),{aTextSize:c,aTextHaloRadius:f,aShape:d}=l;let p=c?c[n[r]]:e.properties.textSize;null==p&&(p=ts$2.textSize);const m=f?f[n[r]]:e.properties.textHaloRadius,y=Qr$2(ls$2,e,n[r]),{aProjectedAnchor:g}=e.geometry.properties;let v=hs$2;const x=3*n[r];g&&-999999!==g[x]?(hs$2[0]=g[x],hs$2[1]=g[x+1],hs$2[2]=g[x+2]):v=bi$1(hs$2,y,o,a.width,a.height);const b=i,{boxes:A,collision:w}=this.Ss(e,r);let _=0;if(u||1===e.material.uniforms.rotateWithMap||h.textRotation){let i=0;for(let s=r;s<r+6*b;s+=6){const r=A[_]=A[_]||[];_++;const l=Zr$2.call(this,r,y,v,e,p,m,n[s],o,a);if(!t){const e=this.isCollides(l);1===e?t=1:-1===e&&i++}}i===b&&(t=-1)}else{let i=n[r],l=d[2*i+1];for(let h=r;h<s;h+=6){const r=d[2*n[h]+1];if(l!==r||h===s-6){const u=n[h===s-6?h:h-6],c=Zr$2.call(this,os$2,y,v,e,p,m,i,o,a),f=Zr$2.call(this,as$2,y,v,e,p,m,u,o,a),d=A[_]=A[_]||[];_++,d[0]=Math.min(c[0],f[0]),d[1]=Math.min(c[1],f[1]),d[2]=Math.max(c[2],f[2]),d[3]=Math.max(c[3],f[3]),i=n[h],l=r,!t&&this.isCollides(d)&&(t=1)}}}return w.collides=t,w}function cs$2(t,e){const n=function(t,e){const{aPickingId:n,features:i}=t.geometry.properties,r=n[e];return(i&&i[r]&&i[r].feature).label}(t,e);return n?function(t,e,n){if(!n)return null;const i=t.localTransform,r=Qr$2(fs$2,t,e);set$3(ds$2,r[0],r[1],r[2],1);const s=transformMat4$1(ds$2,ds$2,i);let o=0;for(let t=0;t<n.length;t++)o+=n.charCodeAt(t);return[Math.floor(s[0]),Math.floor(s[1]),Math.floor(s[2]),o]}(t,e,n):null}const fs$2=[],ds$2=[];var ps$2="#define SHADER_NAME TEXT_VERT\n#define RAD 0.0174532925\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aShape;\nattribute vec2 aTexCoord;\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nattribute float aRotationAlign;\n#else\nuniform float rotateWithMap;\n#endif\nuniform float flipY;\n#if defined(HAS_ROTATION)\nattribute float aRotation;\n#else\nuniform float textRotation;\n#endif\nuniform float cameraToCenterDistance;\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float glyphSize;\nuniform float mapPitch;\nuniform float mapRotation;\nuniform float zoomScale;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_SIZE\nfloat d = aTextSize * layerScale;\n#else\nfloat d = textSize * layerScale;\n#endif\n#ifdef HAS_TEXT_DX\nfloat e = aTextDx;\n#else\nfloat e = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat f = aTextDy;\n#else\nfloat f = textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\n#if defined(HAS_ROTATION_ALIGN)\nfloat i = aRotationAlign;\n#else\nfloat i = rotateWithMap;\n#endif\nvec2 j = aShape / 10.0;\n  if(h == 1. && flipY == .0) {\n    j = j * vec2(1., -1.);\n  }\n  vec2 k = aTexCoord;\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  float l = gl_Position.w;\n  float m;\n  if(isRenderingTerrain == 1. && h == 1.) {\n    m = 1.;\n  } else {\n    float n = (1. - cameraToCenterDistance / l) * textPerspectiveRatio;\n    m = clamp(.5 + .5 * (1. - n), .0, 4.);\n  }\n#ifdef HAS_ROTATION\nfloat o = -aRotation / 9362. - mapRotation * i;\n#else\nfloat o = -textRotation - mapRotation * i;\n#endif\nif(h == 1.) {\n    \n#ifdef REVERSE_MAP_ROTATION_ON_PITCH\no += mapRotation;\n#else\no -= mapRotation;\n#endif\n  }\n  float u = sin(o);\n  float v = cos(o);\n  mat2 A = mat2(v, -1. * u, u, v);\n  j = A * (j / glyphSize * d);\n  float B;\n  if(isRenderingTerrain == 1.) {\n    B = 1.;\n  } else {\n    B = l / cameraToCenterDistance;\n  }\n  if(h == .0) {\n    vec2 C = j * 2. / canvasSize;\n    gl_Position.xy += C * m * l;\n  } else {\n    float D;\n    if(isRenderingTerrain == 1.) {\n      D = tileRatio / zoomScale;\n    } else {\n      D = tileRatio / zoomScale * B * m;\n    }\n    vec2 C = j;\n    gl_Position = projViewModelMatrix * positionMatrix * vec4(c + vec3(C, .0) * D, 1.);\n  }\n  gl_Position.xy += vec2(e, -f) * 2. / canvasSize * l;\n#ifndef PICKING_MODE\nif(h == .0) {\n    vGammaScale = mix(1., B, textPerspectiveRatio);\n  } else {\n    vGammaScale = B + mapPitch / 4.;\n  }\n  vTexCoord = k / texSize;\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vSize = d;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool E = aOpacity == 255.;\n#else\nbool E = true;\n#endif\nfbo_picking_setData(gl_Position.w, E);\n#endif\n}",ms$2="#define SHADER_NAME TEXT_FRAG\n#define HAS_HIGHLIGHT_COLOR_POINT 1\n#define SDF_PX 8.0\n#define DEVICE_PIXEL_RATIO 1.0\n#define EDGE_GAMMA 0.105 / DEVICE_PIXEL_RATIO\nprecision mediump float;\nuniform sampler2D texture;\nuniform float textOpacity;\nuniform highp float gammaScale;\nuniform int isHalo;\nuniform highp float textHaloBlur;\nuniform float alphaTest;\n#ifdef HAS_TEXT_HALO_OPACITY\nvarying float vTextHaloOpacity;\n#else\nuniform float textHaloOpacity;\n#endif\nuniform float layerOpacity;\nvarying vec2 vTexCoord;\nvarying float vSize;\nvarying float vGammaScale;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nvarying vec4 vTextFill;\n#else\nuniform vec4 textFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvarying vec4 vTextHaloFill;\n#else\nuniform vec4 textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvarying float vTextHaloRadius;\n#else\nuniform highp float textHaloRadius;\n#endif\n#include <highlight_frag>\nvoid main() {\n  \n#ifdef HAS_TEXT_FILL\nvec4 c = vTextFill;\n#else\nvec4 c = textFill;\n#endif\nfloat d = vSize / 24.;\n  lowp vec4 e = c;\n  highp float f = EDGE_GAMMA / (d * gammaScale);\n  lowp float h = 185. / 256.;\n  if(isHalo == 1) {\n    \n#ifdef HAS_TEXT_HALO_FILL\nvec4 i = vTextHaloFill;\n#else\nvec4 i = textHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nfloat j = vTextHaloRadius;\n#else\nfloat j = textHaloRadius;\n#endif\ne = i;\n    f = (textHaloBlur * 1.19 / SDF_PX + EDGE_GAMMA) / (d * gammaScale);\n    h = (6. - j / d) / SDF_PX;\n#ifdef HAS_TEXT_HALO_OPACITY\nfloat k = vTextHaloOpacity / 255.;\n#else\nfloat k = textHaloOpacity;\n#endif\ne *= k * 1.25;\n  }\n  float l = texture2D(texture, vTexCoord).a;\n  highp float m = f * vGammaScale * .7;\n  float n = clamp(smoothstep(h - m, h + m, l), .0, 1.);\n  gl_FragColor = e * (n * textOpacity * vOpacity * layerOpacity);\n  if(gl_FragColor.a < alphaTest) {\n    discard;\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor);\n}";const ys$2=new Uint16Array(1),gs$2=new Int8Array(1);function xs$1(t,e){const n=interpolated(e.markerWidth),i=interpolated(e.markerHeight),r=interpolated(e.markerDx),s=interpolated(e.markerDy),o=interpolated(e.markerOpacity),a=interpolated(e.markerTextFit),l=piecewiseConstant(e.markerPitchAlignment),h=piecewiseConstant(e.markerRotationAlignment),u=interpolated(e.markerRotation),c=piecewiseConstant(e.markerAllowOverlapFn),f=piecewiseConstant(e.markerIgnorePlacement),d=new Int16Array(1),m=new Uint16Array(1);return[{attrName:"aMarkerWidth",symbolName:"markerWidth",type:Uint16Array,width:1,define:"HAS_MARKER_WIDTH",evaluate:(i,r,s,o)=>{const l=s[o],h=e.markerTextFit,u=a?a(t.getZoom(),i):h;if("both"===u||"width"===u)return l;let c=n(t.getZoom(),i);return isFunctionDefinition(c)&&(c=this.evaluateInFnTypeConfig(c,r,t,i)),d[0]=c,d[0]}},{attrName:"aMarkerHeight",symbolName:"markerHeight",type:Uint16Array,width:1,define:"HAS_MARKER_HEIGHT",evaluate:(n,r,s,o)=>{const l=s[o],h=e.markerTextFit,u=a?a(t.getZoom(),n):h;if("both"===u||"height"===u)return l;let c=i(t.getZoom(),n);return isFunctionDefinition(c)&&(c=this.evaluateInFnTypeConfig(c,r,t,n)),d[0]=c,d[0]}},{attrName:"aMarkerDx",symbolName:"markerDx",type:Uint8Array,width:1,define:"HAS_MARKER_DX",evaluate:(e,n)=>{let i=r(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=i,d[0]}},{attrName:"aMarkerDy",symbolName:"markerDy",type:Uint8Array,width:1,define:"HAS_MARKER_DY",evaluate:(e,n)=>{let i=s(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=i,d[0]}},{attrName:"aColorOpacity",symbolName:"markerOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let i=o(t.getZoom(),e);return isFunctionDefinition(i)&&(i=this.evaluateInFnTypeConfig(i,n,t,e)),d[0]=255*i,d[0]}},{attrName:"aPitchAlign",symbolName:"markerPitchAlignment",type:Uint8Array,width:1,define:"HAS_PITCH_ALIGN",evaluate:e=>+("map"===l(t.getZoom(),e))},{attrName:"aRotationAlign",symbolName:"markerRotationAlignment",type:Uint8Array,width:1,define:"HAS_ROTATION_ALIGN",evaluate:e=>+("map"===h(t.getZoom(),e))},{attrName:"aRotation",symbolName:"markerRotation",type:Uint16Array,width:1,define:"HAS_ROTATION",evaluate:e=>{const n=Ot$3(u(t.getZoom(),e),0,360)*Math.PI/180;return m[0]=9362*n,m[0]}},{attrName:"aOverlap",symbolName:"markerAllowOverlap",type:Uint8Array,width:1,evaluate:n=>{let i=c(t.getZoom(),n)||0,r=(f?f(t.getZoom(),n):e.markerIgnorePlacement)||0;return i=1<<3+4*i,r=(f?2:0)+r,i+r}},{attrName:"aOverlap",symbolName:"markerIgnorePlacement",type:Uint8Array,width:1,evaluate:n=>{let i=(c?c(t.getZoom(),n):e.markerAllowOverlap)||0,r=f(t.getZoom(),n)||0;return i=(c?8:0)+4*i,r=2+r,i+r}}]}function bs$2(t,e,n,i){if(!n||!i||"none"===i)return;const r=function(t,e,n){let i=t.properties.textFitFn;isFunctionDefinition(n)&&(i=t.properties.textFitFn=piecewiseConstant(n));const r="none"!==n,s=[],o=t.getElements(),a=t.data.aPickingId;let l,h,u;e&&(l=e.getElements(),h=e.data.aPickingId,u=e.data.aCount);const c=t.properties.features;let f;if(e){let t=l[0];f={pickingId:h[t],start:0,end:6*u[t]}}let d=!1,m=!1,g=0;const v=new Set;for(let t=0;t<o.length;t+=6){const p=a[o[t]];if(!d&&f)for(;f.pickingId<p&&f.end<l.length;){const t=f.end,e=l[t];f.start=t,f.end=t+6*u[e],f.pickingId=h[e]}if(!d&&f&&f.pickingId<p&&(d=!0,!r)){if(!m)return[];for(let e=t;e<o.length;e+=6)s[g++]=[-1,-1];return s}const y=c[p]&&c[p].feature,x=y&&y.properties||{},b=i?i(null,x):n;if(f&&p===f.pickingId){s[g++]=[f.start,f.end];const t=f.end,e=l[t];f.start=t,f.end=t+6*u[e],f.pickingId=h[e],m=!0}else if(b&&"none"!==b)for(let e=t;e<t+6;e++)v.add(e);else s[g++]=[-1,-1]}if(v.size)if(v.size===o.length)t.setElements([]);else{const e=[];for(let t=0;t<o.length;t++)v.has(t)||e.push(o[t]);t.setElements(new o.constructor(e))}return m?s:[]}(e,n,i);if(e.getElements().length&&r.length&&(e.properties.labelIndex=r,r.length&&i&&"none"!==i&&n)){const i=function(t,e){const n=[],i=t.properties.labelIndex,{aShape:r}=e.data;let s=!1;for(let t=0;t<i.length;t++){const[o,a]=i[t];if(-1===o)n.push(0,0,0,0);else{s=!0;let t=1/0,i=1/0,l=-1/0,h=-1/0;const u=e.elements;for(let e=o;e<a;e++){const n=u[e],s=r[2*n],o=r[2*n+1];s<t&&(t=s),s>l&&(l=s),o<i&&(i=o),o>h&&(h=o)}n.push(t,i,l,h)}}return s?n:[]}(e,n);i.length&&(e.properties.labelShape=i,As$1.call(this,t,e,n))}}function As$1(t,e){const n=this.getSymbolDef(e.properties.symbolIndex),i=n.markerTextFit,r=e.properties;let s="both"===i||"width"===i,o="both"===i||"height"===i;if(isFunctionDefinition(n.markerTextFit)){let t=e.properties.textFitFn;t||(t=e.properties.textFitFn=interpolated(n.markerTextFit));const{features:i}=e.properties,a=e.properties.elements||e.elements,{aPickingId:l}=e.data,h=[],u=[];let c=!0;for(let e=0;e<a.length;e+=6){const n=i[l[a[e]]],r=(n&&n.feature||{}).properties||{};let s=t(null,r);isFunctionDefinition(s)&&(s=(r.textFitFn=r.textFitFn||interpolated(s))(null,r)),"both"===s?(h.push(e/6),u.push(e/6)):"width"===s?(c=!1,h.push(e/6)):"height"===s&&(c=!1,u.push(e/6))}c?(r.fitIcons=h,s=!0,o=!0):(h.length&&(r.fitWidthIcons=h,s=!0),u.length&&(r.fitHeightIcons=u,o=!0))}r.aPickingId||(r.aPickingId=new e.data.aPickingId.constructor(e.data.aPickingId));const{aMarkerWidth:a,aMarkerHeight:l,aPickingId:h}=r,u=h.length;if(s)if(a){const t=e.data.aMarkerWidth;e.data.aMarkerWidth=new Uint16Array(t),r.aMarkerWidth=new Uint16Array(t);const n=(ri$1+"aMarkerWidth").trim();r[n]&&(r[n]=r.aMarkerWidth)}else{const t=this.getSymbol(e.properties.symbolIndex).markerWidth||0;r.aMarkerWidth=new Uint16Array(u),r.aMarkerWidth.fill(t),t&&(r.aMarkerWidth.dirty=!0),e.data.aMarkerWidth=new Uint16Array(u)}if(o)if(l){const t=e.data.aMarkerHeight;e.data.aMarkerHeight=new Uint16Array(t),r.aMarkerHeight=new Uint16Array(t);const n=(ri$1+"aMarkerHeight").trim();r[n]&&(r[n]=r.aMarkerHeight)}else{const t=this.getSymbol(e.properties.symbolIndex).markerHeight||0;r.aMarkerHeight=new Uint16Array(u),r.aMarkerHeight.fill(t),t&&(r.aMarkerHeight.dirty=!0),e.data.aMarkerHeight=new Uint16Array(u)}const c=this.getSymbolDef(e.properties.textGeo.properties.symbolIndex),f=interpolated(c.textSize);_s$1.call(this,t,e),(!isFunctionDefinition(c.textSize)||f.isZoomConstant&&f.isFeatureConstant)&&(r.isFitConstant=!0)}const ws$2=[0,0,0,0];function _s$1(t,e){const n=e.properties.textGeo;if(!n)return;const i=n.properties,r=e.properties;if(r.isFitConstant||!r.labelShape||!r.labelShape.length)return;const s=this.getSymbolDef(e.properties.symbolIndex),o=this.getSymbolDef(n.properties.symbolIndex).textSize;let a;isFunctionDefinition(o)&&(a=i.ks?i.ks:i.ks=interpolated(o));const l=s.markerTextFitPadding||ws$2;let h;isFunctionDefinition(l)&&(h=r.Os?r.Os:r.Os=piecewiseConstant(l));const u=t.getZoom(),{fitIcons:c,fitWidthIcons:f,fitHeightIcons:d}=r,{aMarkerWidth:m,aMarkerHeight:v,labelShape:x}=r,b=r.elements||e.elements,{features:A,aPickingId:w}=r,_=(t,e,n,i)=>{const s=x[4*e],c=x[4*e+1],f=x[4*e+2],d=x[4*e+3];if(!(s||c||f||d))return;const b=w[t],_=A[b]&&A[b].feature,S=_&&_.properties||{};let M=a?a(u,S):o;isFunctionDefinition(M)&&(M=(S.textSizeFn=S.textSizeFn||interpolated(M))(u,S)),M/=24;let P,T,k=h&&h(u,S)||l;if(isFunctionDefinition(k)&&(k=(S.fitPaddingFn=S.fitPaddingFn||piecewiseConstant(k))(u,S)),k=k||ws$2,k[0]===k[2]&&k[1]===k[3]||(P=r.aPadOffsetX,T=r.aPadOffsetY,P||(P=r.aPadOffsetX=new Int8Array(m.length),T=r.aPadOffsetY=new Int8Array(m.length))),m&&n){const e=Math.abs((f-s)/10*M)+(k[1]+k[3]||0);if(ys$2[0]=e,m[t]!==ys$2[0]&&(Nt$3(m,ys$2[0],t,t+4),m.dirty=!0),P){const e=(k[1]+k[3])/2-k[3];gs$2[0]=e,P[t]!==gs$2[0]&&(Nt$3(P,e,t,t+4),P.dirty=!0)}}if(v&&i){const e=Math.abs((d-c)/10*M)+(k[0]+k[2]||0);if(ys$2[0]=e,v[t]!==ys$2[0]&&(Nt$3(v,ys$2[0],t,t+4),v.dirty=!0),T){const e=k[0]-(k[0]+k[2])/2;gs$2[0]=e,T[t]!==gs$2[0]&&(Nt$3(T,e,t,t+4),T.dirty=!0)}}};if(c||f||d){if(c)for(let t=0;t<c.length;t++){const e=c[t];_(b[6*e],e,!0,!0)}else if(f||d){if(f)for(let t=0;t<f.length;t++){const e=f[t];_(b[6*e],e,!0,!1)}if(d)for(let t=0;t<d.length;t++){const e=d[t];_(b[6*e],e,!1,!0)}}}else for(let t=0;t<b.length;t+=6){_(b[t],t/6,!0,!0)}const{aPadOffsetX:S,aPadOffsetY:M}=r;S&&(e.data.aPadOffsetX=S,e.data.aPadOffsetY=M)}const Ss$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&e.isForeground(t)&&!!t.geometry.properties.iconAtlas&&!t.geometry.properties.isEmpty},Ms$1=function(t){const e=this.layer.getRenderer();return!(this.Ts(t)||e.isForeground(t)||!t.geometry.properties.iconAtlas||t.geometry.properties.isEmpty)},Ps$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},Ts$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&!e.isForeground(t)&&!!t.geometry.properties.glyphAtlas},ks$1=[],Os$1={collides:-1},Is$1=[2048,2048],Fs$1=identity$2([]),Cs$1=[];class Es$1 extends br$2{static getBloomSymbol(){return["markerBloom","textBloom"]}constructor(t,e,n,i,r,s){super(t,e,n,i,r,s),this.propAllowOverlap="markerAllowOverlap",this.propIgnorePlacement="markerIgnorePlacement",this.Zi={},this.isLabelCollides=us$2.bind(this),this.Is=Ss$1.bind(this),this.Fs=Ms$1.bind(this),this.Cs=Ps$1.bind(this),this.Es=Ts$1.bind(this),this.Ds=[]}needToRefreshTerrainTileOnZooming(){for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].markerPitchAlignment;if("map"===e||isFunctionDefinition(e)||Mr$3.isExpression(e))return!0}return!1}isTerrainVector(){return this.layer.options.awareOfTerrain&&!this.needToRefreshTerrainTileOnZooming()}isTerrainSkin(){return super.isTerrainSkin()&&this.needToRefreshTerrainTileOnZooming()}setTextShaderDefines(t){this.Rs=t}createFnTypeConfig(t,e){return{icon:xs$1.call(this,t,e),text:ss$2.call(this,t,e)}}startFrame(...t){return this.Ds.length=0,super.startFrame(...t)}createGeometry(t,e){return t&&t.empty&&(t.data={aPosition:new Uint8Array(t.data.aPosition),aPickingId:t.data.aPickingId}),super.createGeometry(t,e)}postCreateGeometry(t,e){const{geometry:n,symbolIndex:i}=t,r=this.getSymbolDef(i),s=this.getFnTypeConfig(i);if(this.Ls(n))n.properties.iconAtlas?this.drawDebugAtlas(n.properties.iconAtlas):n.properties.isEmpty=!0,function(t,e,n){si$1(t,e,n),function(t){const{aMarkerWidth:e,aMarkerHeight:n,aMarkerDx:i,aMarkerDy:r,aPitchAlign:s,aRotationAlign:o,aRotation:a,aOverlap:l}=t.data;if(e){const n=(ri$1+"aMarkerWidth").trim();t.properties.aMarkerWidth=t.properties[n]||new e.constructor(e)}if(n){const e=(ri$1+"aMarkerHeight").trim();t.properties.aMarkerHeight=t.properties[e]||new n.constructor(n)}if(i){const e=(ri$1+"aMarkerDx").trim();t.properties.aMarkerDx=t.properties[e]||new i.constructor(i)}if(r){const e=(ri$1+"aMarkerDy").trim();t.properties.aMarkerDy=t.properties[e]||new r.constructor(r)}if(s){const e=(ri$1+"aPitchAlign").trim();t.properties.aPitchAlign=t.properties[e]||new s.constructor(s)}if(o){const e=(ri$1+"aRotationAlign").trim();t.properties.aRotationAlign=t.properties[e]||new o.constructor(o)}if(a){const e=(ri$1+"aRotation").trim();t.properties.aRotation=t.properties[e]||new a.constructor(a)}if(l){const e=(ri$1+"aOverlap").trim();t.properties.aOverlap=t.properties[e]||new l.constructor(l)}}(t)}(n,r,s.icon);else if(this.Ns(n)&&zt$2(r)){const t=e[e.length-1];if(t){const{geometry:e,symbolIndex:s}=t;if(e&&s.index===i.index){const t=this.getMap(),i=r.markerTextFit;e.properties.textGeo=n,bs$2.call(this,t,e,n,i)}}}}prepareCollideIndex(t){const{collideIds:e,elements:n,aCount:i}=t.properties;if(!e)return;const r=e,s={};if(!n)return void(t.properties.collideBoxIndex=s);let o=0,a=n[0],l=0,h=r[a],u=1;i&&(u=i[n[l]]);for(let t=0;t<=n.length;t+=6)a=n[t],r[a]===h&&t!==n.length||(s[h]=[l,t,(t-l)/(6*u),o++],h=r[a],l=t,i&&(u=i[n[l]]));t.properties.collideBoxIndex=s}createMesh(t,e,i,r){const s=this.isEnableCollision(),o=this.layer,{geometry:a,symbolIndex:l}=t;a.properties.symbolIndex=l;const h=this.getSymbolDef(l),u=this.getSymbol(l),c=this.getFnTypeConfig(l),f=[];if(this.Ls(a)){const t=function(t,e,i,r,s,o,a,l){if(e.isDisposed()||0===e.data.aPosition.length)return null;const h=e.properties.iconAtlas;if(!h&&!e.properties.isEmpty)return null;const u={flipY:0,tileResolution:e.properties.tileResolution,tileRatio:e.properties.tileRatio};
//!geometry.properties.aShape collision
if(!e.properties.aShape){const{aPosition:t,aShape:n}=e.data,i=e.data.aPosition.length/e.desc.positionSize,r=new Uint8Array(i);l&&r.fill(255,0),e.data.aOpacity={usage:"dynamic",data:r},e.properties.aOpacity=new Uint8Array(i),l&&e.properties.aOpacity.fill(255,0),e.properties.aAnchor=t,e.properties.aShape=n}e.properties.visElemts||(e.properties.elements=e.elements,e.properties.visElemts=new e.elements.constructor(e.elements.length));const[c,f]=$i$1(e);Ct$3(u,"markerOpacity",s,"markerOpacity",1),Ct$3(u,"markerPerspectiveRatio",s,"markerPerspectiveRatio",s.markerTextFit?0:1),Ct$3(u,"markerWidth",s,"markerWidth",c||15),Ct$3(u,"markerHeight",s,"markerHeight",f||15),Ct$3(u,"markerDx",s,"markerDx",0),Ct$3(u,"markerDy",s,"markerDy",0),Ct$3(u,"markerRotation",s,"markerRotation",0,(t=>t*Math.PI/180)),Ct$3(u,"pitchWithMap",s,"markerPitchAlignment",0,(t=>"map"===t?1:0)),Ct$3(u,"rotateWithMap",s,"markerRotationAlignment",0,(t=>"map"===t?1:0)),u.iconTex=h?Wi$1(t,h,!1):null,u.texSize=h?[h.width,h.height]:[0,0],e.generateBuffers(t,{excludeElementsInVAO:!0});const d=new Ce$5(u),p=new Be$5(e,d,{disableVAO:!0,transparent:!0,castShadow:!1,picking:!0}),m={};return a&&(m.ENABLE_COLLISION=1),e.data.aMarkerWidth&&(m.HAS_MARKER_WIDTH=1),e.data.aMarkerHeight&&(m.HAS_MARKER_HEIGHT=1),e.data.aColorOpacity&&(m.HAS_OPACITY=1),e.data.aMarkerDx&&(m.HAS_MARKER_DX=1),e.data.aMarkerDy&&(m.HAS_MARKER_DY=1),e.data.aPitchAlign&&(m.HAS_PITCH_ALIGN=1),e.data.aRotationAlign&&(m.HAS_ROTATION_ALIGN=1),e.data.aRotation&&(m.HAS_ROTATION=1),e.data.aPadOffsetX&&(m.HAS_PAD_OFFSET=1),e.data.aAltitude&&(m.HAS_ALTITUDE=1),p.setDefines(m),p.setUniform("alphaTest",.01),p.setLocalTransform(i),p.properties.symbolIndex=e.properties.symbolIndex,p}(this.regl,a,e,0,u,0,o.options.collision,!s,this.isEnableUniquePlacement());t&&(t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.glyphAtlas,f.push(t))}else if(this.Ns(a)){const t=es$2.call(this,this.regl,a,e,h,u,c.text,o.options.collision,!s,this.isEnableUniquePlacement());t.length&&(t.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),delete t.geometry.properties.iconAtlas})),f.push(...t))}return"line"===a.properties.markerPlacement&&this.Hs(a,r),"line"===a.properties.markerPlacement&&f.forEach((t=>t.properties.isLinePlacement=!0)),this.prepareCollideIndex(a),f}Hs(t,e){const{collideIds:n}=t.properties,i=new Uint16Array(n.length);if(this.Ls(t)){let r=0;for(let t=0;t<n.length;t+=4)i.fill(r++,t,t+4);t.properties.collideIds=i,t.properties.uniqueCollideIds=Ut$2(i),e.markerCollideMap={old:n,new:i}}else if(this.Ns(t)){const{collideIds:n,aCount:i}=t.properties;if(!i)return;if(e.markerCollideMap){const{markerCollideMap:r}=e;let s=r.new[r.new.length-1],o=0,a=n[0],l=e.markerCollideMap.old.indexOf(a),h=i[0];for(let t=0;t<n.length;){const r=n[t];a!==r&&(a=r,l=e.markerCollideMap.old.indexOf(a),o=0);const u=-1===l?++s:e.markerCollideMap.new[l+4*o],c=t+4*h;n.fill(u,t,c),t+=4*h,o++,c<n.length&&(h=i[c])}t.properties.uniqueCollideIds=Ut$2(n)}else{let e=0,r=i[0];for(let t=0;t<n.length;){const s=t+4*r;n.fill(e++,t,s),t+=4*r,s<n.length&&(r=i[s])}t.properties.uniqueCollideIds=Ut$2(n)}}}addMesh(t){if(this.isEnableCollision()&&t.length>0){const e=new cr$2(t);e.properties.uniqueCollideIds=t[0].geometry.properties.uniqueCollideIds,e.properties.meshKey=t[0].properties.meshKey,e.properties.level=t[0].properties.level,this.Ds.push(e)}for(let e=0;e<t.length;e++){if(!this.isMeshIterable(t[e]))continue;const n=t[e].geometry,{symbolIndex:i}=n.properties;zt$2(this.getSymbolDef(i))&&_s$1.call(this,this.getMap(),n)}const e=this.getMap().getZoom();for(let n=0;n<t.length;n++){if(!this.isMeshIterable(t[n]))continue;const i=t[n].geometry,{symbolIndex:r}=i.properties,s=this.getSymbolDef(r),o=this.getFnTypeConfig(r);hi$1(this.regl,s,0===r.type?o.icon:o.text,t[n],e);const{aMarkerWidth:a,aMarkerHeight:l,aPadOffsetX:h,aPadOffsetY:u}=i.properties;a&&a.dirty&&(i.updateData("aMarkerWidth",a),a.dirty=!1),l&&l.dirty&&(i.updateData("aMarkerHeight",l),l.dirty=!1),h&&h.dirty&&(i.updateData("aPadOffsetX",h),h.dirty=!1),u&&u.dirty&&(i.updateData("aPadOffsetY",u),u.dirty=!1)}super.addMesh(...arguments)}updateCollision(t){if(!this.isEnableCollision())return;super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.zs(t.timestamp),this.Ds=[],this.zr()):this.zr()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Is,e.sceneFilter]:this.Is,this.callRenderer(this.shader,t,e),this.Vs.filter=e.sceneFilter?[this.Cs,e.sceneFilter]:this.Cs,this.callRenderer(this.Vs,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.Fs,e.sceneFilter]:this.Fs,this.callRenderer(this.shader,t,e),this.Vs.filter=e.sceneFilter?[this.Es,e.sceneFilter]:this.Es,this.callRenderer(this.Vs,t,e)}isMeshIterable(t){return t&&t.geometry&&!t.geometry.properties.isEmpty&&t.material&&!t.material.get("isHalo")&&this.isMeshVisible(t)&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}zs(){if(!this.isEnableCollision())return;let t=this.Ds;t&&t.length&&this.Us(t)}js(t,e,n,i){return this.updateBoxCollisionFading(!0,t,e,n,i)}isEnableUniquePlacement(){return this.isEnableCollision()&&!0===this.sceneConfig.uniquePlacement}Us(t){const e=this.layer.getRenderer();t=t.sort(Ds$1);for(let n=0;n<t.length;n++){const i=t[n];if(!i||!i.meshes.length)continue;let r=!1;if(1===i.meshes.length)r=this.isMeshIterable(i.meshes[0]);else for(let t=0;t<i.meshes.length;t++)if(this.isMeshIterable(i.meshes[t])){r=!0;break}if(!r)continue;const s=e.isForeground(i.meshes[0]);if(this.shouldIgnoreBackground()&&!s)continue;const o=i.properties.meshKey;this.startMeshCollision(i),this.Bs(i),this.forEachBox(i,this.js),this.Gs(i),this.endMeshCollision(o);for(let t=0;t<i.meshes.length;t++)this.Ws(i.meshes[t])}}Ws(t){const e=t&&t.geometry&&t.geometry.properties.aOpacity;e&&e.dirty&&(t.geometry.updateData("aOpacity",e),e.dirty=!1)}forEachBox(t,e){const n=t.properties.uniqueCollideIds;if(!n)return;const i={boxIndex:0},r=n.length;for(let s=0;s<r;s++)this.Xs(t,n[s],e,i)}Xs(t,e,n,i){const s=this.getMap(),{collideBoxIndex:o}=t.meshes[0].geometry.properties;if(!o||!o[e])return!1;const a=multiply$5(ks$1,s.projViewMatrix,t.meshes[0].localTransform);let l,h=!1;const u=t.meshes;let c=0;for(let t=0;t<u.length;t++){if(!this.isMeshIterable(u[t]))continue;const{collideBoxIndex:n}=u[t].geometry.properties;n[e]&&c++}if(!c)return!1;l=this.Ms(c);let f=0;for(let t=0;t<u.length;t++){if(!this.isMeshIterable(u[t]))continue;h=!0;const i=u[t].geometry.properties,{elements:r,aCount:s,collideBoxIndex:o}=i,a=o[e];if(!a)continue;const[c,d,p]=a;let m=1;s&&(m=s[r[c]]);const y=c+0*m*6;l[f].mesh=u[t],l[f].start=y,l[f].end=d,l[f].boxCount=i.glyphAtlas?m:p,l[f].allElements=r,f++}return!!h&&(n.call(this,t,l,a,i.boxIndex++)&&this.Ys(t,e),!0)}Bs(t){const e=t.meshes;for(let t=0;t<e.length;t++){const n=e[t],i=n&&n.geometry;i&&(i.properties.visElemts.count=0)}}Ys(t,e){const n=t.meshes;for(let t=0;t<n.length;t++){const i=n[t];if(i.properties.isHalo)continue;const r=i&&i.geometry;if(!r||r.properties.isEmpty)continue;const{collideBoxIndex:s,elements:o,visElemts:a}=r.properties,l=s[e];if(!l)continue;const[h,u]=l;let c=a.count;for(let t=h;t<u;t++)a[c++]=o[t];a.count=c}}Gs(t){const e=t.meshes;for(let t=0;t<e.length;t++){const n=e[t],i=n&&n.geometry;if(!i)continue;const{visElemts:r}=i.properties;i.setElements(r,r.count)}}isBoxCollides(t,e,n,i,r,s){if(this.Ns(t.geometry))return us$2.call(this,0,t,e,n,i,r,s);if(t.geometry.properties.isEmpty)return Os$1;const{aTerrainAltitude:o}=t.geometry.properties;if(o&&o[2*e[i]]===xt$3)return Os$1;const a=this.getMap(),{boxes:l,collision:h}=this.Ss(t,i);let u=0,c=0,f=0;for(let n=i;n<r;n+=6){const i=l[f]=l[f]||[];f++;const r=Gr$2.call(this,i,t,e[n],s,a);if(!u){const t=this.isCollides(r);1===t?u=1:-1===t&&c++}}return c===n&&(u=-1),h.collides=u,h}deleteMesh(t,e){t&&(t instanceof cr$2&&(t=t.meshes),e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.iconTex})):t.material&&delete t.material.uniforms.iconTex),super.deleteMesh(t,e))}isBloom(t){const e=t&&t.material&&!It$3(t.material.get("markerOpacity")),n=this.getSymbol(t.properties.symbolIndex);return!!(e?n.markerBloom:n.textBloom)}init(){const e=this.canvas;this.renderer=new B$6(this.regl);const i={viewport:{x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,n)=>n.viewport?n.viewport.width:e?e.width:1,height:(t,n)=>n.viewport?n.viewport.height:e?e.height:1},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},depth:{enable:!0,range:()=>this.sceneConfig.depthRange||[0,1],func:()=>this.sceneConfig.depthFunc||"always",mask:!!It$3(this.sceneConfig.depthMask)||this.sceneConfig.depthMask},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}};this.shader=new vn$4({vert:Sr$2,frag:"#define SHADER_NAME MARKER\n#define HAS_HIGHLIGHT_COLOR_POINT 1\nprecision mediump float;\n#include <gl2_frag>\nuniform float alphaTest;\nuniform sampler2D iconTex;\nuniform lowp float markerOpacity;\nuniform lowp float blendSrcIsOne;\nuniform float layerOpacity;\n#include <highlight_frag>\nvarying vec2 vTexCoord;\nvarying float vOpacity;\nvoid main() {\n  vec4 c = texture2D(iconTex, vTexCoord) * markerOpacity * vOpacity * layerOpacity;\n  if(c.a < .05) {\n    discard;\n  }\n  glFragColor = c;\n  glFragColor = highlight_blendColor(glFragColor);\n  if(glFragColor.a < alphaTest) {\n    discard;\n  }\n  glFragColor = highlight_blendColor(glFragColor);\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:i}),this.shader.version=300;const{uniforms:s,extraCommandProps:o}=rs$2.call(this,e,this.sceneConfig);if(this.Vs=new vn$4({vert:ps$2,frag:ms$2,uniforms:s,extraCommandProps:o,defines:this.Rs||{}}),this.pickingFBO){const t=new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+Sr$2,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}},{name:"zoomScale",type:"function",fn:function(t,e){return e.tileResolution/e.resolution}}],extraCommandProps:i},this.pickingFBO,this.getMap());t.filter=t=>!!t.geometry.properties.iconAtlas;const e=new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+ps$2,uniforms:s,extraCommandProps:o},this.pickingFBO,this.getMap());e.filter=t=>!!t.geometry.properties.glyphAtlas,this.picking=[t,e]}}getUniformValues(e,n){const i=n&&n.isRenderingTerrainSkin,r=this.layer.getTileSize().width,s=i?Fs$1:e.projViewMatrix,o=e.cameraToCenterDistance,a=set(Cs$1,e.width,e.height);i&&set(a,r,r);const l=this.getBlendFunc(),u=t__namespace.Util.isFunction(l.src)?l.src():l.src;return{layerScale:this.layer.options.styleScale||1,mapPitch:e.getPitch()*Math.PI/180,mapRotation:e.getBearing()*Math.PI/180,projViewMatrix:s,cameraToCenterDistance:o,canvasSize:a,iconSize:Is$1,resolution:e.getResolution(),glyphSize:24,gammaScale:1,blendSrcIsOne:+!("one"!==u&&1!==u),viewport:i&&n&&n.viewport,isRenderingTerrain:+!!i}}getUniqueEntryKey(t,e){if(!this.Ns(t.geometry))return null;const{elements:n}=t.geometry.properties;return cs$2(t,n[e])}Ls(t){const{symbolIndex:e}=t.properties;return 0===e.type}Ns(t){const{symbolIndex:e}=t.properties;return 1===e.type}}function Ds$1(t,e){return t.properties.level-e.properties.level||t.properties.meshKey-e.properties.meshKey}const Rs$1=[],Ls$1=[],Ns$1=[];function Hs$1(t,e,n,r,s,o,a,l,u,c,f,d,p){const{aGlyphOffset:m,aSegment:y,aTextDx:g,aTextDy:v,symbolIndex:x}=e.geometry.properties,b=this.getSymbol(x),_=set(Ns$1,(g?g[s]:b.textDx)||0,(v?v[s]:b.textDy)||0),S=set(Rs$1,m[2*s],m[2*s+1]),M=set$4(Ls$1,y[3*s],y[3*s+1],y[3*s+2]);return function(t,e,n,i,r,s,o,a,l,h,u,c,f,d,p,m,y,g){p||(p=i);const v=e.geometry.properties.line,x=s[0]*c,b=f?x-o:x+o;let A=b>0?1:-1,w=0;f&&(A*=-1,w=Math.PI),A<0&&(w+=Math.PI);const _=h+u,S=Math.abs(b);let M=A>0?l:l+1,P=gi$1.convert(i),T=gi$1.convert(i),k=gi$1.convert(r),O=gi$1.convert(r),I=0,F=0;for(;I+F<=S;){if(M+=A,M<h||M>=_)return null;T.x=P.x,T.y=P.y,O.x=k.x,O.y=k.y,P.x=n[3*M],P.y=n[3*M+1],k.x=v[3*M],k.y=v[3*M+1],I+=F,F=T.dist(P)/d}const C=(S-I)/F,E=m&&m.getRenderer(),D=E&&E.getTerrainHelper(),R=e.properties.tile.terrainTileInfos;if(!g&&D){const{extent:n}=e.properties.tile,i=m.getTileSize().width/n,r=m.getMap();let s=k.sub(O).mult(C).wi(O);P=Ti$1(Ai$1,r,e,k,i,m,y,R),T=Ti$1(wi$1,r,e,O,i,m,y,R),s=Ti$1(_i$1,r,e,s,i,m,y,R);const o=w+Math.atan2(P[1]-T[1],P[0]-T[0]);return t[0]=(s[0]-p[0])/d,t[1]=(s[1]-p[1])/d,t[2]=o,t}const L=P.sub(T),N=L.mult(C).wi(T);N.wi(L.Fi().Ci().Pi(a*A));const H=w+Math.atan2(P.y-T.y,P.x-T.x);return t[0]=(N.x-i[0])/d,t[1]=(N.y-i[1])/d,t[2]=H,t}(t,e,r,o,a,S,_[0],_[1],M[0],M[1],M[2],n/24,u,l,c,f,d,p)}const zs$1=[],Vs$1=[];function Us$1(t,e,n,r,s,o,a,l,u,c,f,d){const{aVertical:p}=n.geometry.properties,m=p[o];let y,g,v=Hs$1.call(this,zs$1,n,r,s,o,l,u,c,!1);if(!v)return null;if(copy$4(t,v),v=Hs$1.call(this,Vs$1,n,r,s,a,l,u,c,!1),!v)return null;if(copy$4(e,v),d&&(transformMat2(zs$1,zs$1,d),transformMat2(Vs$1,Vs$1,d)),m){const t=Math.abs(Vs$1[1]-zs$1[1]),e=Math.abs(Vs$1[0]-zs$1[0])*f;g=zs$1[0]>Vs$1[0]?1:0,t>e?(y=1,g=zs$1[1]<Vs$1[1]?0:1):y=0}else y=0,g=zs$1[0]>Vs$1[0]?1:0;return 2*g+y}var js$1="#define SHADER_NAME TEXT_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec2 aTexCoord;\n#ifdef HAS_OFFSET_Z\nattribute vec3 aOffset;\nuniform float altitudeScale;\n#else\nattribute vec2 aOffset;\n#endif\n#ifdef ENABLE_COLLISION\nattribute float aOpacity;\n#endif\n#ifdef HAS_OPACITY\nattribute float aColorOpacity;\n#endif\n#ifdef HAS_TEXT_SIZE\nattribute float aTextSize;\n#else\nuniform float textSize;\n#endif\n#ifdef HAS_TEXT_DX\nattribute float aTextDx;\n#else\nuniform float textDx;\n#endif\n#ifdef HAS_TEXT_DY\nattribute float aTextDy;\n#else\nuniform float textDy;\n#endif\n#if defined(HAS_PITCH_ALIGN)\nattribute float aPitchAlign;\n#else\nuniform float pitchWithMap;\n#endif\nuniform float zoomScale;\nuniform float cameraToCenterDistance;\nuniform mat4 projViewModelMatrix;\nuniform float textPerspectiveRatio;\nuniform float mapPitch;\nuniform vec2 texSize;\nuniform vec2 canvasSize;\nuniform float tileRatio;\nuniform float layerScale;\nuniform float isRenderingTerrain;\nuniform float textPitchFilter;\n#ifndef PICKING_MODE\nvarying vec2 vTexCoord;\nvarying float vGammaScale;\nvarying float vSize;\nvarying float vOpacity;\n#ifdef HAS_TEXT_FILL\nattribute vec4 aTextFill;\nvarying vec4 vTextFill;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nattribute vec4 aTextHaloFill;\nvarying vec4 vTextHaloFill;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nattribute float aTextHaloRadius;\nvarying float vTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nattribute float aTextHaloOpacity;\nvarying float vTextHaloOpacity;\n#endif\n#include <highlight_vert>\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n#ifdef HAS_TEXT_DX\nfloat d = aTextDx;\n#else\nfloat d = textDx;\n#endif\n#ifdef HAS_TEXT_DY\nfloat e = aTextDy;\n#else\nfloat e = textDy;\n#endif\n#ifdef HAS_TEXT_SIZE\nfloat f = aTextSize * layerScale;\n#else\nfloat f = textSize * layerScale;\n#endif\n#ifdef HAS_PITCH_ALIGN\nfloat h = aPitchAlign;\n#else\nfloat h = pitchWithMap;\n#endif\ngl_Position = projViewModelMatrix * vec4(c, 1.);\n  float i = gl_Position.w;\n  float j = i / cameraToCenterDistance;\n  float k;\n  if(isRenderingTerrain == 1.) {\n    k = 1.;\n  } else {\n    float l = (1. - cameraToCenterDistance / i) * textPerspectiveRatio;\n    k = clamp(.5 + .5 * (1. - l), .0, 4.);\n  }\n#ifdef HAS_OFFSET_Z\nvec3 m = aOffset / 10.0;\n  m[2] /= altitudeScale;\n#else\nvec3 m = vec3(aOffset / 10.0, .0);\n#endif\nvec2 n = aTexCoord;\n  if(h == 1.) {\n    float o;\n    if(isRenderingTerrain == 1.) {\n      o = tileRatio;\n    } else {\n      o = tileRatio / zoomScale * j * k;\n    }\n    m.xy *= o;\n    gl_Position = projViewModelMatrix * vec4(c + m, 1.);\n  } else {\n    gl_Position.xy += m.xy * 2. / canvasSize * k * i;\n  }\n  gl_Position.xy += vec2(d, -e) * 2. / canvasSize * i;\n  if(textPitchFilter > .0) {\n    if(textPitchFilter == 1. && h == .0 || textPitchFilter == 2. && h == 1.) {\n      gl_Position = vec4(-9999., -9999., .0, 1.);\n    }\n  }\n#ifndef PICKING_MODE\nif(h == 1.) {\n    vGammaScale = j + mapPitch / 4.;\n  } else {\n    vGammaScale = mix(1., j, textPerspectiveRatio);\n  }\n  vGammaScale = clamp(vGammaScale, .0, 1.);\n  vTexCoord = n / texSize;\n  vSize = f;\n#ifdef ENABLE_COLLISION\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity *= aColorOpacity / 255.;\n#endif\n#ifdef HAS_TEXT_FILL\nvTextFill = aTextFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_FILL\nvTextHaloFill = aTextHaloFill / 255.;\n#endif\n#ifdef HAS_TEXT_HALO_RADIUS\nvTextHaloRadius = aTextHaloRadius;\n#endif\n#ifdef HAS_TEXT_HALO_OPACITY\nvTextHaloOpacity = aTextHaloOpacity;\n#endif\nhighlight_setVarying();\n#else\n#ifdef ENABLE_COLLISION\nbool u = aOpacity == 255.;\n#else\nbool u = true;\n#endif\nfbo_picking_setData(gl_Position.w, u);\n#endif\n}";const Bs$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&e.isTileNearCamera(t)&&"line"!==t.geometry.properties.textPlacement},Gs$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&!e.isForeground(t)&&"line"!==t.geometry.properties.textPlacement},Ws$1=function(t){const e=this.layer.getRenderer();return!this.Ts(t)&&e.isTileNearCamera(t)&&"line"===t.geometry.properties.textPlacement},Xs$1=function(t){const e=this.layer.getRenderer(),n=t.properties.tile.z,i=e.getCurrentTileZoom();return!this.Ts(t)&&!e.isForeground(t)&&"line"===t.geometry.properties.textPlacement&&n<i},Ys$1=[0,0,3],$s$1=[],qs$1=[],Js$1=[],Ks$1=[],Zs$1=[],Qs$1=[],to$1=[],eo$1=[],no$1=[1,-1],io$1=new Int16Array(3),ro$1=[],so$1=[],oo$1=[],ao$1=[],lo$1=[],ho$1=[],uo$1=[],co$1={},fo$1={},po$1={},mo$1=[],yo$1=[],go$1=identity$2([]),vo$1=[];class xo$1 extends br$2{static getBloomSymbol(){return["textBloom"]}constructor(t,e,n,i,r,s){super(t,e,n,i,r,s),this.propAllowOverlap="textAllowOverlap",this.propIgnorePlacement="textIgnorePlacement",this.colorCache={},this.$s=Bs$1.bind(this),this.qs=Gs$1.bind(this),this.Js=Ws$1.bind(this),this.Ks=Xs$1.bind(this),this.isLabelCollides=us$2.bind(this),this.Zs()}prepareRender(...t){super.prepareRender(...t);const e=this.scene.getMeshes();if(e&&e.length)for(let t=0;t<e.length;t++){if(e[t].properties.isHalo)continue;const{haloMesh:n}=e[t].properties;n.dirtyDefines&&e[t].setDefines(n.defines)}}updateSymbol(...t){this.Qs=void 0,this.to=void 0;const e=super.updateSymbol(...t);return this.Zs(),e}isTerrainVector(){if(!super.isTerrainSkin())return!1;if(void 0!==this.Qs)return this.Qs;for(let t=0;t<this.symbolDef.length;t++)if("map"!==this.symbolDef[t].textPitchAlignment)return this.Qs=!0,!0;return this.Qs=!1,!1}isTerrainSkin(){if(!super.isTerrainSkin())return!1;if(void 0!==this.to)return this.to;for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t].textPitchAlignment;if("map"===e||isFunctionDefinition(e)||Mr$3.isExpression(e))return this.to=!0,!0}return this.to=!1,!1}Zs(){this.eo=[];for(let t=0;t<this.symbolDef.length;t++){const e=this.symbolDef[t];if(Mr$3.isExpression(e.textName)){const n=Mr$3.createExpression(e.textName,"string");this.eo[t]=(t,e)=>{let i;co$1.zoom=t,fo$1.properties=e;try{i=n.evaluateWithoutErrorHandling(co$1,fo$1,po$1,null,mo$1)}catch(t){i=null}return i}}else isFunctionDefinition(e.textName)&&(this.eo[t]=interpolated(e.textName))}}shouldDeleteMeshOnUpdateSymbol(t){if(!Array.isArray(t))return(0===t.textHaloRadius||0===this.symbolDef[0].textHaloRadius)&&t.textHaloRadius!==this.symbolDef[0].textHaloRadius;for(let e=0;e<t.length;e++)if(t[e]&&(0===t[e].textHaloRadius||0===this.symbolDef[e].textHaloRadius)&&t[e].textHaloRadius!==this.symbolDef[e].textHaloRadius)return!0;return!1}createFnTypeConfig(t,e){return ss$2(t,e)}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex)[xo$1.getBloomSymbol()[0]]}createGeometry(t,e,n){const i=t;if(!i.glyphAtlas)return null;const r=super.createGeometry(i,e);if(!r||!r.geometry)return null;const{geometry:s}=r;return s.properties.glyphAtlas&&this.drawDebugAtlas(s.properties.glyphAtlas),s&&i.lineVertex&&(s.properties.line=i.lineVertex,s.properties.line.id=n),r}createMesh(t,e,{tileVectorTransform:n}){const i=this.isEnableCollision(),r=this.isEnableUniquePlacement(),{geometry:s,symbolIndex:o}=t;s.properties.symbolIndex=o;const a=this.getSymbol(o),l=this.getSymbolDef(o),h=this.getFnTypeConfig(o),u=es$2.call(this,this.regl,s,e,l,a,h,this.layer.options.collision,!i,r);return u.length&&("line"===s.properties.textPlacement?this.no=!0:this.io=!0),u.forEach((t=>{t.positionMatrix=this.getAltitudeOffsetMatrix(),t.properties.tileVectorTransform=n})),u}updateCollision(t){super.updateCollision(t);const e=this.scene.getMeshes();e&&e.length?(this.ro={},this.so(t.timestamp),this.zr()):this.zr()}callCurrentTileShader(t,e){this.shader.filter=e.sceneFilter?[this.$s,e.sceneFilter]:this.$s,this.callRenderer(this.shader,t,e),this.oo.filter=e.sceneFilter?[this.Js,e.sceneFilter]:this.Js,this.callRenderer(this.oo,t,e)}callBackgroundTileShader(t,e){this.shader.filter=e.sceneFilter?[this.qs,e.sceneFilter]:this.qs,this.callRenderer(this.shader,t,e),this.oo.filter=e.sceneFilter?[this.Ks,e.sceneFilter]:this.Ks,this.callRenderer(this.oo,t,e)}callRenderer(t,e,n){n&&n.isRenderingTerrain&&isFunctionDefinition(this.symbolDef.textPitchAlignment)&&(e.textPitchFilter=n.isRenderingTerrainSkin?1:2),super.callRenderer(t,e,n)}so(){let t=this.scene.getMeshes();if(!t||!t.length)return;const e=-this.getMap().getBearing()*Math.PI/180,n=fromRotation$4(Js$1,e),i=(t,e,n,i)=>{const{start:r,end:s,mesh:o,allElements:a}=e[0];if(this.updateBoxCollisionFading(!0,o,e,n,i)){let e=t.count;for(let n=r;n<s;n++)t[e++]=a[n];t.count=e}},r=this.isEnableCollision(),s=this.layer.getRenderer();t=t.sort(Ao$1);for(let e=0;e<t.length;e++){const o=t[e];if(!this.isMeshIterable(o))continue;if(!s.isTileNearCamera(o)){const{visElemts:t}=o.geometry.properties;t&&(t.count=0),o.geometry.setElements(t,0);continue}const a=o.geometry,l=this.getSymbol(o.properties.symbolIndex);o.properties.textHaloRadius=It$3(l.textHaloRadius)?ts$2.textHaloRadius:l.textHaloRadius;const h=o.properties.meshKey;if("line"===a.properties.textPlacement){if(!a.properties.line)continue;r&&this.startMeshCollision(o),this.ao(o,n);const{aOffset:t,aOpacity:e}=a.properties;t.dirty&&(a.updateData("aOffset",t),t.dirty=!1),e&&e.dirty&&(a.updateData("aOpacity",e),e.dirty=!1),r&&this.endMeshCollision(h)}else if(r){this.startMeshCollision(o);const{elements:t,aOpacity:e,visElemts:n}=a.properties;n.count=0,this.forEachBox(o,((t,e,r,s,o)=>{i(n,e,r,s)})),e&&e.dirty&&a.updateData("aOpacity",e);const s=!n.count&&!a.count;n.count===t.length&&a.count===t.length||s||a.setElements(n,n.count),this.endMeshCollision(h)}}}isMeshIterable(t){return t.isValid()&&t.material&&!t.material.get("isHalo")&&!(this.shouldIgnoreBackground()&&!this.layer.getRenderer().isForeground(t))}isMeshUniquePlaced(t){return!!this.isMeshIterable(t)&&"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement}getUniqueEntryKey(t,e){return cs$2(t,e)}ao(t,e){const n=this.getMap(),i=t.geometry,s=i.properties;let o=s.line;if(!o)return;const a=n.getPitch(),l=n.getBearing(),{lineTextPitch:h,lineTextBearing:u}=t.properties,c=1===t.material.uniforms.pitchWithMap,f=s.elements;if(!c){const e=multiply$5($s$1,n.projViewMatrix,t.localTransform),i=o.id+"-"+e.join();let a;this.ro[i]?o=this.ro[i]:(a=s.projectedLine=s.projectedLine||new Array(o.length),o=this.lo(a,o,e,n.width,n.height),this.ro[i]=a)}const d=this.isEnableCollision(),p=i.properties.visElemts=i.properties.visElemts||new f.constructor(f.length),m=i.properties.visCache=i.properties.visCache||[];d&&(p.count=0);const y=void 0===h||Math.abs(a-h)>2||Math.abs(l-u)>2;this.forEachBox(t,((t,n,i,r)=>{const{start:s,end:a}=n[0];let l=m[r];if((void 0===l||y)&&(l=this.ho(t,f,s,a,o,i,c?e:null,r)),m[r]=l,d&&(l=this.updateBoxCollisionFading(l,t,n,i,r),l)){let t=p.count;for(let e=s;e<a;e++)p[t++]=f[e];p.count=t}})),y&&(t.properties.lineTextPitch=a,t.properties.lineTextBearing=l);const g=t.geometry.properties.aAltitude;g&&g.dirty&&(i.updateData("aAltitude",g),g.dirty=!1),!d||p.count===f.length&&i.count===p.count||i.setElements(p,p.count)}lo(t,e,n,i,r){return function(t,e,n,i,r){for(let s=0;s<e.length;s+=3)set$3(xi$1,e[s],e[s+1],e[s+2],1),bi$1(xi$1,xi$1,n,i,r),t[s]=xi$1[0],t[s+1]=xi$1[1],t[s+2]=e[s+2];return t}(t,e,n,i,r)}forEachBox(t,e){const n=this.getMap(),i=multiply$5($s$1,n.projViewMatrix,t.properties.tileVectorTransform),{collideIds:s,aCount:o,features:a,elements:l}=t.geometry.properties,h=s;if(!h)return;const u=this.isEnableUniquePlacement(),c=this.Ms(1);c[0].allElements=l,c[0].mesh=t;let f=0,d=l[0],p=0,m=h[d];for(let n=0;n<=l.length;n+=6)if(d=l[n],h[d]!==m||n===l.length){const r=a[m]&&a[m].feature;if(u&&this.isMeshUniquePlaced(t)&&r&&!r.label){const e=r.properties||{},{symbolIndex:n}=t.properties,i=n&&this.eo[n.index]?this.eo[n.index](t.properties.z,e):this.getSymbol(t.properties.symbolIndex).textName,s=Jr$3.resolveText(i,e);r.label=s}const s=n,y=o[l[p]];for(let n=p;n<s;n+=6*y)c[0].start=n,c[0].end=n+6*y,c[0].boxCount=y,e.call(this,t,c,i,f++);m=h[d],p=n}}ho(t,e,n,s,o,l,u){const f=this.layer.getRenderer(),d=t.material.uniforms,p=1===d.pitchWithMap,m=!p&&f.getTerrainHelper&&f.getTerrainHelper(),y=this.isEnableCollision(),g=this.getMap(),v=t.geometry,x=v.desc.positionSize,{aShape:b,aOffset:w,aAnchor:_,aAltitude:S,aPitchRotation:M}=v.properties;let{aProjectedAnchor:P}=v.properties;P||(P=v.properties.aProjectedAnchor=new Array(_.length/x*3));const T=v.properties.aTextSize,k=!u,O=e[n],I=O*x;let F;F=v.data.aAltitude?set$4(Ks$1,_[I],_[I+1],S[O]):Fa.unpackPosition(Ks$1,_[I],_[I+1],_[I+2]);const C=bi$1(Zs$1,F,l,g.width,g.height),E=v.properties.aTerrainAltitude;let D;if(E){const t=E[O];if(t===xt$3)return P[3*O]=-999999,P[3*O+1]=-999999,P[3*O+2]=-999999,!1;t?(D=set$4(yo$1,...F),D[2]=100*t,D=bi$1(D,D,l,g.width,g.height)):D=C}else D=C;const R=g.getDevicePixelRatio();if(scale$3(vo$1,D,1/R),g.isOffscreen(vo$1))return y||bo$1(w,e,n,s),P[3*O]=-999999,P[3*O+1]=-999999,P[3*O+2]=-999999,!1;k&&(F=C),P[3*O]=D[0],P[3*O+1]=D[1],P[3*O+2]=D[2];const L=k?1:v.properties.tileExtent/this.layer.getTileSize().width;let N=!0;const H=e[n],z=e[s-1],V=T?T[H]:t.properties.textSize,U=this.uo(t,V,o,H,z,F,Ks$1,L,u);if(null===U)return bo$1(w,e,n,s),!1;const j=z-H<=3,B=Math.floor(U/2),G=U%2;for(let a=n;a<s;a+=6){const u=e[a];let f;if(f=B||a!==n||j||m?B||a!==s-6||j||m?Hs$1.call(this,qs$1,t,V,o,u,F,Ks$1,L,B,D,this.layer,l,p):uo$1:ho$1,!f){N=!1,y||bo$1(w,e,n,s);break}let g=f[2];G&&(g-=Math.PI/2);const v=Er$2(Qs$1,g,0,d.rotateWithMap,d.pitchWithMap),x=w.length>b.length;let A;if(x){set$4(ao$1,M[3*u],M[3*u+1],0);const t=normalize$4(ao$1,ao$1),e=-M[3*u+2];if(e){const n=setAxisAngle(ro$1,t,e);fromTranslation$1(so$1,Ys$1),fromQuat(oo$1,n),A=multiply$5(oo$1,oo$1,so$1)}}for(let t=0;t<4;t++){const e=2*(u+t);set(to$1,b[e]/10,b[e+1]/10),scale(to$1,to$1,V/24),transformMat2(to$1,to$1,v),p?(multiply(to$1,to$1,no$1),add(eo$1,to$1,f),x&&(eo$1[2]=0,A&&transformMat4$2(eo$1,eo$1,A))):(multiply(eo$1,f,no$1),add(eo$1,to$1,eo$1)),io$1[0]=10*eo$1[0],io$1[1]=10*eo$1[1],x&&(io$1[2]=10*eo$1[2]);const n=(x?3:2)*(u+t);(w[n]!==io$1[0]||w[n+1]!==io$1[1]||x&&w[n+2]!==io$1[2])&&(w.dirty=!0,w[n]=io$1[0],w[n+1]=io$1[1],x&&(w[n+2]=io$1[2]))}}return N}uo(t,e,n,i,r,s,o,a,l){const h=r-i<=3,u=this.getMap();return h?0:Us$1.call(this,ho$1,uo$1,t,e,n,i,r,s,o,a,u.width/u.height,l)}isBoxCollides(t,e,n,i,r,s){return this.isLabelCollides(0,t,e,n,i,r,s)}deleteMesh(t,e){t&&(e&&(Array.isArray(t)?t.forEach((t=>{t&&t.material&&delete t.material.uniforms.texture})):t.material&&delete t.material.uniforms.texture),super.deleteMesh(t,e))}delete(){super.delete(),this.oo.dispose(),delete this.ro,this.co&&this.co.dispose()}needClearStencil(){return!0}init(){this.renderer=new B$6(this.regl);const{uniforms:e,extraCommandProps:i}=rs$2.call(this,this.canvas,this.sceneConfig),r=this.canvas,s={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:r?r.width:1,height:(t,e)=>e.viewport?e.viewport.height:r?r.height:1};i.viewport=s,this.shader=new vn$4({vert:ps$2,frag:ms$2,uniforms:e,extraCommandProps:i});let o=i;if(this.layer.getRenderer().isEnableWorkAround("win-intel-gpu-crash")&&(o=Tt$3({},i),o.stencil=Tt$3({},i.stencil),o.stencil.enable=!0),this.oo=new vn$4({vert:js$1,frag:ms$2,uniforms:e,extraCommandProps:o}),this.pickingFBO){const t=new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+ps$2,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());t.filter=t=>"line"!==this.getSymbol(t.properties.symbolIndex).textPlacement;const i=new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+js$1,uniforms:e,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap());i.filter=t=>"line"===t.geometry.properties.textPlacement,this.picking=[t,i]}}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin,i=this.layer.getTileSize().width,r=n?go$1:t.projViewMatrix,s=t.cameraToCenterDistance,o=set(lo$1,t.width,t.height);n&&set(o,i,i);const a=lt$3(t.getResolution(),t);return{layerScale:this.layer.options.styleScale||1,mapPitch:t.getPitch()*Math.PI/180,mapRotation:t.getBearing()*Math.PI/180,projViewMatrix:r,viewMatrix:t.viewMatrix,cameraToCenterDistance:s,canvasSize:o,glyphSize:24,gammaScale:1*(this.layer.options.textGamma||1),resolution:t.getResolution(),altitudeScale:a,viewport:n&&e&&e.viewport,textPitchFilter:0,isRenderingTerrain:+!!n}}}function bo$1(t,e,n,i){for(let r=n;r<i;r+=6){const n=e[r];for(let e=0;e<4;e++){const i=3*(n+e);(t[i]||t[i+1]||t[i+2])&&(t.dirty=!0,t[i]=0,t[i+1]=0,t[i+2]=0)}}}function Ao$1(t,e){const n=t.properties.level-e.properties.level;return 0===n?t.properties.meshKey-e.properties.meshKey:n}var wo$1="#define SHADER_NAME NATIVE_POINT\n#include <gl2_vert>\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\nuniform mat4 positionMatrix;\nuniform mat4 projViewModelMatrix;\nuniform float markerSize;\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * positionMatrix * vec4(c, 1.);\n  gl_PointSize = markerSize;\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const _o$1={markerFill:[0,0,0],markerOpacity:1,markerSize:10};class So$1 extends Bi$1{getPrimitive(){return"points"}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:s}=t,o=this.getSymbol(r);void 0===s&&(si$1(i,this.getSymbolDef(r),this.getFnTypeConfig(r)),i.generateBuffers(this.regl));const a={};Ct$3(a,"markerOpacity",o,"markerOpacity",1),Ct$3(a,"markerSize",o,"markerSize",10),Ct$3(a,"markerFill",o,"markerFill","#000",Rt$3(this.colorCache,3));const l=new Ce$5(a,_o$1);l.createDefines=()=>"square"!==o.markerType?{USE_CIRCLE:1}:null,l.appendDefines=t=>("square"!==o.markerType&&(t.USE_CIRCLE=1),t);const h=new Be$5(i,l,{castShadow:!1,picking:!0}),u={};return h.geometry.data.aAltitude&&(u.HAS_ALTITUDE=1),i.data.aColor&&(u.HAS_COLOR=1),h.setDefines(u),h.positionMatrix=this.getAltitudeOffsetMatrix(),h.setLocalTransform(e),h.properties.symbolIndex=r,h}createFnTypeConfig(t,e){const n=piecewiseConstant(e.markerFill);return[{attrName:"aColor",symbolName:"markerFill",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Dt$3(r),r}}]}init(){this.renderer=new B$6(this.regl);const e=[],i={vert:wo$1,frag:"#define SHADER_NAME NATIVE_POINT\nprecision mediump float;\n#include <gl2_frag>\n#ifdef USE_CIRCLE\n#if __VERSION__ == 100\n#ifdef GL_OES_standard_derivatives\n#define STANDARD_DERIVATIVES_ENABLED 1\n#extension GL_OES_standard_derivatives : enable\n#endif\n#else\n#define STANDARD_DERIVATIVES_ENABLED 1\n#endif\n#endif\n#ifdef HAS_COLOR\nvarying vec4 vColor;\n#else\nuniform vec3 markerFill;\n#endif\nuniform float markerOpacity;\nuniform float layerOpacity;\nvoid main() {\n  float c = 1.;\n#ifdef USE_CIRCLE\nfloat r = .0, d = .0;\n  vec2 e = 2. * gl_PointCoord - 1.;\n  r = dot(e, e);\n  if(r > 1.) {\n    discard;\n  }\n#ifdef STANDARD_DERIVATIVES_ENABLED\nd = fwidth(r);\n  c = 1. - smoothstep(1. - d, 1. + d, r);\n#endif\n#endif\n#ifdef HAS_COLOR\nvec4 f = vColor;\n#else\nvec4 f = vec4(markerFill, 1.);\n#endif\nglFragColor = f * markerOpacity * c * layerOpacity;\n#if __VERSION__ == 100\ngl_FragColor = glFragColor;\n#endif\n}",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,n){return multiply$5(e,n.projViewMatrix,n.modelMatrix),e}}],defines:null,extraCommandProps:{viewport:{x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},depth:{enable:!0,mask:!1,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"always"},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"}}};if(this.shader=new vn$4(i),this.shader.version=300,this.pickingFBO){const t=[];this.picking=[new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+wo$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(e,n){return multiply$5(t,n.projViewMatrix,n.modelMatrix),t}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]}}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}}var Mo$1="#define SHADER_NAME NATIVE_LINE\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nuniform mat4 projViewModelMatrix;\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#else\n#include <fbo_picking_vert>\n#endif\n#include <vt_position_vert>\nvoid main() {\n  vec3 c = unpackVTPosition();\n  gl_Position = projViewModelMatrix * vec4(c, 1.);\n#ifndef PICKING_MODE\n#if defined(HAS_COLOR)\nvColor = aColor / 255.;\n#endif\n#else\nfbo_picking_setData(gl_Position.w, true);\n#endif\n}";const Po$1=identity$2([]);class To$1 extends Bi$1{constructor(t,e,n,i,r,s){if(super(t,e,n,i,r,s),this.primitive="lines",isFunctionDefinition(this.symbolDef.lineColor)){const t=e.getMap(),n=piecewiseConstant(this.symbolDef.lineColor);this.colorSymbol=e=>n(t.getZoom(),e)}}needPolygonOffset(){return!0}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:s}=t,o=this.getSymbol(r),a=this.getMeshUniforms(i,o);void 0===s&&i.generateBuffers(this.regl);const l=new Ce$5(a),h=new Be$5(i,l,{castShadow:!1,picking:!0});h.setLocalTransform(e),h.properties.symbolIndex=r;const u={};return h.geometry.data.aAltitude&&(u.HAS_ALTITUDE=1),h.setDefines(u),h}getMeshUniforms(t,e){const n={};return Ct$3(n,"lineColor",e,"lineColor","#000",Rt$3(this.colorCache)),Ct$3(n,"lineOpacity",e,"lineOpacity",1),n}init(t){const e=this.layer.getRenderer().isEnableTileStencil()&&(!t||!t.isRenderingTerrain||!this.isTerrainSkin());this.renderer=new B$6(this.regl);const s=this.canvas,o={x:(t,e)=>e.viewport?e.viewport.x:0,y:(t,e)=>e.viewport?e.viewport.y:0,width:(t,e)=>e.viewport?e.viewport.width:s?s.width:1,height:(t,e)=>e.viewport?e.viewport.height:s?s.height:1},a=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],h={vert:Mo$1,frag:"#define SHADER_NAME NATIVE_LINE\nprecision mediump float;\nuniform float lineOpacity;\nuniform vec4 lineColor;\nuniform float layerOpacity;\n#if defined(HAS_COLOR)\nvarying vec4 vColor;\n#endif\nvoid main() {\n  gl_FragColor = lineColor * lineOpacity;\n#if defined(HAS_COLOR)\ngl_FragColor *= vColor;\n#endif\ngl_FragColor *= layerOpacity;\n}",uniforms:a,defines:null,extraCommandProps:{viewport:o,stencil:{enable:!0,mask:255,func:{cmp:()=>e?"=":"<=",ref:(t,n)=>e?n.stencilRef:n.level,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}};this.shader=new vn$4(h),this.pickingFBO&&(this.picking=[new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+Mo$1,uniforms:a,extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())])}getUniformValues(t,e){const n=e&&e.isRenderingTerrainSkin;return{projViewMatrix:n?Po$1:t.projViewMatrix,viewport:n&&e&&e.viewport}}getPrimitive(){return"lines"}}const ko$1=[0,0],Oo$1=[1,1,1],Io$1=[1,1,1,1],Fo$1=[0,0],Co$1=[1,1],Eo$1=[],Do$1=new t__namespace.Coordinate(0,0),Ro$1=new t__namespace.Coordinate(0,0),Lo$1=[],No$1=[];class Ho$1 extends Vi$1{supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isTerrainSkin(){return!1}isTerrainVector(){return this.layer.options.awareOfTerrain}isAnimating(){return!1}createMesh(e,i,{tilePoint:s}){if(!this.material)return this.setToRedraw(),null;const{geometry:o,symbolIndex:a}=e,l=this.layer instanceof t__namespace.TileLayer,u=new Be$5(o,this.material);if(this.sceneConfig.animation){Oo$1[2]=.01;const t=[];fromScaling(t,Oo$1),multiply$5(t,i,t),i=t}const c=this.getSymbolDef(a),f=this.getFnTypeConfig(a);si$1(o,c,f);const d=this.getShader(),p=d.getGeometryDefines?d.getGeometryDefines(o):{},m=this.getSymbol(a),y=Rt$3(this.colorCache);if(o.data.aExtrude){p.IS_LINE_EXTRUSION=1;const{tileResolution:t,tileRatio:e}=o.properties,n=this.getMap();Object.defineProperty(u.uniforms,"linePixelScale",{enumerable:!0,get:function(){return e*n.getResolution()/t}}),Ct$3(u.uniforms,"lineWidth",m,"lineWidth",4),Ct$3(u.uniforms,"lineOpacity",m,"lineOpacity",1),Ct$3(u.uniforms,"lineColor",m,"lineColor","#fff",y),Object.defineProperty(u.uniforms,"lineHeight",{enumerable:!0,get:()=>{const t=this.dataConfig.defaultAltitude*(this.dataConfig.altitudeScale||1);return Ht$2(t)?t:0}})}else{Ct$3(u.uniforms,"polygonFill",m,"polygonFill",Io$1,y),Ct$3(u.uniforms,"polygonOpacity",m,"polygonOpacity",1);const t=[];Object.defineProperty(u.uniforms,"vertexColorsOfType",{enumerable:!0,get:()=>{const e=y(m.bottomPolygonFill||Io$1),n=y(m.topPolygonFill||Io$1);t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=n[0],t[5]=n[1],t[6]=n[2],t[7]=n[3];const i=u.geometry.properties.vertexColors;if(i){let e=8;t.length=8+i.length;for(let n=0;n<i.length;n++)t[e++]=i[n][0],t[e++]=i[n][1],t[e++]=i[n][2],t[e++]=i[n][3]}return t}})}if(o.data.aColor&&(p.HAS_COLOR=1),o.data.aOpacity&&(p.HAS_OPACITY=1),o.data.aLineWidth&&(p.HAS_LINE_WIDTH=1),o.data.aLineHeight&&(p.HAS_LINE_HEIGHT=1),o.data.aTerrainAltitude&&(p.HAS_TERRAIN_ALTITUDE=1),o.data.aVertexColorType){const t=u.geometry.properties.vertexColors;let e=2;t&&(e+=t.length),p.VERTEX_TYPES_COUNT=e}if(o.data.aOpacity){const t=o.data.aOpacity;for(let e=0;e<t.length;e++)if(t[e]<255){o.properties.hasAlpha=!0;break}}p.HAS_MIN_ALTITUDE=1,p.HAS_LAYER_OPACITY=1,o.generateBuffers(this.regl),u.setDefines(p),u.setPositionMatrix(this.getAltitudeOffsetMatrix()),u.setLocalTransform(i),(o.properties.maxAltitude<=0||u.properties.level>=3)&&(u.castShadow=!1),u.setUniform("maxAltitude",u.geometry.properties.maxAltitude),Object.defineProperty(u.uniforms,"minAltitude",{enumerable:!0,get:()=>this.layer.options.altitude||0});const{tileResolution:g}=o.properties,v=this.getMap(),x=this.layer.getRenderer(),b=v.pointAtResToCoord(new t__namespace.Point(s),g),A=function(t,e,n,i,r){return t.pointAtResToDistance(1,0,i,n)}(v,0,b,g),w=[];Object.defineProperty(u.uniforms,"uvOrigin",{enumerable:!0,get:()=>{const t=this.fo(_,a,s,g,A,l);return set(w,t[0]-t[0]%1,t[1]-t[1]%1)}});const _=[];Object.defineProperty(u.uniforms,"uvOffset",{enumerable:!0,get:()=>{const t=this.fo(_,a,s,g,A,l);return set(w,t[0]%1,t[1]%1)}}),Object.defineProperty(u.uniforms,"hasAlpha",{enumerable:!0,get:()=>{const t=this.getSymbol(a);return o.properties.hasAlpha||t.polygonOpacity<1||t.lineOpacity<1||u.material&&(u.material.uniforms.baseColorTexture||u.material.uniforms.emissiveTexture)}});const S=this.layer.getMap().getMaxNativeZoom();return Object.defineProperty(u.uniforms,"stencilRef",{enumerable:!0,get:()=>x.isForeground(u)?0:S-u.properties.tile.z}),u.properties.symbolIndex=a,u}fo(t,e,n,i,r,s){if(1===this.dataConfig.topUVMode)return ko$1;const o=this.getMap(),a=this.getSymbol(e).material;let l=n;!this.dataConfig.side&&a&&a.textureOrigin&&(Do$1.set(a.textureOrigin[0],a.textureOrigin[1]),o.coordToPointAtRes(Do$1,i,Ro$1),l=set(Lo$1,n[0]-Ro$1.x,n[1]-Ro$1.y));const u=!!a&&a.uvOffsetInMeter;let c=a&&a.uvOffset||Fo$1;const f=this.getUVOffsetAnim();f&&(c=this.getUVOffset(f));const d=a&&a.uvScale||Co$1;let p=this.dataConfig.side?0:l[0],m=this.dataConfig.side?0:l[1];const y=a&&a.textureWidth||23.25;u&&(p+=c[0]/r,m+=c[1]/r);const b=set(t,p*r*d[0]/y+(u?0:c[0]),m*r*d[1]/(y*d[1]/d[0])+(u?0:c[1]));return s||(b[1]*=-1),b}callShader(t,e){const n=this.sceneConfig.cullFace;this.sceneConfig.cullFace="front",this.callBackgroundTileShader(t,e),void 0===n?delete this.sceneConfig.cullFace:this.sceneConfig.cullFace=n,super.callShader(t,e)}getShadowMeshes(){if(!this.isVisible())return Eo$1;this.shadowCount=this.scene.getMeshes().length;const t=this.scene.getMeshes().filter((t=>0===t.properties.level));for(let e=0;e<t.length;e++){const n=t[e];n.material!==this.material&&n.setMaterial(this.material)}return t}getUVOffsetAnim(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}getUVOffset(t){const e=this.getSymbols()[0],n=e.material&&e.material.uvOffset||Fo$1,i=!!e.material&&e.material.uvOffsetInMeter,r=performance.now()/1e3,s=set(No$1,n[0],n[1]);return s[0]=r*t[0],s[1]=r*t[0],i||(s[0]%=1,s[1]%=1),s}needPolygonOffset(){return this.do}startFrame(...t){return delete this.do,super.startFrame(...t)}addMesh(t,e){t.forEach((t=>{this._r(t,e)})),super.addMesh(...arguments)}_r(t,e){if(null!==e){const n=t.localTransform;0===e&&(e=.01),Oo$1[2]=e,fromScaling(n,Oo$1),multiply$5(n,t.properties.tileTransform,n),t.setLocalTransform(n)}else t.setLocalTransform(t.properties.tileTransform);t.material!==this.material&&t.setMaterial(this.material),t.geometry.properties.maxAltitude<=0&&(this.do=!0),t.ssr=this.getSymbol(t.properties.symbolIndex).ssr?1:0}deleteMaterial(){this.material&&(this.material.dispose(),delete this.material)}deleteMesh(t,e){if(t)if(this.scene.removeMesh(t),Array.isArray(t))for(let n=0;n<t.length;n++)e||(t[n].geometry.dispose(),delete t[n].geometry.properties.layer),t[n].dispose();else e||(t.geometry.dispose(),delete t.geometry.properties.layer),t.dispose()}updateDataConfig(t,e){return!("line-extrusion"===this.dataConfig.type&&!t.altitudeProperty&&!e.altitudeProperty)}createFnTypeConfig(t,e){const n=piecewiseConstant(e.polygonFill||e.lineColor),i=interpolated(e.polygonOpacity||e.lineOpacity),r=interpolated(e.lineWidth),s=new Uint8Array(1),o=new Uint16Array(1);return[{attrName:"aColor",type:Uint8Array,width:4,symbolName:e.polygonFill?"polygonFill":e.lineColor?"lineColor":"polygonFill",define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Dt$3(r),r}},{attrName:"aOpacity",type:Uint8Array,width:1,symbolName:e.polygonOpacity?"polygonOpacity":e.lineOpacity?"lineOpacity":"polygonOpacity",evaluate:(e,n)=>{let r=i(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,n,t,e,!1)),s[0]=255*r,s[0]<255&&(n.properties.hasAlpha=!0),s[0]}},{attrName:"aLineWidth",type:Uint8Array,width:1,symbolName:"lineWidth",define:"HAS_LINE_WIDTH",evaluate:e=>{const n=r(t.getZoom(),e);return o[0]=Math.round(2*n),o[0]}}]}updateSymbol(t,e){let n=!1;t&&t.material&&(n=function(t,e){for(const n in e)if(Vo$1[n]&&e[n]!==t[n]&&(!t[n]||!e[n]))return!0;return!1}(this.symbolDef[0].material||{},t.material));const i=super.updateSymbol(t,e);return t&&t.material&&this.ri(t.material),n||i}Qi(t,e){return zo$1(t)!==zo$1(e)}}function zo$1(t){if(!t||!t.material)return!1;for(const e in t.material)if(e.indexOf("Texture")>0&&t.material[e])return!0;return!1}const Vo$1={normalTexture:1,bumpTexture:1};class Uo$1 extends Ho$1{createGeometry(t){const e=t.data,i=this.getSymbols()[0];if(i.material&&i.material.extrusionOpacity){const t=new Uint8Array(e.aPosition.length/3);for(let n=0;n<e.aPosition.length;n+=3)t[n/3]=e.aPosition[n+2]>0?0:1;e.aExtrusionOpacity=t}const r=new Q$7(e,t.indices);return Tt$3(r.properties,t.properties),this.dr(r,t),{geometry:r,symbolIndex:{index:0}}}updateSceneConfig(t){let e;if(this.sceneConfig.cullFace!==t.cullFace&&(e=!0),Tt$3(this.sceneConfig,t),e){const t=this.getShaderConfig();this.shader.dispose(),this.shader=new bn$4(t)}this.setToRedraw()}getShader(){return this.shader}delete(t){this.getMap().off("updatelights",this.po,this),super.delete(t),this.material.dispose()}init(){this.getMap().on("updatelights",this.po,this);this.renderer=new B$6(this.regl);const e=this.getShaderConfig();this.shader=new bn$4(e),this.ri();const i={vert:this.getPickingVert(),uniforms:["projViewMatrix","modelMatrix","positionMatrix",{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],extraCommandProps:{viewport:this.pickingViewport}};this.picking=[new Cr$4(this.renderer,i,this.layer.getRenderer().pickingFBO,this.getMap())]}po(){this.setToRedraw()}getShaderConfig(){const t=this.canvas,e={x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1};return{extraCommandProps:{cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>{let t=this.sceneConfig.cullFace;return!0===t&&(t="back"),t||"back"}},stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e,polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}}ri(){this.material&&this.material.dispose();const t=this.getSymbols()[0].material,e={};for(const n in t)Vt$2(t,n)&&(e[n]=t[n]);this.material=new Ie$5(e)}getUniformValues(t,e){const n=t.viewMatrix,i=t.projMatrix,r=t.cameraPosition,s=this.mo(),o=Tt$3({viewMatrix:n,projMatrix:i,cameraPosition:r,projViewMatrix:t.projViewMatrix},s);o.halton=e&&e.jitter?e.jitter:[0,0];const a=this.layer.getRenderer().canvas;return o.outSize=[a.width,a.height],o}getPickingVert(){return"\n            attribute vec3 aPosition;\n            uniform mat4 projViewModelMatrix;\n            uniform mat4 modelMatrix;\n            uniform mat4 positionMatrix;\n            //fbo pickingvert\n            #include <fbo_picking_vert>\n            #include <get_output>\n            void main()\n            {\n                mat4 localPositionMatrix = getPositionMatrix();\n                vec4 localPosition = getPosition(aPosition);\n\n                gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n                //gl_Positiondepth\n                fbo_picking_setData(gl_Position.w, true);\n            }\n        "}mo(){const t=this.getMap().getLightManager(),e=t&&t.getAmbientLight()||{},n=t&&t.getDirectionalLight()||{};return{ambientColor:e.color||[.2,.2,.2],light0_diffuse:[...n.color||[.1,.1,.1],1],lightSpecular:n.specular||[.8,.8,.8],light0_viewDirection:n.direction||[1,1,-1]}}}const jo$1=[1,1,1];class Bo$1 extends Vi$1{createGeometry(t){const{data:e,indices:i}=t,r=new Q$7(e,i,0,{primitive:"lines"});return r.generateBuffers(this.regl),{geometry:r,symbolIndex:{index:0}}}createMesh(t,e){const{geometry:i}=t,s=new Be$5(i);if(s.castShadow=!1,this.sceneConfig.animation){jo$1[2]=.01;const t=[];fromScaling(t,jo$1),multiply$5(t,e,t),e=t}return s.setLocalTransform(e),s.properties.symbolIndex={index:0},s}addMesh(t,e){if(!t.length)return this;let n;null!==e?(0===e&&(e=.01),n=t[0].localTransform,jo$1[2]=e,fromScaling(n,jo$1),multiply$5(n,t[0].properties.tileTransform,n)):n=t[0].properties.tileTransform;for(let e=0;e<t.length;e++)t[e].setLocalTransform(n);return this.scene.addMesh(t),this}init(){const t=this.regl;this.scene=new Ke$5,this.renderer=new B$6(t);const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={vert:"\n    attribute vec3 aPosition;\n    attribute vec4 aColor;\n\n    uniform mat4 projViewModelMatrix;\n    uniform vec2 outSize;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n        vColor = aColor / 255.0;\n    }\n",frag:"\n    #ifdef GL_ES\n        precision lowp float;\n    #endif\n\n    uniform float opacity;\n\n    varying vec4 vColor;\n\n    void main()\n    {\n        gl_FragColor = vColor * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{stencil:{enable:!0,func:{cmp:"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},viewport:e}};this.shader=new vn$4(i)}getUniformValues(t){const e=this.sceneConfig.opacity||.3,n=this.layer.getRenderer().canvas;return{projViewMatrix:t.projViewMatrix,outSize:[n.width,n.height],opacity:e}}}const{getPBRUniforms:Go$1}=fi$4.PBRUtils;class Wo$1 extends Ho$1{constructor(...t){super(...t),this.yo=new Ve$5,this.scene.sortFunction=this.sortByCommandKey}supportRenderMode(t){return this.getSymbols()[0].ssr?"fxaa"===t||"fxaaAfterTaa"===t:super.supportRenderMode(t)}isAnimating(){const t=this.vo();if(t&&(t[0]||t[1]))return!0}needToRedraw(){const t=this.vo();return!(!t||!t[0]&&!t[1])||super.needToRedraw()}vo(){const t=this.getSymbols()[0];return t.material&&t.material.uvOffsetAnim}createGeometry(t){if(!t.data||!t.data.aPosition||!t.data.aPosition.length)return null;const e={uv0Attribute:"aTexCoord0"};t.aAltitude&&(e.altitudeAttribute="aAltitude");const i=new Q$7(t.data,t.indices,0,e);return Tt$3(i.properties,t.properties),t.vertexColors&&(i.properties.vertexColors=t.vertexColors),this.material.uniforms.normalTexture&&!i.data[i.desc.tangentAttribute]&&i.data[i.desc.uv0Attribute]&&(i.data[i.desc.normalAttribute]||i.createNormal(),i.createTangent()),this.dr(i,t),{geometry:i,symbolIndex:{index:0}}}paint(t){const e=!!t.shadow;t.states&&t.states.includesChanged&&(this.shader.dispose(),delete this.shader,this.xo.dispose(),delete this.xo,this.br(t));let n=!!t.ssr&&this.getSymbols()[0].ssr;const i=this.shader,r=i.shaderDefines;if(n){const e=Tt$3({},r,t.ssr.defines);i.shaderDefines=e}if(t.onlyUpdateDepthInTaa&&(this.shader=this.xo,!n&&this.bo&&(this.shader=i,this.setToRedraw(!0))),this.updateIBLDefines(i),super.paint(t),void 0!==this.shadowCount&&e){const t=this.scene.getMeshes().length;this.shadowCount!==t&&this.setToRedraw()}this.shader=i,n&&(i.shaderDefines=r),delete this.shadowCount,this.bo=n}updateSceneConfig(t){Tt$3(this.sceneConfig,t),this.setToRedraw()}delete(){super.delete(),this.disposeIBLTextures(),this.material.dispose(),this.xo&&(this.xo.dispose(),delete this.xo)}init(t){this.getMap().on("updatelights",this.Ao,this),this.createIBLTextures(),this.Sr=this.Sr||t;this.renderer=new B$6(this.regl),this.wo=this._o.bind(this),this.So=this.disposeCachedTexture.bind(this),this.Mo=this.Po.bind(this),this.ri(),this.br(t);const i={vert:"\n                #include <gl2_vert>\n                attribute vec3 aPosition;\n                uniform mat4 projViewModelMatrix;\n                uniform mat4 positionMatrix;\n                //fbo pickingvert\n                #include <line_extrusion_vert>\n                #include <get_output>\n                #include <fbo_picking_vert>\n                void main() {\n                    mat4 localPositionMatrix = getPositionMatrix();\n                    #ifdef IS_LINE_EXTRUSION\n                        vec3 linePosition = getLineExtrudePosition(aPosition);\n                        vec4 localVertex = getPosition(linePosition);\n                    #else\n                        vec4 localVertex = getPosition(aPosition);\n                    #endif\n\n                    gl_Position = projViewModelMatrix * localPositionMatrix * localVertex;\n                    fbo_picking_setData(gl_Position.w, true);\n                }\n            ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)}],extraCommandProps:{viewport:this.pickingViewport,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<=",mask:!!It$3(this.sceneConfig.depthMask)||this.sceneConfig.depthMask}}};this.picking=[new Cr$4(this.renderer,i,this.layer.getRenderer().pickingFBO,this.getMap())]}br(t){const e={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},i={},r=[];r.push(...jn$4.getUniformDeclares()),this.fillIncludes(i,r,t);const s={cull:{enable:()=>void 0===this.sceneConfig.cullFace||!!this.sceneConfig.cullFace,face:()=>this.sceneConfig.cullFace||"back"},stencil:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:{cmp:"<=",ref:(t,e)=>e.stencilRef},op:{fail:"keep",zfail:"keep",zpass:"replace"}},viewport:e,depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},blend:{enable:(t,e)=>void 0===e.hasAlpha||!!e.hasAlpha,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}},o={uniforms:r,defines:this.To(i),extraCommandProps:s};this.shader=new fi$4.StandardShader(o),o.frag="\n            precision mediump float;\n            #include <gl2_frag>\n            void main() {\n                glFragColor = vec4(0.0);\n                #if __VERSION__ == 100\n                    gl_FragColor = glFragColor;\n                #endif\n            }\n        ",this.xo=new fi$4.StandardShader(o)}_o({resources:t}){for(let e=0;e<t.length;e++)this.addCachedTexture(t[e].url,t[e].data);this.setToRedraw(!0)}Po(){this.setToRedraw(!0)}ri(t){if(t){const e=this.getSymbols()[0].material;e&&Tt$3(e,t)}const e=this.dataConfig,i=t||this.getSymbols()[0].material,r={};let s=!1;for(const t in i)if(Vt$2(i,t))if(t.indexOf("Texture")>0){let o=i[t];if(!o){r[t]=void 0;continue}const a="string"==typeof o?o:o.url,l=this.getCachedTexture(a);l?l.then?a===o?o={promise:l,wrap:"repeat"}:o.promise=l:a===o?o={data:l,wrap:"repeat"}:o.data=l:a===o&&(o={url:a,wrap:"repeat"}),o.flipY=!e.upsideUpTexture,o.min="linear mipmap linear",o.mag="linear",r[t]=new en$5(o,this.yo),r[t].once("complete",this.wo),r[t].once("disposed",this.So),r[t].promise&&this.addCachedTexture(a,r[t].promise),s=!0}else r[t]=i[t];if(void 0===r.alphaTest&&this.getMaterialClazz&&(r.alphaTest=.05),this.material){for(let t in r)this.material.set(t,r[t]);this.setToRedraw(!0)}else this.material=new fi$4.StandardMaterial(r),this.material.once("complete",this.Mo);s||this.Po()}getShader(){return this.shader}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=Go$1(t,n,i,e&&e.ssr,e&&e.jitter);return this.setIncludeUniformValues(r,e),r}To(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Ao(){if(!this.shader)return;const t=this.shader.shaderDefines;this.To(t),this.shader.shaderDefines=t}}var Xo$1="#include <gl2_vert>\n#define EXTRUDE_SCALE 63.0\n#define EXTRUDE_MOD 64.0\n#define MAX_LINE_DISTANCE 65535.0\nuniform mat4 projViewModelMatrix;\nuniform vec2 centiMeterToLocal;\n#ifdef HAS_ALTITUDE\nattribute vec2 aPosition;\nattribute float aAltitude;\n#else\nattribute vec3 aPosition;\n#endif\nattribute vec4 aTubeNormal;\n#ifdef HAS_LINE_WIDTH\nattribute float aLineWidth;\n#else\nuniform float lineWidth;\n#endif\n#include <vt_position_vert>\n#ifdef PICKING_MODE\n#include <fbo_picking_vert>\n#else\nuniform mat4 modelViewMatrix;\nuniform mat3 modelNormalMatrix;\nuniform mat4 modelMatrix;\n#if defined(HAS_PATTERN)\nuniform float resolution;\nuniform float tileResolution;\nuniform float tileRatio;\nattribute float aLinesofar;\nvarying highp float vLinesofar;\nattribute vec4 aTexInfo;\nvarying vec4 vTexInfo;\nvarying float vNormalY;\nvarying float vPatternHeight;\nattribute float aNormalDistance;\n#if defined(HAS_PATTERN_ANIM)\nattribute float aLinePatternAnimSpeed;\nvarying float vLinePatternAnimSpeed;\n#endif\n#if defined(HAS_PATTERN_GAP)\nattribute float aLinePatternGap;\nvarying float vLinePatternGap;\n#endif\n#endif\n#ifdef HAS_COLOR\nattribute vec4 aColor;\nvarying vec4 vColor;\n#endif\n#ifdef HAS_OPACITY\nattribute float aOpacity;\n#endif\nvarying float vOpacity;\nvarying vec3 vModelNormal;\nvarying vec4 vViewVertex;\nvarying vec3 vModelVertex;\n#endif\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n#include <vsm_shadow_vert>\n#endif\n#include <highlight_vert>\nvoid main() {\n  \n#ifdef HAS_LINE_WIDTH\nfloat c = aLineWidth;\n#else\nfloat c = lineWidth;\n#endif\nfloat d = c / 2.;\n  vec3 e = aTubeNormal.xyz / EXTRUDE_SCALE;\n  vec3 f = unpackVTPosition();\n  vec4 h = vec4(f, 1.);\n  h.xy += e.xy * d * centiMeterToLocal;\n  h.z += e.z * d;\n  gl_Position = projViewModelMatrix * h;\n#ifdef PICKING_MODE\nfbo_picking_setData(gl_Position.w, true);\n#else\nvViewVertex = modelViewMatrix * h;\n  vec3 i = normalize(e);\n  vModelNormal = modelNormalMatrix * i;\n  vModelVertex = (modelMatrix * h).xyz;\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\nshadow_computeShadowPars(h);\n#endif\n#ifdef HAS_COLOR\nvColor = aColor / 255.;\n#endif\n#ifdef HAS_OPACITY\nvOpacity = aOpacity / 255.;\n#else\nvOpacity = 1.;\n#endif\n#ifdef HAS_PATTERN\nfloat j = tileResolution / resolution;\n  float k = aLinesofar - d * centiMeterToLocal.y * aNormalDistance / EXTRUDE_SCALE;\n  vLinesofar = k / tileRatio * j;\n  vTexInfo = vec4(aTexInfo.xy, aTexInfo.zw + 1.);\n  vPatternHeight = c * centiMeterToLocal.x / tileRatio * j;\n  vNormalY = aTubeNormal.w / EXTRUDE_SCALE;\n#if defined(HAS_PATTERN_ANIM)\nvLinePatternAnimSpeed = aLinePatternAnimSpeed / 127.;\n#endif\n#if defined(HAS_PATTERN_GAP)\nvLinePatternGap = aLinePatternGap / 10.0;\n#endif\n#endif\nhighlight_setVarying();\n#endif\n}";const{getPBRUniforms:Yo$1}=fi$4.PBRUtils;class $o$1 extends Bi$1{needToRedraw(){return super.needToRedraw()||this.isAnimating()}isTerrainSkin(){return!1}isTerrainVector(){return!0}supportRenderMode(t){return this.isAnimating()?"fxaa"===t||"fxaaAfterTaa"===t:"taa"===t||"fxaa"===t}isAnimating(){if(this.Ar)return!0;const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e].linePatternFile&&t[e].linePatternAnimSpeed)return!0;return!1}isBloom(t){return!!this.getSymbol(t.properties.symbolIndex).lineBloom}createMesh(e,i){if(!e.geometry)return null;const r=this.getMap(),{geometry:s,symbolIndex:o,ref:a}=e,l=this.getSymbolDef(o);void 0===a&&si$1(s,l,this.getFnTypeConfig(o));const h=this.getSymbol(o),{tileResolution:u,tileRatio:c}=s.properties,f={tileResolution:u,tileRatio:c};Ct$3(f,"lineColor",h,"lineColor","#fff",Rt$3(this.colorCache)),Ct$3(f,"linePatternGapColor",h,"linePatternGapColor",[1,1,1,1],Rt$3(this.colorCache)),Ct$3(f,"lineWidth",h,"lineWidth",2,(t=>nt$4.getTubeSizeScale(this.dataConfig.metric)*t)),Ct$3(f,"lineOpacity",h,"lineOpacity",1),Ct$3(f,"linePatternAnimSpeed",h,"linePatternAnimSpeed",0),Ct$3(f,"linePatternGap",h,"linePatternGap",0),Ct$3(f,"metallicFactor",h,"metallicFactor",0),Ct$3(f,"roughnessFactor",h,"roughnessFactor",.4),Ct$3(f,"emissiveFactor",h,"emissiveFactor",[0,0,0]),Ct$3(f,"uvScale",h,"uvScale",[1,1]);const d=s.properties.iconAtlas,p=this.layer instanceof t__namespace.TileLayer;d&&(f.linePatternFile=Wi$1(this.regl,d,!1),f.atlasSize=d?[d.width,d.height]:[0,0],f.flipY=p?-1:1,this.drawDebugAtlas(d)),void 0===a&&s.generateBuffers(this.regl),f.alphaTest=-1;const m=new fi$4.StandardMaterial(f),y=new Be$5(s,m,{castShadow:!1,picking:!0}),g=r.distanceToPointAtRes(100,100,s.properties.tileResolution)._multi(c/1e4).toArray();y.setUniform("centiMeterToLocal",g);const v=r.getResolution(r.getMaxNativeZoom());y.setUniform("animSpeedScale",u/v),y.setLocalTransform(i);const x={IS_LINE_EXTRUSION:1,HAS_LAYER_OPACITY:1};return"square-tube"===this.dataConfig.type&&(x.IS_SQUARE_TUBE=1),d&&(x.HAS_PATTERN=1),y.properties.symbolIndex=o,s.data.aColor&&(x.HAS_COLOR=1),this.setMeshDefines(x,s,l),s.data.aAltitude&&(x.HAS_ALTITUDE=1),y.setDefines(x),y}setMeshDefines(t,e,n){e.data.aOpacity&&(t.HAS_OPACITY=1),e.data.aLineWidth&&(t.HAS_LINE_WIDTH=1),yi$1(n.linePatternAnimSpeed)&&(t.HAS_PATTERN_ANIM=1),yi$1(n.linePatternGap)&&(t.HAS_PATTERN_GAP=1)}paint(t){t.states&&t.states.includesChanged.shadow&&(this.shader.dispose(),this.createShader(t)),super.paint(t)}init(t){this.getMap().on("updatelights",this.Ao,this),this.createIBLTextures();if(this.renderer=new B$6(this.regl),this.createShader(t),this.pickingFBO){const t=[];this.picking=[new Cr$4(this.renderer,{vert:"#define PICKING_MODE 1\n"+Xo$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelNormalMatrix",type:"function",fn:(e,n)=>fromMat4$1(t,n.modelMatrix)}],extraCommandProps:this.getExtraCommandProps()},this.pickingFBO,this.getMap())]}}createShader(t){this.Sr=t;const e=[],i={};this.fillIncludes(i,e,t),e.push({name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}),this.shader=new fi$4.StandardShader({vert:Xo$1,uniforms:e,defines:this.To(i),extraCommandProps:this.getExtraCommandProps()})}getExtraCommandProps(){const t=this.canvas;return{viewport:{x:0,y:0,width:()=>t?t.width:1,height:()=>t?t.height:1},stencil:{enable:!0,func:{cmp:()=>"<=",ref:(t,e)=>e.level},op:{fail:"keep",zfail:"keep",zpass:"replace"}},cull:{enable:()=>!!this.sceneConfig.cullFace,face:this.sceneConfig.cullFace||"back"},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],mask:this.sceneConfig.depthMask||!0,func:this.sceneConfig.depthFunc||"<="},blend:{enable:!0,func:this.getBlendFunc(),equation:"add"},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}}getUniformValues(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=Yo$1(t,n,i,null,e&&e.jitter),o=t.viewMatrix;return r.projViewMatrix=t.projViewMatrix,r.viewMatrix=o,r.resolution=t.getResolution(),r.currentTime=this.layer.getRenderer().getFrameTimestamp()||0,this.setIncludeUniformValues(r,e),r}createFnTypeConfig(t,e){const n=piecewiseConstant(e.lineColor),i=piecewiseConstant(e.aLinePatternAnimSpeed),r=piecewiseConstant(e.aLinePatternGap),s=this.createShapeFnTypeConfigs(t,e),o=new Int8Array(2);return[{attrName:"aColor",symbolName:"lineColor",type:Uint8Array,width:4,define:"HAS_COLOR",evaluate:(e,i)=>{let r=n(t.getZoom(),e);return isFunctionDefinition(r)&&(r=this.evaluateInFnTypeConfig(r,i,t,e,!0)),Array.isArray(r)||(r=this.colorCache[r]=this.colorCache[r]||color(r).unitArray()),r=Dt$3(r),r}},{attrName:"aLinePattern",symbolName:"linePatternAnimSpeed",type:Int8Array,width:2,related:["linePatternGap"],define:"HAS_LINE_PATTERN",evaluate:(e,n,r,s)=>{let a=i(t.getZoom(),e);return It$3(a)&&(a=0),0!==a&&(n.properties.hasPatternAnim=1),o[0]=a/127,o[1]=r[s+1],o}},{attrName:"aLinePattern",symbolName:"linePatternGap",type:Int8Array,width:2,related:["linePatternAnimSpeed"],define:"HAS_LINE_PATTERN",evaluate:(e,n,i,s)=>{let a=r(t.getZoom(),e);return It$3(a)&&(a=0),o[1]=10*a,o[0]=i[s],o}}].concat(s)}createShapeFnTypeConfigs(t,e){const n=interpolated(e.lineWidth),i=interpolated(e.lineOpacity),r=new Uint16Array(1);return[{attrName:"aLineWidth",symbolName:"lineWidth",type:Uint8Array,width:1,define:"HAS_LINE_WIDTH",evaluate:(e,i)=>{let s=n(t.getZoom(),e);return isFunctionDefinition(s)&&(s=this.evaluateInFnTypeConfig(s,i,t,e)),r[0]=Math.round(2*s),r[0]}},{attrName:"aOpacity",symbolName:"lineOpacity",type:Uint8Array,width:1,define:"HAS_OPACITY",evaluate:(e,n)=>{let s=i(t.getZoom(),e);return isFunctionDefinition(s)&&(s=this.evaluateInFnTypeConfig(s,n,t,e)),r[0]=255*s,r[0]}}]}To(t){return this.hasIBL()?t.HAS_IBL_LIGHTING=1:delete t.HAS_IBL_LIGHTING,t}Ao(){if(!this.shader)return;const t=this.shader.shaderDefines;this.To(t),this.shader.shaderDefines=t}delete(){super.delete(),this.disposeIBLTextures(),this.shader&&(this.shader.dispose(),delete this.shader)}}const qo$1=[],Jo$1=[],Ko$1=[],Zo$1=[],Qo$1=[],ta=[0,0,0],ea=[0,0,0],na=[1,1,1],ia=[],ra=[1,1,1,1],sa=[],oa=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],aa=t=>class extends t{constructor(t,e,i,r,s,o){super(t,e,i,r,s,o),this.ko=!1,this.scene.sortFunction=this.sortByCommandKey,this.Oo=new Bt$6(t),this.Io(),this.Fo()}isAnimating(){const t=this.getSymbols();for(let e=0;e<t.length;e++)if(t[e]&&this.Co[e]&&this.Eo(e))return!0;return!1}createGeometry(t,e){const{data:n,positionSize:i}=t;return{geometry:{properties:Tt$3({},t.properties),data:n,positionSize:i,features:e},symbolIndex:t.symbolIndex}}getFnTypeConfig(){return ia}createMesh(t,e,{tileTranslationMatrix:s,tileExtent:o},{timestamp:a}){if(!this.ko)return null;const l=this.getMap(),{geometry:h}=t,{positionSize:u,features:c}=h,{aPosition:f,aPickingId:d,aXYRotation:p,aZRotation:m,aAltitude:y}=h.data,g=f.length/u;if(0===g)return null;const v={instance_vectorA:new Float32Array(4*g),instance_vectorB:new Float32Array(4*g),instance_vectorC:new Float32Array(4*g),aPickingId:[]},x=this.Do(v,s,o,h.properties.z,f,y,p,m,u,d,c);h.data.aTerrainAltitude&&(v.aTerrainAltitude=h.data.aTerrainAltitude);const b={};for(const t in v)b[t]={buffer:this.regl.buffer({dimension:v[t].length/g,data:v[t]}),divisor:1};const A=this.Ro(),w=this.Lo(),_=identity$2([]);scale$5(_,_,[w,w,w]);const S=[],M=this.getSymbols();for(let t=0;t<M.length;t++){const e=M[t],o=this.No[t];if(!o)continue;const u=this.Co[t][0],{fixSizeOnZoom:c}=e;let f=identity$2([]);A||(f=this.Ho(f));let d=0;o.forEach((t=>{const{geometry:n,nodeMatrix:i}=t;multiply$5(sa,oa,i),multiply$5(sa,f,sa);const s=multiply$5(sa,_,sa),o=n.boundingBox.copy();o.transform(s);const a=this.zo(o,e);Math.abs(a)>Math.abs(d)&&(d=a)}));const p=[0,0,d],m=o.map(((o,m)=>{const{geometry:y,materialInfo:A,morphWeights:w,extraInfo:S,nodeIndex:M}=o;e.alphaTest&&(A.alphaTest=e.alphaTest);const P=new(this.getMaterialClazz(A))(A),T={},k=new Ge$5(b,g,y,P,{transparent:!1,picking:!0});if(u.hasSkinAnimation()){const e=this.Vo(k,t,0)[M];k.setUniform("jointTexture",e.jointTexture),k.setUniform("jointTextureSize",e.jointTextureSize),k.setUniform("numJoints",e.numJoints),k.setUniform("skinAnimation",+this.Eo(t)),k.properties.startTime=a,T.HAS_SKIN=1}w&&(k.setUniform("morphWeights",w),T.HAS_MORPH=1),k.setUniform("hasAlpha",S.alphaMode&&"BLEND"===S.alphaMode.toUpperCase()),Ct$3(k.uniforms,"polygonFill",e,"markerFill",ra,Rt$3(this.colorCache)),Ct$3(k.uniforms,"polygonOpacity",e,"markerOpacity",1);const O=[];k.setPositionMatrix((()=>{const e=this.Uo(t,m,M);multiply$5(O,oa,e),this.Ho(f),multiply$5(O,f,O),multiply$5(O,_,O);const n=identity$2(sa);if(0!==d&&(fromTranslation$1(n,p),multiply$5(O,n,O)),Ht$2(c)){const t=l.getGLScale()/l.getGLScale(c);return set$4(qo$1,t,t,t),fromScaling(n,qo$1),multiply$5(n,n,O)}return O}));const I=this.layer.getRenderer().getZScale(),F=[],C=[];return k.setLocalTransform((()=>{const t=this.layer.options.altitude||0;return copy$4(C,x),C[2]+=100*t*I,translate$1(F,s,C),F})),y.generateBuffers(this.regl,{excludeElementsInVAO:!0}),v.instance_color&&(T.HAS_INSTANCE_COLOR=1),v.aTerrainAltitude&&(T.HAS_INSTANCE_TERRAIN_ALTITUDE=1,k.setUniform("terrainAltitudeScale",100*this.layer.getRenderer().getZScale())),T.HAS_LAYER_OPACITY=1,Tt$3(k.properties,h.properties),k.setDefines(T),k.properties.symbolIndex={index:t},k}));S.push(...m)}return S.insContext={instanceData:v,tileTranslationMatrix:s,tileExtent:o,aPosition:f,positionSize:u},S}Uo(t,e,n){const r=this.No[t][e];return this.Eo(t)&&this.jo&&this.jo[n]||r.nodeMatrix}Vo(t,e,n){if(!this.Co)return;const i=this.Co[e][0];this.Bo||(this.Bo={}),this.jo={},this.Bo[t.uuid]||(this.Bo[t.uuid]={});const r=this.getSymbols()[e],s=this.Go[e],{loop:o,speed:a,animationName:l}=r;return i.updateAnimation(n,o||!1,a||1,l||s.animations[0].name,t.properties.startTime||0,this.jo,this.Bo[t.uuid]),this.Bo[t.uuid]}zo(t,e){const n=e.anchorZ||"center";let i=0;const r=t.max[2]-t.min[2];return"bottom"===n?i=r/2:"top"===n&&(i=-r/2),i}addMesh(t,e,n){if(!t)return null;if(t[0].properties.level>2)return null;const i=n.timestamp;for(let e=0;e<t.length;e++){if(!t[e]||!t[e].geometry)continue;t[e].instancedData.aTerrainAltitude&&this.ji(t[e],t[e].instancedData,t[e].properties,3,n);const r=t[e].properties.symbolIndex.index,s=this.Eo(r);s&&this.Vo(t[e],r,i),t[e].setUniform("skinAnimation",+s)}return this.scene.addMesh(t),this}mr(t,e){t&&t.updateInstancedData&&t.updateInstancedData("aTerrainAltitude",e)}prepareRender(t){const e=this.getSymbols();let n=!1;for(let t=0;t<e.length;t++)if(e[t]&&this.Co[t]&&this.Eo(t)&&this.Co[t]&&!n){n=!0;break}n&&this.setToRedraw(!0),super.prepareRender(t)}getShadowMeshes(){return this.isVisible()?(this.shadowCount=this.scene.getMeshes().length,this.scene.getMeshes().filter((t=>0===t.properties.level))):ia}Eo(t){const e=this.getSymbols()[t];return!!(e&&e.animation&&this.Co[t]&&this.Co[t][0]&&this.Co[t][0].hasSkinAnimation())}Do(t,e,n,s,o,a,l,h,u,c,f){function d(e,n,i,r){t[e][4*n]=i[r],t[e][4*n+1]=i[r+4],t[e][4*n+2]=i[r+8],t[e][4*n+3]=i[r+12]}const p=o.length/u,m=this.layer.getTileSize().width/n*this.layer.getRenderer().getTileGLScale(s),y=this.layer.getRenderer().getZScale(),g=100*(this.dataConfig.altitudeOffset||0);let v=1/0,x=1/0,b=1/0,w=-1/0,_=-1/0,S=-1/0;const M=[],P=[];for(let t=0;t<p;t++){a?set$4(P,o[t*u],o[t*u+1],a[t]):Fa.unpackPosition(P,o[t*u],o[t*u+1],o[t*u+2]);const e=set$4(M,P[0]*m,-P[1]*m,(P[2]+g)*y);e[0]<v&&(v=e[0]),e[0]>w&&(w=e[0]),e[1]<x&&(x=e[1]),e[1]>_&&(_=e[1]),e[2]<b&&(b=e[2]),e[2]>S&&(S=e[2])}const T=(v+w)/2,k=(x+_)/2,O=(b+S)/2,I=[],F=this.Ro(),C=[0,0,1];for(let e=0;e<p;e++){a?set$4(P,o[e*u],o[e*u+1],a[e]):Fa.unpackPosition(P,o[e*u],o[e*u+1],o[e*u+2]);const n=P[0],s=P[1],p=set$4(M,n*m-T,-s*m-k,(P[2]+g)*y-O),v=l&&l[e]||0,x=h&&h[e]||0;if(v||x){fromRotation$1(I,x,C);const t=set$4(qo$1,n,s,0);rotate$1(I,I,v,normalize$4(t,cross$1(t,t,C)));multiply$5(I,fromTranslation$1(sa,p),I)}else fromTranslation$1(I,p);if(F){multiply$5(I,I,this.Ho(sa,f,c,e))}d("instance_vectorA",e,I,0),d("instance_vectorB",e,I,1),d("instance_vectorC",e,I,2),t.aPickingId[e]=e}return set$4(M,T,k,O),M}Lo(){if(!this.Wo){const t=this.getMap();this.Wo=100*lt$3(t.getGLRes(),t)}return this.Wo}Ho(t,e,n,r){const s=this.getMap(),o=this.symbolDef[0],a=this.Lo();let l=o.translationX||0,h=o.translationY||0,u=o.translationZ||0,c=o.rotationX||0,f=o.rotationY||0,d=o.rotationZ||0,p=o.scaleX||1,m=o.scaleY||1,y=o.scaleZ||1;const v=e&&e[n&&n[r]],x=s.getZoom(),b=v&&v.feature&&v.feature.properties,A=this.Xo(x,b);this.Yo&&(l=this.Yo(x,b)),this.$o&&(h=this.$o(x,b)),this.qo&&(u=this.qo(x,b));const w=set$4(Jo$1,l*a,h*a,u*a);this.Jo&&(c=this.Jo(x,b)),this.Ko&&(f=this.Ko(x,b)),this.Zo&&(d=this.Zo(x,b));const _=set$4(Ko$1,c,f,d);this.Qo&&(p=this.Qo(x,b)),this.ta&&(m=this.ta(x,b)),this.ea&&(y=this.ea(x,b));const S=set$4(Zo$1,p*A,m*A,y*A);return this.na(t,w,_,S)}Xo(t,e){const n=this.symbolDef[0];let i=this.ia?this.ia(t,e):n.modelHeight;if(rt$3(i))return 1;const r=this.ra[0];return i/Math.abs(r.max[1]-r.min[1])}getShaderConfig(){const t=super.getShaderConfig();return t.positionAttribute="POSITION",t.normalAttribute="NORMAL",t}init(t){super.init(t),this.Fo()}Io(){const t=this.symbolDef[0];isFunctionDefinition(t.modelHeight)&&(this.ia=interpolated(t.modelHeight)),isFunctionDefinition(t.translationX)&&(this.Yo=interpolated(t.translationX)),isFunctionDefinition(t.translationY)&&(this.$o=interpolated(t.translationY)),isFunctionDefinition(t.translationZ)&&(this.qo=interpolated(t.translationZ)),isFunctionDefinition(t.rotationX)&&(this.Jo=interpolated(t.rotationX)),isFunctionDefinition(t.rotationY)&&(this.Ko=interpolated(t.rotationY)),isFunctionDefinition(t.rotationZ)&&(this.Zo=interpolated(t.rotationZ)),isFunctionDefinition(t.scaleX)&&(this.Qo=interpolated(t.scaleX)),isFunctionDefinition(t.scaleY)&&(this.ta=interpolated(t.scaleY)),isFunctionDefinition(t.scaleZ)&&(this.ea=interpolated(t.scaleZ))}Ro(){return!!(this.ia&&!this.ia.isFeatureConstant||this.Yo&&!this.Yo.isFeatureConstant||this.$o&&!this.$o.isFeatureConstant||this.qo&&!this.qo.isFeatureConstant||this.Jo&&!this.Jo.isFeatureConstant||this.Ko&&!this.Ko.isFeatureConstant||this.Zo&&!this.Zo.isFeatureConstant||this.Qo&&!this.Qo.isFeatureConstant||this.ta&&!this.ta.isFeatureConstant||this.ea&&!this.ea.isFeatureConstant)}Fo(){if(this.Co)return;this.Co=[],this.Go=[],this.ra=[],this.No=[];const t=this.getSymbols();this.sa=0;for(let e=0;e<t.length;e++){const n=t[e].url||"pyramid";this.Oo.loginGLTF(n);const i=this.Oo.getGLTF(n);if(i.then)i.then((n=>{if(!n.gltfPack)return this.sa++,void(this.sa>=t.length&&(this.ko=!0,this.setToRedraw(!0)));const{gltfPack:i,json:r,bbox:s}=n;this.Co[e]=[i],this.No[e]=i.getMeshesInfo(),this.Go[e]=r,this.ra[e]=s,this.sa++,this.sa>=t.length&&(this.ko=!0),this.setToRedraw(!0)}));else{const{gltfPack:t,json:n,bbox:r}=i;t&&(this.Co[e]=[t],this.No[e]=t.getMeshesInfo(),this.Go[e]=n,this.ra[e]=r,this.sa++)}}this.sa>=t.length&&(this.ko=!0)}getPickingVert(){return"\n    attribute vec3 aPosition;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 modelMatrix;\n    uniform mat4 positionMatrix;\n    //fbo pickingvert\n    #include <fbo_picking_vert>\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        //gl_Positiondepth\n        fbo_picking_setData(gl_Position.w, true);\n    }"}deleteMesh(t){if(t){this.scene.removeMesh(t);for(let e=0;e<t.length;e++){const n=this.Bo&&this.Bo[t[e].uuid];if(n){for(const t in n)n[t].jointTexture&&n[t].jointTexture.destroy();delete this.Bo[t[e].uuid]}t[e].disposeInstanceData(),t[e].dispose()}}}delete(){super.delete();const t=this.getSymbols();for(let e=0;e<t.length;e++){this.Oo.logoutGLTF(t[e].url||"pyramid")}if(this.Bo){for(const t in this.Bo){const e=this.Bo[t];for(const t in e)e[t].jointTexture&&e[t].jointTexture.destroy()}delete this.Bo}delete this.jo}na(t,e,n,s){const o=set$4(qo$1,...e||ta),a=n||ea,l=s||na;return fromRotationTranslationScale(t,fromEuler(Qo$1,a[0],a[1],a[2]),o,l)}};class la extends(aa(Uo$1)){getMaterialClazz(t){return t.diffuseFactor?Le$5:Ie$5}}class ha extends(aa(Wo$1)){getMaterialClazz(t){return t.specularGlossinessTexture||t.diffuseTexture?fi$4.StandardSpecularGlossinessMaterial:fi$4.StandardMaterial}}const{getPBRUniforms:ua}=fi$4.PBRUtils,ca={color:[2.0303,2.028,2.028],direction:[0,-.2717,-1]},fa={index:0},da=[0,0,0],pa=[2,2];class ma extends Bi$1{supportRenderMode(t){return"fxaa"===t||"fxaaBeforeTaa"===t}needPolygonOffset(){return!0}isTerrainSkin(){return!1}isTerrainVector(){return!0}needToRedraw(){return!!super.needToRedraw()||this.getSymbol(fa).animation}createMesh(t,e){const{geometry:i}=t;i.generateBuffers(this.regl);const r=new Be$5(i,null,{castShadow:!1,picking:!0});return r.properties.symbolIndex=fa,r.setLocalTransform(e),r}callShader(t,e){super.callShader(t,e),this.transformWater();const n=this.oa(this.getMap(),e);this.Gi+=this.renderer.render(this.aa,n,this.la,this.getRenderFBO(e))}addMesh(t,e){this._r(t,e),super.addMesh(...arguments)}_r(t){const e=this.getSymbol(fa).ssr;for(let n=0;n<t.length;n++)t[n].ssr=e?1:0}paint(t){t.states&&t.states.includesChanged&&(this.shader.dispose(),this.aa.dispose(),this.br(t));const e=!!t.ssr&&this.getSymbol(fa).ssr,n=this.aa,i=n.shaderDefines;if(e){const e=Tt$3({},i,t.ssr.defines);n.shaderDefines=e}this.updateIBLDefines(n),this.ha.ssr=e?1:0,super.paint(t),e&&(n.shaderDefines=i)}init(t){this.createIBLTextures();this.renderer=new B$6(this.regl),this.createGround(),this.br(t),this.pickingFBO&&(this.picking=[new Cr$4(this.renderer,{vert:Gi$1,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:this.pickingViewport}},this.pickingFBO,this.getMap())]),this.ua()}ua(){const t=this.regl;this.ca||(this.ca=t.texture(2));const e=this.getSymbol({index:0}),n=e.texWaveNormal,i=this.getCachedTexture(n),r=this;if(i)this.fa||(i.isLoading?setTimeout((()=>{this.shader&&this.ua()}),20):this.fa=this.da(t,i));else{const e=new Image;e.isLoading=!0,e.onload=function(){delete this.isLoading,r.fa=r.da(t,this),r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave normal texture:"+n)},this.addCachedTexture(n,e),e.src=n}const s=e.texWavePerturbation,o=this.getCachedTexture(s);if(o)this.pa||(o.isLoading?setTimeout((()=>{this.ua()}),20):this.pa=this.da(t,o));else{const e=new Image;e.isLoading=!0,e.onload=function(){delete this.isLoading,r.pa=r.da(t,this),r.setToRedraw()},e.onerror=()=>{console.error("invalid water wave perturbation texture:"+s)},this.addCachedTexture(s,e),e.src=s}}da(t,e){return this.ca?t.texture({width:e.width,height:e.height,mag:"linear",min:"linear mipmap linear",wrapS:"repeat",wrapT:"repeat",flipY:!0,data:e}):null}br(t){const e=this.canvas,i=[],s=[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}},{name:"modelViewNormalMatrix",type:"function",fn:(t,e)=>{const n=multiply$5([],e.viewMatrix,e.modelMatrix),i=invert$2(n,n);return fromMat4$1([],transpose(i,i))}},{name:"modelViewMatrix",type:"function",fn:(t,e)=>multiply$5([],e.viewMatrix,e.modelMatrix)},{name:"uEnvironmentTransform",type:"function",fn:(t,e)=>fromRotation$2(i,Math.PI*(e.environmentOrientation||0)/180)}],o={TIME_NOISE_TEXTURE_REPEAT:.3737};this.fillIncludes(o,s,t);const a={x:0,y:0,width:()=>e?e.width:1,height:()=>e?e.height:1};this.shader=new vn$4({vert:"\n                attribute vec3 aPosition;\n\n                uniform mat4 projViewModelMatrix;\n\n                void main() {\n                    gl_Position = projViewModelMatrix * vec4(aPosition, 1.);\n                }\n            ",frag:"\n    #define SHADER_NAME WATER_STENCIL\n    precision mediump float;\n    void main() {\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){const n=[];return multiply$5(n,e.projViewMatrix,e.modelMatrix),n}}],extraCommandProps:{viewport:a,colorMask:[!1,!1,!1,!1],stencil:{enable:!0,mask:255,func:{cmp:"<=",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:this.sceneConfig.depthRange||[0,1],func:this.sceneConfig.depthFunc||"<="},polygonOffset:{enable:!0,offset:this.getPolygonOffset()}}});const h={viewport:a,stencil:{enable:!0,mask:255,func:{cmp:"==",ref:254,mask:255},op:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!1}};s.push(...jn$4.getUniformDeclares()),this.aa=new vn$4({vert:"#define SHADER_NAME WATER\nuniform mat4 modelMatrix;\nuniform mat4 projViewModelMatrix;\nattribute vec3 aPosition;\nattribute vec2 aTexCoord;\nuniform vec2 uvOffset;\nuniform vec2 noiseUvOffset;\nuniform vec2 uvScale;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\n#ifdef HAS_SSR\nuniform mat4 modelViewMatrix;\nvarying vec4 vViewVertex;\n#endif\n#include <highlight_vert>\nmat3 c(in vec3 d) {\n  vec3 t = normalize(cross(d, vec3(.0, 1., .0)));\n  vec3 e = normalize(cross(d, t));\n  return mat3(t, e, d);\n}\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_vert>\n#endif\nconst vec3 f = vec3(0., 0., 1.);\nvoid main(void) {\n  vec4 h = vec4(aPosition, 1.);\n  vec4 i = modelMatrix * h;\n  vPos = i.xyz;\n  vTbnMatrix = c(f);\n  gl_Position = projViewModelMatrix * h;\n  vUv = aTexCoord * uvScale + uvOffset;\n  vNoiseUv = aTexCoord * uvScale * TIME_NOISE_TEXTURE_REPEAT + noiseUvOffset;\n#ifdef HAS_SSR\nvec4 j = modelViewMatrix * h;\n  vViewVertex = j;\n#endif\n#if defined(HAS_SHADOWING)\nshadow_computeShadowPars(h);\n#endif\nhighlight_setVarying();\n}",frag:"#define SHADER_NAME WATER\nprecision highp float;\nprecision highp sampler2D;\n#include <hsv_frag>\nuniform vec3 hsv;\nuniform float contrast;\nuniform float layerOpacity;\n#if defined(HAS_SHADOWING)\n#include <vsm_shadow_frag>\n#endif\n#include <highlight_frag>\n#if defined(HAS_IBL_LIGHTING)\nuniform vec3 hdrHSV;\nuniform samplerCube prefilterMap;\nuniform sampler2D brdfLUT;\nuniform float rgbmRange;\nuniform mat3 uEnvironmentTransform;\nuniform vec3 diffuseSPH[9];\nvec3 c(const in vec3 d) {\n  vec3 e = uEnvironmentTransform * d;\n  float x = e.x;\n  float y = e.y;\n  float z = e.z;\n  vec3 f = (diffuseSPH[0] + diffuseSPH[1] * x + diffuseSPH[2] * y + diffuseSPH[3] * z + diffuseSPH[4] * z * x + diffuseSPH[5] * y * z + diffuseSPH[6] * y * x + diffuseSPH[7] * (3. * z * z - 1.) + diffuseSPH[8] * (x * x - y * y));\n  if(length(hdrHSV) > .0) {\n    f = hsv_apply(f, hdrHSV);\n  }\n  return max(f, vec3(.0));\n}\nvec3 h(const in vec3 i, const in float j, const in float k, const in float l) {\n  vec4 rgba = texture2D(brdfLUT, vec2(k, j));\n  float b = (rgba[3] * 65280.0 + rgba[2] * 255.);\n  float a = (rgba[1] * 65280.0 + rgba[0] * 255.);\n  const float m = 1. / 65535.;\n  return (i * a + b * l) * m;\n}\n#else\nuniform vec3 ambientColor;\n#endif\nstruct PBRShadingWater {\n  float NdotL;\n  float NdotV;\n  float NdotH;\n  float VdotH;\n  float LdotH;\n  float VdotN;\n};\nvec3 o(const in vec4 u, const in float v) {\n  if(v <= .0)\n    return u.rgb;\n  return v * u.rgb * u.a;\n}\n#ifdef HAS_SSR\nvarying vec4 vViewVertex;\nuniform mat3 modelViewNormalMatrix;\nuniform sampler2D TextureDepth;\nuniform highp vec2 outSize;\nuniform float ssrFactor;\nuniform float ssrQuality;\nuniform sampler2D TextureReflected;\nuniform highp mat4 projMatrix;\nuniform mat4 invProjMatrix;\nuniform vec4 outputFovInfo[2];\nuniform mat4 reprojViewProjMatrix;\nuniform vec2 cameraNearFar;\nfloat A(const in vec4 B) {\n  return B.r + B.g / 255.;\n}\nfloat C(const in vec2 D, const in float E) {\n  vec3 F = vec3(.06711056, .00583715, 52.9829189);\n  return fract(F.z * fract(dot(D.xy + E * vec2(47., 17.) * .695, F.xy))) * .5;\n}\nvec3 G(const in float H, const in float I, const in vec2 J) {\n  float K = min(I - .01, H);\n  float L = floor(K);\n  float M = min(I, L + 1.);\n  float N = pow(2., M);\n  vec2 O = 2. * N / J;\n  if(K - L > .5)\n    N *= 2.;\n  return vec3(O, N);\n}\nvec2 P(const in vec2 Q, const in vec3 R) {\n  vec2 S = max(R.xy, min(1. - R.xy, Q));\n  return vec2(2. * S.x, R.z - 1. - S.y) / R.z;\n}\nvec3 T(const in mat4 U, const in vec3 V) {\n  vec4 W = U * vec4(V, 1.);\n  return vec3(.5 + .5 * W.xy / W.w, W.w);\n}\nvec3 X(const in float Y, const in vec2 S) {\n  return texture2D(TextureReflected, S).rgb;\n}\nfloat Z(float ba) {\n  highp mat4 U = projMatrix;\n  highp float z = ba * 2. - 1.;\n  return -U[3].z / (z + U[2].z);\n}\nfloat bb(const vec2 S) {\n  float ba = A(texture2D(TextureDepth, S));\n  return ba;\n}\nvec3 bc(const in float E, const in vec3 bd, const in vec3 be, const in vec3 bf, const in vec3 bg, const in float bh) {\n  vec2 bi;\n  bi.x = C(gl_FragCoord.yx, E);\n  bi.y = fract(bi.x * 52.9829189);\n  bi.y = mix(bi.y, 1., .7);\n  float bj = 2. * 3.14159 * bi.x;\n  float bk = pow(max(bi.y, .000001), bh / (2. - bh));\n  float bl = sqrt(1. - bk * bk);\n  vec3 bm = vec3(bl * cos(bj), bl * sin(bj), bk);\n  bm = bm.x * bd + bm.y * be + bm.z * bf;\n  return normalize((2. * dot(bg, bm)) * bm - bg);\n}\nfloat bn(const in float E) {\n  return (C(gl_FragCoord.xy, E) - .5);\n}\nvec3 bo(const in vec3 bp, const in float bq, const in vec3 br) {\n  vec3 bs = T(projMatrix, vViewVertex.xyz + br * bq);\n  bs.z = 1. / bs.z;\n  bs -= bp;\n  float bt = min(1., .99 * (1. - bp.x) / max(1e-5, bs.x));\n  float bu = min(1., .99 * (1. - bp.y) / max(1e-5, bs.y));\n  float bv = min(1., .99 * bp.x / max(1e-5, -bs.x));\n  float bw = min(1., .99 * bp.y / max(1e-5, -bs.y));\n  return bs * min(bt, bu) * min(bv, bw);\n}\nfloat bx(const in vec3 bp, const in vec3 bs, inout float by, inout float bz) {\n  float bA = (bz + by) * .5;\n  vec3 bB = bp + bs * bA;\n  float z = bb(bB.xy);\n  float ba = Z(z);\n  float bC = -1. / bB.z;\n  by = ba > bC ? by : bA;\n  bz = ba > bC ? bA : bz;\n  return bA;\n}\nvec4 bD(const in vec3 bp, const in float bq, in float bE, const in vec3 br, const in float j, const in float E) {\n  const int bF = 20;\n  float bG = 1. / float(bF);\n  bE *= bG;\n  vec3 bs = bo(bp, bq, br);\n  float bH = bG;\n  vec3 bI = vec3(.0, bH, 1.);\n  vec3 bB;\n  float z, ba, bC, bJ, bK, bL;\n  bool bM;\n  float bN = 1.;\n  float bA;\n  for(int bO = 0; bO < bF; bO++) {\n    bB = bp + bs * bI.y;\n    z = bb(bB.xy);\n    ba = Z(z);\n    bC = -1. / bB.z;\n    bJ = bC - ba;\n    bJ *= clamp(sign(abs(bJ) - bq * bG * bG), .0, 1.);\n    bM = abs(bJ + bE) < bE;\n    bK = clamp(bI.x / (bI.x - bJ), .0, 1.);\n    bL = bM ? bI.y + bK * bG - bG : 1.;\n    bI.z = min(bI.z, bL);\n    bI.x = bJ;\n    if(bM) {\n      float by = bI.y - bG;\n      float bz = bI.y;\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bA = bx(bp, bs, by, bz);\n      bN = bA;\n      break;\n    }\n    bI.y += bG;\n  }\n  return vec4(bp + bs * bN, 1. - bN);\n}\nvec3 bP(in vec4 bQ, const in float bR, const in vec3 bS, const in vec3 bT, const in float j) {\n  vec4 bU = mix(outputFovInfo[0], outputFovInfo[1], bQ.x);\n  bQ.xyz = vec3(mix(bU.xy, bU.zw, bQ.y), 1.) * -1. / bQ.z;\n  bQ.xyz = (reprojViewProjMatrix * vec4(bQ.xyz, 1.)).xyw;\n  bQ.xy /= bQ.z;\n  float bV = clamp(6. - 6. * max(abs(bQ.x), abs(bQ.y)), .0, 1.);\n  bQ.xy = .5 + .5 * bQ.xy;\n  return vec3(bQ.xy, 1.);\n}\nvec3 ssr(const in vec3 bS, const in vec3 bT, const in float j, const in vec3 d, const in vec3 bg) {\n  float bW = .0;\n  vec4 f = vec4(.0);\n  float bh = j * j;\n  bh = bh * bh;\n  vec3 bX = abs(d.z) < .999 ? vec3(.0, .0, 1.) : vec3(1., .0, .0);\n  vec3 bd = normalize(cross(bX, d));\n  vec3 be = cross(d, bd);\n  float bR = ssrFactor * clamp(-4. * dot(bg, d) + 3.8, .0, 1.);\n  bR *= clamp(4.7 - j * 5., .0, 1.);\n  vec3 bp = T(projMatrix, vViewVertex.xyz);\n  bp.z = 1. / bp.z;\n  vec3 br = bc(bW, bd, be, d, bg, bh);\n  float bq = mix(cameraNearFar.y + vViewVertex.z, -vViewVertex.z - cameraNearFar.x, br.z * .5 + .5);\n  float bE = .5 * bq;\n  vec4 bQ;\n  if(dot(br, d) > .001 && bR > .0) {\n    bQ = bD(bp, bq, bE, br, j, bW);\n    if(bQ.w > .0)\n      return bP(bQ, bR, bS, bT, j);\n    \n  }\n  return vec3(.0);\n}\n#endif\nconst vec3 bY = vec3(0., 0., 1.);\nuniform mat4 viewMatrix;\nuniform sampler2D normalTexture;\nuniform sampler2D heightTexture;\nuniform vec4 waveParams;\nuniform vec2 waterDir;\nuniform vec4 waterBaseColor;\nuniform vec3 lightDirection;\nuniform vec3 lightColor;\nuniform vec3 camPos;\nuniform float timeElapsed;\nvarying vec2 vUv;\nvarying vec2 vNoiseUv;\nvarying vec3 vPos;\nvarying mat3 vTbnMatrix;\nfloat bZ(vec3 e, float ca) {\n  float cb = max(.015, ca);\n  return max((e.x + e.y) * .3303545 / cb + .3303545, .0);\n}\nconst vec2 cc = vec2(6. / 25., 5. / 24.);\nvec2 cd(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rg - 1.;\n}\nfloat cf(vec2 S) {\n  return texture2D(heightTexture, S).b;\n}\nvec3 cg(sampler2D ce, vec2 S) {\n  return 2. * texture2D(ce, S).rgb - 1.;\n}\nfloat ch(vec2 S, float ci) {\n  return fract(ci);\n}\nfloat cj(vec2 S, float ci) {\n  float ck = ch(S, ci);\n  return 1. - abs(1. - 2. * ck);\n}\nvec3 cl(sampler2D cm, vec2 S, float ci, float cn) {\n  float co = waveParams[2];\n  float cp = waveParams[3];\n  vec2 cq = cd(cm, S) * co;\n  float ck = ch(S, ci + cn);\n  float cr = cj(S, ci + cn);\n  vec2 f = S;\n  f -= cq * (ck + cp);\n  f += cn;\n  f += (ci - ck) * cc;\n  return vec3(f, cr);\n}\nconst float cs = 7.77;\nvec3 ct(sampler2D cu, sampler2D cv, vec2 cw, vec2 cx, float ci) {\n  float ca = waveParams[0];\n  vec2 cy = ci * -cx;\n  float cz = cf(vNoiseUv) * cs;\n  vec3 cA = cl(cv, cw + cy, ci + cz, .0);\n  vec3 cB = cl(cv, cw + cy, ci + cz, .5);\n  vec3 cC = cg(cu, cA.xy) * cA.z;\n  vec3 cD = cg(cu, cB.xy) * cB.z;\n  vec3 cE = normalize(cC + cD);\n  cE.xy *= ca;\n  cE.z = sqrt(1. - dot(cE.xy, cE.xy));\n  return cE;\n}\nvec4 cF(vec2 cw, float cG) {\n  float cH = waveParams[1];\n  vec3 d = ct(normalTexture, heightTexture, cw * cH, waterDir, cG);\n  float cI = bZ(d, waveParams[0]);\n  return vec4(d, cI);\n}\nconst float cJ = 3.141592653589793;\nconst float cK = 1. / cJ;\nconst float cL = .3183098861837907;\nconst float cM = 1.570796326794897;\nconst float cN = .4;\nfloat cO = 2.2;\nvec3 cP(float cQ, vec3 cR, float l) {\n  return cR + (l - cR) * pow(1. - cQ, 5.);\n}\nfloat cS(float cT, float j) {\n  float cU = j * j;\n  float cV = cT * cT;\n  float cW = pow((cV * (cU - 1.) + 1.), cO) * cJ;\n  return cU / cW;\n}\nfloat cX(float cY) {\n  return .25 / (cY * cY);\n}\nvec3 cZ(const vec3 x) {\n  return (x * (2.51 * x + .03)) / (x * (2.43 * x + .59) + .14);\n}\nconst float da = 2.2;\nconst float db = .4545454545;\nvec4 dc(vec4 u) {\n  return vec4(pow(u.rgb, vec3(db)), u.w);\n}\nvec3 dd(vec3 u) {\n  return pow(u, vec3(da));\n}\nconst vec3 de = vec3(.02, 1., 5.);\nconst vec2 df = vec2(.02, .1);\nconst float j = .06;\nconst float dg = 1.7;\nconst vec3 dh = vec3(0, .6, .9);\nconst vec3 di = vec3(.72, .92, 1.);\nconst float dj = .65;\nconst float dk = 300000.0;\nconst float dl = 500000.0;\nconst float dm = .775;\nconst float dn = .8;\nPBRShadingWater dp;\nvec3 dq(in PBRShadingWater dr, float j, vec3 ds, float dt) {\n  vec3 du = cP(dr.VdotH, ds, dt);\n  float dv = cS(dr.NdotH, j);\n  float dw = cX(dr.LdotH);\n  float dx = mix(j + .045, j + .385, 1. - dr.VdotH);\n  float dy = 1.2;\n  float dz = cS(dr.NdotH, dx) * dy;\n  return ((dv + dz) * dw) * du;\n}\nvec3 dA(float dg, float dB, vec3 dh, float dC) {\n  return dg * (.075 * dh * pow(dB, 4.) + 50. * pow(dB, 23.)) * dC;\n}\nvec3 dD(in float bk, in vec3 dE, in vec3 dF) {\n  float dG = pow((1. - bk), de[2]);\n  return mix(dF, dE, dG);\n}\nvec3 dH(in vec3 e, in vec3 dI, in float dJ, in float j) {\n  \n#ifdef HAS_IBL_LIGHTING\nvec3 dK = reflect(-dI, e);\n  vec4 dL = textureCube(prefilterMap, uEnvironmentTransform * dK);\n  float dM = clamp(1. + dot(dK, e), .0, 1.);\n  dL *= dM * dM;\n  vec3 i = o(dL, rgbmRange);\n  vec3 dN = c(e);\n  float l = clamp(50.0 * waterBaseColor.g, .0, 1.);\n  vec3 dO = h(waterBaseColor.rgb, j, dot(e, dI), l);\n  return i * dO + dN;\n#else\nvec3 dP = dd(di);\n  vec3 dQ = dd(dh);\n  vec3 di = dD(dJ, dP, dQ);\n  return di;\n#endif\n}\nvec3 dR(in vec3 e, in vec3 dI, in vec3 dS, vec3 u, in vec3 dT, in vec3 dU, in float dV, float dW, vec3 dX) {\n  float dY = 0.;\n  vec3 dZ = dd(u);\n  vec3 bm = normalize(dS + dI);\n  dp.NdotL = clamp(dot(e, dS), .0, 1.);\n  dp.NdotV = clamp(dot(e, dI), .001, 1.);\n  dp.VdotN = clamp(dot(dI, e), .001, 1.);\n  dp.NdotH = clamp(dot(e, bm), .0, 1.);\n  dp.VdotH = clamp(dot(dI, bm), .0, 1.);\n  dp.LdotH = clamp(dot(dS, bm), .0, 1.);\n  float dJ = max(dot(dU, dI), .0);\n  vec3 di = dH(e, dI, dJ, j);\n  float ea = max(dot(dU, dS), .0);\n  float eb = .1 + ea * .9;\n  di *= eb;\n  float ec = clamp(dV, .8, 1.);\n  vec3 ed = cP(dp.VdotN, vec3(de[0]), de[1]);\n  vec3 ee = ed * di * ec;\n  vec3 ef = dZ * mix(di, ea * dT * cK, 2. / 3.) * ec;\n  vec3 i = vec3(.0);\n  if(dJ > .0 && ea > .0) {\n    vec3 eg = dq(dp, j, vec3(df[0]), df[1]);\n    vec3 eh = dT * cK * dV;\n    i = dp.NdotL * eh * eg;\n  }\n  vec3 cI = vec3(.0);\n  if(dJ > .0) {\n    cI = dA(dg, dW, dh, eb);\n  }\n  vec3 ei = vec3(.0);\n#ifdef HAS_SSR\nfloat ej = smoothstep(dl, dk, -dX.z);\n  mat4 ek = viewMatrix;\n  vec4 el = vec4(dX.xyz, 1.);\n  vec3 em = normalize(el.xyz);\n  vec4 en = ek * vec4(e, .0);\n  vec3 eo = normalize(en.xyz);\n  vec4 ep = ek * vec4(dU, .0);\n  float eq = pow(max(dot(-em, ep.xyz), .0), cN);\n  vec3 er = mix(ep.xyz, eo, eq);\n  vec3 es = ssr(vec3(.0), vec3(1.), j, normalize(er), -normalize(vViewVertex.xyz));\n  if(es.z > .0) {\n    vec2 et = smoothstep(.3, .6, abs(vec2(.5) - es.xy));\n    dY = dm * clamp(1. - 1.3 * et.y, .0, 1.) * ej;\n    vec3 eu = X(.0, es.xy);\n    ei = dd(eu) * dY * ed.y * dj;\n  }\n#endif\nfloat ev = mix(dn, dn * .5, dY);\n  return cZ((1. - dY) * ee + ei + ef * ev + i + cI);\n}\nvoid main() {\n  vec3 dU = bY;\n  vec4 ew = cF(vUv, timeElapsed);\n  vec3 e = normalize(vTbnMatrix * ew.xyz);\n  vec3 dI = -normalize(vPos - camPos);\n  vec3 dS = normalize(-lightDirection);\n#if defined(HAS_SHADOWING)\nfloat dV = shadow_computeShadow();\n#else\nfloat dV = 1.;\n#endif\nvec4 ex = viewMatrix * vec4(vPos, 1.);\n  vec4 ey = vec4(dR(e, dI, dS, waterBaseColor.rgb, lightColor, dU, dV, ew.w, ex.xyz), waterBaseColor.a);\n  gl_FragColor = dc(ey);\n  if(contrast != 1.) {\n    gl_FragColor = contrastMatrix(contrast) * gl_FragColor;\n  }\n  if(length(hsv) > .0) {\n    gl_FragColor = hsv_apply(gl_FragColor, hsv);\n  }\n  gl_FragColor = highlight_blendColor(gl_FragColor) * layerOpacity;\n}",defines:o,uniforms:s,extraCommandProps:h})}needClearStencil(){return!0}getUniformValues(t){return{projViewMatrix:t.projViewMatrix}}oa(t,e){const{iblTexes:n,dfgLUT:i}=this.getIBLRes(),r=ua(t,n,i,e&&e.ssr,e&&e.jitter),s=t.getLightManager();let o=s&&s.getDirectionalLight()||{};const l=s&&s.getAmbientLight()||{},h=this.getSymbol(fa),u=this.ma=this.ma||[],c=this.ya=this.ya||[];set$3(c,.09,h.uvScale||3,.03,-.5),Tt$3(r,{ambientColor:l.color||[.2,.2,.2],viewMatrix:t.viewMatrix,lightDirection:o.direction||ca.direction,lightColor:o.color||ca.color,camPos:t.cameraPosition,timeElapsed:h.animation?(this.layer.getRenderer().getFrameTimestamp()||0)/(1/(h.waterSpeed||1)*1e4):0,normalTexture:this.fa||this.ca,heightTexture:this.pa||this.ca,waveParams:c,waterDir:ya(u,h.waterDirection||0),waterBaseColor:h.waterBaseColor||[.1451,.2588,.4863,1],contrast:h.contrast||1,hsv:h.hsv||da});const f=this.layer.getRenderer();return r.layerOpacity=f.ne(),this.setIncludeUniformValues(r,e),e&&e.ssr&&e.ssr.renderUniforms&&Tt$3(r,e.ssr.renderUniforms),r}delete(){super.delete(),this.ca&&(this.ca.destroy(),delete this.ca),this.fa&&this.fa.destroy(),this.pa&&this.pa.destroy(),this.shader&&(this.shader.dispose(),delete this.shader),this.aa&&this.aa.dispose(),this.ha&&(this.ha.geometry.dispose(),this.ha.material&&this.ha.material.dispose(),this.ha.dispose(),delete this.ha),this.disposeIBLTextures()}createGround(){const t=new tn$5;t.data.aTexCoord=new Uint8Array([0,1,1,1,0,0,1,0]),t.generateBuffers(this.renderer.regl),this.ha=new Be$5(t,null,{castShadow:!1}),this.la=new Ke$5([this.ha])}transformWater(){const t=this.getMap(),e=jt$4.getGroundTransform(this.ha.localTransform,t);this.ha.setLocalTransform(e);const n=t._get2DExtentAtRes(t.getGLRes()),i=n.getWidth(),r=n.getHeight(),o=t.cameraLookAt,h=(o[0]-i)/pa[0],u=(o[1]+r)/pa[1],d=.3737*h%1,p=.3737*u%1,m=i/pa[0]*2,y=r/pa[1]*2;this.ha.setUniform("uvOffset",[h%1,u%1]),this.ha.setUniform("noiseUvOffset",[d,p]),this.ha.setUniform("uvScale",[m,-y])}}function ya(t,e){return e=Math.PI*e/180,t[0]=Math.sin(e),t[1]=Math.cos(e),t}const ga=ei$1("fill",nr$2);ga.registerAt(he$2);const va=ei$1("line",or$2);va.registerAt(he$2);const xa=ei$1("line-gradient",ar$2);xa.registerAt(he$2);const ba=ei$1("icon",Es$1);ba.registerAt(he$2);const Aa=ei$1("text",xo$1);Aa.registerAt(he$2);const wa=ei$1("native-line",To$1);wa.registerAt(he$2),ei$1("native-point",So$1).registerAt(he$2);const _a=ei$1("phong",Uo$1);_a.registerAt(he$2);const Sa=ei$1("wireframe",Bo$1);Sa.registerAt(he$2);const Ma=ei$1("lit",Wo$1);Ma.registerAt(he$2);const Pa=ei$1("tube",$o$1);Pa.registerAt(he$2);const Ta=ei$1("gltf-phong",la);Ta.registerAt(he$2);const ka=ei$1("gltf-lit",ha);ka.registerAt(he$2);const Oa=ei$1("heatmap",class extends Bi$1{createFnTypeConfig(t,e){const n=interpolated(e.heatmapWeight),i=new Int16Array(1);return[{attrName:"aWeight",symbolName:"heatmapWeight",type:Int16Array,width:1,define:"HAS_HEAT_WEIGHT",evaluate:e=>{const r=n(t.getZoom(),e);return i[0]=255*r,i[0]}}]}createMesh(t,e){const{geometry:i,symbolIndex:r,ref:s}=t;void 0===s&&si$1(i,this.getSymbolDef(r),this.getFnTypeConfig(r));const o=this.getSymbol(r),a={tileRatio:i.properties.tileRatio,dataResolution:i.properties.tileResolution};Ct$3(a,"heatmapIntensity",o,"heatmapIntensity",1),Ct$3(a,"heatmapRadius",o,"heatmapRadius",6),Ct$3(a,"heatmapWeight",o,"heatmapWeight",1),Ct$3(a,"heatmapOpacity",o,"heatmapOpacity",1),i.generateBuffers(this.regl);const l=new Ce$5(a),h=new Be$5(i,l,{transparent:!0,castShadow:!1,picking:!0}),u={};return i.data.aWeight&&(u.HAS_HEAT_WEIGHT=1),h.setDefines(u),h.setLocalTransform(e),h.properties.symbolIndex=r,h}callRenderer(t,e,n){const i=this.getRenderFBO(n);this.Gi+=this.ga.render(this.scene,e,i)}getUniformValues(t){const e=this.getSymbol({index:0}),{projViewMatrix:n}=t;return{glScale:1/t.getGLScale(),resolution:t.getResolution(),projViewMatrix:n,heatmapOpacity:e.heatmapOpacity}}getHeatmapMeshes(){return this.scene.getMeshes()}delete(){super.delete(...arguments),this.ga.dispose(),delete this.ga}init(){this.renderer=new B$6(this.regl);const e=this.getPolygonOffset(),i=this.getSymbols()[0];this.ga=new $s$2(this.regl,this.sceneConfig,this.layer,i.heatmapColor,null,e)}});Oa.registerAt(he$2);const Ia=ei$1("water",ma);if(Ia.registerAt(he$2),we$2.registerPainter("lit",Wo$1),we$2.registerPainter("icon",Es$1),we$2.registerPainter("fill",nr$2),we$2.registerPainter("line",or$2),we$2.registerPainter("line-gradient",ar$2),we$2.registerPainter("water",ma),we$2.registerPainter("tube",$o$1),on$5.register("vt_position_vert","#ifdef HAS_TERRAIN_ALTITUDE\n    attribute float aTerrainAltitude;\n#endif\nuniform float minAltitude;\n#ifdef HAS_ALTITUDE\n    vec3 unpackVTPosition() {\n        float altitude = aAltitude;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(aPosition, altitude);\n    }\n#else\n    float position_modValue = 16384.0;\n    float position_delta = 0.00001;\n    vec3 unpackVTPosition() {\n        float z = aPosition.z;\n        vec2 pos = sign(aPosition.xy + position_delta) * mod(abs(aPosition.xy), position_modValue);\n        vec2 highs = floor(abs(aPosition.xy) / position_modValue);\n        float altitude = sign(z + position_delta) * (highs.x * 2.0 + highs.y) * pow(2.0, 15.0) + z;\n        #ifdef HAS_TERRAIN_ALTITUDE\n            altitude += aTerrainAltitude * 100.0;\n        #endif\n        altitude += minAltitude * 100.0;\n        return vec3(pos, altitude);\n    }\n#endif"),he$2.VERSION="0.92.3",we$2.VERSION="0.92.3",create$5(),transcoders){const n=t__namespace.Map.VERSION;if(n.indexOf("1.0.0-beta")>=0||n.indexOf("1.0.0-alpha")>=0){const n=transcoders.inject(q$4);t__namespace.registerWorkerAdapter("@maptalks/vt",n)}else t__namespace.registerWorkerAdapter("@maptalks/vt",(function(){return transcoders.inject(q$4)}))}else t__namespace.registerWorkerAdapter("@maptalks/vt",q$4);"undefined"!=typeof console&&console.log("@maptalks/vt v0.92.3");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes$1=[],i$1=0;i$1<6;i$1++)planes$1[i$1]=[];var p$4=[];function intersectsBox$1(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes$1[i];if(p$4[0]=plane[0]>0?box[1][0]:box[0][0],p$4[1]=plane[1]>0?box[1][1]:box[0][1],p$4[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint$1(plane,p$4)<0)return!1}return!0}function intersectsPlane(plane,box){var center=box,halfAxes=box,normalX=plane[0],normalY=plane[1],normalZ=plane[2],radEffective=Math.abs(normalX*halfAxes[3]+normalY*halfAxes[6]+normalZ*halfAxes[9])+Math.abs(normalX*halfAxes[4]+normalY*halfAxes[7]+normalZ*halfAxes[10])+Math.abs(normalX*halfAxes[5]+normalY*halfAxes[8]+normalZ*halfAxes[11]),distanceToPlane=distanceToPoint$1(plane,center);return!(distanceToPlane<=-radEffective)}function setPlanes$1(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents$1(planes$1[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents$1(planes$1[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents$1(planes$1[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents$1(planes$1[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents$1(planes$1[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents$1(planes$1[5],me3+me2,me7+me6,me11+me10,me15+me14)}function setComponents$1(out,x,y,z,w){var inverseNormalLength=1/Math.sqrt(x*x+y*y+z*z);return out[0]=x*inverseNormalLength,out[1]=y*inverseNormalLength,out[2]=z*inverseNormalLength,out[3]=w*inverseNormalLength,out}function distanceToPoint$1(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/3dtiles v0.95.7
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */const T$3='function(t){var e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t}function r(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function s(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],f=e[7],h=e[8],l=e[9],d=e[10],y=e[11],m=e[12],b=e[13],p=e[14],w=e[15],g=n[0],v=n[1],M=n[2],T=n[3];return t[0]=g*r+v*a+M*h+T*m,t[1]=g*s+v*c+M*l+T*b,t[2]=g*i+v*u+M*d+T*p,t[3]=g*o+v*f+M*y+T*w,g=n[4],v=n[5],M=n[6],T=n[7],t[4]=g*r+v*a+M*h+T*m,t[5]=g*s+v*c+M*l+T*b,t[6]=g*i+v*u+M*d+T*p,t[7]=g*o+v*f+M*y+T*w,g=n[8],v=n[9],M=n[10],T=n[11],t[8]=g*r+v*a+M*h+T*m,t[9]=g*s+v*c+M*l+T*b,t[10]=g*i+v*u+M*d+T*p,t[11]=g*o+v*f+M*y+T*w,g=n[12],v=n[13],M=n[14],T=n[15],t[12]=g*r+v*a+M*h+T*m,t[13]=g*s+v*c+M*l+T*b,t[14]=g*i+v*u+M*d+T*p,t[15]=g*o+v*f+M*y+T*w,t}function i(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function o(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function a(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,u=n*o,f=r*o,h=r*a,l=s*o,d=s*a,y=s*c,m=i*o,b=i*a,p=i*c;return t[0]=1-h-y,t[1]=f+p,t[2]=l-b,t[3]=0,t[4]=f-p,t[5]=1-u-y,t[6]=d+m,t[7]=0,t[8]=l+b,t[9]=d-m,t[10]=1-u-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function c(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function u(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function f(t){var e=t[0],n=t[1],r=t[2];return Math.sqrt(e*e+n*n+r*r)}function h(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function l(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function d(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function y(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function m(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function b(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function p(t,e){var n=e[0],r=e[1],s=e[2],i=n*n+r*r+s*s;return i>0&&(i=1/Math.sqrt(i),t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i),t}function w(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function g(t,e,n){var r=e[0],s=e[1],i=e[2],o=n[0],a=n[1],c=n[2];return t[0]=s*c-i*a,t[1]=i*o-r*c,t[2]=r*a-s*o,t}function v(t,e,n){var r=e[0],s=e[1],i=e[2],o=n[3]*r+n[7]*s+n[11]*i+n[15];return o=o||1,t[0]=(n[0]*r+n[4]*s+n[8]*i+n[12])/o,t[1]=(n[1]*r+n[5]*s+n[9]*i+n[13])/o,t[2]=(n[2]*r+n[6]*s+n[10]*i+n[14])/o,t}var M=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},T=m,A=f;function _(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function O(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}function x(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function S(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function I(t,e,n,r){var s=e[0],i=e[1],o=e[2],a=e[3],c=n[0],u=n[1],f=n[2],h=n[3],l=void 0,d=void 0,y=void 0,m=void 0,b=void 0;return(d=s*c+i*u+o*f+a*h)<0&&(d=-d,c=-c,u=-u,f=-f,h=-h),1-d>1e-6?(l=Math.acos(d),y=Math.sin(l),m=Math.sin((1-r)*l)/y,b=Math.sin(r*l)/y):(m=1-r,b=r),t[0]=m*s+b*c,t[1]=m*i+b*u,t[2]=m*o+b*f,t[3]=m*a+b*h,t}u(),function(){var t,n=(t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var k,E=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};u(),h(1,0,0),h(0,1,0),x(),x(),k=new e(9),e!=Float32Array&&(k[1]=0,k[2]=0,k[3]=0,k[5]=0,k[6]=0,k[7]=0),k[0]=1,k[4]=1,k[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.95.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.org\n   */\nlet C=0;function U(t){return null==t}function F(t){return!U(t)}function N(t){return!U(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function P(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function B(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function D(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function R(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const L=[],z=[],j=[],V=[0,0,0],q=S([]),G=[1,1,1];function $(t,e,n,r,s,i,o){const a=B(o);if((0===s||s===r*a.BYTES_PER_ELEMENT)&&i%a.BYTES_PER_ELEMENT==0){const s=new a(e,i,n*r);return t.set(s),t}0===s&&(s=r*a.BYTES_PER_ELEMENT);const c=new Uint8Array(r*a.BYTES_PER_ELEMENT);for(let o=0;o<n;o++){let n=null;const u=new Uint8Array(e,s*o+i,r*a.BYTES_PER_ELEMENT);c.set(u),n=new a(c.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const X="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function H(t,e,n){const r=new Uint8Array(t,e,n);return X.decode(r)}const J={get:function(t,e={}){e||(e={});const n=new AbortController,r=n.signal,s=P({},e);s.signal=r,s.method||(s.method="GET");const i=fetch(t,s).then(t=>{const n=this.t(t,e.responseType);return n.message?n:n.then(n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t})}).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t});return i.xhr=n,i},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",J.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?J.jsonp(t):((e=e||{}).responseType="json",J.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+C++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise(t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)})}};class K{constructor(t,e,n,r){this.s=t,this.decoders=e,this.i=n,this.images={},this.o={},this.u=r||{}}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)}if(this.o[t.id])return this.o[t.id].then(()=>{const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)});if(D(t.uri)){const r=this.buffers[t.id]=R(t.uri),s=this.h(e,r);return this.getImageByBuffer(s,n)}let r;const s=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.o[t.id]=J.getArrayBuffer(r,this.u).then(r=>{const s=this.buffers[t.id]=r.data,i=this.h(e,s);return this.getImageByBuffer(i,n)})}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.i}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.m(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.o[t.id]?this.o[t.id].then(()=>this.images[t.id]):this.o[t.id]=this.m(t.id,e)}m(t,e){return new Promise((n,r)=>{this.s(e,this.u,(s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))})})}}const Y=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],Q=[];class W{constructor(t,e,n,r){this.rootPath=t,this.gltf=e,this.p=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.v(),this.u=r}M(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this.T(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.A(s).then(n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this.T(t,e,s,i)})}A(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then(()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})});if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(D(e.uri)){const t=this.buffers[e.id]=R(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=J.getArrayBuffer(t,this.u).then(r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0}))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}T(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},a=(o.byteOffset||0)+r,c=this._(i.type),u=B(i.componentType),f=o.byteStride||0,h={array:void 0,name:t,accessorName:e,byteLength:i.count*c*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:c,max:i.max,min:i.min,extensions:i.extensions};if(i.min&&(h.min=i.min),i.max&&(h.max=i.max),n)if(this.p)h.byteStride=f,h.byteOffset=a+(i.byteOffset||0),!f||f===c*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(h.array=this.O(n,i.count,c,a+(i.byteOffset||0),u),h.array.buffer.byteLength===h.byteLength&&(h.byteOffset=0)):h.array=new Uint8Array(n,a,o.byteLength);else if(i.interleaved){h.byteStride=0,h.byteOffset=0;const t=new u(i.count*c);if(h.array=$(t,n,i.count,c,f,a+(i.byteOffset||0),i.componentType),h.extensions&&h.extensions.WEB3D_quantized_attributes&&c>2){const t=new Float32Array(h.array.length),{decodeMatrix:e}=h.extensions.WEB3D_quantized_attributes;for(let n=0;n<h.array.length;n+=c){Q[0]=h.array[n],Q[1]=h.array[n+1],Q[2]=h.array[n+2],Q[3]=1;const r=O(Q,Q,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}h.componentType=5126,h.array=t}}else h.byteStride=0,h.array=this.O(n,i.count,c,a+(i.byteOffset||0),u),h.byteOffset=h.array.byteOffset;else{h.array=new u(i.count);const t=h.min||h.max;t&&(h.array[0]=t[0],h.array[1]=t[1],h.array[2]=t[2])}return h}v(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}O(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}_(t){const e=Y.indexOf(t);return Y[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map(t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.A(e).then(r=>{const{buffer:s,byteOffset:i}=r,o=H(s,i+(e.byteOffset||0),n);return t.content=o,t})}if(t.uri){if(D(t.uri)){const e=R(t.uri),n=H(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return J.get(e,this.u).then(e=>(t.content=e,t))}}return Promise.resolve(t)});return Promise.all(n).then(()=>t)}}class Z extends K{constructor(t,e,n,r,s,i,o){super(r,s,i,o),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new W(t,e,n,o)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(F(t.name)&&(e.name=t.name),F(t.children)&&(e.children=t.children),F(t.jointName)&&(e.jointName=t.jointName),F(t.matrix)&&(e.matrix=t.matrix),F(t.rotation)&&(e.rotation=t.rotation),F(t.scale)&&(e.scale=t.scale),F(t.translation)&&(e.translation=t.translation),F(t.extras)&&(e.extras=t.extras),F(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const n=i(L,e.translation||V),r=a(z,e.rotation||q),c=o(j,e.scale||G);return s(c,r,c),s(t,n,c)}return r(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}S(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}I(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}k(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.I(n).then(t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}})}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}class tt extends K{constructor(t,e,n,r,s,i,o){super(r,s,i,o),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new W(t,e,n,o)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return P(e,t),!F(t.weights)&&this.gltf.meshes&&F(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}k(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!F(n))return null;const r=this.gltf.images[n];return this.I(r).then(t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};P(n,e);const s=F(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return s&&(n.sampler=s,n.sampler.magFilter=s.magFilter||9729,n.sampler.minFilter=s.minFilter||9729,n.sampler.wrapS=s.wrapS||10497,n.sampler.wrapT=s.wrapT||10497),t.format&&(n.format=t.format),n})}I(t){if(!F(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.C(e,t)}return null}C(t,e){const n=this.h(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}h(t,e,n){n=n||0;const r=t.byteOffset+n,s=t.byteLength;return new Uint8Array(e,r,s)}U(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);return n.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)))}getAnimations(t){const e=[];return t.forEach(t=>{e.push(this.getSamplers(t.samplers))}),Promise.all(e).then(e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t})}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(F(t[n].input)||F(t[n].output))&&(e.push(this.accessor.M("input",t[n].input)),e.push(this.accessor.M("output",t[n].output)));return Promise.all(e).then(e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t})}}const et="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class nt{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return nt.readV1(r,e);if(2===s)return nt.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const s=rt(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o<i.byteLength;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,1313821514===c)n=rt(t,e+12+o,a);else if(5130562===c){s=e+12+o,r=a;break}o+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function rt(t,e,n){if(et){const r=new Uint8Array(t,e,n);return et.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=st[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const st=[1,1,1,1,2,2,3,0],it=[0,0,0],ot=[0,0,0,1],at=[1,1,1],ct={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},ut={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},ft={F(t,e,n,r,s,i,o,a){const c=F(t)?e.animations:[e.animations[0]],u={};for(let e=0;e<c.length;e++){const f=c[e],h=f.name||e;if(F(t)&&h!==t)continue;const d=f.channelsMap[n];if(d)for(let t=0;t<d.length;t++){const e=d[t];"translation"===e.target.path?(this.N(s,f.samplers[e.sampler],r,1),u.translation=l(it,s)):"rotation"===e.target.path?(this.P(i,f.samplers[e.sampler],r,1),u.rotation=E(ot,i)):"scale"===e.target.path?(this.N(o,f.samplers[e.sampler],r,1),u.scale=l(at,o)):"weights"===e.target.path&&a&&(this.N(a,f.samplers[e.sampler],r,a.length),u.weights=a)}}return u},N(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.B(ut,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.B(ut,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.B(ut,e,n,3*r);s&&(t=this.D(t,s,e.input.array,3*r));break}}return t},P(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.B(ut,e,n,1);r&&I(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.B(ut,e,n,1);r&&(t=_(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.B(ut,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.D(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},R(t,e){const n=t.length;let r,s,i,o=0,a=n-1,c=Math.floor((o+a)/2);for(;o<=n-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const n=t[c];return r=c,s=c+1,i=(e-n)/(t[c+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},B(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const a=this.R(s,n);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:u,interpolation:f}=a;t.PREINDEX=c,t.NEXTINDEX=u,t.INTERPOLATION=f;const h=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*h,(t.PREINDEX+1)*h),t.NEXT=i.subarray(t.NEXTINDEX*h,(t.NEXTINDEX+1)*h),t},D(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const a=e.PREVIOUS[r+n],c=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],f=(o-i)*e.NEXT[n],h=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*a+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*f;t[n]=h}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return d(it,...ct.TRANSLATION),_(ot,...ct.ROTATION),d(at,...ct.SCALE),this.F(r,t,e,n,it,ot,at,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}}),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?F(e)?n[e]:n[Object.keys(n)[0]]:null}};let ht=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(Qe){}t&&"undefined"!=typeof createImageBitmap&&(ht=!0)}const lt="undefined"==typeof document?null:document.createElement("canvas");class dt{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.u=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=nt.read(e.buffer,e.byteOffset,e.byteLength);this.L(t,n,r)}else this.L(t,e);this.j=new W(this.rootPath,this.gltf,this.glbBuffer,this.u),this.V()}V(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}q(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.j.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then(e=>(t.KHR_techniques_webgl=e,t)):Promise.resolve(t)}load(t){t=t||{};const e=this.G(t),n=this.$(),r=this.X(),s=this.q();return Promise.all([e,n,r,s]).then(t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0]))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return ft.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return ft.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return B(t)}static readInterleavedArray(t,e,n,r,s,i,o){return $(t,e,n,r,s,i,o)}L(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=ht?pt.bind(this):this.options.requestImage||yt,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new tt(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.u),this.adapter.iterate((t,e,n)=>{e.id="buffer_"+n},"buffers"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors")):(this.adapter=new Z(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.u),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"))}H(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||N(t.children[0])))return t;const r=t.children.map(t=>{const n=e[t];return n.nodeIndex=t,this.H(n,e)});t.children=r}var n;return t}G(t){return this.J(t).then(t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.H(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map(e=>t[e])),this.gltf.scene===r&&(n=i),e.push(o)},"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.S(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r})}J(t){return this.K(t).then(()=>{const t=this.nodes={};return this.adapter.iterate((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r},"nodes"),t})}Y(){this.skins=[];const t=[];return this.adapter.iterate((e,n,r)=>{t.push(this.W(n).then(t=>{t.index=r,this.skins.push(t)}))},"skins"),t}W(t){const e=t.inverseBindMatrices;return this.adapter.accessor.M("inverseBindMatrices",e).then(e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t))}$(){const t=this.gltf.animations;return F(t)?this.adapter.getAnimations(t):null}K(t){this.meshes={};let e=[];return this.adapter.iterate((n,r,s)=>{e.push(this.Z(r,t).then(t=>{t.index=s,this.meshes[n]=t}))},"meshes"),e=e.concat(this.Y()),Promise.all(e)}Z(t,e){const n=t.primitives.map(t=>this.tt(t,e)).filter(t=>!!t);return Promise.all(n).then(e=>{const n={};return P(n,t),n.primitives=e,n})}X(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.k(n));return Promise.all(e).then(e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t].image.array;if(e[t]&&n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e})}tt(t,e){let n;const r=[],s=t.extensions;if(F(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor.M(`morphTargets_${t}_${e}`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,a=this.gltf.bufferViews[i],c=this.j.A(a).then(n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i}=a;const c=a.byteLength;i||(i=0);const u=new DataView(r,s+i,c),f={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,f).then(t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e})});r.push(c),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.M(t,e[t]);n&&r.push(n)}if(F(t.indices)){const e=this.adapter.accessor.M("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then(e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;b(t,t,s),y(t,t,i),b(n,n,s),y(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t},{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=F(t.mode)?t.mode:4,F(t.extras)&&(i.extras=t.extras),i})}}function yt(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!lt)return void n(new Error("There is no canvas to draw image!"));lt.width=r.width,lt.height=r.height;const t=lt.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),s={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,s)},r.onerror=function(t){n(t)},r.src=t}let mt,bt;function pt(t,e,n){mt||(mt=new OffscreenCanvas(2,2),bt=mt.getContext("2d",{willReadFrequently:!0}));let r=null;if(N(t))r=fetch(t,e).then(t=>t.arrayBuffer()).then(t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)});else{const e=new Blob([t]);r=createImageBitmap(e)}r.then(wt.bind(this)).then(t=>{n(null,t)}).catch(t=>{console.warn(t),n(t)})}function wt(t){let{width:e,height:n}=t;gt(e)||(e=vt(e)),gt(n)||(n=vt(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),mt.width=e,mt.height=n,bt.drawImage(t,0,0,e,n),t.close();const s=bt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(s.data)}}function gt(t){return 0==(t&t-1)&&0!==t}function vt(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}var Mt={exports:{}},Tt={"aliceblue":[240,248,255],"antiquewhite":[250,235,215],"aqua":[0,255,255],"aquamarine":[127,255,212],"azure":[240,255,255],"beige":[245,245,220],"bisque":[255,228,196],"black":[0,0,0],"blanchedalmond":[255,235,205],"blue":[0,0,255],"blueviolet":[138,43,226],"brown":[165,42,42],"burlywood":[222,184,135],"cadetblue":[95,158,160],"chartreuse":[127,255,0],"chocolate":[210,105,30],"coral":[255,127,80],"cornflowerblue":[100,149,237],"cornsilk":[255,248,220],"crimson":[220,20,60],"cyan":[0,255,255],"darkblue":[0,0,139],"darkcyan":[0,139,139],"darkgoldenrod":[184,134,11],"darkgray":[169,169,169],"darkgreen":[0,100,0],"darkgrey":[169,169,169],"darkkhaki":[189,183,107],"darkmagenta":[139,0,139],"darkolivegreen":[85,107,47],"darkorange":[255,140,0],"darkorchid":[153,50,204],"darkred":[139,0,0],"darksalmon":[233,150,122],"darkseagreen":[143,188,143],"darkslateblue":[72,61,139],"darkslategray":[47,79,79],"darkslategrey":[47,79,79],"darkturquoise":[0,206,209],"darkviolet":[148,0,211],"deeppink":[255,20,147],"deepskyblue":[0,191,255],"dimgray":[105,105,105],"dimgrey":[105,105,105],"dodgerblue":[30,144,255],"firebrick":[178,34,34],"floralwhite":[255,250,240],"forestgreen":[34,139,34],"fuchsia":[255,0,255],"gainsboro":[220,220,220],"ghostwhite":[248,248,255],"gold":[255,215,0],"goldenrod":[218,165,32],"gray":[128,128,128],"green":[0,128,0],"greenyellow":[173,255,47],"grey":[128,128,128],"honeydew":[240,255,240],"hotpink":[255,105,180],"indianred":[205,92,92],"indigo":[75,0,130],"ivory":[255,255,240],"khaki":[240,230,140],"lavender":[230,230,250],"lavenderblush":[255,240,245],"lawngreen":[124,252,0],"lemonchiffon":[255,250,205],"lightblue":[173,216,230],"lightcoral":[240,128,128],"lightcyan":[224,255,255],"lightgoldenrodyellow":[250,250,210],"lightgray":[211,211,211],"lightgreen":[144,238,144],"lightgrey":[211,211,211],"lightpink":[255,182,193],"lightsalmon":[255,160,122],"lightseagreen":[32,178,170],"lightskyblue":[135,206,250],"lightslategray":[119,136,153],"lightslategrey":[119,136,153],"lightsteelblue":[176,196,222],"lightyellow":[255,255,224],"lime":[0,255,0],"limegreen":[50,205,50],"linen":[250,240,230],"magenta":[255,0,255],"maroon":[128,0,0],"mediumaquamarine":[102,205,170],"mediumblue":[0,0,205],"mediumorchid":[186,85,211],"mediumpurple":[147,112,219],"mediumseagreen":[60,179,113],"mediumslateblue":[123,104,238],"mediumspringgreen":[0,250,154],"mediumturquoise":[72,209,204],"mediumvioletred":[199,21,133],"midnightblue":[25,25,112],"mintcream":[245,255,250],"mistyrose":[255,228,225],"moccasin":[255,228,181],"navajowhite":[255,222,173],"navy":[0,0,128],"oldlace":[253,245,230],"olive":[128,128,0],"olivedrab":[107,142,35],"orange":[255,165,0],"orangered":[255,69,0],"orchid":[218,112,214],"palegoldenrod":[238,232,170],"palegreen":[152,251,152],"paleturquoise":[175,238,238],"palevioletred":[219,112,147],"papayawhip":[255,239,213],"peachpuff":[255,218,185],"peru":[205,133,63],"pink":[255,192,203],"plum":[221,160,221],"powderblue":[176,224,230],"purple":[128,0,128],"rebeccapurple":[102,51,153],"red":[255,0,0],"rosybrown":[188,143,143],"royalblue":[65,105,225],"saddlebrown":[139,69,19],"salmon":[250,128,114],"sandybrown":[244,164,96],"seagreen":[46,139,87],"seashell":[255,245,238],"sienna":[160,82,45],"silver":[192,192,192],"skyblue":[135,206,235],"slateblue":[106,90,205],"slategray":[112,128,144],"slategrey":[112,128,144],"snow":[255,250,250],"springgreen":[0,255,127],"steelblue":[70,130,180],"tan":[210,180,140],"teal":[0,128,128],"thistle":[216,191,216],"tomato":[255,99,71],"turquoise":[64,224,208],"violet":[238,130,238],"wheat":[245,222,179],"white":[255,255,255],"whitesmoke":[245,245,245],"yellow":[255,255,0],"yellowgreen":[154,205,50]},At={exports:{}},_t=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},Ot=Array.prototype.concat,xt=Array.prototype.slice,St=At.exports=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var s=t[n];_t(s)?e=Ot.call(e,xt.call(s)):e.push(s)}return e};St.wrap=function(t){return function(){return t(St(arguments))}};var It=Tt,kt=At.exports,Et=Object.hasOwnProperty,Ct=Object.create(null);for(var Ut in It)Et.call(It,Ut)&&(Ct[It[Ut]]=Ut);var Ft=Mt.exports={to:{},get:{}};function Nt(t,e,n){return Math.min(Math.max(e,t),n)}function Pt(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}Ft.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=Ft.get.hsl(t),n="hsl";break;case"hwb":e=Ft.get.hwb(t),n="hwb";break;default:e=Ft.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},Ft.get.rgb=function(t){if(!t)return null;var e,n,r,s=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=e[2],e=e[1],n=0;n<3;n++){var i=2*n;s[n]=parseInt(e.slice(i,i+2),16)}r&&(s[3]=parseInt(r,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(e=e[1])[3],n=0;n<3;n++)s[n]=parseInt(e[n]+e[n],16);r&&(s[3]=parseInt(r+r,16)/255)}else if(e=t.match(/^rgba?\\(\\s*([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)(?=[\\s,])\\s*(?:,\\s*)?([+-]?\\d+)\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)){for(n=0;n<3;n++)s[n]=parseInt(e[n+1],0);e[4]&&(e[5]?s[3]=.01*parseFloat(e[4]):s[3]=parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\\(\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*,?\\s*([+-]?[\\d\\.]+)\\%\\s*(?:[,|\\/]\\s*([+-]?[\\d\\.]+)(%?)\\s*)?\\)$/)))return(e=t.match(/^(\\w+)$/))?"transparent"===e[1]?[0,0,0,0]:Et.call(It,e[1])?((s=It[e[1]])[3]=1,s):null:null;for(n=0;n<3;n++)s[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(e[5]?s[3]=.01*parseFloat(e[4]):s[3]=parseFloat(e[4]))}for(n=0;n<3;n++)s[n]=Nt(s[n],0,255);return s[3]=Nt(s[3],0,1),s},Ft.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\\(\\s*([+-]?(?:\\d{0,3}\\.)?\\d+)(?:deg)?\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*,?\\s*([+-]?[\\d\\.]+)%\\s*(?:[,|\\/]\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,Nt(parseFloat(e[2]),0,100),Nt(parseFloat(e[3]),0,100),Nt(isNaN(n)?1:n,0,1)]}return null},Ft.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\\(\\s*([+-]?\\d{0,3}(?:\\.\\d+)?)(?:deg)?\\s*,\\s*([+-]?[\\d\\.]+)%\\s*,\\s*([+-]?[\\d\\.]+)%\\s*(?:,\\s*([+-]?(?=\\.\\d|\\d)(?:0|[1-9]\\d*)?(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)\\s*)?\\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,Nt(parseFloat(e[2]),0,100),Nt(parseFloat(e[3]),0,100),Nt(isNaN(n)?1:n,0,1)]}return null},Ft.to.hex=function(){var t=kt(arguments);return"#"+Pt(t[0])+Pt(t[1])+Pt(t[2])+(t[3]<1?Pt(Math.round(255*t[3])):"")},Ft.to.rgb=function(){var t=kt(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},Ft.to.rgb.percent=function(){var t=kt(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},Ft.to.hsl=function(){var t=kt(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},Ft.to.hwb=function(){var t=kt(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},Ft.to.keyword=function(t){return Ct[t.slice(0,3)]};var Bt={exports:{}},Dt=Tt,Rt={};for(var Lt in Dt)Dt.hasOwnProperty(Lt)&&(Rt[Dt[Lt]]=Lt);var zt=Bt.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var jt in zt)if(zt.hasOwnProperty(jt)){if(!("channels"in zt[jt]))throw new Error("missing channels property: "+jt);if(!("labels"in zt[jt]))throw new Error("missing channel labels property: "+jt);if(zt[jt].labels.length!==zt[jt].channels)throw new Error("channel and label counts mismatch: "+jt);var Vt=zt[jt].channels,qt=zt[jt].labels;delete zt[jt].channels,delete zt[jt].labels,Object.defineProperty(zt[jt],"channels",{value:Vt}),Object.defineProperty(zt[jt],"labels",{value:qt})}function Gt(t,e){return Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2)+Math.pow(t[2]-e[2],2)}zt.rgb.hsl=function(t){var e,n,r=t[0]/255,s=t[1]/255,i=t[2]/255,o=Math.min(r,s,i),a=Math.max(r,s,i),c=a-o;return a===o?e=0:r===a?e=(s-i)/c:s===a?e=2+(i-r)/c:i===a&&(e=4+(r-s)/c),(e=Math.min(60*e,360))<0&&(e+=360),n=(o+a)/2,[e,100*(a===o?0:n<=.5?c/(a+o):c/(2-a-o)),100*n]},zt.rgb.hsv=function(t){var e,n,r,s,i,o=t[0]/255,a=t[1]/255,c=t[2]/255,u=Math.max(o,a,c),f=u-Math.min(o,a,c),h=function(t){return(u-t)/6/f+.5};return 0===f?s=i=0:(i=f/u,e=h(o),n=h(a),r=h(c),o===u?s=r-n:a===u?s=1/3+e-r:c===u&&(s=2/3+n-e),s<0?s+=1:s>1&&(s-=1)),[360*s,100*i,100*u]},zt.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[zt.rgb.hsl(t)[0],100*(1/255*Math.min(e,Math.min(n,r))),100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},zt.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,s=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-s)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-s-e)/(1-e)||0),100*e]},zt.rgb.keyword=function(t){var e=Rt[t];if(e)return e;var n,r=1/0;for(var s in Dt)if(Dt.hasOwnProperty(s)){var i=Gt(t,Dt[s]);i<r&&(r=i,n=s)}return n},zt.keyword.rgb=function(t){return Dt[t]},zt.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},zt.rgb.lab=function(t){var e=zt.rgb.xyz(t),n=e[0],r=e[1],s=e[2];return r/=100,s/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},zt.hsl.rgb=function(t){var e,n,r,s,i,o=t[0]/360,a=t[1]/100,c=t[2]/100;if(0===a)return[i=255*c,i,i];e=2*c-(n=c<.5?c*(1+a):c+a-c*a),s=[0,0,0];for(var u=0;u<3;u++)(r=o+1/3*-(u-1))<0&&r++,r>1&&r--,i=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e,s[u]=255*i;return s},zt.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,s=n,i=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,s*=i<=1?i:2-i,[e,100*(0===r?2*s/(i+s):2*n/(r+n)),100*((r+n)/2)]},zt.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,s=Math.floor(e)%6,i=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*i),c=255*r*(1-n*(1-i));switch(r*=255,s){case 0:return[r,c,o];case 1:return[a,r,o];case 2:return[o,r,c];case 3:return[o,a,r];case 4:return[c,o,r];case 5:return[r,o,a]}},zt.hsv.hsl=function(t){var e,n,r,s=t[0],i=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-i)*o,n=i*a,[s,100*(n=(n/=(e=(2-i)*a)<=1?e:2-e)||0),100*(r/=2)]},zt.hwb.rgb=function(t){var e,n,r,s,i,o,a,c=t[0]/360,u=t[1]/100,f=t[2]/100,h=u+f;switch(h>1&&(u/=h,f/=h),r=6*c-(e=Math.floor(6*c)),0!=(1&e)&&(r=1-r),s=u+r*((n=1-f)-u),e){default:case 6:case 0:i=n,o=s,a=u;break;case 1:i=s,o=n,a=u;break;case 2:i=u,o=n,a=s;break;case 3:i=u,o=s,a=n;break;case 4:i=s,o=u,a=n;break;case 5:i=n,o=u,a=s}return[255*i,255*o,255*a]},zt.cmyk.rgb=function(t){var e=t[0]/100,n=t[1]/100,r=t[2]/100,s=t[3]/100;return[255*(1-Math.min(1,e*(1-s)+s)),255*(1-Math.min(1,n*(1-s)+s)),255*(1-Math.min(1,r*(1-s)+s))]},zt.xyz.rgb=function(t){var e,n,r,s=t[0]/100,i=t[1]/100,o=t[2]/100;return n=-.9689*s+1.8758*i+.0415*o,r=.0557*s+-.204*i+1.057*o,e=(e=3.2406*s+-1.5372*i+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},zt.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},zt.lab.xyz=function(t){var e,n,r,s=t[0];e=t[1]/500+(n=(s+16)/116),r=n-t[2]/200;var i=Math.pow(n,3),o=Math.pow(e,3),a=Math.pow(r,3);return n=i>.008856?i:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},zt.lab.lch=function(t){var e,n=t[0],r=t[1],s=t[2];return(e=360*Math.atan2(s,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+s*s),e]},zt.lch.lab=function(t){var e,n=t[0],r=t[1];return e=t[2]/360*2*Math.PI,[n,r*Math.cos(e),r*Math.sin(e)]},zt.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],s=1 in arguments?arguments[1]:zt.rgb.hsv(t)[2];if(0===(s=Math.round(s/50)))return 30;var i=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===s&&(i+=60),i},zt.hsv.ansi16=function(t){return zt.rgb.ansi16(zt.hsv.rgb(t),t[2])},zt.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},zt.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},zt.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},zt.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},zt.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},zt.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,s=t[2]/255,i=Math.max(Math.max(n,r),s),o=Math.min(Math.min(n,r),s),a=i-o;return e=a<=0?0:i===n?(r-s)/a%6:i===r?2+(s-n)/a:4+(n-r)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},zt.hsl.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=1,s=0;return(r=n<.5?2*e*n:2*e*(1-n))<1&&(s=(n-.5*r)/(1-r)),[t[0],100*r,100*s]},zt.hsv.hcg=function(t){var e=t[1]/100,n=t[2]/100,r=e*n,s=0;return r<1&&(s=(n-r)/(1-r)),[t[0],100*r,100*s]},zt.hcg.rgb=function(t){var e=t[0]/360,n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var s,i=[0,0,0],o=e%1*6,a=o%1,c=1-a;switch(Math.floor(o)){case 0:i[0]=1,i[1]=a,i[2]=0;break;case 1:i[0]=c,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=a;break;case 3:i[0]=0,i[1]=c,i[2]=1;break;case 4:i[0]=a,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=c}return s=(1-n)*r,[255*(n*i[0]+s),255*(n*i[1]+s),255*(n*i[2]+s)]},zt.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},zt.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},zt.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},zt.hwb.hcg=function(t){var e=t[1]/100,n=1-t[2]/100,r=n-e,s=0;return r<1&&(s=(n-r)/(1-r)),[t[0],100*r,100*s]},zt.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},zt.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},zt.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},zt.gray.hsl=zt.gray.hsv=function(t){return[0,0,t[0]]},zt.gray.hwb=function(t){return[0,100,t[0]]},zt.gray.cmyk=function(t){return[0,0,0,t[0]]},zt.gray.lab=function(t){return[t[0],0,0]},zt.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},zt.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var $t=Bt.exports;function Xt(t){var e=function(){for(var t={},e=Object.keys($t),n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var r=n.pop(),s=Object.keys($t[r]),i=s.length,o=0;o<i;o++){var a=s[o],c=e[a];-1===c.distance&&(c.distance=e[r].distance+1,c.parent=r,n.unshift(a))}return e}function Ht(t,e){return function(n){return e(t(n))}}function Jt(t,e){for(var n=[e[t].parent,t],r=$t[e[t].parent][t],s=e[t].parent;e[s].parent;)n.unshift(e[s].parent),r=Ht($t[e[s].parent][s],r),s=e[s].parent;return r.conversion=n,r}var Kt=Bt.exports,Yt=function(t){for(var e=Xt(t),n={},r=Object.keys(e),s=r.length,i=0;i<s;i++){var o=r[i];null!==e[o].parent&&(n[o]=Jt(o,e))}return n},Qt={};Object.keys(Kt).forEach((function(t){Qt[t]={},Object.defineProperty(Qt[t],"channels",{value:Kt[t].channels}),Object.defineProperty(Qt[t],"labels",{value:Kt[t].labels});var e=Yt(t);Object.keys(e).forEach((function(n){var r=e[n];Qt[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,s=0;s<r;s++)n[s]=Math.round(n[s]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),Qt[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)}))}));var Wt=Qt,Zt=Mt.exports,te=Wt,ee=[].slice,ne=["keyword","gray","hex"],re={};Object.keys(te).forEach((function(t){re[ee.call(te[t].labels).sort().join("")]=t}));var se={};function ie(t,e){if(!(this instanceof ie))return new ie(t,e);if(e&&e in ne&&(e=null),e&&!(e in te))throw new Error("Unknown model: "+e);var n,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof ie)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var s=Zt.get(t);if(null===s)throw new Error("Unable to parse color from string: "+t);this.model=s.model,r=te[this.model].channels,this.color=s.value.slice(0,r),this.valpha="number"==typeof s.value[r]?s.value[r]:1}else if(t.length){this.model=e||"rgb",r=te[this.model].channels;var i=ee.call(t,0,r);this.color=ue(i,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in re))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=re[a];var c=te[this.model].labels,u=[];for(n=0;n<c.length;n++)u.push(t[c[n]]);this.color=ue(u)}if(se[this.model])for(r=te[this.model].channels,n=0;n<r;n++){var f=se[this.model][n];f&&(this.color[n]=f(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function oe(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(se[t]||(se[t]=[]))[e]=n})),t=t[0],function(r){var s;return arguments.length?(n&&(r=n(r)),(s=this[t]()).color[e]=r,s):(s=this[t]().color[e],n&&(s=n(s)),s)}}function ae(t){return function(e){return Math.max(0,Math.min(t,e))}}function ce(t){return Array.isArray(t)?t:[t]}function ue(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}function fe(t){return null==t}function he(t){return"object"==typeof t&&!!t}function le(t){return t/Math.PI*180}function de(t){return Math.sign?Math.sign(t):0===(t=+t)||isNaN(t)?Number(t):t>0?1:-1}ie.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in Zt.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return Zt.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return Zt.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=te[this.model].channels,n=te[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new ie(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new ie(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:oe("rgb",0,ae(255)),green:oe("rgb",1,ae(255)),blue:oe("rgb",2,ae(255)),hue:oe(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:oe("hsl",1,ae(100)),lightness:oe("hsl",2,ae(100)),saturationv:oe("hsv",1,ae(100)),value:oe("hsv",2,ae(100)),chroma:oe("hcg",1,ae(100)),gray:oe("hcg",2,ae(100)),white:oe("hwb",1,ae(100)),wblack:oe("hwb",2,ae(100)),cyan:oe("cmyk",0,ae(100)),magenta:oe("cmyk",1,ae(100)),yellow:oe("cmyk",2,ae(100)),black:oe("cmyk",3,ae(100)),x:oe("xyz",0,ae(100)),y:oe("xyz",1,ae(100)),z:oe("xyz",2,ae(100)),l:oe("lab",0,ae(100)),a:oe("lab",1),b:oe("lab",2),keyword:function(t){return arguments.length?new ie(t):te[this.model].keyword(this.color)},hex:function(t){return arguments.length?new ie(t):Zt.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return ie.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error(\'Argument to "mix" was not a Color instance, but rather an instance of \'+typeof t);var n=t.rgb(),r=this.rgb(),s=void 0===e?.5:e,i=2*s-1,o=n.alpha()-r.alpha(),a=((i*o==-1?i:(i+o)/(1+i*o))+1)/2,c=1-a;return ie.rgb(a*n.red()+c*r.red(),a*n.green()+c*r.green(),a*n.blue()+c*r.blue(),n.alpha()*s+r.alpha()*(1-s))}},Object.keys(te).forEach((function(t){if(-1===ne.indexOf(t)){var e=te[t].channels;ie.prototype[t]=function(){if(this.model===t)return new ie(this);if(arguments.length)return new ie(arguments,t);var n="number"==typeof arguments[e]?e:this.valpha;return new ie(ce(te[this.model][t].raw(this.color)).concat(n),t)},ie[t]=function(n){return"number"==typeof n&&(n=ue(ee.call(arguments),e)),new ie(n,t)}}}));const ye=[1,1,1,1,2,2,3,0];function me(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=ye[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}new Array(3),new Array(3);const be=[1/6378137,1/6378137,1/6356752.314245179],pe=[1/40680631590769,1/40680631590769,1/40408299984661.445],we=new Array(3),ge=new Array(3),ve=new Array(3);function Me(t,e){const n=pe,r=function(t,e,n,r,s){const i=e[0],o=e[1],a=e[2],c=n[0],u=n[1],f=n[2],h=i*i*c*c,l=o*o*u*u,d=a*a*f*f,y=h+l+d,m=Math.sqrt(1/y),p=b(Te,e,m);if(y<s)return isFinite(m)?p:void 0;const w=r[0],g=r[1],v=r[2],M=Ae;M[0]=p[0]*w*2,M[1]=p[1]*g*2,M[2]=p[2]*v*2;let T,A,_,O,x,S,I,k,E,C,U,F=(1-m)*_e(e)/(.5*_e(M)),N=0;do{F-=N,_=1/(1+F*w),O=1/(1+F*g),x=1/(1+F*v),S=_*_,I=O*O,k=x*x,E=S*_,C=I*O,U=k*x,T=h*S+l*I+d*k-1,A=h*E*w+l*C*g+d*U*v;N=T/(-2*A)}while(Math.abs(T)>1e-12);return t[0]=i*_,t[1]=o*O,t[2]=a*x,t}(we,e,be,n,.1);let s=T(ge,r,n);s=function(t,e){const n=e[0],r=e[1],s=e[2];let i=n*n+r*r+s*s;i>0&&(i=Math.sqrt(i),t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i);return t}(s,s);const i=M(ve,e,r),o=Math.atan2(s[1],s[0]),a=Math.asin(s[2]),c=de(w(i,e))*_e(i);return t[0]=le(o),t[1]=le(a),t[2]=c,t}const Te=new Array(3),Ae=new Array(3);function _e(t){return f(t)}function Oe(t,e,n,r){n=n||0,r=r||n;const s=Math.abs(t-e);return s<=r||s<=n*Math.max(Math.abs(t),Math.abs(e))}function xe(t,e){let n="";for(let r=0;r<4;r++){const s=t.getUint8(e+r);n+=String.fromCharCode(s)}return n}const Se="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function Ie(t,e,n){const r=new Uint8Array(t,e,n);return Se?JSON.parse(Se.decode(r)):JSON.parse(me(r))}function ke(t,e,n){const r=new Uint8Array(t,e,n);return Se?JSON.parse(Se.decode(r)):JSON.parse(me(r))}function Ee(t,e,n){return{offset:e,byteLength:n}}function Ce(t,e,n,r){const{byteOffset:s,componentType:i,type:o}=t,{ctor:a,type:c}=function(t){return Ne[t]}(i||"UNSIGNED_SHORT"),u=function(t){if(!t)return 1;return Fe[t]}(o);return{byteStride:0,byteOffset:s+n,itemSize:u,count:r*u,componentType:c,array:new a(e,n+s,r*u)}}function Ue(t,e,n,r){const s=Ce(t,e,n,r);return s.array.buffer.byteLength!==e.byteLength&&(s.array=s.array.slice()),s}const Fe={"SCALAR":1,"VEC2":2,"VEC3":3,"VEC4":4};const Ne={"BYTE":{ctor:Int8Array,type:5120,name:"Int8Array"},"UNSIGNED_BYTE":{ctor:Uint8Array,type:5121,name:"Uint8Array"},"SHORT":{ctor:Int16Array,type:5122,name:"Int16Array"},"UNSIGNED_SHORT":{ctor:Uint16Array,type:5123,name:"Uint16Array"},"INT":{ctor:Int32Array,type:5124,name:"Int32Array"},"UNSIGNED_INT":{ctor:Uint32Array,type:5125,name:"Uint32Array"},"FLOAT":{ctor:Float32Array,type:5126,name:"Float32Array"},"DOUBLE":{ctor:Float64Array,type:5126,name:"Float64Array"}};function Pe(t){for(const e in Ne)if(t===Ne[e].ctor)return Ne[e].type;throw new Error("unrecognized ctor:"+t)}function Be(t,e,n,r){const s=t,i=e.length/3;for(let t=0;t<i;t++)s[3*t]=e[3*t]/65535*r[0]+n[0],s[3*t+1]=e[3*t+1]/65535*r[1]+n[1],s[3*t+2]=e[3*t+2]/65535*r[2]+n[2];return s}function De(t,e,n){const r=t.getUint32(12,!0),s=t.getUint32(16,!0),i=t.getUint32(20,!0),o=t.getUint32(24,!0),a=t.buffer;let c,u={},f={},h=null;r>0&&(u=Ie(a,e,r),e+=r),s>0&&(c=function(t,e,n){return{offset:e,byteLength:n}}(0,e,s),e+=s),i>0&&(f=ke(a,e,i),e+=i);const l=Ee(0,e,o);return h=a.slice(l.offset,l.offset+l.byteLength),n.push(h),{featureTable:u,featureTableBin:c,batchTable:f,batchTableBin:h}}const Re={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Le={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},ze={},je={east:[],north:[],up:[],west:[],south:[],down:[]};let Ve=[],qe=[],Ge=[];const $e=[0,0,0];const Xe=function(t,e){const n=Re[t][e];let r;const s=t+e;return ze[s]?r=ze[s]:(r=function(r,s,i){if(function(t,e){var n=t[0],r=t[1],s=t[2],i=e[0],o=e[1],a=e[2];return Math.abs(n-i)<=1e-6*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(r-o)<=1e-6*Math.max(1,Math.abs(r),Math.abs(o))&&Math.abs(s-a)<=1e-6*Math.max(1,Math.abs(s),Math.abs(a))}(r,$e))l(Ve,Le[t]),l(qe,Le[e]),l(Ge,Le[n]);else if(Oe(r[0],0,1e-14)&&Oe(r[1],0,1e-14)){const s=de(r[2]);l(Ve,Le[t]),"east"!==t&&"west"!==t&&b(Ve,Ve,s),l(qe,Le[e]),"east"!==e&&"west"!==e&&b(qe,qe,s),l(Ge,Le[n]),"east"!==n&&"west"!==n&&b(Ge,Ge,s)}else{!function(t,e){m(e,t,pe),p(e,e)}(r,je.up);const s=je.up,i=je.east;i[0]=-r[1],i[1]=r[0],i[2]=0,p(je.east,i),g(je.north,s,i),b(je.down,je.up,-1),b(je.west,je.east,-1),b(je.south,je.north,-1),Ve=je[t],qe=je[e],Ge=je[n]}return i[0]=Ve[0],i[1]=Ve[1],i[2]=Ve[2],i[3]=0,i[4]=qe[0],i[5]=qe[1],i[6]=qe[2],i[7]=0,i[8]=Ge[0],i[9]=Ge[1],i[10]=Ge[2],i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i},ze[s]=r),r}("east","north"),He={5120:Int8Array,5122:Int16Array,5124:Int32Array,5121:Uint8Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array};function Je(t){for(const e in He)if(t===He[e])return+e;throw new Error("unrecognized ctor:"+t)}\n/*!\n   * @maptalks/gl v0.95.6\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.com\n   */const Ke=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},Ye=Ke(),Qe=Ye.gl_trans__coders=Ye.gl_trans__coders||{};Qe.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=Ye.gl_trans__coders=Ye.gl_trans__coders||{};let i=`${r}\\n    const _____getGlobal = ${Ke.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+=\'tran_____scoders["\'+t+\'"] =\'+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},Qe.registerTranscoder=function(t,e){Qe[t]=e},Qe.getTranscoder=function(t){return Qe[t]};let We=null;function Ze(){return We||(We={"image/crn":Qe.crn&&Qe.crn(),"image/ktx2":Qe.ktx2&&Qe.ktx2(),"image/cttf":Qe.ktx2&&Qe.ktx2(),"draco":Qe.draco&&Qe.draco()}),We}class tn{constructor(t,e,n){this.s=t,this.et=e||dt,this.i=n,this.nt=Ze()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,n=0,r=0,s){return e?(r||(r=e.byteLength),this.rt(t,e,n,r,s)):J.getArrayBuffer(t,{}).then(e=>{const s=e.data;return r||(r=s.byteLength),this.rt(t,s,n,r)})}rt(t,e,n,r,s){const i=s&&s.maxTextureSize,o=this.st(e,n,r,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/")),c=new this.et(a,o.glb,{transferable:!0,requestImage:this.s,decoders:this.nt,supportedFormats:this.i,maxTextureSize:i});return c.load({skipAttributeTransform:!1}).then(e=>{e.url=`${t}-${n}-${r}`;const s=c.transferables;for(let t=0;t<o.transferables.length;t++)s.indexOf(o.transferables[t])<0&&s.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:s,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}})}st(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported b3dm version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in b3dm header is inconsistent with b3dm\'s byte length, url: "+r;return console.warn(t),{error:t}}let o,a=s.getUint32(12,!0),c=s.getUint32(16,!0),u=s.getUint32(20,!0),f=s.getUint32(24,!0),h=28+e;u>=570425344?(h-=8,o=a,u=c,f=0,a=0,c=0):f>=570425344&&(h-=4,o=u,u=a,f=c,a=0,c=0);const l=[t];let d,y,m;if(a>0?(d=Ie(t,h,a),h+=a,o=d.BATCH_LENGTH):d={"BATCH_LENGTH":o},c>0&&(h+=c),u>0&&(y=ke(t,h,u),h+=u,f>0)){const e=Ee(0,h,f);m=t.slice(e.offset,e.offset+e.byteLength),h+=f,l.push(m)}const b=d.BATCH_LENGTH,p={};if(d&&d.BATCH_ID){p.BATCH_ID=Ue(d.BATCH_ID,t,(void 0).offset,b);const e=p.BATCH_ID.array&&p.BATCH_ID.array.buffer;e&&l.indexOf(e)<0&&l.push(e)}return{count:o,transferables:l,featureTable:d,batchTable:y,batchTableBin:m,b3dm:p,glb:{buffer:t,byteOffset:h,byteLength:s.byteLength+s.byteOffset-h}}}it(){return null}}class en{constructor(t,e,n,r){this.s=t,this.et=e||dt,this.i=n,this.nt=Ze(),this.ot=r}load(t,e,n=0,r=0,s){return e?(r||(r=e.byteLength),this.rt(t,e,n,r,s)):J.getArrayBuffer(t,{}).then(e=>{const s=e.data;return r||(r=s.byteLength),this.rt(t,s,n,r)})}rt(t,e,n,r,s){return this.ct(t,e,n,r,s).then(({gltf:s,transferables:i})=>{const o=this.ut(e,n,r,t);if(o.error)return Promise.resolve(o);for(let t=0;t<i.length;t++)-1===o.transferables.indexOf(i[t])&&o.transferables.push(i[t]);return delete s.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:s})})}ct(t,e,n,r,s){const i=s&&s.maxTextureSize,o={transferable:!0,requestImage:this.s,decoders:this.nt,supportedFormats:this.i,maxTextureSize:i},a=new DataView(e,n,r),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let r=me(new Uint8Array(e,c+n,a.byteLength-c));-1==r.indexOf("://")&&(r=t.substring(0,t.lastIndexOf("/"))+"/"+r);return r.indexOf(".glb")>0?J.getArrayBuffer(r,{}).then(t=>this.ft(r,{buffer:t.data,byteOffset:0},o)):J.getJSON(r,{}).then(t=>this.ft(r,t,o))}{const r={buffer:e,byteOffset:c+n,byteLength:a.byteLength-c};return this.ft(t,r,o)}}ft(t,e,n){const r=t.substring(0,t.lastIndexOf("/")),s=new this.et(r,e,n);return s.load({skipAttributeTransform:!0}).then(n=>{let r=0,i=0;return e.buffer&&(r=e.byteOffset||0,i=e.byteLength||0),n.url=`${t}-${r}-${i}`,{transferables:s.transferables,gltf:n}})}ut(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=De(s,32+e,o),h={},l=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;h.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:new Float32Array(t,e+c.offset,3*l).slice()},o.push(h.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,n=a.QUANTIZED_VOLUME_SCALE,{byteOffset:r}=a.POSITION_QUANTIZED;h.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:l,componentType:5126,array:this.ht(new Uint16Array(t,r+c.offset,3*l),e,n)},o.push(h.POSITION.array.buffer)}if(a.BATCH_ID){h.BATCH_ID=Ue(a.BATCH_ID,t,c.offset,l);const e=h.BATCH_ID.array&&h.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;h.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:new Float32Array(t,e+c.offset,3*l).slice()},o.push(h.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,h.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:new Float32Array(t,e+c.offset,3*l).slice()},o.push(h.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;h.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:this.lt(new Uint16Array(t,e+c.offset,2*l))},o.push(h.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,h.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:this.lt(new Uint16Array(t,e+c.offset,2*l))},o.push(h.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;h.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:l,componentType:5126,array:new Float32Array(t,e+c.offset,l).slice()},o.push(h.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;h.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:l,componentType:5126,array:new Float32Array(t,e+c.offset,3*l).slice()},o.push(h.SCALE_NON_UNIFORM.array.buffer)}return{count:l,batchTable:u,batchTableBin:f,featureTable:a,i3dm:h,transferables:o}}lt(t){const e=t.length/2,n=new Float32Array(3*e),r=[];for(let s=0;s<e;s++)nn(r,t[2*s],t[2*s+1],65535),n[3*s]=r[0],n[3*s+1]=r[1],n[3*s+2]=r[2];return n}ht(t,e,n){return Be(new Float32Array(t.length),t,e,n)}it(){return null}}function nn(t,e,n,r){if(t[0]=rn(e,r),t[1]=rn(n,r),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*sn(e),t[1]=(1-Math.abs(e))*sn(t[1])}return p(t,t)}function rn(t,e){return function(t,e,n){return t<e?e:t>n?n:t}(t,0,e=function(t,e){if(null!=t)return t;return e}(e,255))/e*2-1}function sn(t){return t<0?-1:1}class on{constructor(){}load(t,e,n=0,r=0){return e?(r||(r=e.byteLength),this.rt(t,e,n,r)):J.getArrayBuffer(t,{}).then(e=>{const s=e.data;return r||(r=s.byteLength),this.rt(t,s,n,r)})}rt(t,e,n,r){return this.dt(e,n,r,t).then(t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts})}dt(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in pnts header is inconsistent with pnts\'s byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:u,batchTableBin:f}=De(s,e+28,o),h=a.QUANTIZED_VOLUME_OFFSET,l=a.QUANTIZED_VOLUME_SCALE,d=a.POINTS_LENGTH;let y,m={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){m=a.extensions["3DTILES_draco_point_compression"],y=new DataView(t,m.byteOffset+c.offset,m.byteLength);const e={attributes:m.properties,useUniqueIDs:!1};return this.yt||(this.yt=Ze().draco),this.yt(y,e).then(e=>{const n=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||n.POSITION||n.POSITION_QUANTIZED||(n.POSITION=a.POSITION,n.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||n.RGB||n.RGBA||n.RGB565||(n.RGB=a.RGB,n.RGBA=a.RGBA,n.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||n.NORMAL||n.NORMAL_OCT16P||(n.NORMAL=a.NORMAL,n.NORMAL_OCT16P=a.NORMAL_OCT16P);const r=this.bt(t,e.attributes,c.offset,d,o,h,l);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;r.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:Pe(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?r.BATCH_ID=Ue(a.BATCH_ID,t,c.offset,d):r.BATCH_ID=an(d);const e=r.BATCH_ID.array&&r.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:r,transferables:o}})}const b=this.bt(t,a,c.offset,d,o,h,l);if(a.BATCH_ID||Object.keys(u).length){a.BATCH_ID?b.BATCH_ID=Ue(a.BATCH_ID,t,c.offset,d):b.BATCH_ID=an(d);const e=b.BATCH_ID.array&&b.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:d,batchTable:u,batchTableBin:f,featureTable:a,pnts:b,transferables:o})}bt(t,e,n,r,s,i,o){const a={};if(e.POSITION){let{byteOffset:i,array:o}=e.POSITION;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},s.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c}=e.POSITION_QUANTIZED;const{array:u}=e.POSITION_QUANTIZED;c=c||0;const f=u?0:n;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:this.ht(u||new Uint16Array(t,c+f,3*r),i,o)},s.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:i,array:o}=e.RGBA;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+4*r);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:r,componentType:5121,array:o},s.push(o.buffer)}else if(e.RGB){let{byteOffset:i,array:o}=e.RGB;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5121,array:o},s.push(o.buffer)}else if(e.RGB565){let{byteOffset:i,array:o}=e.RGB565;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+2*r);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:r,componentType:5123,array:o},s.push(o.buffer)}if(e.NORMAL){let{byteOffset:i,array:o}=e.NORMAL;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},s.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:i,array:o}=e.NORMAL_OCT16P;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+2*r);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:r,componentType:5121,array:o},s.push(o.buffer)}return a}ht(t,e,n){return Be(new Float32Array(t.length),t,e,n)}it(){return null}}function an(t){const e=(n=t)<256?Uint8Array:n<65536?Uint16Array:Uint32Array;var n;const r=new e(t);for(let e=0;e<t;e++)r[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:Pe(e),array:r}}class cn{constructor(t,e,n,r){this.i=n,this.s=t,this.et=e||dt,this.ot=r}load(t,e,n=0,r=0,s){return e?this.rt(t,e,n,r,s):J.getArrayBuffer(t,{}).then(e=>{const s=e.data;return this.rt(t,s,n,r)})}rt(t,e,n,r,s){r||(r=e.byteLength);const i=this.pt(e,t,n,r),o=[];for(let n=0;n<i.length;n++){let r;if("b3dm"===i[n].magic)r=new tn(this.s,this.et,this.i);else if("i3dm"===i[n].magic)r=new en(this.s,this.et,this.i,this.ot);else if("pnts"===i[n].magic)r=new on;else{if("cmpt"!==i[n].magic){console.warn("Unsupported magic in CMPT tile:",i[n].magic);continue}r=new cn(this.s,this.et,this.i,this.ot)}o.push(r.load(t,e,i[n].offset,i[n].byteLength,s).then(t=>t))}return Promise.all(o).then(t=>({magic:"cmpt",tiles:t}))}pt(t,e,n,r){const s=new DataView(t,n,r),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported cmpt version: "+i+", url:"+e;return console.warn(t),{error:t}}if(16===s.byteLength)return[];const o=[],a=s.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=xe(s,c),r=s.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+n,byteLength:r}),c+=r}return o}}function un(t,e){if(t.scenes&&t.scenes.length)for(let n=0,r=t.scenes.length;n<r;n++){const r=t.scenes[n].nodes;for(let n=0,s=r.length;n<s;n++){const s=[];bn(r[n],s,t,e)}}}const fn=[],hn=[],ln=[],dn=[0,0,0],yn=S([]),mn=[1,1,1];function bn(t,e,n,r){const c=e.slice(0);if(t.matrix)c.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=i(fn,t.translation||dn),n=a(hn,t.rotation||yn),r=o(ln,t.scale||mn);s(r,n,r);const u=s([],e,r);c.push(u)}if(t.children&&t.children.length)for(let e=0,s=t.children.length;e<s;e++)bn(t.children[e],c,n,r);if(void 0!==t.mesh){const e=t.mesh,s=n.meshes[e];if(s){const t=c.slice(0),i=s.primitives;for(let s=0,o=i.length;s<o;s++){const o=i[s];o&&(o.matrices=t,r(o,e,s,n))}}}}function pn(t,e){let{byteOffset:n,byteStride:r,count:s}=t;const{componentType:i,itemSize:o}=t,a=t.array.buffer,c=i?dt.getTypedArrayCtor(i):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,r=r||0,s=s||t.array.length/o,(!r||r===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,s*o);for(let r=0;r<s*o;r+=o){e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o)}return}const u=new Uint8Array(o*c.BYTES_PER_ELEMENT);r||(r=o*c.BYTES_PER_ELEMENT);for(let t=0;t<s;t++){const s=new Uint8Array(a,r*t+n,o*c.BYTES_PER_ELEMENT);u.set(s);e(new c(u.buffer),t),s.set(u)}}var wn=An("DXT1"),gn=An("DXT3"),vn=An("DXT5"),Mn=An("DX10"),Tn=function(t){var e,n,r=new Int32Array(t,0,31);if(542327876!==r[0])throw new Error("Invalid magic number in DDS header");if(4&!r[20])throw new Error("Unsupported format, must contain a FourCC code");var s=r[21];switch(s){case wn:e=8,n="dxt1";break;case gn:e=16,n="dxt3";break;case vn:e=16,n="dxt5";break;case 116:n="rgba32f";break;case Mn:var i=new Uint32Array(t.slice(128,148));n=i[0];var o=i[1];if(i[2],i[3],i[4],3!==o||2!==n)throw new Error("Unsupported DX10 texture format "+n);n="rgba32f";break;default:throw new Error("Unsupported FourCC code: "+(a=s,String.fromCharCode(255&a,a>>8&255,a>>16&255,a>>24&255)))}var a;var c=r[2],u=1;131072&c&&(u=Math.max(1,r[7]));var f=!1;512&r[28]&&(f=!0);var h,l=r[4],d=r[3],y=r[1]+4,m=l,b=d,p=[];s===Mn&&(y+=20);if(f)for(var w=0;w<6;w++){if("rgba32f"!==n)throw new Error("Only RGBA32f cubemaps are supported");l=m,d=b;for(var g=Math.log(l)/Math.log(2)+1,v=0;v<g;v++)h=l*d*16,p.push({offset:y,length:h,shape:[l,d]}),v<u&&(y+=h),l=Math.floor(l/2),d=Math.floor(d/2)}else for(v=0;v<u;v++)h=Math.max(4,l)/4*Math.max(4,d)/4*e,p.push({offset:y,length:h,shape:[l,d]}),y+=h,l=Math.floor(l/2),d=Math.floor(d/2);return{shape:[m,b],images:p,format:n,flags:c,cubemap:f}};function An(t){return t.charCodeAt(0)+(t.charCodeAt(1)<<8)+(t.charCodeAt(2)<<16)+(t.charCodeAt(3)<<24)}var _n=Math.abs,On=Math.sin,xn=Math.cos,Sn=Math.tan,In=Math.atan,kn=Math.atan2,En=Math.sqrt,Cn=Math.log,Un=Math.hypot,Fn=Math.sinh,Nn=Math.cosh;function Pn(t){var e,n,r,s,i,o,a=[],c=[],u=[],f=[];function h(t,e){for(var n,r=2*xn(2*e),s=t.length-1,i=t[s],o=0;--s>=0;)n=r*i-o+t[s],o=i,i=n;return e+n*On(2*e)}function l(t,e,n){for(var r,s,i=On(e),o=xn(e),a=Fn(n),c=Nn(n),u=2*o*c,f=-2*i*a,h=t.length-1,l=t[h],d=0,y=0,m=0;--h>=0;)r=y,s=d,l=u*(y=l)-r-f*(d=m)+t[h],m=f*y-s+u*d;return[(u=i*c)*l-(f=o*a)*m,u*m+f*l]}t.es,i=s=(r=t.es/(1+En(1-t.es)))/(2-r),a[0]=s*(2+s*(-2/3+s*(s*(116/45+s*(26/45+s*(-2854/675)))-2))),c[0]=s*(s*(2/3+s*(4/3+s*(-82/45+s*(32/45+s*(4642/4725)))))-2),i*=s,a[1]=i*(7/3+s*(s*(-227/45+s*(2704/315+s*(2323/945)))-1.6)),c[1]=i*(5/3+s*(-16/15+s*(-13/9+s*(904/315+s*(-1522/945))))),i*=s,a[2]=i*(56/15+s*(-136/35+s*(-1262/105+s*(73814/2835)))),c[2]=i*(-26/15+s*(34/21+s*(1.6+s*(-12686/2835)))),i*=s,a[3]=i*(4279/630+s*(-332/35+s*(-399572/14175))),c[3]=i*(1237/630+s*(s*(-24832/14175)-2.4)),i*=s,a[4]=i*(4174/315+s*(-144838/6237)),c[4]=i*(-734/315+s*(109598/31185)),i*=s,a[5]=i*(601676/22275),c[5]=i*(444337/155925),i=s*s,e=t.k0/(1+s)*(1+i*(1/4+i*(1/64+i/256))),u[0]=s*(s*(2/3+s*(-37/96+s*(1/360+s*(81/512+s*(-96199/604800)))))-.5),f[0]=s*(.5+s*(-2/3+s*(5/16+s*(41/180+s*(-127/288+s*(7891/37800)))))),u[1]=i*(-1/48+s*(-1/15+s*(437/1440+s*(-46/105+s*(1118711/3870720))))),f[1]=i*(13/48+s*(s*(557/1440+s*(281/630+s*(-1983433/1935360)))-.6)),i*=s,u[2]=i*(-17/480+s*(37/840+s*(209/4480+s*(-5569/90720)))),f[2]=i*(61/240+s*(-103/140+s*(15061/26880+s*(167603/181440)))),i*=s,u[3]=i*(-4397/161280+s*(11/504+s*(830251/7257600))),f[3]=i*(49561/161280+s*(-179/168+s*(6601661/7257600))),i*=s,u[4]=i*(-4583/161280+s*(108847/3991680)),f[4]=i*(34729/80640+s*(-3418889/1995840)),i*=s,u[5]=i*(-20648693/638668800),f[5]=.6650675310896665*i,o=h(c,t.phi0),n=-e*(o+function(t,e){var n,r=2*xn(e),s=t.length-1,i=t[s],o=0;for(;--s>=0;)n=r*i-o+t[s],o=i,i=n;return On(e)*n}(f,2*o)),t.fwd=function(t,r){var s,i,o,a,u,d=t.phi,y=t.lam;d=h(c,d),s=On(d),i=xn(d),a=On(y),o=xn(y),d=kn(s,o*i),y=kn(a*i,Un(s,i*o)),y=function(t){var e=_n(t);return e=function(t){var e=1+t,n=e-1;return 0===n?t:t*Cn(e)/n}(e*(1+e/(Un(1,e)+1))),t<0?-e:e}(Sn(y)),u=l(f,2*d,2*y),d+=u[0],y+=u[1],_n(y)<=2.623395162778?(r.y=e*d+n,r.x=e*y):r.x=r.y=1/0},t.inv=function(t,r){var s,i,o,c,f,d=t.y,y=t.x;d=(d-n)/e,_n(y/=e)<=2.623395162778?(f=l(u,2*d,2*y),d+=f[0],y+=f[1],y=In(Fn(y)),s=On(d),i=xn(d),c=On(y),o=xn(y),y=kn(c,o*i),d=kn(s*o,Un(c,o*i)),r.phi=h(a,d),r.lam=y):r.phi=r.lam=1/0}}const Bn=Math.PI/180,Dn=6378137*Math.PI/180,Rn={};function Ln(t,e,n,r){if("EPSG:3857"===n)return function(t,e){const n=85.0511287798,r=e[0],s=Math.max(Math.min(n,e[1]),-n);let i;i=0===s?0:Math.log(Math.tan((90+s)*Bn/2))/Bn;return t[0]=r*Dn,t[1]=i*Dn,t}(t,e);if(!n||"EPSG:9807"!==n.code&&"Traverse_Mercator"!==n.code){if("EPSG:4326"===n||"EPSG:4490"===n||"identity"===n)return zn(t,e);if("baidu"===n)return zn(t,e);throw new Error("unsupported projection:"+n)}{if(!(!r||4326===r.wkid))return function(t,e){return t[0]=e[0],t[1]=e[1],t}(t,e);const s=JSON.stringify(n);let i=Rn[s];return i||(i=Rn[s]=function(t){const e={a:6378137,es:.0066943799901413165,x0:fe(t.falseEasting)?5e5:t.falseEasting,y0:fe(t.falseNorthing)?0:t.falseNorthing,k0:t.scaleFactor||.9996,lam0:(t.centralMeridian||0)*jn,phi0:(t.latitudeOfOrigin||0)*jn,originLam0:t.startLongtitude||0,originPhi0:t.startLatitude||0};Pn(e);const n={lam:0,phi:0},r={};let s=0,i=0;(e.originLam0||e.originPhi0)&&(n.lam=e.originLam0*jn-e.lam0,n.phi=e.originPhi0*jn,e.fwd(n,r),s=e.a*r.x+e.x0,i=e.a*r.y+e.y0);return{project:function(t,o){n.lam=t[0]*jn-e.lam0,n.phi=t[1]*jn,e.fwd(n,r);const a=e.a*r.x+e.x0-s,c=e.a*r.y+e.y0-i;return o[0]=a,o[1]=c,o}}}(n)),i.project(e,t)}}function zn(t,e){return t[0]=e[0],t[1]=e[1],t}const jn=.017453292519943295;const Vn=r([]),qn=Ze().draco,Gn=Ze().ktx2,$n={"pbrMetallicRoughness":{"baseColorFactor":[.5,.5,.5,1],"metallicFactor":0,"roughnessFactor":.5}},Xn={"position":{name:"POSITION",accessor:{"componentType":5126,"type":"VEC3"}},"normal":{name:"NORMAL",accessor:{"componentType":5126,"type":"VEC3"}},"uv0":{name:"TEXCOORD_0",accessor:{"componentType":5126,"type":"VEC2"}},"color":{name:"COLOR_0",accessor:{"componentType":5121,"type":"VEC4"}},"uv-region":{name:"uvRegion",accessor:{"componentType":5123,"type":"VEC4"}},"feature-index":{name:"_BATCHID",accessor:{"componentType":5125,"type":"SCALAR"}},"faceRange":{name:"faceRange",accessor:{"componentType":5125,"type":"VEC2"}}};function Hn(t,e,n,s,i,o){const a=[],c=[],u=[];for(let e=0;e<t.meshes.length;e++){const{geometry:n,material:r}=t.meshes[e],s=J.getArrayBuffer(n.url,o);s.xhr.url=n.url,u.push(s.xhr);const i=s.then(t=>({buffer:t}));a.push(i);const f=[];if(tr(r,f),f.length){const t=f.map(t=>{const e=J.getArrayBuffer(t.url,o);return e.xhr.url=t.url,u.push(e.xhr),e.then(e=>e&&e.status?null:{buffer:e,mimeType:t.mimeType,format:t.format})});a.push(...t)}c[e]=f.length}const f=Promise.all(a).then(o=>{for(let t=0;t<o.length;t++)if(!o[t]||!o[t].buffer)return Promise.resolve(null);const a=[];let u=0;for(let t=0;t<c.length;t++){const e=c[t];a.push({geoBuffer:{data:o[u].buffer.data},textureBuffers:o.slice(u+1,e+u+1).map(t=>({data:t.buffer.data,mimeType:t.mimeType,format:t.format}))}),u+=1+e}return function(t,e,n,s,i,o){const a={asset:{generator:"i3s",version:"2.0"},extensions:{},scene:0,scenes:[{nodes:[]}],nodes:{},meshes:{},materials:[],skins:[],animations:null,textures:[],transferables:[]},c=[];for(let u=0;u<t.meshes.length;u++){let{material:f}=t.meshes[u];const{geometry:h}=t.meshes[u];let l;const d=e[u].geoBuffer.data;if(!d)continue;const y=or(d);l=y?Kn(a,u,h,d,t.transform,t.center,i,o):Qn(a,u,h,d,t.transform,t.center,i,o),c.push(l),a.nodes[u]={mesh:u,nodeIndex:u,matrix:r([])},a.scenes[0].nodes[u]=a.nodes[u],f||(f=$n);const m=Zn(u,a,f,e[u].textureBuffers,n,s);c.push(m)}return Promise.all(c).then(()=>({gltf:a,featureTable:{BATCH_LENGTH:0},transferables:a.transferables}))}(t,a,e,i,n,s)});return f.xhr=u,f}const Jn={"magFilter":9728,"minFilter":9728,"wrapR":33071,"wrapS":33071,"wrapT":33071};function Kn(t,e,n,r,s,i,o,a){const c=n.info.compressedAttributes.attributes.reduce((t,e,n)=>{const r=Xn[e];if(!r)return t;return t[r.name||e]=n,t},{});return qn(r,{attributes:c,metadatas:{"POSITION":[{name:"i3s-scale_x",type:"double"},{name:"i3s-scale_y",type:"double"}]},useUniqueIDs:!1,skipAttributeTransform:!1}).then(n=>Wn(n,t,e,s,i,o,a))}const Yn={position:function(t,e,n){const r=3*t.vertexCount,s=new Float32Array(e,n,r);return t.position={array:s,componentType:5126,itemSize:3,count:r/3,meta:{"i3s-scale_x":1,"i3s-scale_y":1},type:"VEC3"},n+=4*r},normal:function(t,e,n){const r=3*t.vertexCount,s=new Float32Array(e,n,r);return t.normal={array:s,componentType:5126,itemSize:3,count:r/3,type:"VEC3"},n+=4*r},uv0:function(t,e,n){const r=2*t.vertexCount,s=new Float32Array(e,n,r);return t.uv0={array:s,componentType:5126,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},color:function(t,e,n){const r=4*t.vertexCount,s=new Uint8Array(e,n,r);return t.color={array:s,componentType:5121,itemSize:4,count:r/4,type:"VEC4"},n+=r},featureId:function(t,e,n){return n+=8*t.featureCount},id:function(t,e,n){return n+=8*t.featureCount},faceRange:function(t,e,n){const r=2*t.featureCount,s=new Uint32Array(e,n,r);return t.faceRange={array:s,componentType:5125,itemSize:2,count:r/2,type:"VEC2"},n+=4*r},uvRegion:function(t,e,n){const r=4*t.vertexCount,s=new Uint16Array(e,n,r);return t["uv-region"]={array:s,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r},region:function(t,e,n){const r=4*t.vertexCount,s=new Uint16Array(e,n,r);return t["uv-region"]={array:s,componentType:5123,itemSize:4,count:r/4,type:"VEC4"},n+=2*r}};function Qn(t,e,n,r,s,i,o,a){const c={vertexCount:0},u=new DataView(r);try{let t=0;c.vertexCount=u.getUint32(t,1),t+=4,c.featureCount=u.getUint32(t,1),t+=4;const e=n.info.ordering?null:n.info;if(e){const n=[];for(const t in e)"offset"!==t&&""!==t&&n.push(t);for(let e=0;e<n.length;e++)Yn[n[e]]?t=Yn[n[e]](c,r,t):console.error("Unknown decoder for",n[e])}else{const e=n.info;let s=e.ordering,i=e.featureAttributeOrder;const o=null;o&&o.geometryData&&o.geometryData[0]&&o.geometryData[0].params;for(let e=0;e<s.length;e++){const n=Yn[s[e]];n||console.log(s[e]),t=n(c,r,t)}for(let e=0;e<i.length;e++){const n=Yn[i[e]];n||console.log(i[e]),t=n(c,r,t)}}}catch(t){}c.scale_x=1,c.scale_y=1;const f={};for(const t in c){const e=Xn[t]&&Xn[t].name;e&&(f[e]=c[t])}if(c.faceRange){const t=c.faceRange.array,e=t.length/2,n=(h=e)<=255?Uint8Array:h<=65535?Uint16Array:Uint32Array,r=new n(f.POSITION.array.length/3);for(let e=0;e<t.length-1;e+=2){const n=e/2,s=t[e],i=t[e+1];for(let t=s;t<=i;t++)r[3*t]=n,r[3*t+1]=n,r[3*t+2]=n}f._BATCHID={componentType:Je(n),array:r,itemSize:1,count:r.length,type:"SCALAR"}}var h;return Wn({attributes:f},t,e,s,i,o,a)}function Wn(t,e,n,r,s,i,o){const a={attributes:t.attributes,material:n,indices:t.indices,mode:4};!function(t){const e=t.array,n=t.meta&&t.meta["i3s-scale_x"],r=t.meta&&t.meta["i3s-scale_y"];if(n&&r&&(1!==n||1!==r))for(let t=0;t<e.length;t+=3)e[t]*=n.value,e[t+1]*=r.value}(t.attributes.POSITION);const u=function(t,e,n,r,s){let i,o=[0,0,0,1];const a=[0,0],u=Ln([],n,r,s);u[2]=n[2];const f=e&&c(Vn,e);return pn(t,t=>(o[0]=t[0],o[1]=t[1],o[2]=t[2],f||(o=v(o,o,e)),n&&y(o,o,n),Ln(a,o,r,s),i=o[2],t[0]=a[0]-u[0],t[1]=a[1]-u[1],t[2]=i-u[2],t)),u}(t.attributes.POSITION,r,s,i,o);e.meshes[n]={primitives:[a],index:n},e.extensions.MAPTALKS_RTC={projCenter:u},e.extensions.CESIUM_RTC={rtcCoord:s};for(const n in t.attributes)ir(e.transferables,t.attributes[n].array.buffer);return t.indices&&ir(e.transferables,t.indices.array.buffer),a}function Zn(t,e,n,r,s,i){const o=r.map(t=>function(t,e,n,r,s){if("dds"===e){const e=Tn(t),r=e.images.map(e=>new Uint8Array(t,e.offset,e.length)),s="dxt1"===e.format?33777:33779;return Promise.resolve({image:{mipmap:r,width:e.shape[0],height:e.shape[1],mimeType:n},sampler:Jn,format:s})}if("png"===e||"jpg"===e)return function(t,e){er||(er=new OffscreenCanvas(2,2),nr=er.getContext("2d",{willReadFrequently:!0}));const n=new Blob([new Uint8Array(t)]);return createImageBitmap(n).then(t=>{let{width:n,height:r}=t;rr(n)||(n=sr(n)),rr(r)||(r=sr(r));const s=e;s&&(n=Math.min(s,n),r=Math.min(s,r)),er.width=n,er.height=r,nr.drawImage(t,0,0,n,r),t.close();const i=nr.getImageData(0,0,n,r);return{width:n,height:r,array:new Uint8Array(i.data)}}).catch(()=>({width:2,height:2,array:new Uint8Array(4)}))}(t,s).then(t=>{t.mimeType=n;return{image:t,sampler:Jn,format:6408}});if("ktx2"===e)return Gn(t,r).then(t=>(t.mimeType=n,{image:t,sampler:Jn,format:t.format}));return null}(t.data,t.format,t.mimeType,s,i).then(t=>{if(t.image)if(t.image.array)ir(e.transferables,t.image.array.buffer);else if(t.image.mipmap)for(let n=0;n<t.image.mipmap.length;n++)ir(e.transferables,t.image.mipmap[n].buffer);return t}));return Promise.all(o).then(r=>{!function t(e,n,r,s){const i=JSON.parse(JSON.stringify(r)),o=n.textures;s.ptr||(s.ptr=0);for(const e in r)r[e]&&r[e].url?(o.push(s[s.ptr++]),i[e]={index:o.length-1},void 0!==r[e].factor&&(i[e].scale=r[e].factor)):he(r[e])&&(i[e]=t(-1,n,r[e],s));e>=0&&(n.materials[e]=i);return i}(t,e,n,r)})}function tr(t,e){for(const n in t)t[n]&&t[n].url?e.push({url:t[n].url,mimeType:t[n].mimeType,format:t[n].format}):he(t[n])&&tr(t[n],e)}let er,nr;function rr(t){return 0==(t&t-1)&&0!==t}function sr(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function ir(t,e){e&&(t.indexOf(e)>=0||t.push(e))}function or(t){const e=new Uint8Array(t,0,5);return e[0]==="D".charCodeAt()&&e[1]==="R".charCodeAt()&&e[2]==="A".charCodeAt()&&e[3]==="C".charCodeAt()&&e[4]==="O".charCodeAt()}const ar=[];const cr=[],ur=[],fr=[],hr=[],lr=[],dr=[],yr=[];function mr(t,e,n,r,s,i){d(hr,t[3*e],t[3*e+1],t[3*e+2]),d(lr,t[3*n],t[3*n+1],t[3*n+2]),d(dr,t[3*r],t[3*r+1],t[3*r+2]);const o=M(cr,dr,lr),a=M(ur,hr,lr),c=g(fr,o,a);p(yr,c),s[3*e]=s[3*e]||0,s[3*n]=s[3*n]||0,s[3*r]=s[3*r]||0,s[3*e+1]=s[3*e+1]||0,s[3*n+1]=s[3*n+1]||0,s[3*r+1]=s[3*r+1]||0,s[3*e+2]=s[3*e+2]||0,s[3*n+2]=s[3*n+2]||0,s[3*r+2]=s[3*r+2]||0,s[3*e]+=yr[0],s[3*n]+=yr[0],s[3*r]+=yr[0],s[3*e+1]+=yr[1],s[3*n+1]+=yr[1],s[3*r+1]+=yr[1],s[3*e+2]+=yr[2],s[3*n+2]+=yr[2],s[3*r+2]+=yr[2],i[e]+=1,i[n]+=1,i[r]+=1}const br=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],pr=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],wr=2*Math.PI*6378137/360,gr="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;let vr,Mr=!1;if("undefined"!=typeof OffscreenCanvas){try{vr=new OffscreenCanvas(2,2).getContext("2d",{willReadFrequently:!0})}catch(t){}vr&&"undefined"!=typeof createImageBitmap&&(Mr=!0)}const Tr=r([]),Ar=[0,0,0],_r=[],Or=[],xr=[],Sr=[],Ir={"POSITION":1,"TEXCOORD_0":1,"TEXCOORD_1":1,"NORMAL":1,"TANGENT":1},kr={"TEXCOORD_0":1e-4,"TEXCOORD_1":1e-4};class Er{constructor(t,e,n,r){this.id=t,this.options=e,this.wt=this.requestImage.bind(this),this.gt=n,this.vt={},r(null,{},[])}Mt(t){this.Tt||(this.i=t,this.At=new on,this.Tt=new tn(this.wt,dt,t),this._t=new en(this.wt,dt,t))}requestImage(t,e){Mr?fetch(t).then(t=>t.arrayBuffer()).then(t=>{const e=new self.Blob([new Uint8Array(t)]);return createImageBitmap(e)}).then(t=>{(void 0).width=t.width,(void 0).height=t.height,vr.drawImage(t,0,0);const n=vr.getImageData(0,0,(void 0).width,(void 0).height);t.close(),e(null,{width:t.width,height:t.height,data:new Uint8Array(n.data)})}):this.gt("requestImage",{url:t},null,e)}loadTile(t,e){this.Mt(t.supportedFormats);const n=t.service,r=t.url,s=t.arraybuffer,i=n.fetchOptions||{};if(i.referrer=t.referrer,i.referrerPolicy=i.referrerPolicy||"origin",function(t){return t.indexOf("i3s:")>=0}(r)){const s=t.i3sInfo,o=n.maxTextureSize||1024,a=Hn(s,t.supportedFormats,this.options.projection,t.projection,o,i);return a.then(t=>{if(delete this.vt[r],!t)return void e({status:404,url:r,i3sInfo:s});if(!Object.keys(t.gltf.meshes).length)return void e({status:404,url:r,i3sInfo:s});t.gltf.url=r;const{transferables:n}=t;t.magic="b3dm",this.Ot(t.gltf),e(null,t,n)}),void(this.vt[r]=a.xhr)}if(s){delete this.vt[r];const n=xe(new DataView(s),0);if("{"===n[0]||" "===n[0]||"<"===n[0]){const n=function(t,e,n){if(gr){const r=new Uint8Array(t,e,n);return gr.decode(r)}return me(new Uint8Array(t,e,n))}(s,0,s.byteLength),i=JSON.parse(n);i.accessors?this.xt(i,r,t,"gltf",e):this.St(t.rootIdx,i,s,r,e)}else this.xt(s,r,t,n,e)}else{let s=n.urlParams;s&&(s=(r.indexOf("?")>0?"&":"?")+s);const o=r.replace(/\\+/g,"%2B");let a=J.getArrayBuffer(o+(s||""),i);const c=a.xhr;a=a.then(n=>{delete this.vt[r],n&&n.status?e(n):(t.arraybuffer=n&&n.data,this.loadTile(t,e))}).catch(t=>{delete this.vt[r],e(t)}),this.vt[r]=c}}xt(t,e,n,r,s){r=r&&r.toLowerCase();const i=n.service;if("b3dm"===r){this.Tt.load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then(t=>{if(t.error)return void s(t);const{content:e,transferables:r}=this.It(t,n);this.Ot(e.gltf),s(null,e,r)}).catch(t=>{s(t)})}else if("pnts"===r){const r=n.transform||Tr;this.At.load(e,t).then(t=>{const{content:e,transferables:i}=this.kt(t,r,n.rootIdx);this.Et(e),s(null,e,i)})}else if("i3dm"===r){const r=n.transform||Tr;this._t.load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then(t=>{const{content:e,transferables:i}=this.Ct(t,r,n.rootIdx);this.Ot(e.gltf),s(null,e,i)})}else if("cmpt"===r){new cn(this.wt,dt,this.i,i.maxTextureSize||1024).load(e,t,0,0,{maxTextureSize:i.maxTextureSize||1024}).then(t=>{const{content:e,transferables:r}=this.Ut(t,n);this.Ft(e),s(null,e,r)}).catch(t=>{s(t)})}else if("gltf"===r){this.nt||(this.nt=Ze());const r=e.substring(0,e.lastIndexOf("/")),o=t instanceof ArrayBuffer&&{buffer:t,byteOffset:0,byteLength:t.byteLength}||t,a=new dt(r,o,{transferable:!0,requestImage:this.wt,decoders:this.nt,supportedFormats:this.i,maxTextureSize:i.maxTextureSize||1024});a.load({skipAttributeTransform:!1}).then(t=>{t.url=e,this.Nt(t,null,n),this.Ot(t),s(null,{magic:"gltf",gltf:t},a.transferables)})}else s(new Error("unsupported tile format: "+r))}Ft(t){t.content?t.content.forEach(t=>{this.Ft(t)}):this.Ot(t.gltf)}Pt(t,e){const n=e.materials[t.material];if(n&&n.extensions&&n.extensions.KHR_materials_unlit)return;if(t.attributes.TANGENT)return;if(t.attributes.TEXCOORD_0&&!t.attributes.NORMAL){const e=t.attributes.POSITION.array,n=function(t,e,n){const r=n||[];r.setLength&&r.setLength(t.length);const s=ar;s.length<t.length/3&&(s.length=t.length/3),s.fill(0,0,t.length/3);const i=void 0===e.length?e:e.length;for(let n=0;n<i/3;n++)void 0===e.length?mr(t,3*n,3*n+1,3*n+2,r,s):mr(t,e[3*n],e[3*n+1],e[3*n+2],r,s);for(let t=0;t<r.length;t+=3){const e=s[t/3];0!==e?(r[t]/=e,r[t+1]/=e,r[t+2]/=e):(r[t]=0,r[t+1]=0,r[t+2]=0)}return r}(e,t.indices.array,new Float32Array(e.length));t.attributes.NORMAL={array:n,byteLength:n.byteLength,byteOffset:0,byteStride:0,componentType:5126,count:n.length/3,itemSize:3,name:"NORMAL",type:"VEC3"}}}Ot(t){if(!t||!t.meshes||t.extensionsUsed&&t.extensionsUsed.indexOf("KHR_techniques_webgl")>-1)return;const e=t.meshes;for(const n in e){e[n].primitives.forEach(e=>{this.Pt(e,t),e.compressed_int16_params={};const n=e.attributes;for(const t in n)if(Ir[t]&&n[t].array&&n[t].array instanceof Float32Array){const r=this.options.projection;let s=1;"EPSG:4326"!==r&&"EPSG:4490"!==r||"POSITION"!==t||(s=wr,e.compressed_int16_params.compressed_ratio=s);const i=Br(n[t].array,s,n[t].min,n[t].max,t);if(!i)continue;const{array:o,range:a}=i;n[t].array=o,e.compressed_int16_params[t]=a}})}}Et(t){if(!t||!t.pnts)return;const e=t.pnts;t.compressed_int16_params={};for(const n in e)if(Ir[n]&&e[n].array&&e[n].array instanceof Float32Array){const r=this.options.projection;let s=1;"EPSG:4326"!==r&&"EPSG:4490"!==r||"POSITION"!==n||(s=wr,t.compressed_int16_params.compressed_ratio=s);const{array:i,range:o}=Br(e[n].array,s,e[n].min,e[n].max,n);e[n].array=i,t.compressed_int16_params[n]=o}}Bt(t){const e=[];for(let n=0;n<t.length;n++){const r=t[n];if(!r.childTile)continue;const s={boundingVolume:{sphere:[r.boundingSphere.center.x,r.boundingSphere.center.y,r.boundingSphere.center.z,r.boundingSphere.radius]},content:{uri:r.childTile},geometricError:r.boundingSphere.radius/r.rangeList*16,refine:"REPLACE"};e.push(s)}return e}St(t,e,n,r,s){return e.capabilities,void s(null,e)}Ut(t,e){const{tiles:n}=t,r={magic:"cmpt",content:[]},s=[];for(let t=0;t<n.length;t++){const{magic:i}=n[t];if("b3dm"===i){const{content:i,transferables:o}=this.It(n[t],e);Nr(s,o),r.content.push(i)}else if("i3dm"===i){const{transform:i,rootIdx:o}=e,{content:a,transferables:c}=this.Ct(n[t],i,o);Nr(s,c),r.content.push(a)}else if("pnts"===i){const{transform:i,rootIdx:o}=e,{content:a,transferables:c}=this.kt(n[t],i,o);Nr(s,c),r.content.push(a)}else if("cmpt"===i){const{content:i,transferables:o}=this.Ut(n[t],e);Nr(s,o),r.content.push(i)}}return{content:r,transferables:s}}It(t,e){const{gltf:n,transferables:r,featureTable:s}=t;return this.Nt(n,s,e),delete t.transferables,{content:t,transferables:r}}Nt(t,e,n){const r=function(t){if(!t||!t.meshes)return!1;let e=1;const n=[];for(const r in t.meshes){const s=t.meshes[r],{primitives:i}=s;if(i)for(let t=0;t<i.length;t++){const r=i[t].attributes&&i[t].attributes.POSITION;if(!r||!r.array)continue;r.array.buffer.visited||(r.array.buffer.visited=e++);const s=e-1+"-"+(r.byteOffset||0);if(n.indexOf(s)>=0)return!0;n.push(s)}}return!1}(t);this.Dt(t),t.asset||(t.asset={}),r?(t.asset.sharePosition=!0,this.Rt(t,e,n.upAxis,n.transform)):this.Lt(t,e,n.upAxis,n.transform)}Ct(t,e,r){const{featureTable:s}=t,i=t.i3dm,o=s&&s.RTC_CENTER||[0,0,0];if(s.EAST_NORTH_UP&&!i.NORMAL_UP&&!i.NORMAL_UP_OCT32P){const e=new Float32Array(3*i.POSITION.array.length),r=[],s=[],a=[];pn(i.POSITION,(t,i)=>{y(a,t,o),Xe(a,null,r),n(s,r);!function(t,e){t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8]}(e.subarray(9*i,9*(i+1)),s)}),i.INSTANCE_ROTATION={byteStride:0,byteOffset:0,itemSize:9,componentType:5126,array:e},t.transferables.push(e.buffer)}const a={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};Ur(i.POSITION.array,3,o,Tr,a);const c=Fr(a),u=l([],c),f=[1/0,1/0,1/0],h=[-1/0,-1/0,-1/0];pn(i.POSITION,t=>{t[0]=t[0]+o[0]-u[0],t[1]=t[1]+o[1]-u[1],t[2]=t[2]+o[2]-u[2],t[0]<f[0]&&(f[0]=t[0]),t[1]<f[1]&&(f[1]=t[1]),t[2]<f[2]&&(f[2]=t[2]),t[0]>h[0]&&(h[0]=t[0]),t[1]>h[1]&&(h[1]=t[1]),t[2]>h[2]&&(h[2]=t[2])}),i.POSITION.min=f,i.POSITION.max=h,e&&v(c,c,e);const d=this.zt(c);t.rtcCenter=u,t.rtcCoord=d,t.rootIdx=r;const m=t.transferables;return delete t.transferables,{content:t,transferables:m}}kt(t,e,n){const{featureTable:r}=t,s=t.pnts,i=r&&r.RTC_CENTER||[0,0,0],o=this.options.projection,a=e&&c(Tr,e),u={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};Ur(s.POSITION.array,3,i,e,u);const f=Fr(u),h=this.jt(f),y=l([],f),m=[1/0,1/0,1/0],b=[-1/0,-1/0,-1/0];let p=[0,0,0,1];const w=[0,0,0],g=[0,0];pn(s.POSITION,t=>(p[0]=t[0]+i[0],p[1]=t[1]+i[1],p[2]=t[2]+i[2],e&&!a&&(p=v(p,p,e)),0===A(p)?d(w,0,0,-6378137):Me(w,p),Ln(g,w,o),t[0]=g[0]-h[0],t[1]=g[1]-h[1],t[2]=w[2]-h[2],t[0]<m[0]&&(m[0]=t[0]),t[1]<m[1]&&(m[1]=t[1]),t[2]<m[2]&&(m[2]=t[2]),t[0]>b[0]&&(b[0]=t[0]),t[1]>b[1]&&(b[1]=t[1]),t[2]>b[2]&&(b[2]=t[2]),t)),s.POSITION.min=m,s.POSITION.max=b,e&&v(f,f,e);const M=this.zt(f);t.rtcCenter=y,t.projCenter=h,t.rtcCoord=M,t.rootIdx=n;const T=t.transferables;return delete t.transferables,{content:t,transferables:T}}Dt(t){if(!Array.isArray(t.textures))return;const e=t.textures;for(let t=0;t<e.length;t++){const n=e[t].image&&e[t].image.array;if(n&&n.length){const r=n[0],s=n[1],i=n[2],o=n[3];let a=!0;for(let t=4;t<n.length;t+=4)if(n[t]!==r||n[t+1]!==s||n[t+2]!==i||n[t+3]!==o){a=!1;break}a&&(e[t].image.color=[r/255,s/255,i/255,o/255],delete e[t].image.array)}}}abortTileLoading(t,e){const n=this.vt[t.url];if(Array.isArray(n))for(let t=0;t<n.length;t++)n[t].abort();else n&&n.abort&&n.abort();delete this.vt[t.url],e(null)}Vt(t,e,n,i){const o=e&&e.RTC_CENTER||t.extensions&&t.extensions.CESIUM_RTC&&t.extensions.CESIUM_RTC.center;let a=br;"X"===(n=n&&n.toUpperCase())?a=pr:"Z"===n&&(a=Tr),t.extensions=t.extensions||{},t.extensions.CESIUM_RTC||(t.extensions.CESIUM_RTC={}),o&&(t.extensions.CESIUM_RTC.center=o),t.extensions.MAPTALKS_RTC={};const c={xmin:1/0,xmax:-1/0,ymin:1/0,ymax:-1/0,hmin:1/0,hmax:-1/0};un(t,t=>{if(!(t.attributes&&t.attributes.POSITION))return;const e=r(_r);t.matrices&&Pr(e,t.matrices);const n=t.attributes.POSITION.array,u=t.attributes.POSITION.itemSize;s(e,a,e),i&&s(e,i,e),Ur(n,u,o||Ar,e,c,t.compressUniforms)});const u=Fr(c);return{rtcCenter:o,modelCenter:u,upAxisTransform:a}}Rt(t,e,n,i){const{modelCenter:o,upAxisTransform:a,rtcCenter:c}=this.Vt(t,e,n),u=l([],o);i&&v(o,o,i),t.extensions.CESIUM_RTC.rtcCoord=this.zt(o),c||(un(t,t=>{if(t.attributes&&t.attributes.POSITION){const e=t.attributes.POSITION;if(e.array.buffer.projected&&e.array.buffer.projected[e.byteOffset])return;const n=r(_r);t.matrices&&Pr(n,t.matrices),s(n,a,n);const i=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=e[4],a=e[5],c=e[6],u=e[7],f=e[8],h=e[9],l=e[10],d=e[11],y=e[12],m=e[13],b=e[14],p=e[15],w=n*a-r*o,g=n*c-s*o,v=n*u-i*o,M=r*c-s*a,T=r*u-i*a,A=s*u-i*c,_=f*m-h*y,O=f*b-l*y,x=f*p-d*y,S=h*b-l*m,I=h*p-d*m,k=l*p-d*b,E=w*k-g*I+v*S+M*x-T*O+A*_;return E?(E=1/E,t[0]=(a*k-c*I+u*S)*E,t[1]=(s*I-r*k-i*S)*E,t[2]=(m*A-b*T+p*M)*E,t[3]=(l*T-h*A-d*M)*E,t[4]=(c*x-o*k-u*O)*E,t[5]=(n*k-s*x+i*O)*E,t[6]=(b*v-y*A-p*g)*E,t[7]=(f*A-l*v+d*g)*E,t[8]=(o*I-a*x+u*_)*E,t[9]=(r*x-n*I-i*_)*E,t[10]=(y*T-m*v+p*w)*E,t[11]=(h*v-f*T-d*w)*E,t[12]=(a*O-o*S-c*_)*E,t[13]=(n*S-r*O+s*_)*E,t[14]=(m*g-y*M-b*w)*E,t[15]=(f*M-h*g+l*w)*E,t):null}(Or,n),o=[1/0,1/0,1/0],c=[-1/0,-1/0,-1/0];pn(e,t=>{v(t,t,n),t[0]=t[0]-u[0],t[1]=t[1]-u[1],t[2]=t[2]-u[2],v(t,t,i),t[0]<o[0]&&(o[0]=t[0]),t[1]<o[1]&&(o[1]=t[1]),t[2]<o[2]&&(o[2]=t[2]),t[0]>c[0]&&(c[0]=t[0]),t[1]>c[1]&&(c[1]=t[1]),t[2]>c[2]&&(c[2]=t[2])}),e.min=o,e.max=c,e.array.buffer.projected||(e.array.buffer.projected={}),e.array.buffer.projected[e.byteOffset]=1}}),t.extensions.CESIUM_RTC.center=u)}Lt(t,e,n,r){const{modelCenter:s,rtcCenter:i}=this.Vt(t,e,n,r),o=this.jt(s);t.extensions.MAPTALKS_RTC.projCenter=o,t.extensions.CESIUM_RTC.rtcCoord=this.zt(s),un(t,e=>{if(e.attributes&&e.attributes.POSITION){e.attributes.NORMAL&&this.qt(e.attributes.NORMAL,e.matrices,n),e.attributes.TANGENT&&this.qt(e.attributes.TANGENT,e.matrices,n);const{newPositions:s}=this.Gt(e.attributes.POSITION,e.matrices,i,t.extensions.MAPTALKS_RTC,n,r,e.compressUniforms),{componentType:o}=e.attributes.POSITION;5126!==o&&(e.attributes.POSITION.array=new Float32Array(s))}});for(const e in t.nodes){t.nodes[e].matrix=Tr}}jt(t){0===A(t)?d(xr,0,0,-6378137):Me(xr,t);const e=this.options.projection;Ln(Sr,xr,e);const n=xr[2],r=[];return r[0]=Sr[0],r[1]=Sr[1],r[2]=n,r}qt(t,e,r){let s;s="Y"===r?br:"X"===r?pr:Tr;const i=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}([],s);if(Pr(i,e),c(i,Tr))return;const o=n([],i),a=[];pn(t,t=>(function(t,e,n){var r=e[0],s=e[1],i=e[2];t[0]=r*n[0]+s*n[3]+i*n[6],t[1]=r*n[1]+s*n[4]+i*n[7],t[2]=r*n[2]+s*n[5]+i*n[8]}(a,t,o),p(a,a),l(t,a),a))}Gt(t,e,n,s,i,o,a){if(t.array.buffer.projected&&t.array.buffer.projected[t.byteOffset])return null;const u=r([]);Pr(u,e);const f=this.options.projection;i=i&&i.toUpperCase();const h=n;let l=null;"Y"===i?l=br:"X"===i&&(l=pr);let m=[0,0,0,1];const b=[0,0,0],p=[0,0],w=s.projCenter,g=o&&c(Tr,o),M=t.min=t.min||[],T=t.max=t.max||[];d(M,1/0,1/0,1/0),d(T,-1/0,-1/0,-1/0);const _=a||{},{decode_position_min:O,decode_position_normConstant:x}=_;let S=[0,0,0,0],I=1;O&&(S=O),x&&(I=x);const k=[];return pn(t,e=>{if(m[0]=e[0]*I+S[0],m[1]=e[1]*I+S[1],m[2]=e[2]*I+S[2],m=v(m,m,u),l&&(m=v(m,m,l)),h&&y(m,m,h),o&&!g&&(m=v(m,m,o)),0===A(m)?d(b,0,0,-6378137):Me(b,m),Ln(p,b,f),e instanceof Float32Array)e[0]=p[0]-w[0],e[1]=p[1]-w[1],e[2]=b[2]-w[2];else{const n=p[0]-w[0],r=p[1]-w[1],s=b[2]-w[2];5126!==t.componentType&&(k.push(n),k.push(r),k.push(s),k.push(e[3]))}return e[0]<M[0]&&(M[0]=e[0]),e[1]<M[1]&&(M[1]=e[1]),e[2]<M[2]&&(M[2]=e[2]),e[0]>T[0]&&(T[0]=e[0]),e[1]>T[1]&&(T[1]=e[1]),e[2]>T[2]&&(T[2]=e[2]),e}),t.array.buffer.projected||(t.array.buffer.projected={}),t.array.buffer.projected[t.byteOffset]=1,{projCenter:w,newPositions:k}}zt(t){return 0===A(t)?d([],0,0,-6378137):Me([],t)}onRemove(){}}const Cr=[];function Ur(t,e,n,r,s,i){const o=i||{},{decode_position_min:a,decode_position_normConstant:c}=o;let u=[0,0,0,0],f=1;a&&(u=a),c&&(f=c);for(let i=0,o=t.length;i<o;i+=e){const{xmin:o,ymin:a,xmax:c,ymax:h,hmin:l,hmax:m}=s;d(Cr,t[i]*f+u[0],t[i+1]*f+u[1],t[i+2]*f+u[2]),v(Cr,Cr,r);const b=y(Cr,n,Cr);b[0]<o&&(s.xmin=b[0]),b[0]>c&&(s.xmax=b[0]),b[1]<a&&(s.ymin=b[1]),b[1]>h&&(s.ymax=b[1]),e>2&&(b[2]<l&&(s.hmin=b[2]),b[2]>m&&(s.hmax=b[2]))}}function Fr(t){const{xmax:e,ymax:n,xmin:r,ymin:s,hmin:i,hmax:o}=t,a=[(r+e)/2,(s+n)/2,(i+o)/2];return e===-1/0&&(a[0]=0),n===-1/0&&(a[1]=0),o===-1/0&&(a[2]=0),isNaN(a[2])&&(a[2]=0),a}function Nr(t,e){for(let n=0;n<e.length;n++)t.indexOf(e[n])<0&&t.push(e[n])}function Pr(t,e){const n=t;for(let t=e.length-1;t>=0;t--)s(n,e[t],n);return n}function Br(t,e,n,r,s){if(e&&e>1)for(let n=0;n<t.length;n++)(n+1)%3!=0&&(t[n]*=e);let i,o;if(n&&r&&1===e)i=Math.min(...n),o=Math.max(...r);else{const{min:e,max:n}=function(t){let e=1/0,n=-1/0;for(let r=0;r<t.length;r++)t[r]>n&&(n=t[r]),t[r]<e&&(e=t[r]);return{min:e,max:n}}(t);i=e,o=n}return!function(t,e,n,r){for(let s=0;s<t.length;s++){const i=Dr(Rr(t[s],e,n),e,n);if(Math.abs(i-t[s])>kr[r])return!1}return!0}(t,i,o,s)&&kr[s]?null:function(t,e,n){const r=new Int16Array(t.length);for(let s=0;s<t.length;s++)r[s]=Rr(t[s],e,n);return{array:r,range:[e,n]}}(t,i,o)}function Dr(t,e,n){return((t>=32768?-(65536-t)/32768:t/32767)+1)*(n-e)/2+e}function Rr(t,e,n){const r=2*(t-e)/(n-e)-1,s=Math.max(-1,Math.min(1,r));return s<0?32768*s:32767*s}let Lr=0;class zr{constructor(t){this.workerId=t,this.workers={},this.$t={}}addLayer({actorId:t,mapId:e,layerId:n,params:r},s){if(this.Xt(e,n))return;const i=this.Ht(e,n),o=r.options,a=this.send.bind(this,t);this.workers[i]=new Er(n,o,a,s)}removeLayer({mapId:t,layerId:e},n){const r=this.Xt(t,e),s=this.Ht(t,e);delete this.workers[s],r&&r.onRemove(n)}loadTile({mapId:t,layerId:e,params:n},r){const s=this.Xt(t,e);s&&s.loadTile(n,r)}abortTileLoading({mapId:t,layerId:e,params:n},r){const s=this.Xt(t,e);s&&s.abortTileLoading(n,r)}receive(t){const e=t.callback,n=this.$t[e];delete this.$t[e],n&&t.error?n(new Error(t.error)):n&&n(null,t.data)}send(t,e,n,r,s){const i=s?`${t}-${Lr++}`:null;s&&(this.$t[i]=s),postMessage({type:"<request>",workerId:this.workerId,actorId:t,command:e,params:n,callback:String(i)},r||[])}Ht(t,e){return`${t}-${e}`}Xt(t,e){const n=this.Ht(t,e);return this.workers[n]}}t.initialize=function(){},t.onmessage=function(t,e){const n=t.data;this.dispatcher||(this.dispatcher=new zr(t.workerId)),"<response>"===t.type?this.dispatcher.workerId===t.workerId&&this.dispatcher.receive(t):this.dispatcher[n.command]({actorId:n.actorId,mapId:n.mapId,layerId:n.layerId,params:n.params},(t,n,r)=>{t&&console.error(t),t instanceof Error&&(t={message:t.message}),e(t,n,r)})},Object.defineProperty(t,"Jt",{value:!0})}';var O$3={exports:{}},_$3={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]},M$3={exports:{}},x$3=function(t){return!(!t||"string"==typeof t)&&(t instanceof Array||Array.isArray(t)||t.length>=0&&(t.splice instanceof Function||Object.getOwnPropertyDescriptor(t,t.length-1)&&"String"!==t.constructor.name))},A$1=Array.prototype.concat,I$2=Array.prototype.slice,S$3=M$3.exports=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var s=t[n];x$3(s)?e=A$1.call(e,I$2.call(s)):e.push(s)}return e};S$3.wrap=function(t){return function(){return t(S$3(arguments))}};var E$3=_$3,N$3=M$3.exports,C$1=Object.hasOwnProperty,P$2=Object.create(null);for(var R$3 in E$3)C$1.call(E$3,R$3)&&(P$2[E$3[R$3]]=R$3);var L$3=O$3.exports={to:{},get:{}};function k$3(t,e,n){return Math.min(Math.max(e,t),n)}function B$3(t){var e=Math.round(t).toString(16).toUpperCase();return e.length<2?"0"+e:e}L$3.get=function(t){var e,n;switch(t.substring(0,3).toLowerCase()){case"hsl":e=L$3.get.hsl(t),n="hsl";break;case"hwb":e=L$3.get.hwb(t),n="hwb";break;default:e=L$3.get.rgb(t),n="rgb"}return e?{model:n,value:e}:null},L$3.get.rgb=function(t){if(!t)return null;var e,n,r,s=[0,0,0,1];if(e=t.match(/^#([a-f0-9]{6})([a-f0-9]{2})?$/i)){for(r=e[2],e=e[1],n=0;n<3;n++){var i=2*n;s[n]=parseInt(e.slice(i,i+2),16)}r&&(s[3]=parseInt(r,16)/255)}else if(e=t.match(/^#([a-f0-9]{3,4})$/i)){for(r=(e=e[1])[3],n=0;n<3;n++)s[n]=parseInt(e[n]+e[n],16);r&&(s[3]=parseInt(r+r,16)/255)}else if(e=t.match(/^rgba?\(\s*([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)(?=[\s,])\s*(?:,\s*)?([+-]?\d+)\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)){for(n=0;n<3;n++)s[n]=parseInt(e[n+1],0);e[4]&&(s[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}else{if(!(e=t.match(/^rgba?\(\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*,?\s*([+-]?[\d\.]+)\%\s*(?:[,|\/]\s*([+-]?[\d\.]+)(%?)\s*)?\)$/)))return(e=t.match(/^(\w+)$/))?"transparent"===e[1]?[0,0,0,0]:C$1.call(E$3,e[1])?((s=E$3[e[1]])[3]=1,s):null:null;for(n=0;n<3;n++)s[n]=Math.round(2.55*parseFloat(e[n+1]));e[4]&&(s[3]=e[5]?.01*parseFloat(e[4]):parseFloat(e[4]))}for(n=0;n<3;n++)s[n]=k$3(s[n],0,255);return s[3]=k$3(s[3],0,1),s},L$3.get.hsl=function(t){if(!t)return null;var e=t.match(/^hsla?\(\s*([+-]?(?:\d{0,3}\.)?\d+)(?:deg)?\s*,?\s*([+-]?[\d\.]+)%\s*,?\s*([+-]?[\d\.]+)%\s*(?:[,|\/]\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,k$3(parseFloat(e[2]),0,100),k$3(parseFloat(e[3]),0,100),k$3(isNaN(n)?1:n,0,1)]}return null},L$3.get.hwb=function(t){if(!t)return null;var e=t.match(/^hwb\(\s*([+-]?\d{0,3}(?:\.\d+)?)(?:deg)?\s*,\s*([+-]?[\d\.]+)%\s*,\s*([+-]?[\d\.]+)%\s*(?:,\s*([+-]?(?=\.\d|\d)(?:0|[1-9]\d*)?(?:\.\d*)?(?:[eE][+-]?\d+)?)\s*)?\)$/);if(e){var n=parseFloat(e[4]);return[(parseFloat(e[1])%360+360)%360,k$3(parseFloat(e[2]),0,100),k$3(parseFloat(e[3]),0,100),k$3(isNaN(n)?1:n,0,1)]}return null},L$3.to.hex=function(){var t=N$3(arguments);return"#"+B$3(t[0])+B$3(t[1])+B$3(t[2])+(t[3]<1?B$3(Math.round(255*t[3])):"")},L$3.to.rgb=function(){var t=N$3(arguments);return t.length<4||1===t[3]?"rgb("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+")":"rgba("+Math.round(t[0])+", "+Math.round(t[1])+", "+Math.round(t[2])+", "+t[3]+")"},L$3.to.rgb.percent=function(){var t=N$3(arguments),e=Math.round(t[0]/255*100),n=Math.round(t[1]/255*100),r=Math.round(t[2]/255*100);return t.length<4||1===t[3]?"rgb("+e+"%, "+n+"%, "+r+"%)":"rgba("+e+"%, "+n+"%, "+r+"%, "+t[3]+")"},L$3.to.hsl=function(){var t=N$3(arguments);return t.length<4||1===t[3]?"hsl("+t[0]+", "+t[1]+"%, "+t[2]+"%)":"hsla("+t[0]+", "+t[1]+"%, "+t[2]+"%, "+t[3]+")"},L$3.to.hwb=function(){var t=N$3(arguments),e="";return t.length>=4&&1!==t[3]&&(e=", "+t[3]),"hwb("+t[0]+", "+t[1]+"%, "+t[2]+"%"+e+")"},L$3.to.keyword=function(t){return P$2[t.slice(0,3)]};var U$3={exports:{}},F$3=_$3,D$3={};for(var z$3 in F$3)F$3.hasOwnProperty(z$3)&&(D$3[F$3[z$3]]=z$3);var j$3=U$3.exports={rgb:{channels:3,labels:"rgb"},hsl:{channels:3,labels:"hsl"},hsv:{channels:3,labels:"hsv"},hwb:{channels:3,labels:"hwb"},cmyk:{channels:4,labels:"cmyk"},xyz:{channels:3,labels:"xyz"},lab:{channels:3,labels:"lab"},lch:{channels:3,labels:"lch"},hex:{channels:1,labels:["hex"]},keyword:{channels:1,labels:["keyword"]},ansi16:{channels:1,labels:["ansi16"]},ansi256:{channels:1,labels:["ansi256"]},hcg:{channels:3,labels:["h","c","g"]},apple:{channels:3,labels:["r16","g16","b16"]},gray:{channels:1,labels:["gray"]}};for(var G$3 in j$3)if(j$3.hasOwnProperty(G$3)){if(!("channels"in j$3[G$3]))throw new Error("missing channels property: "+G$3);if(!("labels"in j$3[G$3]))throw new Error("missing channel labels property: "+G$3);if(j$3[G$3].labels.length!==j$3[G$3].channels)throw new Error("channel and label counts mismatch: "+G$3);var H$3=j$3[G$3].channels,V$3=j$3[G$3].labels;delete j$3[G$3].channels,delete j$3[G$3].labels,Object.defineProperty(j$3[G$3],"channels",{value:H$3}),Object.defineProperty(j$3[G$3],"labels",{value:V$3})}j$3.rgb.hsl=function(t){var e,n,r=t[0]/255,s=t[1]/255,i=t[2]/255,o=Math.min(r,s,i),a=Math.max(r,s,i),c=a-o;return a===o?e=0:r===a?e=(s-i)/c:s===a?e=2+(i-r)/c:i===a&&(e=4+(r-s)/c),(e=Math.min(60*e,360))<0&&(e+=360),n=(o+a)/2,[e,100*(a===o?0:n<=.5?c/(a+o):c/(2-a-o)),100*n]},j$3.rgb.hsv=function(t){var e,n,r,s,i,o=t[0]/255,a=t[1]/255,c=t[2]/255,h=Math.max(o,a,c),u=h-Math.min(o,a,c),l=function(t){return(h-t)/6/u+.5};return 0===u?s=i=0:(i=u/h,e=l(o),n=l(a),r=l(c),o===h?s=r-n:a===h?s=1/3+e-r:c===h&&(s=2/3+n-e),s<0?s+=1:s>1&&(s-=1)),[360*s,100*i,100*h]},j$3.rgb.hwb=function(t){var e=t[0],n=t[1],r=t[2];return[j$3.rgb.hsl(t)[0],1/255*Math.min(e,Math.min(n,r))*100,100*(r=1-1/255*Math.max(e,Math.max(n,r)))]},j$3.rgb.cmyk=function(t){var e,n=t[0]/255,r=t[1]/255,s=t[2]/255;return[100*((1-n-(e=Math.min(1-n,1-r,1-s)))/(1-e)||0),100*((1-r-e)/(1-e)||0),100*((1-s-e)/(1-e)||0),100*e]},j$3.rgb.keyword=function(t){var e=D$3[t];if(e)return e;var n,r,s,i=1/0;for(var o in F$3)if(F$3.hasOwnProperty(o)){var c=(r=t,s=F$3[o],Math.pow(r[0]-s[0],2)+Math.pow(r[1]-s[1],2)+Math.pow(r[2]-s[2],2));c<i&&(i=c,n=o)}return n},j$3.keyword.rgb=function(t){return F$3[t]},j$3.rgb.xyz=function(t){var e=t[0]/255,n=t[1]/255,r=t[2]/255;return[100*(.4124*(e=e>.04045?Math.pow((e+.055)/1.055,2.4):e/12.92)+.3576*(n=n>.04045?Math.pow((n+.055)/1.055,2.4):n/12.92)+.1805*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)),100*(.2126*e+.7152*n+.0722*r),100*(.0193*e+.1192*n+.9505*r)]},j$3.rgb.lab=function(t){var e=j$3.rgb.xyz(t),n=e[0],r=e[1],s=e[2];return r/=100,s/=108.883,n=(n/=95.047)>.008856?Math.pow(n,1/3):7.787*n+16/116,[116*(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116)-16,500*(n-r),200*(r-(s=s>.008856?Math.pow(s,1/3):7.787*s+16/116))]},j$3.hsl.rgb=function(t){var e,n,r,s,i,o=t[0]/360,a=t[1]/100,c=t[2]/100;if(0===a)return[i=255*c,i,i];e=2*c-(n=c<.5?c*(1+a):c+a-c*a),s=[0,0,0];for(var h=0;h<3;h++)(r=o+1/3*-(h-1))<0&&r++,r>1&&r--,s[h]=255*(i=6*r<1?e+6*(n-e)*r:2*r<1?n:3*r<2?e+(n-e)*(2/3-r)*6:e);return s},j$3.hsl.hsv=function(t){var e=t[0],n=t[1]/100,r=t[2]/100,s=n,i=Math.max(r,.01);return n*=(r*=2)<=1?r:2-r,s*=i<=1?i:2-i,[e,100*(0===r?2*s/(i+s):2*n/(r+n)),(r+n)/2*100]},j$3.hsv.rgb=function(t){var e=t[0]/60,n=t[1]/100,r=t[2]/100,s=Math.floor(e)%6,i=e-Math.floor(e),o=255*r*(1-n),a=255*r*(1-n*i),c=255*r*(1-n*(1-i));switch(r*=255,s){case 0:return[r,c,o];case 1:return[a,r,o];case 2:return[o,r,c];case 3:return[o,a,r];case 4:return[c,o,r];case 5:return[r,o,a]}},j$3.hsv.hsl=function(t){var e,n,r,s=t[0],i=t[1]/100,o=t[2]/100,a=Math.max(o,.01);return r=(2-i)*o,n=i*a,[s,100*(n=(n/=(e=(2-i)*a)<=1?e:2-e)||0),100*(r/=2)]},j$3.hwb.rgb=function(t){var e,n,r,s,i,o,a,c=t[0]/360,h=t[1]/100,u=t[2]/100,l=h+u;switch(l>1&&(h/=l,u/=l),r=6*c-(e=Math.floor(6*c)),0!=(1&e)&&(r=1-r),s=h+r*((n=1-u)-h),e){default:case 6:case 0:i=n,o=s,a=h;break;case 1:i=s,o=n,a=h;break;case 2:i=h,o=n,a=s;break;case 3:i=h,o=s,a=n;break;case 4:i=s,o=h,a=n;break;case 5:i=n,o=h,a=s}return[255*i,255*o,255*a]},j$3.cmyk.rgb=function(t){var n=t[1]/100,r=t[2]/100,s=t[3]/100;return[255*(1-Math.min(1,t[0]/100*(1-s)+s)),255*(1-Math.min(1,n*(1-s)+s)),255*(1-Math.min(1,r*(1-s)+s))]},j$3.xyz.rgb=function(t){var e,n,r,s=t[0]/100,i=t[1]/100,o=t[2]/100;return n=-.9689*s+1.8758*i+.0415*o,r=.0557*s+-.204*i+1.057*o,e=(e=3.2406*s+-1.5372*i+-.4986*o)>.0031308?1.055*Math.pow(e,1/2.4)-.055:12.92*e,n=n>.0031308?1.055*Math.pow(n,1/2.4)-.055:12.92*n,r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:12.92*r,[255*(e=Math.min(Math.max(0,e),1)),255*(n=Math.min(Math.max(0,n),1)),255*(r=Math.min(Math.max(0,r),1))]},j$3.xyz.lab=function(t){var e=t[0],n=t[1],r=t[2];return n/=100,r/=108.883,e=(e/=95.047)>.008856?Math.pow(e,1/3):7.787*e+16/116,[116*(n=n>.008856?Math.pow(n,1/3):7.787*n+16/116)-16,500*(e-n),200*(n-(r=r>.008856?Math.pow(r,1/3):7.787*r+16/116))]},j$3.lab.xyz=function(t){var e,n,r;e=t[1]/500+(n=(t[0]+16)/116),r=n-t[2]/200;var i=Math.pow(n,3),o=Math.pow(e,3),a=Math.pow(r,3);return n=i>.008856?i:(n-16/116)/7.787,e=o>.008856?o:(e-16/116)/7.787,r=a>.008856?a:(r-16/116)/7.787,[e*=95.047,n*=100,r*=108.883]},j$3.lab.lch=function(t){var e,n=t[0],r=t[1],s=t[2];return(e=360*Math.atan2(s,r)/2/Math.PI)<0&&(e+=360),[n,Math.sqrt(r*r+s*s),e]},j$3.lch.lab=function(t){var e,r=t[1];return e=t[2]/360*2*Math.PI,[t[0],r*Math.cos(e),r*Math.sin(e)]},j$3.rgb.ansi16=function(t){var e=t[0],n=t[1],r=t[2],s=1 in arguments?arguments[1]:j$3.rgb.hsv(t)[2];if(0===(s=Math.round(s/50)))return 30;var i=30+(Math.round(r/255)<<2|Math.round(n/255)<<1|Math.round(e/255));return 2===s&&(i+=60),i},j$3.hsv.ansi16=function(t){return j$3.rgb.ansi16(j$3.hsv.rgb(t),t[2])},j$3.rgb.ansi256=function(t){var e=t[0],n=t[1],r=t[2];return e===n&&n===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(n/255*5)+Math.round(r/255*5)},j$3.ansi16.rgb=function(t){var e=t%10;if(0===e||7===e)return t>50&&(e+=3.5),[e=e/10.5*255,e,e];var n=.5*(1+~~(t>50));return[(1&e)*n*255,(e>>1&1)*n*255,(e>>2&1)*n*255]},j$3.ansi256.rgb=function(t){if(t>=232){var e=10*(t-232)+8;return[e,e,e]}var n;return t-=16,[Math.floor(t/36)/5*255,Math.floor((n=t%36)/6)/5*255,n%6/5*255]},j$3.rgb.hex=function(t){var e=(((255&Math.round(t[0]))<<16)+((255&Math.round(t[1]))<<8)+(255&Math.round(t[2]))).toString(16).toUpperCase();return"000000".substring(e.length)+e},j$3.hex.rgb=function(t){var e=t.toString(16).match(/[a-f0-9]{6}|[a-f0-9]{3}/i);if(!e)return[0,0,0];var n=e[0];3===e[0].length&&(n=n.split("").map((function(t){return t+t})).join(""));var r=parseInt(n,16);return[r>>16&255,r>>8&255,255&r]},j$3.rgb.hcg=function(t){var e,n=t[0]/255,r=t[1]/255,s=t[2]/255,i=Math.max(Math.max(n,r),s),o=Math.min(Math.min(n,r),s),a=i-o;return e=a<=0?0:i===n?(r-s)/a%6:i===r?2+(s-n)/a:4+(n-r)/a+4,e/=6,[360*(e%=1),100*a,100*(a<1?o/(1-a):0)]},j$3.hsl.hcg=function(t){var r,e=t[1]/100,n=t[2]/100,s=0;return(r=n<.5?2*e*n:2*e*(1-n))<1&&(s=(n-.5*r)/(1-r)),[t[0],100*r,100*s]},j$3.hsv.hcg=function(t){var n=t[2]/100,r=t[1]/100*n,s=0;return r<1&&(s=(n-r)/(1-r)),[t[0],100*r,100*s]},j$3.hcg.rgb=function(t){var n=t[1]/100,r=t[2]/100;if(0===n)return[255*r,255*r,255*r];var s,i=[0,0,0],o=t[0]/360%1*6,a=o%1,c=1-a;switch(Math.floor(o)){case 0:i[0]=1,i[1]=a,i[2]=0;break;case 1:i[0]=c,i[1]=1,i[2]=0;break;case 2:i[0]=0,i[1]=1,i[2]=a;break;case 3:i[0]=0,i[1]=c,i[2]=1;break;case 4:i[0]=a,i[1]=0,i[2]=1;break;default:i[0]=1,i[1]=0,i[2]=c}return[255*(n*i[0]+(s=(1-n)*r)),255*(n*i[1]+s),255*(n*i[2]+s)]},j$3.hcg.hsv=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e),r=0;return n>0&&(r=e/n),[t[0],100*r,100*n]},j$3.hcg.hsl=function(t){var e=t[1]/100,n=t[2]/100*(1-e)+.5*e,r=0;return n>0&&n<.5?r=e/(2*n):n>=.5&&n<1&&(r=e/(2*(1-n))),[t[0],100*r,100*n]},j$3.hcg.hwb=function(t){var e=t[1]/100,n=e+t[2]/100*(1-e);return[t[0],100*(n-e),100*(1-n)]},j$3.hwb.hcg=function(t){var n=1-t[2]/100,r=n-t[1]/100,s=0;return r<1&&(s=(n-r)/(1-r)),[t[0],100*r,100*s]},j$3.apple.rgb=function(t){return[t[0]/65535*255,t[1]/65535*255,t[2]/65535*255]},j$3.rgb.apple=function(t){return[t[0]/255*65535,t[1]/255*65535,t[2]/255*65535]},j$3.gray.rgb=function(t){return[t[0]/100*255,t[0]/100*255,t[0]/100*255]},j$3.gray.hsl=j$3.gray.hsv=function(t){return[0,0,t[0]]},j$3.gray.hwb=function(t){return[0,100,t[0]]},j$3.gray.cmyk=function(t){return[0,0,0,t[0]]},j$3.gray.lab=function(t){return[t[0],0,0]},j$3.gray.hex=function(t){var e=255&Math.round(t[0]/100*255),n=((e<<16)+(e<<8)+e).toString(16).toUpperCase();return"000000".substring(n.length)+n},j$3.rgb.gray=function(t){return[(t[0]+t[1]+t[2])/3/255*100]};var q$3=U$3.exports;function X$3(t,e){return function(n){return e(t(n))}}function J$3(t,e){for(var n=[e[t].parent,t],r=q$3[e[t].parent][t],s=e[t].parent;e[s].parent;)n.unshift(e[s].parent),r=X$3(q$3[e[s].parent][s],r),s=e[s].parent;return r.conversion=n,r}var Q$3=U$3.exports,K$3=function(t){for(var e=function(t){var e=function(){for(var t={},e=Object.keys(q$3),n=e.length,r=0;r<n;r++)t[e[r]]={distance:-1,parent:null};return t}(),n=[t];for(e[t].distance=0;n.length;)for(var r=n.pop(),s=Object.keys(q$3[r]),i=s.length,o=0;o<i;o++){var a=s[o],c=e[a];-1===c.distance&&(c.distance=e[r].distance+1,c.parent=r,n.unshift(a))}return e}(t),n={},r=Object.keys(e),s=r.length,i=0;i<s;i++){var o=r[i];null!==e[o].parent&&(n[o]=J$3(o,e))}return n},Z$3={};Object.keys(Q$3).forEach((function(t){Z$3[t]={},Object.defineProperty(Z$3[t],"channels",{value:Q$3[t].channels}),Object.defineProperty(Z$3[t],"labels",{value:Q$3[t].labels});var e=K$3(t);Object.keys(e).forEach((function(n){var r=e[n];Z$3[t][n]=function(t){var e=function(e){if(null==e)return e;arguments.length>1&&(e=Array.prototype.slice.call(arguments));var n=t(e);if("object"==typeof n)for(var r=n.length,s=0;s<r;s++)n[s]=Math.round(n[s]);return n};return"conversion"in t&&(e.conversion=t.conversion),e}(r),Z$3[t][n].raw=function(t){var e=function(e){return null==e?e:(arguments.length>1&&(e=Array.prototype.slice.call(arguments)),t(e))};return"conversion"in t&&(e.conversion=t.conversion),e}(r)}))}));var W$3=O$3.exports,tt$2=Z$3,et$2=[].slice,nt$2=["keyword","gray","hex"],rt$2={};Object.keys(tt$2).forEach((function(t){rt$2[et$2.call(tt$2[t].labels).sort().join("")]=t}));var st$2={};function it$2(t,e){if(!(this instanceof it$2))return new it$2(t,e);if(e&&e in nt$2&&(e=null),e&&!(e in tt$2))throw new Error("Unknown model: "+e);var n,r;if(null==t)this.model="rgb",this.color=[0,0,0],this.valpha=1;else if(t instanceof it$2)this.model=t.model,this.color=t.color.slice(),this.valpha=t.valpha;else if("string"==typeof t){var s=W$3.get(t);if(null===s)throw new Error("Unable to parse color from string: "+t);this.model=s.model,this.color=s.value.slice(0,r=tt$2[this.model].channels),this.valpha="number"==typeof s.value[r]?s.value[r]:1}else if(t.length){this.model=e||"rgb";var i=et$2.call(t,0,r=tt$2[this.model].channels);this.color=ht$2(i,r),this.valpha="number"==typeof t[r]?t[r]:1}else if("number"==typeof t)t&=16777215,this.model="rgb",this.color=[t>>16&255,t>>8&255,255&t],this.valpha=1;else{this.valpha=1;var o=Object.keys(t);"alpha"in t&&(o.splice(o.indexOf("alpha"),1),this.valpha="number"==typeof t.alpha?t.alpha:0);var a=o.sort().join("");if(!(a in rt$2))throw new Error("Unable to parse color from object: "+JSON.stringify(t));this.model=rt$2[a];var c=tt$2[this.model].labels,h=[];for(n=0;n<c.length;n++)h.push(t[c[n]]);this.color=ht$2(h)}if(st$2[this.model])for(r=tt$2[this.model].channels,n=0;n<r;n++){var u=st$2[this.model][n];u&&(this.color[n]=u(this.color[n]))}this.valpha=Math.max(0,Math.min(1,this.valpha)),Object.freeze&&Object.freeze(this)}function ot$2(t,e,n){return(t=Array.isArray(t)?t:[t]).forEach((function(t){(st$2[t]||(st$2[t]=[]))[e]=n})),t=t[0],function(r){var s;return arguments.length?(n&&(r=n(r)),(s=this[t]()).color[e]=r,s):(s=this[t]().color[e],n&&(s=n(s)),s)}}function at$2(t){return function(e){return Math.max(0,Math.min(t,e))}}function ct$2(t){return Array.isArray(t)?t:[t]}function ht$2(t,e){for(var n=0;n<e;n++)"number"!=typeof t[n]&&(t[n]=0);return t}it$2.prototype={toString:function(){return this.string()},toJSON:function(){return this[this.model]()},string:function(t){var e=this.model in W$3.to?this:this.rgb(),n=1===(e=e.round("number"==typeof t?t:1)).valpha?e.color:e.color.concat(this.valpha);return W$3.to[e.model](n)},percentString:function(t){var e=this.rgb().round("number"==typeof t?t:1),n=1===e.valpha?e.color:e.color.concat(this.valpha);return W$3.to.rgb.percent(n)},array:function(){return 1===this.valpha?this.color.slice():this.color.concat(this.valpha)},object:function(){for(var t={},e=tt$2[this.model].channels,n=tt$2[this.model].labels,r=0;r<e;r++)t[n[r]]=this.color[r];return 1!==this.valpha&&(t.alpha=this.valpha),t},unitArray:function(){var t=this.rgb().color;return t[0]/=255,t[1]/=255,t[2]/=255,1!==this.valpha&&t.push(this.valpha),t},unitObject:function(){var t=this.rgb().object();return t.r/=255,t.g/=255,t.b/=255,1!==this.valpha&&(t.alpha=this.valpha),t},round:function(t){return t=Math.max(t||0,0),new it$2(this.color.map(function(t){return function(e){return function(t,e){return Number(t.toFixed(e))}(e,t)}}(t)).concat(this.valpha),this.model)},alpha:function(t){return arguments.length?new it$2(this.color.concat(Math.max(0,Math.min(1,t))),this.model):this.valpha},red:ot$2("rgb",0,at$2(255)),green:ot$2("rgb",1,at$2(255)),blue:ot$2("rgb",2,at$2(255)),hue:ot$2(["hsl","hsv","hsl","hwb","hcg"],0,(function(t){return(t%360+360)%360})),saturationl:ot$2("hsl",1,at$2(100)),lightness:ot$2("hsl",2,at$2(100)),saturationv:ot$2("hsv",1,at$2(100)),value:ot$2("hsv",2,at$2(100)),chroma:ot$2("hcg",1,at$2(100)),gray:ot$2("hcg",2,at$2(100)),white:ot$2("hwb",1,at$2(100)),wblack:ot$2("hwb",2,at$2(100)),cyan:ot$2("cmyk",0,at$2(100)),magenta:ot$2("cmyk",1,at$2(100)),yellow:ot$2("cmyk",2,at$2(100)),black:ot$2("cmyk",3,at$2(100)),x:ot$2("xyz",0,at$2(100)),y:ot$2("xyz",1,at$2(100)),z:ot$2("xyz",2,at$2(100)),l:ot$2("lab",0,at$2(100)),a:ot$2("lab",1),b:ot$2("lab",2),keyword:function(t){return arguments.length?new it$2(t):tt$2[this.model].keyword(this.color)},hex:function(t){return arguments.length?new it$2(t):W$3.to.hex(this.rgb().round().color)},rgbNumber:function(){var t=this.rgb().color;return(255&t[0])<<16|(255&t[1])<<8|255&t[2]},luminosity:function(){for(var t=this.rgb().color,e=[],n=0;n<t.length;n++){var r=t[n]/255;e[n]=r<=.03928?r/12.92:Math.pow((r+.055)/1.055,2.4)}return.2126*e[0]+.7152*e[1]+.0722*e[2]},contrast:function(t){var e=this.luminosity(),n=t.luminosity();return e>n?(e+.05)/(n+.05):(n+.05)/(e+.05)},level:function(t){var e=this.contrast(t);return e>=7.1?"AAA":e>=4.5?"AA":""},isDark:function(){var t=this.rgb().color;return(299*t[0]+587*t[1]+114*t[2])/1e3<128},isLight:function(){return!this.isDark()},negate:function(){for(var t=this.rgb(),e=0;e<3;e++)t.color[e]=255-t.color[e];return t},lighten:function(t){var e=this.hsl();return e.color[2]+=e.color[2]*t,e},darken:function(t){var e=this.hsl();return e.color[2]-=e.color[2]*t,e},saturate:function(t){var e=this.hsl();return e.color[1]+=e.color[1]*t,e},desaturate:function(t){var e=this.hsl();return e.color[1]-=e.color[1]*t,e},whiten:function(t){var e=this.hwb();return e.color[1]+=e.color[1]*t,e},blacken:function(t){var e=this.hwb();return e.color[2]+=e.color[2]*t,e},grayscale:function(){var t=this.rgb().color,e=.3*t[0]+.59*t[1]+.11*t[2];return it$2.rgb(e,e,e)},fade:function(t){return this.alpha(this.valpha-this.valpha*t)},opaquer:function(t){return this.alpha(this.valpha+this.valpha*t)},rotate:function(t){var e=this.hsl(),n=e.color[0];return n=(n=(n+t)%360)<0?360+n:n,e.color[0]=n,e},mix:function(t,e){if(!t||!t.rgb)throw new Error('Argument to "mix" was not a Color instance, but rather an instance of '+typeof t);var n=t.rgb(),r=this.rgb(),s=void 0===e?.5:e,i=2*s-1,o=n.alpha()-r.alpha(),a=((i*o==-1?i:(i+o)/(1+i*o))+1)/2,c=1-a;return it$2.rgb(a*n.red()+c*r.red(),a*n.green()+c*r.green(),a*n.blue()+c*r.blue(),n.alpha()*s+r.alpha()*(1-s))}},Object.keys(tt$2).forEach((function(t){if(-1===nt$2.indexOf(t)){var e=tt$2[t].channels;it$2.prototype[t]=function(){if(this.model===t)return new it$2(this);if(arguments.length)return new it$2(arguments,t);var n="number"==typeof arguments[e]?e:this.valpha;return new it$2(ct$2(tt$2[this.model][t].raw(this.color)).concat(n),t)},it$2[t]=function(n){return"number"==typeof n&&(n=ht$2(et$2.call(arguments),e)),new it$2(n,t)}}}));var ut$2=it$2;function lt$2(t){return null==t}function ft$2(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function dt$2(t){return null!=t&&("function"==typeof t||null!==t.constructor&&t.constructor===Function)}function mt$2(t){return"object"==typeof t&&!!t}function pt$2(t){return"number"==typeof t&&!isNaN(t)}function bt$2(t){return t*Math.PI/180}function gt$2(t){return t/Math.PI*180}function yt$2(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}function wt$2(t){return Math.sign?Math.sign(t):0==(t=+t)||isNaN(t)?Number(t):t>0?1:-1}const vt$2=[1,1,1,1,2,2,3,0];function Tt$2(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=vt$2[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}function Ot$2(t,e,n){return t[3*n]=e[0],t[3*n+1]=e[1],t[3*n+2]=e[2],t}function _t$2(t){return t.flat?t.flat(1/0):t.reduce(((t,e)=>t.concat(e)),[])}function Mt$2(t){return t<256?Uint8Array:t<65536?Uint16Array:Uint32Array}function xt$2(t){return 0===t.indexOf("data:")}function At$2(t){const e=t.indexOf("base64,"),n=t.substring(e+7),r=window.atob(n),s=r.length,i=new Uint8Array(s);for(let t=0;t<s;t++)i[t]=r.charCodeAt(t);return i.buffer}function It$2(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(n)for(let e=0,r=n.length;e<r;e++)t.push(n[e])}return t.length}const St$2={};function Et$2(t,e){if(!Array.isArray(e)){e=St$2[e]=St$2[e]||ut$2(e).array().map((t=>t/255))}for(let n=0;n<e.length;n++)t[n]=e[n];return 3===e.length&&(t[3]=1),t}var Nt$2=Object.freeze({__proto__:null,isNil:lt$2,extend:ft$2,isFunction:dt$2,isObject:mt$2,isNumber:pt$2,toRadian:bt$2,toDegree:gt$2,getAbsoluteURL:yt$2,sign:wt$2,stringFromUTF8Array:Tt$2,setColumn3:Ot$2,flatArr:_t$2,getBatchIdArrayType:Mt$2,isBase64:xt$2,base64URLToArrayBuffer:At$2,pushIn:It$2,normalizeColor:Et$2});function Ct$2(t){return-1===t.indexOf("http://")&&-1===t.indexOf("https://")&&-1===t.indexOf("file://")}function Pt$2(t){return(t=t||{}).referrerPolicy=t.referrerPolicy||"origin",t.referrer=window&&window.location.href,t}const Rt$2="undefined"==typeof document?null:document.createElement("canvas");class Lt$2 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e}initialize(t){t(null)}loadTile(t,e,n){let r=null;e&&e.arraybuffer&&(r=[e.arraybuffer]);this.send({mapId:this.mapId,layerId:t,command:"loadTile",params:e},r,n)}abortTileLoading(t,e,n){this.broadcast({mapId:this.mapId,layerId:t,command:"abortTileLoading",params:{url:e}},null,n)}addLayer(t,e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,n)}removeLayer(t,e){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,e)}requestImage({url:t},e){const n=new Image;n.onload=()=>{if(!this.isActive())return;if(!Rt$2)return void e(new Error("There is no canvas to draw image!"));const t=function(t){if(kt$2(t.width)&&kt$2(t.height))return t;let e=t.width,n=t.height;kt$2(e)||(e=Bt$2(e)),kt$2(n)||(n=Bt$2(n));const r=document.createElement("canvas");r.width=e,r.height=n,r.getContext("2d").drawImage(t,0,0,e,n);const s=t.src,i=s.lastIndexOf("/")+1,o=s.substring(i);return console.warn(`Texture(${o})'s size is not power of two, resize from (${t.width}, ${t.height}) to (${e}, ${n})`),r}(n);Rt$2.width=t.width,Rt$2.height=t.height;const r=Rt$2.getContext("2d",{willReadFrequently:!0});r.drawImage(t,0,0,t.width,t.height);const s=r.getImageData(0,0,t.width,t.height),i={width:t.width,height:t.height,data:new Uint8Array(s.data)};e(null,i,[i.data.buffer])},n.onerror=function(t){e(t)},n.src=t}}function kt$2(t){return 0==(t&t-1)&&0!==t}function Bt$2(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}function Ut$1(t,e){if(t.scenes&&t.scenes.length)for(let n=0,r=t.scenes.length;n<r;n++){const r=t.scenes[n].nodes;for(let n=0,s=r.length;n<s;n++){Vt$1(r[n],[],t,e)}}}const Ft$2=[],Dt$2=[],zt$1=[],jt$1=[0,0,0],Gt$1=identity$1([]),Ht$1=[1,1,1];function Vt$1(t,e,n,r){const s=e.slice(0);if(t.matrix)s.push(t.matrix);else if(t.rotation||t.translation||t.scale){const e=fromTranslation$1(Ft$2,t.translation||jt$1),n=fromQuat(Dt$2,t.rotation||Gt$1),r=fromScaling(zt$1,t.scale||Ht$1);multiply$5(r,n,r);const i=multiply$5([],e,r);s.push(i)}if(t.children&&t.children.length)for(let e=0,i=t.children.length;e<i;e++)Vt$1(t.children[e],s,n,r);if(void 0!==t.mesh){const e=t.mesh,i=n.meshes[e];if(i){const t=s.slice(0),o=i.primitives;for(let s=0,i=o.length;s<i;s++){const i=o[s];i&&(i.matrices=t,r(i,e,s,n))}}}}function qt$1(t,e,n){let{byteOffset:r,byteStride:s}=e;const{componentType:i,itemSize:o}=e,a=e.array.buffer,c=i?X$8.getTypedArrayCtor(i):e.array.constructor;if(r=void 0===r?e.array.byteOffset:r,s=s||0,!s||s===o*c.BYTES_PER_ELEMENT&&r%c.BYTES_PER_ELEMENT==0){const e=new c(a,r+n*o*c.BYTES_PER_ELEMENT,o);return t.set(e),t}s||(s=o*c.BYTES_PER_ELEMENT);const h=new Uint8Array(a,s*n+r,o*c.BYTES_PER_ELEMENT);return new Uint8Array(t.buffer).set(h),t}function $t$1(t,e,n,r){t[4*e]=n[r],t[4*e+1]=n[r+4],t[4*e+2]=n[r+8],t[4*e+3]=n[r+12]}var Xt$1="#include <gl2_vert>\n\nconst float SHIFT_RIGHT_11 = 1.0 / 2048.0;\n\nconst float SHIFT_RIGHT_5 = 1.0 / 32.0;\n\nconst float SHIFT_LEFT_11 = 2048.0;\n\nconst float SHIFT_LEFT_5 = 32.0;\n\nconst float NORMALIZE_6 = 1.0 / 64.0;\n\nconst float NORMALIZE_5 = 1.0 / 32.0;\n\n\n\n#ifdef HAS_POSITION\n\n    attribute vec3 POSITION;\n\n#endif\n\n\n\n#if defined(HAS_RGB)\n\n    attribute vec3 RGB;\n\n#elif defined(HAS_RGBA)\n\n    attribute vec4 RGBA;\n\n#elif defined(HAS_RGB565)\n\n    attribute float RGB565;\n\n#endif\n\n\n\nuniform vec4 pointColor;\n\nuniform float pointSize;\n\n\n\nuniform mat4 projViewModelMatrix;\n\nuniform float pointOpacity;\n\n\n\nvarying vec4 vColor;\n\n\n\n#ifdef HAS_NORMAL\n\n    #ifdef HAS_NORMAL_OCT16P\n\n        attribute vec2 NORMAL_OCT16P;\n\n        float signNotZero(float value) {\n\n            return value >= 0.0 ? 1.0 : -1.0;\n\n        }\n\n        vec2 signNotZero(vec2 value) {\n\n            return vec2(signNotZero(value.x), signNotZero(value.y));\n\n        }\n\n        vec3 octDecode(vec2 encoded, float range) {\n\n            if (encoded.x == 0.0 && encoded.y == 0.0) {\n\n                return vec3(0.0, 0.0, 0.0);\n\n            }\n\n            encoded = encoded / range * 2.0 - 1.0;\n\n            vec3 v = vec3(encoded.x, encoded.y, 1.0 - abs(encoded.x) - abs(encoded.y));\n\n            if (v.z < 0.0) {\n\n                v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\n\n            }\n\n            return normalize(v);\n\n        }\n\n        vec3 octDecode(vec2 encoded) {\n\n            return octDecode(encoded, 255.0);\n\n        }\n\n    #else\n\n        attribute vec3 NORMAL;\n\n    #endif\n\n    uniform vec3 lightDir;\n\n    uniform mat3 modelNormalMatrix;\n\n    uniform mat4 positionMatrix;\n\n    float getLambertDiffuse(vec3 lightDir, vec3 normal) {\n\n        return max(dot(-lightDir, normal), 0.0);\n\n    }\n\n#endif\n\n#ifdef PICKING_MODE\n\n    #include <fbo_picking_vert>\n\n#endif\n\n#include <draco_decode_vert>\n\nvoid main() {\n\n    #ifdef HAS_POSITION\n\n        vec3 localPos = decode_getPosition(POSITION);\n\n    #endif\n\n    gl_Position = projViewModelMatrix * vec4(localPos, 1.0);\n\n    gl_PointSize = pointSize;\n\n\n\n    #ifdef PICKING_MODE\n\n        fbo_picking_setData(gl_Position.w, true);\n\n    #else\n\n        #if defined(HAS_RGB)\n\n            vColor = vec4(RGB / 255.0, 1.0) * pointOpacity;\n\n        #elif defined(HAS_RGBA)\n\n            vColor = RGBA / 255.0 * pointOpacity;\n\n        #elif defined(HAS_RGB565)\n\n            float compressed = RGB565;\n\n            float r = floor(compressed * SHIFT_RIGHT_11);\n\n            compressed -= r * SHIFT_LEFT_11;\n\n            float g = floor(compressed * SHIFT_RIGHT_5);\n\n            compressed -= g * SHIFT_LEFT_5;\n\n            float b = compressed;\n\n            vec3 rgb = vec3(r * NORMALIZE_5, g * NORMALIZE_6, b * NORMALIZE_5);\n\n            vColor = vec4(rgb, 1.0);\n\n        #else\n\n            vColor = pointColor;\n\n        #endif\n\n\n\n        #ifdef HAS_NORMAL\n\n            mat3 positionNormalMatrix = mat3(positionMatrix);\n\n            mat3 normalMatrix = modelNormalMatrix * positionNormalMatrix;\n\n            #ifdef HAS_NORMAL_OCT16P\n\n                vec3 localNormal = octDecode(NORMAL_OCT16P);\n\n            #else\n\n                vec3 localNormal = NORMAL;\n\n            #endif\n\n            vec3 normal = normalize(normalMatrix * localNormal);\n\n            float colorStrength = getLambertDiffuse(lightDir, normal);\n\n            colorStrength = max(colorStrength, 0.5);\n\n            vColor *= colorStrength;\n\n        #endif\n\n    #endif\n\n\n\n\n\n\n\n\n\n}\n\n";const Jt$1=new Array(3),Qt$1=new Array(3),Kt$1=[40680631590769,40680631590769,40408299984661.445];function Zt$1(t,e,n,r){const s=Kt$1,i=Math.cos(n);Jt$1[0]=i*Math.cos(e),Jt$1[1]=i*Math.sin(e),Jt$1[2]=Math.sin(n),ae$1(Jt$1,Jt$1),multiply$4(Qt$1,s,Jt$1);const o=Math.sqrt(dot$4(Jt$1,Qt$1));var a,c,h;return(a=Qt$1)[0]=(c=Qt$1)[0]/(h=o),a[1]=c[1]/h,a[2]=c[2]/h,scale$4(Jt$1,Jt$1,r),add$4(t,Qt$1,Jt$1)}const Yt$1=[1/6378137,1/6378137,1/6356752.314245179],Wt$1=[1/40680631590769,1/40680631590769,1/40408299984661.445],te$1=new Array(3),ee$1=new Array(3),ne$1=new Array(3);function re$1(t,e){const n=Wt$1,r=function(t,e,n,r,s){const i=e[0],o=e[1],a=e[2],c=n[0],h=n[1],u=n[2],l=i*i*c*c,f=o*o*h*h,d=a*a*u*u,m=l+f+d,p=Math.sqrt(1/m),b=scale$4(se$1,e,p);if(m<.1)return isFinite(p)?b:void 0;const g=r[0],y=r[1],v=r[2],T=ie$1;T[0]=b[0]*g*2,T[1]=b[1]*y*2,T[2]=b[2]*v*2;let O,_,M,x,A,I,S,E,N,C,P,R=(1-p)*oe$1(e)/(.5*oe$1(T)),L=0;do{R-=L,M=1/(1+R*g),x=1/(1+R*y),A=1/(1+R*v),I=M*M,S=x*x,E=A*A,N=I*M,C=S*x,P=E*A,O=l*I+f*S+d*E-1,_=l*N*g+f*C*y+d*P*v,L=O/(-2*_)}while(Math.abs(O)>1e-12);return t[0]=i*M,t[1]=o*x,t[2]=a*A,t}(te$1,e,Yt$1,n);let s=mul$4(ee$1,r,n);s=ae$1(s,s);const i=sub$2(ne$1,e,r),o=Math.atan2(s[1],s[0]),a=Math.asin(s[2]),c=wt$2(dot$4(i,e))*oe$1(i);return t[0]=gt$2(o),t[1]=gt$2(a),t[2]=c,t}const se$1=new Array(3),ie$1=new Array(3);function oe$1(t){return length$4(t)}function ae$1(t,e){const n=e[0],r=e[1],s=e[2];let i=n*n+r*r+s*s;return i>0&&(i=Math.sqrt(i),t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i),t}function ce$1(t,e){return multiply$4(e,t,Wt$1),normalize$4(e,e)}function he$1(t,e){const n=t[0],r=t[1],s=Math.cos(r),i=s*Math.cos(n),o=s*Math.sin(n),a=Math.sin(r);return e.x=i,e.y=o,e.z=a,normalize$4(e,e)}var ue$1=Object.freeze({__proto__:null,radianToCartesian3:Zt$1,cartesian3ToDegree:re$1,normalizeCartesian:ae$1,geodeticSurfaceNormal:ce$1,geodeticSurfaceNormalCartographic:he$1});function le$1(t,e,n,r){n=n||0,r=r||n;const s=Math.abs(t-e);return s<=r||s<=n*Math.max(Math.abs(t),Math.abs(e))}function fe$1(t,e){let n="";for(let r=0;r<4;r++){const s=t.getUint8(e+r);n+=String.fromCharCode(s)}return n}const de$1="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function me$1(t,e,n){const r=new Uint8Array(t,e,n);return de$1?JSON.parse(de$1.decode(r)):JSON.parse(Tt$2(r))}function pe$1(t,e,n){const r=new Uint8Array(t,e,n);return de$1?JSON.parse(de$1.decode(r)):JSON.parse(Tt$2(r))}function be$1(t,e,n){return{offset:e,byteLength:n}}function ge$1(t,e,n,r){const{byteOffset:s,componentType:i,type:o}=t,{ctor:a,type:c}=_e$1(i||"UNSIGNED_SHORT"),h=Te$1(o);return{byteStride:0,byteOffset:s+n,itemSize:h,count:r*h,componentType:c,array:new a(e,n+s,r*h)}}function ye$1(t,e,n,r){const s=ge$1(t,e,n,r);return s.array.buffer.byteLength!==e.byteLength&&(s.array=s.array.slice()),s}function we$1(t,e,n,r){const{byteOffset:s,componentType:i,type:o}=t,{ctor:a}=_e$1(i||"UNSIGNED_SHORT"),c=Te$1(o),h=new a(e,s,n*c);return 1===c?h[r]:h.subarray(r*c,r*c+c)}const ve$1={SCALAR:1,VEC2:2,VEC3:3,VEC4:4};function Te$1(t){return t?ve$1[t]:1}const Oe$1={BYTE:{ctor:Int8Array,type:5120,name:"Int8Array"},UNSIGNED_BYTE:{ctor:Uint8Array,type:5121,name:"Uint8Array"},SHORT:{ctor:Int16Array,type:5122,name:"Int16Array"},UNSIGNED_SHORT:{ctor:Uint16Array,type:5123,name:"Uint16Array"},INT:{ctor:Int32Array,type:5124,name:"Int32Array"},UNSIGNED_INT:{ctor:Uint32Array,type:5125,name:"Uint32Array"},FLOAT:{ctor:Float32Array,type:5126,name:"Float32Array"},DOUBLE:{ctor:Float64Array,type:5126,name:"Float64Array"}};function _e$1(t){return Oe$1[t]}function Me$1(t){for(const e in Oe$1)if(t===Oe$1[e].ctor)return Oe$1[e].type;throw new Error("unrecognized ctor:"+t)}function xe$1(t,e,n,r){const s=t,i=e.length/3;for(let t=0;t<i;t++)s[3*t]=e[3*t]/65535*r[0]+n[0],s[3*t+1]=e[3*t+1]/65535*r[1]+n[1],s[3*t+2]=e[3*t+2]/65535*r[2]+n[2];return s}function Ae$1(t,e,n){const r=t.getUint32(12,!0),s=t.getUint32(16,!0),i=t.getUint32(20,!0),o=t.getUint32(24,!0),a=t.buffer;let c,h={},u={},l=null;r>0&&(h=me$1(a,e,r),e+=r),s>0&&(c=function(t,e,n){return{offset:e,byteLength:n}}(0,e,s),e+=s),i>0&&(u=pe$1(a,e,i),e+=i);const f=be$1(0,e,o);return l=a.slice(f.offset,f.offset+f.byteLength),n.push(l),{featureTable:h,featureTableBin:c,batchTable:u,batchTableBin:l}}const Ie$1={up:{south:"east",north:"west",west:"south",east:"north"},down:{south:"west",north:"east",west:"north",east:"south"},south:{up:"west",down:"east",west:"down",east:"up"},north:{up:"east",down:"west",west:"up",east:"down"},west:{up:"north",down:"south",north:"down",south:"up"},east:{up:"south",down:"north",north:"up",south:"down"}},Se$1={north:[-1,0,0],east:[0,1,0],up:[0,0,1],south:[1,0,0],west:[0,-1,0],down:[0,0,-1]},Ee$1={},Ne$1={east:[],north:[],up:[],west:[],south:[],down:[]};let Ce$1=[],Pe$1=[],Re$1=[];const Le$1=[0,0,0];function ke$1(t,e,n){return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=t[3],n[4]=t[4],n[5]=t[5],n[6]=t[6],n[7]=t[7],n[8]=t[8],n[9]=t[9],n[10]=t[10],n[11]=t[11],n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=t[15],n}const Be$1=function(t,e){const n=Ie$1[t][e];let r;const s=t+e;return Ee$1[s]?r=Ee$1[s]:(r=function(r,s,i){if(equals$5(r,Le$1))copy$4(Ce$1,Se$1[t]),copy$4(Pe$1,Se$1[e]),copy$4(Re$1,Se$1[n]);else if(le$1(r[0],0,1e-14)&&le$1(r[1],0,1e-14)){const s=wt$2(r[2]);copy$4(Ce$1,Se$1[t]),copy$4(Pe$1,Se$1[e]),scale$4(Pe$1,Pe$1,s),copy$4(Re$1,Se$1[n]),"east"!==n&&"west"!==n&&scale$4(Re$1,Re$1,s)}else{ce$1(r,Ne$1.up);const s=Ne$1.up,i=Ne$1.east;i[0]=-r[1],i[1]=r[0],i[2]=0,normalize$4(Ne$1.east,i),cross$1(Ne$1.north,s,i),scale$4(Ne$1.down,Ne$1.up,-1),scale$4(Ne$1.west,Ne$1.east,-1),scale$4(Ne$1.south,Ne$1.north,-1),Ce$1=Ne$1[t],Pe$1=Ne$1[e],Re$1=Ne$1[n]}return i[0]=Ce$1[0],i[1]=Ce$1[1],i[2]=Ce$1[2],i[3]=0,i[4]=Pe$1[0],i[5]=Pe$1[1],i[6]=Pe$1[2],i[7]=0,i[8]=Re$1[0],i[9]=Re$1[1],i[10]=Re$1[2],i[11]=0,i[12]=r[0],i[13]=r[1],i[14]=r[2],i[15]=1,i},Ee$1[s]=r),r}("east","north"),Ue$1=[],Fe$1=[],De$1=[],ze$1=[],je$1=[],Ge$1=[],He$1=[],Ve$1={x:0,y:0},qe$1={x:0,y:0},$e$1=Math.PI/180;let Xe$1;const Je$1={width:100,height:10};class Ke$1{constructor(t,e={}){if(!Array.isArray(t))return void console.error("colors is not array");if(t.length<2)return void console.error("colors.length should >1");this.colors=t;let n=1/0,r=-1/0;for(let e=0,s=t.length;e<s;e++){const s=t[e][0];n=Math.min(s,n),r=Math.max(s,r)}this.min=n,this.max=r,this.valueOffset=this.max-this.min,this.options=Object.assign({},Je$1,e),this.t()}getImageData(){return this.imgData}t(){const t=function(){if(!Xe$1){const{width:t,height:e}=Je$1;OffscreenCanvas?Xe$1=new OffscreenCanvas(t,e):(Xe$1=document.createElement("canvas"),Xe$1.width=t,Xe$1.height=e)}return Xe$1}(),{width:e,height:n}=this.options;t.width=e,t.height=n;const r=t.getContext("2d");r.clearRect(0,0,t.width,t.height);const s=r.createLinearGradient(0,0,t.width,0),{colors:i,valueOffset:o}=this;for(let t=0,e=i.length;t<e;t++){const[e,n]=i[t];s.addColorStop((e-this.min)/o,n)}r.fillStyle=s,r.fillRect(0,0,t.width,t.height),this.imgData=r.getImageData(0,0,t.width,t.height)}getColor(t){t=Math.max(this.min,t);const e=((t=Math.min(t,this.max))-this.min)/this.valueOffset;let n=Math.round(e*this.imgData.width);n=Math.min(n,this.imgData.width-1);const r=4*n;return[this.imgData.data[r],this.imgData.data[r+1],this.imgData.data[r+2],this.imgData.data[r+3]]}}var Ze$1;function Ye$1(t,e){for(let n=0;n<t.stops.length;n++)if(e===t.stops[n][0])return t.stops[n][1];return t.default}function We$1(t,e){for(var n=0;n<t.stops.length&&!(e<t.stops[n][0]);n++);return t.stops[Math.max(n-1,0)][1]}function tn$1(t,e){for(var n=void 0!==t.base?t.base:1,r=0;!(r>=t.stops.length||e<=t.stops[r][0]);)r++;return 0===r?t.stops[r][1]:r===t.stops.length?t.stops[r-1][1]:function t(e,n,r,s,i,o){return"function"==typeof i?function(){var a=i.apply(void 0,arguments),c=o.apply(void 0,arguments);return t(e,n,r,s,a,c)}:i.length?function(t,e,n,r,s,i){var o=[];for(let a=0;a<s.length;a++)o[a]=sn$1(t,e,n,r,s[a],i[a]);return o}(e,n,r,s,i,o):sn$1(e,n,r,s,i,o)}(e,n,t.stops[r-1][0],t.stops[r][0],t.stops[r-1][1],t.stops[r][1])}"function"==typeof Map&&(Ze$1=new Map);const en$1={width:100,height:1};function nn$1(t,e){const n=t.stops;if(n&&n.length>1){let t;if(Ze$1){const e=JSON.stringify(n);if(!Ze$1.has(e)){const t=new Ke$1(n,en$1);Ze$1.set(e,t)}t=Ze$1.get(e)}else t=new Ke$1(n,en$1);const[r,s,i,o]=t.getColor(e);return[r/255,s/255,i/255,o/255]}return n&&1===n.length?n[0][1]:null}function rn$1(t,e){return r=t.default,void 0!==(n=e)?n:void 0!==r?r:null;var n,r}function sn$1(t,e,n,r,s,i){var o,a=r-n,c=t-n;return s*(1-(o=1===e?c/a:(Math.pow(e,c)-1)/(Math.pow(e,a)-1)))+i*o}function on$1(t){return t&&"object"==typeof t&&(t.stops||t.property&&"identity"===t.type)}function an$1(t){return function t(e,n){if(!on$1(e))return function(){return e};let r=!0,s=!0;const i=(e=JSON.parse(JSON.stringify(e))).stops;if(i)for(let e=0;e<i.length;e++)if(on$1(i[e][1])){const o=t(i[e][1],n);r=r&&o.isZoomConstant,s=s&&o.isFeatureConstant,i[e]=[i[e][0],o]}const o=function t(e,n){var r,s,i;if(on$1(e)){var o,a=e.stops&&"object"==typeof e.stops[0][0],h=a||!(a||void 0!==e.property),u=e.type||n||"exponential";if("exponential"===u)o=tn$1;else if("interval"===u)o=We$1;else if("categorical"===u)o=Ye$1;else if("identity"===u)o=rn$1;else{if("color-interpolate"!==u)throw new Error('Unknown function type "'+u+'"');o=nn$1}if(a){var l={},f=[];for(let t=0;t<e.stops.length;t++){var d=e.stops[t];void 0===l[d[0].zoom]&&(l[d[0].zoom]={zoom:d[0].zoom,type:e.type,property:e.property,default:e.default,stops:[]}),l[d[0].zoom].stops.push([d[0].value,d[1]])}for(let e in l)f.push([l[e].zoom,t(l[e])]);r=function(t,n){const r=tn$1({stops:f,base:e.base},t)(t,n);return"function"==typeof r?r(t,n):r},s=!1,i=!1}else h?(r=function(t){const n=o(e,t);return"function"==typeof n?n(t):n},s=!0,i=!1):(r=function(t,n){const r=o(e,n?n[e.property]:null);return"function"==typeof r?r(t,n):r},s=!1,i=!0)}else r=function(){return e},s=!0,i=!0;return r.isZoomConstant=i,r.isFeatureConstant=s,r}(e,n);return o.isZoomConstant=r&&o.isZoomConstant,o.isFeatureConstant=s&&o.isFeatureConstant,o}(t,"exponential")}const{getTextureMagFilter:cn$1,getTextureMinFilter:hn$1,getTextureWrap:un$1,getMaterialType:ln$1,getMaterialFormat:fn$1,getPrimitive:dn$1,getUniqueREGLBuffer:mn$1}=_e$5,pn$1=[1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1],bn$1=[0,0,1,0,0,1,0,0,-1,0,0,0,0,0,0,1],{loginIBLResOnCanvas:gn$1,logoutIBLResOnCanvas:yn$1,getIBLResOnCanvas:wn$1,getPBRUniforms:vn$1}=fi$4.PBRUtils,Tn$1={factor:0,units:0},On$1=[1,1,1,1],_n$1=[0,0,0],Mn$1={specularStrength:0,materialShininess:1},xn$1=[1,1,1],An$1=identity$2([]),In$1=[0,0],Sn$1=t=>t.material instanceof Ie$5,En$1=t=>t.material instanceof fi$4.StandardMaterial,Nn$1=[],Cn$1=new t__namespace.Coordinate(0,0),Pn$1=new t__namespace.Point(0,0),Rn$1=new t__namespace.Point(0,0),Ln$1=new t__namespace.Point(0,0),kn$1=[],Bn$1=[],Un$1=[],Fn$1=[],Dn$1=[],zn$1=[],jn$1=[],Gn$1=[0,0,0],Hn$1=[],Vn$1=[],qn$1={POSITION:"POSITION",NORMAL:"NORMAL",TEXCOORD_0:"TEXCOORD_0",TEXCOORD_1:"TEXCOORD_1",COLOR_0:"COLOR_0",TANGENT:"TANGENT",_BATCHID:"_BATCHID"},$n$1=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],Xn$1=function(t,e){const n=2*Math.PI/t,r=[],s=[];for(let s=0;s<=t;s++){const t=1*Math.cos(n*s),i=1*Math.sin(n*s),o=0;r[3*s]=t,r[3*s+1]=i,r[3*s+2]=o}for(let s=t;s<=200;s++){const t=1*Math.cos(n*s),i=1*Math.sin(n*s);r[3*s]=0,r[3*s+1]=t,r[3*s+2]=i}for(let s=200;s<=300;s++){const t=1*Math.cos(n*s),i=1*Math.sin(n*s),o=0;r[3*s]=t,r[3*s+1]=o,r[3*s+2]=i}const i=r.length/3-1;for(let e=0;e<i;e++)99!==e&&199!==e&&(s[2*e]=e,s[2*e+1]=e+1);return r.push(0,0,0),r.push(1,0,0),r.push(0,1,0),r.push(0,0,1),s.push(i+1,i+2),s.push(i+1,i+3),s.push(i+1,i+4),{vertices:r,indices:s}}
/*!
	 * @maptalks/gl v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.com
	 */(100),Jn$1=[0,0,0,1],Qn$1=[1,1,1];class Kn$1{constructor(e,r){this.s=r,this.i=r.getRenderer().canvas,this.pickingFBO=r.getRenderer().pickingFBO,this.o=new t__namespace.SpatialReference,this.h=e,this.u=new B$6(e),this.m={},this.p={},this.v={},this.T={},this.O={},this._={},this.M=new Ke$5,this.A=new Ke$5,this.I=new Ke$5,this.S=new Ke$5,this.N=new Ve$5(e.texture(2)),this.C=this.P.bind(this),this.R=new Ie$5({baseColorFactor:[1,1,1,1]}),this.L(),this.k=new Nr$4(this.h,this.B(),this.N);const s=this.getMap();s.altitudeToPoint&&(this.U=s.altitudeToPoint(100,s.getGLRes())/100)}getI3DMMeshes(){return this.T}getPNTSMeshes(){return this.v}getB3DMMeshes(){return this.p}getPaintedMeshes(){return this.F}getMap(){return this.s.getMap()}paint(t,e,n){const i=n&&n.renderTarget,o=n&&n.sceneFilter,a=this.getMap();if(!t.length||!a)return null;const c=this.D(),h=a.projViewMatrix,u=[],l=[],d=[],m=[],p=[],b=this.j(t),g=[];for(let i=0,o=t.length;i<o;i++){const o=t[i].data.node;let a=this.G(o);if(!a)continue;const c=this.s.H(o.V);o.q&&c.debugShowBoundingVolume&&g.push(o.q);const y=c.heightOffset||0,w=c.coordOffset||In$1;this.O[o.id]&&(a=this.O[o.id],a=_t$2(a));let v=c.polygonOffset||Tn$1;dt$2(v)&&(v=v()),Array.isArray(a)||(u[0]=a,a=u);for(let t=0,i=a.length;t<i;t++){const i=a[t].properties.magic;if(a[t].properties.heightOffset===y&&a[t].properties.coordOffset[0]===w[0]&&a[t].properties.coordOffset[1]===w[1]||(this.$(a[t]),a[t].X=copy$5([],a[t].localTransform)),"b3dm"===i){if(a[t].getBoundingBox&&!intersectsBox$1(h,a[t].getBoundingBox()))continue;const{batchIdData:e,batchIdMap:r}=a[t].geometry.properties;if(e&&r){const e=a[t].properties.node.V;this.J&&this.J[e]?Ws$3.highlightMesh(this.h,a[t],this.J[e],this.K,r):this.J&&this.J[e]||Ws$3.highlightMesh(this.h,a[t],null,this.K,r),Ws$3.showOnly(this.h,a[t],this.Z&&this.Z[e],this.Y,r)}n&&n.bloom&&a[t].properties.hlBloomMesh&&(a[t].properties.hlBloomMesh.properties.depthFunc="always",a[t].properties.hlBloomMesh.properties.polygonOffset=v,d.push(a[t].properties.hlBloomMesh)),d.push(a[t])}else"pnts"===i?m.push(a[t]):"i3dm"===i&&p.push(a[t]);a[t].properties.isLeaf=!!e[o.id],a[t].properties.level=b.get(o.W),a[t].properties.polygonOffset=v,a[t].tt=o,e[o.id]||l.push(a[t]),this.et(a[t]),this.nt(a[t],o)}}let y=0;const w=this.k.getExcludeFilter();y+=this.rt(this.st,c,[o,Sn$1,w],i,l,d,p),y+=this.rt(this.it,c,[o,En$1,w],i,l,d,p),this.k.forEachShader(((t,e,n)=>{const r=this.D(n);y+=this.rt(t,r,[o,e],i,l,d,p)})),this.A.setMeshes(m);const v=this.ot();return y+=this.u.render(this.ct,v,this.A,i&&i.fbo),this.F={pntsMeshes:m,i3dmMeshes:p,b3dmMeshes:d},g.forEach((t=>{this.ht(t)})),this.S.setMeshes(g),this.u.render(this.ut,c,this.S,i&&i.fbo),y}ht(t){const e=t.properties.node,n=this.s.H(e.V),s=this.s.lt(e.V),a=n.heightOffset||0,c=this.ft(),u=set$4(Hn$1,0,0,c*(a-s.dt));let l=n.rotation||[0,0,0];l=fromEuler(zn$1,l[0],l[1],l[2]);const d=fromRotationTranslationScale(Dn$1,l,u,n.scale||[1,1,1]);multiply$5(t.localTransform,t.X,d)}rt(t,e,n,r,s,i,o){t.filter=n.filter((t=>!!t)),e.debug=!1,e.debug=!1;let a=0;return this.M.setMeshes(i),a+=this.u.render(t,e,this.M,r&&r.fbo),this.I.setMeshes(o),a+=this.u.render(t,e,this.I,r&&r.fbo),a}pt(t,e){return e.tt.bt-t.tt.bt}deleteTile(t){const e=t.node;e.q&&(e.q.geometry.dispose(),e.q.dispose(),delete e.q);this.gt(e.id)}gt(t){const e=this.p[t]||this.v[t]||this.T[t]||this.O[t]||this.m[t];this.O[t]?this.yt(t):e&&(this.wt(e),delete this.p[t],delete this.v[t],delete this.T[t],delete this.m[t])}yt(t){let e=this.O[t];e=_t$2(e);for(let t=0;t<e.length;t++){const{id:n}=e[t].properties;this.gt(n)}delete this.O[t]}wt(t){if(Array.isArray(t))for(let e=0,n=t.length;e<n;e++)this.wt(t[e]);else{Ws$3.showOnly(this.h,t),Ws$3.highlightMesh(this.h,t);const e=t.geometry.properties.url;if(e){const n=this._[e];n&&n.refMeshes&&(n.refMeshes.delete(t.uuid),n.refMeshes.size||(n.geometry.dispose(),n.material.dispose(),delete this._[e]))}else t.geometry.dispose(),t.material&&t.material.dispose();t.dispose()}}remove(){const t=this.s;yn$1(t.getRenderer().canvas,t.getMap());for(const t in this.O)this.yt(t);this.O={};for(const t in this.p)this.gt(t);this.p={};for(const t in this.v)this.gt(t);this.v={};for(const t in this.T)this.gt(t);this.T={};for(const t in this.m)this.gt(t);this.m={},this.st&&(this.st.dispose(),delete this.st),this.it&&(this.it.dispose(),delete this.it),this.ct&&(this.ct.dispose(),delete this.ct),this.ut&&(this.ut.dispose(),delete this.ut),this.k.dispose(),this.picking&&this.picking.dispose()}G(t){return this.p[t.id]||this.v[t.id]||this.T[t.id]||this.O[t.id]}has(t){return this.G(t)||this.m[t.id]}$(t){const e=t.properties.magic;"b3dm"===e?this.vt(t):"i3dm"===e?this.Tt(t):"pnts"===e&&this.Ot(t)}createPntsMesh(t,e,s,i){if(this.v[e]){const t=this.v[e];return console.warn(`pnts mesh with id(${e}) was already created.`),i(null,{id:e,mesh:t}),t}const{pnts:o,featureTable:a,rootIdx:c,compressed_int16_params:h}=t,u=a.POINTS_LENGTH;o.BATCH_ID||(o.BATCH_ID=new Uint8Array(u),o.BATCH_ID.fill(0));const l=new Q$7(o,null,u,{static:!0,primitive:"points",positionAttribute:"POSITION",pickingIdAttribute:"BATCH_ID"});l.generateBuffers(this.h);const f={};o.POSITION?f.HAS_POSITION=1:o.POSITION_QUANTIZED&&(f.HAS_POSITION_QUANTIZED=1),o.RGB?f.HAS_RGB=1:o.RGBA?f.HAS_RGBA=1:o.RGB565&&(f.HAS_RGB565=1),(o.NORMAL||o.NORMAL_OCT16P)&&(f.HAS_NORMAL=1,o.NORMAL_OCT16P&&(f.HAS_NORMAL_OCT16P=1)),this._t(f,h),t.featureTable.CONSTANT_RGBA&&(t.featureTable.CONSTANT_RGBA=t.featureTable.CONSTANT_RGBA.map((t=>t/255)));const{rtcCenter:d,rtcCoord:m,projCenter:p}=t,b=this.s.H(c),g=new Be$5(l);g.properties.magic="pnts",g.properties.id=e,g.properties.node=s,g.properties.count=u,g.properties.batchTable=t.batchTable,g.properties.batchTableBin=t.batchTableBin,g.properties.serviceIndex=c,g.properties.rtcCoord=m,g.properties.rtcCenter=d,g.properties.projCenter=p,g.setDefines(f),Object.defineProperty(g.uniforms,"pointColor",{enumerable:!0,get:function(){return t.featureTable.CONSTANT_RGBA?t.featureTable.CONSTANT_RGBA:b&&b.pointColor||[1,1,1,1]}});const y=this.getMap();let w=null,v=null;Object.defineProperty(g.uniforms,"pointSize",{enumerable:!0,get:function(){if(!b)return 2;if(on$1(b.pointSize)){const t=JSON.stringify(b.pointSize);return t!==w&&(v=an$1(b.pointSize),w=t),v(y.getZoom())}return b.pointSize||2}});let T=null,O=null;return Object.defineProperty(g.uniforms,"pointOpacity",{enumerable:!0,get:function(){if(!b)return 1;if(on$1(b.pointOpacity)){const t=JSON.stringify(b.pointOpacity);return t!==T&&(O=an$1(b.pointOpacity),T=t),O(y.getZoom())}return b.pointOpacity||1}}),this.Mt(g,h),this.Ot(g),g.X=copy$5([],g.localTransform),this.v[e]=g,i(null,{id:e,mesh:[g]}),[g]}Ot(t){const e=t.localTransform||[],{rtcCoord:n,node:r,projCenter:s}=t.properties;this.xt(e,n,s,r.V),t.setLocalTransform(e)}createI3DMMesh(t,e,s,a){if(this.T[e]){const t=this.T[e];return console.warn(`i3dm mesh with id(${e}) was already created.`),this.m[e]||a(null,{id:e,mesh:t}),t}const c=this.s.H(s.V),h=this.At(s.It),{i3dm:u,featureTable:l,gltf:f,batchTable:d,batchTableBin:m,count:b}=t,g=l.INSTANCES_LENGTH,{rtcCenter:y,rtcCoord:w}=t,v=this.St(Un$1,w),T=this.Et(Fn$1,s,y,w);multiply$5(v,T,v);const{POSITION:O,NORMAL_UP:_,NORMAL_RIGHT:M,SCALE:x,SCALE_NON_UNIFORM:A,INSTANCE_ROTATION:I}=u,S={instance_vectorA:new Float32Array(4*g),instance_vectorB:new Float32Array(4*g),instance_vectorC:new Float32Array(4*g),aPickingId:new Uint16Array(g)};for(let t=0;t<g;t++)S.aPickingId[t]=t;const E=new Float32Array(3),N=new Float32Array(3),C=[],P=new Float32Array(1),R=new Float32Array(3),L=[],k=[],B=[],U=[],F=new Float32Array(9);!function(t,e){let{byteOffset:n,byteStride:r,count:s}=t;const{componentType:i,itemSize:o}=t,a=t.array.buffer,c=i?X$8.getTypedArrayCtor(i):t.array.constructor;if(n=void 0===n?t.array.byteOffset:n,r=r||0,s=s||t.array.length/o,(!r||r===o*c.BYTES_PER_ELEMENT)&&n%c.BYTES_PER_ELEMENT==0){const t=new c(a,n,s*o);for(let r=0;r<s*o;r+=o)e(new c(t.buffer,n+r*c.BYTES_PER_ELEMENT,o),r/o);return}const h=new Uint8Array(o*c.BYTES_PER_ELEMENT);r||(r=o*c.BYTES_PER_ELEMENT);for(let t=0;t<s;t++){const s=new Uint8Array(a,r*t+n,o*c.BYTES_PER_ELEMENT);h.set(s),e(new c(h.buffer),t),s.set(h)}}(O,((t,e)=>{_?(qt$1(N,M,e),qt$1(E,_,e),cross$1(C,N,E),normalize$4(C,C),Ot$2(L,N,0),Ot$2(L,E,1),Ot$2(L,C,2),fromMat3(k,L)):I?(qt$1(F,I,e),fromMat3(k,F)):identity$1(k),x?(qt$1(P,x,e),set$4(B,P[0],P[0],P[0])):A?(qt$1(R,A,e),set$4(B,...R)):set$4(B,1,1,1),fromRotationTranslationScale(U,k,t,B),$t$1(S.instance_vectorA,e,U,0),$t$1(S.instance_vectorB,e,U,1),$t$1(S.instance_vectorC,e,U,2)}));const D={};for(const t in S)D[t]={buffer:this.h.buffer({dimension:S[t].length/g,data:S[t]}),divisor:1};const z=c.shader||"pbr";let j=0,G=!0;const H=[],V=[];return Ut$1(f,((t,i,o,a)=>{const c=this.Nt(t,i,o,a,s,!0,z,V),{geometry:u,material:l}=c;l&&!l.isReady()&&(G=!1,j++);const f=new Ge$5(D,g,u,l);c.refMeshes||(c.refMeshes=new Set,c.refMeshes.add(f.uuid)),f.properties.magic="i3dm",f.properties.id=e,f.properties.count=b,f.properties.batchTable=d,f.properties.batchTableBin=m,f.properties.serviceIndex=s.V,f.properties.rtcCoord=w,f.properties.rtcCenter=y,f.properties.node=s;const p=this.Ct(t,u,l,s.V,a);t.compressed_int16_params&&this.Mt(f,t.compressed_int16_params),this.Pt(f,t.attributes);const T=identity$2([]);if(t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(T,T,t.matrices[e]);multiply$5(T,h,T),f.setPositionMatrix(T),this.Tt(f,v),f.setDefines(p),f.properties.polygonOffset={offset:0,factor:0},H.push(f),delete t.attributes,f.X=copy$5([],f.localTransform)})),Zn$1(V),G?(this.T[e]=H,a(null,{id:e,mesh:H})):(this.m[e]={meshes:H,count:j},H.Rt=a),H}Tt(t,e){const{rtcCenter:n,rtcCoord:s,node:i}=t.properties;if(!e){multiply$5(e=this.St(Un$1,s),this.Et(Fn$1,i,n,s),e)}const o=this.s.H(i.V),a=t.localTransform||[];if(o.coordOffset){multiply$5(a,this.Lt(Fn$1,i.V,s),e)}else copy$5(a,e);t.setLocalTransform(a),t.properties.heightOffset=o.heightOffset||0,t.properties.coordOffset=o.coordOffset&&o.coordOffset.slice(0)||In$1}createB3DMMesh(e,s,i,o){if(e.gltf&&(e.gltf.transferables=null),this.p[s]||this.m[s]){const t=this.p[s];return console.warn(`mesh with id(${s}) was already created.`),this.m[s]||o(null,{id:s,mesh:t}),t}let a;if(i.maxExtent){const e=new t__namespace.Extent(i.maxExtent).convertTo((t=>this._pointToPrj(t)));a=[e.xmin,e.ymin,e.xmax,e.ymax]}const c=e.gltf,{projCenter:h}=c.extensions.MAPTALKS_RTC,{rtcCoord:u,center:l}=c.extensions.CESIUM_RTC,f=c.asset.sharePosition,d=this.At(i.It);let m;m=f?this.St(Un$1,u):this.xt(Un$1,u,h,i.V);const p=this.s.H(i.V);let b=p.shader||"pbr";if(p.unlit)b="phong";else if(c.materials)for(let t=0;t<c.materials.length;t++)if(c.materials[t]&&c.materials[t].extensions&&c.materials[t].extensions.KHR_materials_unlit){b="phong";break}const g=[],y=[];let w=0,v=!0;return Ut$1(c,((t,o,c,T)=>{const O=this.Nt(t,o,c,T,i,!1,b,g),{geometry:_,material:M}=O;M&&!M.isReady()&&(v=!1,w++);const x=new Be$5(_,M);O.refMeshes||(O.refMeshes=new Set,O.refMeshes.add(x.uuid)),x.properties.magic="b3dm",x.properties.id=s,x.properties.node=i,e.batchTable&&(x.properties.batchTable=e.batchTable,x.properties.batchTableBin=e.batchTableBin),x.properties.count=e.featureTable&&e.featureTable.BATCH_LENGTH||0,x.properties.serviceIndex=i.V;const A=this.Ct(t,_,M,i.V,T);x.setDefines(A);const I=t.compressUniforms;if(I)for(const t in I)x.setUniform(t,I[t]);t.compressed_int16_params&&this.Mt(x,t.compressed_int16_params),this.Pt(x,t.attributes),a&&(A.USE_MAX_EXTENT=1,x.setUniform("maxPrjExtent",a)),Object.prototype.hasOwnProperty.call(x.uniforms,"polygonOpacity")||Object.defineProperty(x.uniforms,"polygonOpacity",{enumerable:!0,get:function(){return pt$2(p.opacity)?p.opacity:1}}),Object.prototype.hasOwnProperty.call(x.uniforms,"polygonFill")||Object.defineProperty(x.uniforms,"polygonFill",{enumerable:!0,get:function(){return Et$2([],p.polygonFill||On$1)}}),Object.prototype.hasOwnProperty.call(x.material.uniforms,"hsv")||Object.defineProperty(x.material.uniforms,"hsv",{enumerable:!0,get:function(){return p.hsv||_n$1}});const S=identity$2([]);if(f&&t.matrices&&t.matrices.length)for(let e=0;e<t.matrices.length;e++)multiply$5(S,S,t.matrices[e]);f&&multiply$5(S,d,S),x.properties.node=i,x.properties.projCenter=h,x.properties.nodeMatrix=S,x.properties.isSharedPosition=f,x.properties.rtcCoord=u,x.properties.rtcCenter=l,this.vt(x,m),y.push(x),delete t.attributes,x.X=copy$5([],x.localTransform)})),Zn$1(g),v?(this.p[s]=y,o(null,{id:s,mesh:y})):(this.m[s]={meshes:y,count:w},y.Rt=o),y}kt(t){const e=this.s.Bt[t.id];if(!e)return;let s,i,o,a;if(e.length){if(2===e.length){const n=e[1];s=Xn$1.vertices,i=Xn$1.indices,o=e[0],a=[n,n,n]}}else s=e.boxPosition,i=$n$1,o=this.s.lt(t.V).Ut,a=Qn$1;const c=new Q$7({POSITION:s},i,0,{primitive:"lines",positionAttribute:"POSITION"}),h=new Be$5(c,new Ce$5({lineColor:[.8,.8,.1,1],lineOpacity:1})),u=identity$2([]);fromRotationTranslationScale(u,Jn$1,o,a),h.localTransform=u,h.X=copy$5([],u),h.properties.node=t,t.q=h}Mt(t,e){e.POSITION&&t.setUniform("compressedPositionRange",e.POSITION),e.TEXCOORD_0&&t.setUniform("compressedTexcoordRange_0",e.TEXCOORD_0),e.TEXCOORD_1&&t.setUniform("compressedTexcoordRange_1",e.TEXCOORD_0),e.NORMAL&&t.setUniform("compressedNormalRange",e.NORMAL),e.TANGENT&&t.setUniform("compressedTangentRange",e.TANGENT),e.compressed_ratio&&t.setUniform("compressed_ratio",e.compressed_ratio)}vt(t,e){const{isSharedPosition:n,rtcCoord:s,rtcCenter:i,projCenter:o,nodeMatrix:a,node:c}=t.properties;e||(e=n?this.St(Un$1,s):this.xt(Un$1,s,o,c.V));const h=t.localTransform||identity$2([]);if(n){const t=this.Et(Fn$1,c,i,s);multiply$5(h,e,a),multiply$5(h,t,h)}else multiply$5(h,e,a);const u=this.s.H(c.V);if(u.coordOffset){multiply$5(h,this.Lt(Fn$1,c.V,s),h)}t.setLocalTransform(h),t.properties.heightOffset=u.heightOffset||0,t.properties.coordOffset=u.coordOffset&&u.coordOffset.slice(0)||In$1}Pt(t,e){if(e&&e.TEXCOORD_0&&e.TEXCOORD_0.extensions&&e.TEXCOORD_0.extensions.WEB3D_quantized_attributes){t.setUniform("decodeMatrix",e.TEXCOORD_0.extensions.WEB3D_quantized_attributes.decodeMatrix)}}Et(e,n,s,o){const a=this.getMap(),c=this.s.H(n.V).heightOffset||0,h=new t__namespace.Coordinate(o);let u;u=a.altitudeToPoint?this.U:a.distanceToPointAtRes(100,100,a.getGLRes(),h).y/100;const l=n.matrix?copy$5(e,n.matrix):identity$2(e);s&&ke$1(l,transformMat4$2(Nn$1,s,l),l);const f=function(t,e,n,r,s,i,o){e=copy$4(Ue$1,e);const a=Zt$1(Ue$1,e[0]*$e$1,e[1]*$e$1,e[2]),c=getTranslation$1(Fe$1,n),h=r.ellipsoid;let u;u=0===len$4(c)?set$4(De$1,0,0,-6378137):re$1(De$1,c),Ve$1.x=u[0],Ve$1.y=u[1];const l=r.project(Ve$1,qe$1);ze$1[0]=l.x/s,ze$1[1]=l.y/s,ze$1[2]=(u[2]+o)*i;const f=Be$1(a,h,je$1),d=function(t,e,n){const r=t[0],s=t[1],i=t[2],o=t[4],a=t[5],c=t[6],h=t[8],u=t[9],l=t[10],f=e[0],d=e[1],m=e[2],p=e[3],b=e[4],g=e[5],y=e[6],w=e[7],v=e[8],O=s*f+a*d+u*m,_=i*f+c*d+l*m,M=r*p+o*b+h*g,x=s*p+a*b+u*g,A=i*p+c*b+l*g,I=r*y+o*w+h*v,S=s*y+a*w+u*v,E=i*y+c*w+l*v;return n[0]=r*f+o*d+h*m,n[1]=O,n[2]=_,n[3]=0,n[4]=M,n[5]=x,n[6]=A,n[7]=0,n[8]=I,n[9]=S,n[10]=E,n[11]=0,n[12]=t[12],n[13]=t[13],n[14]=t[14],n[15]=t[15],n}(invert$2(Ge$1,f),fromMat4$1(He$1,n),t);return ke$1(t,ze$1,d),t}(l,o,l,a.getProjection(),a.getGLRes(),u,c),d=function(t,e){return set$4(t,e[12],e[13],e[14]),t}(Bn$1,f);let m=this.s.options.offset;if(dt$2(m)){const t=this.s.Ft(n.id).center;m=m.call(this.s,t)}return set$4(kn$1,m[0],m[1],0),sub$2(d,d,kn$1),ke$1(f,d,f),f}Lt(t,e,n){const s=this.s.H(e);if(!s.coordOffset)return null;const o=this.getMap(),a=o.getGLRes();Cn$1.set(n[0],n[1]);const c=o.coordToPointAtRes(Cn$1,a,Rn$1),h=s.coordOffset,u=Cn$1.set(n[0]+h[0],n[1]+h[1]),l=o.coordToPointAtRes(u,a,Ln$1),f=l.x-c.x,d=l.y-c.y,m=this.ft();return fromTranslation$1(t,set$4(kn$1,f,d,(h[2]||0)*m))}ft(){const t=this.getMap();let e;return e=t.altitudeToPoint?this.U:t.distanceToPointAtRes(100,100,t.getGLRes(),Cn$1).y/100,e}createCMPTMesh(t,e,n,r){if(this.O[e]){const t=this.O[e];return console.warn(`mesh with id(${e}) was already created.`),r(null,{id:e,mesh:t}),t}const{content:s}=t,i=[];for(let t=0;t<s.length;t++){const{magic:r}=s[t],o=e+"."+t;"b3dm"===r?this.createB3DMMesh(s[t],o,n,((t,{mesh:e})=>{i.push(e)})):"i3dm"===r?this.createI3DMMesh(s[t],o,n,((t,{mesh:e})=>{i.push(e)})):"pnts"===r?this.createPntsMesh(s[t],o,n,((t,{mesh:e})=>{i.push(e)})):"cmpt"===r&&this.createCMPTMesh(s[t],o,n,((t,{mesh:e})=>{i.push(e)}))}return this.O[e]=i,r(null,{id:e,mesh:i}),i}Ct(t,e,n,r,s){const i=("phong"===(this.s.H(r).shader||"pbr")?this.st:this.it).getGeometryDefines(e);return s.asset&&"S3M"===s.asset.generator&&this.Dt(i,e),e.data.uvRegion&&(i.HAS_I3S_UVREGION=1),e.data[e.desc.normalAttribute]&&(i.VertexNormal=1),e.data[e.desc.color0Attribute]&&(i.VertexColor=1),e.data[e.desc.uv0Attribute]&&(i.TexCoord=1),e.data[e.desc.textureCoordMatrixAttribute]&&(i.HAS_TextureCoordMatrix=1),n.get("uTexture")&&(i.COMPUTE_TEXCOORD=1),n.get("uTexture2")&&(i.TexCoord2=1),"MESHOPT"===this.s.zt&&(i.MeshOPT_Compress=1),this.hasIBL()&&(i.HAS_IBL_LIGHTING=1),t.attributes&&t.attributes.TEXCOORD_0&&"WEB3D_quantized_attributes"===t.attributes.TEXCOORD_0.extensions&&(i.HAS_WEB3D_quantized_attributes_TEXCOORD=1),i.HAS_MIN_ALTITUDE=1,i.HAS_LAYER_OPACITY=1,this._t(i,t.compressed_int16_params),ft$2(i,t.compressDefines),i}_t(t,e){e&&Object.keys(e).length>0&&(t.HAS_COMPRESSED_INT16=1,e.POSITION&&(t.HAS_COMPRESSED_INT16_POSITION=1),e.TEXCOORD_0&&(t.HAS_COMPRESSED_INT16_TEXCOORD_0=1),e.TEXCOORD_1&&(t.HAS_COMPRESSED_INT16_TEXCOORD_1=1),e.NORMAL&&(t.HAS_COMPRESSED_INT16_NORMAL=1),e.TANGENT&&(t.HAS_COMPRESSED_INT16_TANGENT=1),e.compressed_ratio&&(t.HAS_COMPRESSED_INT16_RATIO=1))}et(t){const e=this.s.getRenderer();e&&e.updateMaskDefines(t)}Dt(t,e){e.data.aNormal&&(t.VertexNormal=1),e.data.instanceId&&(t.Instance=1),e.data.aTexCoord0&&(t.TexCoord=1),e.data.aColor&&(t.VertexColor=1),e.data.aTexCoord1&&(t.TexCoord2=1),e.data.uv2&&(t.InstanceBim=1)}Nt(t,e,n,r,s,i,o,a){let c=!1;r.asset&&"S3M"===r.asset.generator&&(c=!0,r.extensions=r.extensions||{});const h=r.url+"-"+e+"-"+n;if(this._[h])return this._[h];let u,l;a.push(t);const f=r.materials&&r.materials[t.material],d=r.extensions&&r.extensions.KHR_techniques_webgl,m=this.s.H(s.V);if(d&&f.extensions&&f.extensions.KHR_techniques_webgl){const e=this.jt(t,r,i,c);u=e.material,l=e.geometry,m.fillEmptyDataInMissingAttribute&&(l.desc.fillEmptyDataInMissingAttribute=!0)}else{l=this.Gt(t,i,qn$1);const e=m.ambientLight;let n=m.environmentExposure;const s=m.material,c=this.getMap().getLightManager(),h=c&&c.getAmbientLight();if(e&&(!h||h.color)&&void 0===n){n=e[0]/(h&&h.color?h.color[0]:.2)}u=this.Ht(t.material,r,o,s||Mn$1,n||1,a,m)}u&&Object.defineProperty(u.uniforms,"alphaTest",{enumerable:!0,get:function(){const t=m.alphaTest;return lt$2(t)?.1:t}}),u&&!u.isReady()?u.Vt=s.id:u||(u=this.R);const p={geometry:l,material:u};return l.properties.url=h,this._[h]=p,p}jt(t,e,n,r){const{geometry:s,material:i}=this.k.createMesh(t,e,n,r);return{geometry:s,material:i}}Gt(t,e,r){const s=t.attributes;let i=s._BATCHID&&s._BATCHID.array;if(i&&i.byteOffset&&(i=new i.constructor(i)),s.COLOR_0){const t=s.COLOR_0.array||s.COLOR_0;if(t instanceof Float32Array){const e=new Uint8Array(t.length);for(let n=0;n<e.length;n++)e[n]=Math.round(255*t[n]);s.COLOR_0.array?(s.COLOR_0.array=e,s.COLOR_0.componentType=5121):s.COLOR_0=e}}const o={};for(const t in s){const e=mn$1(this.h,s[t],{dimension:s[t].itemSize}),n=r[t]||t;o[n]={buffer:e},s[t].quantization&&(o[n].quantization=s[t].quantization),n===r.POSITION&&(o[n].array=s[t].array,o[n].min=s[t].min,o[n].max=s[t].max)}const a=t.indices?t.indices.array?t.indices.array.slice():t.indices:null,c=new Q$7(o,a,0,{static:!0,positionAttribute:r.POSITION,normalAttribute:r.NORMAL,uv0Attribute:r.TEXCOORD_0,uv1Attribute:r.TEXCOORD_1,color0Attribute:r.COLOR_0,tangentAttribute:r.TANGENT,pickingIdAttribute:r._BATCHID,primitive:void 0===t.mode?"triangles":dn$1(t.mode)});return i&&a&&(c.properties.batchIdData=i,c.properties.batchIdMap=function(t,e){if(!e)return null;const n=new Map;for(let r=0;r<e.length;r++){const s=e[r],i=t[s];let o=n.get(i);o||(o=[],n.set(i,o)),o.push(s)}return n}(i,a)),c.generateBuffers(this.h,{excludeElementsInVAO:e}),c}xt(t,e,n,s){const o=identity$2(t),a=this.getMap();Cn$1.x=n[0],Cn$1.y=n[1];const c=this._prjToPoint(Cn$1),h=this.qt(),u=1/(a.getGLZoom?a.getResolution(a.getGLZoom()):a.getGLRes());Cn$1.x=e[0],Cn$1.y=e[1];const l=this.ft();let f=this.s.options.offset;dt$2(f)&&(f=f.call(this.s,Cn$1));const d=this.s.H(s).heightOffset||0;return set$4(Bn$1,c.x-f[0],c.y-f[1],l*n[2]+l*d),translate$1(o,o,Bn$1),set$4(h,u,u,l),scale$5(o,o,h),o}nt(t,e){const n=this.s.H(e.V),s=this.s.lt(e.V).Ut;let a=n.rotation||[0,0,0];a=fromEuler(jn$1,a[0],a[1],a[2]);const h=fromRotationTranslationScale([],a,Gn$1,n.scale||[1,1,1]),u=identity$2([]),l=identity$2([]);translate$1(u,u,scale$4(Vn$1,s,-1)),translate$1(l,l,s);const f=multiply$5(u,u,t.X);multiply$5(h,h,f);const d=multiply$5(l,l,h);t.localTransform=d}St(t,e){const n=identity$2(t),s=this.getMap(),o=this.qt();Cn$1.x=e[0],Cn$1.y=e[1];const a=s.distanceToPointAtRes(100,100,s.getGLRes(),Cn$1);let c;return c=s.altitudeToPoint?this.U:a.y/100,set$4(o,a.x/100*1.01,a.y/100*1.01,c),scale$5(n,n,o),n}L(){const e=[],s=[];this.ct=new vn$4({vert:Xt$1,frag:"#define SHADER_NAME PNTS\n\nprecision mediump float;\n\n\n\nvarying vec4 vColor;\n\n\n\nvoid main() {\n\n    vec2 circCoord = 2.0 * gl_PointCoord - 1.0;\n\n    if (dot(circCoord, circCoord) > 1.0) {\n\n        discard;\n\n    } else {\n\n        gl_FragColor = vColor;\n\n    }\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5(s,e.projViewMatrix,e.modelMatrix)},{name:"modelNormalMatrix",type:"function",fn:(t,n)=>fromMat4$1(e,n.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},depth:{enable:!0,range:[0,1],func:"<"}}});const i=this.B();this.st=new bn$4({extraCommandProps:i}),this.it=new fi$4.StandardShader({extraCommandProps:i}),this.ut=new Qn$4({extraCommandProps:{viewport:{x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}});const o=this.s;gn$1(o.getRenderer().canvas,this.h,o.getMap()),this.picking=new Cr$4(this.u,{vert:this.it.vert,extraCommandProps:i,uniforms:this.it.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap()),this.$t=new Cr$4(this.u,{vert:Xt$1,extraCommandProps:i,uniforms:this.ct.uniforms,defines:{PICKING_MODE:1,ENABLE_PICKING:1,HAS_PICKING_ID:1}},this.pickingFBO,this.getMap())}B(){return{viewport:{x:0,y:0,width:()=>this.i?this.i.width:1,height:()=>this.i?this.i.height:1},cull:{enable:!0},stencil:{enable:!0,func:{cmp:(t,e)=>e.meshProperties.isLeaf?"always":">=",ref:(t,e)=>e.meshProperties.level},opFront:{fail:"keep",zfail:"keep",zpass:"replace"},opBack:{fail:"keep",zfail:"keep",zpass:"replace"}},depth:{enable:!0,range:[0,1],func:(t,e)=>e.meshProperties.depthFunc||"<"},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"},polygonOffset:{enable:!0,offset:(t,e)=>e.meshProperties.polygonOffset}}}ot(t){const e=this.getMap(),n=e.getLightManager(),r=(n&&n.getDirectionalLight()||{}).direction||[1,1,-1];return{projViewMatrix:e.projViewMatrix,pointOpacity:t&&t.pointOpacity||1,lightDir:normalize$4(r,r)}}D(){const t=this.getMap(),e=this.s,n=e.getRenderer().canvas,{iblTexes:r,dfgLUT:s}=wn$1(n),i=vn$1(t,r,s),o=this.s.getRenderer(),a=o.getMaskUniforms();i.minAltitude=e.options.altitude||0;return i.layerOpacity=o.canvas.gl&&o.canvas.gl.wrap?e.options.opacity||0:1,ft$2(i,{czm_lightDirectionEC:i.light0_viewDirection,lightSpecular:[1,1,1],viewMatrix:t.viewMatrix,projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,outSize:[n.width,n.height],polygonFill:[1,1,1,1],polygonOpacity:1}),ft$2(i,a),i}Ht(t,e,r,s,i,o,a){const h=e.materials&&e.materials[t];if(!h||!h.baseColorTexture&&!h.pbrMetallicRoughness)return null;const u=ft$2({},s);if(h.baseColorTexture){const t=e.textures[h.baseColorTexture.index];let n;t&&!t.image.color&&(n=this.Xt(t,o)),u.baseColorFactor=t&&t.image.color||h.baseColorFactor||[1,1,1,1],n&&(u.baseColorTexture=n)}else{if(h.normalTexture){const t=this.Xt(e.textures[h.normalTexture.index],o);if(t){const e=h.normalTexture.scale||1;u.normalTexture=t,u.normalMapFactor=e}}if(h.occlusionTexture){const t=this.Xt(e.textures[h.occlusionTexture.index],o);if(t){const e=h.occlusionTexture.strength||1;u.occlusionTexture=t,u.occlusionFactor=e}}if(h.emissiveTexture){const t=this.Xt(e.textures[h.emissiveTexture.index],o);t&&(u.emissiveTexture=t)}h.emissiveFactor&&(u.emissiveFactor=h.emissiveFactor);const t=h.pbrMetallicRoughness;if(t){if(t.baseColorFactor&&(u.baseColorFactor=t.baseColorFactor),t.baseColorTexture&&void 0!==t.baseColorTexture.index){const n=e.textures[t.baseColorTexture.index];if(n.image&&n.image.color)u.baseColorFactor=u.baseColorFactor?multiply$3(u.baseColorFactor,u.baseColorFactor,n.image.color):n.image.color;else{const t=this.Xt(n,o);t&&(u.baseColorTexture=t,u.baseColorTexture.getREGLTexture(this.h))}}if(lt$2(t.metallicFactor)||(u.metallicFactor=t.metallicFactor),lt$2(t.roughnessFactor)||(u.roughnessFactor=t.roughnessFactor),h.metallicRoughnessTexture){const t=this.Xt(e.textures[h.metallicRoughnessTexture.index],o);t&&(u.metallicRoughnessTexture=t)}}}if(h.s3mMaterial)return new Ce$5(u);if(u.environmentExposure=i,u.alphaTest=.1,a.unlit||h.extensions&&h.extensions.KHR_materials_unlit)return u.ambientColor=[1,1,1],u.light0_diffuse=[0,0,0,0],u.lightSpecular=[0,0,0],new Ie$5(u);let l=new fi$4.StandardMaterial(u);"phong"===r&&(l=Ie$5.convertFrom(l));const f=h.pbrMetallicRoughness,d=f&&f.baseColorTexture&&f.baseColorTexture.extensions;return d&&d.KHR_texture_transform&&(l.set("khr_offset",d.KHR_texture_transform.offset||[0,0]),l.set("khr_rotation",d.KHR_texture_transform.rotation||0),l.set("khr_scale",d.KHR_texture_transform.scale||[1,1])),l.doubleSided=!(!a.doubleSided&&!h.doubleSided),l.once("complete",this.C),l}Xt(t,e){const r={type:t.type?ln$1(t.type):"uint8",format:t.format?fn$1(t.format):"rgba",flipY:!!t.flipY},s=t.image;if(e.push(s),s.array?r.data=s.array:s.mipmap&&(r.mipmap=s.mipmap),!r.data&&!r.mipmap)return null;if(r.width=s.width,r.height=s.height,r.mipmap&&(r.width<4||r.height<4))return null;const i=t.sampler||t.texture&&t.texture.sampler;return i&&(i.magFilter&&(r.mag=cn$1(i.magFilter)),i.minFilter&&(r.min=hn$1(i.minFilter)),i.wrapS&&(r.wrapS=un$1(i.wrapS)),i.wrapT&&(r.wrapT=un$1(i.wrapT))),new en$5(r,this.N)}P({target:t}){const e=t.Vt,n=this.m[e];if(n.count--,!n.count){const t=n.meshes;this.p[e]=t,delete this.m[e];const r=t.Rt;delete t.Rt,r(null,{mesh:n.meshes,id:e})}}qt(){return xn$1}Jt(t){return this.s.Jt(t)}_pointToPrj(t){const e=this.getMap();return e.getGLZoom?e._pointToPrj(t,e.getGLZoom()):e._pointToPrjAtRes(t,e.getGLRes())}_prjToPoint(t){const e=this.getMap();return e.getGLZoom?e._prjToPoint(t,e.getGLZoom()):e._prjToPointAtRes(t,e.getGLRes(),Pn$1)}At(t){return"Y"===t?pn$1:"X"===t?bn$1:An$1}pick(t,e,n=3){const r=this.s;if(!r||!r.options.picking)return[];if(!this.pickingFBO||!this.picking)return[];const s=[],i=this.D(),o=this.Qt(this.picking,i,this.M,t,e,n);o&&s.push(o);const a=this.Qt(this.picking,i,this.I,t,e,n);a&&s.push(a);const c=this.ot(),h=this.Qt(this.$t,c,this.A,t,e,n);return h&&s.push(h),s}Qt(t,e,n,r,s,i){if(!n.getMeshes().length)return null;const o=this.s,a=this.getMap();t.render(n.getMeshes().filter((t=>!t.bloom)),e,!0);let c={};t.getRenderedMeshes().length&&(c=t.pick(r,s,i,e,{viewMatrix:a.viewMatrix,projMatrix:a.projMatrix,returnPoint:o.options.pickingPoint}));const{meshId:h,pickingId:u,point:l,coordinate:f}=c,d=(0===h||h)&&t.getMeshAt(h);if(!d||!d.geometry)return null;const m=d.properties;l&&l.length&&(l[0]=Math.round(1e5*l[0])/1e5,l[1]=Math.round(1e5*l[1])/1e5,l[2]=Math.round(1e5*l[2])/1e5);const p={batchId:u};if(o.options.debug&&(p.debugInfo=m),m&&m.batchTable){const{batchTable:t,batchTableBin:e,count:n}=m,r=u;for(const s in t)p[s]=void 0!==t[s].byteOffset?we$1(t[s],e,n,r):t[s][r]}return{service:d.properties.serviceIndex,data:p,point:l,coordinate:f}}j(t){let e=new Set;for(let n=0,r=t.length;n<r;n++){const r=t[n].data.node;this.G(r)&&e.add(r.W)}e=Array.from(e),e.sort();const n=new Map,r=e.length;for(let t=0;t<r;t++)n.set(e[t],t);return n}highlight(t){this.J=t;const e=this.s.getRenderer();this.K=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelAllHighlight(){this.J=null;const t=this.s.getRenderer();this.K=t.getFrameTimestamp(),t.setToRedraw(!0)}showOnly(t){this.Z=t;const e=this.s.getRenderer();this.Y=e.getFrameTimestamp(),e.setToRedraw(!0)}cancelShowOnly(){this.Z=null;const t=this.s.getRenderer();this.Y=t.getFrameTimestamp(),t.setToRedraw(!0)}Kt(){if(!this.F)return[];const t={},e=[];for(const n in this.F){const r=this.F[n];if(r)for(let n=0;n<r.length;n++){const s=r[n],i=s&&s.geometry;if(!s||!i)continue;const o=s.properties.serviceIndex;t[o]||(t[o]=new Set);const a=i.properties.batchIdData;if(a)for(let n=0;n<a.length;n++)t[o].has(a[n])||(e.push({id:a[n],service:o}),t[o].add(a[n]))}}return e}hasIBL(){const t=this.getMap().getLightManager();return!(!t||!t.getAmbientResource())}}function Zn$1(t){for(let e=0;e<t.length;e++)t[e]&&(t[e].array&&(t[e].array=null),t[e].mipmap&&(t[e].mipmap=null),t[e].indices&&(t[e].indices=null))}const Yn$1=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof global)return global;throw new Error("unable to locate global object")},Wn$1=Yn$1(),tr$1=Wn$1.gl_trans__coders=Wn$1.gl_trans__coders||{};function er$1(t,e){if(e)for(let n=0;n<e.length;n++)t[e[n].id||e[n].index]=e[n]}tr$1.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=Wn$1.gl_trans__coders=Wn$1.gl_trans__coders||{};let i=`${r}\n    const _____getGlobal = ${Yn$1.toString()};\n    const g___lobals = _____getGlobal()\n    const tran_____scoders = g___lobals['gl_trans__coders'] = g___lobals['gl_trans__coders'] || {};`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+='tran_____scoders["'+t+'"] ='+s[t].toString()+"\n;");return i+="\n"+e.substring(r.length),i},tr$1.registerTranscoder=function(t,e){tr$1[t]=e},tr$1.getTranscoder=function(t){return tr$1[t]};const nr$1=[];class rr$1{constructor(t,e,n,r,s){this.s=r,this.Zt=t,this.V=e,this.Yt=s,this.Wt=n.version,t.indexOf("i3s:tileset:")<0?(this.te=this.Wt<=1.6?"root":0,n.version=this.Wt):(this.te=t.substring("i3s:tileset:".length),this.Wt>1.6&&(this.te=parseInt(this.te))),this.Zt=t,this.ee=n}load(){const t=this.ee,e=t.layerScene.baseUrl;if(this.Wt<=1.6)return t[this.te]&&t[this.te].lodSelection?(this.ne=t[this.te],this.re()):new Promise((n=>{let r=e+"/nodes/"+this.te;t.layerScene.eslpk&&(r+="/3dNodeIndexDocument.json"),this.Yt(this.V,r,(()=>{this.ne=t[this.te],n(this.re())}))}));if(this.Wt>=1.7){if(t[this.te])return this.ne=t[this.te],this.re();const n=Math.floor(this.te/t.nodesPerPage);return new Promise((r=>{let s=e+"/nodepages/"+n;t.layerScene.eslpk&&(s+=".json"),this.Yt(this.V,s,(()=>{this.ne=t[this.te],r(this.re())}))}))}return null}getTileset(){return this.se}getChildrenURL(){return this.ie}re(){const t=this.ee,e=t.layerScene.baseUrl,n=this.ne.children,r=[],s={};if(n)for(let i=0;i<n.length;i++)if(this.Wt<=1.6){const o=n[i].id;if(t[o])continue;const a=o;s[a]||(s[a]=new Promise((n=>{let r=e+"/nodes/"+a;t.layerScene.eslpk&&(r+="/3dNodeIndexDocument.json"),this.Yt(this.V,r,(()=>{n()}))})),r.push(s[a]))}else{const o=n[i];if(t[o])continue;const a=Math.floor(o/t.nodesPerPage);s[a]||(s[a]=new Promise((n=>{let r=e+"/nodepages/"+a;t.layerScene.eslpk&&(r+=".json"),this.Yt(this.V,r,(()=>{n()}))})),r.push(s[a]))}return r.length?Promise.all(r).then((()=>this.oe())):this.oe()}oe(){return Promise.resolve(this.ae())}ce(t){er$1(this.ee,t)}ae(){return{asset:{i3s:!0,version:"1.0",gltfUpAxis:"Z"},geometricError:Number.MAX_VALUE,root:this.he(this.ne,!0)}}he(t){const e=this.s.getRenderer(),n=this.ee.projection,r=!n||n&&4326===n.wkid,s=this.Wt,i=this.ee,o=t,a=o.obb,c=o.mbs,h={};let u;if(c)u=set$4([],c[0],c[1],c[2]),r||(u=e.ue(u,u)),u=sr$1([],u[0],u[1],u[2]),h.sphere=[...u,c[3]];else if(a){u=set$4([],a.center[0],a.center[1],a.center[2]),r||(u=e.ue(u,u)),u=sr$1([],u[0],u[1],u[2]);const t=function(t,e,n){const r=fromQuat$1([],n);return r[0]=r[0]*e[0],r[1]=r[1]*e[0],r[2]=r[2]*e[0],r[3]=r[3]*e[1],r[4]=r[4]*e[1],r[5]=r[5]*e[1],r[6]=r[6]*e[2],r[7]=r[7]*e[2],r[8]=r[8]*e[2],[...t,...r]}(u,a.halfSize,a.quaternion);set$4(nr$1,t[3]+t[6]+t[9],t[4]+t[7]+t[10],t[5]+t[8]+t[11]);const o=len$4(nr$1);h.sphere=[...u,o]}let l=1/0,f=0;if(o.mbs?f=o.mbs[3]:o.obb&&(f=Math.max(Math.max(o.obb.halfSize[0],o.obb.halfSize[1]),o.obb.halfSize[2])),void 0!==o.lodThreshold)"maxScreenThresholdSQ"===i.lodSelectionMetricType?l=f/(Math.sqrt(o.lodThreshold)/(.25*Math.PI)):console.error("Unsupported lodSelectionMetricType in Layer");else if(void 0!==o.lodSelection)for(let t=0;t<o.lodSelection.length;t++)"maxScreenThreshold"===o.lodSelection[t].metricType&&(l=f/o.lodSelection[t].maxError);(l===1/0||isNaN(l))&&(l=1e5);const d=16*l,m=identity$2([]),p=o.children;let b;if(p){b=[];const t=this.ee;for(let e=0;e<p.length;e++){const n=s<=1.6?p[e].id:p[e];if(!t[n]){b=null;break}b.push(this.he(t[n]))}}const g={refine:"REPLACE",boundingVolume:h,transform:m,geometricError:d};return s<=1.6?t.lodSelection?t.geometryData&&(g.content={uri:"i3s:mesh:"+(t.id||t.index)}):g.content={uri:"i3s:tileset:"+(t.id||t.index)}:p&&p.length&&!b?g.content={uri:"i3s:tileset:"+(t.id||t.index)}:o.mesh&&(g.content={uri:"i3s:mesh:"+(t.id||t.index)}),b&&b.length&&(g.children=b),g}getJSON(){return this.ne}}function sr$1(t,e,n,r){return Zt$1(t,bt$2(e),bt$2(n),r)}const ir$1=!!tr$1.ktx2,or$1=identity$2([]),ar$1=(()=>{try{if("object"==typeof WebAssembly&&"function"==typeof WebAssembly.instantiate){const t=new WebAssembly.Module(Uint8Array.of(0,97,115,109,1,0,0,0));if(t instanceof WebAssembly.Module)return new WebAssembly.Instance(t)instanceof WebAssembly.Instance}}catch(t){}return!1})();function cr$1(t){return t.indexOf("i3s:mesh")>=0}const hr$1="i3s:mesh:".length;function lr$1(t,e){for(let n=0;n<=t.length;n++){const r=t[n].format;if("dds"===r&&e.hasExtension("WEBGL_compressed_texture_s3tc"))return t[n];if("jpg"===r||"png"===r)return t[n];if("ktx2"===r&&ir$1)return t[n]}return null}const fr$1=new t__namespace.Coordinate(0,0),dr$1=new t__namespace.Coordinate(0,0),mr$1=new Set,pr$1=[],br$1=new class{constructor(t,e){this.max=t,this.currentSize=0,this.data=new Map,this.onRemove=e}reset(t){if(this.data){const e=this.data.keys();for(const n of e){const e=this.data.get(n);t&&t!==e.renderer||this.le(n,e)}}return t||(this.data=new Map,this.currentSize=0),this}clear(t){this.reset(t)}add(t,e){if(!e)return this;if(e.node&&e.node.memorySize&&(this.currentSize+=e.node.memorySize),this.has(t)){const n=this.data.get(t);n&&n.node&&n.node.memorySize&&(this.currentSize-=n.node.memorySize),this.data.delete(t),this.data.set(t,e)}else this.data.set(t,e);return this}shrink(){if(this.currentSize>this.max){let t=!1;const e=this.data.keys();let n=e.next();for(;this.currentSize>this.max&&void 0!==n.value;){!t&&this.data.get(n.value).current&&(t=!0,console.warn(`current maxGPUMemory(${this.max/1024/1024}) for Geo3DTilesLayer is not enough, one or more current tiles will be discarded.`));const r=this.getAndRemove(n.value);r&&this.onRemove(r),n=e.next()}}}has(t){return this.data.has(t)}keys(){const t=new Array(this.data.size);let e=0;const n=this.data.keys();for(const r of n)t[e++]=r;return t}getAndRemove(t){if(!this.has(t))return null;const e=this.data.get(t);return e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),e}get(t){if(!this.has(t))return null;const e=this.data.get(t);return this.data.delete(t),this.data.set(t,e),e}remove(t){if(!this.has(t))return this;const e=this.data.get(t);return this.le(t,e),this}le(t,e){e.node&&e.node.memorySize&&(this.currentSize-=e.node.memorySize),this.data.delete(t),this.onRemove(e)}setMaxSize(t){return this.max=t,this.shrink(),this}getMemorySize(){let t=0;const e=this.data.values();for(const n of e){const e=n&&n.node;e&&e.memorySize&&(t+=e.memorySize)}return t}markAll(t,e){const n=this.data.values();for(const r of n)t&&r.renderer!==t||(r.current=e)}}(1024*(t__namespace.Browser.mobile?32:1024)*1024,(t=>{const e=t.renderer;delete t.renderer,e.deleteTile(t)}));let gr$1=0;class yr$1 extends(oe$4(t__namespace.renderer.CanvasRenderer)){constructor(t){super(t);const e=1024*t.options.maxGPUMemory*1024;e>br$1.max&&br$1.setMaxSize(e),this.tileCache=br$1,gr$1++,this.prepareWorker(),this.tilesLoading={},this.fe={},this.de=[],this.Yt=this.me.bind(this)}getAnalysisMeshes(){if(!this.painter)return pr$1;const t=this.painter.getPaintedMeshes();if(!t)return pr$1;const e=[],{b3dmMeshes:n,pntsMeshes:r,i3dmMeshes:s}=t;return n.length&&It$2(e,n),r.length&&It$2(e,r),s.length&&It$2(e,s),e}needToRedraw(){return!!this.getMap().isInteracting()||!!this.de.length||super.needToRedraw()}getFrameTimestamp(){return this.pe}drawOnInteracting(t,e,n){this.draw(e,n)}draw(t,e){this.pe=t;const n=this.prepareCanvas();if(n&&!n.intersects(this.canvasExtent2D))return void this.completeRender();const{root:r,tiles:s}=this.layer.getTiles();if(!s||!s.length)return void this.completeRender();this.be(),this.ge();const{selectedTiles:o,leaves:a,requests:c}=this.ye(r,s);c.length&&this.loadTiles(c),this.we(o,a,e),this.ve(),c.length||this.completeRender()}ye(t,e){const n=this.layer.getRootTiles();let r=[];this.Te();let s=0;const i=this.Oe(),o={};let a=!1,c=!1;for(let t=0;t<e.length;t++){const i=e[t],h=i.node;if(o[h.id])continue;const u=n[h.V];o[h.id]=1;let l=!1;const f=this.getCachedTile(h.id);(this._e(h.id)?(s++,l=c=!0,this.tilesLoading[h.id].current=!0):f?(this.getTileOpacity(f)<1&&(l=c=!0),(!i.node.Me||u.isS3M||!i.node.children||i.node.Me<=500)&&(a=!0,i.selected=!0,i.data=f)):this.painter.has(h)||(l=c=!0,r.push(h)),l)&&((this.xe(i)||this.Ae(i).length)&&(a=!0))}let h=[],u={};if(a&&({selectedTiles:h,leaves:u}=this.Ie(t)),r.length>1&&(r.sort(wr$1),i)){const t=i-s;r=t>0?r.slice(0,t):[]}return{loading:c,requests:r,selectedTiles:h,leaves:u}}Ie(t){const e=[],n={};let r;const s=[t],i=[];for(;s.length>0||i.length>0;){if(i.length>0){const t=i[i.length-1];if(t.Se===s.length){i.pop(),t===r&&(t.leave=!0,n[t.node.id]=1),e.push(t);continue}}const t=s.pop(),o=t.children;if(t.selected)if("add"===t.node.refine)n[t.node.id]=1,t.selectionDepth=i.length,e.push(t);else{if(t.selectionDepth=i.length,r=t,0===o.length){t.leave=!0,n[t.node.id]=1,e.push(t);continue}i.push(t),t.Se=s.length}for(let t=0;t<o.length;t++)s.push(o[t])}return{selectedTiles:e,leaves:n}}xe(t){if(!t.parent)return null;let e=t.parent;for(;e&&e.level>=0;){const t=e.node.id;if(this.tileCache.has(t))return e.selected=!0,e.data=this.tileCache.get(t),e;e=e.parent}return null}Ae(t){const e=[];if(!t.node.children||!t.node.children.length)return e;const n=t.W+1,r=[t.node];for(;r.length>0;){const s=r.pop().children;for(let i=0,o=s.length;i<o;i++){if((!s[i].content||!s[i].content.url)&&s[i].children&&s[i].children.length){r.push(s[i]);continue}const o=s[i].id;if(this.tileCache.has(o)){const n=this.layer.Ee(s[i],t);n.selected=!0,n.data=this.tileCache.get(o),t.children.push(n),e.push(n)}else s[i].W<=n&&r.push(s[i])}}return e}we(t,e,n){this.tileCache.markAll(this,!1);for(let e=0,n=t.length;e<n;e++){const n=t[e].data;n.current=!0,n.renderer=this,this.tileCache.add(t[e].node.id,n)}this.tileCache.shrink();const r={tiles:t,leaves:e};this.onDrawTileStart(r);const s=this.painter.paint(t,e,n);this.onDrawTileEnd(r),s&&this.layer.fire("canvasisdirty",{renderCount:s})}onDrawTileStart(){}onDrawTileEnd(){}loadTiles(t){for(let e=0,n=t.length;e<n;e++){const n=t[e];this.tilesLoading[n.id]={current:!0,node:n},this.loadTile(n)}}loadTile(t){let e=t.content.url;if(xt$2(e)){const n=At$2(e);return this.Ne(e,n,t),null}if(function(t){return t.indexOf("i3s:tileset")>=0}(e)){const n=t.V;return new rr$1(e,n,this.Ce[n],this.layer,this.Yt).load().then((n=>{this.onTilesetLoad(n,t,e)}))}return t&&Ct$2(e)&&!cr$1(e)&&(e=t.baseUrl+e),this.Ne(e,null,t),null}Ne(t,e,r){let s=this.Pe;s||(s=N$6.getSupportedFormats(this.gl.gl||this.gl),this.Pe=s);const i=this.layer.H(r.V);i.isSuperMapiServer&&(t=function(t,e){const n=t.substring(e.length).split("/"),r=[];for(let t=0;t<n.length;t++)r.push(encodeURIComponent(n[t]));return e+r.join("/")}(t,r.baseUrl));const o={url:this.layer.getTileUrl(t,r.baseUrl,this.layer.Re[r.V]),arraybuffer:e,rootIdx:r.V,upAxis:r.It,transform:r.matrix,supportedFormats:s};if(cr$1(t)){const e=this.Ce[r.V];if(o.projection=e.projection,o.i3sInfo=function(t,e,n,r,s){const i=e.layerScene.eslpk,o=function(t,e){const n=e.substring(hr$1);return t>=1.7?parseInt(n):n}(e.version,t),a=e[o],c=e.layerScene.baseUrl,h=[];let u=!1;const l=or$1;let f,d;if(e.version<=1.6){if(!a.geometryData)return null;const t=a.geometryData.length;if(!t)return null;let n=c+`/nodes/${a.id}/`+a.geometryData[t-1].href;i&&(n+=".bin");const r={geometry:{url:n,info:e.layerScene.store.defaultGeometrySchema}};let s=a.textureData&&a.textureData[0]&&a.textureData[0].href;if(s){const t=e.layerScene.store.textureEncoding[0];let n;n="image/jpeg"===t?"jpg":"png",i&&(s+="."+n),r.material={pbrMetallicRoughness:{baseColorTexture:{url:c+`/nodes/${a.id}/`+s,factor:1,format:n,mimeType:t},metallicFactor:0}}}h.push(r)}else{f=a.mesh.geometry,d=a.mesh.material;const t=e.layerScene.geometryDefinitions[f.definition],{geometryBuffers:o}=t;u=r&&2===o.length;let p=c+`/nodes/${f.resource}/geometries/`+(tr$1.draco&&u?1:0);i&&(p+=".bin");const b={geometry:{url:p,info:tr$1.draco&&u?o[1]:o[0]}};if(s&&ar$1&&u&&!tr$1.draco)throw new Error("Must import @maptalks/transcoder.draco to load i3s draco compressed geometry");const g=e.layerScene.materialDefinitions,y=e.layerScene.textureSetDefinitions;let w,v=0;d&&(v=g[d.definition]),w=g?function(t,e,n,r,s,i){const o=JSON.parse(JSON.stringify(t));return function t(e,n,r,s,i,o){for(const a in e)if(e[a]&&e[a].textureSetDefinitionId>=0){const t=n[e[a].textureSetDefinitionId],c="images/"+t.formats[0].format,h=lr$1(t.formats,i),u={url:r+`/nodes/${s}/textures/${h.name}`,factor:void 0===e[a].factor?1:e[a].factor,format:h.format,mimeType:c};if(o){let t="";switch(h.format){case"dds":t="bin.dds";break;case"jpg":case"png":t=h.format}u.url+="."+t}e[a]=u}else mt$2(e[a])&&t(e[a],n,r,s,i,o)}(o,e,n,r,s,i),o}(v,y,c,d.resource,n,e.layerScene.eslpk):{pbrMetallicRoughness:{metallicFactor:0}},b.material=w,h.push(b)}return{dracoCompression:u,meshes:h,nodeIndex:o,center:a.obb&&a.obb.center||a.mbs&&[a.mbs[0],a.mbs[1],a.mbs[2]],transform:l}}(t,e,this.regl,this.layer.options.enableI3SCompressedGeometry,this.layer.options.forceI3SCompressedGeometry),!o.i3sInfo)return void this.onTileError({status:404},r,t)}o.service=ft$2({},i),i.offset&&delete o.service.offset,o.referrer=window&&window.location.href,this.workerConn.loadTile(this.layer.getId(),o,((e,n)=>{if(e)return void this.onTileError(e,r,t);const{magic:s}=n;"b3dm"===s||"pnts"===s||"i3dm"===s||"cmpt"===s||"gltf"===s?(this.de.push({data:n,tile:r}),i.debugShowBoundingVolume&&this.painter.kt(r)):this.onTilesetLoad(n,r,t)}))}ge(){const t=this.getMap(),e=this.layer.options.meshLimitPerFrame;let n=0;for(;this.de.length&&(n<e||!t.isInteracting());){const{data:t,tile:e}=this.de.shift(),{magic:r}=t;"b3dm"===r||"gltf"===r?this.painter.createB3DMMesh(t,e.id,e,((n,{mesh:r})=>{this.Le(t,e,n,r)})):"pnts"===r?this.painter.createPntsMesh(t,e.id,e,((n,{mesh:r})=>{this.Le(t,e,n,r)})):"i3dm"===r?this.painter.createI3DMMesh(t,e.id,e,((n,{mesh:r})=>{this.Le(t,e,n,r)})):"cmpt"===r&&this.painter.createCMPTMesh(t,e.id,e,((n,{mesh:r})=>{this.Le(t,e,n,r)})),n++}}Le(t,e,n,r){if(n)this.onTileError(n,e);else{const n=this.ke(r);e.memorySize=n,this.onTileLoad(t,e)}}ke(t){let e=0;if(Array.isArray(t))for(let n=0;n<t.length;n++)t[n]&&(e+=this.ke(t[n]));else t&&(e+=t.getMemorySize());return e}onTileLoad(t,e){this.layer&&(delete this.tilesLoading[e.id],this.layer.onTileLoad(t,e),this.Be(e),this.setToRedraw(),this.layer.fire("tileload",{node:e}))}onTilesetLoad(t,e,n){this.layer&&(this.layer.zt=t.extensions&&t.extensions["s3m:VertexCompressionType"],t.capabilities||t.layers&&t.layers[0]&&t.layers[0].capabilities?this.Ue(t,e,n):(delete this.tilesLoading[e.id],this.layer.onTilesetLoad(t,e,n)))}onTileError(t,e,n){if(!this.layer)return;const r=n||e.content.url,s=t&&t.message||t;mr$1.has(s)||(console.warn("failed to load 3d tile: "+r),console.warn(t),mr$1.add(s)),delete this.tilesLoading[e.id],this.Fe(e,t),this.setToRedraw(),this.layer.fire("tileerror",{node:e,error:t})}getCachedTile(t){return this.tileCache.get(t)}Fe(e,n){const r={loadTime:t__namespace.Util.now(),current:!0,error:n,node:e};r.renderer=this,this.tileCache.add(e.id,r)}Be(e){const n={loadTime:t__namespace.Util.now(),current:!0,node:e};n.renderer=this,this.tileCache.add(e.id,n)}abortTileLoading(t){if(!t||!this.workerConn)return;const e=t.node.content.url;this.workerConn.abortTileLoading(this.layer.getId(),e),delete this.fe[e]}Te(){if(this.tilesLoading)for(const t in this.tilesLoading)this.tilesLoading[t].current=!1}deleteTile(t){this.painter.deleteTile(t)}createContext(){const t=this.layer,e=t.options.glOptions||{alpha:!0,depth:!0,stencil:!0,preserveDrawingBuffer:!0,antialias:t.options.antialias},n=this.canvas.gl&&this.canvas.gl.wrap;n?(this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl):(this.glOptions=e,this.gl=this.De(this.canvas,e)),this.regl=this.regl||a$2({gl:this.gl,attributes:e,extensions:["OES_element_index_uint"],optionalExtensions:t.options.optionalExtensions||[]}),n&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.painter=new Kn$1(this.regl,t),this.layer.ze(),this.layer.fire("contextcreate",{regl:this.regl})}prepareWorker(){const t=this.getMap();this.workerConn||(this.workerConn=new Lt$2("@maptalks/3dtiles",t.id));const e=this.workerConn;if(!e.isActive())return;let n=this.layer.options||{};n=ft$2({},n),delete n.offset;const r=t.options.spatialReference;n.projection=r&&r.coordType||r&&r.projection||t.getSpatialReference().getProjection().code;const s=this.layer.getId();e.addLayer(s,n,(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}onRemove(){this.painter&&this.painter.remove(),this.pickingFBO&&(this.canvas.pickingFBO||this.pickingFBO.destroy(),delete this.pickingFBO),this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),gr$1--,gr$1||br$1.reset(),this.clear(),delete this.tileCache,super.onRemove()}clear(){this.ve(!0),this.tileCache.reset(this),this.tilesLoading={},super.clear()}clearCanvas(){this.regl&&this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas()}getTileOpacity(){return 1}getStencilValue(){return 0}ve(t){this.je||(this.je=Date.now());const e=Date.now();if(!t&&e-this.je<this.layer.options.retireInterval)return;this.je=e;const n=[];for(const e in this.tilesLoading){const r=this.tilesLoading[e];!t&&r.current||(n.push(e),this.abortTileLoading(r))}for(let t=0;t<n.length;t++)delete this.tilesLoading[n[t]]}Oe(){return this.getMap().isInteracting()?this.layer.options.loadingLimitOnInteracting:this.layer.options.loadingLimit}De(t,e){const n=["webgl","experimental-webgl"];let r=null;for(let s=0;s<n.length;++s){try{r=t.getContext(n[s],e)}catch(t){}if(r)break}return r}_e(t){return!!this.tilesLoading[t]}getI3DMMeshes(){return this.painter.getI3DMMeshes()}getPNTSMeshes(){return this.painter.getPNTSMeshes()}getB3DMMeshes(){return this.painter.getB3DMMeshes()}readBatchData(t,e,n){return ge$1(t,e,0,n)}be(){if(!this.Ge)return;const t=this.layer.options.i3sNodepageLimitPerFrame||Number.MAX_VALUE;let e=0;const n=[];for(const r in this.Ge){const s=this.Ge[r];if("pending"===s.status)continue;s.status="pending";const i=s.rootIdx,o=Pt$2(this.layer.H(i).fetchOptions);if(n.push(w$5.getJSON(r,o).then((t=>{delete this.Ge[r];const e=this.Ce[i];if(e){t.nodes?er$1(e,t.nodes):(e[t.id]=t,er$1(e,t.children));for(let t=0;t<s.length;t++)s[t]();this.setToRedraw()}else this.setToRedraw()}))),e++,e>=t)break}n.length&&Promise.all(n)}me(t,e,n){this.Ge||(this.Ge={}),this.Ge[e]=this.Ge[e]||[],this.Ge[e].rootIdx=t,this.Ge[e].push(n),this.setToRedraw()}Ue(t,e,n){this.Ce||(this.Ce=[]);const r=e.V;this.Ce[r]||(this.Ce[r]={});const s=this.Ce[r],i=this.layer.H(r);t.layers&&(t=t.layers[0],"/"!==n[n.length-1]&&(n+="/"),n+="layers/0"),s.version=+(i.i3sVersion||t.store.version),!t.spatialReference||t.spatialReference.wkid&&4326===t.spatialReference.wkid||console.warn("i3s has a spatialReference other than 4326.",t.spatialReference),s.projection=t.spatialReference,function(t,e,n,r,s,i,o){if(!i.layerScene){i.layerScene=e,i.nodesPerPage=e.nodePages&&e.nodePages.nodesPerPage||64,i.lodSelectionMetricType=e.nodePages&&e.nodePages.lodSelectionMetricType;let t=s;if(i.layerScene.eslpk=t.indexOf("3dSceneLayer.json")>=0,t.endsWith(".json")){const e=s.lastIndexOf("/");t=e<0?"./":s.substring(0,e)}i.layerScene.baseUrl=function(t){return t.split("?")[0]}(t)}return new rr$1(s,n,i,t,o).load()}(this.layer,t,r,0,n,s,this.Yt).then((t=>{this.onTilesetLoad(t,e,n)}))}pick(t,e,n){if(!this.painter)return[];const r=this.pickingFBO,{width:s,height:i}=this.canvas;return!this.pickingFBO||r.width===s&&r.height===i||r.resize(s,i),this.painter.pick(t,e,n&&n.tolerance)}highlight(t){if(this.J||(this.J=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].service||0;let r=this.J[n];r||(r=this.J[n]=new Map),r.set(t[e].id,t[e])}else{const e=t.service||0;let n=this.J[e];n||(n=this.J[e]=new Map),n.set(t.id,t)}this.painter.highlight(this.J)}cancelHighlight(t,e){if(!this.J)return;const n=this.J[t];if(n){if(Array.isArray(e))for(let t=0;t<e.length;t++)n.delete(e[t]);else n.delete(e);n.size||(this.J[t]=null),this.painter.highlight(this.J)}}cancelAllHighlight(){delete this.J,this.painter.cancelAllHighlight()}showOnly(t){if(this.Z||(this.Z=[]),Array.isArray(t))for(let e=0;e<t.length;e++){const n=t[e].service||0;let r=this.Z[n];r||(r=this.Z[n]=new Map),r.set(t[e].id,t[e])}else{const e=t.service||0;let n=this.Z[e];n||(n=this.Z[e]=new Map),n.set(t.id,t)}this.painter.showOnly(this.Z)}cancelShowOnly(){delete this.Z,this.painter.cancelShowOnly()}Kt(){return this.painter?this.painter.Kt():[]}ue(t,e){const n=this.getMap();if("identity"===n.getProjection().code.toLowerCase()){const n=this.He();return fr$1.x=e[0],fr$1.y=e[1],n.unproject(fr$1,dr$1),t[0]=dr$1.x,t[1]=dr$1.y,t}return fr$1.x=e[0],fr$1.y=e[1],n.getProjection().unproject(fr$1,dr$1),t[0]=dr$1.x,t[1]=dr$1.y,t}Ve(t,e){const n=this.He();return fr$1.x=e[0],fr$1.y=e[1],n.project(fr$1,dr$1),t[0]=dr$1.x,t[1]=dr$1.y,t}qe(t,e){const n=this.He();return fr$1.x=e[0],fr$1.y=e[1],n.unproject(fr$1,dr$1),t[0]=dr$1.x,t[1]=dr$1.y,t}He(){const e=this.getMap().options.spatialReference.coordType;if(!e)throw new Error("Missing coordType in map spatialReference.");return this.$e||(this.$e=t__namespace.SpatialReference.getProjectionInstance(e)),this.$e}}function wr$1(t,e){return t.bt-e.bt}function vr$1(t,e,n){return t[0]=e[n],t[1]=e[n+3],t[2]=e[n+6],t}const Or$1=[],_r$1=[],Mr$1=[],xr$1=[],Ar$1=[],Ir$1=2*Math.PI;class Sr$1{constructor(t,e,n,r){this.west=t,this.south=e,this.east=n,this.north=r}static contains(t,e){let n=e[0];const r=e[1],s=t.west;let i=t.east;return i<s&&(i+=Ir$1,n<0&&(n+=Ir$1)),(n>s||le$1(n,s,1e-14))&&(n<i||le$1(n,i,1e-14))&&r>=t.south&&r<=t.north}static southwest(t,e){return e[0]=t.west,e[1]=t.south,e[2]=0,e}static northeast(t,e){return e[0]=t.east,e[1]=t.north,e[2]=0,e}static southeast(t,e){return e[0]=t.east,e[1]=t.south,e[2]=0,e}static northwest(t,e){return e[0]=t.west,e[1]=t.north,e[2]=0,e}}const Er$1=[0,0,1];function Nr$1(t,e){return Zt$1(e,t[0],t[1],t[2])}class Cr$1{constructor(t,e){this.normal=copy$4([],t),this.distance=e}static fromPointNormal(t,e,n){const r=-dot$4(e,t);return copy$4(n.normal,e),n.distance=r,n}}const Pr$1=[],Rr$1=[],Lr$1=[],kr$1=[],Br$1=[],Ur$1=[],Fr$1=[],Dr$1=[],zr$1=[],jr$1=[],Gr$1=new Cr$1([1,0,0],0),Hr$1=[];class Vr$1{constructor(t){this.southwestCornerCartesian=[],this.northeastCornerCartesian=[],this.westNormal=[],this.eastNormal=[],this.southNormal=[],this.northNormal=[],this.rectangle=new Sr$1(...t),this.minimumHeight=t[4],this.maximumHeight=t[5],this.computeBox(this.rectangle)}distanceToCamera(t,e){let n=0;if(!Sr$1.contains(this.rectangle,e)){const r=this.northeastCornerCartesian,s=this.westNormal,o=this.southNormal,a=this.eastNormal,c=this.northNormal,h=subtract$2(Hr$1,t,this.southwestCornerCartesian),u=dot$4(h,s),l=dot$4(h,o),f=subtract$2(Hr$1,t,r),d=dot$4(f,a),m=dot$4(f,c);u>0?n+=u*u:d>0&&(n+=d*d),l>0?n+=l*l:m>0&&(n+=m*m)}const r=e[2],s=this.minimumHeight,o=this.maximumHeight;if(r>o){const t=r-o;n+=t*t}else if(r<s){const t=s-r;n+=t*t}return Math.sqrt(n)}computeBox(t){const e=this;Nr$1(Sr$1.southwest(t,Rr$1),e.southwestCornerCartesian),Nr$1(Sr$1.northeast(t,Rr$1),e.northeastCornerCartesian),Pr$1[0]=t.west,Pr$1[1]=.5*(t.south+t.north),Pr$1[2]=0;const n=Nr$1(Pr$1,Lr$1),r=cross$1(Br$1,n,Er$1);normalize$4(e.westNormal,r),Pr$1[0]=t.east;const s=Nr$1(Pr$1,Dr$1),o=cross$1(Br$1,Er$1,s);normalize$4(e.eastNormal,o);const a=subtract$2(Br$1,n,s),c=normalize$4(kr$1,a),h=t.south;let u;if(h>0){Pr$1[0]=.5*(t.west+t.east),Pr$1[1]=h;const n=Nr$1(Pr$1,zr$1);copy$4(jr$1,c);const r=Cr$1.fromPointNormal(e.southwestCornerCartesian,e.westNormal,Gr$1);qr$1(zr$1,jr$1,r,e.southwestCornerCartesian),u=ce$1(n,Ur$1)}else u=he$1(Sr$1.southeast(t,Rr$1),Ur$1);const l=cross$1(Fr$1,u,a);normalize$4(e.southNormal,l);const f=t.north;let d;if(f<0){Pr$1[0]=.5*(t.west+t.east),Pr$1[1]=f;const n=Nr$1(Pr$1,zr$1);scale$4(jr$1,c,-1);const r=Cr$1.fromPointNormal(e.northeastCornerCartesian,e.eastNormal,Gr$1);qr$1(zr$1,jr$1,r,e.northeastCornerCartesian),d=ce$1(n,Ur$1)}else d=he$1(Sr$1.northwest(t,Rr$1),Ur$1);const m=cross$1(Fr$1,a,d);normalize$4(e.northNormal,m)}}function qr$1(t,e,n,r){const s=t,o=e,a=n.normal,c=dot$4(a,o);if(Math.abs(c)<1e-15)return;const h=(-n.distance-dot$4(a,s))/c;return h<0?void 0:add$4(r=scale$4(r,o,h),s,r)}const $r$1={maxGPUMemory:t__namespace.Browser.mobile?32:1536,retireInterval:2e3,loadingLimitOnInteracting:5,loadingLimit:10,renderer:"gl",forceRenderOnZooming:!0,forceRenderOnRotating:!0,forceRenderOnMoving:!0,debug:!1,meshLimitPerFrame:1,i3sNodepageLimitPerFrame:1,enableI3SCompressedGeometry:!0,forceI3SCompressedGeometry:!0,picking:!0,pickingPoint:!0,geometryEvents:!1,antialias:!1,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_astc","WEBGL_compressed_texture_etc","WEBGL_compressed_texture_etc1","WEBGL_compressed_texture_pvrtc","WEBGL_compressed_texture_s3tc","WEBGL_compressed_texture_s3tc_srgb"],offset:[0,0]},Xr$1=new t__namespace.Extent(0,0,0,0),Jr$1=[],Qr$1=[],Kr$1=[],Zr$1=[],Yr$1=[],Wr$1=new t__namespace.Coordinate(0,0),ts$1=new t__namespace.Point(0,0),es$1=[],ns$1=new t__namespace.Coordinate(0,0),rs$1=identity$2([]),ss$1=[0,0],is$1=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1];class os$1 extends(ds$4(t__namespace.Layer)){static fromJSON(t){return t&&"Geo3DTilesLayer"===t.type?new os$1(t.id,t.options):null}constructor(t,e){super(t,e),this.Xe(),this.fe={},this.Bt=[]}Xe(){const t=this.options.services.map((t=>t.url));this.Je=this.Je||{},this.Re=this.Re||[];for(let e=0;e<t.length;e++){const n=t[e];let r=this.Je[n];void 0===r&&(r=this.Je[n]=this.Re.length),this.Re[r]=hs$1(n,r,this.options.services[e])}this.fire("rootready",{roots:this.Re.slice(0)})}showService(t){return this.updateService(t,{visible:1}),this}hideService(t){return this.updateService(t,{visible:0}),this}setToRedraw(){const t=this.getRenderer();t&&t.setToRedraw()}addService(t){this.options.services=this.options.services||[],this.options.services.push(t),this.Xe();const e=this.getRenderer();return e&&e.setToRedraw(),this}updateService(t,e){if(!e)return this;const n=this.options.services;if(n&&n[t]&&ft$2(n[t],e),!lt$2(e.visible)){const s=this.Je[n[t].url];this.Re&&this.Re[s]&&(this.Re[s].visible=e.visible)}const r=this.getRenderer();return r&&r.setToRedraw(),this}removeService(t){const e=this.options.services;if(e&&e[t]){const n=e[t].url,r=this.Je[n];this.Re[r]&&(this.Re[r]=null),delete this.Je[n],e.splice(t,1)}const n=this.getRenderer();return n&&n.setToRedraw(),this}getTileUrl(t,e,n){const r=n&&n.service&&n.service.subdomains;if(r&&n.domainKey){const e=r.length;if(e){const s=[...t].reduce(((t,e)=>t+e.charCodeAt()),0)%e;return t.replace(n.domainKey,r[s])}}return t}getExtent(e){if(!e&&0!==e){const e=new t__namespace.Extent;for(let t=0;t<this.Re.length;t++)if(this.Re[t].boundingVolume){const n=this.boundingVolumeToExtent(this.Re[t]);e._combine(n)}return e}return this.Re[e]&&this.Re[e].boundingVolume?this.boundingVolumeToExtent(this.Re[e]):null}boundingVolumeToExtent(e){const n=e.boundingVolume.Qe?rs$1:e.matrix,r=this.getMap(),s="identity"===r.getProjection().code.toLowerCase(),o=this.getRenderer();if(e.boundingVolume.region){const n=e.boundingVolume.region;return new t__namespace.Extent(gt$2(n[0]),gt$2(n[1]),gt$2(n[2]),gt$2(n[3]))}if(e.boundingVolume.sphere){const a=e.boundingVolume.sphere,c=re$1([],transformMat4$2([],a,n));s&&o.Ve(c,c);const h=a[3],u=r.locate(c,-h,h),l=r.locate(c,h,-h);return new t__namespace.Extent(u,l)}if(e.boundingVolume.box){const c=e.boundingVolume.box,h=transformMat4$2([],c,n),u=new t__namespace.Coordinate(re$1([],h));s&&o.Ve(u,u);const l=c.slice(3);multiply$6(l,fromMat4$1([],e.matrix),l);const f=length$4(l.slice(0,3)),d=length$4(l.slice(3,6)),m=length$4(l.slice(6,9)),p=Math.max(f,d,m),b=r.locate(u,-p,p),g=r.locate(u,p,-p);return new t__namespace.Extent(b,g)}return null}getRootTiles(){return this.Re}getTiles(){const t=this.getRenderer();if(!t.ready)return this.Ke(),{tiles:Yr$1};const e=this.getMap(),n=e.cameraPosition,r=e.pointAtResToDistance(n[2],0,e.getGLRes()),s=this.Ze(n);this.Ye=this.Ye||[],set$4(this.Ye,bt$2(s.x),bt$2(s.y),r),this.We=Zt$1(this.We||[],this.Ye[0],this.Ye[1],this.Ye[2]),this.tn=2*Math.tan(.5*bt$2(e.getFov()));const o=e.projViewMatrix,a={children:[],level:-1};let c=a;const h=[];for(let e=0;e<this.Re.length;e++){const n=this.Re[e];if(!n||!n.visible)continue;let r=1/0;const s=[n],i=this.nn(e);for(;s.length>0;){const e=s.pop();for(e.id||this.rn(e);c.level>=e.W;)c=c.parent;const n=this.sn(e,i,o);if(n<1){let t=c;for(;t&&!t.content;)t=t.parent;if(0===n&&t&&t.content&&this.in(h,t),!1===this.options.services[e.V].alwaysShow)continue;if(!(0===n&&e.W<=r))continue;e.content&&(r=e.W)}e.bt<1/0&&this.an(e);const a=this.Ee(e,c);c.children.push(a);const u=e.children,l=u&&u.length,f=a.content;if(!l&&f&&this.in(h,a),l){f&&"add"===e.refine&&this.in(h,a),c=a;const n=u[0].parent;let r=!1;for(let i=0,o=u.length;i<o;i++){if(n){const e=t.getCachedTile(u[i].id);if(e&&e.error&&404!==e.error.status)continue;r=!0}else{r=!0,u[i].parent=e,u[i].It=e.It,u[i].baseUrl=e.baseUrl;const t=u[i].content&&(u[i].content.url||u[i].content.uri);t&&(xt$2(t)||t.indexOf("i3s:")>=0?u[i].baseUrl=e.baseUrl:Ct$2(t)?u[i].content.url=e.baseUrl+t:u[i].baseUrl=t.substring(0,t.lastIndexOf("/")+1))}s.push(u[i])}!r&&f&&this.in(h,a)}}}return{root:a,tiles:h}}in(t,e){const{viewerRequestVolume:n}=e.node;n&&!function(t,e,n){if(n.region){const e=n.region;if(t[0]>=e[0]&&t[0]<=e[2]&&t[1]>=e[1]&&t[1]<=e[3])return!0}else{if(n.sphere)return as$1(n,e);if(n.box)return 0===cs$1(n,e)}return!1}(this.Ye,this.We,n)||t.push(e)}Ee(t,e){return{id:t.id,node:t,children:[],level:t.W,parent:e,content:t.content&&t.content.url}}rn(e){const n=this.getId();e.id=n+":"+t__namespace.Util.GUID(),e.matrix=e.transform||identity$2([]),e.cn=this.hn(e),e.parent&&(function(t){return t.content&&t.content.uri&&t.content.uri.indexOf("i3s:")>=0}(e)||(e.matrix=multiply$5(e.matrix,e.parent.matrix,e.matrix)),e.V=e.parent.V,void 0===e.W&&(e.W=e.parent.W+1),e.maxExtent=e.parent.maxExtent),e.refine=e.refine&&e.refine.toLowerCase()||"replace",e.content&&!e.content.url&&e.content.uri&&(e.content.url=e.content.uri)}H(t){return this.Re[t].service}un(t){const e=t.boundingVolume;if(!e||e.Qe&&!this.ln(t))return;const n=this.H(t.V),s=n.heightOffset||0,o=this.options.offset,a=dt$2(o)||o[0]||o[1],c=n.coordOffset||ss$1;if(!Array.isArray(c))throw new Error("service.coordOffset must be an array");if(!e.Qe&&(!t.boundingVolume||!s&&exactEquals$5(t.matrix,rs$1)&&!a&&c===ss$1))return;e.box&&e.region&&delete e.region;const{region:h,box:u,sphere:l}=e;if(e.coordOffset=[c[0],c[1]],e.heightOffset=s,h){e.originalVolume||(e.originalVolume=h.slice(0));const t=e.originalVolume,n=this.dn([gt$2(t[0]),gt$2(t[1])]);h[0]=bt$2(n.x+c[0]),h[1]=bt$2(n.y+c[1]);const r=this.dn([gt$2(t[2]),gt$2(t[3])]);h[2]=bt$2(r.x+c[0]),h[3]=bt$2(r.y+c[1]),h[4]=t[4]+s+(c[2]||0),h[5]=t[5]+s+(c[2]||0)}else if(u||l){e.originalVolume||(e.originalVolume=(u||l).slice(0));const n=u||l,o=transformMat4$2(Jr$1,e.originalVolume,t.matrix),a=re$1(Qr$1,o),h=this.dn([a[0]+c[0],a[1]+c[1]]);a[0]=h.x,a[1]=h.y,a[2]+=s+(c[2]||0),Zt$1(n,bt$2(a[0]),bt$2(a[1]),a[2])}e.Qe=!0}ln(t){const e=t.boundingVolume,n=this.H(t.V),s=n.coordOffset||ss$1;return e.coordOffset[0]!==s[0]||e.coordOffset[1]!==s[1]||e.heightOffset!==(n.heightOffset||0)}hn(t){return void 0===t.geometricError||!t.boundingVolume}an(t){let e=t.parent;for(;e&&e.cn&&!(e.bt<=t.bt);)e.bt=t.bt,e=t.parent}onTileLoad(t,e){if(t.children&&(!e.children||!e.children.length)){e.children=t.children;const n=e.content.url;e.baseUrl=n.substring(0,n.lastIndexOf("/")+1);const r=this.getRenderer();r&&r.setToRedraw()}}onTilesetLoad(t,e,n){if(!t)return void console.warn("invalid tileset at : "+n);const s=this.H(e.V),i=(t.asset&&t.asset.gltfUpAxis||e&&e.It||s.upAxis||"Y").toUpperCase();t.root.baseUrl=n.substring(0,n.lastIndexOf("/")+1);const o=n.indexOf("realspace/")>-1;0===e.W&&(t.asset&&t.asset.s3mType&&o||s.isSuperMapiServer)&&(t.root.baseUrl+="data/path/");const a=t.asset.i3s,c=!!t.asset.s3mType;if(t.root.It=i,e){const s=this.Re[e.V];c&&!s.isS3M&&(s.isS3M=c);const i=e.boundingVolume;ft$2(e,t.root),e.refine=e.refine&&e.refine.toLowerCase()||"replace",i&&(e.boundingVolume=i);const o=t.root.transform;o&&(e.parent?a||(e.matrix=multiply$5([],e.parent.matrix,o)):e.matrix=o),e.mn=e.content,delete e.content,t.root.content&&(e.content=t.root.content),e.cn=this.hn(e);const h=e.content&&(e.content.url||e.content.uri);h&&e.content.uri&&(e.content.url=e.content.uri,delete e.content.uri),!a&&h&&!xt$2(h)&&Ct$2(h)&&(e.content.url=e.baseUrl+h),t.root&&!e.parent&&this.pn(e)}this.Ke(),this.fire("loadtileset",{tileset:t,index:e&&e.V,url:n})}sn(t,e,n){if(t.bt=1/0,0===t.W||t.cn)return this.pn(t),1;if(this.un(t),!this.bn(t,e,n))return-1;if(0===t.geometricError)return 1;let r=this.H(t.V).maximumScreenSpaceError;null==r&&(r=16);let s=this.gn(t);return 0===s&&t.parent&&(s=.5*(t.parent.Me||0)),s>=r?1:0}Jt(e,n){n||(n=new t__namespace.Point(0,0));const r=this.getMap();return r.getGLZoom?r.coordToPoint(e,r.getGLZoom(),n):r.coordToPointAtRes(e,r.getGLRes(),n)}bn(e,n,r){const s=e.id;let i=this.Bt[s]&&this.Bt[s].obbox;const{boundingVolume:o}=e,a=o.region,c=o.box,h=o.sphere;if(!i)if(a)this.Bt[s]=this.yn(e),i=this.Bt[s].bbox,i.center=this.Bt[s].coordCenter;else if(c)this.Bt[s]=this.wn(e),i=this.Bt[s].obbox,i.center=this.Bt[s].coordCenter;else if(h){i=this.Bt[s]=this.vn(e);const n=re$1(Jr$1,h),r=new t__namespace.Coordinate(n);i.center=r}if(n){if(a)Xr$1.xmin=i[0][0],Xr$1.ymin=i[0][1],Xr$1.xmax=i[1][0],Xr$1.ymax=i[1][1];else if(h){const t=i[2];Xr$1.xmin=i[0][0]-t,Xr$1.ymin=i[0][1]-t,Xr$1.xmax=i[0][0]+t,Xr$1.ymax=i[0][1]+t}else if(c){const t=i[1],e=i[2];Xr$1.xmin=i[0][0]-t,Xr$1.ymin=i[0][1]-e,Xr$1.xmax=i[0][0]+t,Xr$1.ymax=i[0][1]+e}if(!n.intersects(Xr$1))return!1}return a?intersectsBox$1(r,i):h?function(matrix,sphere,mask){setPlanes$1(matrix);for(var center=sphere[0],negRadius=-sphere[1],i=0;i<6;i++)if((!mask||"0"!==mask.charAt(i))&&distanceToPoint$1(planes$1[i],center)<negRadius)return!1;return!0}(r,i):!!c&&function(matrix,box,mask){setPlanes$1(matrix);for(var i=0;i<6;i++)if(!(mask&&"0"===mask.charAt(i)||intersectsPlane(planes$1[i],box)))return!1;return!0}(r,i)}yn(e){const n=this.getMap(),r=n.getGLRes(),s=e.boundingVolume.region;let{ws:i,en:o}=function(t){const r=t[2],s=t[3],o=t[5],a=Zt$1([],t[0],t[1],t[4]),c=Zt$1([],r,s,o);return{ws:re$1(a,a),en:re$1(c,c)}}(s);i=new t__namespace.Coordinate(i),o=new t__namespace.Coordinate(o);const a=n.coordToPointAtRes(i,r);a.z=n.altitudeToPoint(i.z,r);const c=n.coordToPointAtRes(o,r);c.z=n.altitudeToPoint(o.z,r);const h=[c.x,a.y,c.z,c.x,c.y,c.z,a.x,c.y,c.z,a.x,a.y,c.z,c.x,a.y,a.z,c.x,c.y,a.z,a.x,c.y,a.z,a.x,a.y,a.z],u=[(h[0]+h[18])/2,(h[1]+h[19])/2,(h[2]+h[20])/2],l=n.pointAtResToCoord(new t__namespace.Point(u),r);l.z=(i.z+o.z)/2;const f=this.lt(e.V).Ut,d=[h.slice(21,24),h.slice(3,6)];if(f)for(let t=0;t<h.length;t+=3)h[t]-=f[0],h[t+1]-=f[1],h[t+2]-=f[2];return{bbox:d,boxPosition:h,pointCenter:u,coordCenter:l}}wn(t){const e=this.getRenderer(),n=this.getMap(),r="identity"===n.getProjection().code.toLowerCase(),s=n.getGLRes(),o=t.boundingVolume.box,a=o.slice(0,3),h=new us$1((u=this.Tn(o,t.matrix))[0],u[3],u[6],(l=a)[0],u[1],u[4],u[7],l[1],u[2],u[5],u[8],l[2],0,0,0,1);var u,l;const f=this.On(t),d=[],m=this.lt(t.V).Ut;ts$1.set(m[0],m[1]);const p=n.pointAtResToCoord(ts$1,s),b=Jr$1;for(let t=0;t<is$1.length;t+=3){b[0]=is$1[t],b[1]=is$1[t+1],b[2]=is$1[t+2],transformMat4$2(b,b,h),re$1(b,b),r&&e.Ve(b,b);const o=Wr$1.set(...b);let a=n.coordToPointAtRes(o,s,ts$1);a=set$4(b,a.x,a.y,n.altitudeToPoint(o.z,s)),d[t]=a[0]-m[0],d[t+1]=a[1]-m[1],d[t+2]=a[2]-m[2]}return{obbox:this._n(d,m,f),boxPosition:d,boxCenter:f,coordCenter:p}}vn(e){const n=this.getMap(),r=this.getRenderer(),s="identity"===n.getProjection().code.toLowerCase(),i=e.boundingVolume.sphere;let a=Jr$1;0===i[0]&&0===i[1]&&0===i[2]?a=[0,0,-6378137]:re$1(a,i),s&&r.Ve(a,a);const c=new t__namespace.Coordinate(a),h=this.Jt(c,ts$1).toArray();h[2]=n.altitudeToPoint(c.z,n.getGLRes());const u=this.Mn(c);return[h,i[3]*u[2]]}_n(t,e,n){const[r,s,o]=e,a=set$4(Jr$1,(t[3]+t[12])/2+r,(t[4]+t[13])/2+s,(t[5]+t[14])/2+o),c=set$4(Qr$1,(t[3]+t[18])/2+r,(t[4]+t[19])/2+s,(t[5]+t[20])/2+o),h=set$4(Kr$1,(t[3]+t[9])/2+r,(t[4]+t[10])/2+s,(t[5]+t[11])/2+o),u=n.slice(0);return u[3]=a[0]-n[0],u[4]=a[1]-n[1],u[5]=a[2]-n[2],u[6]=c[0]-n[0],u[7]=c[1]-n[1],u[8]=c[2]-n[2],u[9]=h[0]-n[0],u[10]=h[1]-n[1],u[11]=h[2]-n[2],u}On(e){const n=this.getMap(),r=this.getRenderer(),s="identity"===n.getProjection().code.toLowerCase(),i=n.getGLRes(),o=e.boundingVolume.box.slice(0,3);re$1(o,o),s&&r.Ve(o,o);const a=new t__namespace.Coordinate(o),c=n.coordToPointAtRes(a,i);return[c.x,c.y,n.altitudeToPoint(a.z,i)]}pn(t){const e=this.H(t.V);if(!t.boundingVolume||this.xn(t,e))return;const r=t.boundingVolume.region,s=t.boundingVolume.sphere;let i=null;t.boundingVolume.box?i=this.An(t).pointCenter:r?i=this.In(t).pointCenter:s&&(i=this.vn(t)[0]);const o=e.heightOffset||0,a=e.coordOffset||[0,0];t.Sn=[a[0]||0,a[1]||0],t.dt=o,t.Ut=i}xn(t,e){if(!t.Sn)return!1;const n=e.coordOffset||ss$1;return t.Sn[0]===n[0]&&t.Sn[1]===n[1]&&t.dt===(e.heightOffset||0)}In(t){return t.boundingVolume?(this.un(t),this.yn(t)):null}An(e){if(!e.boundingVolume)return null;this.un(e);const n=e.boundingVolume.box.slice(0,3);re$1(n,n);const r=new t__namespace.Coordinate(n);return{pointCenter:this.On(e),coordCenter:r}}Tn(t,e){let n=t.slice(3,12);return n=function(t,e,n){const s=t[1]*e[0]+t[4]*e[1]+t[7]*e[2],i=t[2]*e[0]+t[5]*e[1]+t[8]*e[2],o=t[0]*e[3]+t[3]*e[4]+t[6]*e[5],a=t[1]*e[3]+t[4]*e[4]+t[7]*e[5],c=t[2]*e[3]+t[5]*e[4]+t[8]*e[5],h=t[0]*e[6]+t[3]*e[7]+t[6]*e[8],u=t[1]*e[6]+t[4]*e[7]+t[7]*e[8],l=t[2]*e[6]+t[5]*e[7]+t[8]*e[8];return n[0]=t[0]*e[0]+t[3]*e[1]+t[6]*e[2],n[1]=s,n[2]=i,n[3]=o,n[4]=a,n[5]=c,n[6]=h,n[7]=u,n[8]=l,n}(this.En(e,[]),n,n),n}En(t,e){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e}Mn(t){const e=this.getMap(),n=e.distanceToPointAtRes(100,100,e.getGLRes(),t);let r;return r=e.altitudeToPoint?e.altitudeToPoint(100,e.getGLRes())/100:n.y/100,set$4(Zr$1,n.x/100*1.01,n.y/100*1.01,r),Zr$1}dn(e){Array.isArray(e)&&(e=new t__namespace.Coordinate(e));let n=this.options.offset;if(dt$2(n)&&(n=n.call(this,Array.isArray(e)?new t__namespace.Coordinate(e):e)),n[0]||n[1]){const t=this.getMap(),r=t.getGLRes(),s=t.coordToPointAtRes(e,r);return s._sub(n),t.pointAtResToCoord(s,r)}return e}lt(t){return this.Re[t]}nn(e){const n=this.H(e).maxExtent;if(!n)return null;const r=this.Re[e];return r.maxExtent||(r.maxExtent=new t__namespace.Extent(n).convertTo((t=>this.Jt(t)))),r.maxExtent}gn(t){const e=this.tn,n=t.geometricError;if(0===n)return t.Me=0,0;const r=this.getMap();let s;t.boundingVolume.region?s=function(t,e,n){return t.Nn||(t.Nn=new Vr$1(t.boundingVolume.region)),t.Nn.distanceToCamera(e,n)}(t,this.We,this.Ye):t.boundingVolume.sphere?s=as$1(t.boundingVolume,this.We):t.boundingVolume.box&&(s=cs$1(t.boundingVolume,this.We));const i=Math.max(Math.abs(s),1e-7),o=n*r.height/(i*e);return t.bt=s,t.Me=o,o}Ke(){const t=this.getRenderer();t&&t.setToRedraw()}Ft(t){return this.Bt[t]}identify(e,n={}){const r=this.getMap(),s=this.getRenderer();if(!r||!s)return[];const i=r.coordToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(i,n)}identifyAtPoint(t,e={}){const n=[];if(!e.excludeMasks){const r=this.identifyMask(t,e);r&&r.length&&It$2(n,r)}const r=this.getMap(),s=this.getRenderer();if(!r||!s)return[];const i=r.getDevicePixelRatio();return It$2(n,s.pick(t.x*i,t.y*i,e)),n}getCurrentBatchIDs(){const t=this.getMap(),e=this.getRenderer();return t&&e?e.Kt():[]}highlight(t){const e=this.getRenderer();return e?(e.highlight(t),this):(this.J||(this.J=[]),this.J.push(t),this)}ze(){if(this.J){for(let t=0;t<this.J.length;t++)this.highlight(this.J[t]);delete this.J}}cancelHighlight(t,e){const n=this.getRenderer();return n?(n.cancelHighlight(t,e),this):this}cancelAllHighlight(){const t=this.getRenderer();return t?(t.cancelAllHighlight(),this):this}showOnly(t){const e=this.getRenderer();return e?(e.showOnly(t),this):(this.Z||(this.Z=[]),this.Z.push(t),this)}Cn(){if(this.Z){for(let t=0;t<this.Z.length;t++)this.showOnly(this.Z[t]);delete this.Z}}cancelShowOnly(t){const e=this.getRenderer();return e?(e.cancelShowOnly(t),this):this}setServiceOpacity(t,e){const n=this.options.services[t];n&&(n.opacity=e);const r=this.getRenderer();return r?(r.setToRedraw(),this):this}setServiceDebugBoundingVolume(t,e){const n=this.options.services[t];n&&(n.debugShowBoundingVolume=e);const r=this.getRenderer();return r?(r.setToRedraw(),this):this}Ze(t){const e=this.getMap(),n=e.getGLRes();ns$1.set(t[0],t[1]);const r=e.pointAtResToCoord(ns$1,n);return"identity"===e.getProjection().code.toLowerCase()?(Qr$1[0]=r.x,Qr$1[1]=r.y,this.getRenderer().qe(Jr$1,Qr$1),r.set(Jr$1[0],Jr$1[1]),r):r}toJSON(){return{type:this.getJSONType(),id:this.getId(),options:this.config()}}}function as$1(t,e){const r=dist$2(t.sphere,e),s=t.sphere[3];return r<s?0:r-s}function cs$1(t,e){const n=t.box;return function(t,e,n){return Math.sqrt(function(t,e,n){const r=subtract$2(Or$1,n,t),s=vr$1(_r$1,e,0),i=vr$1(Mr$1,e,1),o=vr$1(xr$1,e,2),a=len$4(s),c=len$4(i),h=len$4(o);normalize$4(s,s),normalize$4(i,i),normalize$4(o,o);const u=Ar$1;u[0]=dot$4(r,s),u[1]=dot$4(r,i),u[2]=dot$4(r,o);let l,f=0;return u[0]<-a?(l=u[0]+a,f+=l*l):u[0]>a&&(l=u[0]-a,f+=l*l),u[1]<-c?(l=u[1]+c,f+=l*l):u[1]>c&&(l=u[1]-c,f+=l*l),u[2]<-h?(l=u[2]+h,f+=l*l):u[2]>h&&(l=u[2]-h,f+=l*l),f}(t,e,n))}(set$4(Jr$1,n[0],n[1],n[2]),set$6(es$1,n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11]),e)}function hs$1(t,e,n){const s=(t=yt$2(t)).indexOf("{s}")>=0?"{s}":t.indexOf("%7Bs%7D")>=0?"%7Bs%7D":null;return{service:n,visible:lt$2(n.visible)?1:n.visible,baseUrl:t.substring(0,t.lastIndexOf("/"))+"/",content:{url:t},refine:"replace",matrix:identity$2([]),V:e,W:0,domainKey:s}}function us$1(t,e,n,r,s,i,o,a,c,h,u,l,f,d,m,p){this[0]=t||0,this[1]=s||0,this[2]=c||0,this[3]=f||0,this[4]=e||0,this[5]=i||0,this[6]=h||0,this[7]=d||0,this[8]=n||0,this[9]=o||0,this[10]=u||0,this[11]=m||0,this[12]=r||0,this[13]=a||0,this[14]=l||0,this[15]=p||0}os$1.mergeOptions($r$1),os$1.registerRenderer("gl",yr$1),os$1.registerJSONType("Geo3DTilesLayer");let ls$1=null;function fs$1(){return ls$1||(ls$1={"image/crn":tr$1.crn&&tr$1.crn(),"image/ktx2":tr$1.ktx2&&tr$1.ktx2(),"image/cttf":tr$1.ktx2&&tr$1.ktx2(),draco:tr$1.draco&&tr$1.draco()}),ls$1}class ds$1{constructor(t,e,n){this.Pn=t,this.Rn=e||X$8,this.Pe=n,this.Ln=fs$1()}static createEmptyB3DM(){return{featureTable:null,batchTable:null,gltf:{}}}load(t,e,n=0,r=0,s){return e?(r||(r=e.byteLength),this.kn(t,e,n,r,s)):w$5.getArrayBuffer(t,{}).then((e=>{const s=e.data;return r||(r=s.byteLength),this.kn(t,s,n,r)}))}kn(t,e,n,r,s){const i=s&&s.maxTextureSize,o=this.Bn(e,n,r,t);if(o.error)return Promise.resolve(o);const a=t.substring(0,t.lastIndexOf("/")),c=new this.Rn(a,o.glb,{transferable:!0,requestImage:this.Pn,decoders:this.Ln,supportedFormats:this.Pe,maxTextureSize:i});return c.load({skipAttributeTransform:!1}).then((e=>{e.url=`${t}-${n}-${r}`;const s=c.transferables;for(let t=0;t<o.transferables.length;t++)s.indexOf(o.transferables[t])<0&&s.push(o.transferables[t]);return{magic:"b3dm",count:o.count,transferables:s,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,gltf:e}}))}Bn(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported b3dm version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in b3dm header is inconsistent with b3dm's byte length, url: "+r;return console.warn(t),{error:t}}let o,a=s.getUint32(12,!0),c=s.getUint32(16,!0),h=s.getUint32(20,!0),u=s.getUint32(24,!0),l=28+e;h>=570425344?(l-=8,o=a,h=c,u=0,a=0,c=0):u>=570425344&&(l-=4,o=h,h=a,u=c,a=0,c=0);const f=[t];let d,m,p;if(a>0?(d=me$1(t,l,a),l+=a,o=d.BATCH_LENGTH):d={BATCH_LENGTH:o},c>0&&(l+=c),h>0&&(m=pe$1(t,l,h),l+=h,u>0)){const e=be$1(0,l,u);p=t.slice(e.offset,e.offset+e.byteLength),l+=u,f.push(p)}const b=d.BATCH_LENGTH,g={};if(d&&d.BATCH_ID){g.BATCH_ID=ye$1(d.BATCH_ID,t,(void 0).offset,b);const e=g.BATCH_ID.array&&g.BATCH_ID.array.buffer;e&&f.indexOf(e)<0&&f.push(e)}return{count:o,transferables:f,featureTable:d,batchTable:m,batchTableBin:p,b3dm:g,glb:{buffer:t,byteOffset:l,byteLength:s.byteLength+s.byteOffset-l}}}Un(){return null}}class ms$1{constructor(t,e,n,r){this.Pn=t,this.Rn=e||X$8,this.Pe=n,this.Ln=fs$1(),this.Fn=r}load(t,e,n=0,r=0,s){return e?(r||(r=e.byteLength),this.kn(t,e,n,r,s)):w$5.getArrayBuffer(t,{}).then((e=>{const s=e.data;return r||(r=s.byteLength),this.kn(t,s,n,r)}))}kn(t,e,n,r,s){return this.Dn(t,e,n,r,s).then((({gltf:s,transferables:i})=>{const o=this.zn(e,n,r,t);if(o.error)return Promise.resolve(o);for(let t=0;t<i.length;t++)-1===o.transferables.indexOf(i[t])&&o.transferables.push(i[t]);return delete s.transferables,Promise.resolve({magic:"i3dm",count:o.count,transferables:o.transferables,featureTable:o.featureTable,batchTable:o.batchTable,batchTableBin:o.batchTableBin,i3dm:o.i3dm,gltf:s})}))}Dn(t,e,n,r,s){const o={transferable:!0,requestImage:this.Pn,decoders:this.Ln,supportedFormats:this.Pe,maxTextureSize:s&&s.maxTextureSize},a=new DataView(e,n,r),c=32+a.getUint32(12,!0)+a.getUint32(16,!0)+a.getUint32(20,!0)+a.getUint32(24,!0);if(0===a.getUint32(28,!0)){let r=Tt$2(new Uint8Array(e,c+n,a.byteLength-c));return-1==r.indexOf("://")&&(r=t.substring(0,t.lastIndexOf("/"))+"/"+r),r.indexOf(".glb")>0?w$5.getArrayBuffer(r,{}).then((t=>this.jn(r,{buffer:t.data,byteOffset:0},o))):w$5.getJSON(r,{}).then((t=>this.jn(r,t,o)))}return this.jn(t,{buffer:e,byteOffset:c+n,byteLength:a.byteLength-c},o)}jn(t,e,n){const r=t.substring(0,t.lastIndexOf("/")),s=new this.Rn(r,e,n);return s.load({skipAttributeTransform:!0}).then((n=>{let r=0,i=0;return e.buffer&&(r=e.byteOffset||0,i=e.byteLength||0),n.url=`${t}-${r}-${i}`,{transferables:s.transferables,gltf:n}}))}zn(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:h,batchTableBin:u}=Ae$1(s,32+e,o),l={},f=a.INSTANCES_LENGTH;if(a.POSITION){const{byteOffset:e}=a.POSITION;l.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:new Float32Array(t,e+c.offset,3*f).slice()},o.push(l.POSITION.array.buffer)}else if(a.POSITION_QUANTIZED){const e=a.QUANTIZED_VOLUME_OFFSET,n=a.QUANTIZED_VOLUME_SCALE,{byteOffset:r}=a.POSITION_QUANTIZED;l.POSITION={byteStride:12,byteOffset:0,itemSize:3,count:f,componentType:5126,array:this.Gn(new Uint16Array(t,r+c.offset,3*f),e,n)},o.push(l.POSITION.array.buffer)}if(a.BATCH_ID){l.BATCH_ID=ye$1(a.BATCH_ID,t,c.offset,f);const e=l.BATCH_ID.array&&l.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}if(a.NORMAL_UP){let{byteOffset:e}=a.NORMAL_UP;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:new Float32Array(t,e+c.offset,3*f).slice()},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:new Float32Array(t,e+c.offset,3*f).slice()},o.push(l.NORMAL_RIGHT.array.buffer)}else if(a.NORMAL_UP_OCT32P){let{byteOffset:e}=a.NORMAL_UP_OCT32P;l.NORMAL_UP={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:this.Hn(new Uint16Array(t,e+c.offset,2*f))},o.push(l.NORMAL_UP.array.buffer),e=a.NORMAL_RIGHT_OCT32P.byteOffset,l.NORMAL_RIGHT={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:this.Hn(new Uint16Array(t,e+c.offset,2*f))},o.push(l.NORMAL_RIGHT.array.buffer)}if(a.SCALE){const{byteOffset:e}=a.SCALE;l.SCALE={byteStride:0,byteOffset:0,itemSize:1,count:f,componentType:5126,array:new Float32Array(t,e+c.offset,f).slice()},o.push(l.SCALE.array.buffer)}else if(a.SCALE_NON_UNIFORM){const{byteOffset:e}=a.SCALE_NON_UNIFORM;l.SCALE_NON_UNIFORM={byteStride:0,byteOffset:0,itemSize:3,count:f,componentType:5126,array:new Float32Array(t,e+c.offset,3*f).slice()},o.push(l.SCALE_NON_UNIFORM.array.buffer)}return{count:f,batchTable:h,batchTableBin:u,featureTable:a,i3dm:l,transferables:o}}Hn(t){const e=t.length/2,n=new Float32Array(3*e),r=[];for(let s=0;s<e;s++)ps$1(r,t[2*s],t[2*s+1],65535),n[3*s]=r[0],n[3*s+1]=r[1],n[3*s+2]=r[2];return n}Gn(t,e,n){return xe$1(new Float32Array(t.length),t,e,n)}Un(){return null}}function ps$1(t,e,n,r){if(t[0]=bs$1(e,r),t[1]=bs$1(n,r),t[2]=1-(Math.abs(t[0])+Math.abs(t[1])),t[2]<0){const e=t[0];t[0]=(1-Math.abs(t[1]))*gs$1(e),t[1]=(1-Math.abs(e))*gs$1(t[1])}return normalize$4(t,t)}function bs$1(t,e){return function(t,e,n){return t<0?0:t>n?n:t}(t,0,e=function(t,e){return null!=t?t:255}(e))/e*2-1}function gs$1(t){return t<0?-1:1}class ys$1{constructor(){}load(t,e,n=0,r=0){return e?(r||(r=e.byteLength),this.kn(t,e,n,r)):w$5.getArrayBuffer(t,{}).then((e=>{const s=e.data;return r||(r=s.byteLength),this.kn(t,s,n,r)}))}kn(t,e,n,r){return this.Vn(e,n,r,t).then((t=>t.error?t:{magic:"pnts",count:t.count,transferables:t.transferables,featureTable:t.featureTable,batchTable:t.batchTable,batchTableBin:t.batchTableBin,pnts:t.pnts}))}Vn(t,e,n,r){const s=new DataView(t,e,n),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported pnts version: "+i+", url:"+r;return console.warn(t),{error:t}}if(s.getUint32(8,!0)!==s.byteLength){const t="Length in pnts header is inconsistent with pnts's byte length, url: "+r;return console.warn(t),{error:t}}const o=[t],{featureTable:a,featureTableBin:c,batchTable:h,batchTableBin:u}=Ae$1(s,e+28,o),l=a.QUANTIZED_VOLUME_OFFSET,f=a.QUANTIZED_VOLUME_SCALE,d=a.POINTS_LENGTH;let m,p={};if(a.extensions&&a.extensions["3DTILES_draco_point_compression"]){p=a.extensions["3DTILES_draco_point_compression"],m=new DataView(t,p.byteOffset+c.offset,p.byteLength);const e={attributes:p.properties,useUniqueIDs:!1};return this.qn||(this.qn=fs$1().draco),this.qn(m,e).then((e=>{const n=e.attributes;!a.POSITION&&!a.POSITION_QUANTIZED||n.POSITION||n.POSITION_QUANTIZED||(n.POSITION=a.POSITION,n.POSITION_QUANTIZED=a.POSITION_QUANTIZED),!(a.RGB||a.RGBA||a.RGB565)||n.RGB||n.RGBA||n.RGB565||(n.RGB=a.RGB,n.RGBA=a.RGBA,n.RGB565=a.RGB565),!a.NORMAL&&!a.NORMAL_OCT16P||n.NORMAL||n.NORMAL_OCT16P||(n.NORMAL=a.NORMAL,n.NORMAL_OCT16P=a.NORMAL_OCT16P);const r=this.$n(t,e.attributes,c.offset,d,o,l,f);if(e.attributes.BATCH_ID){const t=e.attributes.BATCH_ID.array;r.BATCH_ID={byteStride:0,byteOffset:0,itemSize:1,count:t.length,componentType:Me$1(t.constructor),array:t},o.push(t.buffer)}else if(a.BATCH_ID||Object.keys(h).length){r.BATCH_ID=a.BATCH_ID?ye$1(a.BATCH_ID,t,c.offset,d):ws$1(d);const e=r.BATCH_ID.array&&r.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return{count:d,batchTable:h,batchTableBin:u,featureTable:a,pnts:r,transferables:o}}))}const b=this.$n(t,a,c.offset,d,o,l,f);if(a.BATCH_ID||Object.keys(h).length){b.BATCH_ID=a.BATCH_ID?ye$1(a.BATCH_ID,t,c.offset,d):ws$1(d);const e=b.BATCH_ID.array&&b.BATCH_ID.array.buffer;e&&o.indexOf(e)<0&&o.push(e)}return Promise.resolve({count:d,batchTable:h,batchTableBin:u,featureTable:a,pnts:b,transferables:o})}$n(t,e,n,r,s,i,o){const a={};if(e.POSITION){let{byteOffset:i,array:o}=e.POSITION;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r*4);o=new Float32Array(e)}a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},s.push(o.buffer)}else if(e.POSITION_QUANTIZED){let{byteOffset:c}=e.POSITION_QUANTIZED;const{array:h}=e.POSITION_QUANTIZED;c=c||0;const u=h?0:n;a.POSITION={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:this.Gn(h||new Uint16Array(t,c+u,3*r),i,o)},s.push(a.POSITION.array.buffer)}if(e.RGBA){let{byteOffset:i,array:o}=e.RGBA;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+4*r);o=new Uint8Array(e)}a.RGBA={byteStride:0,byteOffset:0,itemSize:4,count:r,componentType:5121,array:o},s.push(o.buffer)}else if(e.RGB){let{byteOffset:i,array:o}=e.RGB;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r);o=new Uint8Array(e)}a.RGB={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5121,array:o},s.push(o.buffer)}else if(e.RGB565){let{byteOffset:i,array:o}=e.RGB565;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+2*r);o=new Uint16Array(e)}a.RGB565={byteStride:0,byteOffset:0,itemSize:1,count:r,componentType:5123,array:o},s.push(o.buffer)}if(e.NORMAL){let{byteOffset:i,array:o}=e.NORMAL;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+3*r*4);o=new Float32Array(e)}a.NORMAL={byteStride:0,byteOffset:0,itemSize:3,count:r,componentType:5126,array:o},s.push(o.buffer)}else if(e.NORMAL_OCT16P){let{byteOffset:i,array:o}=e.NORMAL_OCT16P;i=i||0;const c=o?0:n;if(!o){const e=t.slice(i+c,i+c+2*r);o=new Uint8Array(e)}a.NORMAL_OCT16P={byteStride:0,byteOffset:0,itemSize:2,count:r,componentType:5121,array:o},s.push(o.buffer)}return a}Gn(t,e,n){return xe$1(new Float32Array(t.length),t,e,n)}Un(){return null}}function ws$1(t){const e=Mt$2(t),n=new e(t);for(let e=0;e<t;e++)n[e]=e;return{byteStride:0,byteOffset:0,itemSize:1,count:t,componentType:Me$1(e),array:n}}class vs$1{constructor(t,e,n,r){this.Pe=n,this.Pn=t,this.Rn=e||X$8,this.Fn=r}load(t,e,n=0,r=0,s){return e?this.kn(t,e,n,r,s):w$5.getArrayBuffer(t,{}).then((e=>this.kn(t,e.data,n,r)))}kn(t,e,n,r,s){r||(r=e.byteLength);const i=this.Xn(e,t,n,r),o=[];for(let n=0;n<i.length;n++){let r;if("b3dm"===i[n].magic)r=new ds$1(this.Pn,this.Rn,this.Pe);else if("i3dm"===i[n].magic)r=new ms$1(this.Pn,this.Rn,this.Pe,this.Fn);else if("pnts"===i[n].magic)r=new ys$1;else{if("cmpt"!==i[n].magic){console.warn("Unsupported magic in CMPT tile:",i[n].magic);continue}r=new vs$1(this.Pn,this.Rn,this.Pe,this.Fn)}o.push(r.load(t,e,i[n].offset,i[n].byteLength,s).then((t=>t)))}return Promise.all(o).then((t=>({magic:"cmpt",tiles:t})))}Xn(t,e,n,r){const s=new DataView(t,n,r),i=s.getUint32(4,!0);if(1!==i){const t="Unsupported cmpt version: "+i+", url:"+e;return console.warn(t),{error:t}}if(16===s.byteLength)return[];const o=[],a=s.getUint32(12,!0);let c=16;for(let e=0;e<a;e++){const e=fe$1(s,c),r=s.getUint32(c+8,!0);o.push({magic:e,buffer:t,offset:c+n,byteLength:r}),c+=r}return o}}if(transcoders){const n=t__namespace.Map.VERSION;if(n.indexOf("1.0.0-beta")>=0||n.indexOf("1.0.0-alpha")>=0){const n=transcoders.inject(T$3);t__namespace.registerWorkerAdapter("@maptalks/3dtiles",n)}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",(function(){return transcoders.inject(T$3)}))}else t__namespace.registerWorkerAdapter("@maptalks/3dtiles",T$3);"undefined"!=typeof console&&console.log("@maptalks/3dtiles v0.95.7");for(
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/
var planes=[],i=0;i<6;i++)planes[i]=[];var p$3=[];function intersectsBox(matrix,box,mask){!function(m){var me0=m[0],me1=m[1],me2=m[2],me3=m[3],me4=m[4],me5=m[5],me6=m[6],me7=m[7],me8=m[8],me9=m[9],me10=m[10],me11=m[11],me12=m[12],me13=m[13],me14=m[14],me15=m[15];setComponents(planes[0],me3-me0,me7-me4,me11-me8,me15-me12),setComponents(planes[1],me3+me0,me7+me4,me11+me8,me15+me12),setComponents(planes[2],me3+me1,me7+me5,me11+me9,me15+me13),setComponents(planes[3],me3-me1,me7-me5,me11-me9,me15-me13),setComponents(planes[4],me3-me2,me7-me6,me11-me10,me15-me14),setComponents(planes[5],me3+me2,me7+me6,me11+me10,me15+me14)}(matrix);for(var i=0;i<6;i++)if(!mask||"0"!==mask.charAt(i)){var plane=planes[i];if(p$3[0]=plane[0]>0?box[1][0]:box[0][0],p$3[1]=plane[1]>0?box[1][1]:box[0][1],p$3[2]=plane[2]>0?box[1][2]:box[0][2],distanceToPoint(plane,p$3)<0)return!1}return!0}function setComponents(out,x,y,z,w){var inverseNormalLength=1/Math.sqrt(x*x+y*y+z*z);return out[0]=x*inverseNormalLength,out[1]=y*inverseNormalLength,out[2]=z*inverseNormalLength,out[3]=w*inverseNormalLength,out}function distanceToPoint(plane,p){return plane[0]*p[0]+plane[1]*p[1]+plane[2]*p[2]+plane[3]}
/*!
	 * @maptalks/gltf-layer v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */const T$2='function(t){var e="undefined"!=typeof Float32Array?Float32Array:Array;function n(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3],a=e[4],c=e[5],u=e[6],h=e[7],f=e[8],l=e[9],d=e[10],m=e[11],g=e[12],p=e[13],_=e[14],b=e[15],y=n[0],w=n[1],A=n[2],x=n[3];return t[0]=y*r+w*a+A*f+x*g,t[1]=y*s+w*c+A*l+x*p,t[2]=y*i+w*u+A*d+x*_,t[3]=y*o+w*h+A*m+x*b,y=n[4],w=n[5],A=n[6],x=n[7],t[4]=y*r+w*a+A*f+x*g,t[5]=y*s+w*c+A*l+x*p,t[6]=y*i+w*u+A*d+x*_,t[7]=y*o+w*h+A*m+x*b,y=n[8],w=n[9],A=n[10],x=n[11],t[8]=y*r+w*a+A*f+x*g,t[9]=y*s+w*c+A*l+x*p,t[10]=y*i+w*u+A*d+x*_,t[11]=y*o+w*h+A*m+x*b,y=n[12],w=n[13],A=n[14],x=n[15],t[12]=y*r+w*a+A*f+x*g,t[13]=y*s+w*c+A*l+x*p,t[14]=y*i+w*u+A*d+x*_,t[15]=y*o+w*h+A*m+x*b,t}function r(){var t=new e(3);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function s(t,n,r){var s=new e(3);return s[0]=t,s[1]=n,s[2]=r,s}function i(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function o(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function a(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function c(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function u(t,e,n,r,s){return t[0]=e,t[1]=n,t[2]=r,t[3]=s,t}function h(t,e,n){var r=e[0],s=e[1],i=e[2],o=e[3];return t[0]=n[0]*r+n[4]*s+n[8]*i+n[12]*o,t[1]=n[1]*r+n[5]*s+n[9]*i+n[13]*o,t[2]=n[2]*r+n[6]*s+n[10]*i+n[14]*o,t[3]=n[3]*r+n[7]*s+n[11]*i+n[15]*o,t}function f(){var t=new e(4);return e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function l(t,e,n,r){var s=e[0],i=e[1],o=e[2],a=e[3],c=n[0],u=n[1],h=n[2],f=n[3],l=void 0,d=void 0,m=void 0,g=void 0,p=void 0;return(d=s*c+i*u+o*h+a*f)<0&&(d=-d,c=-c,u=-u,h=-h,f=-f),1-d>1e-6?(l=Math.acos(d),m=Math.sin(l),g=Math.sin((1-r)*l)/m,p=Math.sin(r*l)/m):(g=1-r,p=r),t[0]=g*s+p*c,t[1]=g*i+p*u,t[2]=g*o+p*h,t[3]=g*a+p*f,t}r(),function(){var t,n=(t=new e(4),e!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t)}();var d,m=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t};r(),s(1,0,0),s(0,1,0),f(),f(),d=new e(9),e!=Float32Array&&(d[1]=0,d[2]=0,d[3]=0,d[5]=0,d[6]=0,d[7]=0),d[0]=1,d[4]=1,d[8]=1;\n/*!\n   * @maptalks/gltf-loader v0.95.2\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.org\n   */\nlet g=0;function p(t){return null==t}function _(t){return!p(t)}function b(t){return!p(t)&&("string"==typeof t||null!==t.constructor&&t.constructor===String)}function y(t){for(let e=1;e<arguments.length;e++){const n=arguments[e];for(const e in n)t[e]=n[e]}return t}function w(t){switch(t){case 5120:return Int8Array;case 5121:return Uint8Array;case 5122:return Int16Array;case 5123:return Uint16Array;case 5124:return Int32Array;case 5125:return Uint32Array;case 5126:return Float32Array}throw new Error("unsupported bufferView\'s component type: "+t)}function A(t){return 0===t.indexOf("data:")&&t.indexOf("base64,")>0}function x(t){const e=function(t){return"undefined"!=typeof self?self.atob(t):window.atob(t)}(t.substring(t.indexOf(",")+1)),n=e.length,r=new Uint8Array(n);for(let t=0;t<n;t++)r[t]=e.charCodeAt(t);return r.buffer}const I=[],T=[],M=[],v=[0,0,0],O=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}([]),E=[1,1,1];function P(t,e,n,r,s,i,o){const a=w(o);if((0===s||s===r*a.BYTES_PER_ELEMENT)&&i%a.BYTES_PER_ELEMENT==0){const s=new a(e,i,n*r);return t.set(s),t}0===s&&(s=r*a.BYTES_PER_ELEMENT);const c=new Uint8Array(r*a.BYTES_PER_ELEMENT);for(let o=0;o<n;o++){let n=null;const u=new Uint8Array(e,s*o+i,r*a.BYTES_PER_ELEMENT);c.set(u),n=new a(c.buffer,0,r);for(let e=0;e<r;e++)t[o*r+e]=n[e]}return t}const k="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;function N(t,e,n){const r=new Uint8Array(t,e,n);return k.decode(r)}const S={get:function(t,e={}){e||(e={});const n=new AbortController,r=n.signal,s=y({},e);s.signal=r,s.method||(s.method="GET");const i=fetch(t,s).then(t=>{const n=this.t(t,e.responseType);return n.message?n:n.then(n=>"arraybuffer"===e.responseType?{data:n,cacheControl:t.headers.get("Cache-Control"),expires:t.headers.get("Expires"),contentType:t.headers.get("Content-Type")}:n).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t})}).catch(t=>{if(!t.code||t.code!==DOMException.ABORT_ERR)throw t});return i.xhr=n,i},t:(t,e)=>200!==t.status?{status:t.status,statusText:t.statusText,message:`incorrect http request with status code(${t.status}): ${t.statusText}`}:"arraybuffer"===e?t.arrayBuffer():"json"===e?t.json():t.text(),getArrayBuffer:(t,e={})=>(e||(e={}),e.responseType="arraybuffer",S.get(t,e)),getJSON:function(t,e={}){return e&&e.jsonp?S.jsonp(t):((e=e||{}).responseType="json",S.get(t,e))},jsonp:function(t){const e="_maptalks_jsonp_"+g++;t.match(/\\?/)?t+="&callback="+e:t+="?callback="+e;let n=document.createElement("script");return n.type="text/javascript",n.src=t,new Promise(t=>{window[e]=function(r){document.getElementsByTagName("head")[0].removeChild(n),n=null,delete window[e],t(r)},document.getElementsByTagName("head")[0].appendChild(n)})}};class B{constructor(t,e,n,r){this.s=t,this.decoders=e,this.i=n,this.images={},this.o={},this.u=r||{}}requestImageFromBufferURI(t,e,n){if(this.buffers[t.id]){const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)}if(this.o[t.id])return this.o[t.id].then(()=>{const r=this.buffers[t.id],s=this.h(e,r);return this.getImageByBuffer(s,n)});if(A(t.uri)){const r=this.buffers[t.id]=x(t.uri),s=this.h(e,r);return this.getImageByBuffer(s,n)}let r;const s=t.uri.indexOf("blob:")>=0;return r=t.uri.indexOf("://")>0||s?t.uri:this.rootPath+"/"+t.uri,this.o[t.id]=S.getArrayBuffer(r,this.u).then(r=>{const s=this.buffers[t.id]=r.data,i=this.h(e,s);return this.getImageByBuffer(i,n)})}getImageByBuffer(t,e){if(this.images[e.id])return Promise.resolve(this.images[e.id]);const n=this.decoders;return n[e.mimeType]?n[e.mimeType](t,{supportedFormats:this.i}):"image/crn"===e.mimeType||"image/ktx2"===e.mimeType||"image/cttf"===e.mimeType?(console.warn("missing transcoder for "+e.mimeType,", visit https://maptalks.com/docs/transcoders for details"),Promise.resolve(null)):this.l(e.id,t)}requestExternalImage(t){if(this.images[t.id])return Promise.resolve(this.images[t.id]);const e=0===t.uri.indexOf("data:image/")?t.uri:this.rootPath+"/"+t.uri;return this.o[t.id]?this.o[t.id].then(()=>this.images[t.id]):this.o[t.id]=this.l(t.id,e)}l(t,e){return new Promise((n,r)=>{this.s(e,this.u,(s,i)=>{s?r(s):(URL.revokeObjectURL(e),this.images[t]=i,n(this.images[t]))})})}}const R=["SCALAR",1,"VEC2",2,"VEC3",3,"VEC4",4,"MAT2",4,"MAT3",9,"MAT4",16],C=[];class U{constructor(t,e,n,r){this.rootPath=t,this.gltf=e,this.m=!1,this.glbBuffer=n,this.buffers={},this.requests={},this.accessors={},this.g(),this.u=r}p(t,e){const n=this.gltf,r=n.accessors[e];if(void 0===r.bufferView)return this.accessors[r.id]=this._(t,e,null,0),Promise.resolve(this.accessors[r.id]);if(r&&this.accessors[r.id])return Promise.resolve(this.accessors[r.id]);const s=n.bufferViews[r.bufferView];return this.A(s).then(n=>{const{buffer:s,byteOffset:i}=n;return this.accessors[r.id]=this._(t,e,s,i)})}A(t){const e=this.gltf.buffers[t.buffer];if(this.buffers[e.id]){const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})}if(this.requests[e.id])return this.requests[e.id].then(()=>{const t=this.buffers[e.id];return Promise.resolve({buffer:t,byteOffset:0})});if("binary_glTF"!==t.buffer&&"KHR_binary_glTF"!==t.buffer&&e.uri){if(A(e.uri)){const t=this.buffers[e.id]=x(e.uri);return Promise.resolve({buffer:t,byteOffset:0})}let t;const n=e.uri.indexOf("blob:")>=0;return t=e.uri.indexOf("://")>0||n?e.uri:this.rootPath+"/"+e.uri,this.requests[e.id]=S.getArrayBuffer(t,this.u).then(r=>(n&&URL.revokeObjectURL(t),{buffer:this.buffers[e.id]=r.data,byteOffset:0}))}return Promise.resolve({buffer:this.glbBuffer.buffer,byteOffset:this.glbBuffer.byteOffset})}_(t,e,n,r=0){const s=this.gltf,i=s.accessors[e],o=void 0!==i.bufferView?s.bufferViews[i.bufferView]:{},a=(o.byteOffset||0)+r,c=this.I(i.type),u=w(i.componentType),f=o.byteStride||0,l={array:void 0,name:t,accessorName:e,byteLength:i.count*c*u.BYTES_PER_ELEMENT,componentType:i.componentType,count:i.count,type:i.type,itemSize:c,max:i.max,min:i.min,extensions:i.extensions};if(i.min&&(l.min=i.min),i.max&&(l.max=i.max),n)if(this.m)l.byteStride=f,l.byteOffset=a+(i.byteOffset||0),!f||f===c*u.BYTES_PER_ELEMENT||"indices"===t||"input"===t||"output"===t||t.indexOf("morph")>=0?(l.array=this.T(n,i.count,c,a+(i.byteOffset||0),u),l.array.buffer.byteLength===l.byteLength&&(l.byteOffset=0)):l.array=new Uint8Array(n,a,o.byteLength);else if(i.interleaved){l.byteStride=0,l.byteOffset=0;const t=new u(i.count*c);if(l.array=P(t,n,i.count,c,f,a+(i.byteOffset||0),i.componentType),l.extensions&&l.extensions.WEB3D_quantized_attributes&&c>2){const t=new Float32Array(l.array.length),{decodeMatrix:e}=l.extensions.WEB3D_quantized_attributes;for(let n=0;n<l.array.length;n+=c){C[0]=l.array[n],C[1]=l.array[n+1],C[2]=l.array[n+2],C[3]=1;const r=h(C,C,e);t[n]=r[0],t[n+1]=r[1],t[n+2]=r[2]}l.componentType=5126,l.array=t}}else l.byteStride=0,l.array=this.T(n,i.count,c,a+(i.byteOffset||0),u),l.byteOffset=l.array.byteOffset;else{l.array=new u(i.count);const t=l.min||l.max;t&&(l.array[0]=t[0],l.array[1]=t[1],l.array[2]=t[2])}return l}g(){const t=this.gltf.accessors;if(Array.isArray(t))for(let e=0;e<t.length;e++)for(let n=0;n<t.length;n++)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0);else for(const e in t)for(const n in t)e!==n&&t[e].bufferView===t[n].bufferView&&(t[e].interleaved=t[n].interleaved=!0)}T(t,e,n,r,s){return r%s.BYTES_PER_ELEMENT!=0&&(t=t.slice(r,r+e*n*s.BYTES_PER_ELEMENT),r=0),new s(t,r,n*e)}I(t){const e=R.indexOf(t);return R[e+1]}requestKHRTechniquesWebgl(t){const{shaders:e}=t,n=e.map(t=>{if(void 0!==t.bufferView){const e=this.gltf.bufferViews[t.bufferView],{byteLength:n}=e;return this.A(e).then(r=>{const{buffer:s,byteOffset:i}=r,o=N(s,i+(e.byteOffset||0),n);return t.content=o,t})}if(t.uri){if(A(t.uri)){const e=x(t.uri),n=N(e,0,e.byteLength);return t.content=n,Promise.resolve(t)}{const e=this.rootPath+"/"+t.uri;return S.get(e,this.u).then(e=>(t.content=e,t))}}return Promise.resolve(t)});return Promise.all(n).then(()=>t)}}class L extends B{constructor(t,e,n,r,s,i,o){super(r,s,i,o),this.rootPath=t,this.gltf=e,this.requests={},this.buffers={},this.glbBuffer=n,this.accessor=new U(t,e,n,o)}iterate(t,e){const n=this.gltf[e];if(!n)return;let r=0;for(const e in n)t(e,n[e],r++)}createNode(t){const e={};if(_(t.name)&&(e.name=t.name),_(t.children)&&(e.children=t.children),_(t.jointName)&&(e.jointName=t.jointName),_(t.matrix)&&(e.matrix=t.matrix),_(t.rotation)&&(e.rotation=t.rotation),_(t.scale)&&(e.scale=t.scale),_(t.translation)&&(e.translation=t.translation),_(t.extras)&&(e.extras=t.extras),_(t.meshes)&&(e.mesh=t.meshes[0]),e.translation||e.rotation||e.scale){const t=function(t,e){if(e.matrix)return e.matrix;if(e.translation||e.scale||e.rotation){const r=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}(I,e.translation||v),s=function(t,e){var n=e[0],r=e[1],s=e[2],i=e[3],o=n+n,a=r+r,c=s+s,u=n*o,h=r*o,f=r*a,l=s*o,d=s*a,m=s*c,g=i*o,p=i*a,_=i*c;return t[0]=1-f-m,t[1]=h+_,t[2]=l-p,t[3]=0,t[4]=h-_,t[5]=1-u-m,t[6]=d+g,t[7]=0,t[8]=l+p,t[9]=d-g,t[10]=1-u-f,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(T,e.rotation||O),i=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(M,e.scale||E);return n(i,s,i),n(t,r,i)}return function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}(t)}([],e);delete e.translation,delete e.rotation,delete e.scale,e.matrix=t}return e}M(t){const e={};for(const n in t){const r=t[n];let s,i;r.instanceTechnique&&r.instanceTechnique.values?(s=r.instanceTechnique,i=s.values.diffuse):(s=r,i=s.values.tex||s.values.diffuseTex||s.values.diffuse);const o={baseColorTexture:{index:i}};r.name&&(o.name=r.name),r.extensions&&(o.extensions=r.extensions),r.extras&&(o.extras=r.extras),e[n]=o}return e}v(t){if(t.bufferView||t.extensions&&(t.extensions.KHR_binary_glTF||t.extensions.binary_glTF)){const e=t.bufferView?t:t.extensions.KHR_binary_glTF||t.extensions.binary_glTF;t.extensions&&(t.mimeType=e.mimeType,t.width=e.width,t.height=e.height);const n=this.gltf.bufferViews[e.bufferView],r=(n.byteOffset||0)+this.glbBuffer.byteOffset,s=n.byteLength,i=this.buffers[e.bufferView]=new Uint8Array(this.glbBuffer.buffer,r,s);return this.getImageByBuffer(i,t)}return this.requestExternalImage(t)}O(t){const e=this.gltf.textures[t];if(!e)return null;const n=this.gltf.images[e.source];return this.v(n).then(t=>{const r=this.gltf.samplers[e.sampler];return{image:{array:t.data,width:t.width,height:t.height,index:e.source,mimeType:n.mimeType,name:n.name,extras:n.extras},sampler:r}})}getBaseColorTexture(t){const e=this.gltf.materials[t];let n,r;if(e.instanceTechnique&&e.instanceTechnique.values?(n=e.instanceTechnique,r=n.values.diffuse):(n=e,r=n.values.tex||n.values.diffuseTex||n.values.diffuse),void 0===r||void 0===this.gltf.textures)return null;const s=this.gltf.textures[r];if(!s)return null;const i=this.gltf.samplers[s.sampler];return{format:s.format||6408,internalFormat:s.internalFormat||6408,type:s.type||5121,sampler:i,source:this.gltf.images[s.source]}}getMaterial(){return null}getAnimations(){return null}}class D extends B{constructor(t,e,n,r,s,i,o){super(r,s,i,o),this.rootPath=t,this.gltf=e,this.glbBuffer=n,this.buffers={},this.requests={},this.accessor=new U(t,e,n,o)}iterate(t,e){const n=this.gltf[e];if(n)for(let e=0;e<n.length;e++)t(e,n[e],e)}createNode(t){const e={};return y(e,t),!_(t.weights)&&this.gltf.meshes&&_(e.mesh)?e.weights=this.gltf.meshes[e.mesh].weights:t.weights&&(e.weights=t.weights),e}O(t){const e=this.gltf.textures[t];if(!e)return null;let n=e.source;if(e.extensions&&e.extensions.EXT_texture_webp&&(n=e.extensions.EXT_texture_webp.source),!_(n))return null;const r=this.gltf.images[n];return this.v(r).then(t=>{if(!t)return null;const n={image:{array:t.data,mipmap:t.mipmap,width:t.width,height:t.height,index:e.source,mimeType:r.mimeType,name:r.name,extensions:r.extensions,extras:r.extras}};y(n,e);const s=_(e.sampler)?this.gltf.samplers[e.sampler]:void 0;return s&&(n.sampler=s,n.sampler.magFilter=s.magFilter||9729,n.sampler.minFilter=s.minFilter||9729,n.sampler.wrapS=s.wrapS||10497,n.sampler.wrapT=s.wrapT||10497),t.format&&(n.format=t.format),n})}v(t){if(!_(t.bufferView))return this.requestExternalImage(t);{const e=this.gltf.bufferViews[t.bufferView],n=this.gltf.buffers[e.buffer];if(n.uri)return this.requestImageFromBufferURI(n,e,t);if(this.glbBuffer)return this.P(e,t)}return null}P(t,e){const n=this.h(t,this.glbBuffer.buffer,this.glbBuffer.byteOffset);return this.getImageByBuffer(n,e)}h(t,e,n){n=n||0;const r=t.byteOffset+n,s=t.byteLength;return new Uint8Array(e,r,s)}k(t,e){const n=new Array(t.byteLength);for(let e=0;e<t.byteLength;e++)n[e]=String.fromCharCode(t[e]);return n.join(""),"data:"+(e=e||"image/png")+";base64,"+function(t){return"undefined"!=typeof self?self.btoa(t):window.btoa(t)}(unescape(encodeURIComponent(n)))}getAnimations(t){const e=[];return t.forEach(t=>{e.push(this.getSamplers(t.samplers))}),Promise.all(e).then(e=>{for(let n=0;n<e.length;n++)t[n].samplers=e[n];return t})}getSamplers(t){const e=[];for(let n=0;n<t.length;n++)(_(t[n].input)||_(t[n].output))&&(e.push(this.accessor.p("input",t[n].input)),e.push(this.accessor.p("output",t[n].output)));return Promise.all(e).then(e=>{for(let n=0;n<e.length/2;n++)t[n].input=e[2*n],t[n].output=e[2*n+1],t[n].interpolation||(t[n].interpolation="LINEAR");return t})}}const q="undefined"!=typeof TextDecoder?new TextDecoder("utf-8"):null;class F{static read(t,e=0,n=0){n||(n=t.byteLength);const r=new DataView(t,e,n),s=r.getUint32(4,!0);if(1===s)return F.readV1(r,e);if(2===s)return F.readV2(t,e);throw new Error("Unsupported glb version : "+s)}static readV1(t,e){const n=t.getUint32(8,!0),r=t.getUint32(12,!0);if(n!==t.byteLength)throw new Error("Length in GLB header is inconsistent with glb\'s byte length.");const s=j(t.buffer,20+e,r);return{json:JSON.parse(s),glbBuffer:{byteOffset:20+e+r,buffer:t.buffer,byteLength:n}}}static readV2(t,e){let n,r,s;const i=new DataView(t,e+12);let o=0;for(;o<i.byteLength;){const a=i.getUint32(o,!0);o+=4;const c=i.getUint32(o,!0);if(o+=4,1313821514===c)n=j(t,e+12+o,a);else if(5130562===c){s=e+12+o,r=a;break}o+=a}return{json:JSON.parse(n),glbBuffer:{byteOffset:s,buffer:t,byteLength:r}}}}function j(t,e,n){if(q){const r=new Uint8Array(t,e,n);return q.decode(r)}return function(t){const e=t.length;let n="";for(let r=0;r<e;){let s=t[r++];if(128&s){let n=V[s>>3&7];if(!(64&s)||!n||r+n>e)return null;for(s&=63>>n;n>0;n-=1){const e=t[r++];if(128!=(192&e))return null;s=s<<6|63&e}}n+=String.fromCharCode(s)}return n}(new Uint8Array(t,e,n))}const V=[1,1,1,1,2,2,3,0],H=[0,0,0],K=[0,0,0,1],$=[1,1,1],G={TRANSLATION:[0,0,0],ROTATION:[0,0,0,1],SCALE:[1,1,1]},X={PREVIOUS:null,NEXT:null,PREINDEX:null,NEXTINDEX:null,INTERPOLATION:null},z={N(t,e,n,r,s,o,a,c){const u=_(t)?e.animations:[e.animations[0]],h={};for(let e=0;e<u.length;e++){const f=u[e],l=f.name||e;if(_(t)&&l!==t)continue;const d=f.channelsMap[n];if(d)for(let t=0;t<d.length;t++){const e=d[t];"translation"===e.target.path?(this.S(s,f.samplers[e.sampler],r,1),h.translation=i(H,s)):"rotation"===e.target.path?(this.B(o,f.samplers[e.sampler],r,1),h.rotation=m(K,o)):"scale"===e.target.path?(this.S(a,f.samplers[e.sampler],r,1),h.scale=i($,a)):"weights"===e.target.path&&c&&(this.S(c,f.samplers[e.sampler],r,c.length),h.weights=c)}}return h},S(t,e,n,r){switch(e.interpolation){case"LINEAR":{const s=this.R(X,e,n,1*r);s&&(t=function(t,e,n,r){for(let s=0;s<t.length;s++)t[s]=e[s]+r*(n[s]-e[s]);return t}(t,s.PREVIOUS,s.NEXT,s.INTERPOLATION));break}case"STEP":{const s=this.R(X,e,n,1*r);s&&(t=function(t,e){for(let n=0;n<t.length;n++)t[n]=e[n];return t}(t,...s.PREVIOUS));break}case"CUBICSPLINE":{const s=this.R(X,e,n,3*r);s&&(t=this.C(t,s,e.input.array,3*r));break}}return t},B(t,e,n){switch(e.interpolation){case"LINEAR":{const r=this.R(X,e,n,1);r&&l(t,r.PREVIOUS,r.NEXT,r.INTERPOLATION);break}case"STEP":{const r=this.R(X,e,n,1);r&&(t=u(t,...r.PREVIOUS));break}case"CUBICSPLINE":{const r=this.R(X,e,n,3);if(r){for(let t=0;t<r.PREVIOUS.length;t++)r.PREVIOUS[t]=Math.acos(r.PREVIOUS[t]),r.NEXT[t]=Math.acos(r.NEXT[t]);t=this.C(t,r,e.input.array,3);for(let e=0;e<t.length;e++)t[e]=Math.cos(t[e])}break}}return t},U(t,e){const n=t.length;let r,s,i,o=0,a=n-1,c=Math.floor((o+a)/2);for(;o<=n-1&&a>=0;){if(o===a)return null;if(t[c]<=e&&e<=t[c+1]){const n=t[c];return r=c,s=c+1,i=(e-n)/(t[c+1]-n),{preIndx:r,nextIndex:s,interpolation:i}}e<t[c]?(a=c,c=Math.floor((o+a)/2)):t[c+1]<e&&(o=c,c=Math.floor((o+a)/2))}return null},R(t,e,n,r){const s=e.input.array,i=e.output.array,o=e.output.itemSize;(n<s[0]||n>s[s.length-1])&&(n=Math.max(s[0],Math.min(s[s.length-1],n))),n===s[s.length-1]&&(n=s[0]);const a=this.U(s,n);if(!a||!a.nextIndex)return null;const{preIndx:c,nextIndex:u,interpolation:h}=a;t.PREINDEX=c,t.NEXTINDEX=u,t.INTERPOLATION=h;const f=o*r;return t.PREVIOUS=i.subarray(t.PREINDEX*f,(t.PREINDEX+1)*f),t.NEXT=i.subarray(t.NEXTINDEX*f,(t.NEXTINDEX+1)*f),t},C(t,e,n,r){const s=e.INTERPOLATION,i=n[e.PREINDEX],o=n[e.NEXTINDEX];for(let n=0;n<3;n++){const a=e.PREVIOUS[r+n],c=(o-i)*e.PREVIOUS[2*r+n],u=e.NEXT[3+n],h=(o-i)*e.NEXT[n],f=(2*Math.pow(s,3)-3*Math.pow(s,2)+1)*a+(Math.pow(s,3)-2*Math.pow(s,2)+s)*c+(2*-Math.pow(s,3)+3*Math.pow(s,2))*u+(Math.pow(s,3)-Math.pow(s,2))*h;t[n]=f}return t},getAnimationClip(t,e,n,r){const s=t.nodes[e]&&t.nodes[e].weights;return o(H,...G.TRANSLATION),u(K,...G.ROTATION),o($,...G.SCALE),this.N(r,t,e,n,H,K,$,s)},getTimeSpan(t){if(!t.animations)return null;if(t.timeSpan)return t.timeSpan;const e=t.animations;return t.timeSpan={},e.forEach((e,n)=>{let r=-1/0,s=1/0;const i=e.channels;for(let t=0;t<i.length;t++){const n=i[t],o=e.samplers[n.sampler].input.array;o[o.length-1]>r&&(r=o[o.length-1]),o[0]<s&&(s=o[0])}const o=e.name||n;t.timeSpan[o]={max:r,min:s}}),t.timeSpan},getTimeSpanByName(t,e){const n=this.getTimeSpan(t);return n?_(e)?n[e]:n[Object.keys(n)[0]]:null}};let J=!1;if("undefined"!=typeof OffscreenCanvas){let t;try{t=new OffscreenCanvas(2,2).getContext("2d")}catch(at){}t&&"undefined"!=typeof createImageBitmap&&(J=!0)}const W="undefined"==typeof document?null:document.createElement("canvas");class Q{constructor(t,e,n){if(this.options=n||{},this.options.decoders||(this.options.decoders={}),this.u=this.options.fetchOptions||{},e.buffer instanceof ArrayBuffer){const{json:n,glbBuffer:r}=F.read(e.buffer,e.byteOffset,e.byteLength);this.L(t,n,r)}else this.L(t,e);this.D=new U(this.rootPath,this.gltf,this.glbBuffer,this.u),this.q()}q(){const t=this.gltf.extensionsRequired;if(t){if(t.indexOf("KHR_draco_mesh_compression")>=0&&!this.options.decoders.draco)throw new Error("KHR_draco_mesh_compression is required but @maptalks/transcoders.draco is not loaded");if(t.indexOf("KHR_texture_basisu")>=0&&!this.options.decoders.ktx2)throw new Error("KHR_texture_basisu is required but @maptalks/transcoders.ktx2 is not loaded")}}F(){const t=this.gltf.extensions;return t&&t.KHR_techniques_webgl?this.D.requestKHRTechniquesWebgl(t.KHR_techniques_webgl).then(e=>(t.KHR_techniques_webgl=e,t)):Promise.resolve(t)}load(t){t=t||{};const e=this.j(t),n=this.V(),r=this.H(),s=this.F();return Promise.all([e,n,r,s]).then(t=>(t[0].animations=t[1],t[0].textures=t[2],t[0].extensions=t[3],t[0].transferables=this.transferables||[],this.createChannelsMap(t[0]),t[0]))}createChannelsMap(t){const e=t.animations;if(e)for(let t=0;t<e.length;t++){const n=e[t];n.channelsMap={};for(let t=0;t<n.channels.length;t++){const e=n.channels[t];n.channelsMap[e.target.node]||(n.channelsMap[e.target.node]=[]),n.channelsMap[e.target.node].push(e)}}}getExternalResources(){const t=[];if(this.gltf){const{buffers:e,images:n}=this.gltf;for(let n=0;n<e.length;n++)e[n].uri&&e[n].uri.indexOf("data:application/octet-stream;base64")<0&&t.push({type:"buffer",uri:e[n].uri});for(let e=0;e<n.length;e++)n[e].uri&&n[e].uri.indexOf("data:image/")<0&&t.push({type:"image",uri:n[e].uri})}return t}static getAnimationClip(t,e,n,r){return z.getAnimationClip(t,e,n,r)}static getAnimationTimeSpan(t,e){return z.getTimeSpanByName(t,e)}static getTypedArrayCtor(t){return w(t)}static readInterleavedArray(t,e,n,r,s,i,o){return P(t,e,n,r,s,i,o)}L(t,e,n){this.gltf=e,this.glbBuffer=n,this.version=e.asset?+e.asset.version:1,this.rootPath=t,this.buffers={},this.requests={},this.options.requestImage=J?et.bind(this):this.options.requestImage||Y,this.options.transferable&&(this.transferables=[]),2===this.version?(this.adapter=new D(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.u),this.adapter.iterate((t,e,n)=>{e.id="buffer_"+n},"buffers"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors")):(this.adapter=new L(t,e,n,this.options.requestImage,this.options.decoders||{},this.options.supportedFormats||{},this.u),this.adapter.iterate((t,e,n)=>{e.id="accessor_"+n},"accessors"),this.adapter.iterate((t,e,n)=>{e.id="image_"+n},"images"))}K(t,e){if(t.children&&t.children.length>0){if(!("number"==typeof(n=t.children[0])&&isFinite(n)||b(t.children[0])))return t;const r=t.children.map(t=>{const n=e[t];return n.nodeIndex=t,this.K(n,e)});t.children=r}var n;return t}j(t){return this.$(t).then(t=>{const e=this.scenes=[];let n;for(const e in t)t[e]=this.K(t[e],t),t[e].nodeIndex=Number(e)?Number(e):e;this.adapter.iterate((r,s,i)=>{const o={};s.name&&(o.name=s.name),s.nodes&&(o.nodes=s.nodes.map(e=>t[e])),this.gltf.scene===r&&(n=i),e.push(o)},"scenes");const r={textures:this.gltf.textures,asset:this.gltf.asset,scene:n,scenes:e,nodes:t,meshes:this.meshes,materials:this.gltf.materials,skins:this.skins,extensionsRequired:this.gltf.extensionsRequired,extensionsUsed:this.gltf.extensionsUsed};if(this.gltf.extensions&&(r.extensions=this.gltf.extensions),1===this.version){const t=this.adapter.M(this.gltf.materials);r.materials=t}return delete this.gltf.buffers,r.json=this.gltf,r})}$(t){return this.G(t).then(()=>{const t=this.nodes={};return this.adapter.iterate((e,n)=>{const r=this.adapter.createNode(n,this.meshes,this.skins);t[e]=r},"nodes"),t})}X(){this.skins=[];const t=[];return this.adapter.iterate((e,n,r)=>{t.push(this.J(n).then(t=>{t.index=r,this.skins.push(t)}))},"skins"),t}J(t){const e=t.inverseBindMatrices;return this.adapter.accessor.p("inverseBindMatrices",e).then(e=>(t.inverseBindMatrices=e,e&&e.buffer&&this.transferables&&this.transferables.indexOf(e.buffer)<0&&this.transferables.push(e.buffer),t))}V(){const t=this.gltf.animations;return _(t)?this.adapter.getAnimations(t):null}G(t){this.meshes={};let e=[];return this.adapter.iterate((n,r,s)=>{e.push(this.W(r,t).then(t=>{t.index=s,this.meshes[n]=t}))},"meshes"),e=e.concat(this.X()),Promise.all(e)}W(t,e){const n=t.primitives.map(t=>this.Y(t,e)).filter(t=>!!t);return Promise.all(n).then(e=>{const n={};return y(n,t),n.primitives=e,n})}H(){const t=this.gltf.textures;if(!t)return null;const e=[];for(const n in t)e.push(this.adapter.O(n));return Promise.all(e).then(e=>{if(this.transferables)for(let t=0;t<e.length;t++){const n=e[t].image.array;if(e[t]&&n){let t;t=n instanceof ImageBitmap?n:n.buffer,t&&this.transferables.indexOf(t)<0&&this.transferables.push(t)}}if(!Array.isArray(t)){const n={},r=Object.keys(t);for(let t=0;t<e.length;t++)e[t]&&(n[r[t]]=e[t]);return n}return e})}Y(t,e){let n;const r=[],s=t.extensions;if(_(t.targets))for(let e=0;e<t.targets.length;e++){const n=t.targets[e];for(const t in n){const s=this.adapter.accessor.p(`morphTargets_${t}_${e}`,n[t]);s&&r.push(s)}}if(s&&s.KHR_draco_mesh_compression){if(!this.options.decoders.draco&&(!this.gltf.extensionsRequired||!this.gltf.extensionsRequired.indexOf("KHR_draco_mesh_compression")<0))return null;const t=this.options.decoders.draco,{bufferView:i,attributes:o}=s.KHR_draco_mesh_compression,a=this.gltf.bufferViews[i],c=this.D.A(a).then(n=>{const{buffer:r,byteOffset:s}=n;let{byteOffset:i}=a;const c=a.byteLength;i||(i=0);const u=new DataView(r,s+i,c),h={attributes:o,useUniqueIDs:!1,skipAttributeTransform:e.skipAttributeTransform};return t(u,h).then(t=>{const e=Object.values(t.attributes);return t.indices&&e.push(t.indices),e})});r.push(c),n=Promise.all(r)}else{const e=t.attributes;for(const t in e){const n=this.adapter.accessor.p(t,e[t]);n&&r.push(n)}if(_(t.indices)){const e=this.adapter.accessor.p("indices",t.indices);e&&r.push(e)}n=Promise.all(r)}return n.then(e=>{if(s&&s.KHR_draco_mesh_compression){const n=t.targets?t.targets.length:0;e[n]=e[n].concat(e.slice(0,n)),e=e[n]}let n,r;const i={attributes:e.reduce((t,e)=>{if("indices"===e.name)n=e;else if(e.name.indexOf("morphTargets_")>-1)r=r||{},r[e.name.slice(13)]=e;else{if(!("POSITION"!==e.name||e.min&&e.max)){const t=[1/0,1/0,1/0],n=[-1/0,-1/0,-1/0],{itemSize:r,array:s}=e,i=s.length/r;for(let e=0;e<i;e++)for(let i=0;i<r;i++){const o=e*r+i;s[o]<t[i]&&(t[i]=s[o]),s[o]>n[i]&&(n[i]=s[o])}if(e.quantization){const r=e.quantization,s=r.range/(1<<r.quantizationBits),i=r.minValues;c(t,t,s),a(t,t,i),c(n,n,s),a(n,n,i)}e.min=t,e.max=n}t[e.name]=e}return this.transferables&&e.array.buffer&&this.transferables.indexOf(e.array.buffer)<0&&this.transferables.push(e.array.buffer),t},{}),material:t.material};return n&&(i.indices=n),r&&(i.morphTargets=r),i.mode=_(t.mode)?t.mode:4,_(t.extras)&&(i.extras=t.extras),i})}}function Y(t,e,n){const r=new Image;r.crossOrigin="",r.onload=()=>{if(!W)return void n(new Error("There is no canvas to draw image!"));W.width=r.width,W.height=r.height;const t=W.getContext("2d",{willReadFrequently:!0});t.drawImage(r,0,0,r.width,r.height);const e=t.getImageData(0,0,r.width,r.height),s={width:r.width,height:r.height,data:new Uint8Array(e.data)};n(null,s)},r.onerror=function(t){n(t)},r.src=t}let Z,tt;function et(t,e,n){Z||(Z=new OffscreenCanvas(2,2),tt=Z.getContext("2d",{willReadFrequently:!0}));let r=null;if(b(t))r=fetch(t,e).then(t=>t.arrayBuffer()).then(t=>{const e=new Blob([new Uint8Array(t)]);return createImageBitmap(e)});else{const e=new Blob([t]);r=createImageBitmap(e)}r.then(nt.bind(this)).then(t=>{n(null,t)}).catch(t=>{console.warn(t),n(t)})}function nt(t){let{width:e,height:n}=t;rt(e)||(e=st(e)),rt(n)||(n=st(n));const r=this.options.maxTextureSize;r&&(e=Math.min(r,e),n=Math.min(r,n)),Z.width=e,Z.height=n,tt.drawImage(t,0,0,e,n),t.close();const s=tt.getImageData(0,0,e,n);return{width:e,height:n,data:new Uint8Array(s.data)}}function rt(t){return 0==(t&t-1)&&0!==t}function st(t){return Math.pow(2,Math.floor(Math.log(t)/Math.LN2))}\n/*!\n   * @maptalks/gl v0.95.6\n   * LICENSE : UNLICENSED\n   * (c) 2016-2024 maptalks.com\n   */const it=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if("undefined"!=typeof undefined)return global;throw new Error("unable to locate global object")},ot=it(),at=ot.gl_trans__coders=ot.gl_trans__coders||{};at.inject=function(t){const e=t.toString(),n=e.indexOf("{")+1,r=e.substring(0,n),s=ot.gl_trans__coders=ot.gl_trans__coders||{};let i=`${r}\\n    const _____getGlobal = ${it.toString()};\\n    const g___lobals = _____getGlobal()\\n    const tran_____scoders = g___lobals[\'gl_trans__coders\'] = g___lobals[\'gl_trans__coders\'] || {};`;for(const t in s)"inject"!==t&&"getTranscoder"!==t&&"registerTranscoder"!==t&&(i+=\'tran_____scoders["\'+t+\'"] =\'+s[t].toString()+"\\n;");return i+="\\n"+e.substring(r.length),i},at.registerTranscoder=function(t,e){at[t]=e},at.getTranscoder=function(t){return at[t]};const ct={"image/crn":at.crn&&at.crn(),"image/ktx2":at.ktx2&&at.ktx2(),"image/cttf":at.ktx2&&at.ktx2(),"draco":at.draco&&at.draco()};let ut;const ht={};function ft(t,e,n){return new Q(t,e,n).load({skipAttributeTransform:!0})}function lt(t,e,n){const r=e.lastIndexOf("/"),s=e.slice(0,r),i=dt.bind(this,t);return function(t,e){return S.getArrayBuffer(t,e)}(e,n).then(t=>{if(t.message)return t;const r=t.data;return new DataView(r,r.byteOffset,r.byteLength).getUint32(4,!0)>2?function(t,e){return S.getJSON(t,e)}(e,n).then(t=>t.message?t:ft(s,t,{requestImage:i,decoders:ct,transferable:!0,fetchOptions:n})):ft(s,{buffer:t.data,byteOffset:0},{requestImage:i,decoders:ct,transferable:!0,fetchOptions:n})})}function dt(t,e,n,r){ht[e]?ht[e].push(r):(ht[e]=[r],self.postMessage({type:"<request>",command:"sendImageData",actorId:t,workerId:ut,params:e}))}t.onmessage=function(t){const e=t.data,n=e.url;if("addLayer"===e.command||"removeLayer"===e.command)ut=t.workerId,self.postMessage({type:"<response>",actorId:e.actorId,workerId:ut,params:"ok"});else if(n)!function(t){const e=t.data,n=t.callback,r=t.actorId,s=e.url,i=e.fetchOptions||{};i.referrerPolicy=i.referrerPolicy||"origin",i.referrer=e.referrer,lt(r,s,i).then(t=>{t.message?self.postMessage({callback:n,error:t}):self.postMessage({callback:n,data:t},t.transferables)}).catch(t=>{self.postMessage({callback:n,error:t})}),ht.receive=n}(t);else if(e.imageUrl){const t=ht[e.imageUrl];if(delete ht[e.imageUrl],t)for(let n=0;n<t.length;n++)t[n](null,e.result)}},Object.defineProperty(t,"Z",{value:!0})}';function M$2(t){return null==t}function O$2(t){return!M$2(t)}function S$2(t,s){if(!t||!s)return null;let i=s;if(Array.isArray(s)){if(!t$1.Util.isNumber(s[0]))return null;i=new t$1.Coordinate(s)}const r=t.coordinateToPointAtRes(i,t.getGLRes()),o=t.altitudeToPoint(i.z||0,t.getGLRes());return[r.x,r.y,o]}function A(t,e){return Math.abs(t)*Math.sign(e)}function E$2(t,n,i){const r=t$1.measurer.Measurer.getInstance().measureLenBetween(t,n);let a=i.count;a&&i.snapToEndVertexes&&(a-=1);const h=a>0?r/a:i.gapLength+i.bboxWidth,c=Math.floor(r/h),u=[],f=i.rotateAlongLine?function(t,n,s){const i=s.getGLRes(),r=s.coordinateToPointAtRes(t,i),o=s.coordinateToPointAtRes(n,i);return t$1.Util.computeDegree(o.x,o.y,r.x,r.y)/Math.PI*180}(t,n,i.map):0;if(c>=1){const e=0,s=c;if(i.snapToEndVertexes)for(let i=e;i<=s;i++){const e={coordinates:P$1(t,n,h*i/r),scale:[1,1,1],rotation:[0,0,f]};u.push(e)}else for(let i=e+1;i<=s;i++){const e={coordinates:P$1(t,n,h*(i-.5)/r),scale:[1,1,1],rotation:[0,0,f]};u.push(e)}if(i.scaleEndModel){const e=(r-h*c)/h,s={coordinates:P$1(t,n,(h*c+(r-h*c)/2)/r),scale:[e,1,1],rotation:[0,0,f]};u.push(s)}}else if(i.scaleEndModel){const e=r/h,s={coordinates:P$1(t,n,.5),scale:[e,1,1],rotation:[0,0,f]};u.push(s)}return u}function P$1(t,e,s){const i=I$1(t.x,e.x,s),r=I$1(t.y,e.y,s);return new t$1.Coordinate(i,r)}function I$1(t,e,n){return t+n*(e-t)}const C={},k$2="undefined"==typeof document?null:document.createElement("canvas");class N$2 extends t__namespace.worker.Actor{constructor(t,e){super(t),this.mapId=e.getMap().id,this.t=e}loadGLTF(t){const e={url:function(t){let e=document.createElement("a");return e.href=t,t=e.href,e=null,t}(t),referrer:window&&window.location.href,fetchOptions:this.t.options.fetchOptions};return new Promise(((t,n)=>{this.send(e,null,((e,s)=>{e?n(e):t(s)}))}))}sendImageData(t,e){!function(t,e){const n=new Image;n.onload=()=>{if(!k$2)return void e(new Error("There is no canvas to draw image!"));k$2.width=n.width,k$2.height=n.height;const t=k$2.getContext("2d");t.drawImage(n,0,0,n.width,n.height);const s=t.getImageData(0,0,n.width,n.height),i={width:n.width,height:n.height,data:new Uint8Array(s.data)};e(null,i)},n.onerror=function(t){e(t)},n.src=t}(t,((n,s)=>{n||this.isActive()&&e(null,{result:s,imageUrl:t})}))}addLayer(t,e,n){this.broadcast({actorId:this.actorId,mapId:this.mapId,layerId:t,command:"addLayer",params:{options:e}},null,n)}removeLayer(t,e,n){this.broadcast({mapId:this.mapId,layerId:t,command:"removeLayer"},null,n)}}const R$2=[],L$2=[],B$2=["points","lines","line strip","line loop"];class F$2 extends(oe$4(t__namespace.renderer.OverlayLayerCanvasRenderer)){constructor(t){super(t),this.s={},this.i=[]}onAdd(){super.onAdd(),this.prepareWorker()}draw(t,e){this.prepareCanvas(),this.o(e,t)}drawOnInteracting(t,e,n){this.o(n,e)}o(e,n){let s=0;this.h(e),this.u={},this.l(e);const i=this.m(e);this.p(n);const r=e&&e.renderTarget?e.renderTarget.fbo:null;let o=0;for(const n in this.s){if("pointline"===n)continue;if(e&&e.includes){const{newShader:s,uniforms:r}=this.g(e,n);this.s[n].shader=s,t__namespace.Util.extend(i,r)}const a=this._(n),h=this.s[n].shader;h.filter=e&&e.sceneFilter||null,o+=this.renderer.render(h,i,a,r),s++}const a=this._("pointline");if(a.getMeshes().length){i.pointSize=this.layer.options.pointSize||1;const t=this.s.pointline.shader;t.filter=e&&e.sceneFilter||null,o+=this.renderer.render(t,i,a,r),s++}this.v(i,r),o&&this.layer.fire("canvasisdirty",{renderCount:o}),this.T=!0,(!e||e&&e.isFinalRender)&&(this.completeRender(),this.layer.fire("rendercomplete-debug",{count:s})),this.M=e,this.O=n}v(t,e){this.S||(this.S=new Ke$5);const n=this.layer.getGeometries(),s=[];for(let t=0;t<n.length;t++){if(!n[t].options.showDebugBoundingBox)continue;const e=n[t].A();e&&s.push(e)}s.length&&(this.S.setMeshes(s),this.renderer.render(this.s.wireframe.shader,t,this.S,e))}p(e){this.i.length=0;const n=this.layer.getGeometries();for(let s=0;s<n.length;s++){const i=n[s],r=i.getMeshes(this.P,this.regl,e),o=i.getShader();if(r.length){this.i.push(i),this.u[o]=this.u[o]||[],t__namespace.Util.pushIn(this.u[o],r);for(let t=0;t<r.length;t++)r[t].properties.bloomMesh&&this.u[o].push(r[t].properties.bloomMesh)}}}m(){const e={};this.I.outSize=[this.canvas.width,this.canvas.height],this.I.halton=[0,0];e.layerOpacity=this.canvas.gl&&this.canvas.gl.wrap?this.layer.options.opacity||0:1,t__namespace.Util.extend(e,this.I);const s=this.getMaskUniforms();return t__namespace.Util.extend(e,s),e}_(t){const e=[],n=[];if("pointline"===t){for(const t in this.u)"wireframe"!==t&&this.u[t].forEach((t=>{B$2.indexOf(t.geometry.desc.primitive)>-1&&e.push(t)}));const t=new Ke$5(e);return t.sortMeshes(this.I.cameraPosition),t}for(const e in this.u){const s=this.u[e];e===t&&s.forEach((e=>{(B$2.indexOf(e.geometry.desc.primitive)<0||"wireframe"===t)&&n.push(e)}))}const s=new Ke$5(n);return s.sortMeshes(this.I.cameraPosition),s}needToRedraw(){if(super.needToRedraw())return!0;const t=this.layer.getGeometries();for(let e=0;e<t.length;e++)if(this.i.indexOf(t[e])>-1&&(t[e].isDirty()||t[e].isAnimated()))return!0;return!1}onRemove(){this.workerConn&&(this.workerConn.removeLayer(this.layer.getId(),(t=>{if(t)throw t})),this.workerConn.remove(),delete this.workerConn),super.onRemove()}hitDetect(){return!1}createContext(){const t=this.canvas.gl&&this.canvas.gl.wrap;if(t)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.C(this.canvas,t),this.regl=a$2({gl:this.gl,optionalExtensions:["ANGLE_instanced_arrays","OES_element_index_uint","OES_standard_derivatives","OES_vertex_array_object","OES_texture_half_float","OES_texture_half_float_linear","OES_texture_float","OES_texture_float_linear","WEBGL_depth_texture","EXT_shader_texture_lod","WEBGL_compressed_texture_s3tc"]})}t&&(this.canvas.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height)),this.pickingFBO=this.canvas.pickingFBO||this.regl.framebuffer(this.canvas.width,this.canvas.height),this.P=this.regl.gltfManager=this.regl.gltfManager||this.k(),this.N(),this.R&&this.R.forEach((t=>{t.generateInstancedBuffers(this.regl)})),this.L&&this.L.forEach((t=>{t.generateBuffers(this.regl)})),this.layer.fire("contextcreate",{regl:this.regl})}getGLTFManager(){return this.P}k(){return new Bt$6(this.regl)}N(){const t=this.layer.getMap(),e=new B$6(this.regl);this.renderer=e,this.I={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,cameraPosition:t.cameraPosition,altitudeScale:1},fi$4.PBRUtils.loginIBLResOnCanvas(this.canvas,this.regl,t),this.B=new Cr$4(e,{vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform float pointSize;\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = pointSize;\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}]},this.pickingFBO,t)}prepareWorker(){this.workerConn||(this.workerConn=new N$2("@maptalks/gltf-layer",this.layer));const t=this.workerConn;if(!t.isActive())return;const e=this.layer.options||{},n=this.layer.getId();t.addLayer(n,{markerType:e.markerTypes,pointSize:e.pointSize},(t=>{if(t)throw t;this.layer&&(this.ready=!0,this.layer.fire("workerready"))}))}F(t){return this.workerConn.loadGLTF(t).then((t=>(this.setToRedraw(),this.D=!0,t))).catch((e=>{console.error(e),this.layer.fire("modelerror",{type:"modelerror",url:t,info:e})}))}l(t){const e=C;for(const n in e){if(this.s[n])continue;const s=e[n];this.U(t,s.name,s.type,s.config)}}U(e,n,s,i){this.viewport||(this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1}),i.extraCommandProps||(i.extraCommandProps={});const r={};e&&this.V(r,R$2,e);const o=t__namespace.Util.extend({},i);o.extraCommandProps=t__namespace.Util.extend({},i.extraCommandProps),o.extraCommandProps.viewport=this.viewport,o.uniforms=t__namespace.Util.extend([],i.uniforms,R$2),o.defines=t__namespace.Util.extend({},o.defines,r),s.indexOf(".")>-1?(s=s.split("."),this.s[n]={shader:new l$1[s[0]][s[1]](o),type:s}):this.s[n]={shader:new l$1[s](o),type:s}}remove(){this.q();const t=this.s;for(const e in t)t[e].shader.dispose();this.extentShader&&this.extentShader.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}resizeCanvas(t){super.resizeCanvas(t),this.pickingFBO&&this.pickingFBO.resize(this.canvas.width,this.canvas.height),this.layer.fire("resizecanvas",{size:t})}getFrameTimestamp(){return this.O}getFrameContext(){return this.M}supportRenderMode(){return!0}needRetireFrames(){return this.D}V(e,n,s){const i=s&&s.includes;if(i)for(const r in i)i[r]&&(s[r].uniformDeclares&&(n.length=0,n.push(...s[r].uniformDeclares)),s[r].defines&&t__namespace.Util.extend(e,s[r].defines))}j(e,n){const s=n&&n.includes;if(s)for(const i in s)s[i]&&n[i].renderUniforms&&t__namespace.Util.extend(e,n[i].renderUniforms)}g(e,n){const{shader:s,type:i}=this.s[n],r={},o={};this.V(r,R$2,e),this.j(o,e);const a={vert:s.vert,frag:s.frag,uniforms:s.uniforms,extraCommandProps:s.extraCommandProps};a.defines=r,a.uniforms=t__namespace.Util.extend([],a.uniforms,R$2);let h=null;return e.states.includesChanged?(h=Array.isArray(i)?new l$1[i[0]][i[1]](a):new l$1[i](a),s.dispose()):h=s,{uniforms:o,newShader:h}}G(e,n,s){if(e.viewshed){for(const t in e.viewshed.renderUniforms)s[t]=e.viewshed.renderUniforms[t];t__namespace.Util.extend(n.shaderDefines,e.viewshed.defines)}if(e.floodAnalysis){for(const t in e.floodAnalysis.renderUniforms)s[t]=e.floodAnalysis.renderUniforms[t];t__namespace.Util.extend(n.shaderDefines,e.floodAnalysis.defines)}return s}getShadowMeshes(){const e=[];if(!this.layer||!this.layer.isVisible()||!this.u)return e;const n=this.layer.getGeometries();for(let s=0;s<n.length;s++)if(n[s].isCastShadow()&&n[s].isVisible()&&n[s].X()){t__namespace.Util.pushIn(e,n[s].H||[])}return e}J(){const e=[];if(!this.u||!Object.keys(this.u).length)return e;for(const n in this.u)t__namespace.Util.pushIn(e,this.u[n]);return e}getAnalysisMeshes(){return this.J()}getRayCastData(t){const e=this.layer.getGeometries();for(let n=0;n<e.length;n++){const s=e[n].H;if(s&&s.indexOf(t)>-1)return e[n]}return null}drawOutline(t){this.extentShader||(this.extentShader=new vn$4({vert:"attribute vec3 aPosition;\n\nattribute float aOutline;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float instance;\n\n#include <get_output>\n\n\n\nvarying float vOutline;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    if (instance == 0.0) {\n\n        vOutline = 1.0;\n\n    } else {\n\n        vOutline = aOutline;\n\n    }\n\n}\n\n",frag:"precision highp float;\n\nvarying float vOutline;\n\nvoid main() {\n\n    gl_FragColor = vec4(vOutline);\n\n}\n\n",positionAttribute:"POSITION",extraCommandProps:{viewport:this.viewport,cull:{enable:!1},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}}));const e=this.getOutlineMeshes();e.length&&(this.W=this.W||new Ke$5,this.W.setMeshes(e),this.renderer.render(this.extentShader,{projViewMatrix:this.I.projViewMatrix},this.W,t))}getOutlineMeshes(){const e=[];if(!this.layer)return e;const n=this.layer.getGeometries();for(let s=0;s<n.length;s++){const i=n[s].Y();t__namespace.Util.pushIn(e,i)}return e}q(){this.canvas&&fi$4.PBRUtils.logoutIBLResOnCanvas(this.canvas,this.getMap())}h(e){const n=this.layer.getMap(),{iblTexes:s,dfgLUT:i}=fi$4.PBRUtils.getIBLResOnCanvas(this.canvas);if(n&&n.getLights()){const r=fi$4.PBRUtils.getPBRUniforms(n,s,i,e&&e.ssr,e&&e.jitter),o=n.getLights();this.I.ambientColor=o.ambient&&o.ambient.color?o.ambient.color:[.2,.2,.2],r&&t__namespace.Util.extend(this.I,r)}else{const s=fi$4.PBRUtils.getPBRUniforms(n,null,i,e&&e.ssr,e&&e.jitter);t__namespace.Util.extend(this.I,s)}}C(t,e){const n=["webgl","experimental-webgl"];let s=null;for(let i=0;i<n.length;++i){try{s=t.getContext(n[i],e)}catch(t){}if(s)break}return s}Z(e,n,s={}){if(!this.B||!this.layer.isVisible())return null;const i=this.layer.getMap();if(this.T||this.canvas.gl&&this.canvas.gl.wrap){if(!this.u||!Object.keys(this.u).length)return null;const e=this.J(),n=t__namespace.Util.extend({},this.I);n.pointSize=this.layer.options.pointSize||1,this.B.render(e,n,!0),this.T=!1}const a=this.B[s.returnAll?"pickAll":"pick"](e,n,s.tolerance||3,{projViewMatrix:i.projViewMatrix,pointSize:this.layer.options.pointSize||1},{viewMatrix:i.viewMatrix,projMatrix:i.projMatrix,returnPoint:!0});if(a.length){const t={},e=[];for(let n=0;n<a.length;n++)if(!t[a[n].pickingId]){const s=this.K(a[n]);t[a[n].pickingId]=!0,e.push(s)}return e}return this.K(a)}K(t){const{meshId:e,pickingId:n,point:s,coordinate:i}=t,r=this.J()[e],o=this.$(n);return{meshId:e,mesh:r,data:this.layer.tt()[o],pickingId:n,point:s,coordinate:i,index:n-o,nodeIndex:this.et(e)}}et(t){const e=this.J()[t];return e&&e.properties.nodeIndex}$(t){if(!O$2(t))return null;if(this.layer.tt()[t])return t;const e=Object.keys(this.layer.tt()),n=e.length;let s=0,i=n-1,r=Math.floor((s+i)/2);for(;s<=n-1&&i>=0;){if(s===i)return e[s];if(e[r]<=t&&t<e[r+1])return e[r];t<e[r]?(i=r-1,r=Math.floor((s+i)/2)):e[r+1]<t&&(s=r+1,r=Math.floor((s+i)/2))}return null}isInFrustum(t){const e=this.layer.getMap(),n=t.getBoundingBox();if(!n||"multigltfmarker"===t.getGLTFMarkerType())return!0;const s=set(L$2,n.min,n.max);return!!intersectsBox(e.projViewMatrix,s)}getRenderMeshesTest(){return this.J()}isMarkerTransparent(t){return t.nt()}getMarkerFitSizeScale(t){return t.st()}getMarkerFitTranslate(t){return t.it()}getFBORayPicking(){return this.B}getShaderList(){return this.s}}const D$2=[],U$2=[],V$2=[],q$2=[],j$2=[1,1,1],G$2=[],X$2=[],H$2=[1,1,1],z$2=new X$7,J$2=function(t,e){const n=[];return n[0]=t[0],n[1]=t[1],n[2]=t[2],n[3]=0,n[4]=t[3],n[5]=t[4],n[6]=t[5],n[7]=0,n[8]=t[6],n[9]=t[7],n[10]=t[8],n[11]=0,n[12]=e[0],n[13]=e[1],n[14]=e[2],n[15]=1,n}(function(t){const e=Math.cos(t),n=Math.sin(t),s=[];return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=e,s[5]=n,s[6]=0,s[7]=-n,s[8]=e,s}(.5*Math.PI),[0,0,0]),W$2=new t$1.Point(0,0),Y$2=[186/255,186/255,186/255,1],Z$2={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},K$2=new Set(["url","translationX","translationY","translationZ","rotationX","rotationY","rotationZ","scaleX","scaleY","scaleZ","anchorZ","markerPixelHeight","modelHeight"]),$$2=[1,1,1,1,-1,1,-1,-1,1,-1,1,1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1],Q$2=[0,1,1,2,2,3,3,0,0,4,1,5,2,6,3,7,4,5,5,6,6,7,7,4],tt$1=[.8,.8,.1,1];class et$1 extends t$1.Marker{constructor(t,n){const s=t$1.Util.extend({},n),i=s.symbol;super(t,s),this.options.symbol=i,this.rt=!1,this.ot=identity$2([]),this.ht="gltfmarker",this.ct=!0,this.ut=!0,this.lt={get translation(){return[0,0,0]},get rotation(){return[0,0,0]},get scale(){return[1,1,1]}},this.ft()}static parseJSONData(t){const e=et$1.fromJSON(t);return e.setZoomOnAdded(t.zoomOnAdded),e}static fromJSON(t){return new et$1(t.coordinates,t.options)}static getGLTFAnchorsAlongLineString(t,n,s,i){const r=[];for(let o=0;o<t.length-1;o++){const a=E$2(t[o],t[o+1],{map:s,bboxWidth:n,gapLength:i.gapLength||0,count:i.count,rotateAlongLine:i.rotateAlongLine,snapToEndVertexes:i.snapToEndVertexes,scaleEndModel:i.scaleEndModel});t$1.Util.pushIn(r,a)}return r}static combineGLTFBoundingBox(t){const e=[];for(let n=0;n<t.length;n++){const s=t[n].getBoundingBox();e.push([s.min,s.max])}const n=e[0];if(!n)return null;const s=copy$4([],n[0]),i=copy$4([],n[1]);for(let t=1;t<e.length;t++){const n=e[t],r=copy$4([],n[0]),o=copy$4([],n[1]);r[0]<s[0]&&(s[0]=r[0]),r[1]<s[1]&&(s[1]=r[1]),r[2]<s[2]&&(s[2]=r[2]),o[0]>i[0]&&(i[0]=o[0]),o[1]>i[1]&&(i[1]=o[1]),o[2]>i[2]&&(i[2]=o[2])}return{min:s,max:i}}setTransformOrigin(t){this.dt=t}getTransformOrigin(){return this.dt||this.getCenter()}getMeshes(t,e,n){let s=[];const i=this.getMap();if(e&&(this.regl=e),this.getLayer().isVisible()&&this.isVisible()&&this.X()){if(!this.H)return this.pt(t,e),s;let r=this.isAnimated()||this.gt()&&i.isZooming()||this.ut||"multigltfmarker"===this.getGLTFMarkerType()&&this.ct;if(!r){const t=this.ot;copy$5(G$2,t),this.ft(),r=!exactEquals$5(t,G$2)}r&&this.yt(this.H,n),s=this.H.filter((t=>!!(intersectsBox(i.projViewMatrix,t.getBoundingBox())||t instanceof Ge$5)&&(this.bt(t),this.xt(t),!0))),this.ct=!1}return s}getGLTFJSON(){return this._t}getAllMeshes(){return this.H}wt(){return this._t}vt(t){this._t=t}Tt(t,e){this._externSymbol=this._externSymbol||{},this._externSymbol[t]=e,"uniforms"===t&&(this.Mt=!0)}setUrl(t){return this.updateSymbol({url:t}),this}setSymbol(t){const e=this.getUrl();super.setSymbol(t);const n=this.getShader(),s=this.P;s&&t.url!==e&&(s.logoutGLTF(e),this.Ot=!1,this.St(!1),delete this.H),this.At&&this.At!==n&&this.Et(s,this.regl),this.At=n,this.Mt=!0,this.ct=!0}getCenter(){const t=this.getMap();if(!t)return null;const e=S$2(t,super.getCenter()||this.getCoordinates());if(!e)return null;const n=this.Pt(),s=new t$1.Point([e[0]+n[0],e[1]+n[1],e[2]+n[2]]),r=t.getGLRes(),o=t.pointAtResToCoord(s,r);return o.z=s.z/t.altitudeToPoint(100,r)*100,o}getPointZ(){const t=this.getCoordinates(),e=this.getMap();return e&&t?e.altitudeToPoint(t.z||0,e.getGLRes()):null}getUrl(){const t=this._getInternalSymbol();return t&&t.url||"pyramid"}addTo(t){if(this.getLayer())throw new Error("GLTFMarker cannot be added to two or more layers at the same time.");return t.addGeometry(this),this}pt(t,e){const n=this.getUrl();if(this.P=t,!this.Ot){if(!this.It){const t=this.getLayer().getRenderer();this.It=t.F.bind(t)}t.loginGLTF(n,this.It),this.Ot=!0}const s=t.getGLTF(n);s&&!s.then&&(this.St(!0),this.Ct(s,t,e))}bt(t,e){"effectmarker"===this.getGLTFMarkerType()?this.updateUV(e):"glowmarker"===this.getGLTFMarkerType()&&this.kt();const n=this.getUniforms();if(n&&this.isDirty()&&this.Nt())for(const e in n)t.setUniform(e,n[e]);this.nt()&&(t.transparent=!0),t.bloom=t.bloom||+!!this.isBloom(),t.setUniform("uPickingId",this.Rt()),t.properties.isAnimated=this.isAnimated()}xt(t){const e=this.getShader(),n=t.getDefines();let s=!1;if("pbr"===e||"pbr-lite"===e){const t=this.getLayer(),{iblTexes:e}=fi$4.PBRUtils.getIBLResOnCanvas(t.getRenderer().canvas);e?n.HAS_IBL_LIGHTING||(n.HAS_IBL_LIGHTING=1,s=!0):n.HAS_IBL_LIGHTING&&(s=!0,delete n.HAS_IBL_LIGHTING)}s&&t.setDefines(n);const i=this.getLayer().getRenderer();i&&i.updateMaskDefines(t)}Et(t){const e=this.getUrl(),n=this.H;t&&n&&(t.isSimpleModel(e)?this.Lt(n):t.getGLTF(e)&&(n.forEach((t=>{this.bt(t)})),this.Lt(n)))}Lt(t){const e=this.getShader();t.forEach((t=>{const n=this.Bt(t.properties.geometryResource);"wireframe"===e?(t.properties.geometryResource&&!t.properties.geometryResource.copyGeometry&&t.properties.geometryResource.copyEdgeGeometry(),t.geometry=t.properties.geometryResource.copyGeometry):t.geometry=t.properties.geometryResource.geometry,t.material=n}))}yt(t,e){set$4(j$2,1,1,1);const n=identity$2(G$2),s=this.isAnimated();this.ft();const i=this.getModelMatrix(),{nodeMatrixMap:r,skinMap:o}=this.Ft(e);this.Dt(j$2);let a=0;t.forEach((t=>{const e=t.properties.geometryResource.nodeIndex,h=r[e],c=s&&h?h:t.nodeMatrix;scale$5(n,i,j$2),multiply$5(n,n,J$2),t instanceof Ge$5?(t.positionMatrix=multiply$5(t.positionMatrix,n,c),t.localTransform=this.Ut(),this.Vt(t)):t.localTransform=multiply$5(t.localTransform,n,c);const u=t.geometry.boundingBox.copy(z$2);u.transform(t.positionMatrix,t.localTransform);const f=this.qt(u);if(Math.abs(f)>Math.abs(a)&&(a=f),s){const n=o[e];n&&(t.material.set("skinAnimation",1),t.material.set("jointTextureSize",n.jointTextureSize),t.material.set("numJoints",n.numJoints),t.material.set("jointTexture",n.jointTexture));const s=t.geometry.properties.morphWeights;s&&this.jt(s,t.material)}else t.material.set("skinAnimation",0)}));const h=this.A();if(h&&(scale$5(n,i,j$2),multiply$5(n,n,J$2),this.Gt.localTransform=multiply$5(this.Gt.localTransform,n,this.Gt.Xt)),0!==a){set$4(X$2,0,0,a);const e=fromTranslation$1(G$2,X$2);t.forEach((t=>{if(t instanceof Ge$5)t.positionMatrix=multiply$5(t.positionMatrix,e,t.positionMatrix),this.Vt(t);else{const n=multiply$5(t.localTransform,e,t.localTransform);t.localTransform=n}})),h&&(this.Gt.localTransform=multiply$5(this.Gt.localTransform,e,this.Gt.localTransform))}t.forEach((t=>{t instanceof Ge$5&&this.Vt(t)})),this.fire("updatematrix",{target:this})}getBoundingBoxCenter(){const t=this.Ht,e=this.getMap();if(!t||!this.Gt||!e)return null;const n=e.getGLRes(),{min:s,max:r}=t,o=add$4([],s,r);scale$4(o,o,.5),transformMat4$2(o,o,this.Gt.localTransform);const a=new t$1.Point(o),h=e.pointAtResToCoordinate(a,n);return h.z=100/e.altitudeToPoint(100,n)*o[2],h}getBoundingBoxWidth(t){const e=this.Ht;if(!e)return 0;const n=t||0,{min:s,max:i}=e,r=this.zt()[n];return(i[n]-s[n])*r}getAxisXWidth(){return this.getBoundingBoxWidth(0)}getAxisYWidth(){return this.getBoundingBoxWidth(1)}Dt(t){const e=this.getMap(),n=e.getGLRes(),s=e.altitudeToPoint(100,n);return t[0]*=s/100,t[1]*=s/100,t[2]*=s/100,t}Jt(t){const e=this.getSymbol().modelHeight,n=this.Ht,s=e/Math.abs(n.max[1]-n.min[1]);return set$4(t,s,s,s)}Wt(t){const e=this.Ht,n=this.getSymbol().markerPixelHeight;if(!n||n<0||!e)return t;const s=this.getMap(),i=Math.abs(e.max[1]-e.min[1]),r=s.altitudeToPoint(i,s.getGLRes()),o=n*s.getGLScale()/r;return set$4(t,o,o,o)}getCurrentPixelHeight(){const t=this.getBoundingBox();return Math.abs(t.max[2]-t.min[2])/this.getMap().getGLScale()}getFitTranslate(t){const e=this.Ht,n=set$4(t,(e.min[0]+e.max[0])/2,(e.min[1]+e.max[1])/2,(e.min[2]+e.max[2])/2);return scale$4(n,n,-1)}qt(t){const e=this.getSymbol(),n=e&&e.anchorZ||"center";let s=0;const i=t.max[2]-t.min[2];return"bottom"===n?s=i/2:"top"===n&&(s=-i/2),s}Ft(t){const e=this.isAnimated(),n=this.Yt(),s={},i=this.Zt();if(t&&e&&this.gltfPack&&n){const e=this.Kt();if(O$2(e)){this.$t(t);const n=this.Qt(),r=this.isAnimationLooped(),o=this.getAnimationSpeed(),a=this.getSymbol(),h=a&&a.animationNodes;for(let a=0;a<e.length;a++)this.gltfPack.updateAnimation(t,r,o,e[a],n,s,i,h)}else console.warn("animation specified does not exist!")}return{nodeMatrixMap:s,skinMap:i}}Ct(t,e,n){const s=this.getUrl();this.vt(t.json),this.te(s,e,n),this.Et(e,n),this.fire("load",{data:t.json}),this.fire("setUrl-debug"),this._fireEvent("meshcreate",{url:s})}te(t,e,n){const s=[],i=this.getShader(),r=e.getGLTF(t);if(r&&r.resources){if(!r.resources.length)return void this._fireEvent("modelerror",{url:t,info:"there are no geomtries in the gltf model"});this.gltfPack=r.gltfPack,r.resources.forEach((t=>{const e=this.ee(t,i,n);s.push(e)}))}this.H=s,this.Ht=this.ne(),this.se(this.H),this.fire("createscene-debug",{meshes:this.H})}se(t){this.yt(t);const e=this.getBoundingBox();if(!e)return;const n=this.getMap(),{max:s,min:i}=e;length$4([s[0]-i[0],s[1]-i[1],s[2]-i[2]])/n.getGLScale()<20&&(console.warn("Model's size on screen is too small, try to increase its symbol.scaleX/Y/Z"),this.fire("smallonscreen"))}A(){if(this.Gt)return this.Gt.material.set("lineColor",this.ie||tt$1),this.Gt.material.set("lineOpacity",this.re||1),this.Gt;const t=this.Ht;if(!t)return null;const{min:e,max:n}=t;$$2[0]=n[0],$$2[1]=e[1],$$2[2]=n[2],$$2[3]=n[0],$$2[4]=n[1],$$2[5]=n[2],$$2[6]=e[0],$$2[7]=n[1],$$2[8]=n[2],$$2[9]=e[0],$$2[10]=e[1],$$2[11]=n[2],$$2[12]=n[0],$$2[13]=e[1],$$2[14]=e[2],$$2[15]=n[0],$$2[16]=n[1],$$2[17]=e[2],$$2[18]=e[0],$$2[19]=n[1],$$2[20]=e[2],$$2[21]=e[0],$$2[22]=e[1],$$2[23]=e[2];const s=new Q$7({POSITION:$$2},Q$2,0,{primitive:"lines",positionAttribute:"POSITION"});s.generateBuffers(this.regl);const i=new Be$5(s,new Ce$5({lineColor:this.ie||tt$1,lineOpacity:this.re||1}));return this.Gt=i,this.Gt.Xt=copy$5([],i.localTransform),i}showBoundingBox(t){this.options.showDebugBoundingBox=!0,this.ie=t&&t.lineColor,this.re=t&&t.lineOpacity,this.ct=!0}hideBoundingBox(){this.options.showDebugBoundingBox=!1,this.ct=!0}getBoundingBox(){const t=this.H;if(!t||!t.length)return null;if(!this.ut)return this.oe;"multigltfmarker"===this.getGLTFMarkerType()&&t.forEach((t=>{this.Vt(t),t.updateBoundingBox()}));const e=t[0].getBoundingBox(),n=copy$4([],e[0]),s=copy$4([],e[1]);for(let e=1;e<t.length;e++){const i=t[e].getBoundingBox(),r=copy$4([],i[0]),o=copy$4([],i[1]);r[0]<n[0]&&(n[0]=r[0]),r[1]<n[1]&&(n[1]=r[1]),r[2]<n[2]&&(n[2]=r[2]),o[0]>s[0]&&(s[0]=o[0]),o[1]>s[1]&&(s[1]=o[1]),o[2]>s[2]&&(s[2]=o[2])}const i={min:n,max:s};return this.oe=i,this.ut=!1,i}ne(){return this.gltfPack.getGLTFBBox()}ee(t,e,n){const s=t,i=this.ae(s,e,n),r=i.getDefines();return i instanceof Ge$5?(r.HAS_PICKING_ID=1,r.HAS_INSTANCE_COLOR=1):r.HAS_PICKING_ID=2,i.geometry.data.COLOR_0&&(r.HAS_COLOR0=1),s.extraInfo&&"MASK"===s.extraInfo.alphaMode&&(r.HAS_ALPHAMODE=1),r.HAS_MIN_ALTITUDE=1,r.HAS_LAYER_OPACITY=1,i.setDefines(r),i}ae(t,e,n){const s=this.getGLTFMarkerType();let i=null;const r=this.Bt(t);let o=t.geometry;if("wireframe"===e&&(t.copyEdgeGeometry(),o=t.copyGeometry),n?o.generateBuffers(n):(this.L=this.L||[],this.L.push(o)),"multigltfmarker"===s){this.he();const t=this.ce(identity$2(q$2)),e=this.ue();i=new Ge$5(t.attributesData,e,o,r),i.setUniform("instance",1),n?i.generateInstancedBuffers(n):(this.R=this.R||[],this.R.push(i))}else i=new Be$5(o,r),i.setUniform("instance",0);i.nodeMatrix=copy$5([],t.nodeMatrix),i.properties.geometryResource=t,i.properties.nodeIndex=t.nodeIndex,this.isBloom()&&(i.bloom=1),i.transparent=this.nt();const a=t.extraInfo;"BLEND"!==a.alphaMode&&"MASK"!==a.alphaMode||(i.transparent=!0),i.properties.pickingId=this.Rt(),this.le(i);const h=this.getLayer();return Object.defineProperty(i.uniforms,"minAltitude",{enumerable:!0,get:()=>h.options.altitude||0}),i}Bt(t){let e=null;const n=this.getShader(),s=this.getUniforms()||{},i=t.materialInfo||{},r=this.getLayer().getRenderer();if("phong"===n)if("pbrSpecularGlossiness"===i.name)e=new Le$5(i);else{for(const t in Z$2)s[t]=s[t]||Z$2[t];e=new Ie$5(i)}else if("pbr"===n){if(e="pbrSpecularGlossiness"===i.name?new fi$4.StandardSpecularGlossinessMaterial(i):new fi$4.StandardMaterial(i),r.regl&&!fi$4.PBRUtils.isSupported(r.regl)){e=Ie$5.convertFrom(e);for(const t in Z$2)s[t]=s[t]||Z$2[t]}}else e="pbr-lite"===n?new Ne$5(i):new Ce$5(i);const o=this.getSymbol();e.doubleSided=+!!(o&&o.doubleSided||t.extraInfo&&t.extraInfo.doubleSided);for(const t in s)e.set(t,s[t]);return t.morphWeights&&this.jt(t.morphWeights,e),t.skin&&e.set("skinAnimation",0),e}jt(t,e){const n=e.get("morphWeights1")||[],s=e.get("morphWeights2")||[];for(let e=0;e<4;e++)n[e]=t[e]||0,s[e]=t[e+4]||0;e.set("morphWeights1",n),e.set("morphWeights2",s)}le(t){const e=this.getSymbol();e&&e.uniforms?(t.setUniform("polygonFill",e.uniforms.polygonFill||Y$2),t.setUniform("polygonOpacity",void 0===e.uniforms.polygonOpacity?1:e.uniforms.polygonOpacity),t.setUniform("lineColor",e.uniforms.lineColor||Y$2),t.setUniform("lineOpacity",void 0===e.uniforms.lineOpacity?1:e.uniforms.lineOpacity)):(t.setUniform("polygonFill",Y$2),t.setUniform("polygonOpacity",1),t.setUniform("lineColor",Y$2),t.setUniform("lineOpacity",1))}fe(){const t=this.getLayer();if(!t)return null;const e=t.getMap();if(!e)return null;const n=this.getBoundingBox();if(!n)return null;const s=this.getPointZ()||0,i=n.min,r=n.max,a=set$3(U$2,(i[0]+r[0])/2,(i[1]+r[1])/2,i[2]+s,1),h=set$3(V$2,(i[0]+r[0])/2,(i[1]+r[1])/2,r[2]+s,1),c=transformMat4$1(a,a,e.projViewMatrix),u=transformMat4$1(h,h,e.projViewMatrix),l=(c[0]/c[3]+1)*e.width/2,f=(1-c[1]/c[3])*e.height/2,d=(u[0]/u[3]+1)*e.width/2,m=(1-u[1]/u[3])*e.height/2,p=Math.min(l,d),y=Math.max(l,d),b=Math.min(f,m),x=Math.max(f,m);return new t$1.Extent({xmin:p,ymin:b,xmax:y,ymax:x})}onAdd(){const t=this.getLayer().getMap();if(t&&!O$2(this.de)){const e=t.getZoom();this.de=e}delete this.It}onRemove(){this.me()}remove(){const t=this.getUrl();if(this.P&&(delete this.H,this.P.logoutGLTF(t),delete this.P),this.pe){for(const t in this.pe)this.pe[t]&&this.pe[t].jointTexture&&this.pe[t].jointTexture.destroy();delete this.pe}this.Gt&&(this.Gt.geometry.dispose(),this.Gt.dispose(),delete this.Gt),this.H&&this.H.forEach((t=>{t.dispose(),t.properties.bloomMesh&&(t.properties.bloomMesh.dispose(),delete t.properties.bloomMesh)})),this.Ot=!1,delete this._t,delete this.gltfPack,super.remove()}show(){return super.updateSymbol({visible:!0}),this}hide(){super.updateSymbol({visible:!1})}setBloom(t){return super.updateSymbol({bloom:t}),this}isBloom(){const t=this._getInternalSymbol();return t&&t.bloom}setCastShadow(t){return super.updateSymbol({shadow:t}),this}isCastShadow(){const t=this._getInternalSymbol();return t&&t.shadow}outlineNodes(t){const e=this.H;return e?(e.forEach((e=>{t.indexOf(e.properties.nodeIndex)>-1&&(e.properties.outline=!0)})),this.ct=!0,this):this}outline(){const t=this.H;return t?(t.forEach((t=>{t.properties.outline=!0})),this.ct=!0,this):this}cancelOutline(t){const e=this.H;return e?(e.forEach((e=>{t?t.indexOf(e.properties.nodeIndex)>-1&&(e.properties.outline=!1):e.properties.outline=!1})),this.ct=!0,this):this}isVisible(){const t=this._getInternalSymbol();return!t||!O$2(t.visible)||t.visible}setCoordinates(t){return super.setCoordinates(t),this.ct=!0,this.ut=!0,this}copy(){const t=this.toJSON(),e=et$1.fromJSON(t);return e.setZoomOnAdded(this.de),e}setShader(t){return super.updateSymbol({shader:t}),this}getShader(){const t=this._getInternalSymbol();return t&&t.shader||"pbr"}setUniforms(t){return super.updateSymbol({uniforms:t}),this.Mt=!0,this}getUniforms(){const t=this._getInternalSymbol();return t&&t.uniforms}setUniform(t,e){const n=this.getUniforms()||{};return n[t]=e,super.updateSymbol({uniforms:n}),this.Mt=!0,this}getUniform(t){const e=this._getInternalSymbol();return e&&e.uniforms&&e.uniforms[t]}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation&&this._t&&this._t.animations}isDashAnimated(){const t=this._getInternalSymbol();return t&&t.uniforms&&t.uniforms.dashEnabled&&t.uniforms.dashAnimate}setAnimation(t){return super.updateSymbol({animation:t}),delete this.ge,this}setAnimationLoop(t){return super.updateSymbol({loop:t}),delete this.ge,this.ct=!0,this}isAnimationLooped(){const t=this._getInternalSymbol();return t&&t.loop}getAnimationSpeed(){const t=this._getInternalSymbol();return t&&O$2(t.speed)?t.speed:1}setAnimationSpeed(t){return super.updateSymbol({speed:t}),this}ye(t){const e=this.getMap();return e?S$2(e,t||this.getCoordinates()):null}setTRS(t,e,n){const s=t||this.lt.translation;return this.updateSymbol({translationX:s[0],translationY:s[1],translationZ:s[2],rotationX:e[0],rotationY:e[1],rotationZ:e[2],scaleX:n[0],scaleY:n[1],scaleZ:n[2]}),this}be(){const t=this.Pt(),e=this.ye();return e?add$4(t,t,e):t}updateSymbol(t){for(const e in t)if(K$2.has(e)){this.ut=!0;break}return super.updateSymbol(t)}setTranslation(t,e,n){return this.updateSymbol({translationX:t,translationY:e,translationZ:n}),this}setRotation(t,e,n){return this.updateSymbol({rotationX:t,rotationY:e,rotationZ:n}),this}rotateAround(t,e){const n=this.getMap();if(!n)return;const s=n.getGLRes();let i=this.getCoordinates();const r=n.coordinateToPointAtRes(i,s),o=n.coordinateToPointAtRes(t,s),a=r.x-o.x,h=r.y-o.y,c=180*Math.atan2(h,a)/Math.PI+e,u=Math.sqrt(a*a+h*h),l=Math.PI*c/180,f=u*Math.cos(l)+o.x,d=u*Math.sin(l)+o.y;W$2.set(f,d),i=n.pointAtResToCoordinate(W$2,s),this.setCoordinates(i),this.updateSymbol({rotationZ:c})}setScale(t,e,n){return this.updateSymbol({scaleX:t,scaleY:e,scaleZ:n}),this}getTranslation(){const t=this._getInternalSymbol();return set$4(this.lt.translation,t&&t.translationX||0,t&&t.translationY||0,t&&t.translationZ||0)}Pt(){const t=this.getTranslation();return this.getMap()?this.xe(t):this.lt.translation}xe(t){const e=this.getMap(),n=e.distanceToPointAtRes(t[0],t[1],e.getGLRes()),s=e.altitudeToPoint(t[2],e.getGLRes());return set$4([],A(n.x,t[0]),A(n.y,t[1]),A(s,t[2]))}getRotation(){const t=this._getInternalSymbol();return set$4(this.lt.rotation,t&&t.rotationX||0,t&&t.rotationY||0,t&&t.rotationZ||0)}getScale(){const t=this._getInternalSymbol();return set$4(this.lt.scale,t&&t.scaleX||1,t&&t.scaleY||1,t&&t.scaleZ||1)}zt(){const t=this.getScale();if(this.Ht){const e=this.gt(),n=this.getModelHeight();if(e&&e>0){const e=this.Wt(H$2);return multiply$4(e,e,t)}if(n){const e=this.Jt(H$2);return multiply$4(e,e,t)}}return t}cancelMarkerPixelHeight(){return this.updateSymbol({markerPixelHeight:null})}setAnchorZ(t){return this.updateSymbol({anchorZ:t}),this}getAnchorZ(){const t=this._getInternalSymbol();return t&&t.anchorZ||"bottom"}_setExternSymbol(t){return this.ct=!0,super._setExternSymbol(t)}_e(t){return loadFunctionTypes(t,(()=>{const t=this.getMap();return t?[t.getZoom()]:null}))}_prepareSymbol(t){super._prepareSymbol(t);const e=this._e(t);return e&&e.uniforms&&(e.uniforms=this._e(t.uniforms)),delete this.we,e}hasFunctionDefinition(){if(O$2(this.we))return this.we;const t=this._getInternalSymbol();return this.we=hasFunctionDefinition(t)||t&&t.uniforms&&hasFunctionDefinition(t.uniforms),this.we}setModelMatrix(t){const e=getTranslation$1(this.lt.translation,t),n=getRotation(this.lt.rotation,t),s=getScaling(this.lt.scale,t);return this.setTranslation(e[0],e[1],e[2]),this.setRotation(n[0],n[1],n[2]),this.setScale(s[0],s[1],s[2]),this}getModelMatrix(){return this.ot}ft(){const t=this.be(),e=this.getRotation(),n=fromEuler(D$2,e[0],e[1],e[2]),s=this.zt();this.ot=fromRotationTranslationScale(this.ot,n,t,s)}isDirty(){return this.ct}ve(t){return this.ct=t,this}Te(){const t=this.toJSON();return t.zoomOnAdded=this.de,t}toJSON(){const t=JSON.parse(JSON.stringify({coordinates:this.getCoordinates(),options:this.options||{}})),n=this.getId();t$1.Util.isNil(n)||(t.options.id=n);const s=this.getProperties();s&&(t.options.properties=JSON.parse(JSON.stringify(s)));const i=this.getSymbol();return i&&(t.options.symbol=JSON.parse(JSON.stringify(i))),t}setZoomOnAdded(t){this.de=t}getZoomOnAdded(){return this.de}nt(){return this.X()<1}X(){const t=this.getUniforms(),e=this.getShader();return"pbr"===e||"phong"===e?t&&O$2(t.polygonOpacity)?t.polygonOpacity:1:"wireframe"===e&&t&&O$2(t.lineOpacity)?t.lineOpacity:1}St(t){this.rt=t}isLoaded(){return this.rt}getGLTFMarkerType(){return this.ht}Me(t){this.Oe=t}Rt(){return this.Oe}getCount(){return 1}getContainerExtent(){return this.fe()}getGLTFAsset(){return this._t&&this._t.asset}openInfoWindow(t){this._t?super.openInfoWindow(t):this.once("load",(()=>{super.openInfoWindow(t)}))}getAnimations(){if(!this._t)return null;const t=this._t,e=t.animations?t.animations.map(((t,e)=>({name:O$2(t.name)?t.name:e}))):null;return e?e.map(((t,e)=>t.name||e)):null}getCurrentAnimation(){const t=this._getInternalSymbol();return t&&t.animationName}Kt(){const t=this.getAnimations();if(!t)return null;let e=this.getCurrentAnimation();if(!O$2(e))return t.slice(0,1);const n=[];e=Array.isArray(e)?e:[e];for(let s=0;s<e.length;s++)t.indexOf(e[s])>-1&&n.push(e[s]);return n.length?n:null}setCurrentAnimation(t){this.updateSymbol({animationName:t})}$t(t){O$2(this.ge)||(this.ge=t)}Qt(){return this.ge||0}Zt(){return this.pe=this.pe||{},this.pe}gt(){const t=this._getInternalSymbol();return t&&t.markerPixelHeight}setModelHeight(t){return this.updateSymbol({modelHeight:t}),this}getModelHeight(){const t=this._getInternalSymbol();return t&&t.modelHeight}getGLTFBBox(){return this.Ht}zoomTo(t,e={animation:!1}){const n=this.getBoundingBox(),s=this.getMap();if(!s||!n)return;const{min:i,max:r}=n;W$2.set(i[0],i[1]);const a=s.pointAtResToCoordinate(W$2,s.getGLRes());W$2.set(r[0],r[1]);const h=s.pointAtResToCoordinate(W$2,s.getGLRes()),c=new t$1.Extent(a,h);s.fitExtent(c,t,e,(t=>{"finished"===t.state.playState&&this.Se(i,r,c)})),!1===e.animation&&this.Se(i,r,c)}Se(t,e,n){const s=this.getMap(),r=s.getGLRes(),o=(t[2]+e[2])/2/s.altitudeToPoint(1,r),a=s.cameraPosition,h=s.pointAtResToCoordinate(new t$1.Point(a),r),c=a[2]/s.altitudeToPoint(1,r);h.z=c+o,s.setCameraPosition({position:[h.x,h.y,h.z],pitch:s.getPitch(),bearing:s.getBearing()}),this.fire("zoomtoend",{target:this,extent:n})}Nt(){return this.Mt}Ae(){this.Mt=!1}setAnimationTimeframe(t){const e=this.Qt(),n=this.Zt();this.gltfPack.updateAnimation(t,this.isAnimationLooped(),this.getAnimationSpeed(),e,{},n)}me(){delete this.oe,delete this.de}Yt(){return"effectmarker"!==this.getGLTFMarkerType()&&"glowmarker"!==this.getGLTFMarkerType()}_onEvent(t,e){const n=this.getLayer();if(!n)return;const s=n.getId();this.Ee=t.gltfPickingInfo&&t.gltfPickingInfo[s]||{},super._onEvent(t,e)}_fireEvent(t,e){for(const t in this.Ee)e[t]=this.Ee[t];delete this.Ee,super._fireEvent(t,e)}Y(){let t=[];return this.H&&this.isVisible()&&this.X()?this.isOutline&&this.isOutline()?this.H:(t=this.H.filter((t=>t.properties.outline)),t):t}highlightNodes(t){const e=this.getLayer();if(!e)return;const n=e.getRenderer();if(!n)return;const s=this.H;s&&(t.forEach((t=>{s.forEach((e=>{e.properties.nodeIndex===t.nodeIndex&&this.Pe(e,t.color,t.opacity,t.bloom)}))})),n.setToRedraw())}highlight(t){const e=this.getLayer();if(!e)return;const n=e.getRenderer();if(!n)return;const{color:s,opacity:i,bloom:r}=t,o=this.H;o&&(o.forEach((t=>{this.Pe(t,s,i,r)})),n.setToRedraw())}Pe(t,e,n,s){t.properties.polygonFill||(t.properties.polygonFill=t.getUniform("polygonFill")||Y$2),t.properties.polygonOpacity||(t.properties.polygonOpacity=t.getUniform("polygonOpacity")||1),t.setUniform("polygonFill",e||Y$2),t.setUniform("polygonOpacity",n||1),t.bloom=s}Ie(){if(this.Ce)if(Array.isArray(this.Ce)){const t=this.Ce.map((t=>t.nodeIndex));this.cancelHighlight(t)}else this.cancelHighlight(this.Ce.nodeIndex)}cancelHighlight(t){const e=this.getLayer();if(!e)return;const n=e.getRenderer();if(!n)return;let s=this.H;if(s){if(t){let e=t;Array.isArray(e)||(e=[e]),s=s.filter((t=>e.indexOf(t.properties.nodeIndex)>-1))}s.forEach((t=>{const{polygonFill:e,polygonOpacity:n}=t.properties;t.setUniform("polygonFill",e),t.setUniform("polygonOpacity",n),t.bloom=!1})),n.setToRedraw()}}}et$1.mergeOptions({symbol:null}),et$1.registerJSONType("GLTFMarker");const nt$1=/\{ *([\w_]+) *\}/g;class st$1 extends et$1{constructor(t,e){super(t,e),this.ht="effectmarker"}static fromJSON(t){return new st$1(t.coordinates,t.options)}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}setTexture(t){const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const n=this.getTextureUrl();e.ke(n),e.Ne(t)}return super.updateSymbol({textureUrl:t}),this}Re(t){const e=this.getTextureUrl(),n=this.getLayer()&&this.getLayer().getRenderer();if(n){let s=e;const i=this.Le();if(i){const n=this.isAnimationLooped(),r=this.getAnimationSpeed()||1,o=n?Math.floor(.01*t*r)%i.length:Math.floor(.01*t);s=e.replace(nt$1,i[o]),this.setUniform("width",1),this.setUniform("height",1),this.setUniform("uvOffset",[0,0])}return n.Be(s,this.Rt())}return null}Le(){const t=this._getInternalSymbol();return t&&t.textureNames}getTextureUrl(){const t=this._getInternalSymbol();return t&&t.textureUrl||"default"}getUrl(){return"plane"}getShader(){return"effect"}setTransparent(t){return this.options.symbol.transparent=t,this}isTransparent(){return this.options.symbol.transparent}updateUV(t){const e=this.isAnimationLooped(),n=this.getAnimationSpeed()||1,s=this.getUniforms()||{},i=s.width||1,r=s.height||1;let o;const a=this.getEffectType();"uv"===a?o=e?.01*t*n%(i*r):.01*t:"sequence"===a&&(o=e?Math.floor(.01*t*n)%(i*r):Math.floor(.01*t));const h=Number(o%i),c=Math.floor(o/i),u=this.Re(t);this._getSymbol()?(this.setUniform("uvOffset",[h,c]),this.setUniform("width",i),this.setUniform("height",r),this.setUniform("texture",u)):this.Tt("uniforms",{uvOffset:[h,c],width:i,height:r,texture:u})}_setExternSymbol(t){super._setExternSymbol(t);const e=this.getLayer()&&this.getLayer().getRenderer();if(e){const t=this.getTextureUrl();e.Ne(t)}}getEffectType(){const t=this._getInternalSymbol();return t&&t.effect||"uv"}setEffectType(t){return this._getInternalSymbol().effect=t,this}remove(){const t=this.getLayer()&&this.getLayer().getRenderer();if(t){const e=this.getTextureUrl();t.ke(e)}super.remove()}}const it$1=["Point","Polygon","LineString","MultiPoint","MultiPolygon","MultiLineString","GeometryCollection","Feature","FeatureCollection"].reduce(((t,e)=>(t[e]=!0,t)),{}),rt$1={toGeometry:function(t,n){if(t$1.Util.isString(t)&&(t=t$1.Util.parseJSON(t)),Array.isArray(t)){const s=[];for(let i=0,r=t.length;i<r;i++){const r=rt$1.Fe(t[i],n);Array.isArray(r)?t$1.Util.pushIn(s,r):s.push(r)}return s}return rt$1.Fe(t,n)},Fe:function(t,n){if(!t||t$1.Util.isNil(t.type))return null;const s=t.type;if("Feature"===s){const s=rt$1.Fe(t.geometry,n);return s?(s.setId(t.id),s.setProperties(t.properties),s):null}if("FeatureCollection"===s){const e=t.features;return e?rt$1.toGeometry(e,n):null}if("Point"===s)return function(t,e){return"EffectLayer"===e?new st$1(t):new et$1(t)}(t.coordinates,n);if("GeometryCollection"===s){const e=t.geometries,s=[],i=e.length;for(let t=0;t<i;t++)s.push(rt$1.Fe(e[t],n));return s}throw new Error("geometry's type is invalid, only support type of Point")},isGeoJSON:function(t){return!(!t||"object"!=typeof t||!t.type||!it$1[t.type]||t instanceof t$1.Geometry)}},ot$1=/\{*(\$root)*\}/g;class at$1 extends t__namespace.OverlayLayer{constructor(e,n,s){!n||n instanceof t__namespace.Geometry||Array.isArray(n)||it$1[n.type]||(s=n,n=null),super(e,null,s),this.pickingId=0,this.De={},this.Ue={},this.Ve={};this.setStyle(s&&s.style),n&&this.addGeometry(n)}static registerShader(t,e,n,s){C[t]={name:t,type:e,config:n,uniforms:s}}static removeShader(t){delete C[t]}static getShaders(){const t=[];for(const e in C)t.push({shader:e,uniforms:C[e].uniforms});return t}static getShaderMap(){return C}addGeometry(t,e){let n=rt$1.isGeoJSON(t)?rt$1.toGeometry(t,this.getJSONType()):t;n=Array.isArray(n)?n:[n];for(let t=0;t<n.length;t++)if(!this.qe(n[t]))return void console.error("type of geometry is invalid");super.addGeometry(n,e),Array.isArray(n)&&this.addMarker(n)}addMarker(t){for(let e=0;e<t.length;e++){const n=t[e];n.Me(this.pickingId),this.De[this.pickingId]=n;const s=n.getId();if(s&&(this.Ve[s]=n),n.fire("add",{type:"add",target:n,layer:this}),"multigltfmarker"===n.getGLTFMarkerType()){const t=n.getCount()||1;this.pickingId+=t}else this.pickingId++}}je(t){const e=this.getRenderer();e&&e.loginGLTFMarker(t)}toJSON(t){t||(t={});const e={type:this.getJSONType(),id:this.getId(),options:this.config()};if((M$2(t.style)||t.style)&&(e.style=this.getStyle()),M$2(t.geometries)||t.geometries){const t=[],n=this._geoList;for(let e=0;e<n.length;e++){const s=n[e].Te();t.push(s)}e.geometries=t}return e}qe(t){return!!t.getGLTFMarkerType&&this.options.markerTypes.indexOf(t.getGLTFMarkerType())>-1}setStyle(t){return t?(this.options.style=t,this.Ge=JSON.parse(JSON.stringify(t)),this.Xe(),this.fire("setstyle",{target:this,style:this.Ge}),this):(delete this.Ge,delete this.options.style,this)}getStyle(){return this.options.style}updateSymbol(t,e){const n=this.getStyle();this.He(t,e,n),this.He(t,e,this.Ge),this.Xe(),this.fire("updatesymbol",{target:this,index:t,symbol:e})}He(t,e,n){if(!n)return;const s=(n.style?n.style:n)[t].symbol||{};for(const t in e)s[t]=e[t]}Xe(){this._processRootUrl(this.Ge);this.ze=compileStyle(this.Ge.style?this.Ge.style:this.Ge),this._geoList.forEach((function(t){this.Je(t)}),this)}getGLTFUrls(){return Object.keys(this.Ue)}_processRootUrl(e){t__namespace.Util.isString(e.$root)&&e.style.forEach((t=>{const n=t.symbol.url;n&&n.indexOf("{$root}")>-1&&(t.symbol.url=n.replace(ot$1,e.$root))}))}Je(t){if(!this.ze)return!1;for(let e=0,n=this.ze.length;e<n;e++)if(!0===this.ze[e].filter({properties:t.getProperties()})){const n=this.ze[e].symbol;return t.Tt("url",n.url),t.updateSymbol(n),!0}return!1}We(t){if(this.ze)for(let e=0,n=this.ze.length;e<n;e++)!0===this.ze[e].filter({properties:t.getProperties()})&&this.ze[e].outline&&t.outline()}Ye(e){const n=t__namespace.Util.isString(e)?this.Ve[e].Rt():e.Rt(),s=this.getRenderer();s&&s.Ze(n),delete this.De[n],delete this.Ve[e]}clear(){return super.clear(),this.De={},this.Ve={},this}tt(){return this.De}Z(t,e,n){const s=this.getRenderer();return s?s.Z(t,e,n):null}_isModelsLoadComplete(){const t=this._geoList;for(let e=0;e<t.length;e++)if(!t[e].isLoaded())return!1;return!0}fe(t){const e=this.getRenderer();return e?e.fe(t):null}Et(t){const e=this.getRenderer();e&&e.Et(t)}outlineBatch(t){const e=this.Ge.style?this.Ge.style:this.Ge;e[t].outline=!0,this.ze=compileStyle(e),this._geoList.forEach((t=>{this.We(t)}))}outlineAll(){this._geoList.forEach((t=>{t.outline()}))}cancelOutline(){this.Ge&&(this.Ge.style?this.Ge.style:this.Ge).forEach((t=>{delete t.outline})),this._geoList.forEach((t=>{t.cancelOutline()}))}}at$1.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0});class ht$1 extends(ds$4(at$1)){static initDefaultShader(){const t={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new Ie$5};ht$1.registerShader("phong","PhongShader",t.shader,t.material.getUniforms());const e={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",tangentAttribute:"TANGENT",colorAttribute:"COLOR_0",uv0Attribute:"TEXCOORD_0",uv1Attribute:"TEXCOORD_1",extraCommandProps:{cull:{enable:!0},frontFace:"ccw",blend:{enable:(t,e)=>!!e.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new fi$4.StandardMaterial({})};ht$1.registerShader("pbr","pbr.StandardShader",e.shader,e.material.getUniforms()),ht$1.registerShader("depth","pbr.StandardDepthShader",e.shader,e.material.getUniforms());const n={shader:{positionAttribute:"POSITION",color0Attribute:"COLOR_0",extraCommandProps:{blend:{enable:!1,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new Ce$5};ht$1.registerShader("pointline","PointLineShader",n.shader,n.material.getUniforms());const s={shader:{positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}},material:new Ce$5({lineColor:[0,0,0,1],lineOpacity:1})};ht$1.registerShader("wireframe","EdgeShader",s.shader,s.material.getUniforms());const i={shader:{positionAttribute:"POSITION",normalAttribute:"NORMAL",extraCommandProps:{blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},material:new Ne$5};ht$1.registerShader("pbr-lite","StandardLiteShader",i.shader,i.material.getUniforms())}static fromJSON(t){if(!t||"GLTFLayer"!==t.type)return null;const e=new ht$1(t.id,t.options),n=t.geometries,s=[];for(let t=0;t<n.length;t++){const e=et$1.parseJSONData(n[t]);e&&s.push(e)}return e.addGeometry(s),t.style&&e.setStyle(t.style),e}onAdd(){const t=this.getMap();this._geoList.forEach((e=>{O$2(e.getZoomOnAdded())||e.setZoomOnAdded(t.getZoom())})),super.onAdd()}onRemove(){super.onRemove(),this.clear()}identify(e,n){const s=this.getMap();if(!s)return[];const i=s.coordinateToContainerPoint(new t__namespace.Coordinate(e));return this.identifyAtPoint(i,n)}identifyAtPoint(e,n={}){const s=[];if(!n.excludeMasks){const i=this.identifyMask(e,n);i&&i.length&&t__namespace.Util.pushIn(s,i)}const i=this.getMap();if(!i)return[];const r=i.getDevicePixelRatio(),h=this.Z(e.x*r,e.y*r,n);if(h&&(h.data||h.length))if(n.includeInternals&&!n.excludeMasks){s.push(h.data);const t=n.domEvent;t&&(t.gltfPickingInfo=t.gltfPickingInfo||{},t.gltfPickingInfo[this.getId()]=h)}else s.push(h);return s}Ke(){this.pickingId=0;const t={};for(const e in this.De){const n=this.De[e];n.Me(this.pickingId),t[this.pickingId]=n;const s=n.getCount()||1;this.pickingId+=s}this.De=t}_onGeometryEvent(t){if(!t||!t.target)return;const e=t.type;if("meshcreate"===e)this.$e(t);else if("modelerror"===e)this.Qe(t);else if("positionchange"===e){const t=this.getRenderer();t&&t.setToRedraw()}super._onGeometryEvent(t)}Qe(t){const{url:e,info:n}=t;console.error(n),this.fire("modelerror",{type:"modelerror",url:e,info:n})}$e(t){this.Ue[t.url]=1,this.getRenderer().setToRedraw(),this._isModelsLoadComplete()&&this.fire("modelload",{models:this.getGLTFUrls()})}}ht$1.initDefaultShader(),ht$1.mergeOptions({markerTypes:["gltfmarker","multigltfmarker"],pointSize:1}),ht$1.registerJSONType("GLTFLayer"),ht$1.registerRenderer("gl",F$2);const ut$1=new t$1.Coordinate(0,0),lt$1=new t$1.Point(0,0),ft$1=new t$1.Point(0,0),dt$1=new t$1.Point(0,0);const pt$1=[1,1,1,1],gt$1=[],yt$1=[],bt$1=[1,1,1],xt$1=new t$1.Coordinate(0,0);class _t$1 extends et$1{constructor(t,e){super(null,e),this.tn=t||[],this.en=[],this.nn=[0,0,0],this.sn=identity$2([]),this.ht="multigltfmarker",this.in=[]}static fromJSON(t){return new _t$1(t.data,t.options)}setCoordinates(t){return this.rn=Array.isArray(t[0])?t.map((t=>new t$1.Coordinate(t))):t,this.updateAllData("coordinates",this.rn),this.ct=!0,this}getCoordinates(t){if(t&&this.tn&&this.tn.length){return this.tn[t.index].coordinates}return null}addData(t){this.tn||(this.tn=[]),this.tn.push(t);const e=this.getLayer();return e&&e.Ke(),this.ct=!0,this}removeData(t){this.tn.splice(t,1),this.en&&this.en.splice(t,1);const e=this.getLayer();return e&&e.Ke(),this.ct=!0,this}getData(t){return this.tn[t]}updateData(t,e,n){return this.tn[t][e]=n,this.ct=!0,this}getAllData(){return this.tn}updateAllData(t,e){for(let n=0;n<this.tn.length;n++)this.updateData(n,t,e[n]);return this}removeAllData(){this.tn&&(this.tn=[],this.en=[])}he(){const t=this.getMap();if(this.tn&&t){this.an(),this.en=this.en||[];for(let t=0;t<this.tn.length;t++){const e=this.hn(t);this.en[t]=e}}}openInfoWindow(t){let e=null;e=O$2(t)&&this.tn[t]?this.tn[t].coordinates:this.getCenter(),super.openInfoWindow(e)}getCenter(){let t=0,e=0,s=0,i=0;for(let r=0,o=this.tn.length;r<o;r++){let o=this.tn[r].coordinates;o instanceof t$1.Coordinate&&(o=o.toArray()),t+=o[0],e+=o[1],s+=o[2]||0,i++}return 0===i?null:xt$1.set(t/i,e/i,s/i)}an(){const t=this.getMap(),e=this.getCenter();if(!e)return;this.nn=S$2(t,e);const n=fromEuler(yt$1,0,0,0);fromRotationTranslationScale(this.sn,n,this.nn,bt$1)}hn(t){const e=this.tn[t],n=this.ye(e.coordinates);if(!n)return null;const s=sub$2(gt$1,n,this.nn),i=this.xe(e.translation||this.lt.translation),r=add$4(gt$1,i||this.lt.translation,s||this.lt.translation),o=e.rotation||this.lt.rotation,a=e.scale||this.lt.scale,h=fromEuler(yt$1,o[0]||0,o[1]||0,o[2]||0);return fromRotationTranslationScale(this.en[t]||[],h,r,a)}ft(){super.ft(),this.he()}cn(){this.un={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],aBloom:[]},this.ln={instance_vectorA:[],instance_vectorB:[],instance_vectorC:[],instance_color:[],aPickingId:[],aOutline:[],aBloom:[]};for(let t=0;t<this.en.length;t++){let e=this.un;this.tn[t].bloom&&(e=this.ln);const n=this.en[t],s=e.instance_vectorA.length/4;this.dn(e,"instance_vectorA",s,n,0),this.dn(e,"instance_vectorB",s,n,1),this.dn(e,"instance_vectorC",s,n,2);const i=this.tn[t].color||pt$1;e.instance_color[4*s]=i[0],e.instance_color[4*s+1]=i[1],e.instance_color[4*s+2]=i[2],e.instance_color[4*s+3]=i[3],e.aPickingId[s]=this.Rt()+t,e.aOutline[s]=this.tn[t].outline?1:0,e.aBloom[s]=this.tn[t].bloom?1:0}return{attributesData:this.un,bloomAttributesData:this.ln}}Vt(t){const{attributesData:e,bloomAttributesData:n}=this.ce();for(const n in e)t.updateInstancedData(n,e[n]);if(this.regl?t.generateInstancedBuffers(this.regl):(this.R=this.R||[],this.R.push(t)),t.instanceCount=this.un.instance_vectorA.length/4,this.mn()){const e=n,s=e.aBloom.length;t.properties.bloomMesh=t.properties.bloomMesh||new Ge$5(e,s,t.geometry,t.material);const i=t.properties.bloomMesh;i.positionMatrix=t.positionMatrix,i.localTransform=t.localTransform;for(const t in e)i.updateInstancedData(t,e[t]);i.generateInstancedBuffers(this.regl);const r=t.getDefines();i.setDefines(r),i.uniforms=t.uniforms,i.bloom=1,i.instanceCount=s}else t.properties.bloomMesh&&(t.properties.bloomMesh.dispose(),delete t.properties.bloomMesh)}pn(t,e,n,s){this.ln[t]&&n&&(this.ln[t][4*e]=n[s],this.ln[t][4*e+1]=n[s+4],this.ln[t][4*e+2]=n[s+8],this.ln[t][4*e+3]=n[s+12])}mn(){return this.ln&&this.ln.aBloom.length}dn(t,e,n,s,i){t[e]&&s&&(t[e][4*n]=s[i],t[e][4*n+1]=s[i+4],t[e][4*n+2]=s[i+8],t[e][4*n+3]=s[i+12])}ce(t){return!this.ct&&this.un?{attributesData:this.un,bloomAttributesData:this.ln}:this.cn(t)}Ut(){return this.sn}getCount(){return this.tn.length}gn(){return this.he(),this.ln?this.ln.aBloom.length:0}ue(){return this.getCount()-this.gn()}toJSON(){const t=JSON.parse(JSON.stringify({data:this.tn,options:this.options})),e=this.getProperties();return t.options&&(t.options.properties=e),t}getIndexByPickingId(t){return t-this.Rt()}outline(t){return O$2(t)&&this.updateData(t,"outline",!0),this}cancelOutline(t){return O$2(t)&&this.updateData(t,"outline",!1),this}isOutline(){if(!this.tn||!this.tn.length)return!1;for(let t=0;t<this.tn.length;t++)if(this.tn[t].outline)return!0;return!1}nt(){const t=this.getAllData();for(let e=0;e<t.length;e++){const n=t[e].color;if(n&&n[3]<1)return!0}return!1}}const wt$1=[];class vt$1 extends _t$1{constructor(t,e){super(null,e),this.on("load",(()=>{this.setCoordinates(t)}))}setCoordinates(t){this.rn=t,this.yn()}getCoordinates(){return this.rn}yn(){const t=this.rn;if(t){this.removeAllData();for(let e=0;e<t.length-1;e++){const n=this.bn(t[e]),s=this.bn(t[e+1]);this.xn(n,s).forEach((t=>{this.addData(t)}))}this.ct=!0}}xn(t,e){const n=[],s=this.getMap();if(!s)return n;const i=s.getProjection().measureLenBetween(t,e),r=this._n(t,e),o=Math.floor(i/r),a=this.wn(t,e);if(o>=1){for(let s=1;s<=o;s++){const h={coordinates:this.vn(t,e,r*(s-.5)/i),scale:[1,1,1],rotation:[0,0,a]};n.push(h)}if(this.options.scaleVertex){const h=(i-r*o)/r,c={coordinates:this.vn(t,e,(r*o+(i-r*o)/2)/i),scale:[h,1,1],rotation:[0,0,a]};n.push(c)}}else if(this.options.scaleVertex){const s=i/r,o={coordinates:this.vn(t,e,.5),scale:[s,1,1],rotation:[0,0,a]};n.push(o)}return n}vn(t,e,s){const i=Tt$1(t.x,e.x,s),r=Tt$1(t.y,e.y,s);return new t$1.Coordinate(i,r)}_n(t,e){const s=this.getMap(),i=s.getGLRes(),r=new t$1.Coordinate(0,(t.y+e.y)/2),o=s.altitudeToPoint(100,i,r)/s.altitudeToPoint(100,i),a=this.getGLTFBBox(),h=this.options.direction||0,c=[1,1,1];if(this.getModelHeight())this.Jt(c);else{const t=this.getSymbol();set$4(c,t.scaleX||1,t.scaleY||1,t.scaleZ||1)}const u=sub$2(wt$1,a.max,a.min);multiply$4(u,u,c);return u[h]/o+this.options.gapLength}wn(t,n){const s=this.getMap(),i=s.getGLRes(),r=s.coordinateToPointAtRes(t,i),o=s.coordinateToPointAtRes(n,i);return t$1.Util.computeDegree(o.x,o.y,r.x,r.y)/Math.PI*180}bn(t){return Array.isArray(t)?new t$1.Coordinate(t):t}}function Tt$1(t,e,n){return t+n*(e-t)}vt$1.mergeOptions({direction:0,gapLength:0,scaleVertex:!0}),vt$1.registerJSONType("GLTFLineString");const Mt$1=new en$5({url:void 0,mag:"linear"});class Ot$1 extends F$2{constructor(t){super(t),this._textureMap={}}Be(t){return this.regl&&this._textureMap[t]?this._textureMap[t].texture.getREGLTexture(this.regl):Mt$1}Ne(t){if(this._textureMap[t])this._textureMap[t].count++;else{this.Tn=this.Tn||new Ve$5;const n=new en$5({url:"default"===t?void 0:t,mag:"linear"},this.Tn);n.once("complete",(()=>{this.setToRedraw()}),this),this._textureMap[t]={count:1,texture:n}}}ke(t){this._textureMap[t]&&(this._textureMap[t].count--,this._textureMap[t].count<1&&(this._textureMap[t].texture.dispose(),delete this._textureMap[t]))}}class St$1 extends at$1{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new Ce$5};St$1.registerShader("effect","MeshShader",t.shader,t.material.getUniforms())}onAddGeometry(t){super.onAddGeometry(t);const e=t.getTextureUrl(),n=this.getRenderer();n?n.Ne(e):this.on("renderercreate",(t=>{t.renderer.Ne(e)}))}remove(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const n=e.getTextureUrl();t.ke(n)})),super.remove()}clear(){const t=this.getRenderer();t&&this._geoList.forEach((e=>{const n=e.getTextureUrl();t.ke(n)})),super.clear()}getTextureMapTest(){const t=this.getRenderer();return t?t._textureMap:null}}St$1.initDefaultShader(),St$1.mergeOptions({markerTypes:["effectmarker"]}),St$1.registerJSONType("EffectLayer"),St$1.registerRenderer("gl",Ot$1);class At$1 extends et$1{constructor(t,e){super(t,e),this.ht="glowmarker"}static fromJSON(t){return new At$1(t.coordinates,t.options)}getUrl(){return"plane"}setSpeed(t){this.setUniform("speed",t)}getSpeed(){return this._getInternalSymbol().uniforms.speed}getShader(){return"glowmarker"}isAnimated(){const t=this._getInternalSymbol();return t&&t.animation}kt(){let t=this._getInternalSymbol().uniforms.time||0;t+=.01,this.setUniform("time",t)}}At$1.mergeOptions({visible:!0});class Et$1 extends at$1{static initDefaultShader(){const t=function(){const t={vert:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        attribute vec3 aPosition;\n        uniform mat4 projViewModelMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 positionMatrix;\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        #include <get_output>\n        void main(){\n            mat4 localPositionMatrix = getPositionMatrix();\n            vec4 localVertex = getPosition(aPosition);\n            vec4 position = localPositionMatrix * localVertex;\n            gl_Position = projViewModelMatrix * position;\n            vec4 worldPos = modelMatrix * position;\n            v_FragPos = worldPos.xyz;\n            v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz;\n        }\n    ",frag:"\n        #ifdef GL_ES\n            precision highp float;\n        #endif\n        #define pi 3.14159\n        const float dotsnb = 30.0; // Number of dots\n\n        varying vec3 v_FragPos;\n        varying vec3 v_center;\n        uniform float time;\n        uniform float radius;\n        uniform vec3 color;\n        uniform float speed;\n        vec3 hsb2rgb(in vec3 c)\n        {\n            vec3 rgb = clamp(abs(mod(c.x*6.0+vec3(0.0,4.0,2.0),6.0)-3.0)-1.0,0.0,1.0 );\n            rgb = rgb*rgb*(4.0-2.0*rgb);\n            return c.z * mix( vec3(1.0), rgb, c.y);\n        }\n\n        void main()\n        {\n            float r = length(v_FragPos - v_center);\n            r = r*2.-1.;\n            if(r>radius) {\n                gl_FragColor = vec4(1.0,1.0,1.0, 0.0);\n            } else {\n                //vec3 color = hsb2rgb(vec3(fract(time*.1),.7,.4));\n                vec3 color = color;\n                float s = abs(sin(pow(r+5.0, 1.5)-time*speed+sin(r*0.9))*sin(r+.99));\n                color *= (abs(1./(s*10.8))-.01);\n                gl_FragColor = vec4(color, (color.x + color.y + color.z) / 1.0);\n            }\n        }\n    ",uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(t,e){return multiply$5([],e.projViewMatrix,e.modelMatrix)}}],positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one",dstAlpha:1},equation:{rgb:"add",alpha:"add"},color:[0,0,0,0]}}};return{shader:t,material:new Ce$5}}();Et$1.registerShader("glowmarker","MeshShader",t.shader,t.material.getUniforms())}}Et$1.initDefaultShader(),Et$1.mergeOptions({markerTypes:["glowmarker"]}),Et$1.registerJSONType("GlowMarkerLayer"),Et$1.registerRenderer("gl",F$2);const Pt$1={url:"plane",animation:!0,loop:!0,rotation:[0,0,0],translation:[0,0,30],scale:[1,1,30]},It$1={width:1,height:1,modelHeight:60,startOpacity:0,endOpacity:1};class kt$1 extends at$1{static initDefaultShader(){const t={shader:{vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform vec2 uvOffset;\n        uniform float width;\n        uniform float height;\n        varying vec2 vTexCoords;\n        varying float vHeight;\n        void main()\n        {\n            vec4 worldPosition = modelMatrix * vec4(aPosition, 1.0);\n            gl_Position = projViewMatrix * worldPosition;\n            vHeight = worldPosition.z;\n            vTexCoords = (uvOffset + aTexCoord) * vec2(1.0 / width, 1.0 / height);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D texture;\n        uniform float modelHeight;\n        uniform float startOpacity;\n        uniform float endOpacity;\n        varying float vHeight;\n        varying vec2 vTexCoords;\n        void main() {\n            vec4 color = texture2D(texture, vTexCoords);\n            float opacity = (endOpacity - startOpacity) * (1.0 - vHeight / modelHeight);\n            gl_FragColor = vec4(color.rgb, color.a) * color.a * opacity;\n        }\n    ",positionAttribute:"POSITION",extraCommandProps:{blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}},material:new Ce$5};kt$1.registerShader("effectline","MeshShader",t.shader)}}kt$1.initDefaultShader(),kt$1.mergeOptions({markerTypes:["effectmarker"]}),kt$1.registerJSONType("EffectLineLayer"),kt$1.registerRenderer("gl",Ot$1);const Nt$1={offsetX:0,offsetY:0,uReflectivity:.8,opacity:.9,color:[.9,0,0,1]};class Lt$1 extends at$1{static initDefaultShader(){const t=function(){const t={vert:"\n        attribute vec3 aPosition;\n        attribute vec2 aTexCoord;\n        attribute vec3 aNormal;\n        uniform mat4 projViewMatrix;\n        uniform mat4 modelMatrix;\n        uniform mat4 normalMatrix;\n        uniform float offsetX;\n        uniform float offsetY;\n        varying vec2 uv;\n        void main()\n        {\n            gl_Position = projViewMatrix * modelMatrix * vec4(aPosition, 1.0);\n            uv = vec2(aTexCoord.x + offsetX, aTexCoord.y + offsetY);\n        }\n    ",frag:"\n        precision mediump float;\n        uniform sampler2D effectTexture;\n        uniform vec3 uCameraPosition;\n        uniform mat4 viewMatrix;\n        uniform float uReflectivity;\n        uniform vec4 color;\n        uniform float opacity;\n\n        varying vec2 uv;\n\n        vec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n            return normalize((vec4(dir, 0.0) * matrix).xyz);\n        }\n\n        const float GAMMA_FACTOR = 2.0;\n        vec4 GammaToLinear(in vec4 value, in float gammaFactor) {\n            return vec4(pow(value.xyz, vec3(gammaFactor)), value.w);\n        }\n\n        vec4 mixTexelToLinear(vec4 value) {\n            return GammaToLinear(value, float(GAMMA_FACTOR));\n        }\n\n        void main() {\n            vec4 texColor = texture2D(effectTexture, uv);\n            if (color.a == 0.0) {\n                discard;\n            }\n            vec4 mixColor = mixTexelToLinear(color);\n            texColor.rgb += mixColor.xyz * uReflectivity;\n            texColor.a*= opacity;\n            gl_FragColor = texColor;\n        }\n    ",uniforms:[{name:"normalMatrix",type:"function",fn:function(t,e){const n=[];return invert$2(n,e.modelMatrix),transpose(n,n),n}}],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,mask:!1},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}};return{shader:t,material:new Ce$5}}();Lt$1.registerShader("effectring","MeshShader",t.shader)}}Lt$1.initDefaultShader(),Lt$1.mergeOptions({markerTypes:["effectring"]}),Lt$1.registerJSONType("EffectRingLayer"),Lt$1.registerRenderer("gl",F$2);const Bt$1={animation:!0,loop:!0,url:"plane",effect:"sequence",speed:1,scale:[1,1,1],rotation:[90,0,0]},Ft$1={width:9,height:5};if(transcoders){const e=t__namespace.Map.VERSION;if(e.indexOf("1.0.0-beta")>=0||e.indexOf("1.0.0-alpha")>=0){const e=transcoders.inject(T$2);t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",e)}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",(function(){return transcoders.inject(T$2)}))}else t__namespace.registerWorkerAdapter("@maptalks/gltf-layer",T$2);"undefined"!=typeof console&&console.log("@maptalks/gltf-layer v0.95.6");
/*!
	 * @maptalks/transform-control v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */
const w$1={yuanhuan:{accessors:[{name:"_1_0_positions",componentType:5126,count:104,min:[-5.407599925994873,-5.404099941253662,0],max:[5.405200004577637,5.406300067901611,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:104,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:288,min:[0],max:[103],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:3072,uri:"data:application/octet-stream;base64,KVyjQLbzPT4AAAAAZvesQLbzPT4AAAAAhsmqQC7/YT8AAAAAZ0ShQDC7Vz8AAAAA+u2lwGKhxr8AAAAArK2cwLpJvL8AAAAAEFihwB04V78AAAAAXdyqwE7RYb8AAAAAat6lQEaUxj8AAAAAApqcQG+BvD8AAAAAB18EQFOWlcAAAAAA+u0LQLBynsAAAAAARPoxQNSalMAAAAAAJzEoQIxKjMAAAAAAQBNVQFyPiMAAAAAAIEFJQMDsgMAAAAAA0950QK36dMAAAAAAejZnQFRSZ8AAAAAAXdyAQBBYScAAAAAA+n6IQI0oVcAAAAAAcoqUQAMJMsAAAAAAKjqMQIlBKMAAAAAAXdyAQFdbSUAAAAAA+n6IQDsBVUAAAAAA0950QBTQdEAAAAAAejZnQA5PZ0AAAAAA+n6IwI0oVcAAAAAAwOyAwBBYScAAAAAAXkuMwIlBKMAAAAAA0ZGUwAMJMsAAAAAA5j+8P9ejnMAAAAAAkDFXP65HocAAAAAA1JrGPz7opcAAAAAA/7I7PvhTo8AAAAAA/7I7PmPurMAAAAAAM8RhP/vLqsAAAAAADwutwLbzPT4AAAAA0m+jwLbzPT4AAAAAEFihwDC7Vz8AAAAAXdyqwC7/YT8AAAAArK2cwG+BvD8AAAAA+u2lwEaUxj8AAAAADXGewN/gC0AAAAAAa5qVwIV8BEAAAAAAXkuMwAFNKEAAAAAA0ZGUwD7oMUAAAAAAlIeVQIV8BEAAAAAAlWWeQN/gC0AAAAAAcoqUQD7oMUAAAAAAKjqMQAFNKEAAAAAAQBNVQBB6iEAAAAAAIEFJQKfogEAAAAAAW9N0wK36dMAAAAAAsVBnwFRSZ8AAAAAAlWWeQM/3C8AAAAAAlIeVQNxoBMAAAAAA+n6IwDsBVUAAAAAAwOyAwFdbSUAAAAAAsVBnwA5PZ0AAAAAAW9N0wBTQdEAAAAAAd74LwLBynsAAAAAAkxi8v9ejnMAAAAAAwFsEwFOWlcAAAAAARpRWv65HocAAAAAAayvGvz7opcAAAAAA2c43vvhTo8AAAAAA2c43vmPurMAAAAAAt9Fgv/vLqsAAAAAAt9Fgv7fRqkAAAAAAayvGvybkpUAAAAAAd74LwAponkAAAAAA2c43vv5lo0AAAAAA2c43vmkArUAAAAAARpRWvzxOoUAAAAAAkxi8v9ejnEAAAAAAOdYxwHKKlEAAAAAAwFsEwDqSlUAAAAAA+zoowNBEjEAAAAAAJlNJwKfogEAAAAAAUPxUwBB6iEAAAAAAat6lQGKhxr8AAAAAApqcQLpJvL8AAAAAhsmqQE7RYb8AAAAAZ0ShQB04V78AAAAAZvesQP+yO74AAAAAKVyjQP+yO74AAAAAM8RhP7fRqkAAAAAA/7I7PmkArUAAAAAA/7I7Pv5lo0AAAAAA+u0LQAponkAAAAAA1JrGPybkpUAAAAAAkDFXPzxOoUAAAAAA5j+8P9ejnEAAAAAARPoxQHKKlEAAAAAAB18EQDqSlUAAAAAAJzEoQNBEjEAAAAAA+zoowIxKjMAAAAAAOdYxwNSalMAAAAAAUPxUwFyPiMAAAAAAJlNJwMDsgMAAAAAAa5qVwNxoBMAAAAAADXGewM/3C8AAAAAA0m+jwP+yO74AAAAADwutwP+yO74AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMABAAFAAYABAAGAAcAAwACAAgAAwAIAAkACgALAAwACgAMAA0ADQAMAA4ADQAOAA8ADwAOABAADwAQABEAEgATABQAEgAUABUAFgAXABgAFgAYABkAGgAbABwAGgAcAB0AHgALAAoAHwALAB4AHwAgAAsAIQAgAB8AIgAjACAAIgAgACEAJAAlACYAJAAmACcAJwAmACgAJwAoACkAKgArACwAKgAsAC0ALgAvADAALgAwADEAGQAYADIAGQAyADMANAA1ABsANAAbABoAFQAUADYAFQA2ADcAOAA5ADoAOAA6ADsAPAA9AD4APAA/AD0AQAA/ADwAQABBAD8AQgBBAEAAQgBAAEMARABFAEYARABGAEcARABHAEgARgBJAEcARgBKAEkASwBKAEYASwBMAEoASwBNAEwACQAIAC8ACQAvAC4ALQAsADkALQA5ADgAOwA6AE4AOwBOAE8ATwBOAE0ATwBNAEsAKQAoACsAKQArACoANwA2AFAANwBQAFEAUQBQAFIAUQBSAFMAUwBSAFQAUwBUAFUAVgBXAFgAVgBYAFkAVgBZAFoAWwBZAFgAXABZAFsAXABdAFkAXgBdAFwAXwBdAF4APAA+AGAAPABgAGEAMQAwABcAMQAXABYAYgBjADUAYgA1ADQAYQBgAGMAYQBjAGIAMwAyAF0AMwBdAF8AHQAcAGQAHQBkAGUAZQBkAAUAZQAFAAQAZgBnAAcAZgAHAAYAEQAQABMAEQATABIA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:1248,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:1248,byteOffset:1248,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:576,byteOffset:2496,target:34963}],materials:[{name:"SVGMat_001",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan41:{accessors:[{name:"_1_0_positions",componentType:5126,count:39,min:[0,0,0],max:[5.489999771118164,0,5.488900184631348],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:39,min:[0,-.999939501285553,-1],max:[.13969914615154266,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:105,min:[0],max:[38],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yh41",byteLength:1148,uri:"data:application/octet-stream;base64,8tKXQAAAAACoNU09FK6vQAAAAAB1Ako/FK6vQAAAAAAAAACATfOAQAAAAAACmkg+K4dWQAAAAAAIrNw+WvUtQAAAAABbsT8/X5gIQAAAAACMSpI/OUWbQAAAAAD0/VQ/LbKHQAAAAAD0/XQ/W0JqQAAAAAC6SZQ/dLXNPwAAAACfq80/H4VHQAAAAAB0JLc/ZognQAAAAAA1XuI/YVSSPwAAAAAukAhABaMKQAAAAAB4nApABcU/PwAAAACF6y1Aw2TiPwAAAACRfidASS63PwAAAABKe0dAJLncPgAAAACze1ZAj1OUPwAAAADjNmpAAppIPgAAAADu64BAnRF1PwAAAAD8qYdAqDVNPQAAAADBypdAgQRVPwAAAAAIPZtAAAAAAAAAAAASpa9AAwlKPwAAAAASpa9AJJd/PAAAAAASpa9AAwlKPwAAAAASpa9AAAAAAAAAAAASpa9Asp1vPQAAAAASpa9AJLn8PQAAAAASpa9AqoJRPgAAAAASpa9ARwOYPgAAAAASpa9AHhbKPgAAAAASpa9A2hv8PgAAAAASpa9A5q4VPwAAAAASpa9A+n4qPwAAAAASpa9AQxw7PwAAAAASpa9AwhdGPwAAAAASpa9AAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAJ5X/OwL+fz8AAACAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIC/Kzs0PAn8f78AAACApLK/PA7uf78AAACAeJkZPefRfz8AAACA+ZldPQSgf78AAACA6XSTPelVfz8AAACALLO3PdT3fr8AAACAfkjZPR2Ofr8AAACANf32Paohfj8AAACAeUYHPqDBfT8AAACASw0PPlt9fb8AAACAAAABAAIAAwABAAAABAABAAMABQABAAQABgAHAAUABwABAAUABgAIAAcABgAJAAgACgAJAAYACgALAAkACgAMAAsADQAMAAoADQAOAAwADwAOAA0ADwAQAA4ADwARABAAEgARAA8AEgATABEAFAATABIAFAAVABMAFgAVABQAFgAXABUAGAAXABYAGAAZABcAGgAbABwAHQAbABoAHgAbAB0AHwAbAB4AIAAbAB8AIQAbACAAIgAbACEAIwAbACIAJAAbACMAJQAbACQAJgAbACUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:468,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:468,byteOffset:468,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:212,byteOffset:936,target:34963}],materials:[{name:"SVGMat_002",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanhuan411:{accessors:[{name:"_1_0_positions",componentType:5126,count:28,min:[.026000000536441803,-4.6834001541137695,0],max:[4.696700096130371,-.014800000004470348,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:28,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanhuan411",byteLength:828,uri:"data:application/octet-stream;base64,ufwXQLN7Mr8AAAAAObRAQLFQK78AAAAA1ediQMWP8b4AAAAAGQQ6QCv2174AAAAAqFdeQHUCWr4AAAAA7FGCQL6fmr0AAAAAHHyDQDLmrr4AAAAAXkuWQJf/kL4AAAAAXkuWQLN7crwAAAAAMCrxP2RdhL8AAAAA/BgDQJeQn78AAAAADeARQAg9i78AAAAAukkIQISeXb8AAAAAZaogQH/Zbb8AAAAA7Q3ePr4wOcAAAAAA5IMuP9/gP8AAAAAAJQZxPwrXH8AAAAAAPZs1P6UsF8AAAAAAdy2hP0VHAsAAAAAAb/CFP5eQ778AAAAA0ES4P32utr8AAAAAAprQPyL9zr8AAAAAi/1lPqqCXcAAAAAA9dv3PtcSYsAAAAAADi2yPZvmgcAAAAAAYTK1PssQg8AAAAAA9P3UPGrelcAAAAAA4liXPmrelcAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAACAAMAAwACAAQABQAGAAcABQAHAAgABAACAAYABAAGAAUACQAKAAsACQALAAwAAAANAAEADgAPABAADgAQABEAEQAQABIAEQASABMAFAAVAAoAFAAKAAkADAALAA0ADAANAAAAFgAXAA8AFgAPAA4AGAAZABcAGAAXABYAGgAZABgAGgAbABkAEwASABUAEwAVABQA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},yuanpan:{accessors:[{name:"Circle001_1_0_positions",componentType:5126,count:28,min:[-1.9510999917984009,0,-1.9510999917984009],max:[1.9510999917984009,0,1.9510999917984009],type:"VEC3",bufferView:0,byteOffset:0},{name:"Circle001_1_0_normals",componentType:5126,count:28,min:[0,1,0],max:[0,1,0],type:"VEC3",bufferView:1,byteOffset:0},{name:"Circle001_1_0_indices",componentType:5123,count:78,min:[0],max:[27],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"yuanpan",byteLength:828,uri:"data:application/octet-stream;base64,S+rkvgAAAADRIvM/AAAAAAAAAAClvfk/S+rkPgAAAADRIvM/0SLzvwAAAABL6uQ+MlXgvwAAAACsi1s/c9fCvwAAAACvJZw/pb35vwAAAAAAAAAA0SLzvwAAAABL6uS+MlXgvwAAAACsi1u/c9fCvwAAAACvJZy/ryWcvwAAAABz18K/rItbvwAAAAAyVeC/S+rkvgAAAADRIvO/AAAAgAAAAAClvfm/S+rkPgAAAADRIvO/rItbPwAAAAAyVeC/ryWcPwAAAABz18K/c9fCPwAAAACvJZy/MlXgPwAAAACsi1u/0SLzPwAAAABL6uS+pb35PwAAAAAAAACA0SLzPwAAAABL6uQ+MlXgPwAAAACsi1s/c9fCPwAAAACvJZw/ryWcvwAAAABz18I/ryWcPwAAAABz18I/rItbvwAAAAAyVeA/rItbPwAAAAAyVeA/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAABAAIAAwAEAAUABgADAAUABwAGAAUACAAHAAUACQAIAAUACgAJAAUACwAKAAUADAALAAUADQAMAAUADgANAAUADwAOAAUAEAAPAAUAEQAQAAUAEgARAAUAEwASAAUAFAATAAUAFQAUAAUAFgAVAAUAFwAWAAUAFwAFABgAGQAXABgAGQAYABoAGwAZABoAAgAbABoAAAACABoA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:336,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:336,byteOffset:336,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:156,byteOffset:672,target:34963}],materials:[{name:"wire_008110135",pbrMetallicRoughness:{baseColorFactor:[.0314,.4314,.5294,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Circle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Circle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},zzhou:{accessors:[{name:"Cube.001-Mesh_0_positions",componentType:5126,count:45,min:[-.2711470127105713,-5.473427772521973,-.2711470127105713],max:[.2711470127105713,.46298399567604065,.2711470127105713],type:"VEC3",bufferView:0,byteOffset:0},{name:"Cube.001-Mesh_0_normals",componentType:5126,count:45,min:[-1,-1,-1],max:[1,1,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Cube.001-Mesh_0_texcoords",componentType:5126,count:45,min:[.125,0],max:[.875,1],type:"VEC2",bufferView:2,byteOffset:0},{name:"Cube.001-Mesh_0_indices",componentType:5123,count:72,min:[0],max:[44],type:"SCALAR",bufferView:3,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"Z",byteLength:1584,uri:"data:application/octet-stream;base64,/waNvZMdK77/Bo09/waNPZMdK77/Bo09/waNPR4Kr8D/Bo09l+KKPVImr8D/Bo09/waNvVImr8D/Bo09yNOKPsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04o+yNOKvsjTir7I04o+AAAAAD0M7T4AAAAAyNOKvsjTir7I04q+yNOKvsjTir7I04q+yNOKPsjTir7I04q+yNOKPsjTir7I04o+yNOKvsjTir7I04o+yNOKPsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04o+yNOKvsjTir7I04q+AAAAAD0M7T4AAAAAyNOKPsjTir7I04q+/waNPZMdK77/Bo09/waNPZMdK77/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09/waNPR4Kr8D/Bo09/waNvZMdK77/Bo09/waNvVImr8D/Bo09/waNvVImr8D/Bo29/waNvZMdK77/Bo29/waNvZMdK77/Bo29/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPZMdK77/Bo29/waNPZMdK77/Bo09/waNvZMdK77/Bo09/waNvZMdK77/Bo29/waNPZMdK77/Bo29/waNvVImr8D/Bo09cooOO1Imr8BAMTI7/waNvVImr8D/Bo29/waNPVImr8D/Bo29/waNPVImr8D/Bo09l+KKPVImr8D/Bo09/waNPVImr8D/Bo09AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAAAAAAAAAIC/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/AAAAAFFmsT5wJHA/cCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAcCRwv1FmsT4AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAcCRwP1FmsT4AAAAAAAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AAAAAFFmsT5wJHC/AACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAvwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAADAPgAAQD8AAMA+AACAP2L1Hz8AAIA/AAAgP3uDfz8AACA/AABAPwAAwD4AAIA+AAAgPwAAAAAAAMA+AAAAAAAAwD4AAIA/AAAgPwAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAAD8AAMA+AACAPgAAAD4AAIA+AADAPgAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAQD8AACA/AAAAPwAAwD4AAAA/AADAPgAAAD8AAMA+AABAPwAAID8AAEA/AAAgPwAAAD9i9R8/AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AACAPgAAwD4AAIA+AADAPgAAgD4AACA/AACAPgAAID8AAAAAAADAPgAAAAAAAAA+AAAAPwAAwD4AAAA/AADAPgAAgD4AAAA+AACAPgAAID8AAAA/vAJBP/mGwj4AACA/AACAPgAAYD8AAIA+AAAgPwAAgD97g18/AAAAPwAAYD8AAAA/AAABAAIAAgADAAQAAgAEAAAABQAGAAcACAAJAAoACwAMAA0ACwANAA4ADwAQABEAEgATABQAFQAWABcAFwAYABkAFwAZABUAGgAbABwAGgAcAB0AHgAfACAAHgAgACEAIgAjACQAIgAkACUAJgAnACgAKAAnACkAAwACACoAKQAnACsAKQArACwAJwAmACsA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:540,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:540,byteOffset:540,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:360,byteOffset:1080,byteStride:8,target:34962},{name:"bufferView_3",buffer:0,byteLength:144,byteOffset:1440,target:34963}],materials:[{name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.8,.8,.8,1],metallicFactor:0,roughnessFactor:.676000006},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Cube.001-Mesh",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0,mode:4}]}],nodes:[{name:"Cube.001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},jiantou:{accessors:[{name:"_1_0_positions",componentType:5126,count:7,min:[-.47690001130104065,-.8044000267982483,0],max:[.47780001163482666,0,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"_1_0_normals",componentType:5126,count:7,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"_1_0_indices",componentType:5123,count:15,min:[0],max:[6],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"jiantou",byteLength:200,uri:"data:application/octet-stream;base64,bxIDOintTb8AAAAAH/RsvsKGp74AAAAAPSz0vsKGp74AAAAANs17PsKGp74AAAAANKL0PsKGp74AAAAANs17PgAAAAAAAAAAH/RsvgAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAAADAAEAAAAEAAMAAQAFAAYAAQADAAUAAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:84,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:84,byteOffset:84,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:32,byteOffset:168,target:34963}],materials:[{name:"SVGMat_003",pbrMetallicRoughness:{baseColorFactor:[.588,.588,.588,1],metallicFactor:0,roughnessFactor:.99},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xuanzhuan:{accessors:[{name:"001_1_0_positions",componentType:5126,count:369,min:[-6.572299957275391,-7.298999786376953,0],max:[6.5742998123168945,7.298299789428711,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"001_1_0_normals",componentType:5126,count:369,min:[0,-1,0],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"001_1_0_indices",componentType:5123,count:1089,min:[0],max:[368],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"-",byteLength:11036,uri:"data:application/octet-stream;base64,1zQDwHql3kAAAAAA48e4vgMJ1kAAAAAAQmD1v6yL6UAAAAAA2qxqv1Fr0EAAAAAAVHSkvnuD1UAAAAAAF7eRvjXv1EAAAAAAyeV/vqVO1EAAAAAA5INevsuh00AAAAAAW7E/vpHt0kAAAAAAZogjvoMv0kAAAAAAAwkKvrpr0UAAAAAA+aDnvTSi0EAAAAAAXCDBvWfVz0AAAAAAqoLZv4NRy0AAAAAALv+hvfcGz0AAAAAAAwmKvVg5zkAAAAAA/Yd0vYtszUAAAAAAak1zvSBBzUAAAAAA1xJyveQUzUAAAAAAIEFxvTLmzEAAAAAARdhwvd21zEAAAAAARdhwvbaEzEAAAAAAIEFxvb1SzEAAAAAAs3tyvSEfzEAAAAAARrZzvYXry0AAAAAAayt2vRe3y0AAAAAAkKB4vQaBy0AAAAAASFB8vfVKy0AAAAAAhXwcwLRZw0AAAAAAbjSAveQUy0AAAAAA3EaDvcX+ykAAAAAAb/CFvTLmykAAAAAAcM6IvRTQykAAAAAAcayLvSS5ykAAAAAAcoqOvQWjykAAAAAA4XqUvWx4ykAAAAAAUI2XvSBjykAAAAAACD2bvQFNykAAAAAAUrievbU3ykAAAAAAeJyivTojykAAAAAA5x2nve0NykAAAAAAMCqpvaMBykAAAAAAVp+rvVr1yUAAAAAAexSuvbPqyUAAAAAAxSCwvTvfyUAAAAAA6pWyvfLSyUAAAAAAoda0vUvIyUAAAAAAx0u3vQK8yUAAAAAAWvW5vVuxyUAAAAAA7Z68vYenyUAAAAAA7ny/veCcyUAAAAAAgSbCvQyTyUAAAAAAgQTFvQmKyUAAAAAA1CvlvRUdyUAAAAAAXW0FviS5yEAAAAAALNQavjVeyEAAAAAADi0yvqYKyEAAAAAAlkNLvki/x0AAAAAA5q5lvhx8x0AAAAAAZaqAvqs+x0AAAAAA4L6OvsgHx0AAAAAAyAedvnPXxkAAAAAAlkOrvqytxkAAAAAAEFi5vs6IxkAAAAAAH4XLvpVlxkAAAAAAAwnKvjhnxkAAAAAA54zIvjhnxkAAAAAAsAPHvgpoxkAAAAAAOwHNvsNkxkAAAAAAO3DOvvFjxkAAAAAA0ETYvpJcxkAAAAAAV+zPvk5ixkAAAAAAV1vRvtlfxkAAAAAAWMrSvgdfxkAAAAAAWDnUvmRdxkAAAAAAIo7VvpJcxkAAAAAA6+LWvpJcxkAAAAAAiIXavgRWxkAAAAAAJLncvkhQxkAAAAAA2/nevl5LxkAAAAAAkzrhvhdIxkAAAAAASnvjvtBExkAAAAAAMzPzvoY4xkAAAAAAArzlvrhAxkAAAAAAufznvkI+xkAAAAAAcT3qvs07xkAAAAAAKH7svlg5xkAAAAAAxLHuvoY4xkAAAAAAfPLwvoY4xkAAAAAA9Gz2vsoyxkAAAAAAtab5vj0sxkAAAAAAduD8vlInxkAAAAAAqRMAvzojxkAAAAAApb0Bv08exkAAAAAAE2EDvzcaxkAAAAAAnREFv00VxkAAAAAAC7UGvzQRxkAAAAAAlWUIv0oMxkAAAAAAHhYKv18HxkAAAAAAGsALv6MBxkAAAAAADk8Pv7n8xUAAAAAAgEgPv7n8xUAAAAAApHANv7n8xUAAAAAAUwWrv90kwkAAAAAASS4Pv7n8xUAAAAAApHANv7n8xUAAAAAAgEgPv7n8xUAAAAAA9wYPv7n8xUAAAAAAidIOv7n8xUAAAAAAG54Ov7n8xUAAAAAAIGMOv7n8xUAAAAAAJCgOv7n8xUAAAAAAKe0Nv7n8xUAAAAAASL8Nv7n8xUAAAAAA9pcNv7n8xUAAAAAAv30Nv7n8xUAAAAAABoFJwDm0uEAAAAAAZvcEwJtVu0AAAAAAwcoxwOzAsUAAAAAARiUFQFdbu8AAAAAAdZMcQM9mw8AAAAAA9pdJQIPAuMAAAAAAtvMxQEvIscAAAAAA2IFzQISeq8AAAAAAjLlbQECkpcAAAAAAZveMQPkxnMAAAAAAPQqBQNEil8AAAAAA+zqeQJOpisAAAAAAdk+SQPd1hsAAAAAAA3ihQFafZ8AAAAAAnl6tQN5xbsAAAAAAsi66QCEfRMAAAAAASFCuQLTIPsAAAAAA4XrEQPW5FsAAAAAAHqe4QJ/NEsAAAAAA1xLMQJhMzb8AAAAA6UjAQFInyL8AAAAAnMTQQM4ZUb8AAAAAsAPFQKMBTL8AAAAAduCMwKMjWcAAAAAA9P1wwOauOcAAAAAA6GqDwG1WGcAAAAAA46WZwA5PM8AAAAAANKLGQBe30TkAAAAAqmDSQBe30TkAAAAAdQLMwEYlzT8AAAAALUPAwAAAyD8AAAAAvp+4wFK4EkAAAAAArWnEwAWjFkAAAAAAF0iuwGizPkAAAAAATx66wI4GREAAAAAAXW2hwAmKZ0AAAAAAPE6twEtZbkAAAAAAW0KSwFFrhkAAAAAAayuewO2eikAAAAAAUPyAwPwYl0AAAAAA1eeMwK8lnEAAAAAAyJhbwA+cpUAAAAAAoWdzwDqSq0AAAAAA6GqrP8cpwsAAAAAA+zoQP6MBxsAAAAAAbqPZPxNhy8AAAAAAYHYPPxsNxsAAAAAAukkMPzQRxsAAAAAA0gAOPxsNxsAAAAAARPoNPxsNxsAAAAAAexQOPxsNxsAAAAAAPzUOPxsNxsAAAAAAIGMOPxsNxsAAAAAAcooOPxsNxsAAAAAAUrgOPxsNxsAAAAAAMuYOPxsNxsAAAAAAoBoPPxsNxsAAAAAAZDsPPxsNxsAAAAAAKVwPPxsNxsAAAAAA0m8PPxsNxsAAAAAAMZkKP00VxsAAAAAAp+gIPzcaxsAAAAAAqz4HPyEfxsAAAAAAIo4FP90kxsAAAAAAmN0DP2srxsAAAAAADi0CPycxxsAAAAAAhXwAP+M2xsAAAAAA9pf9PnE9xsAAAAAA/kP6PltCxsAAAAAA6+L2PqJFxsAAAAAA2IHzPulIxsAAAAAAc2jxPl5LxsAAAAAADk/vPtNNxsAAAAAAqDXtPkhQxsAAAAAAKA/rPr1SxsAAAAAAjNvoPmFUxsAAAAAAC7XmPjJVxsAAAAAAVHTkPgRWxsAAAAAA003iPnlYxsAAAAAAGw3gPh1axsAAAAAAZMzdPpJcxsAAAAAArIvbPgdfxsAAAAAA9UrZPnxhxsAAAAAA2c7XPvFjxsAAAAAA2V/WPpVlxsAAAAAA2PDUPgpoxsAAAAAA847TPn9qxsAAAAAA8x/SPiJsxsAAAAAA8rDQPvRsxsAAAAAA8kHPPphuxsAAAAAAKe3NPg1xxsAAAAAAKH7MPt5xxsAAAAAADALLPlR0xsAAAAAADJPJPsl2xsAAAAAA8BbIPj55xsAAAAAA4za6PryWxsAAAAAATRWsPvW5xsAAAAAASL+dPuvixsAAAAAAYHaPPp0Rx8AAAAAA5WGBPgtGx8AAAAAAi2xnPtiBx8AAAAAAOwFNPtbFx8AAAAAA6gQ0PmIQyMAAAAAAP8YcPiBjyMAAAAAA3pMHPrG/yMAAAAAAZ0TpPdEiycAAAAAAg1HJPcWPycAAAAAAy6HFPQ+cycAAAAAA7lrCPYenycAAAAAAEhS/PdCzycAAAAAAowG8PRrAycAAAAAAEFi5PZLLycAAAAAAfa62PdzXycAAAAAA6gS0PVTjycAAAAAAxY+xPZ7vycAAAAAADk+vPef7ycAAAAAA6NmsPV8HysAAAAAAn82qPakTysAAAAAAeVioPfMfysAAAAAAwaikPT81ysAAAAAA5WGhPYxKysAAAAAACRuePapgysAAAAAACD2bPcl2ysAAAAAAB1+YPbmNysAAAAAAdLWVPamkysAAAAAAvJaQPVvTysAAAAAABFaOPRzrysAAAAAA3+CLPd4Cy8AAAAAAldSJPXEby8AAAAAAcF+HPTMzy8AAAAAA3bWEPc9my8AAAAAALNRqP1Z90MAAAAAAuECCPciYy8AAAAAA3GiAPZLLy8AAAAAAtvN9PS7/y8AAAAAASFB8PScxzMAAAAAA/kN6PSBjzMAAAAAAI9t5PUaUzMAAAAAAI9t5PRHHzMAAAAAAI9t5PTj4zMAAAAAA/kN6PV8pzcAAAAAAkX57PYZazcAAAAAAJLl8PQmKzcAAAAAAcoqOPdZWzsAAAAAAMEymPaMjz8AAAAAAXW3FPZ7vz8AAAAAAjLnrPfW50MAAAAAAqz4DQN213sAAAAAAgy8MPmN/0cAAAAAA5q4lPrhA0sAAAAAAE/JBPn/70sAAAAAAnMRgPhSu08AAAAAAJQaBPnlY1MAAAAAAPL2SPpT21MAAAAAAeHqlPgmK1cAAAAAAhxa5Pr8O1sAAAAAA63P1P2iR6cAAAAAApb1Bv4xKsEAAAAAAMlVAP4xKsEAAAAAAw2QquxDpsUAAAAAAMne9v/OOq0AAAAAA3bW8P/OOq0AAAAAAYqEKwG/wo0AAAAAAcT0KQG/wo0AAAAAA/7IzwG6jmUAAAAAAak0zQG6jmUAAAAAA8IVZwAHejEAAAAAAHcklvw6+lkAAAAAAw2Qqu8UgmEAAAAAAxm0kPw6+lkAAAAAAuB5ZQAHejEAAAAAAc2ihP5aykkAAAAAA1xKiv5aykkAAAAAAKH7sP+AtjEAAAAAAjSjtv+AtjEAAAAAAuK97wBSue0AAAAAAOUV7QBSue0AAAAAAnl4ZQHBfg0AAAAAAdLUZwHBfg0AAAAAAXro5QGDlcEAAAAAA7Q06wGDlcEAAAAAAduCMwPCFWUAAAAAAZaqMQPCFWUAAAAAAqvFWQJAxV0AAAAAA3EZXwJAxV0AAAAAA46WZwEa2M0AAAAAA0m+ZQEa2M0AAAAAAHqdwQIv9OUAAAAAA9P1wwIv9OUAAAAAAIEGDQLWmGUAAAAAA6GqDwLWmGUAAAAAAnzyMwMZt7L8AAAAAiPSjwHE9CsAAAAAAIEGDQG1WGcAAAAAA0m+ZQA5PM8AAAAAA07yjQHE9CsAAAAAANBGMQMZt7L8AAAAA+1yrQAisvL8AAAAA6pWSQBBYob8AAAAAOpKrwAisvL8AAAAAVcGSwBBYob8AAAAA+8uWwI9TJL8AAAAA002wwG40QL8AAAAAYqGWQMbcJT8AAAAA8BawQPfkQT8AAAAA+1yrQE2EvT8AAAAA6pWSQJEPoj8AAAAAVTCYwInSXjsAAAAA+u2xwInSXjsAAAAA6gSYQInSXjsAAAAARraxQInSXjsAAAAAObTQwEXYUD8AAAAAIv3EwBrASz8AAAAAYqGWQI9TJL8AAAAA8BawQG40QL8AAAAA+8uWwMbcJT8AAAAA002wwPfkQT8AAAAAVcGSwJEPoj8AAAAAOpKrwE2EvT8AAAAAnzyMwOQU7T8AAAAAiPSjwEymCkAAAAAA07yjQEymCkAAAAAANBGMQOQU7T8AAAAAHqdwQOauOcAAAAAAZaqMQKMjWcAAAAAA3EZXwOviVsAAAAAAqvFWQOviVsAAAAAA7Q06wLyWcMAAAAAAXro5QLyWcMAAAAAAOUV7QMdLe8AAAAAAuK97wMdLe8AAAAAAdLUZwHo2g8AAAAAAnl4ZQHo2g8AAAAAAuB5ZQE+vjMAAAAAA8IVZwE+vjMAAAAAAjSjtv+oEjMAAAAAAKH7sP+oEjMAAAAAA1xKiv86IksAAAAAAc2ihP86IksAAAAAAak0zQGB2mcAAAAAA/7IzwGB2mcAAAAAAHcklv0aUlsAAAAAAxm0kP0aUlsAAAAAAw2Qqu/32l8AAAAAAcT0KQDPEo8AAAAAAYqEKwDPEo8AAAAAA3bW8P4hjq8AAAAAAMne9v4hjq8AAAAAAMlVAPyEfsMAAAAAApb1BvyEfsMAAAAAAw2Qqu3e+scAAAAAASFDSwG8Sg7oAAAAASZ3GwG8Sg7oAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAgL8AAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAwABAAAAAwAEAAEAAwAFAAQAAwAGAAUAAwAHAAYAAwAIAAcAAwAJAAgAAwAKAAkAAwALAAoAAwAMAAsADQAMAAMADQAOAAwADQAPAA4ADQAQAA8ADQARABAADQASABEADQATABIADQAUABMADQAVABQADQAWABUADQAXABYADQAYABcADQAZABgADQAaABkADQAbABoAHAAbAA0AHAAdABsAHAAeAB0AHAAfAB4AHAAgAB8AHAAhACAAHAAiACEAHAAjACIAHAAkACMAHAAlACQAHAAmACUAHAAnACYAHAAoACcAHAApACgAHAAqACkAHAArACoAHAAsACsAHAAtACwAHAAuAC0AHAAvAC4AHAAwAC8AHAAxADAAHAAyADEAHAAzADIAHAA0ADMAHAA1ADQAHAA2ADUAHAA3ADYAHAA4ADcAHAA5ADgAHAA6ADkAHAA7ADoAHAA8ADsAHAA9ADwAHAA+AD0AHAA/AD4AHABAAD8AQABBAD8AQQBCAD8AQgBDAD8AHABAAEQAHABEAEUAHABGAEUARgBHAEUARgBIAEcARgBJAEgARgBKAEkARgBLAEoARgBMAEsAHABNAEYAHABOAE0AHABPAE4AHABQAE8AHABRAFAAHABSAFEAUgBTAFEAUgBUAFMAUgBVAFQAUgBWAFUAUgBXAFYAUgBYAFcAHABZAFIAHABaAFkAHABbAFoAHABcAFsAHABdAFwAHABeAF0AHABfAF4AHABgAF8AHABhAGAAHABiAGEAHABjAGIAHABjAGQAZABlAGMAZQBmAGMAHABnAGQAaABpAGoAawBpAGgAbABpAGsAbQBpAGwAbgBpAG0AbwBpAG4AcABpAG8AcQBpAHAAcgBpAHEAcwBpAHIAdABnABwAdAB1AGcAdAB2AHUAdwB4AHkAdwB5AHoAegB5AHsAegB7AHwAfAB7AH0AfAB9AH4AfgB9AH8AfgB/AIAAgQCCAIMAgQCDAIQAhACDAIUAhACFAIYAhgCFAIcAhgCHAIgAiACHAIkAiACJAIoAiwCMAI0AiwCNAI4AjwCKAJAAigCJAJAAkQCSAJMAkQCTAJQAlACTAJUAlACVAJYAlgCVAJcAlgCXAJgAgAB/AIIAgACCAIEAmACXAJkAmACZAJoAmgCZAJsAmgCbAJwAnACbAJ0AnACdAJ4AngCdAHYAngB2AHQAnwB4AHcAoAB4AJ8AoAChAHgAogChAKAAowCkAKUAowCmAKQAowCnAKYAowCoAKcAowCpAKgAowCqAKkAowCrAKoAowCsAKsAowCtAKwAowCuAK0AowCvAK4AowCiAK8AowChAKIAsAChAKMAsQChALAAsgChALEAswChALIAtAChALMAtQChALQAtgChALUAtwChALYAuAChALcAuQChALgAugChALkAuwChALoAvAChALsAvQChALwAvgChAL0AvwChAL4AwAChAL8AwQChAMAAwgChAMEAwwChAMIAxAChAMMAxQChAMQAxgChAMUAxwChAMYAyAChAMcAyQChAMgAygChAMkAywChAMoAzAChAMsAzQChAMwAzgChAM0AzwChAM4A0AChAM8A0QChANAA0gChANEA0wChANIA1AChANMA1QChANQA1gChANUA1wChANYA2AChANcA2QChANgA2gChANkA2wChANoA3AChANsA3QChANwA3gChAN0A3wChAN4A4AChAN8A4QChAOAA4gChAOEA4wChAOIA5AChAOMA5QChAOQA5gChAOUA5wChAOYA6AChAOcA6QChAOgA6gChAOkA6wChAOoA7AChAOsA7QChAOwA7gChAO0A7wChAO4A8AChAO8A8QChAO8A8gChAPEA8wChAPIA9AChAPMA9QChAPQA9gChAPUA9gD3AKEA+AD3APYA+QD3APgA+gD3APkA+wD3APoA/AD3APsA/QD3APwA/gD3AP0A/wD3AP4AAAH3AP8AAQH3AAABAgH3AAEBAwH3AAIBBAH3AAMBBQH3AAQBBgH3AAUBBgEHAfcACAEHAQYBCQEHAQgBCgEHAQkBCwEHAQoBDAEHAQsBDQEHAQwBDgEHAQ0BDwEHAQ4BEAEHAQ8BEQESARMBFAESAREBFAEVARIBFgEVARQBFgEXARUBGAEXARYBGAEZARcBGgEbARgBGwEcARgBHAEZARgBHAEdARkBHQEeARkBHwEeAR0BGgEgARsBIQEeAR8BGgEiASABIwEiARoBIQEkAR4BJQEkASEBIwEmASIBJwEkASUBIwEoASYBKQEoASMBJwEqASQBKwEqAScBKQEsASgBLQEsASkBKwEuASoBLwEuASsBLQEwASwBMQEuAS8BLQEyATABjgCNADMBjgAzATQBNQE2ATcBNQE3ATgBOAE3ATkBOAE5AToBOwE8AT0BOwE9AT4BPwFAAUEBPwFBAUIBPgE9AUMBPgFDAUQBRQFGAUABRQFAAT8BRwFIAZIARwGSAJEASQFKAUYBSQFGAUUBRAFDAUsBRAFLAUwBOgE5AUoBOgFKAUkBTAFLAU0BTAFNAU4BTgFNAU8BTgFPAVABQgFBAVEBQgFRAVIBUgFRAS4BUgEuATEBNAEzATwBNAE8ATsBUwFUATYBUwE2ATUBUAFPATIBUAEyAS0BiwBVAYwAVgFUAVMBiwBXAVUBWAFUAVYBWAFZAVQBWgFXAYsAWgFbAVcBXAFZAVgBXAFdAVkBXgFbAVoBXgFfAVsBYAFdAVwBXgFhAV8BYgFdAWABYgFjAV0BZAFhAV4BZAFlAWEBZgFjAWIBZAFnAWUBZwFjAWYBZAFjAWcBZAFoAWMBaQFoAWQBaQFqAWgBawFqAWkBawFsAWoBbQFsAWsBbQFuAWwBbwFwAUgBbwFIAUcBAAA="}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:4428,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:4428,byteOffset:4428,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:2180,byteOffset:8856,target:34963}],materials:[{name:"SVGMat",pbrMetallicRoughness:{baseColorFactor:[.5,.5,.5,1],metallicFactor:0,roughnessFactor:1},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},plane:{accessors:[{name:"Rectangle001_1_0_positions",componentType:5126,count:4,min:[-5,-5,0],max:[5,5,0],type:"VEC3",bufferView:0,byteOffset:0},{name:"Rectangle001_1_0_normals",componentType:5126,count:4,min:[0,0,1],max:[0,0,1],type:"VEC3",bufferView:1,byteOffset:0},{name:"Rectangle001_1_0_indices",componentType:5123,count:6,min:[0],max:[3],type:"SCALAR",bufferView:2,byteOffset:0}],asset:{generator:"obj2gltf",version:"2.0"},buffers:[{name:"plane",byteLength:108,uri:"data:application/octet-stream;base64,AACgQAAAoEAAAAAAAACgwAAAoEAAAAAAAACgwAAAoMAAAAAAAACgQAAAoMAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAAAAAAIA/AAABAAIAAgADAAAA"}],bufferViews:[{name:"bufferView_0",buffer:0,byteLength:48,byteOffset:0,byteStride:12,target:34962},{name:"bufferView_1",buffer:0,byteLength:48,byteOffset:48,byteStride:12,target:34962},{name:"bufferView_2",buffer:0,byteLength:12,byteOffset:96,target:34963}],materials:[{name:"wire_225198087",pbrMetallicRoughness:{baseColorFactor:[.8824,.7765,.3412,1],metallicFactor:0,roughnessFactor:.968},emissiveFactor:[0,0,0],alphaMode:"OPAQUE",doubleSided:!1}],meshes:[{name:"Rectangle001_1",primitives:[{attributes:{POSITION:0,NORMAL:1},indices:2,material:0,mode:4}]}],nodes:[{name:"Rectangle001",mesh:0}],scene:0,scenes:[{nodes:[0]}]},xyzScale:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6]}],nodes:[{mesh:0,name:"Cube",scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:1,name:"Cube.001",scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:2,name:"Cube.004",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:3,name:"Cube.003",rotation:[0,-.7071068286895752,0,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:4,name:"Cube.006",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.7008190751075745,.014999999664723873,.014999999664723873]},{mesh:5,name:"Cube.005",rotation:[0,0,.7071068286895752,.7071068286895752],scale:[.10000000149011612,.10000000149011612,.10000000149011612]},{mesh:6,name:"Cube.002",scale:[.10000000149011612,.10000000149011612,.10000000149011612]}],materials:[{doubleSided:!0,name:"Material",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.001",pbrMetallicRoughness:{baseColorFactor:[.6938720345497131,.020288480445742607,.011612260714173317,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.002",pbrMetallicRoughness:{baseColorFactor:[.226582869887352,.226582869887352,.226582869887352,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.006",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.005",pbrMetallicRoughness:{baseColorFactor:[.11193240433931351,.5583405494689941,.033104799687862396,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.010",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}},{doubleSided:!0,name:"Material.009",pbrMetallicRoughness:{baseColorFactor:[.004391402006149292,.21223078668117523,.5209956169128418,1],metallicFactor:0,roughnessFactor:.4000000059604645}}],meshes:[{name:"Cube",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:"Cube.001",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:"Cube.006",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:"Cube.005",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:3,material:4}]},{name:"Cube.010",primitives:[{attributes:{POSITION:16,NORMAL:17,TEXCOORD_0:18},indices:3,material:5}]},{name:"Cube.009",primitives:[{attributes:{POSITION:19,NORMAL:20,TEXCOORD_0:21},indices:3,material:6}]},{name:"Cube.002",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]}],accessors:[{bufferView:0,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:1,componentType:5126,count:24,type:"VEC3"},{bufferView:2,componentType:5126,count:24,type:"VEC2"},{bufferView:3,componentType:5123,count:36,type:"SCALAR"},{bufferView:4,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:5,componentType:5126,count:24,type:"VEC3"},{bufferView:6,componentType:5126,count:24,type:"VEC2"},{bufferView:7,componentType:5126,count:24,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:8,componentType:5126,count:24,type:"VEC3"},{bufferView:9,componentType:5126,count:24,type:"VEC2"},{bufferView:10,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:11,componentType:5126,count:24,type:"VEC3"},{bufferView:12,componentType:5126,count:24,type:"VEC2"},{bufferView:13,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:24,type:"VEC3"},{bufferView:15,componentType:5126,count:24,type:"VEC2"},{bufferView:16,componentType:5126,count:24,max:[2.0003609657287598,1,1],min:[.0003610849380493164,-1,-1],type:"VEC3"},{bufferView:17,componentType:5126,count:24,type:"VEC3"},{bufferView:18,componentType:5126,count:24,type:"VEC2"},{bufferView:19,componentType:5126,count:24,max:[14.549108505249023,1,1],min:[12.549108505249023,-1,-1],type:"VEC3"},{bufferView:20,componentType:5126,count:24,type:"VEC3"},{bufferView:21,componentType:5126,count:24,type:"VEC2"}],bufferViews:[{buffer:0,byteLength:288,byteOffset:0},{buffer:0,byteLength:288,byteOffset:288},{buffer:0,byteLength:192,byteOffset:576},{buffer:0,byteLength:72,byteOffset:768},{buffer:0,byteLength:288,byteOffset:840},{buffer:0,byteLength:288,byteOffset:1128},{buffer:0,byteLength:192,byteOffset:1416},{buffer:0,byteLength:288,byteOffset:1608},{buffer:0,byteLength:288,byteOffset:1896},{buffer:0,byteLength:192,byteOffset:2184},{buffer:0,byteLength:288,byteOffset:2376},{buffer:0,byteLength:288,byteOffset:2664},{buffer:0,byteLength:192,byteOffset:2952},{buffer:0,byteLength:288,byteOffset:3144},{buffer:0,byteLength:288,byteOffset:3432},{buffer:0,byteLength:192,byteOffset:3720},{buffer:0,byteLength:288,byteOffset:3912},{buffer:0,byteLength:288,byteOffset:4200},{buffer:0,byteLength:192,byteOffset:4488},{buffer:0,byteLength:288,byteOffset:4680},{buffer:0,byteLength:288,byteOffset:4968},{buffer:0,byteLength:192,byteOffset:5256}],buffers:[{byteLength:5448,uri:"data:application/octet-stream;base64,6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAQAOABQAAQAUAAcACgAGABMACgATABcAFQASAAwAFQAMAA8AEAADAAkAEAAJABYABQACAAgABQAIAAsAEQANAAAAEQAAAAQAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgD8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgL8AAIC/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAPwAAgL8AAIA/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgD8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgL8AAIC/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgD8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/6gUAQAAAgL8AAIA/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgD8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgL8AAIC/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgD8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AFC9OQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAAJsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgD8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgL8AAIC/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgD8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JsloQQAAgL8AAIA/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgD8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgL8AAIC/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgD8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/JslIQQAAgL8AAIA/AAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAPwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AACAPwAAAAAAAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIC/AACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAAAAIA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAgD8AAAA+AACAPgAAwD4AAAAA"}]}};function Q$1(s,i,n,I,o,g){const r=[],a=fromRotationTranslationScale([],fromEuler([],n[0],n[1],n[2]),i,I);return function(A){return new X$8("",JSON.parse(JSON.stringify(w$1[A]))).load().then((A=>A))}(s).then((A=>{Dt$6.exportGLTFPack(A).getMeshesInfo().forEach(((A,s)=>{const C=new Ce$5({color:o||A.materialInfo.baseColorFactor}),h=new Be$5(A.geometry,C);h.setUniform("uPickingId",g+s);const w=h.getDefines();w.HAS_PICKING_ID=2,h.setDefines(w),h.translate=i,h.rotation=n,h.scaling=I,multiply$5(h.localTransform,a,A.nodeMatrix),h.originTransform=copy$5([],h.localTransform),h.originColor=o||A.materialInfo.baseColorFactor,r.push(h)})),g>100&&(r[0].properties.relatedMeshes=r.slice(1,2),r[1].properties.relatedMeshes=r.slice(0,1),r[2].properties.relatedMeshes=r.slice(3,4),r[3].properties.relatedMeshes=r.slice(2,3),r[4].properties.relatedMeshes=r.slice(5,6),r[5].properties.relatedMeshes=r.slice(4,5),r[6].properties.relatedMeshes=r.slice(0,6))})),r}function f$1(A,e){return Math.abs(A)*Math.sign(e)}function l(A,t){const i=A.getCoordinates(),n=t.coordinateToPointAtRes(i,t.getGLRes()),o=[n.x,n.y,0];add$4(o,o,P(t,A.getTranslation()));const r=function(A,e,t,s){return A._pointAtResToContainerPoint(e,t,void 0)}(t,new t__namespace.Point(o[0],o[1]),t.getGLRes());r.x+=85;const C=function(A,t,i,n){{const e=A.containerPointToCoordinate(t);return A.coordinateToPointAtRes(e,i)}}(t,r,t.getGLRes());return Math.sqrt(Math.pow(C.x-o[0],2)+Math.pow(C.y-o[1],2))/5.272881136101205}function P(A,e){if(!A)return e;const t=A.distanceToPointAtRes(e[0],e[1],A.getGLRes()),i=A.altitudeToPoint(e[2],A.getGLRes());return set$4([],f$1(t.x,e[0]),f$1(t.y,e[1]),f$1(i,e[2]))}class D$1{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],e=340/177,t=Q$1("jiantou",[1.2*e,0,0],[0,0,90],[e,e,e],[89/255,206/255,147/255,0],7),s=Q$1("jiantou",[0,1.2*e,0],[0,0,180],[e,e,e],[89/255,206/255,147/255,0],8),i=Q$1("jiantou",[-1.2*e,0,0],[0,0,270],[e,e,e],[89/255,206/255,147/255,0],9),n=Q$1("jiantou",[0,-1.2*e,0],[0,0,0],[e,e,e],[89/255,206/255,147/255,0],10);return A.push(t,s,i,n),A}getMeshes(){return this._meshes}}class u$1{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],e=Q$1("xuanzhuan",[0,0,0],[180,0,0],[340/177*.5,340/177*.5,340/177*.5],[50/255,130/255,184/255,.8],11);return A.push(e),A}getMeshes(){return this._meshes}}class m$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],e=Q$1("yuanhuan",[0,0,0],[0,0,0],[340/177*.5,340/177*.5,340/177*.5],[149/255,179/255,199/255,.5],12);return A.push(e),A}getMeshes(){return this._meshes}}class b$2{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],e=Q$1("plane",[0,0,0],[0,0,0],[10,10,10],[1,0,0,.5],16);return A.push(e),A}getMeshes(){return this._meshes}}class B$1{constructor(A){this.A=A,this._meshes=this.t()}setCoordinate(A){this.A=A}t(){const A=[],e=Q$1("xyzScale",[0,0,0],[0,0,0],[2,2,2],null,113);return A.push(e),A}getMeshes(){return this._meshes}}const y$2=[],p$2=[],v$1=[],L$1=[],M$1=[],d$1=[177/170,177/170,177/170],E$1=[],O$1=[1,2,3,4,12];class F$1{constructor(){this.translate=new D$1,this.rotation=new u$1,this.scaling=new m$2,this.planeHelper=new b$2,this.xyzScaleHelper=new B$1,this._meshes=this.t(),this.s=!0}t(){const A={};A.translate=this.translate.getMeshes(),A.rotation=this.rotation.getMeshes(),A.scaling=this.scaling.getMeshes(),A.planeHelper=this.planeHelper.getMeshes(),A.xyzScale=this.xyzScaleHelper.getMeshes();const e=340/177,t=Q$1("yuanhuan41",[-2.745*e,2.745*e,0],[90,0,0],[.5*e,.5*e,.5*e],[149/255,179/255,199/255,.6],1),s=Q$1("yuanhuan41",[2.745*e,2.745*e,0],[-90,0,180],[.5*e,.5*e,.5*e],[50/255,130/255,184/255,.5],2),i=Q$1("yuanhuan41",[2.745*e,-2.745*e,0],[90,0,180],[.5*e,.5*e,.5*e],[149/255,179/255,199/255,.6],3),n=Q$1("yuanhuan41",[-2.745*e,-2.745*e,0],[-90,0,0],[.5*e,.5*e,.5*e],[50/255,130/255,184/255,.5],4),I=Q$1("yuanpan",[0,0,0],[90,0,0],[.5*e,.5*e,.5*e],[89/255,206/255,147/255,.5],5),o=Q$1("zzhou",[0,0,6.5],[90,0,0],[1,1,1],[14/255,127/255,191/255,1],6);return A.translate.push(t,s,i,n,I,o),A}updateMatrix(t,i,n,I,o){const g=i.getCoordinates(),r=t.coordinateToPointAtRes(g,t.getGLRes()),C=i.i();set$4(p$2,r.x,r.y,C);const a=copy$4(y$2,o),h=P(t,i.getTranslation());add$4(p$2,p$2,h),add$4(p$2,p$2,a);for(const o in this._meshes)for(let g=0;g<this._meshes[o].length;g++){const r=this._meshes[o][g];for(let g=0;g<r.length;g++){const C=r[g],a=C.getUniform("uPickingId"),h=copy$4(y$2,C.translate);let w=copy$4(E$1,C.rotation);const c=C.scaling;if(11===a&&(this.s?(w[2]+=n,C.rotation[2]+=n):this.s||(w[2]+=n,C.rotation[2]+=n,w[0]=360,w[2]-=90)),a>100&&1===i.getTargets().length&&(w=i.getTargets()[0].getRotation()),O$1.indexOf(a)>-1)if(12!==a)c[0]+=I,c[1]+=I,c[2]+=I;else{const A=this._meshes.translate[4][0];c[0]=1.2*A.scaling[0],c[1]=1.2*A.scaling[0],c[2]=1.2*A.scaling[0]}let Q=l(i,t);if(Q=set$4(v$1,Q,Q,Q),multiply$4(h,h,Q),multiply$4(Q,Q,c),1===a||2===a||3===a||4===a){const A=multiply$4(M$1,c,d$1);multiply$4(h,h,A)}const f=fromEuler(L$1,w[0],w[1],w[2]);if(add$4(h,h,p$2),"xyzScale"===o){const A=fromRotationTranslationScale([],f,h,Q);multiply$5(C.localTransform,A,C.originTransform)}else fromRotationTranslationScale(C.localTransform,f,h,Q)}}}getMeshes(A){const e={};return A?("xyzScale"===A?e[A]=this._meshes[A]:(e.translate=this._meshes.translate,"translate"!==A&&(e[A]=this._meshes[A])),e):e}I(A){this.s=A}dispose(){for(const A in this._meshes)for(let e=0;e<this._meshes[A].length;e++){const t=this._meshes[A][e];for(let A=0;A<t.length;A++){const e=t[A];e.geometry.dispose(),e.dispose()}}}}const x$2=[],U$1=[],V$1=[],S$1=new t$1.Point(0,0),k$1=[],T$1=[],H$1=[],J$1=[0,0,0];class N$1{constructor(){this.o=[],this.g=[0,0,0],this.C=[1,1,1],this.h=[0,0,0]}l(A){Array.isArray(A)?A.forEach((A=>{this.l(A)})):(A.on("remove",this.P,this),A.D={coordinate:A.getCoordinates(),translation:A.getTranslation(),rotation:A.getRotation(),scale:A.getScale()},this.o.push(A))}u(){this.o.forEach((A=>{A.off("remove",this.P,this)})),this.o=[]}m(A,e,t,i,n,I,o){for(let o=0;o<this.o.length;o++){const g=this.o[o],r=g.getRotation(),C=g.getScale(),a=this.B(I,g,i,t,e);let h=null;h=i>=0?i:i*(this.options&&this.options.scaleStrength||1);const w=add$4(H$1,set$4(x$2,h*C[0],h*C[1],h*C[2]),C),c=Math.min(...w);if(Math.abs(c)<n){const A=Math.abs(c);w[0]=w[0]*(n/A),w[1]=w[1]*(n/A),w[2]=w[2]*(n/A)}const Q=add$4(r,t,r);g.setCoordinates(a),this.p(A,w,C);const f=g.getTranslation();g.setTRS(f,Q,w)}set$4(H$1,i,i,i),add$4(this.h,t,this.h),add$4(this.C,H$1,this.C),add$4(this.g,e,this.g),A.indexOf("translate")>-1?o.fire("positionchange",{action:A,type:"positionchange",target:this.o,center:this.getCoordinates(),scale:this.C,rotation:this.h,translation:this.g,deltaTranslate:e,deltaRotation:t,deltaScale:i}):o.fire("transforming",{action:A,type:"transforming",target:this.o,center:this.o[0].getTransformOrigin(),scale:this.C,rotation:this.h,translation:this.g,deltaTranslate:e,deltaRotation:t,deltaScale:i})}B(t,i,n,I,o){const g=i.getCenter(),r=i.getTransformOrigin(),C=t.getGLRes(),a=t.coordinateToPointAtRes(g,C,S$1);a.z=t.altitudeToPoint(g.z,C),set$4(k$1,a.x,a.y,a.z||0);const h=t.coordinateToPointAtRes(r,C,S$1);h.z=t.altitudeToPoint(r.z,C),set$4(T$1,h.x,h.y,h.z||0);const w=sub$2(x$2,k$1,T$1),c=fromEuler(U$1,0,0,I[2]);set$4(H$1,n+1,n+1,n+1);transformMat4$2(w,w,fromRotationTranslationScale(V$1,c,o,H$1)),add$4(w,w,T$1),S$1.set(w[0],w[1]);const f=t.pointAtResToCoordinate(S$1,C);return f.z=w[2]/t.altitudeToPoint(1,C),f}p(A,e,t){return"x-scale"===A&&(e[1]=t[1],e[2]=t[2]),"y-scale"===A&&(e[0]=t[0],e[2]=t[2]),"z-scale"===A&&(e[0]=t[0],e[1]=t[1]),e}v(){this.o.forEach((A=>{if(A.D){const{coordinate:e,translation:t,rotation:s,scale:i}=A.D;A.setCoordinates(e),A.setTRS(t,s,i)}}))}getScale(){return this.C}getTranslation(){return 1===this.o.length&&this.o[0].getTranslation()||J$1}getRotation(){return this.h}L(){return this.o[0]?this.o[0].getLayer():null}getCoordinates(){let A=0,e=0,t=0;const s=this.o.length;if(!s)return null;for(let i=0;i<s;i++){const s=this.o[i].getCenter();A+=s.x,e+=s.y,t+=s.z||0}A/=s,e/=s,t/=s;const i=new t$1.Coordinate(A,e,t);for(let A=0;A<s;A++)this.o[A].setTransformOrigin(i);return i}P(A){const e=A.target,t=this.o.indexOf(e);t>-1&&(delete e.D,this.o.splice(t,1))}getTargets(){return this.o}i(){let A=0;const e=this.o.length;for(let t=0;t<e;t++)A+=this.o[t].getPointZ();return A/=e,A}M(){for(let A=0;A<this.o.length;A++)if(this.o[A].isVisible())return!0;return!1}}const R$1=[5,6,7,8,9,10],_$2=[5,7,8,9,10],K$1=[2,4,11],z$1=[1,3,12],G$1=[12,16],j$1=[1,2,3,4],Z$1=[1,2,3,4,12],Y$1=[],W$1=[],q$1=[],X$1=[],$$1=[],AA$1=[],eA$1=[];class tA$1 extends(t$1.Eventable(t$1.Handlerable(t$1.Class))){constructor(A={}){super(A),this.options=A,this.mouseAction="moving",this.O=this.options.mode||"translate",this.F=!0,this.TransformHelper=new F$1,this.U=new N$1,this.helperScene=new Ke$5([]),this.addToMapCount=0}enable(){return this.F=!0,this.layerRenderer&&this.layerRenderer.setToRedraw(),this}disable(){return this.F=!1,this.layerRenderer&&this.layerRenderer.setToRedraw(),this.map&&this.map.resetCursor(),this}setMode(A){this.O=A,this.V(),this.layerRenderer&&this.layerRenderer.setToRedraw(),this.fire("modechange",{mode:A,type:"modechange"})}getMode(){return this.O}isEnable(){return this.F}S(A){R$1.indexOf(A)>-1?this.O="translate":K$1.indexOf(A)>-1?this.O="rotation":z$1.indexOf(A)>-1?this.O="scaling":"xyzScale"!==this.O&&(this.O="translate")}k(){return this.O}addTo(A){this.map&&(this.T(),console.warn("transform control has been added to a map, it suggest remove from the map before")),this.addToMapCount++,this.map=A,this.container=A.getContainer(),A.on("dom:mousemove",this.H,this),A.on("dom:mousedown",this.J,this),A.on("dom:mouseup",this.N,this),A.on("zooming moving dragrotating",this.R,this),this._()}remove(){this.map&&this.container&&this.layerRenderer&&(this.T(),this.TransformHelper.dispose(),this.layerRenderer.setToRedraw(),delete this.map,delete this.layer,delete this.layerRenderer,delete this.container,delete this.U)}T(){this.container&&this.map&&(this.map.off("dom:mousemove",this.H,this),this.map.off("dom:mousedown",this.J,this),this.map.off("dom:mouseup",this.N,this),this.map.off("zooming moving dragrotating",this.R,this),this.layer&&this.layer.off("renderend",this.render,this))}H(A){if(this.K()){if(this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},"moving"===this.mouseAction){const A=this.G();this.currentPickingObject=this.j(this.currentMousePosition,A,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.pickingId?(this.S(this.currentPickingObject.pickingId),this.Z(6===this.currentPickingObject.pickingId)):(this.Z(!1),this.S()),this.Y()}this.W(this.currentMousePosition)}}J(A){if(!this.K()||0!==A.domEvent.button)return;const e=this.G();this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y},this.q=!0,this.currentPickingObject=this.j(this.currentMousePosition,e,"meshes"),this.firstDownPoint=this.j(this.currentMousePosition,e,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.X(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.layerRenderer&&this.layerRenderer.setToRedraw()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0),this.V()),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=e[this.currentPickingObject.meshId]}N(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.V(),this.q=!0,this.fire("transformend",{action:this.$,type:"transformend"})),this.mouseAction="moving","xyzScale"!==this.O&&(this.O="translate"),this.map.config("zoomable",!0),this.map.config("draggable",!0),this.layerRenderer&&this.layerRenderer.setToRedraw()}R(){const A=this.TransformHelper.planeHelper.getMeshes()[0][0],e=this.map.getBearing();A.rotation[2]=-e,this.AA()}AA(){this.K()&&(this.TransformHelper.updateMatrix(this.map,this.U,0,0,[0,0,0]),this.q=!0)}picked(A){if(!this.layerRenderer)return!1;const e=this.G();let s=A;A instanceof t$1.Point||(s=this.map.coordinateToContainerPoint(new t$1.Coordinate(A)));const i=this.j(s,e,"picked");return!(!i||null===i.meshId)}V(){const A=this.TransformHelper.getMeshes("scaling").scaling[0][0];A.scaling=[340/177*.6,340/177*.6,340/177*.6],this.layerRenderer&&(this.eA(A),this.tA())}tA(){this.TransformHelper._meshes.translate.forEach((A=>{for(let e=0;e<A.length;e++){const t=A[e];j$1.indexOf(t.getUniform("uPickingId"))>-1&&t.material.set("color",t.originColor)}}))}eA(t){const i=this.U.getCoordinates(),n=this.map.coordinateToPointAtRes(i,this.map.getGLRes()),I=[n.x,n.y,0],o=P(this.map,this.U.getTranslation());add$4(I,I,o);const g=copy$4([],t.translate),r=t.scaling;let C=l(this.U,this.map);C=set$4([],C,C,C),multiply$4(g,g,C),multiply$4(C,C,r),add$4(g,g,I),fromRotationTranslationScale(t.localTransform,[0,0,0,1],g,C),this.G().forEach((t=>{const i=t.getUniform("uPickingId");if(1===i||3===i||2===i||4===i){const i=copy$4([],t.translate),n=170/177;t.scaling=[n,n,n];const o=t.scaling,g=t.rotation;let r=l(this.U,this.map);r=set$4([],r,r,r),multiply$4(i,i,r),multiply$4(r,r,o),add$4(i,i,I);const C=fromEuler([],g[0],g[1],g[2]);fromRotationTranslationScale(t.localTransform,C,i,r)}}))}sA(A){const e=this.map.containerPointToCoordinate(A),t=this.map.coordinateToPointAtRes(e,this.map.getGLRes());return{point:[t.x,t.y]}}W(A){if("transform"===this.mouseAction){const A=this.k(),e=P(this.map,this.U.getTranslation()),t=this.U.i();let s=null,n=null;if(e[2]+t<.01&&"z-translate"!==this.$)s=this.sA(this.currentMousePosition),n=this.sA(this.lastMousePosition);else{const A=this.TransformHelper.planeHelper.getMeshes()[0];if(s=this.j(this.currentMousePosition,A,"plane"),n=this.j(this.lastMousePosition,A,"plane"),!s||null===s.meshId||!n||null===n.meshId)return}const I=[0,0,0],g=[0,0,0];let r=0,C=0,a=0;if("translate"===A){if("xy-translate"===this.$){const e=s.point[1]-n.point[1];I[0]=s.point[0]-n.point[0],I[1]=e}else if("x-translate"===this.$){I[0]=s.point[0]-n.point[0]}else if("y-translate"===this.$){I[1]=s.point[1]-n.point[1]}else if("z-translate"===this.$){let A=0;if(this.iA()){const e=this.map.getGLRes(),t=this.map._pointAtResToContainerPoint(new t$1.Point(n.point[0],n.point[1]),e),I=this.map._pointAtResToContainerPoint(new t$1.Point(s.point[0],s.point[1]),e),g=length(set(X$1,s.point[0]-n.point[0],s.point[1]-n.point[1]));A=I.y<t.y?g:-g}else A=s.point[2]-n.point[2];I[2]=A}}else if("rotation"===A)C=this.nA(s.point,n.point),this.TransformHelper.I(C>=0),g[2]+=C;else if("scaling"===A||"xyzScale"===A){const A=this.IA(),e=length(set(X$1,this.firstDownPoint.point[0]-A[0],this.firstDownPoint.point[1]-A[1])),t=length(set(X$1,n.point[0]-A[0],n.point[1]-A[1]));r=this.oA(s.point,n.point,A,t),a=this.oA(s.point,n.point,A,e)}this.TransformHelper.updateMatrix(this.map,this.U,C,a,I),this.U.m(this.$,I,g,r,.01,this.map,this)}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject;const e=this.G();this.lastPickingMesh=e[this.currentPickingObject.meshId]}oA(A,e,t,s,n){const I=(length(set(X$1,A[0]-t[0],A[1]-t[1]))-length(set(X$1,e[0]-t[0],e[1]-t[1])))/s;return n?(n[0]-.01)*I:I}IA(){const A=this.map,e=this.U.getCoordinates(),t=A.coordinateToPointAtRes(e,A.getGLRes()),i=set$4($$1,t.x,t.y,0);return add$4(i,i,P(A,this.U.getTranslation())),i}Z(t){const i=this.TransformHelper.planeHelper.getMeshes()[0][0],n=getTranslation$1(q$1,i.localTransform),I=getScaling(W$1,i.localTransform);let o=fromEuler(Y$1,0,0,0);const g=this.map.getBearing();t&&!this.iA()?(o=fromEuler(Y$1,90,0,-g),0===i.rotation[0]&&(this.q=!0),set$4(i.rotation,90,0,-g)):(90===i.rotation[0]&&(this.q=!0),set$4(i.rotation,0,0,-g)),fromRotationTranslationScale(i.localTransform,o,n,I)}iA(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,e=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());set$4(e,e.x,e.y,0);const t=this.U.getCoordinates(),i=this.map.coordinateToPointAtRes(t,this.map.getGLRes()),n=P(this.map,this.U.getTranslation()),I=set$4(q$1,i.x,i.y,0);return angle$1(subtract$2([],A,add$4(I,I,n)),subtract$2([],A,e))<1/180*Math.PI}Y(){const A=this.G();if(this.currentPickingObject&&null!=this.currentPickingObject.meshId){this.gA(),this.lastPickingObject&&null!=this.lastPickingObject.meshId&&this.lastPickingObject.meshId!==this.currentPickingObject.meshId&&this.rA();const e=A[this.currentPickingObject.meshId];if(e&&G$1.indexOf(this.currentPickingObject.pickingId)<0)if(this.currentPickingObject.pickingId>100)this.CA(e);else{e.material.set("color",[e.originColor[0],e.originColor[1],e.originColor[2],.8]),this.aA(e,.5)}this.layerRenderer.setToRedraw()}else this.lastPickingObject&&null!=this.lastPickingObject.meshId&&(this.map.resetCursor(),this.rA(),this.layerRenderer.setToRedraw())}CA(A){const e=[1,179/255,2/255,1];A.material.set("color",e),A.properties.relatedMeshes&&A.properties.relatedMeshes.forEach((A=>{A.material.set("color",e)}))}gA(){6===this.currentPickingObject.pickingId?this.map.setCursor("ns-resize"):_$2.indexOf(this.currentPickingObject.pickingId)>-1?this.map.setCursor("move"):this.map.setCursor("pointer")}rA(){const A=this.lastPickingMesh;if(!A)return;const e=A.getUniform("uPickingId"),t=this.G();_$2.indexOf(e)>-1?t.forEach((A=>{_$2.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})):Z$1.indexOf(e)>-1?t.forEach((A=>{const e=A.getUniform("uPickingId");j$1.indexOf(e)>-1&&A.material.set("color",A.originColor)})):11===e&&t.forEach((A=>{j$1.indexOf(A.getUniform("uPickingId"))>-1&&A.material.set("color",A.originColor)})),A.material.set("color",A.originColor),A.properties.relatedMeshes&&A.properties.relatedMeshes.forEach((A=>{A.material.set("color",A.originColor)}))}aA(A,e){const t=A.getUniform("uPickingId"),s=this.G();_$2.indexOf(t)>-1?s.forEach((t=>{if(_$2.indexOf(t.getUniform("uPickingId"))>-1&&t.getUniform("uPickingId")!==A.getUniform("uPickingId")){t.material.set("color",[t.originColor[0],t.originColor[1],t.originColor[2],e])}})):"scaling"===this.O?s.forEach((A=>{const e=A.getUniform("uPickingId");if(1===e||3===e||2===e||4===e){A.material.set("color",[149/255,179/255,199/255,.8])}})):"rotation"===this.O&&s.forEach((A=>{const e=A.getUniform("uPickingId");if(1===e||3===e||2===e||4===e){const e=A.originColor;A.material.set("color",[e[0],e[1],e[2],0])}}))}reset(){this.map&&this.U&&(this.U.v(),this.TransformHelper.updateMatrix(this.map,this.U,0,0,[0,0,0]))}nA(A,e){const t=this.IA(),s=set(AA$1,e[0]-t[0],e[1]-t[1]),n=set(eA$1,A[0]-t[0],A[1]-t[1]),I=Math.atan2(s[1],s[0]);return(Math.atan2(n[1],n[0])-I)/Math.PI*180}X(A){return this.$=113===A||114===A?"x-scale":115===A||116===A?"z-scale":117===A||118===A?"y-scale":119===A?"xyz-scale":5===A?"xy-translate":6===A?"z-translate":7===A||9===A?"x-translate":8===A||10===A?"y-translate":11===A?"z-rotate":"scale",this.$}transform(A){if(!A)return;if(this.layerRenderer&&this.layerRenderer.layer&&(this.layerRenderer.layer.off("renderend",this.render),this.layerRenderer.layer.off("resizeCanvas",this.hA)),!this.map)return void console.error("should add to a target first");if(this.U&&(this.U.u(),this.U.l(A)),!this.U.getTargets().length)return;this.TransformHelper.updateMatrix(this.map,this.U,0,0,[0,0,0]),this.wA(),this.q=!0}getTransformTarget(){return this.U}P(){delete this.U}wA(){const A=this.U.L();A&&(A.off("renderend",this.render),A.off("resizeCanvas",this.hA));const e=this.map.getLayers();let t=null;for(let A=0;A<e.length;A++)if(e[A]instanceof Cs$3){t=e[A];break}if(!t)return;const s=t.getLayers(),i=s.indexOf(A);if(i<0)return;s.splice(i,1),s.push(A);const I=this.map,o=A.getRenderer();this.layerRenderer=o,this.regl=o.regl,this.renderer=o.renderer,this.cA=this.layerRenderer.getFBORayPicking(),this.QA={projViewMatrix:I.projViewMatrix},A.on("renderend",this.render,this),A.on("resizeCanvas",this.hA,this),o.setToRedraw()}hA(){this.cA.clear(),this.q=!0}j(A,e,t){const s=this.map;if(!(s&&this.cA&&this.layerRenderer&&this.layerRenderer.canvas))return null;const i=s.getDevicePixelRatio(),n=A.x*i,I=A.y*i,o={projViewMatrix:this.map.projViewMatrix,pointSize:1};return(this.q||this.layerRenderer.canvas.gl&&this.layerRenderer.canvas.gl.wrap||!this.fA||this.fA!==t)&&(this.cA.render(e,o,!0),this.fA=t,this.q=!1),this.cA.pick(n,I,10,o,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}_(){const A=this.map.getDevicePixelRatio();this.lA=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\n\n\nvoid main()\n\n{\n\n    gl_Position = projViewModelMatrix * vec4(aPosition, 1.0);\n\n\n\n}\n\n",frag:"precision mediump float;\n\nuniform vec4 color;\n\n\n\nvoid main() {\n\n    gl_FragColor = color;\n\n}\n\n",uniforms:["color",{name:"projViewModelMatrix",type:"function",fn:function(A,t){return multiply$5([],t.projViewMatrix,t.modelMatrix)}}],extraCommandProps:{viewport:{x:0,y:0,width:()=>this.map?this.map.width*A:1,height:()=>this.map?this.map.height*A:1},depth:{enable:!0,func:"always",mask:!0,range:[0,0]},blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}},defines:{}})}render(){if(!this.K())return;const A=this.G();this.helperScene.setMeshes(A);const e=this.layerRenderer.getFrameContext();if(e&&e.renderTarget&&this.layerRenderer.getFrameTimestamp()!==e.timestamp)return;this.AA(),this.lA.filter=e&&e.sceneFilter;this.renderer.render(this.lA,this.QA,this.helperScene,e&&e.renderTarget&&e.renderTarget.fbo)}G(){let A=[];const e=this.TransformHelper.getMeshes(this.O);for(const t in e){if("translate"===t)continue;const s=e[t];for(let e=0;e<s.length;e++)A=A.concat(s[e])}const t=e.translate;if(t)for(let e=0;e<t.length;e++)A=A.concat(t[e]);return A}K(){const A=this.layerRenderer,e=A&&A.layer;return A&&this.U&&e&&e.isVisible()&&this.U.M()&&this.regl&&this.F}}tA$1.mergeOptions({scaleStrength:2}),"undefined"!=typeof console&&console.log("@maptalks/transform-control v0.95.6");
/*!
	 * @maptalks/msd-json-loader v0.1.0
	 * LICENSE : BSD-3-Clause
	 * (c) 2016-2022 maptalks.com
	 */
class t{constructor(t){this.t=t||{}}getJSON(){return e(this.t)}getId(){return this.t.id}getStyle(){return this.t.options?e(this.t.options.style):null}getData(){return this.t.options?e(this.t.options.data):null}getGeometryById(t){const r=this.t.geometries;if(!r)return null;for(let i=0;i<r.length;i++)if(r[i]&&r[i].options&&r[i].options.id===t)return e(r[i]);return null}getGeometries(){return this.t.geometries?e(this.t.geometries):[]}}function e(t){return t?JSON.parse(JSON.stringify(t)):null}
/*!
	 * @maptalks/video-layer v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */
/*!
	* Contains code from THREE.js
	* MIT License
	* https://github.com/mrdoob/three.js
	*/for(var c=[],u=0;u<6;u++)c[u]=[];var p$1=[];function f(t,e,i){var s,r,o,n,a,h,l,d,u,f,_,g,x,w,y,b,O;r=(s=t)[0],o=s[1],n=s[2],l=s[5],d=s[6],_=s[9],g=s[10],y=s[13],b=s[14],m$1(c[0],(a=s[3])-r,(u=s[7])-(h=s[4]),(x=s[11])-(f=s[8]),(O=s[15])-(w=s[12])),m$1(c[1],a+r,u+h,x+f,O+w),m$1(c[2],a+o,u+l,x+_,O+y),m$1(c[3],a-o,u-l,x-_,O-y),m$1(c[4],a-n,u-d,x-g,O-b),m$1(c[5],a+n,u+d,x+g,O+b);for(var S=0;S<6;S++)if(!i||"0"!==i.charAt(S)){var T=c[S];if(p$1[0]=T[0]>0?e[1][0]:e[0][0],p$1[1]=T[1]>0?e[1][1]:e[0][1],p$1[2]=T[2]>0?e[1][2]:e[0][2],v(T,p$1)<0)return!1}return!0}function m$1(t,e,i,s,r){var o=1/Math.sqrt(e*e+i*i+s*s);return t[0]=e*o,t[1]=i*o,t[2]=s*o,t[3]=r*o,t}function v(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]}const _$1={vert:"\n    attribute vec3 aPosition;\n    attribute vec2 aTexCoord;\n    uniform mat4 projViewModelMatrix;\n    uniform mat4 positionMatrix;\n    uniform mat4 modelMatrix;\n    varying vec2 vTexCoords;\n    #include <get_output>\n    void main()\n    {\n        mat4 localPositionMatrix = getPositionMatrix();\n        vec4 localPosition = getPosition(aPosition);\n        gl_Position = projViewModelMatrix * localPositionMatrix * localPosition;\n        vTexCoords = aTexCoord;\n    }\n",frag:"\n    precision mediump float;\n    uniform sampler2D videoTexture;\n    uniform float opacity;\n\n    varying vec2 vTexCoords;\n    void main() {\n        vec4 color = texture2D(videoTexture, vTexCoords);\n        gl_FragColor = color * opacity;\n    }\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(t,e)=>multiply$5([],e.projViewMatrix,e.modelMatrix)},"texture","opacity"],positionAttribute:"POSITION",extraCommandProps:{depth:{enable:!0,func:"always"},cull:{enable:!1,face:"back"},frontFace:"cw",blend:{enable:!0,func:{src:"src alpha",dst:"one minus src alpha"},equation:"add"}}},g=[1,0,3,3,2,1];function w(t,e,i){if(!t)return null;const s=t.coordinateToPointAtRes(e,t.getGLRes());return[s.x,s.y,i]}class y$1 extends(t$1.Eventable(t$1.Handlerable(t$1.Class))){constructor(t,e){super(e),this.setCoordinates(t),this.A(this.options.url)}setCoordinates(t){this.k=t}getCoordinates(){return this.k}setVideo(t){this.I="stop",this.options.url=t,delete this.options.elementId,this.A()}setElementId(t){this.I="stop",this.options.elementId=t,delete this.options.url,this.A()}A(){this.I="stop";const t=this.options.url;let i=document.getElementById(this.options.elementId);if(t&&(i=document.createElement("video"),i.src=t),!i)throw new Error("there is no element or url setting for video mask");i.autoplay=!0,i.loop=!0,i.muted=!0,i.play(),i.addEventListener("playing",(()=>{this.I="playing",this.fire("playing",{state:this.I,url:t})})),i.addEventListener("pause",(()=>{this.I="pause",this.fire("pause",{state:this.I,url:t})})),i.addEventListener("error",(()=>{throw this.I="pause",this.fire("error",{state:this.I,url:t}),new Error("video resource load error")})),this.video=i}getVideo(){return this.video}R(t){this.D=t}S(){return this.D}addTo(t){if(this.L)throw new Error("VideoSurface cannot be added to two or more layers at the same time.");return t.addSurfaces(this),this}show(){return this.options.visible=!0,this}hide(){return this.options.visible=!1,this}isVisible(){return this.options.visible}play(){this.video&&this.video.play()}pause(){this.video&&this.video.pause()}setAudio(t){this.video.muted=t}setOpacity(t){this.options.opacity=t}getOpacity(){return this.options.opacity}remove(){delete this.video;const t=this.getLayer();t&&t.removeVideoSurfaces(this),this.endEdit()}getLayer(){return this.L}P(){return"playing"===this.I}startEdit(){const t=this.getLayer();if(!t)return void console.warn("videosurface should be added to a map before edit");const e=t.getMap();if(!e)return void console.warn("videosurface should be added to a map before edit");if(this.j(),!this.F){const i=t.getId();this.F=new t$1.VectorLayer(`internal_${i}_edit`,{enableAltitude:!0}).addTo(e)}const i=this.getCoordinates();this.N=new t$1.Polygon(i,{symbol:{lineColor:"#34495e",lineWidth:2,polygonFill:"rgb(135,196,240)",polygonOpacity:.1}}).addTo(this.F),this.N.startEdit({newVertexHandleSymbol:{polygonFill:"rgba(0, 0, 0, 0)",polygonOpacity:0,markerType:"ellipse",markerWidth:1,markerHeight:1}}),this.N.on("shapechange",(e=>{const i=e.target.getCoordinates()[0].slice(0,4).map((t=>[t.x,t.y,0]));this.setCoordinates(i),t.getRenderer().T(this)}),this)}endEdit(){this.F&&(this.N.endEdit(),this.N.remove(),this.F.remove()),delete this.F,delete this.N}j(){this.F&&this.F.clear(),delete this.N}}y$1.mergeOptions({opacity:1,visible:!0});class b$1 extends t$1.Layer{constructor(t,e,i){!e||Array.isArray(e)||e instanceof y$1||(i=e,e=null),super(t,i),this.G={},this.videoId=0,e&&this.addSurfaces(e)}addSurfaces(t){if(t)if(Array.isArray(t))t.forEach((t=>{this.addMarker(t)}));else{t.L=this,this.G[this.videoId]=t,t.R(this.videoId);const e=this.getRenderer();e?e.p()&&e.l(t):this.on("renderercreate",(e=>{e.renderer.p()&&e.renderer.l(t)})),this.videoId++}}showTopAlways(t){this.options.showTopAlways=t;const e=this.getRenderer();e&&e.m()}setDoubleSide(t){this.options.doubleSide=t;const e=this.getRenderer();e&&e.m()}getVideoSurfaces(){const t=[];for(const e in this.G)t.push(this.G[e]);return t}removeVideoSurfaces(t){if(Array.isArray(t))t.forEach((t=>{this.removeVideoSurfaces(t)}));else{const e=t.S(),i=this.getRenderer();i&&i.V(e),delete this.G[e]}}remove(){this.clear(),super.remove()}clear(){const t=this.getVideoSurfaces();for(let e=0;e<t.length;e++)t[e].remove()}}b$1.mergeOptions({renderer:"gl",doubleBuffer:!1,glOptions:null,markerEvents:!0,forceRenderOnZooming:!0,forceRenderOnMoving:!0,forceRenderOnRotating:!0,showTopAlways:!0,doubleSide:!0}),b$1.registerJSONType("VideoLayer"),b$1.registerRenderer("gl",class extends t__namespace.renderer.CanvasRenderer{constructor(t){super(t),this.t={}}draw(t,e){this.prepareCanvas(),this.i(e)}drawOnInteracting(t,e,i){this.i(i)}needToRedraw(){return!0}hitDetect(){return!1}createContext(){if(this.canvas.gl&&this.canvas.gl.wrap)this.gl=this.canvas.gl.wrap(),this.regl=this.canvas.gl.regl;else{const t=this.layer.options.glOptions||{alpha:!0,depth:!0,stencil:!0};this.glOptions=t,this.gl=this.gl||this.s(this.canvas,t),this.regl=a$2({gl:this.gl,extensions:["ANGLE_instanced_arrays","OES_texture_float","OES_texture_half_float","OES_texture_float_linear","OES_texture_half_float_linear","EXT_shader_texture_lod","OES_element_index_uint","OES_standard_derivatives","WEBGL_depth_texture"],optionalExtensions:this.layer.options.glExtensions||[]})}this.o(),this.h();const t=this.layer.getVideoSurfaces();for(let e=0;e<t.length;e++)this.l(t[e])}s(t,e){const i=["webgl","experimental-webgl"];let s=null;for(let r=0;r<i.length;++r){try{s=t.getContext(i[r],e)}catch(t){}if(s)break}return s}h(){const t=this.layer.getMap(),e=new B$6(this.regl);this.renderer=e,this.u={projMatrix:t.projMatrix,projViewMatrix:t.projViewMatrix,viewMatrix:t.viewMatrix,halton:[.2107,-.0202],uHalton:[.2107,-.0202],uCameraPosition:t.cameraPosition,cameraPosition:t.cameraPosition,globalTexSize:[t.width,t.height]}}p(){return this.regl}o(){this.viewport={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1},this.m()}m(){this.v&&this.v.dispose(),this.layer.options.showTopAlways?(_$1.extraCommandProps.depth.mask=!1,_$1.extraCommandProps.depth.range=[0,0]):(delete _$1.extraCommandProps.depth.mask,delete _$1.extraCommandProps.depth.range),_$1.extraCommandProps.cull.enable=!this.layer.options.doubleSide,this.v=new vn$4(_$1)}l(t){const e=this.regl.texture(),i=new Ce$5({videoTexture:e,opacity:1}),s=t.getCoordinates(),{worldCenter:r,points:o}=this._(s),n=this.g(o),a=new Be$5(n,i);this.O(a,r);const l=new Ke$5(a),d=t.S();this.t[d]=l}T(t){const e=t.S(),i=this.t[e].getMeshes()[0],s=t.getCoordinates();i.geometry.dispose();const{worldCenter:r,points:o}=this._(s),n=this.g(o);i.geometry=n,this.O(i,r)}i(t){const e=this.layer.getVideoSurfaces().filter((t=>t.isVisible()));if(!e.length)return;const i=this.C(e);if(!i)return;let s=null;t&&(s=t.renderTarget&&t.renderTarget.fbo),this.renderer.render(this.v,this.u,i,s)}g(t){return new Q$7({POSITION:t,TEXCOORD:[0,0,1,0,1,1,0,1]},g,0,{primitive:"triangles",positionAttribute:"POSITION",uv0Attribute:"TEXCOORD",normalAttribute:"NORMAL",positionSize:3})}_(e){let i=[];const s=this.getMap(),r=new t__namespace.Polygon(e).getCenter(),o=w(s,r,0);return this.M=o,s&&e.forEach((e=>{const r=new t__namespace.Coordinate(e[0],e[1]),n=s.altitudeToPoint(e[2]||0,s.getGLRes()),a=w(s,r,n);a[0]=a[0]-o[0],a[1]=a[1]-o[1],i=i.concat(a)})),{worldCenter:o,points:i}}C(t){const e=[],i=this.layer.getMap();for(let s=0;s<t.length;s++){const r=t[s],o=this.t[r.S()];if(!o)continue;const n=o.getMeshes();for(let t=0;t<n.length;t++){const s=n[t],o=s.getMaterial(),a=o.get("videoTexture");a&&r.P()&&(a(r.video),o.set("opacity",r.getOpacity())),f(i.projViewMatrix,s.getBoundingBox())&&e.push(s)}}return e.length?new Ke$5(e):null}O(t,e){fromRotationTranslationScale(t.localTransform,fromEuler([],0,0,0),e,[1,1,1])}remove(){this.v&&this.v.dispose(),super.remove()}clearCanvas(){this.canvas&&(this.regl.clear({color:[0,0,0,0],depth:1,stencil:0}),super.clearCanvas())}V(t){const e=this.t[t];e&&e.getMeshes().forEach((t=>{t.geometry.dispose(),t.material&&t.material.dispose(),t.dispose()}))}}),"undefined"!=typeof console&&console.log("@maptalks/video-layer v0.95.6");
/*!
	 * @maptalks/analysis v0.95.6
	 * LICENSE : UNLICENSED
	 * (c) 2016-2024 maptalks.org
	 */
var _,D="undefined"!=typeof Float32Array?Float32Array:Array;function I(A){return A[0]=1,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=1,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=1,A[11]=0,A[12]=0,A[13]=0,A[14]=0,A[15]=1,A}function M(A,t,n){var i=t[0],r=t[1],e=t[2],s=t[3],u=t[4],o=t[5],h=t[6],f=t[7],c=t[8],a=t[9],v=t[10],l=t[11],w=t[12],P=t[13],g=t[14],C=t[15],D=n[0],I=n[1],M=n[2],b=n[3];return A[0]=D*i+I*u+M*c+b*w,A[1]=D*r+I*o+M*a+b*P,A[2]=D*e+I*h+M*v+b*g,A[3]=D*s+I*f+M*l+b*C,A[4]=(D=n[4])*i+(I=n[5])*u+(M=n[6])*c+(b=n[7])*w,A[5]=D*r+I*o+M*a+b*P,A[6]=D*e+I*h+M*v+b*g,A[7]=D*s+I*f+M*l+b*C,A[8]=(D=n[8])*i+(I=n[9])*u+(M=n[10])*c+(b=n[11])*w,A[9]=D*r+I*o+M*a+b*P,A[10]=D*e+I*h+M*v+b*g,A[11]=D*s+I*f+M*l+b*C,A[12]=(D=n[12])*i+(I=n[13])*u+(M=n[14])*c+(b=n[15])*w,A[13]=D*r+I*o+M*a+b*P,A[14]=D*e+I*h+M*v+b*g,A[15]=D*s+I*f+M*l+b*C,A}function b(A,t,n){var i=n[0],r=n[1],e=n[2];return A[0]=t[0]*i,A[1]=t[1]*i,A[2]=t[2]*i,A[3]=t[3]*i,A[4]=t[4]*r,A[5]=t[5]*r,A[6]=t[6]*r,A[7]=t[7]*r,A[8]=t[8]*e,A[9]=t[9]*e,A[10]=t[10]*e,A[11]=t[11]*e,A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}function z(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[4],s=t[5],u=t[6],o=t[7],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[4]=e*r+h*i,A[5]=s*r+f*i,A[6]=u*r+c*i,A[7]=o*r+a*i,A[8]=h*r-e*i,A[9]=f*r-s*i,A[10]=c*r-u*i,A[11]=a*r-o*i,A}function d(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[8],f=t[9],c=t[10],a=t[11];return t!==A&&(A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r-h*i,A[1]=s*r-f*i,A[2]=u*r-c*i,A[3]=o*r-a*i,A[8]=e*i+h*r,A[9]=s*i+f*r,A[10]=u*i+c*r,A[11]=o*i+a*r,A}function x(A,t,n){var i=Math.sin(n),r=Math.cos(n),e=t[0],s=t[1],u=t[2],o=t[3],h=t[4],f=t[5],c=t[6],a=t[7];return t!==A&&(A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15]),A[0]=e*r+h*i,A[1]=s*r+f*i,A[2]=u*r+c*i,A[3]=o*r+a*i,A[4]=h*r-e*i,A[5]=f*r-s*i,A[6]=c*r-u*i,A[7]=a*r-o*i,A}function m(A,t){return A[0]=t[12],A[1]=t[13],A[2]=t[14],A}function y(A,t,n,i){var r=t[0],e=t[1],s=t[2],u=t[3],o=r+r,h=e+e,f=s+s,c=r*o,a=r*h,v=r*f,l=e*h,w=e*f,P=s*f,g=u*o,C=u*h,D=u*f,I=i[0],M=i[1],b=i[2];return A[0]=(1-(l+P))*I,A[1]=(a+D)*I,A[2]=(v-C)*I,A[3]=0,A[4]=(a-D)*M,A[5]=(1-(c+P))*M,A[6]=(w+g)*M,A[7]=0,A[8]=(v+C)*b,A[9]=(w-g)*b,A[10]=(1-(c+l))*b,A[11]=0,A[12]=n[0],A[13]=n[1],A[14]=n[2],A[15]=1,A}function p(A,t,n,i,r){var e=1/Math.tan(t/2),s=void 0;return A[0]=e/n,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=e,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[11]=-1,A[12]=0,A[13]=0,A[15]=0,null!=r&&r!==1/0?(A[10]=(r+i)*(s=1/(i-r)),A[14]=2*r*i*s):(A[10]=-1,A[14]=-2*i),A}function L(A,t,n,i){var r=void 0,e=void 0,s=void 0,u=void 0,o=void 0,h=void 0,f=void 0,c=void 0,a=void 0,v=void 0,l=t[0],w=t[1],P=t[2],g=i[0],C=i[1],D=i[2],M=n[0],b=n[1],z=n[2];return Math.abs(l-M)<1e-6&&Math.abs(w-b)<1e-6&&Math.abs(P-z)<1e-6?I(A):(f=l-M,c=w-b,a=P-z,r=C*(a*=v=1/Math.sqrt(f*f+c*c+a*a))-D*(c*=v),e=D*(f*=v)-g*a,s=g*c-C*f,(v=Math.sqrt(r*r+e*e+s*s))?(r*=v=1/v,e*=v,s*=v):(r=0,e=0,s=0),u=c*s-a*e,o=a*r-f*s,h=f*e-c*r,(v=Math.sqrt(u*u+o*o+h*h))?(u*=v=1/v,o*=v,h*=v):(u=0,o=0,h=0),A[0]=r,A[1]=u,A[2]=f,A[3]=0,A[4]=e,A[5]=o,A[6]=c,A[7]=0,A[8]=s,A[9]=h,A[10]=a,A[11]=0,A[12]=-(r*l+e*w+s*P),A[13]=-(u*l+o*w+h*P),A[14]=-(f*l+c*w+a*P),A[15]=1,A)}function T(){var A=new D(3);return D!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A}function F(A,t,n){var i=new D(3);return i[0]=A,i[1]=t,i[2]=n,i}function U(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A}function E(A,t,n,i){return A[0]=t,A[1]=n,A[2]=i,A}function N(A,t,n){return A[0]=t[0]+n[0],A[1]=t[1]+n[1],A[2]=t[2]+n[2],A}function j(A,t,n){return A[0]=t[0]-n[0],A[1]=t[1]-n[1],A[2]=t[2]-n[2],A}function Q(A,t){var n=t[0],i=t[1],r=t[2],e=n*n+i*i+r*r;return e>0&&(e=1/Math.sqrt(e),A[0]=t[0]*e,A[1]=t[1]*e,A[2]=t[2]*e),A}function k(A,t,n){var i=t[0],r=t[1],e=t[2],s=n[3]*i+n[7]*r+n[11]*e+n[15];return A[0]=(n[0]*i+n[4]*r+n[8]*e+n[12])/(s=s||1),A[1]=(n[1]*i+n[5]*r+n[9]*e+n[13])/s,A[2]=(n[2]*i+n[6]*r+n[10]*e+n[14])/s,A}function B(A,t){var n=F(A[0],A[1],A[2]),i=F(t[0],t[1],t[2]);Q(n,n),Q(i,i);var r=function(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}(n,i);return r>1?0:r<-1?Math.PI:Math.acos(r)}function R(){var A=new D(4);return D!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0),A[3]=1,A}function G(A){return A[0]=0,A[1]=0,A[2]=0,A[3]=1,A}function Y(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+s*u,A[1]=r*o+e*u,A[2]=e*o-r*u,A[3]=s*o-i*u,A}function q(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o-e*u,A[1]=r*o+s*u,A[2]=e*o+i*u,A[3]=s*o-r*u,A}function V(A,t,n){n*=.5;var i=t[0],r=t[1],e=t[2],s=t[3],u=Math.sin(n),o=Math.cos(n);return A[0]=i*o+r*u,A[1]=r*o-i*u,A[2]=e*o+s*u,A[3]=s*o-e*u,A}function W(A,t,n,i){var r=.5*Math.PI/180;t*=r,n*=r,i*=r;var e=Math.sin(t),s=Math.cos(t),u=Math.sin(n),o=Math.cos(n),h=Math.sin(i),f=Math.cos(i);return A[0]=e*o*f-s*u*h,A[1]=s*u*f+e*o*h,A[2]=s*o*h-e*u*f,A[3]=s*o*f+e*u*h,A}function K(A,t,n){return A[0]=t,A[1]=n,A}T(),function(){var A;A=new D(4),D!=Float32Array&&(A[0]=0,A[1]=0,A[2]=0,A[3]=0)}(),T(),F(1,0,0),F(0,1,0),R(),R(),_=new D(9),D!=Float32Array&&(_[1]=0,_[2]=0,_[3]=0,_[5]=0,_[6]=0,_[7]=0),_[0]=1,_[4]=1,_[8]=1,function(){var A=new D(2);D!=Float32Array&&(A[0]=0,A[1]=0)}();class H{constructor(A,t){this.renderer=A,this.regl=A.regl,this.u=t,this.h()}h(){this.l=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:2048,height:2048,wrap:"clamp",mag:"nearest",min:"nearest"}),depth:!0})}g(A,t,n){const i={projViewMatrix:t,minAltitude:0,logDepthBufFC:2/(Math.log(n+1)/Math.LN2)};this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.l}),this.renderer.render(this.C,i,A,this.l)}D(t,n){this.C=new vn$4({vert:"#include <gl2_vert>\n\n#ifdef HAS_ALTITUDE\n\n    attribute vec2 aPosition;\n\n    attribute float aAltitude;\n\n#else\n\n    attribute vec3 aPosition;\n\n#endif\n\n// uniform mat4 projViewMatrix;\n\n// uniform mat4 modelMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 positionMatrix;\n\nvarying vec2 vHighPrecisionZW;\n\n#include <get_output>\n\nvarying float vFragDepth;\n\n\n\n#ifdef HAS_ALTITUDE\n\n    vec3 unpackVTPosition() {\n\n        return vec3(aPosition, aAltitude);\n\n    }\n\n#endif\n\nvoid main()\n\n{\n\n    #ifdef HAS_ALTITUDE\n\n        vec3 i = unpackVTPosition();\n\n        vec4 j = vec4(i, 1.);\n\n        gl_Position = projViewModelMatrix * j;\n\n    #else\n\n        mat4 localPositionMatrix = getPositionMatrix();\n\n        gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    #endif\n\n    vFragDepth = 1.0 + gl_Position.w;\n\n    vHighPrecisionZW = gl_Position.zw;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nuniform float logDepthBufFC;\n\nvarying float vFragDepth;\n\nvarying vec2 vHighPrecisionZW;\n\n\n\nconst float PackUpscale = 256. / 255.;\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\n\nconst float ShiftRight8 = 1. / 256.;\n\nvec4 packDepthToRGBA(const in float v ) {\n\n    vec4 r = vec4(fract(v * PackFactors), v);\n\n    r.yzw -= r.xyz * ShiftRight8;\n\n    return r * PackUpscale;\n\n}\n\nvoid main() {\n\n    gl_FragDepthEXT = log2(vFragDepth) * logDepthBufFC * 0.5;\n\n    float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\n    glFragColor = packDepthToRGBA(fragCoordZ);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>M([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:{x:0,y:0,width:()=>{const A=this.I(t,n);return A?A.width:1},height:()=>{const A=this.I(t,n);return A?A.height:1}}}}),this.C.version=300}I(A,t){return this.m(A,t)?{width:2048,height:2048}:null}m(A,t){return A&&t&&A*t>0}dispose(){this.l&&this.l.destroy(),this.C&&this.C.dispose()}}const J=[0,0,0,1];class Z extends H{h(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.O=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n\n\nvoid main() {\n\n    gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n}\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,n)=>multiply$5([],n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.F=new Ke$5}render(A,t){this.U(),this.renderer.clear({color:J,depth:1,framebuffer:this.T}),this.F.setMeshes(A);return this.renderer.render(this.O,{projViewMatrix:t},this.F,this.T),this.T}U(){const A=t__namespace.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t__namespace.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}function X(A,t){return A.altitudeToPoint(t||0,A.getGLRes())}const $=new t__namespace.Coordinate(0,0);function AA(A,t,n,i){if(!A)return null;$.set(t,n);const r=A.coordinateToPointAtRes($,A.getGLRes()),e=X(A,i);return[r.x,r.y,e]}var tA={exports:{}};function nA(A,t,n){n=n||2;var i,r,e,s,u,o,h,f=t&&t.length,c=f?t[0]*n:A.length,a=iA(A,0,c,n,!0),v=[];if(!a||a.next===a.prev)return v;if(f&&(a=function(A,t,n,i){var r,e,o,h=[];for(r=0,e=t.length;r<e;r++)(o=iA(A,t[r]*i,r<e-1?t[r+1]*i:A.length,i,!1))===o.next&&(o.steiner=!0),h.push(lA(o));for(h.sort(fA),r=0;r<h.length;r++)n=cA(h[r],n);return n}(A,t,a,n)),A.length>80*n){i=e=A[0],r=s=A[1];for(var l=n;l<c;l+=n)(u=A[l])<i&&(i=u),(o=A[l+1])<r&&(r=o),u>e&&(e=u),o>s&&(s=o);h=0!==(h=Math.max(e-i,s-r))?32767/h:0}return eA(a,v,n,i,r,h,0),v}function iA(A,t,n,i,r){var e,s;if(r===yA(A,t,n,i)>0)for(e=t;e<n;e+=i)s=dA(e,A[e],A[e+1],s);else for(e=n-i;e>=t;e-=i)s=dA(e,A[e],A[e+1],s);return s&&CA(s,s.next)&&(xA(s),s=s.next),s}function rA(A,t){if(!A)return A;t||(t=A);var n,i=A;do{if(n=!1,i.steiner||!CA(i,i.next)&&0!==gA(i.prev,i,i.next))i=i.next;else{if(xA(i),(i=t=i.prev)===i.next)break;n=!0}}while(n||i!==t);return t}function eA(A,t,n,i,r,e,s){if(A){!s&&e&&function(A,t,n,i){var r=A;do{0===r.z&&(r.z=vA(r.x,r.y,t,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==A);r.prevZ.nextZ=null,r.prevZ=null,function(A){var t,n,i,r,e,s,u,o,h=1;do{for(n=A,A=null,e=null,s=0;n;){for(s++,i=n,u=0,t=0;t<h&&(u++,i=i.nextZ);t++);for(o=h;u>0||o>0&&i;)0!==u&&(0===o||!i||n.z<=i.z)?(r=n,n=n.nextZ,u--):(r=i,i=i.nextZ,o--),e?e.nextZ=r:A=r,r.prevZ=e,e=r;n=i}e.nextZ=null,h*=2}while(s>1)}(r)}(A,i,r,e);for(var u,o,h=A;A.prev!==A.next;)if(u=A.prev,o=A.next,e?uA(A,i,r,e):sA(A))t.push(u.i/n|0),t.push(A.i/n|0),t.push(o.i/n|0),xA(A),A=o.next,h=o.next;else if((A=o)===h){s?1===s?eA(A=oA(rA(A),t,n),t,n,i,r,e,2):2===s&&hA(A,t,n,i,r,e):eA(rA(A),t,n,i,r,e,1);break}}}function sA(A){var t=A.prev,n=A,i=A.next;if(gA(t,n,i)>=0)return!1;for(var r=t.x,e=n.x,s=i.x,u=t.y,o=n.y,h=i.y,f=r<e?r<s?r:s:e<s?e:s,c=u<o?u<h?u:h:o<h?o:h,a=r>e?r>s?r:s:e>s?e:s,v=u>o?u>h?u:h:o>h?o:h,l=i.next;l!==t;){if(l.x>=f&&l.x<=a&&l.y>=c&&l.y<=v&&wA(r,u,e,o,s,h,l.x,l.y)&&gA(l.prev,l,l.next)>=0)return!1;l=l.next}return!0}function uA(A,t,n,i){var r=A.prev,e=A,s=A.next;if(gA(r,e,s)>=0)return!1;for(var u=r.x,o=e.x,h=s.x,f=r.y,c=e.y,a=s.y,v=u<o?u<h?u:h:o<h?o:h,l=f<c?f<a?f:a:c<a?c:a,w=u>o?u>h?u:h:o>h?o:h,P=f>c?f>a?f:a:c>a?c:a,g=vA(v,l,t,n,i),C=vA(w,P,t,n,i),D=A.prevZ,I=A.nextZ;D&&D.z>=g&&I&&I.z<=C;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&wA(u,f,o,c,h,a,D.x,D.y)&&gA(D.prev,D,D.next)>=0)return!1;if(D=D.prevZ,I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&wA(u,f,o,c,h,a,I.x,I.y)&&gA(I.prev,I,I.next)>=0)return!1;I=I.nextZ}for(;D&&D.z>=g;){if(D.x>=v&&D.x<=w&&D.y>=l&&D.y<=P&&D!==r&&D!==s&&wA(u,f,o,c,h,a,D.x,D.y)&&gA(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;I&&I.z<=C;){if(I.x>=v&&I.x<=w&&I.y>=l&&I.y<=P&&I!==r&&I!==s&&wA(u,f,o,c,h,a,I.x,I.y)&&gA(I.prev,I,I.next)>=0)return!1;I=I.nextZ}return!0}function oA(A,t,n){var i=A;do{var r=i.prev,e=i.next.next;!CA(r,e)&&DA(r,i,i.next,e)&&bA(r,e)&&bA(e,r)&&(t.push(r.i/n|0),t.push(i.i/n|0),t.push(e.i/n|0),xA(i),xA(i.next),i=A=e),i=i.next}while(i!==A);return rA(i)}function hA(A,t,n,i,r,e){var s=A;do{for(var u=s.next.next;u!==s.prev;){if(s.i!==u.i&&PA(s,u)){var o=zA(s,u);return s=rA(s,s.next),o=rA(o,o.next),eA(s,t,n,i,r,e,0),void eA(o,t,n,i,r,e,0)}u=u.next}s=s.next}while(s!==A)}function fA(A,t){return A.x-t.x}function cA(A,t){var n=function(A,t){var n,i=t,r=A.x,e=A.y,s=-1/0;do{if(e<=i.y&&e>=i.next.y&&i.next.y!==i.y){var u=i.x+(e-i.y)*(i.next.x-i.x)/(i.next.y-i.y);if(u<=r&&u>s&&(s=u,n=i.x<i.next.x?i:i.next,u===r))return n}i=i.next}while(i!==t);if(!n)return null;var o,h=n,f=n.x,c=n.y,a=1/0;i=n;do{r>=i.x&&i.x>=f&&r!==i.x&&wA(e<c?r:s,e,f,c,e<c?s:r,e,i.x,i.y)&&(o=Math.abs(e-i.y)/(r-i.x),bA(i,A)&&(o<a||o===a&&(i.x>n.x||i.x===n.x&&aA(n,i)))&&(n=i,a=o)),i=i.next}while(i!==h);return n}(A,t);if(!n)return t;var i=zA(n,A);return rA(i,i.next),rA(n,n.next)}function aA(A,t){return gA(A.prev,A,t.prev)<0&&gA(t.next,A,A.next)<0}function vA(A,t,n,i,r){return(A=1431655765&((A=858993459&((A=252645135&((A=16711935&((A=(A-n)*r|0)|A<<8))|A<<4))|A<<2))|A<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-i)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function lA(A){var t=A,n=A;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==A);return n}function wA(A,t,n,i,r,e,s,u){return(r-s)*(t-u)>=(A-s)*(e-u)&&(A-s)*(i-u)>=(n-s)*(t-u)&&(n-s)*(e-u)>=(r-s)*(i-u)}function PA(A,t){return A.next.i!==t.i&&A.prev.i!==t.i&&!function(A,t){var n=A;do{if(n.i!==A.i&&n.next.i!==A.i&&n.i!==t.i&&n.next.i!==t.i&&DA(n,n.next,A,t))return!0;n=n.next}while(n!==A);return!1}(A,t)&&(bA(A,t)&&bA(t,A)&&function(A,t){var n=A,i=!1,r=(A.x+t.x)/2,e=(A.y+t.y)/2;do{n.y>e!=n.next.y>e&&n.next.y!==n.y&&r<(n.next.x-n.x)*(e-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==A);return i}(A,t)&&(gA(A.prev,A,t.prev)||gA(A,t.prev,t))||CA(A,t)&&gA(A.prev,A,A.next)>0&&gA(t.prev,t,t.next)>0)}function gA(A,t,n){return(t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y)}function CA(A,t){return A.x===t.x&&A.y===t.y}function DA(A,t,n,i){var r=MA(gA(A,t,n)),e=MA(gA(A,t,i)),s=MA(gA(n,i,A)),u=MA(gA(n,i,t));return r!==e&&s!==u||!(0!==r||!IA(A,n,t))||!(0!==e||!IA(A,i,t))||!(0!==s||!IA(n,A,i))||!(0!==u||!IA(n,t,i))}function IA(A,t,n){return t.x<=Math.max(A.x,n.x)&&t.x>=Math.min(A.x,n.x)&&t.y<=Math.max(A.y,n.y)&&t.y>=Math.min(A.y,n.y)}function MA(A){return A>0?1:A<0?-1:0}function bA(A,t){return gA(A.prev,A,A.next)<0?gA(A,t,A.next)>=0&&gA(A,A.prev,t)>=0:gA(A,t,A.prev)<0||gA(A,A.next,t)<0}function zA(A,t){var n=new mA(A.i,A.x,A.y),i=new mA(t.i,t.x,t.y),r=A.next,e=t.prev;return A.next=t,t.prev=A,n.next=r,r.prev=n,i.next=n,n.prev=i,e.next=i,i.prev=e,i}function dA(A,t,n,i){var r=new mA(A,t,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function xA(A){A.next.prev=A.prev,A.prev.next=A.next,A.prevZ&&(A.prevZ.nextZ=A.nextZ),A.nextZ&&(A.nextZ.prevZ=A.prevZ)}function mA(A,t,n){this.i=A,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function yA(A,t,n,i){for(var r=0,e=t,s=n-i;e<n;e+=i)r+=(A[s]-A[e])*(A[e+1]+A[s+1]),s=e;return r}tA.exports=nA,tA.exports.default=nA,nA.deviation=function(A,t,n,i){var r=t&&t.length,s=Math.abs(yA(A,0,r?t[0]*n:A.length,n));if(r)for(var u=0,o=t.length;u<o;u++){s-=Math.abs(yA(A,t[u]*n,u<o-1?t[u+1]*n:A.length,n))}var c=0;for(u=0;u<i.length;u+=3){var a=i[u]*n,v=i[u+1]*n,l=i[u+2]*n;c+=Math.abs((A[a]-A[l])*(A[v+1]-A[a+1])-(A[a]-A[v])*(A[l+1]-A[a+1]))}return 0===s&&0===c?0:Math.abs((c-s)/s)},nA.flatten=function(A){for(var t=A[0][0].length,n={vertices:[],holes:[],dimensions:t},i=0,r=0;r<A.length;r++){for(var e=0;e<A[r].length;e++)for(var s=0;s<t;s++)n.vertices.push(A[r][e][s]);r>0&&n.holes.push(i+=A[r-1].length)}return n};var pA=tA.exports;class LA extends(t$1.Eventable(t$1.Handlerable(t$1.Class))){constructor(A){super(A),this.N=!0}addTo(A){return A.getMap()?(this.layer=A,this.j()):A.once("add",(()=>{this.addTo(A)}),this),this}j(){const A=this.layer.getRenderer();A?(this.regl=A.regl,this.S(A)):this.layer.once("renderercreate",(A=>{this.regl=A.renderer.regl,this.S(A.renderer)}),this)}enable(){this.N=!0;const A=this.layer.getRenderer();A&&A.setToRedraw()}disable(){this.N=!1;const A=this.layer.getRenderer();A&&A.setToRedraw()}isEnable(){return this.N}remove(){if(this.layer){const A=this.layer;delete this.layer,A.removeAnalysis(this),this.k&&(this.k.dispose(),delete this.k),this.B&&(this.B.dispose(),delete this.B),this.R&&(this.R.forEach((A=>{A.geometry.dispose(),A.dispose()})),delete this.R),this.G&&(this.G.dispose(),delete this.G)}}update(A,t){this.options[A]=t;const n=this.layer.getRenderer();n&&n.setToRedraw()}getExcludeLayers(){return this.options.excludeLayers||[]}setExcludeLayers(A){this.options.excludeLayers=A}exportAnalysisMap(A){if(!this.isEnable())return null;let t=this.k.render(A,this.q);t=t.meshesMap?t.meshesMap:t;const n=this.layer.getRenderer();if(t&&n){const A=n.regl,i=t.width,r=t.height,e=new Uint8Array(4*i*r);return A.read({data:e,x:0,y:0,framebuffer:t,width:i,height:r}),e}return null}getAnalysisType(){return this.type}V(A){const t=new t$1.Polygon(A,{symbol:{polygonOpacity:.2}}).getExtent();return this.W(t,A)}W(n,i){const r=this.layer.getMap(),e=r.getCenter(),s=r.getZoom(),u=r.getPitch(),o=r.getBearing(),h=r.getFitZoom(n),f=n.getCenter();r.setZoom(h),r.setCenter(f),r.setPitch(0),r.setBearing(0);const c=r.getExtent();this._=this._||[],copy$5(this._,r.projViewMatrix);const a=AA(r,c.xmin,c.ymin),v=AA(r,c.xmax,c.ymax),l=[a[0],a[1],v[0],v[1]],w=AA(r,n.xmin,n.ymin),P=AA(r,n.xmax,n.ymax),g=[w[0],w[1],P[0],P[1]];if(r.setZoom(s),r.setCenter(e),r.setPitch(u),r.setBearing(o),this.R=this.K(i,f),!this.B){const t=new B$6(this.regl);this.B=new Z(t,this.u)}return{extentMap:this.B.render(this.R,this._),extentInWorld:l,extentPolygon:g}}K(i,r){const e=[],s=this.layer.getMap(),u=AA(s,r.x,r.y,0);for(let A=0;A<i.length;A++){const t=AA(s,...i[A]);e.push(t[0]-u[0]),e.push(t[1]-u[1]),e.push(0)}const o=pA(e,null,3);this.R&&(this.R[0].geometry.dispose(),this.R[0].dispose());const h=new Q$7({POSITION:e},o,0,{positionAttribute:"POSITION"}),f=new Be$5(h),c=fromRotationTranslationScale([],identity$1([]),u,[1,1,1]);return f.localTransform=c,this.R=[f],this.R}}var TA="attribute vec3 aPosition;\n\nattribute vec2 aTexCoord;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    v_texCoord = aTexCoord;\n\n}\n\n",OA="#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform sampler2D meshesMap;\n\nvarying vec4 cut_positionFromViewpoint;\n\nvarying vec2 v_texCoord;\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        #ifdef HAS_HELPERPARTS\n\n          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);\n\n        #else\n\n          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        #endif\n\n        vec2 v = v_texCoord;\n\n    }\n\n}\n\n";const FA={helper:{asset:{generator:"Khronos glTF Blender I/O v1.6.16",version:"2.0"},scene:0,scenes:[{name:"Scene",nodes:[0,1,2,3,4,5,6,7]}],nodes:[{mesh:0,name:"2",scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,0,-9.680065155029297]},{mesh:1,name:"3",rotation:[1,0,0,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[-8.534053802490234,.04612281173467636,9.669971466064453]},{mesh:2,name:"1",rotation:[0,0,-1,-4.371138828673793e-8],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,.028526417911052704,-9.667880058288574]},{mesh:3,name:"4",rotation:[0,-1,0,1910685676922942e-30],scale:[1.365131139755249,1.365131139755249,.21621514856815338],translation:[8.530546188354492,0,9.639498710632324]},{mesh:4,name:"X",translation:[.008500291034579277,0,11.816417694091797]},{mesh:5,name:"",scale:[9.5003657913208,9.5003657913208,9.5003657913208]},{mesh:6,name:"Y",rotation:[.5384660959243774,.45831674337387085,-.45831674337387085,-.5384663343429565],translation:[11.712308883666992,0,.32547950744628906]},{mesh:7,name:"Z",scale:[.49277400970458984,.41999998688697815,.49277400970458984],translation:[.0035659661516547203,1.6771862506866455,-11.201739311218262]}],materials:[{doubleSided:!0,name:".015",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".014",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".016",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".013",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".009",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".017",pbrMetallicRoughness:{baseColorFactor:[0,.2746773362159729,.6795424818992615,.800000011920929],metallicFactor:0,roughnessFactor:.5}},{alphaMode:"BLEND",name:"Color_H04.006",pbrMetallicRoughness:{metallicFactor:0,roughnessFactor:.6000000238418579}},{doubleSided:!0,name:".023",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".022",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}},{doubleSided:!0,name:".021",pbrMetallicRoughness:{baseColorFactor:[.010960042476654053,.25818300247192383,.7991030216217041,1],metallicFactor:0,roughnessFactor:.5}}],meshes:[{name:".009",primitives:[{attributes:{POSITION:0,NORMAL:1,TEXCOORD_0:2},indices:3,material:0}]},{name:".010",primitives:[{attributes:{POSITION:4,NORMAL:5,TEXCOORD_0:6},indices:3,material:1}]},{name:".011",primitives:[{attributes:{POSITION:7,NORMAL:8,TEXCOORD_0:9},indices:3,material:2}]},{name:".012",primitives:[{attributes:{POSITION:10,NORMAL:11,TEXCOORD_0:12},indices:3,material:3}]},{name:".004",primitives:[{attributes:{POSITION:13,NORMAL:14,TEXCOORD_0:15},indices:16,material:4},{attributes:{POSITION:17,NORMAL:18,TEXCOORD_0:19},indices:20,material:5}]},{name:".015",primitives:[{attributes:{POSITION:21,NORMAL:22,TEXCOORD_0:23},indices:24}]},{name:".008",primitives:[{attributes:{POSITION:25,NORMAL:26,TEXCOORD_0:27},indices:16,material:6},{attributes:{POSITION:28,NORMAL:29,TEXCOORD_0:30},indices:20,material:7}]},{name:".011",primitives:[{attributes:{POSITION:31,NORMAL:32,TEXCOORD_0:33},indices:34,material:8},{attributes:{POSITION:35,NORMAL:36,TEXCOORD_0:37},indices:38,material:9},{attributes:{POSITION:39,NORMAL:40,TEXCOORD_0:41},indices:42,material:10}]}],accessors:[{bufferView:0,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:1,componentType:5126,count:68,type:"VEC3"},{bufferView:2,componentType:5126,count:68,type:"VEC2"},{bufferView:3,componentType:5123,count:144,type:"SCALAR"},{bufferView:4,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:5,componentType:5126,count:68,type:"VEC3"},{bufferView:6,componentType:5126,count:68,type:"VEC2"},{bufferView:7,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:8,componentType:5126,count:68,type:"VEC3"},{bufferView:9,componentType:5126,count:68,type:"VEC2"},{bufferView:10,componentType:5126,count:68,max:[1,.08513133227825165,11.627518653869629],min:[-1,0,-1.0000085830688477],type:"VEC3"},{bufferView:11,componentType:5126,count:68,type:"VEC3"},{bufferView:12,componentType:5126,count:68,type:"VEC2"},{bufferView:13,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:14,componentType:5126,count:32,type:"VEC3"},{bufferView:15,componentType:5126,count:32,type:"VEC2"},{bufferView:16,componentType:5123,count:90,type:"SCALAR"},{bufferView:17,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:18,componentType:5126,count:745,type:"VEC3"},{bufferView:19,componentType:5126,count:745,type:"VEC2"},{bufferView:20,componentType:5123,count:1053,type:"SCALAR"},{bufferView:21,componentType:5126,count:4,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:22,componentType:5126,count:4,type:"VEC3"},{bufferView:23,componentType:5126,count:4,type:"VEC2"},{bufferView:24,componentType:5123,count:6,type:"SCALAR"},{bufferView:25,componentType:5126,count:32,max:[1,0,1],min:[-1,0,-1],type:"VEC3"},{bufferView:26,componentType:5126,count:32,type:"VEC3"},{bufferView:27,componentType:5126,count:32,type:"VEC2"},{bufferView:28,componentType:5126,count:745,max:[.7661519646644592,.011582847684621811,.664243221282959],min:[-.7468101978302002,-.015204675495624542,-.6202079057693481],type:"VEC3"},{bufferView:29,componentType:5126,count:745,type:"VEC3"},{bufferView:30,componentType:5126,count:745,type:"VEC2"},{bufferView:31,componentType:5126,count:16,max:[1,1,1],min:[-1,-1,-1],type:"VEC3"},{bufferView:32,componentType:5126,count:16,type:"VEC3"},{bufferView:33,componentType:5126,count:16,type:"VEC2"},{bufferView:34,componentType:5123,count:18,type:"SCALAR"},{bufferView:35,componentType:5126,count:16,max:[1.0000004768371582,-6.847862720489502,1.0000038146972656],min:[-.999999463558197,-8.847862243652344,-.9999960660934448],type:"VEC3"},{bufferView:36,componentType:5126,count:16,type:"VEC3"},{bufferView:37,componentType:5126,count:16,type:"VEC2"},{bufferView:38,componentType:5123,count:18,type:"SCALAR"},{bufferView:39,componentType:5126,count:24,max:[.23352710902690887,-.6051979064941406,.20581023395061493],min:[-.16755716502666473,-7.437830924987793,-.19527404010295868],type:"VEC3"},{bufferView:40,componentType:5126,count:24,type:"VEC3"},{bufferView:41,componentType:5126,count:24,type:"VEC2"},{bufferView:42,componentType:5123,count:36,type:"SCALAR"}],bufferViews:[{buffer:0,byteLength:816,byteOffset:0},{buffer:0,byteLength:816,byteOffset:816},{buffer:0,byteLength:544,byteOffset:1632},{buffer:0,byteLength:288,byteOffset:2176},{buffer:0,byteLength:816,byteOffset:2464},{buffer:0,byteLength:816,byteOffset:3280},{buffer:0,byteLength:544,byteOffset:4096},{buffer:0,byteLength:816,byteOffset:4640},{buffer:0,byteLength:816,byteOffset:5456},{buffer:0,byteLength:544,byteOffset:6272},{buffer:0,byteLength:816,byteOffset:6816},{buffer:0,byteLength:816,byteOffset:7632},{buffer:0,byteLength:544,byteOffset:8448},{buffer:0,byteLength:384,byteOffset:8992},{buffer:0,byteLength:384,byteOffset:9376},{buffer:0,byteLength:256,byteOffset:9760},{buffer:0,byteLength:180,byteOffset:10016},{buffer:0,byteLength:8940,byteOffset:10196},{buffer:0,byteLength:8940,byteOffset:19136},{buffer:0,byteLength:5960,byteOffset:28076},{buffer:0,byteLength:2106,byteOffset:34036},{buffer:0,byteLength:48,byteOffset:36144},{buffer:0,byteLength:48,byteOffset:36192},{buffer:0,byteLength:32,byteOffset:36240},{buffer:0,byteLength:12,byteOffset:36272},{buffer:0,byteLength:384,byteOffset:36284},{buffer:0,byteLength:384,byteOffset:36668},{buffer:0,byteLength:256,byteOffset:37052},{buffer:0,byteLength:8940,byteOffset:37308},{buffer:0,byteLength:8940,byteOffset:46248},{buffer:0,byteLength:5960,byteOffset:55188},{buffer:0,byteLength:192,byteOffset:61148},{buffer:0,byteLength:192,byteOffset:61340},{buffer:0,byteLength:128,byteOffset:61532},{buffer:0,byteLength:36,byteOffset:61660},{buffer:0,byteLength:192,byteOffset:61696},{buffer:0,byteLength:192,byteOffset:61888},{buffer:0,byteLength:128,byteOffset:62080},{buffer:0,byteLength:36,byteOffset:62208},{buffer:0,byteLength:288,byteOffset:62244},{buffer:0,byteLength:288,byteOffset:62532},{buffer:0,byteLength:192,byteOffset:62820},{buffer:0,byteLength:72,byteOffset:63012}],buffers:[{byteLength:63084,uri:"data:application/octet-stream;base64,AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAABAAGAAAABgACAAgADAAOAAgADgAKABMAEAAiABMAIgAqAB8AFgAuAB8ALgA3AA0ACQAZAA0AGQAVAAMABwATAAMAEwASAAUAAQARAAUAEQAQAA8ADQAVAA8AFQAeAAkACwAcAAkAHAAZAAcABQAQAAcAEAATAAEAAwASAAEAEgARAAsADwAeAAsAHgAcACgAKwBDACgAQwBAABEAEgAnABEAJwAlABIAEwAqABIAKgAnABAAEQAlABAAJQAiADEANAA2ADEANgAtAD0APwBCAD0AQgA6ACAAIwA7ACAAOwA4ABcAGgAyABcAMgAvACkAIQA5ACkAOQBBACQAJgA+ACQAPgA8ABsAHQA1ABsANQAzABQAGAAwABQAMAAsAAAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAvxrkLr9hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9T7f79hBAg7SACAv9b7f79hBAg7UQo6Qdb7f79hBAg7UQo6Qdb7f79hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QRzkLr9hBAg7UQo6QQAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAvwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgL8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAPwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvwAAgD8AAAAAAACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAvxrkLr9WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9T7f79WWa49SACAv9b7f79WWa49UQo6Qdb7f79WWa49UQo6Qdb7f79WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QRzkLr9WWa49UQo6QQAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAvwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgL8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAPwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAgD8zGao9AACAvwAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIC/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAOhd0sgAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAOhd0sgAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAOhf0MQAAgL8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgL8AAAAAAAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAAAAAACAvwAAAAAAAIA/AAAAgAAAgD8AAAAAAAAAgAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEa5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8c5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL8a5C6/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/U+3+/YQQIO0gAgL/W+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkHW+3+/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEc5C6/YQQIO1EKOkEAAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgL8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIC/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgD8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8AAIA/AAAAAAAAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL8a5C6/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/U+3+/VlmuPUgAgL/W+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkHW+3+/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEc5C6/VlmuPVEKOkEAAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgL8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIC/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgD8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAIA/MxmqPQAAgL8AAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAvwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAADoXdLIAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAADoXdLIAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAADoX9DEAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIC/AAAAAAAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAAAAAAAAgL8AAAAAAACAPwAAAIAAAIA/AAAAAAAAAIAAAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBGuQuv2EECDtIAIC/GuQuv2EECDtIAIC/HOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/GuQuv2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1Pt/v2EECDtIAIC/1vt/v2EECDtRCjpB1vt/v2EECDtRCjpB1vt/v2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBHOQuv2EECDtRCjpBAACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIC/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIA/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/AACAPwAAAAAAAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/GuQuv1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1Pt/v1ZZrj1IAIC/1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpB1vt/v1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBHOQuv1ZZrj1RCjpBAACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIC/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAvzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIA/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AACAPzMZqj0AAIC/AAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAA6F3SyAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAA6F3SyAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAA6F/QxAACAvwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAvwAAAAAAAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAAAAAAIC/AAAAAAAAgD8AAACAAACAPwAAAAAAAACAAAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAAAAAAAAAAAAAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAIA/AAAAAAAAgD8AAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAgD8AAAAAAACAPwAAAAAAAAAAAAAAAAAAAAAAAIA/AACAPwAAgD8AAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAgD8AAIA/AACAPwAAgD8AAIA/AACAPwAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAAAAAAAAAAACAv8LFR74AAAAAvhR7vxbvw74AAAAAXoNsv9o5Dr8AAAAAMdtUv/MENb8AAAAA8wQ1vzHbVL8AAAAA2jkOv16DbL8AAAAAFe/Dvr4Ue78AAAAAxMVHvgAAgL8AAAAALr07M74Ue78AAAAAwsVHPl+DbL8AAAAAFO/DPjLbVL8AAAAA2TkOP/MENb8AAAAA8wQ1P9k5Dr8AAAAAMttUPxfvw74AAAAAXoNsP8HFR74AAAAAvxR7Py69uzMAAAAAAACAP73FRz4AAAAAvxR7PxXvwz4AAAAAXoNsP9s5Dj8AAAAAMNtUP/IENT8AAAAA9AQ1Py/bVD8AAAAA3TkOP16DbD8AAAAAGu/DPr4Uez8AAAAAxsVHPgAAgD8AAAAALt5Msr4Uez8AAAAAyMVHvl2DbD8AAAAAG+/DvjPbVD8AAAAA1zkOv/UENT8AAAAA8gQ1v9s5Dj8AAAAAMdtUvxXvwz4AAAAAX4Nsv7zFRz4AAAAAvxR7vwAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAgAAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAEAAgACAAMABAAEAAUABgAGAAcACAAIAAkACgAKAAsADAAMAA0ADgAOAA8AEAAQABEAEgASABMAFAAUABUAFgAWABcAGAAYABkAGgAaABsAHAAcAB0AHgAeAB8AAAAAAAIABAAEAAYACAAIAAoADAAMAA4AEAAQABIAFAAUABYAGAAYABoAHAAcAB4AAAAAAAQACAAIAAwAEAAQABQAGAAYABwAAAAAAAgAEAAQABgAAAAcfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8cfF8+4Bx5vDz+Fb8McFu+mRx5vOP/r74McFu+mRx5vOP/r74McFu+mRx5vOP/r74Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G78Uxg8+2Bx5vOJ5G7/osCq+oRx5vN/bvL7osCq+oRx5vN/bvL7INe69qBx5vOSPxr7INe69qBx5vOSPxr7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7Q/IK9sBx5vL30zL7K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr/K6JU+5xx5vEYODr8APSu8txx5vJ3wz74APSu8txx5vJ3wz77QnjE9vRx5vHt3z77QnjE9vRx5vHt3z7746sU9wxx5vDOLy7746sU9wxx5vDOLy7746sU9wxx5vDOLy74Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA78Wybk+7Rx5vAjKA7+MGRg+yBx5vLA7xL6MGRg+yBx5vLA7xL40/Uo+zRx5vGimub40/Uo+zRx5vGimub40/Uo+zRx5vGimub4izto+8Rx5vOq17r4izto+8Rx5vOq17r4izto+8Rx5vOq17r7U0no+0Rx5vA72q77U0no+0Rx5vA72q77U0no+0Rx5vA72q76qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b6qcvg+9Bx5vIbm0b7SbJM+1Bx5vPdhm77SbJM+1Bx5vPdhm77WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL7WL6c+1Rx5vAYtiL59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb59Hwk/9Rx5vDiasb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb66Yrg+1hx5vJhJZb5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr5x5RM/9Rx5vFZTjr6yasU+1hx5vCieOr6yasU+1hx5vCieOr6yasU+1hx5vCieOr4+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRzs+dd8+zhx5vABTRztGxYA+xRx5vOoPLL69LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/1Bx5vDBIyT3AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/AWYK+pRx5vGN2EL/Zw8i+jRx5vKrq9b7Zw8i+jRx5vKrq9b4k6aa+mRx5vGTRBr8tYee+ghx5vDUk2r4tYee+ghx5vDUk2r4tYee+ghx5vDUk2r6UUje+sBx5vGO9F7+UUje+sBx5vGO9F7+UUje+sBx5vGO9F7/EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur7EIgG/dxx5vIu/ur6oz829uxx5vAaJHL+oz829uxx5vAaJHL+oz829uxx5vAaJHL8qggy/bBx5vGs7mL4qggy/bBx5vGs7mL4qggy/bBx5vGs7mL7AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/AvqW8xhx5vPLFHr/goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr7goBW/Yxx5vFxGZr5QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr9QxXc90Bx5vBVrHr8WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL7aSYS+kRx5vM4voL6+spi+ihx5vH6rjb6+spi+ihx5vH6rjb5KoKq+ghx5vHN7cb5KoKq+ghx5vHN7cb4qyrm+exx5vPJ1Q74qyrm+exx5vPJ1Q74c88W+dRx5vE0AEr4c88W+dRx5vE0AEr4O6s6+bxx5vFTEu71x5RM/MMU9PFZTjr69LRw/9Bx5vEj9Ur5x5RM/9Rx5vFZTjr69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY769LRw/9Bx5vEj9Ur69LRw/9Bx5vEj9Ur69LRw/MsU9PEj9Ur6JIkQ/CB15vAzvY76JIkQ/CB15vAzvY76JIkQ/CB15vAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/1Bx5vDBIyT2JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0zFgo/UsU9PDBIyT0+dd8+zhx5vABTRzs+dd8+zhx5vABTRzszFgo/1Bx5vDBIyT1GxYA+xRx5vOoPLL5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL5GxYA+YsU9POoPLL4+dd8+WMU9PABTRzuyasU+UMU9PCieOr5GxYA+xRx5vOoPLL5GxYA+YsU9POoPLL6yasU+1hx5vCieOr6yasU+UMU9PCieOr66Yrg+1hx5vJhJZb6yasU+1hx5vCieOr66Yrg+UMU9PJhJZb7WL6c+1Rx5vAYtiL7WL6c+UMU9PAYtiL7SbJM+1Bx5vPdhm77SbJM+UsU9PPdhm77U0no+0Rx5vA72q77U0no+VsU9PA72q740/Uo+zRx5vGimub40/Uo+WsU9PGimub6MGRg+yBx5vLA7xL6MGRg+XsU9PLA7xL746sU9wxx5vDOLy7746sU9YsU9PDOLy77QnjE9aMU9PHt3z77QnjE9vRx5vHt3z74APSu8cMU9PJ3wz74APSu8txx5vJ3wz77Q/IK9dsU9PL30zL7Q/IK9sBx5vL30zL7INe69fsU9POSPxr7INe69qBx5vOSPxr7osCq+hsU9PN/bvL7osCq+oRx5vN/bvL4McFu+jsU9POP/r74McFu+mRx5vOP/r77aSYS+lMU9PM4voL7aSYS+kRx5vM4voL6+spi+nMU9PH6rjb6+spi+ihx5vH6rjb5KoKq+pMU9PHN7cb5KoKq+ghx5vHN7cb4qyrm+qsU9PPJ1Q74qyrm+exx5vPJ1Q74c88W+ssU9PE0AEr4c88W+dRx5vE0AEr4O6s6+uMU9PFTEu70O6s6+bxx5vFTEu70O6s6+uMU9PFTEu70O6s6+uMU9PFTEu70WWhy/WRx5vCkZGL4WWhy/WRx5vCkZGL4O6s6+bxx5vFTEu70WWhy/zMU9PCkZGL7goBW/xMU9PFxGZr4WWhy/WRx5vCkZGL4WWhy/zMU9PCkZGL7goBW/Yxx5vFxGZr4qggy/usU9PGs7mL4qggy/bBx5vGs7mL7EIgG/sMU9PIu/ur7EIgG/dxx5vIu/ur4tYee+pMU9PDUk2r4tYee+ghx5vDUk2r7Zw8i+mMU9PKrq9b7Zw8i+jRx5vKrq9b4k6aa+jMU9PGTRBr8k6aa+mRx5vGTRBr/AWYK+gsU9PGN2EL/AWYK+pRx5vGN2EL+UUje+dsU9PGO9F7+UUje+sBx5vGO9F7+oz829asU9PAaJHL+oz829uxx5vAaJHL/AvqW8YMU9PPLFHr/AvqW8xhx5vPLFHr9QxXc9VsU9PBVrHr9QxXc90Bx5vBVrHr8Uxg8+TsU9POJ5G78Uxg8+2Bx5vOJ5G78cfF8+4Bx5vDz+Fb8cfF8+RsU9PDz+Fb/K6JU+5xx5vEYODr/K6JU+PsU9PEYODr8Wybk+7Rx5vAjKA78Wybk+OsU9PAjKA78izto+8Rx5vOq17r4izto+NsU9POq17r6qcvg+9Bx5vIbm0b6qcvg+MsU9PIbm0b59Hwk/9Rx5vDiasb59Hwk/MMU9PDiasb7Zw8i+mMU9PKrq9b7Zw8i+mMU9PKrq9b7AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL/AWYK+gsU9PGN2EL8k6aa+jMU9PGTRBr8tYee+pMU9PDUk2r4tYee+pMU9PDUk2r4tYee+pMU9PDUk2r6UUje+dsU9PGO9F7+UUje+dsU9PGO9F7+UUje+dsU9PGO9F7/EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur7EIgG/sMU9PIu/ur6oz829asU9PAaJHL+oz829asU9PAaJHL+oz829asU9PAaJHL8qggy/usU9PGs7mL4qggy/usU9PGs7mL4qggy/usU9PGs7mL7AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/AvqW8YMU9PPLFHr/goBW/xMU9PFxGZr7goBW/xMU9PFxGZr7goBW/xMU9PFxGZr5QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr9QxXc9VsU9PBVrHr8WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4WWhy/zMU9PCkZGL4Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G78Uxg8+TsU9POJ5G7/aSYS+lMU9PM4voL7aSYS+lMU9PM4voL7aSYS+lMU9PM4voL6+spi+nMU9PH6rjb6+spi+nMU9PH6rjb5KoKq+pMU9PHN7cb5KoKq+pMU9PHN7cb4qyrm+qsU9PPJ1Q74qyrm+qsU9PPJ1Q74c88W+ssU9PE0AEr4c88W+ssU9PE0AEr4O6s6+uMU9PFTEu70McFu+jsU9POP/r74McFu+jsU9POP/r74McFu+jsU9POP/r74+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzs+dd8+WMU9PABTRzuyasU+UMU9PCieOr6yasU+UMU9PCieOr6yasU+UMU9PCieOr5GxYA+YsU9POoPLL5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr5x5RM/MMU9PFZTjr69LRw/MsU9PEj9Ur69LRw/MsU9PEj9Ur6JIkQ/HsU9PAzvY76JIkQ/HsU9PAzvY74zFgo/UsU9PDBIyT0cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb8cfF8+RsU9PDz+Fb/osCq+hsU9PN/bvL7osCq+hsU9PN/bvL7INe69fsU9POSPxr7INe69fsU9POSPxr7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7Q/IK9dsU9PL30zL7K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr/K6JU+PsU9PEYODr8APSu8cMU9PJ3wz74APSu8cMU9PJ3wz77QnjE9aMU9PHt3z77QnjE9aMU9PHt3z7746sU9YsU9PDOLy7746sU9YsU9PDOLy7746sU9YsU9PDOLy74Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA78Wybk+OsU9PAjKA7+MGRg+XsU9PLA7xL6MGRg+XsU9PLA7xL40/Uo+WsU9PGimub40/Uo+WsU9PGimub40/Uo+WsU9PGimub4izto+NsU9POq17r4izto+NsU9POq17r4izto+NsU9POq17r7U0no+VsU9PA72q77U0no+VsU9PA72q77U0no+VsU9PA72q76qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b6qcvg+MsU9PIbm0b7SbJM+UsU9PPdhm77SbJM+UsU9PPdhm77WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL7WL6c+UMU9PAYtiL59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb59Hwk/MMU9PDiasb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb66Yrg+UMU9PJhJZb4JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD4FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+bRx5vA4gWD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD5yeRe/Phx5vIU3gD6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz6mNry+Wxx5vPBLZz5HOw+/PBx5vCrfpD5HOw+/PBx5vCrfpD5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT56R88+vRx5vOgXPz56R88+vRx5vOgXPz5qPtg+wxx5vLz5Cj6KHsM+thx5vI6NcD6KHsM+thx5vI6NcD6q9LM+rxx5vIhJjz6q9LM+rxx5vIhJjz4aB6I+qBx5vFA3pD4aB6I+qBx5vFA3pD42no0+oBx5vJ67tj42no0+oBx5vJ67tj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj68GG4+mBx5vLCLxj7oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj/oOvq9WRx5vMe/Jj9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT9wIi29Yhx5vP6wKT8LSxo/zxx5vACviT4LSxo/zxx5vACviT4LSxo/zxx5vACviT5Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9Qgh09axx5vNgLKj9dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj5dLBE/xRx5vDzHrj74IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/4IPM9dhx5vPLOJz/rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T7rzAU/uhx5vFxL0T40+0k+gRx5vEwDIz80+0k+gRx5vEwDIz80+0k+gRx5vEwDIz+KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D6KtfA+rxx5vPyv8D4eros+jBx5vE68Gz8eros+jBx5vE68Gz8eros+jBx5vE68Gz8yGNI+pBx5vD47Bj8yGNI+pBx5vD47Bj+CPbA+mBx5vEwXEj9OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5OdQS/PBx5vAomyD5eDq++Wxx5vKAwiT5eDq++Wxx5vKAwiT5+252+XBx5vNe4nj5+252+XBx5vNe4nj5+252+XBx5vNe4nj5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D5MHu++PRx5vF5y6D52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT52GIq+Xhx5vMrtsT7KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj/KedG+QBx5vNygAj8kKmi+YRx5vOSBwj4kKmi+YRx5vOSBwj5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D5sVDi+ZBx5vDQy0D62dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz+2dLC+RBx5vO4PDz/UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j7UcAW+aRx5vH7H2j5mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT9mlIy+Shx5vC1UGT+omaC9bhx5vAgX4j6omaC9bhx5vAgX4j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g9828dBx5vFAD5j5g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT9g00y+URx5vChEIT/g4+o8exx5vGh85j7g4+o8exx5vGh85j5ITqg9ghx5vJSA4z5ITqg9ghx5vJSA4z6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6kwwk+iRx5vLwb3T6UWT0+kRx5vKxn0z6UWT0+kRx5vKxn0z787m2+bRx5vA4gWD787m2+bRx5vA4gWD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+Wxx5vPBLZz787m2+usU9PA4gWD6mNry+zMU9PPBLZz5eDq++Wxx5vKAwiT6mNry+Wxx5vPBLZz5eDq++zMU9PKAwiT5+252+XBx5vNe4nj5+252+ysU9PNe4nj52GIq+Xhx5vMrtsT52GIq+yMU9PMrtsT4kKmi+YRx5vOSBwj4kKmi+xsU9POSBwj5sVDi+ZBx5vDQy0D5sVDi+wsU9PDQy0D7UcAW+aRx5vH7H2j7UcAW+vsU9PH7H2j6omaC9bhx5vAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828dBx5vFAD5j7g4+o8rMU9PGh85j7g4+o8exx5vGh85j5ITqg9pMU9PJSA4z5ITqg9ghx5vJSA4z6kwwk+nsU9PLwb3T6kwwk+iRx5vLwb3T6UWT0+lsU9PKxn0z6UWT0+kRx5vKxn0z68GG4+jsU9PLCLxj68GG4+mBx5vLCLxj42no0+hsU9PJ67tj42no0+oBx5vJ67tj4aB6I+fsU9PFA3pD4aB6I+qBx5vFA3pD6q9LM+dsU9PIhJjz6q9LM+rxx5vIhJjz6KHsM+cMU9PI6NcD6KHsM+thx5vI6NcD56R88+asU9POgXPz56R88+vRx5vOgXPz5qPtg+ZMU9PLz5Cj5qPtg+wxx5vLz5Cj5qPtg+ZMU9PLz5Cj5qPtg+ZMU9PLz5Cj5DBCE/2Bx5vLwwRT5DBCE/2Bx5vLwwRT5qPtg+wxx5vLz5Cj5DBCE/TsU9PLwwRT5DBCE/2Bx5vLwwRT4LSxo/WMU9PACviT4LSxo/zxx5vACviT5DBCE/TsU9PLwwRT5dLBE/YsU9PDzHrj5dLBE/xRx5vDzHrj7rzAU/bMU9PFxL0T7rzAU/uhx5vFxL0T6KtfA+dsU9PPyv8D6KtfA+rxx5vPyv8D4yGNI+gsU9PD47Bj8yGNI+pBx5vD47Bj+CPbA+jsU9PEwXEj+CPbA+mBx5vEwXEj8eros+msU9PE68Gz8eros+jBx5vE68Gz80+0k+pMU9PEwDIz80+0k+gRx5vEwDIz/4IPM9sMU9PPLOJz/4IPM9dhx5vPLOJz9Qgh09usU9PNgLKj9Qgh09axx5vNgLKj9wIi29xMU9PP6wKT9wIi29Yhx5vP6wKT/oOvq9zsU9PMe/Jj/oOvq9WRx5vMe/Jj9g00y+URx5vChEIT9g00y+1sU9PChEIT9mlIy+Shx5vC1UGT9mlIy+3MU9PC1UGT+2dLC+RBx5vO4PDz+2dLC+4sU9PO4PDz/KedG+QBx5vNygAj/KedG+5sU9PNygAj9MHu++PRx5vF5y6D5MHu++6MU9PF5y6D5OdQS/PBx5vAomyD5OdQS/6sU9PAomyD5HOw+/PBx5vCrfpD5HOw+/6sU9PCrfpD5yeRe/Phx5vIU3gD5yeRe/6MU9PIU3gD5yeRe/Phx5vIU3gD70Lj+//MU9PKvqiD70Lj+/KRx5vKvqiD5yeRe/6MU9PIU3gD4FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr30Lj+/KRx5vKvqiD70Lj+/KRx5vKvqiD70Lj+//MU9PKvqiD4FbAW/XRx5vKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0FbAW/yMU9PKwxXr0JJda+Yxx5vLwSJT0JJda+Yxx5vLwSJT0FbAW/XRx5vKwxXr387m2+bRx5vA4gWD787m2+bRx5vA4gWD787m2+usU9PA4gWD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD5OdQS/6sU9PAomyD6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz6mNry+zMU9PPBLZz5HOw+/6sU9PCrfpD5HOw+/6sU9PCrfpD5eDq++zMU9PKAwiT5eDq++zMU9PKAwiT5+252+ysU9PNe4nj5+252+ysU9PNe4nj5+252+ysU9PNe4nj5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D5MHu++6MU9PF5y6D52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT52GIq+yMU9PMrtsT7KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj/KedG+5sU9PNygAj8kKmi+xsU9POSBwj4kKmi+xsU9POSBwj5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D5sVDi+wsU9PDQy0D62dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz+2dLC+4sU9PO4PDz/UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j7UcAW+vsU9PH7H2j5mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT9mlIy+3MU9PC1UGT+omaC9uMU9PAgX4j6omaC9uMU9PAgX4j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g9828ssU9PFAD5j5g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT9g00y+1sU9PChEIT/g4+o8rMU9PGh85j7g4+o8rMU9PGh85j5ITqg9pMU9PJSA4z5ITqg9pMU9PJSA4z6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T6kwwk+nsU9PLwb3T7oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj/oOvq9zsU9PMe/Jj+UWT0+lsU9PKxn0z6UWT0+lsU9PKxn0z68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj68GG4+jsU9PLCLxj56R88+asU9POgXPz56R88+asU9POgXPz5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5DBCE/TsU9PLwwRT5qPtg+ZMU9PLz5Cj6KHsM+cMU9PI6NcD6KHsM+cMU9PI6NcD6q9LM+dsU9PIhJjz6q9LM+dsU9PIhJjz4aB6I+fsU9PFA3pD4aB6I+fsU9PFA3pD42no0+hsU9PJ67tj42no0+hsU9PJ67tj5wIi29xMU9PP6wKT9wIi29xMU9PP6wKT9wIi29xMU9PP6wKT8LSxo/WMU9PACviT4LSxo/WMU9PACviT4LSxo/WMU9PACviT5Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9Qgh09usU9PNgLKj9dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj5dLBE/YsU9PDzHrj74IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/4IPM9sMU9PPLOJz/rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T7rzAU/bMU9PFxL0T40+0k+pMU9PEwDIz80+0k+pMU9PEwDIz80+0k+pMU9PEwDIz+KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D6KtfA+dsU9PPyv8D4eros+msU9PE68Gz8eros+msU9PE68Gz8eros+msU9PE68Gz8yGNI+gsU9PD47Bj8yGNI+gsU9PD47Bj+CPbA+jsU9PEwXEj/0Lj+//MU9PKvqiD70Lj+//MU9PKvqiD70Lj+//MU9PKvqiD4JJda+xMU9PLwSJT0JJda+xMU9PLwSJT0FbAW/yMU9PKwxXr387m2+usU9PA4gWD787m2+usU9PA4gWD787m2+usU9PA4gWD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD5yeRe/6MU9PIU3gD4eeCG0AACAvyvyJDPYIA20//9/v/jrjTM+Zwm0AACAvwGvAzRUadWzAACAv2wBkzMAAAAAAACAv1sy8rNUadWzAACAv2wBkzMAAAAAAACAv1sy8rMAAAAAAACAv/sMtrMvygK0//9/v6OQjDMt3tWzAACAv4PItjNUadWzAACAv2wBkzMAAAAAAACAv/sMtrM+Zwm0AACAvwGvAzQAAAAAAACAv1sy8rMeeCG0AACAvyvyJDM+Zwm0AACAvwGvAzQeeCG0AACAvyvyJDPYIA20//9/v/jrjTMeeKGzAACAv1bqjzPYIA20//9/v/jrjTPeWvGzAACAv9ZSuDP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMeeKGzAACAv1bqjzPeWvGzAACAv9ZSuDMGTcqzAACAv3rnlTP9L+6zAACAvyhzjjMGTcqzAACAv3rnlTMGTcqzAACAv46mqzNGxgi0AACAv0PmizOdo/yzAACAv1rInTP9L+6zAACAvyhzjjMGTcqzAACAv46mqzNGxgi0AACAv0PmizMGTcqzAACAv46mqzNexgi0AACAv4iLizNGxgi0AACAv0PmizOdo/yzAACAv1rInTNexgi0AACAv4iLizOdo/yzAACAv1rInTNomu6zAACAv3yUkjP8kR+0AACAv/n0jjNexgi0AACAv4iLizNomu6zAACAv3yUkjP8kR+0AACAv/n0jjPITQK0AACAvzKJojNomu6zAACAv3yUkjPmvK2zAACAvzROtDP8kR+0AACAv/n0jjPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPmvK2zAACAvzROtDPITQK0AACAvzKJojOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzOcTQK0AACAvxVtljPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTOCvc+zAACAvze8kTPSscqzAACAv2EalzMCow+0AACAv80alzPEuQG0AACAvy3imTNklMOz//9/v+eNlzPEuQG0AACAvy3imTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOCvc+zAACAvze8kTNklMOz//9/v+eNlzNklMOz//9/v+eNlzO3aO+zAACAv241pTOCvc+zAACAvze8kTOqIAC0AACAv7IwkjO3aO+zAACAv241pTOqIAC0AACAv7IwkjPTFk20AACAvxck/zLKARm0AACAv8NAmzMNM4GzAACAv4MQxDPTFk20AACAvxck/zLKARm0AACAv8NAmzPKARm0AACAv8NAmzPTFk20AACAvxck/zJjBjy0AACAv1jUkjMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjPE8rOzAACAv07jlzMNM4GzAACAv4MQxDNjBjy0AACAv1jUkjMT1vWzAACAv1zarjPE8rOzAACAv07jlzMT1vWzAACAv1zarjP0ZdCzAACAv51NhDPE8rOzAACAv07jlzMT1vWzAACAv1zarjMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzP0ZdCzAACAv51NhDO8riO0AACAv7WyjzMc6N+z//9/v/qUZzMFsM2zAACAv91zuDO8riO0AACAv7WyjzMt3tWzAACAv4PItjMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzOxluOzAACAv6tQkzMt3tWzAACAv4PItjNHL9OzAACAvxxNvTMFsM2zAACAv91zuDMB1km0//9/v1NUFzMvygK0//9/v6OQjDMAAAAAAACAv/sMtrMB1km0//9/v1NUFzNHL9OzAACAvxxNvTOxluOzAACAv6tQkzNHL9OzAACAvxxNvTP6wPqzAACAv/jvdzOxluOzAACAv6tQkzO4TQK0AACAv6h2lDP6wPqzAACAv/jvdzO4TQK0AACAv6h2lDPFaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r7FaWI/AAAAAN7p7r7Td2k/AAAAAKQB0r5z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr9n6te9AAAAAMSSfr9n6te9AAAAAMSSfr9z6te9AAAAAMSSfr8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez8JEVE/AAAAAIO9Ez8JEVE/AAAAAIO9Ez8GEVE/AAAAAIS9Ez9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9c1S2/wAFgOXjrOz9t1i2/AAAAAEXtOz9i1i2/lvevtk3tOz9t1i2/AAAAAEXtOz9j1i2/AAAAAEztOz9i1i2/lvevtk3tOz9j1i2/AAAAAEztOz9c1S2/AAAAAHjrOz+uAdc7AP5/PxABCDvX6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr/X6te9AAAAAMOSfr+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj+1d1q/AAAAAAtvBT+jp1G/AAAAACbjEj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj8a3Qy/AAAAAKzBVT8a3Qy/AAAAAKzBVT/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz924To9AAAAAP+5fz924To9AAAAAP+5fz9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj+ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj+8LV4/AAAAAP1R/j68LV4/AAAAAP1R/j7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj7kEXI/AAAAAE2Npj6Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj+Z04e+AAAAANTTdj+P04e+AAAAANTTdj/ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr7ZXWy/AAAAAImdxL68LV6/AAAAAP1R/r68LV6/AAAAAP1R/r6ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8s0ZW+AAAAAOrJdL8s0ZW+AAAAAOrJdL9dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL+jp1E/AAAAACbjEr+jp1E/AAAAACbjEr8AAAAAAACAP99/b7ToFs0zAACAPztbCbQAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrMAAAAAAACAP99/b7ToFs0zAACAPztbCbQVuM4zAACAPxB8JrPGBA00AACAP04+17MVuM4zAACAPxB8JrNaC/4zAACAP9AmXLPGBA00AACAP04+17NaC/4zAACAP9AmXLNvSAo0AACAPwePZLPGBA00AACAP04+17Ow0OozAACAP6P0tbNaC/4zAACAP9AmXLNvSAo0AACAPwePZLOw0OozAACAP6P0tbNvSAo0AACAPwePZLM4mxA0AACAP94+m7Ow0OozAACAP6P0tbMDsPQzAACAP9OilLM4mxA0AACAP94+m7MDsPQzAACAP9OilLOB+wY0AACAPyWKabM4mxA0AACAP94+m7NMxNwzAACAP09Bs7MDsPQzAACAP9OilLOB+wY0AACAPyWKabPxA7UzAACAP67AxbNMxNwzAACAP09Bs7Oigewz//9/P+Fg1rPR4+4zAACAPwWMmrMINPIzAACAP9R1vbNU4PwzAACAP6VWQrOB+wY0AACAPyWKabNn3g80//9/P5hCdLPus1O1AACAP1RpgrVMxNwzAACAP09Bs7MfDQw0AACAPweLmLNn3g80//9/P5hCdLPus1O1AACAP1RpgrUINPIzAACAP9R1vbNn3g80//9/P5hCdLPxA7UzAACAP67AxbMINPIzAACAP9R1vbPxA7UzAACAP67AxbNU4PwzAACAP6VWQrOigewz//9/P+Fg1rNU4PwzAACAP6VWQrOigewz//9/P+Fg1rPR4+4zAACAPwWMmrPR4+4zAACAPwWMmrPus1O1AACAP1RpgrWDL7y0AACAP8e4RTMfDQw0AACAPweLmLOOm8kzAACAP4A1pbNX6/YzAACAP4WIm7OyGPczAACAP6NlnLNsGvczAACAP7AwkrNx1gE0AACAPzDFo7NX6/YzAACAP4WIm7OyGPczAACAP6NlnLPCqgM0AACAP6X6m7NX6/YzAACAP4WIm7MUIfYzAACAPyr6m7OyGPczAACAP6NlnLNx1gE0AACAPzDFo7PCqgM0AACAP6X6m7OOm8kzAACAP4A1pbNx1gE0AACAPzDFo7OOm8kzAACAP4A1pbNsGvczAACAP7AwkrNsGvczAACAP7AwkrODL7y0AACAP8e4RTM91skzAACAPz/yJLMfDQw0AACAPweLmLM+5Q80AACAPzbdabMZ3mc0//9/P/75HrODL7y0AACAP8e4RTMZ3mc0//9/P/75HrM91skzAACAPz/yJLMZ3mc0//9/P/75HrPPVJIz//9/P5ozCrQ91skzAACAPz/yJLM+5Q80AACAPzbdabPPVJIz//9/P5ozCrQDMO4zAACAP8z6t7NbmQE0AACAP3jnlbM+5Q80AACAPzbdabPT9xg0AACAP8ew/7LPVJIz//9/P5ozCrTT9xg0AACAP8ew/7JbmQE0AACAP3jnlbPT9xg0AACAP8ew/7LNVbczAACAP9yCzLMDMO4zAACAP8z6t7NbmQE0AACAP3jnlbPNVbczAACAP9yCzLMDMO4zAACAP8z6t7PyDfUzAACAPzLsqbOdo/wzAACAP1PInbPNVbczAACAP9yCzLPyDfUzAACAPzLsqbPyDfUzAACAPzLsqbMIwfozAACAP5GLi7Odo/wzAACAP1PInbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLOdo/wzAACAP1PInbPdwPozAACAP97yVbMIwfozAACAP5GLi7OBo/wzAACAP1gyfLPdwPozAACAP97yVbOBo/wzAACAP1gyfLOuTQI0AACAP24GkrPKTQI0AACAPx1RirPdwPozAACAP97yVbOuTQI0AACAP24GkrOk4+4zAACAPzvBurOuTQI0AACAP24GkrPKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PKTQI0AACAPx1RirOk4+4zAACAPzvBurMUIfYzAACAPyr6m7PCqgM0AACAP6X6m7PA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDOg9f+7oPV/v7H0grzA8hK0//9/v4LkkjOSF/Sz//9/v1t7mDPA8hK0//9/v4LkkjOg9f+7oPV/v7H0grySF/Sz//9/v1t7mDO/zMw57/9/v8Cotjqg9f+7oPV/v7H0grxtqQW0AACAv4YwpDO/zMw57/9/v8CotjoBQg60AACAv44alzNtqQW0AACAv4YwpDOapuezAACAv5IalzO/zMw57/9/v8CotjptqQW0AACAv4YwpDOapuezAACAv5IalzMeeCG0AACAv6F1vTPbuRe0AACAv5pQkzOCdQS0AACAv06elTOlWvGzAACAv3GmdDOt4+6zAACAvzWBlzPdZeezAACAv/hIlzNI9eOzAACAv3ssqTPQ6+KzAACAv1AdgTMAAAAAAACAv8iawDOt4+6zAACAvzWBlzNI9eOzAACAv3ssqTOt4+6zAACAvzWBlzPbuRe0AACAv5pQkzNI9eOzAACAv3ssqTPbuRe0AACAv5pQkzOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTOlWvGzAACAv3GmdDMeeCG0AACAv6F1vTMAAAAAAACAv8iawDPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTQAAAAAAACAv8iawDMC1AS0//9/v4IBlTOCdQS0AACAv06elTPQ6+KzAACAv1AdgTOmGs6zAACAv9nYDTTuNXKzAACAv31SazMn7hi0AACAv3gntzOCdQS0AACAv06elTPdZeezAACAv/hIlzMn7hi0AACAv3gntzNakPKzAACAv2U/mzPdZeezAACAv/hIlzMn7hi0AACAv3gntzNp4wy0AACAv8hMhDNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPT1vWzAACAv0bZrjNakPKzAACAv2U/mzNp4wy0AACAv8hMhDPYC/6zAACAv07jlzPT1vWzAACAv0bZrjPYC/6zAACAv07jlzPT1vWzAACAv0bZrjOGBryzAACAvznWkjPYC/6zAACAv07jlzPHts6zAACAvyQRxDOGBryzAACAvznWkjPHts6zAACAvyQRxDOGBryzAACAvznWkjNDFk2zAACAv2If/zLHts6zAACAvyQRxDNDFk2zAACAv2If/zIAAAAAAACAv65CmzNDFk2zAACAv2If/zIAAAAAAACAv65CmzMAAAAAAACAv65CmzMBQg60AACAv44alzOcpuezAACAvxeJojOapuezAACAv5IalzOjdMOz//9/vx9tljMBQg60AACAv44alzOjdMOz//9/vx9tljNiKQ20AACAvzO7mDOcpuezAACAvxeJojOjdMOz//9/vx9tljNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDOcpuezAACAvxeJojNSyBC0AACAv0C7mDNiKQ20AACAvzO7mDMaLNmzAACAv+FtlzNSyBC0AACAv0C7mDNKW++zAACAv/dUtTNjkeCzAACAv4LInTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTMaLNmzAACAv+FtlzNKW++zAACAv/dUtTNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjNjkeCzAACAv4LInTPPXbazAACAvwnmizMAbSi0AACAv0+3kjPPXbazAACAvwnmizPKXbaz//9/vx/YoTMAbSi0AACAv0+3kjN7UwS0AACAv9makjMfbeCzAACAv0DolTPKXbaz//9/vx/YoTMfbeCzAACAv0DolTPKXbaz//9/vx/YoTNbkAS0AACAvydkhTN7UwS0AACAv9makjMfbeCzAACAv0DolTNpnRq0AACAv8gDnDMC1AS0//9/v4IBlTNbkAS0AACAvydkhTN7UwS0AACAv9makjNqj6uzAACAv/ODvjNpnRq0AACAv8gDnDNbkAS0AACAvydkhTNpnRq0AACAv8gDnDNqj6uzAACAv/ODvjMC1AS0//9/v4IBlTNqj6uzAACAv/ODvjPuNXKzAACAv31SazOmGs6zAACAv9nYDTTuNXKzAACAv31SazMtBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj8tBN89AAAAAEh6fj8wBN89AAAAAEd6fj+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr+1d1o/AAAAAAtvBb+jp1E/AAAAACbjEr97lz0/AAAAAFgDLL97lz0/AAAAAFgDLL9NiSY/AAAAAIVpQr9NiSY/AAAAAIVpQr8a2ww/AAAAAKzBVb8a2ww/AAAAAKzBVb/E6eE+AAAAAMu5Zb/E6eE+AAAAAMu5Zb9NjaY+AAAAAOQRcr9NjaY+AAAAAOQRcr+iGVE+AAAAAPWZer+iGVE+AAAAAPWZer9HoaM9AAAAAP4tf79HoaM9AAAAAP4tf7924Tq9AAAAAP+5f7924Tq9AAAAAP+5f79dkS6+AAAAAPg/fL9dkS6+AAAAAPg/fL8s1ZW+AAAAAOrJdL8s1ZW+AAAAAOrJdL+kAdK+AAAAANN3ab+kAdK+AAAAANN3ab8LbwW/AAAAALV3Wr8LbwW/AAAAALV3Wr9Awx+/AAAAAJAFSL9Awx+/AAAAAJAFSL9vkze/AAAAAGVrMr9vkze/AAAAAGVrMr+ZfUy/AAAAADQBGr+ZfUy/AAAAADQBGr+8LV6/AAAAAP1R/r68LV6/AAAAAP1R/r7ZXWy/AAAAAImdxL7ZXWy/AAAAAImdxL7kEXK/AAAAAE2Npr7kEXK/AAAAAE2Npr6Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr+Z04c+AAAAANTTdr+Z04c+AAAAANLTdr/kEXI/AAAAAE2Npj7ZXWw/AAAAAImdxD7ZXWw/AAAAAImdxD7kEXI/AAAAAE2Npj68LV4/AAAAAP1R/j68LV4/AAAAAP1R/j6ZfUw/AAAAADQBGj+ZfUw/AAAAADQBGj9vkzc/AAAAAGVrMj9vkzc/AAAAAGVrMj9Awx8/AAAAAJAFSD9Awx8/AAAAAJAFSD8LbwU/AAAAALV3Wj8LbwU/AAAAALV3Wj+kAdI+AAAAANN3aT+kAdI+AAAAANN3aT8s0ZU+AAAAAOrJdD8s0ZU+AAAAAOrJdD9dkS4+AAAAAPg/fD9dkS4+AAAAAPg/fD924To9AAAAAP+5fz924To9AAAAAP+5fz9HoaO9AAAAAP4tfz9HoaO9AAAAAP4tfz+iGVG+AAAAAPWZej+iGVG+AAAAAPWZej9Njaa+AAAAAOQRcj9Njaa+AAAAAOQRcj/E6eG+AAAAAMu5ZT/E6eG+AAAAAMu5ZT8a2wy/AAAAAKzBVT8a2wy/AAAAAKzBVT9NiSa/AAAAAIVrQj9NiSa/AAAAAIVrQj97lz2/AAAAAFgDLD97lz2/AAAAAFgDLD+jp1G/AAAAACbjEj+jp1G/AAAAACbjEj/FaWK/AAAAAN7p7j7FaWK/AAAAAN7p7j7Td2m/AAAAAKQB0j7Td2m/AAAAAKQB0j5IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj9IA989AAAAAEp6fj+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE7+HlFG/AAAAAL8CE7+HlFG/AAAAAL8CE7+MlFG/AAAAALUCE79rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9xLi0/AAAAAB6IPL9xLi0/AAAAAB6IPL9rLi0/u+QTNiGIPL9tLi0/AAAAACKIPL9tLi0/AAAAACKIPL+cpuczAACAP706krMJIfYzAACAPwhRirPCTQI0//9/P/wxZLMDQg40AACAP786krOJzEy6q/9/P70fSrsKxd4zAACAPy1doLOcpuczAACAP706krMDQg40AACAP786krMKxd4zAACAPy1doLOcpuczAACAP706krPCTQI0//9/P/wxZLMDQg40AACAP786krMJIfYzAACAPwhRirOXTQI0AACAP5AGkrPCTQI0//9/P/wxZLPqpuczAACAPxfhqLMJIfYzAACAPwhRirOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLOXTQI0AACAP5AGkrMgLNkzAACAP46mr7PqpuczAACAPxfhqLNymu4z//9/P33InbN2xgg0AACAPymMi7MgLNkzAACAP46mr7N2xgg0AACAPymMi7NI9eMzAACAP+7rqbNymu4z//9/P33InbN2xgg0AACAPymMi7PLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNymu4z//9/P33InbPLjNkzAACAPy7ZirNI9eMzAACAP+7rqbNSxgg0AACAPzElfLPLjNkzAACAPy7ZirPk3/wzAACAPzzolbOYBAE0AACAP2wCrbNSxgg0AACAPzElfLPk3/wzAACAPzzolbNSxgg0AACAPzElfLOmTcozAACAP2uos7Pk3/wzAACAPzzolbOYBAE0AACAP2wCrbPrd6EzAACAP1VHFbSmTcozAACAP2uos7NaYd0z//9/P4IBlbOYBAE0AACAP2wCrbM8AzU0AACAPxCjSbOmTcozAACAP2uos7M8AzU0AACAPxCjSbPrd6EzAACAP1VHFbQ8AzU0AACAPxCjSbPrd6EzAACAP1VHFbRaYd0z//9/P4IBlbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNaYd0z//9/P4IBlbPQ6+IzAACAPw2bl7O91gU0AACAPz72b7NQeSE0AACAP4dSa7MAAAAAAACAP+jSZbNQeSE0AACAP4dSa7MAAAAAAACAP+jSZbPQ6+IzAACAPw2bl7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNexgg0AACAPwDwd7Mop7Uz//9/P6h1vbPcr80zAACAPyjNubPQ6+IzAACAPw2bl7Ns4PwzAACAP4RWQrOnTQI0AACAP392lLO91gU0AACAPz72b7P3wgc0AACAPynAxbNexgg0AACAPwDwd7Pm7jw0AACAP5mawLOnTQI0AACAP392lLNs4PwzAACAP4RWQrNexgg0AACAPwDwd7Ns4PwzAACAP4RWQrP3wgc0AACAPynAxbMop7Uz//9/P6h1vbP3wgc0AACAPynAxbMop7Uz//9/P6h1vbPm7jw0AACAP5mawLPcr80zAACAPyjNubML3wE0AACAP+HCirO91gU0AACAPz72b7Pcr80zAACAPyjNubML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprML3wE0AACAP+HCirOCnAI0AACAP8CQoLPh2bszAACAP9rfprOCnAI0AACAP8CQoLM6phk0AACAP1dkerPh2bszAACAP9rfprNL9gY0AACAP73yJrM6phk0AACAP1dkerNL9gY0AACAP73yJrM6phk0AACAP1dkerMksBw0AACAPwfZHLMVCZszAACAP1pxGrRL9gY0AACAP73yJrMksBw0AACAPwfZHLMvFk0zAACAP/6ZsLMVCZszAACAP1pxGrQksBw0AACAPwfZHLMvFk0zAACAP/6ZsLOBApkzAACAP65Cm7MVCZszAACAP1pxGrQvFk0zAACAP/6ZsLOBApkzAACAP65Cm7OBApkzAACAP65Cm7MAAAAAqv9/P7lLUzsgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OSF/Qz//9/P1XrkLMgbNwzAACAP3x4o7OJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzuSF/Qz//9/P1XrkLOJzEy6q/9/P70fSrsAAAAAqv9/P7lLUzsKxd4zAACAPy1doLMAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwMABQAKAAYABAANAAwAAgAPAA4AAAAQABEAAQATABIAFwAZABgAFAAaABsAFgAdABwAFQAhAB4AIgAkACMAHwAmACcAIAApACUAKAAsAC0AKgAwACsALgAyADMAMQA2ADQALwA3ADUAOAA7ADwAOQBAADoAPQBBAEMASABJAEQAQgA+AEcAPwBLAEYASgBNAEUATABOAFAAUwBUAFIATwBVAFcAUQBaAFYAWABbAF0AWQBgAFwAXgBhAGMAXwBmAGIAZQBoAGcAZABqAGkAbAB0AHIAawAJAG4ACAB2AG0AdQB4AHMAeQB7AHEAegB9AHAAfAB/AG8AfgCAAHcACwAHAIEAggCDAIIAgQCEAIYAiACJAIcAhQCKAIwAjgCPAI0AiwCQAJEAlQCXAJYAkwCZAJgAkgCaAJsAlACcAJ0AngCfAJ4AnQCgAKEAogCjAKIAoQCkAKQApQCiAKUApACmAKYApwClAKcApgCoAKgAqQCnAKkAqACqAKoAqwCpAKsAqgCsAKwArQCrAK0ArACuAK4ArwCtAK8ArgCwAK8AsQCyALEArwCwALIAswC0ALMAsgCxALQAtQC2ALUAtACzALYAtwC4ALcAtgC1ALgAuQC6ALkAuAC3ALoAuwC8ALsAugC5ALwAvQC+AL0AvAC7AL4AvwDAAL8AvgC9AMAAwQDCAMEAwAC/AMIAwwDEAMMAwgDBAMQAxQDGAMUAxADDAMYAxwDIAMcAxgDFAMkAywDNAMwAygDOAM8A0ADRANAAzwDSANMA0gDPANIA0wDUANUA1ADTANQA1QDWANcA1gDVANYA1wDYANkA2ADXANgA2QDaANsA2gDZANoA2wDcAN0A3ADbANwA3QDeAN8A3gDdAN4A3wDgAOEA4ADfAOAA4QDiAOMA4gDhAOIA4wDkAOUA5ADjAOQA5QDmAOcA5gDlAOYA5wDoAOcA6QDoAOkA5wDqAOoA6wDpAOsA6gDsAOwA7QDrAO0A7ADuAO4A7wDtAO8A7gDwAPAA8QDvAPEA8ADyAPIA8wDxAPMA8gD0APQAgwDzAIMA9ACBAPUA9wD6APgA9gD7APkA/AD+AAAB/QADAf8AAQEFAQYBAgEIAQQBBwEKAQwBCQEPAQsBDQERARIBDgEZARABFAEcAR4BGgEhASABFwEjASIBEwEkASUBGAEnASYBFQEoASkBFgEqARsBHwErAS8BMwE2ATQBMAE4ATkBMgE8ATsBLgE9AT4BMQE/AS0BQgEdAUABLAFFAUQBRgFIAUEBRwFKAUMBSwFPAUwBSQFRAVABUgFUAU4BUwFXAU0BVgFZAVgBVQFcAVoBXQFeAVsBYAFjAWEBXwFlAWIBZgFoAWcBZAFrAWkBbAFuAWoBbwFyAXABbQFzAXEBdAE3AToBdQE1AXYBeQF7AXoBdwF9AXgBfAF/AYEBfgGFAYABgwGGAYwBkQGTAZIBjgGVAZQBiQGWAZcBiwGZAZgBiAGaAZsBkAGeAZwBjwGhAaABigGlAaYBjQGpAaQBpwGqAawBqAGvAasBrQGwAbIBrgG0AbEBswG2AbgBtQG6AbcBuQG8Ab0BuwG/Ab4BwAHBAYQBxAGHAcIBggHGAcUBxwHKAcMByQHNAcwByAHPAcsBzgHRAdQB0AHWAdIB1QHXAdMB2AHbAdwB2QHeAdoB3QHgAeMB3wHlAeIB5AHoAeEB5wHsAesB5gHvAekB7gHwAe0B8QHzAeoB8gGfAaMB9AH2AaIB9QGdAfcB+QH7AfoB+AH8Af0B/gH/Af4B/QEAAgACAQL+AQECAAICAgICAwIBAgMCAgIEAgQCBQIDAgUCBAIGAgYCBwIFAgcCBgIIAggCCQIHAgkCCAIKAgoCCwIJAgsCCgIMAg0CCwIMAgsCDQIOAg8CDgINAg4CDwIQAhECEAIPAhACEQISAhMCEgIRAhICEwIUAhUCFAITAhQCFQIWAhcCFgIVAhYCFwIYAhkCGAIXAhgCGQIaAhsCGgIZAhoCGwIcAh0CHAIbAhwCHQIeAh8CHgIdAh4CHwIgAiECIAIfAiACIQIiAiMCIgIhAiICIwIkAiUCJwIpAigCJgIqAisCLAItAiwCKwIuAi0CLwIwAi8CLQIsAjACMQIyAjECMAIvAjICMwI0AjMCMgIxAjQCNQI2AjUCNAIzAjYCNwI4AjcCNgI1AjgCOQI6AjkCOAI3AjoCOwI8AjsCOgI5AjwCPQI+Aj0CPAI7Aj4CPwJAAj8CPgI9AkACQQJCAkECQAI/AkICQwJEAkMCQgJBAkMCRQJEAkUCQwJGAkYCRwJFAkcCRgJIAkgCSQJHAkkCSAJKAkoCSwJJAksCSgJMAkwCTQJLAk0CTAJOAk4CTwJNAk8CTgJQAlACUQJPAlECUAJSAlICUwJRAlMCUgJUAlUCVgJXAlYCVQJYAloCXAJdAlsCWQJeAmECYwJkAmICXwJlAmYCYAJnAmgCbgJxAm8CawJzAnICagJ2AnQCaQJ4AnUCeQJ8AnsCdwJ+AnoCfQKBAoICgAKFAoQCfwKIAoMChwKKAokChgKMAosCjwKRApACjQKTApQCjgKYApIClgKaApsCmQKdApwClQKeAp8ClwKiAqACpQKnAqYCoQKoAqsCsQK2ArQCrAK4ArACtwK5ArMCugK8Aq0CuwK9ArUCvgKqAq8CqQKjArICpALBAq4CvwLCAsMCwALGAsQCxwLJAsgCxQLLAsoCzQLPAs4CzALSAtAC0wLWAtUC0QLZAtQC1wLaAtsC2ALcAt4C4ALiAuEC3wLlAuQC3QLnAuMC5gJsAm0C6AJwAgAAAACAvwAAAAAAAIA/AACAPwAAAAAAAIA/AACAvwAAAAAAAIC/AACAPwAAAAAAAIC/AAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAACAAAAAAAAAgD8AAIA/AACAPwAAAAAAAAAAAACAPwAAAAAAAAEAAwAAAAMAAgAAAAAAAAAAAAAAgL/CxUe+AAAAAL4Ue78W78O+AAAAAF6DbL/aOQ6/AAAAADHbVL/zBDW/AAAAAPMENb8x21S/AAAAANo5Dr9eg2y/AAAAABXvw76+FHu/AAAAAMTFR74AAIC/AAAAAC69OzO+FHu/AAAAAMLFRz5fg2y/AAAAABTvwz4y21S/AAAAANk5Dj/zBDW/AAAAAPMENT/ZOQ6/AAAAADLbVD8X78O+AAAAAF6DbD/BxUe+AAAAAL8Uez8uvbszAAAAAAAAgD+9xUc+AAAAAL8Uez8V78M+AAAAAF6DbD/bOQ4/AAAAADDbVD/yBDU/AAAAAPQENT8v21Q/AAAAAN05Dj9eg2w/AAAAABrvwz6+FHs/AAAAAMbFRz4AAIA/AAAAAC7eTLK+FHs/AAAAAMjFR75dg2w/AAAAABvvw74z21Q/AAAAANc5Dr/1BDU/AAAAAPIENb/bOQ4/AAAAADHbVL8V78M+AAAAAF+DbL+8xUc+AAAAAL8Ue78AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/HHxfPuAcebw8/hW/DHBbvpkcebzj/6++DHBbvpkcebzj/6++DHBbvpkcebzj/6++FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/FMYPPtgcebzieRu/6LAqvqEcebzf27y+6LAqvqEcebzf27y+yDXuvagcebzkj8a+yDXuvagcebzkj8a+0PyCvbAceby99My+0PyCvbAceby99My+0PyCvbAceby99My+yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/yuiVPuccebxGDg6/AD0rvLccebyd8M++AD0rvLccebyd8M++0J4xPb0cebx7d8++0J4xPb0cebx7d8+++OrFPcMcebwzi8u++OrFPcMcebwzi8u++OrFPcMcebwzi8u+Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/Fsm5Pu0cebwIygO/jBkYPsgcebywO8S+jBkYPsgcebywO8S+NP1KPs0cebxoprm+NP1KPs0cebxoprm+NP1KPs0cebxoprm+Is7aPvEcebzqte6+Is7aPvEcebzqte6+Is7aPvEcebzqte6+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+1NJ6PtEcebwO9qu+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+qnL4PvQcebyG5tG+0myTPtQcebz3YZu+0myTPtQcebz3YZu+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+1i+nPtUcebwGLYi+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+fR8JP/Ucebw4mrG+umK4PtYcebyYSWW+umK4PtYcebyYSWW+umK4PtYcebyYSWW+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+ceUTP/UcebxWU46+smrFPtYcebwonjq+smrFPtYcebwonjq+smrFPtYcebwonjq+PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7RsWAPsUcebzqDyy+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP9QcebwwSMk9wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/wFmCvqUcebxjdhC/2cPIvo0cebyq6vW+2cPIvo0cebyq6vW+JOmmvpkcebxk0Qa/LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+LWHnvoIcebw1JNq+lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/lFI3vrAcebxjvRe/xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+xCIBv3ccebyLv7q+qM/NvbscebwGiRy/qM/NvbscebwGiRy/qM/NvbscebwGiRy/KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+KoIMv2wcebxrO5i+wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/wL6lvMYcebzyxR6/4KAVv2McebxcRma+4KAVv2McebxcRma+4KAVv2McebxcRma+UMV3PdAcebwVax6/UMV3PdAcebwVax6/UMV3PdAcebwVax6/Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+Flocv1kcebwpGRi+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+2kmEvpEcebzOL6C+vrKYvoocebx+q42+vrKYvoocebx+q42+SqCqvoIcebxze3G+SqCqvoIcebxze3G+Ksq5vnscebzydUO+Ksq5vnscebzydUO+HPPFvnUcebxNABK+HPPFvnUcebxNABK+DurOvm8cebxUxLu9ceUTPzDFPTxWU46+vS0cP/QcebxI/VK+ceUTP/UcebxWU46+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+vS0cP/QcebxI/VK+vS0cP/QcebxI/VK+vS0cPzLFPTxI/VK+iSJEPwgdebwM72O+iSJEPwgdebwM72O+iSJEPwgdebwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP9QcebwwSMk9iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9MxYKP1LFPTwwSMk9PnXfPs4cebwAU0c7PnXfPs4cebwAU0c7MxYKP9QcebwwSMk9RsWAPsUcebzqDyy+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+RsWAPmLFPTzqDyy+PnXfPljFPTwAU0c7smrFPlDFPTwonjq+RsWAPsUcebzqDyy+RsWAPmLFPTzqDyy+smrFPtYcebwonjq+smrFPlDFPTwonjq+umK4PtYcebyYSWW+smrFPtYcebwonjq+umK4PlDFPTyYSWW+1i+nPtUcebwGLYi+1i+nPlDFPTwGLYi+0myTPtQcebz3YZu+0myTPlLFPTz3YZu+1NJ6PtEcebwO9qu+1NJ6PlbFPTwO9qu+NP1KPs0cebxoprm+NP1KPlrFPTxoprm+jBkYPsgcebywO8S+jBkYPl7FPTywO8S++OrFPcMcebwzi8u++OrFPWLFPTwzi8u+0J4xPWjFPTx7d8++0J4xPb0cebx7d8++AD0rvHDFPTyd8M++AD0rvLccebyd8M++0PyCvXbFPTy99My+0PyCvbAceby99My+yDXuvX7FPTzkj8a+yDXuvagcebzkj8a+6LAqvobFPTzf27y+6LAqvqEcebzf27y+DHBbvo7FPTzj/6++DHBbvpkcebzj/6++2kmEvpTFPTzOL6C+2kmEvpEcebzOL6C+vrKYvpzFPTx+q42+vrKYvoocebx+q42+SqCqvqTFPTxze3G+SqCqvoIcebxze3G+Ksq5vqrFPTzydUO+Ksq5vnscebzydUO+HPPFvrLFPTxNABK+HPPFvnUcebxNABK+DurOvrjFPTxUxLu9DurOvm8cebxUxLu9DurOvrjFPTxUxLu9DurOvrjFPTxUxLu9Flocv1kcebwpGRi+Flocv1kcebwpGRi+DurOvm8cebxUxLu9Flocv8zFPTwpGRi+4KAVv8TFPTxcRma+Flocv1kcebwpGRi+Flocv8zFPTwpGRi+4KAVv2McebxcRma+KoIMv7rFPTxrO5i+KoIMv2wcebxrO5i+xCIBv7DFPTyLv7q+xCIBv3ccebyLv7q+LWHnvqTFPTw1JNq+LWHnvoIcebw1JNq+2cPIvpjFPTyq6vW+2cPIvo0cebyq6vW+JOmmvozFPTxk0Qa/JOmmvpkcebxk0Qa/wFmCvoLFPTxjdhC/wFmCvqUcebxjdhC/lFI3vnbFPTxjvRe/lFI3vrAcebxjvRe/qM/NvWrFPTwGiRy/qM/NvbscebwGiRy/wL6lvGDFPTzyxR6/wL6lvMYcebzyxR6/UMV3PVbFPTwVax6/UMV3PdAcebwVax6/FMYPPk7FPTzieRu/FMYPPtgcebzieRu/HHxfPuAcebw8/hW/HHxfPkbFPTw8/hW/yuiVPuccebxGDg6/yuiVPj7FPTxGDg6/Fsm5Pu0cebwIygO/Fsm5PjrFPTwIygO/Is7aPvEcebzqte6+Is7aPjbFPTzqte6+qnL4PvQcebyG5tG+qnL4PjLFPTyG5tG+fR8JP/Ucebw4mrG+fR8JPzDFPTw4mrG+2cPIvpjFPTyq6vW+2cPIvpjFPTyq6vW+wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/wFmCvoLFPTxjdhC/JOmmvozFPTxk0Qa/LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+LWHnvqTFPTw1JNq+lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/lFI3vnbFPTxjvRe/xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+xCIBv7DFPTyLv7q+qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/qM/NvWrFPTwGiRy/KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+KoIMv7rFPTxrO5i+wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/wL6lvGDFPTzyxR6/4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+4KAVv8TFPTxcRma+UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/UMV3PVbFPTwVax6/Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+Flocv8zFPTwpGRi+FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/FMYPPk7FPTzieRu/2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+2kmEvpTFPTzOL6C+vrKYvpzFPTx+q42+vrKYvpzFPTx+q42+SqCqvqTFPTxze3G+SqCqvqTFPTxze3G+Ksq5vqrFPTzydUO+Ksq5vqrFPTzydUO+HPPFvrLFPTxNABK+HPPFvrLFPTxNABK+DurOvrjFPTxUxLu9DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++DHBbvo7FPTzj/6++PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7PnXfPljFPTwAU0c7smrFPlDFPTwonjq+smrFPlDFPTwonjq+smrFPlDFPTwonjq+RsWAPmLFPTzqDyy+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+ceUTPzDFPTxWU46+vS0cPzLFPTxI/VK+vS0cPzLFPTxI/VK+iSJEPx7FPTwM72O+iSJEPx7FPTwM72O+MxYKP1LFPTwwSMk9HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/HHxfPkbFPTw8/hW/6LAqvobFPTzf27y+6LAqvobFPTzf27y+yDXuvX7FPTzkj8a+yDXuvX7FPTzkj8a+0PyCvXbFPTy99My+0PyCvXbFPTy99My+0PyCvXbFPTy99My+yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/yuiVPj7FPTxGDg6/AD0rvHDFPTyd8M++AD0rvHDFPTyd8M++0J4xPWjFPTx7d8++0J4xPWjFPTx7d8+++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u++OrFPWLFPTwzi8u+Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/Fsm5PjrFPTwIygO/jBkYPl7FPTywO8S+jBkYPl7FPTywO8S+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+NP1KPlrFPTxoprm+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+Is7aPjbFPTzqte6+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+1NJ6PlbFPTwO9qu+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+qnL4PjLFPTyG5tG+0myTPlLFPTz3YZu+0myTPlLFPTz3YZu+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+1i+nPlDFPTwGLYi+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+fR8JPzDFPTw4mrG+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+umK4PlDFPTyYSWW+CSXWvmMceby8EiU9CSXWvmMceby8EiU99C4/vykcebyr6og+9C4/vykcebyr6og+9C4/vykcebyr6og+BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+cnkXvz4cebyFN4A+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+pja8vlscebzwS2c+RzsPvzwcebwq36Q+RzsPvzwcebwq36Q+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+QwQhP9gceby8MEU+ekfPPr0cebzoFz8+ekfPPr0cebzoFz8+aj7YPsMceby8+Qo+ih7DPrYcebyOjXA+ih7DPrYcebyOjXA+qvSzPq8cebyISY8+qvSzPq8cebyISY8+GgeiPqgcebxQN6Q+GgeiPqgcebxQN6Q+Np6NPqAcebyeu7Y+Np6NPqAcebyeu7Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+vBhuPpgcebywi8Y+6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/6Dr6vVkcebzHvyY/cCItvWIcebz+sCk/cCItvWIcebz+sCk/cCItvWIcebz+sCk/C0saP88cebwAr4k+C0saP88cebwAr4k+C0saP88cebwAr4k+UIIdPWscebzYCyo/UIIdPWscebzYCyo/UIIdPWscebzYCyo/XSwRP8Ucebw8x64+XSwRP8Ucebw8x64+XSwRP8Ucebw8x64++CDzPXYcebzyzic/+CDzPXYcebzyzic/+CDzPXYcebzyzic/68wFP7ocebxcS9E+68wFP7ocebxcS9E+68wFP7ocebxcS9E+NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/NPtJPoEcebxMAyM/irXwPq8cebz8r/A+irXwPq8cebz8r/A+irXwPq8cebz8r/A+Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/Hq6LPowcebxOvBs/MhjSPqQcebw+OwY/MhjSPqQcebw+OwY/gj2wPpgcebxMFxI/TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+TnUEvzwcebwKJsg+Xg6vvlscebygMIk+Xg6vvlscebygMIk+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+ftudvlwcebzXuJ4+TB7vvj0cebxecug+TB7vvj0cebxecug+TB7vvj0cebxecug+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+dhiKvl4cebzK7bE+ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/ynnRvkAcebzcoAI/JCpovmEcebzkgcI+JCpovmEcebzkgcI+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+bFQ4vmQcebw0MtA+tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/tnSwvkQcebzuDw8/1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+1HAFvmkcebx+x9o+ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/ZpSMvkocebwtVBk/qJmgvW4cebwIF+I+qJmgvW4cebwIF+I+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YPfNvHQcebxQA+Y+YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/YNNMvlEcebwoRCE/4OPqPHscebxofOY+4OPqPHscebxofOY+SE6oPYIcebyUgOM+SE6oPYIcebyUgOM+pMMJPokceby8G90+pMMJPokceby8G90+pMMJPokceby8G90+lFk9PpEcebysZ9M+lFk9PpEcebysZ9M+/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vlscebzwS2c+/O5tvrrFPTwOIFg+pja8vszFPTzwS2c+Xg6vvlscebygMIk+pja8vlscebzwS2c+Xg6vvszFPTygMIk+ftudvlwcebzXuJ4+ftudvsrFPTzXuJ4+dhiKvl4cebzK7bE+dhiKvsjFPTzK7bE+JCpovmEcebzkgcI+JCpovsbFPTzkgcI+bFQ4vmQcebw0MtA+bFQ4vsLFPTw0MtA+1HAFvmkcebx+x9o+1HAFvr7FPTx+x9o+qJmgvW4cebwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvHQcebxQA+Y+4OPqPKzFPTxofOY+4OPqPHscebxofOY+SE6oPaTFPTyUgOM+SE6oPYIcebyUgOM+pMMJPp7FPTy8G90+pMMJPokceby8G90+lFk9PpbFPTysZ9M+lFk9PpEcebysZ9M+vBhuPo7FPTywi8Y+vBhuPpgcebywi8Y+Np6NPobFPTyeu7Y+Np6NPqAcebyeu7Y+GgeiPn7FPTxQN6Q+GgeiPqgcebxQN6Q+qvSzPnbFPTyISY8+qvSzPq8cebyISY8+ih7DPnDFPTyOjXA+ih7DPrYcebyOjXA+ekfPPmrFPTzoFz8+ekfPPr0cebzoFz8+aj7YPmTFPTy8+Qo+aj7YPsMceby8+Qo+aj7YPmTFPTy8+Qo+aj7YPmTFPTy8+Qo+QwQhP9gceby8MEU+QwQhP9gceby8MEU+aj7YPsMceby8+Qo+QwQhP07FPTy8MEU+QwQhP9gceby8MEU+C0saP1jFPTwAr4k+C0saP88cebwAr4k+QwQhP07FPTy8MEU+XSwRP2LFPTw8x64+XSwRP8Ucebw8x64+68wFP2zFPTxcS9E+68wFP7ocebxcS9E+irXwPnbFPTz8r/A+irXwPq8cebz8r/A+MhjSPoLFPTw+OwY/MhjSPqQcebw+OwY/gj2wPo7FPTxMFxI/gj2wPpgcebxMFxI/Hq6LPprFPTxOvBs/Hq6LPowcebxOvBs/NPtJPqTFPTxMAyM/NPtJPoEcebxMAyM/+CDzPbDFPTzyzic/+CDzPXYcebzyzic/UIIdPbrFPTzYCyo/UIIdPWscebzYCyo/cCItvcTFPTz+sCk/cCItvWIcebz+sCk/6Dr6vc7FPTzHvyY/6Dr6vVkcebzHvyY/YNNMvlEcebwoRCE/YNNMvtbFPTwoRCE/ZpSMvkocebwtVBk/ZpSMvtzFPTwtVBk/tnSwvkQcebzuDw8/tnSwvuLFPTzuDw8/ynnRvkAcebzcoAI/ynnRvubFPTzcoAI/TB7vvj0cebxecug+TB7vvujFPTxecug+TnUEvzwcebwKJsg+TnUEv+rFPTwKJsg+RzsPvzwcebwq36Q+RzsPv+rFPTwq36Q+cnkXvz4cebyFN4A+cnkXv+jFPTyFN4A+cnkXvz4cebyFN4A+9C4/v/zFPTyr6og+9C4/vykcebyr6og+cnkXv+jFPTyFN4A+BWwFv8jFPTysMV69BWwFv8jFPTysMV699C4/vykcebyr6og+9C4/vykcebyr6og+9C4/v/zFPTyr6og+BWwFv10cebysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69BWwFv8jFPTysMV69CSXWvmMceby8EiU9CSXWvmMceby8EiU9BWwFv10cebysMV69/O5tvm0cebwOIFg+/O5tvm0cebwOIFg+/O5tvrrFPTwOIFg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+TnUEv+rFPTwKJsg+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+pja8vszFPTzwS2c+RzsPv+rFPTwq36Q+RzsPv+rFPTwq36Q+Xg6vvszFPTygMIk+Xg6vvszFPTygMIk+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+ftudvsrFPTzXuJ4+TB7vvujFPTxecug+TB7vvujFPTxecug+TB7vvujFPTxecug+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+dhiKvsjFPTzK7bE+ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/ynnRvubFPTzcoAI/JCpovsbFPTzkgcI+JCpovsbFPTzkgcI+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+bFQ4vsLFPTw0MtA+tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/tnSwvuLFPTzuDw8/1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+1HAFvr7FPTx+x9o+ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/ZpSMvtzFPTwtVBk/qJmgvbjFPTwIF+I+qJmgvbjFPTwIF+I+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YPfNvLLFPTxQA+Y+YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/YNNMvtbFPTwoRCE/4OPqPKzFPTxofOY+4OPqPKzFPTxofOY+SE6oPaTFPTyUgOM+SE6oPaTFPTyUgOM+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+pMMJPp7FPTy8G90+6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/6Dr6vc7FPTzHvyY/lFk9PpbFPTysZ9M+lFk9PpbFPTysZ9M+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+vBhuPo7FPTywi8Y+ekfPPmrFPTzoFz8+ekfPPmrFPTzoFz8+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+QwQhP07FPTy8MEU+aj7YPmTFPTy8+Qo+ih7DPnDFPTyOjXA+ih7DPnDFPTyOjXA+qvSzPnbFPTyISY8+qvSzPnbFPTyISY8+GgeiPn7FPTxQN6Q+GgeiPn7FPTxQN6Q+Np6NPobFPTyeu7Y+Np6NPobFPTyeu7Y+cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/cCItvcTFPTz+sCk/C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+C0saP1jFPTwAr4k+UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/UIIdPbrFPTzYCyo/XSwRP2LFPTw8x64+XSwRP2LFPTw8x64+XSwRP2LFPTw8x64++CDzPbDFPTzyzic/+CDzPbDFPTzyzic/+CDzPbDFPTzyzic/68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+68wFP2zFPTxcS9E+NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/NPtJPqTFPTxMAyM/irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+irXwPnbFPTz8r/A+Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/Hq6LPprFPTxOvBs/MhjSPoLFPTw+OwY/MhjSPoLFPTw+OwY/gj2wPo7FPTxMFxI/9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+9C4/v/zFPTyr6og+CSXWvsTFPTy8EiU9CSXWvsTFPTy8EiU9BWwFv8jFPTysMV69/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+/O5tvrrFPTwOIFg+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+cnkXv+jFPTyFN4A+HnghtAAAgL8r8iQz2CANtP//f7/4640zPmcJtAAAgL8BrwM0VGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzVGnVswAAgL9sAZMzAAAAAAAAgL9bMvKzAAAAAAAAgL/7DLazL8oCtP//f7+jkIwzLd7VswAAgL+DyLYzVGnVswAAgL9sAZMzAAAAAAAAgL/7DLazPmcJtAAAgL8BrwM0AAAAAAAAgL9bMvKzHnghtAAAgL8r8iQzPmcJtAAAgL8BrwM0HnghtAAAgL8r8iQz2CANtP//f7/4640zHnihswAAgL9W6o8z2CANtP//f7/4640z3lrxswAAgL/WUrgz/S/uswAAgL8oc44zBk3KswAAgL9655UzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzHnihswAAgL9W6o8z3lrxswAAgL/WUrgzBk3KswAAgL9655Uz/S/uswAAgL8oc44zBk3KswAAgL9655UzBk3KswAAgL+OpqszRsYItAAAgL9D5osznaP8swAAgL9ayJ0z/S/uswAAgL8oc44zBk3KswAAgL+OpqszRsYItAAAgL9D5oszBk3KswAAgL+OpqszXsYItAAAgL+Ii4szRsYItAAAgL9D5osznaP8swAAgL9ayJ0zXsYItAAAgL+Ii4sznaP8swAAgL9ayJ0zaJruswAAgL98lJIz/JEftAAAgL/59I4zXsYItAAAgL+Ii4szaJruswAAgL98lJIz/JEftAAAgL/59I4zyE0CtAAAgL8yiaIzaJruswAAgL98lJIz5rytswAAgL80TrQz/JEftAAAgL/59I4z5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz5rytswAAgL80TrQzyE0CtAAAgL8yiaIznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpcznE0CtAAAgL8VbZYz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzgr3PswAAgL83vJEz0rHKswAAgL9hGpczAqMPtAAAgL/NGpczxLkBtAAAgL8t4pkzZJTDs///f7/njZczxLkBtAAAgL8t4pkzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzgr3PswAAgL83vJEzZJTDs///f7/njZczZJTDs///f7/njZczt2jvswAAgL9uNaUzgr3PswAAgL83vJEzqiAAtAAAgL+yMJIzt2jvswAAgL9uNaUzqiAAtAAAgL+yMJIz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszDTOBswAAgL+DEMQz0xZNtAAAgL8XJP8yygEZtAAAgL/DQJszygEZtAAAgL/DQJsz0xZNtAAAgL8XJP8yYwY8tAAAgL9Y1JIzDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzxPKzswAAgL9O45czDTOBswAAgL+DEMQzYwY8tAAAgL9Y1JIzE9b1swAAgL9c2q4zxPKzswAAgL9O45czE9b1swAAgL9c2q4z9GXQswAAgL+dTYQzxPKzswAAgL9O45czE9b1swAAgL9c2q4zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGcz9GXQswAAgL+dTYQzvK4jtAAAgL+1so8zHOjfs///f7/6lGczBbDNswAAgL/dc7gzvK4jtAAAgL+1so8zLd7VswAAgL+DyLYzBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzuE0CtAAAgL+odpQz+sD6swAAgL/473czsZbjswAAgL+rUJMzLd7VswAAgL+DyLYzRy/TswAAgL8cTb0zBbDNswAAgL/dc7gzAdZJtP//f79TVBczL8oCtP//f7+jkIwzAAAAAAAAgL/7DLazAdZJtP//f79TVBczRy/TswAAgL8cTb0zsZbjswAAgL+rUJMzRy/TswAAgL8cTb0z+sD6swAAgL/473czsZbjswAAgL+rUJMzuE0CtAAAgL+odpQz+sD6swAAgL/473czuE0CtAAAgL+odpQzxWliPwAAAADe6e6+03dpPwAAAACkAdK+xWliPwAAAADe6e6+03dpPwAAAACkAdK+c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/Z+rXvQAAAADEkn6/c+rXvQAAAADEkn6/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/CRFRPwAAAACDvRM/CRFRPwAAAACDvRM/BhFRPwAAAACEvRM/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/XNUtv8ABYDl46zs/bdYtvwAAAABF7Ts/YtYtv5b3r7ZN7Ts/bdYtvwAAAABF7Ts/Y9YtvwAAAABM7Ts/YtYtv5b3r7ZN7Ts/Y9YtvwAAAABM7Ts/XNUtvwAAAAB46zs/rgHXOwD+fz8QAQg71+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/1+rXvQAAAADDkn6/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/tXdavwAAAAALbwU/o6dRvwAAAAAm4xI/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/Gt0MvwAAAACswVU/Gt0MvwAAAACswVU/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/b5M3PwAAAABlazI/b5M3PwAAAABlazI/mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+5BFyPwAAAABNjaY+mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/mdOHvgAAAADU03Y/j9OHvgAAAADU03Y/2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+2V1svwAAAACJncS+vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/b5M3vwAAAABlazK/b5M3vwAAAABlazK/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/LNGVvgAAAADqyXS/LNGVvgAAAADqyXS/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/GtsMPwAAAACswVW/GtsMPwAAAACswVW/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/o6dRPwAAAAAm4xK/o6dRPwAAAAAm4xK/AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0AAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazAAAAAAAAgD/ff2+06BbNMwAAgD87Wwm0FbjOMwAAgD8QfCazxgQNNAAAgD9OPtezFbjOMwAAgD8QfCazWgv+MwAAgD/QJlyzxgQNNAAAgD9OPtezWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzxgQNNAAAgD9OPtezsNDqMwAAgD+j9LWzWgv+MwAAgD/QJlyzb0gKNAAAgD8Hj2SzsNDqMwAAgD+j9LWzb0gKNAAAgD8Hj2SzOJsQNAAAgD/ePpuzsNDqMwAAgD+j9LWzA7D0MwAAgD/TopSzOJsQNAAAgD/ePpuzA7D0MwAAgD/TopSzgfsGNAAAgD8limmzOJsQNAAAgD/ePpuzTMTcMwAAgD9PQbOzA7D0MwAAgD/TopSzgfsGNAAAgD8limmz8QO1MwAAgD+uwMWzTMTcMwAAgD9PQbOzooHsM///fz/hYNaz0ePuMwAAgD8FjJqzCDTyMwAAgD/Udb2zVOD8MwAAgD+lVkKzgfsGNAAAgD8limmzZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1TMTcMwAAgD9PQbOzHw0MNAAAgD8Hi5izZ94PNP//fz+YQnSz7rNTtQAAgD9UaYK1CDTyMwAAgD/Udb2zZ94PNP//fz+YQnSz8QO1MwAAgD+uwMWzCDTyMwAAgD/Udb2z8QO1MwAAgD+uwMWzVOD8MwAAgD+lVkKzooHsM///fz/hYNazVOD8MwAAgD+lVkKzooHsM///fz/hYNaz0ePuMwAAgD8FjJqz0ePuMwAAgD8FjJqz7rNTtQAAgD9UaYK1gy+8tAAAgD/HuEUzHw0MNAAAgD8Hi5izjpvJMwAAgD+ANaWzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzbBr3MwAAgD+wMJKzcdYBNAAAgD8wxaOzV+v2MwAAgD+FiJuzshj3MwAAgD+jZZyzwqoDNAAAgD+l+puzV+v2MwAAgD+FiJuzFCH2MwAAgD8q+puzshj3MwAAgD+jZZyzcdYBNAAAgD8wxaOzwqoDNAAAgD+l+puzjpvJMwAAgD+ANaWzcdYBNAAAgD8wxaOzjpvJMwAAgD+ANaWzbBr3MwAAgD+wMJKzbBr3MwAAgD+wMJKzgy+8tAAAgD/HuEUzPdbJMwAAgD8/8iSzHw0MNAAAgD8Hi5izPuUPNAAAgD823WmzGd5nNP//fz/++R6zgy+8tAAAgD/HuEUzGd5nNP//fz/++R6zPdbJMwAAgD8/8iSzGd5nNP//fz/++R6zz1SSM///fz+aMwq0PdbJMwAAgD8/8iSzPuUPNAAAgD823Wmzz1SSM///fz+aMwq0AzDuMwAAgD/M+rezW5kBNAAAgD9455WzPuUPNAAAgD823Wmz0/cYNAAAgD/HsP+yz1SSM///fz+aMwq00/cYNAAAgD/HsP+yW5kBNAAAgD9455Wz0/cYNAAAgD/HsP+yzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rezW5kBNAAAgD9455WzzVW3MwAAgD/cgsyzAzDuMwAAgD/M+rez8g31MwAAgD8y7KmznaP8MwAAgD9TyJ2zzVW3MwAAgD/cgsyz8g31MwAAgD8y7Kmz8g31MwAAgD8y7KmzCMH6MwAAgD+Ri4uznaP8MwAAgD9TyJ2zCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyznaP8MwAAgD9TyJ2z3cD6MwAAgD/e8lWzCMH6MwAAgD+Ri4uzgaP8MwAAgD9YMnyz3cD6MwAAgD/e8lWzgaP8MwAAgD9YMnyzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqz3cD6MwAAgD/e8lWzrk0CNAAAgD9uBpKzpOPuMwAAgD87wbqzrk0CNAAAgD9uBpKzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzyk0CNAAAgD8dUYqzpOPuMwAAgD87wbqzFCH2MwAAgD8q+puzwqoDNAAAgD+l+puzwPIStP//f7+C5JIzkhf0s///f79be5gzoPX/u6D1f7+x9IK8wPIStP//f7+C5JIzkhf0s///f79be5gzwPIStP//f7+C5JIzoPX/u6D1f7+x9IK8khf0s///f79be5gzv8zMOe//f7/AqLY6oPX/u6D1f7+x9IK8bakFtAAAgL+GMKQzv8zMOe//f7/AqLY6AUIOtAAAgL+OGpczbakFtAAAgL+GMKQzmqbnswAAgL+SGpczv8zMOe//f7/AqLY6bakFtAAAgL+GMKQzmqbnswAAgL+SGpczHnghtAAAgL+hdb0z27kXtAAAgL+aUJMzgnUEtAAAgL9OnpUzpVrxswAAgL9xpnQzrePuswAAgL81gZcz3WXnswAAgL/4SJczSPXjswAAgL97LKkz0OviswAAgL9QHYEzAAAAAAAAgL/ImsAzrePuswAAgL81gZczSPXjswAAgL97LKkzrePuswAAgL81gZcz27kXtAAAgL+aUJMzSPXjswAAgL97LKkz27kXtAAAgL+aUJMzpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zpVrxswAAgL9xpnQzHnghtAAAgL+hdb0zAAAAAAAAgL/ImsAz0OviswAAgL9QHYEzphrOswAAgL/Z2A00AAAAAAAAgL/ImsAzAtQEtP//f7+CAZUzgnUEtAAAgL9OnpUz0OviswAAgL9QHYEzphrOswAAgL/Z2A007jVyswAAgL99UmszJ+4YtAAAgL94J7czgnUEtAAAgL9OnpUz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czWpDyswAAgL9lP5sz3WXnswAAgL/4SJczJ+4YtAAAgL94J7czaeMMtAAAgL/ITIQzWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz09b1swAAgL9G2a4zWpDyswAAgL9lP5szaeMMtAAAgL/ITIQz2Av+swAAgL9O45cz09b1swAAgL9G2a4z2Av+swAAgL9O45cz09b1swAAgL9G2a4zhga8swAAgL851pIz2Av+swAAgL9O45czx7bOswAAgL8kEcQzhga8swAAgL851pIzx7bOswAAgL8kEcQzhga8swAAgL851pIzQxZNswAAgL9iH/8yx7bOswAAgL8kEcQzQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszQxZNswAAgL9iH/8yAAAAAAAAgL+uQpszAAAAAAAAgL+uQpszAUIOtAAAgL+OGpcznKbnswAAgL8XiaIzmqbnswAAgL+SGpczo3TDs///f78fbZYzAUIOtAAAgL+OGpczo3TDs///f78fbZYzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzo3TDs///f78fbZYzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gznKbnswAAgL8XiaIzUsgQtAAAgL9Au5gzYikNtAAAgL8zu5gzGizZswAAgL/hbZczUsgQtAAAgL9Au5gzSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zGizZswAAgL/hbZczSlvvswAAgL/3VLUzGizZswAAgL/hbZczSlvvswAAgL/3VLUzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5IzY5HgswAAgL+CyJ0zz122swAAgL8J5oszAG0otAAAgL9Pt5Izz122swAAgL8J5oszyl22s///f78f2KEzAG0otAAAgL9Pt5Ize1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzyl22s///f78f2KEzH23gswAAgL9A6JUzyl22s///f78f2KEzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzH23gswAAgL9A6JUzaZ0atAAAgL/IA5wzAtQEtP//f7+CAZUzW5AEtAAAgL8nZIUze1MEtAAAgL/ZmpIzao+rswAAgL/zg74zaZ0atAAAgL/IA5wzW5AEtAAAgL8nZIUzaZ0atAAAgL/IA5wzao+rswAAgL/zg74zAtQEtP//f7+CAZUzao+rswAAgL/zg74z7jVyswAAgL99UmszphrOswAAgL/Z2A007jVyswAAgL99UmszLQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/LQTfPQAAAABIen4/MATfPQAAAABHen4/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/tXdaPwAAAAALbwW/o6dRPwAAAAAm4xK/e5c9PwAAAABYAyy/e5c9PwAAAABYAyy/TYkmPwAAAACFaUK/TYkmPwAAAACFaUK/GtsMPwAAAACswVW/GtsMPwAAAACswVW/xOnhPgAAAADLuWW/xOnhPgAAAADLuWW/TY2mPgAAAADkEXK/TY2mPgAAAADkEXK/ohlRPgAAAAD1mXq/ohlRPgAAAAD1mXq/R6GjPQAAAAD+LX+/R6GjPQAAAAD+LX+/duE6vQAAAAD/uX+/duE6vQAAAAD/uX+/XZEuvgAAAAD4P3y/XZEuvgAAAAD4P3y/LNWVvgAAAADqyXS/LNWVvgAAAADqyXS/pAHSvgAAAADTd2m/pAHSvgAAAADTd2m/C28FvwAAAAC1d1q/C28FvwAAAAC1d1q/QMMfvwAAAACQBUi/QMMfvwAAAACQBUi/b5M3vwAAAABlazK/b5M3vwAAAABlazK/mX1MvwAAAAA0ARq/mX1MvwAAAAA0ARq/vC1evwAAAAD9Uf6+vC1evwAAAAD9Uf6+2V1svwAAAACJncS+2V1svwAAAACJncS+5BFyvwAAAABNjaa+5BFyvwAAAABNjaa+mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/mdOHPgAAAADU03a/mdOHPgAAAADS03a/5BFyPwAAAABNjaY+2V1sPwAAAACJncQ+2V1sPwAAAACJncQ+5BFyPwAAAABNjaY+vC1ePwAAAAD9Uf4+vC1ePwAAAAD9Uf4+mX1MPwAAAAA0ARo/mX1MPwAAAAA0ARo/b5M3PwAAAABlazI/b5M3PwAAAABlazI/QMMfPwAAAACQBUg/QMMfPwAAAACQBUg/C28FPwAAAAC1d1o/C28FPwAAAAC1d1o/pAHSPgAAAADTd2k/pAHSPgAAAADTd2k/LNGVPgAAAADqyXQ/LNGVPgAAAADqyXQ/XZEuPgAAAAD4P3w/XZEuPgAAAAD4P3w/duE6PQAAAAD/uX8/duE6PQAAAAD/uX8/R6GjvQAAAAD+LX8/R6GjvQAAAAD+LX8/ohlRvgAAAAD1mXo/ohlRvgAAAAD1mXo/TY2mvgAAAADkEXI/TY2mvgAAAADkEXI/xOnhvgAAAADLuWU/xOnhvgAAAADLuWU/GtsMvwAAAACswVU/GtsMvwAAAACswVU/TYkmvwAAAACFa0I/TYkmvwAAAACFa0I/e5c9vwAAAABYAyw/e5c9vwAAAABYAyw/o6dRvwAAAAAm4xI/o6dRvwAAAAAm4xI/xWlivwAAAADe6e4+xWlivwAAAADe6e4+03dpvwAAAACkAdI+03dpvwAAAACkAdI+SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/SAPfPQAAAABKen4/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/h5RRvwAAAAC/AhO/h5RRvwAAAAC/AhO/jJRRvwAAAAC1AhO/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/cS4tPwAAAAAeiDy/cS4tPwAAAAAeiDy/ay4tP7vkEzYhiDy/bS4tPwAAAAAiiDy/bS4tPwAAAAAiiDy/nKbnMwAAgD+9OpKzCSH2MwAAgD8IUYqzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzicxMuqv/fz+9H0q7CsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzA0IONAAAgD+/OpKzCsXeMwAAgD8tXaCznKbnMwAAgD+9OpKzwk0CNP//fz/8MWSzA0IONAAAgD+/OpKzCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzwk0CNP//fz/8MWSz6qbnMwAAgD8X4aizCSH2MwAAgD8IUYqzl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizl00CNAAAgD+QBpKzICzZMwAAgD+Opq+z6qbnMwAAgD8X4aizcpruM///fz99yJ2zdsYINAAAgD8pjIuzICzZMwAAgD+Opq+zdsYINAAAgD8pjIuzSPXjMwAAgD/u66mzcpruM///fz99yJ2zdsYINAAAgD8pjIuzy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzcpruM///fz99yJ2zy4zZMwAAgD8u2YqzSPXjMwAAgD/u66mzUsYINAAAgD8xJXyzy4zZMwAAgD8u2Yqz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2zUsYINAAAgD8xJXyz5N/8MwAAgD886JWzUsYINAAAgD8xJXyzpk3KMwAAgD9rqLOz5N/8MwAAgD886JWzmAQBNAAAgD9sAq2z63ehMwAAgD9VRxW0pk3KMwAAgD9rqLOzWmHdM///fz+CAZWzmAQBNAAAgD9sAq2zPAM1NAAAgD8Qo0mzpk3KMwAAgD9rqLOzPAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0PAM1NAAAgD8Qo0mz63ehMwAAgD9VRxW0WmHdM///fz+CAZWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzWmHdM///fz+CAZWz0OviMwAAgD8Nm5ezvdYFNAAAgD8+9m+zUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWzUHkhNAAAgD+HUmuzAAAAAAAAgD/o0mWz0OviMwAAgD8Nm5ez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzXsYINAAAgD8A8HezKKe1M///fz+odb2z3K/NMwAAgD8ozbmz0OviMwAAgD8Nm5ezbOD8MwAAgD+EVkKzp00CNAAAgD9/dpSzvdYFNAAAgD8+9m+z98IHNAAAgD8pwMWzXsYINAAAgD8A8Hez5u48NAAAgD+ZmsCzp00CNAAAgD9/dpSzbOD8MwAAgD+EVkKzXsYINAAAgD8A8HezbOD8MwAAgD+EVkKz98IHNAAAgD8pwMWzKKe1M///fz+odb2z98IHNAAAgD8pwMWzKKe1M///fz+odb2z5u48NAAAgD+ZmsCz3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzvdYFNAAAgD8+9m+z3K/NMwAAgD8ozbmzC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azC98BNAAAgD/hwoqzgpwCNAAAgD/AkKCz4dm7MwAAgD/a36azgpwCNAAAgD/AkKCzOqYZNAAAgD9XZHqz4dm7MwAAgD/a36azS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzS/YGNAAAgD+98iazOqYZNAAAgD9XZHqzJLAcNAAAgD8H2RyzFQmbMwAAgD9acRq0S/YGNAAAgD+98iazJLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzFQmbMwAAgD9acRq0JLAcNAAAgD8H2RyzLxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzFQmbMwAAgD9acRq0LxZNMwAAgD/+mbCzgQKZMwAAgD+uQpuzgQKZMwAAgD+uQpuzAAAAAKr/fz+5S1M7IGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzkhf0M///fz9V65CzIGzcMwAAgD98eKOzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7khf0M///fz9V65CzicxMuqv/fz+9H0q7AAAAAKr/fz+5S1M7CsXeMwAAgD8tXaCzAAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAAAAAACAPwAAAAAAAIA/AAAAAAAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAIC/AACAvwAAgD8AAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAAAAAACAPwAAAIAAAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIC/AACAvwAAgL8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgD8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8AAIA/AACAvwAAgL8u+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WS/LvnkPgAAAIAAAAAALvnkPi75ZL8AAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAu+WS/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8AAAAAAACAvwAAAIAAAAAALvnkPi75ZD8u+WQ/LvnkPgAAAIAAAAAAAACAvwAAAIAAAAAALvnkPi75ZL8u+WQ/LvnkPgAAAIAAAMA+AACAPwAAAD4AAIA+AADAPgAAAAAAACA/AABAPwAAID8AAAA/AAAgPwAAAAAAACA/AACAPgAAwD4AAEA/AAAAPgAAAD8AAMA+AABAPwAAwD4AAIA+AADAPgAAgD4AAMA+AACAPgAAwD4AAAA/AADAPgAAAD8AAMA+AAAAPwAAAwAHAAkABAAOAA8ABgAMAAsABQACAAgADQAKAAgACgABAPf/f7+xIdvAvv9/v/f/f7+xIdvAvv9/v/f/f7+xIdvAvv9/vwAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96NgAAADXYkA3B5f96Nvf/f7+xIdvAIACAP/f/f7+xIdvAIACAP/f/f7+xIdvAIACAPwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAvv9/vwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPwQAgD+xIdvAIACAPy35ZL8u+eS+AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAu+eS+Lflkvy35ZD8v+eS+AAAAgC35ZL8u+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgAAAAAAu+eS+LflkvwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAAAA0+eS+LPlkPwAAAAAAAIA/AAAAgC35ZD8v+eS+AAAAgAAAwD4AAIA/AADAPgAAAAAAAAA+AACAPgAAID8AAEA/AAAgPwAAAD8AACA/AAAAAAAAID8AAIA+AADAPgAAQD8AAMA+AABAPwAAAD4AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAADAAcACAAEAA0ADwAGAAwACgAFAAEACQAOAAsACQALAAIAG5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvrYC7sDrv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvkDuGr/rv1I+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvrYC7sDr9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+G5QrvkDuGr/r9Ue+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPrYC7sDrv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPkDuGr/rv1I+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPrYC7sDr9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+uyFvPkDuGr/r9Ue+//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/vwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/vwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/vwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//38///9/PwAAAAAAAACAAAAAAAAAAAD//38/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAAAAAAAAgL8AAACAAAAAAAAAAAD//3+///9/PwAAAAAAAACAAAAAAAAAAAD//3+/AAAAAAAAgD8AAACA//9/PwAAAAAAAACAAADAPgAAgD8AAAA+AACAPgAAwD4AAAAAAAAgPwAAgD8AACA/AAAAAAAAYD8AAIA+AADAPgAAQD8AAAA+AAAAPwAAwD4AAEA/AAAgPwAAQD8AACA/AABAPwAAYD8AAAA/AADAPgAAgD4AAMA+AACAPgAAwD4AAIA+AAAgPwAAgD4AACA/AACAPgAAID8AAIA+AADAPgAAAD8AAMA+AAAAPwAAwD4AAAA/AAAgPwAAAD8AACA/AAAAPwAAID8AAAA/AAADAAkAAAAJAAYACAAKABUACAAVABMAFAAXABEAFAARAA4ADQAPAAQADQAEAAIABwASAAwABwAMAAEAFgALAAUAFgAFABAA"}]}};var UA="#include <gl2_vert>\n\nattribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform float pointSize;\n\n//fbo pickingvert\n\n#include <fbo_picking_vert>\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    //gl_Positiondepth\n\n    fbo_picking_setData(gl_Position.w, true);\n\n}\n\n";const EA=[0,1e5,0],NA=[0,0,0],jA=[-1,-1,0,1,-1,0,-1,1,0,1,1,0],QA=[3,1,0,0,2,3],SA=[.1,.1,.1],kA=[],BA=[],RA=[],GA=[],YA=[],qA=[],VA=[],WA=[],_A=[0,-1,0],KA={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]},HA={4:[4,5],5:[4,5],7:[7,8],8:[7,8],9:[9,10,11],10:[9,10,11],11:[9,10,11]},JA=[6];class ZA{constructor(A,t,n,i,r){this.map=A,this.renderer=t,this.updateTRS(n,i,r),this.createPickHelper(),this.createHelperMeshes(),this.H(),this.registEvents(),this.mouseAction="moving",this.J=null,this.$=!0}registEvents(){const A=this.map;A.on("dom:mousemove",this.AA,this),A.on("dom:mousedown",this.tA,this),A.on("dom:mouseup",this.nA,this),A.on("zooming moving dragrotating",this.iA,this)}unregistEvents(){const A=this.map;A.off("dom:mousemove",this.AA,this),A.off("dom:mousedown",this.tA,this),A.off("dom:mouseup",this.nA,this),A.off("zooming moving dragrotating",this.iA,this)}AA(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();if(this.currentPickingObject=this.rA(this.currentMousePosition,t,"meshes"),"transform"===this.mouseAction){if("z-translate"===this.eA){const n=m(RA,t[9].localTransform);this.sA(!0,n,[this.uA[0]*Math.PI/180,this.uA[1]*Math.PI/180,this.uA[2]*Math.PI/180])}else if("y-rotate"===this.eA){const n=m(RA,t[4].localTransform);this.sA(!0,n,[90*Math.PI/180,0,-this.uA[2]])}else if("z-rotate"===this.eA){const n=m(RA,t[7].localTransform);this.sA(!0,n,[0,0,0])}}else this.sA(!1);this.oA(),this.hA(this.currentMousePosition)}oA(){this.fA(),this.currentPickingObject&&null!=this.currentPickingObject.meshId&&(this.lastPickingMeshId=this.currentPickingObject.pickingId,this.cA(this.currentPickingObject.pickingId,.6)),this.aA()}hA(A){if("transform"===this.mouseAction){const A=this.vA,t=this.rA(this.currentMousePosition,[A],"plane"),n=this.rA(this.lastMousePosition,[A],"plane");if(!t||null===t.meshId||!n||null===n.meshId)return;const i=[0,0,0];let r=0;if("z-translate"===this.eA){i[0]=t.point[0]-n.point[0],i[1]=t.point[1]-n.point[1],i[2]=t.point[2]-n.point[2];const A=this.lA(),r=B(i,A),e=function(A){var t=A[0],n=A[1],i=A[2];return Math.sqrt(t*t+n*n+i*i)}(i)*Math.cos(r),s=Math.sign(e)*Math.sqrt(Math.pow(e,2)/(Math.pow(A[0],2)+Math.pow(A[1],2)+Math.pow(A[2],2))),u=E(GA,A[0]*s,A[1]*s,A[2]*s);this.wA(u)}else"y-rotate"!==this.eA&&"z-rotate"!==this.eA||(r=this.PA(t.point,n.point,this.eA),this.gA(r,this.eA))}this.lastMousePosition=A,this.lastPickingObject=this.currentPickingObject,this.lastPickingMeshId=this.currentPickingObject.meshId}PA(A,t,n){const i=this.CA;let r,e;"y-rotate"===n?(r=K(VA,t[0]-i[0],t[2]-i[2]),e=K(WA,A[0]-i[0],A[2]-i[2])):"z-rotate"===n&&(r=K(VA,t[0]-i[0],t[1]-i[1]),e=K(WA,A[0]-i[0],A[1]-i[1]));const s=Math.atan2(r[1],r[0]);return(Math.atan2(e[1],e[0])-s)/Math.PI*180}wA(A){N(this.CA,this.CA,A),this.DA()}gA(A,t){"y-rotate"===t?this.uA[1]-=A:"z-rotate"===t&&(this.uA[2]+=A),this.DA()}DA(){const A=this.updateMatrix();b(A,A,SA);const t=this.getCntrollerMeshes();for(let n=0;n<t.length;n++){const i=t[n];let r=A;7!==n&&8!==n||(r=this.updateMatrixExcept(0),b(r,r,SA)),M(i.localTransform,r,i.nodeMatrix)}}aA(){this.renderer&&this.renderer.parentRenderer.setToRedraw()}tA(A){this.currentMousePosition={x:A.containerPoint.x,y:A.containerPoint.y};const t=this.getCntrollerMeshes();this.firstDownPoint=this.currentPickingObject=this.rA(this.currentMousePosition,t,"meshes"),this.currentPickingObject&&null!=this.currentPickingObject.meshId?(this.mouseAction="transform",this.IA(this.currentPickingObject.pickingId),this.map.config("zoomable",!1),this.map.config("draggable",!1),this.aA()):(this.mouseAction="pan",this.map.config("zoomable",!0),this.map.config("draggable",!0)),this.lastMousePosition=this.currentMousePosition,this.lastPickingObject=this.currentPickingObject,this.lastPickingMesh=t[this.currentPickingObject.meshId]}IA(A){HA[9].indexOf(A)>-1?this.eA="z-translate":HA[4].indexOf(A)>-1?this.eA="y-rotate":HA[7].indexOf(A)>-1&&(this.eA="z-rotate")}sA(A,t,n){const i=this.vA,r=t||i.originTranslation,e=function(A,t){var n=t[0],i=t[1],r=t[2],e=t[4],s=t[5],u=t[6],o=t[8],h=t[9],f=t[10];return A[0]=Math.sqrt(n*n+i*i+r*r),A[1]=Math.sqrt(e*e+s*s+u*u),A[2]=Math.sqrt(o*o+h*h+f*f),A}(BA,i.localTransform),s=W(kA,0,0,0);y(i.localTransform,s,r,e),A&&!this.MA()&&(x(i.localTransform,i.localTransform,n[2]),z(i.localTransform,i.localTransform,n[0]),d(i.localTransform,i.localTransform,n[1]))}MA(){if(this.map.getPitch())return!1;const A=this.map.cameraPosition,t=this.map.coordinateToPointAtRes(this.map.getCenter(),this.map.getGLRes());E(t,t.x,t.y,0);const n=this.bA.getCoordinates(),i=this.map.coordinateToPointAtRes(n,this.map.getGLRes()),r=this.bA.getTranslation(),e=E(RA,i.x,i.y,0),s=N(e,e,r);return B(j(GA,A,s),j(GA,A,t))<1/180*Math.PI}nA(){"transform"===this.mouseAction&&(this.firstDownPoint=null,this.$=!0),this.mouseAction="moving",this.eA=null,this.map.config("zoomable",!0),this.map.config("draggable",!0),this.aA()}iA(){this.$=!0}fA(){(function(A){return null==A})(this.lastPickingMeshId)||this.cA(this.lastPickingMeshId),this.map.resetCursor()}cA(A,t){const n=this.getCntrollerMeshes();if(JA.indexOf(A)<0){const i=HA[A];if(i)for(let A=0;A<i.length;A++){this.zA(n[i[A]],t)}else{this.zA(n[A],t)}}this.map.setCursor("pointer")}zA(A,t){const n=A.material.get("polygonFill");n[3]=t||A.originOpacity,A.material.set("polygonFill",n)}rA(A,t,n){const i=this.map;if(!(i&&this.G&&this.renderer&&this.renderer.canvas))return null;const r=i.getDevicePixelRatio(),e=A.x*r,s=A.y*r,u={projViewMatrix:this.map.projViewMatrix,pointSize:1};return!this.$&&this.dA&&this.dA===n||(this.G.render(t,u,!0),this.dA=n,this.$=!1),this.G.pick(e,s,10,u,{viewMatrix:this.map.viewMatrix,projMatrix:this.map.projMatrix,returnPoint:!0})}updateTRS(A,t,n){this.CA=U([],A),this.xA=U([],n),this.uA=U([],t)}updateMatrix(){const A=this.uA,t=this.CA,n=this.xA,i=G(kA);return V(i,i,A[2]*Math.PI/180),Y(i,i,A[0]*Math.PI/180),q(i,i,A[1]*Math.PI/180),y(YA,i,t,n)}updateMatrixExcept(){const A=U([],this.uA);A[0]=0;const t=this.CA,n=this.xA,i=G(kA);return V(i,i,A[2]*Math.PI/180),Y(i,i,A[0]*Math.PI/180),q(i,i,A[1]*Math.PI/180),y(qA,i,t,n)}lA(){const A=this.uA,t=I([]);return x(t,t,A[2]*Math.PI/180),z(t,t,A[0]*Math.PI/180),d(t,t,A[1]*Math.PI/180),k(GA,_A,t)}createPickHelper(){const t=new Q$7({POSITION:jA},QA,0,{primitive:"triangles",positionAttribute:"POSITION"}),n=t$1.Util.extend({},KA,{polygonFill:[0,0,0,.001]});this.vA=new Be$5(t,new Ie$5(n)),this.vA.setUniform("uPickingId",12);const i=I([]),r=W([],0,0,0);this.vA.originRotation=[0,0,0],y(i,r,this.CA,[3,3,3]),this.vA.originTranslation=this.CA,this.vA.localTransform=i,this.vA.transparent=!0,this.vA.setDefines({HAS_HELPERPARTS:1,HAS_PICKING_ID:2})}createHelperMeshes(){this.mA=this.yA("helper"),this.pA=[],this.pA.push(...this.mA),this.pA.push(this.vA)}getPickHelperMesh(){return this.vA}getCntrollerMeshes(){return this.mA}getAllMeshes(){return this.pA.length<12&&this.pA.push(...this.mA),this.pA}createProjViewMatrix(){const A=this.updateMatrix(),t=k([],NA,A),n=k([],EA,A),i=Math.sqrt(Math.pow(n[0]-t[0],2)+Math.pow(n[1]-t[1],2)+Math.pow(n[2]-t[2],2));return M([],function(A,t,n,i,r,e,s){var u=1/(t-n),o=1/(i-r),h=1/(1-s);return A[0]=-2*u,A[1]=0,A[2]=0,A[3]=0,A[4]=0,A[5]=-2*o,A[6]=0,A[7]=0,A[8]=0,A[9]=0,A[10]=2*h,A[11]=0,A[12]=(t+n)*u,A[13]=(r+i)*o,A[14]=(s+1)*h,A[15]=1,A}([],-this.xA[0],this.xA[1],-this.xA[0],this.xA[1],0,i),L([],n,t,[0,0,1]))}yA(t){const n=[],i=function(t){return Dt$6.loadGLTF("",FA[t]).then((A=>A))}(t),r=this.updateMatrix();return b(r,r,SA),i.then((t=>{Dt$6.exportGLTFPack(t).getMeshesInfo().forEach(((t,i)=>{const e=t.materialInfo||{};e.polygonFill=6===i?[1,1,1,.1]:[1,1,1,1],t$1.Util.extend(e,KA,e);const s=new Ie$5(e),u=new Be$5(t.geometry,s);u.setUniform("uPickingId",i);const o=u.getDefines();if(o.HAS_HELPERPARTS=1,o.HAS_PICKING_ID=2,u.setDefines(o),u.nodeMatrix=t.nodeMatrix,u.originTransform=function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[3],A[4]=t[4],A[5]=t[5],A[6]=t[6],A[7]=t[7],A[8]=t[8],A[9]=t[9],A[10]=t[10],A[11]=t[11],A[12]=t[12],A[13]=t[13],A[14]=t[14],A[15]=t[15],A}([],u.localTransform),7===i||8===i){const A=this.updateMatrixExcept(0);b(A,A,SA),M(u.localTransform,A,u.nodeMatrix)}else M(u.localTransform,r,u.nodeMatrix);u.originOpacity=6===i?.1:1,u.transparent=!0,n.push(u)}))})),n}H(){this.pickingFBO=this.renderer.regl.framebuffer(this.renderer.canvas.width,this.renderer.canvas.height),this.G=new Cr$4(this.renderer,{vert:UA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,t){return M([],t.projViewMatrix,t.modelMatrix)}}]},this.pickingFBO,this.map)}LA(){this.unregistEvents(),this.dispose()}dispose(){this.getAllMeshes().forEach((A=>{A.geometry.dispose(),A.dispose()})),this.pickingFBO&&this.pickingFBO.destroy()}resize(A,t){this.pickingFBO.width===A&&this.pickingFBO.height===t||this.pickingFBO.resize(A,t)}}class XA extends vn$4{constructor(A={}){const t=[],n=[],i=A.uniforms,r=[{name:"modelNormalMatrix",type:"function",fn:function(A,n){return function(A,t){return A[0]=t[0],A[1]=t[1],A[2]=t[2],A[3]=t[4],A[4]=t[5],A[5]=t[6],A[6]=t[8],A[7]=t[9],A[8]=t[10],A}(t,n.modelMatrix)}},{name:"modelViewMatrix",type:"function",fn:function(A,t){return M(n,t.viewMatrix,t.modelMatrix)}}];i&&r.push(...i),super({vert:"#include <gl2_vert>\n\nattribute vec3 aPosition;\n\n#include <line_extrusion_vert>\n\n\n\n#ifdef HAS_MAP\n\n    uniform vec2 uvScale;\n\n    uniform vec2 uvOffset;\n\n    attribute vec2 aTexCoord;\n\n    varying vec2 vTexCoord;\n\n#endif\n\n#if defined(HAS_COLOR)\n\n    attribute vec4 aColor;\n\n    varying vec4 vColor;\n\n#elif defined(HAS_COLOR0)\n\n    attribute vec4 aColor0;\n\n    varying vec4 vColor;\n\n#endif\n\n\n\nvarying vec3 vFragPos;\n\nvarying vec3 vNormal;\n\n\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat3 modelNormalMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform vec2 halton;\n\nuniform vec2 outSize;\n\n\n\nuniform mat4 projViewMatrix;\n\n\n\n#include <get_output>\n\n#include <heatmap_render_vert>\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n    #include <vsm_shadow_vert>\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    attribute float aExtrusionOpacity;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_TANGENT)\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\nuniform mat4 cut_projViewMatrixFromViewpoint;\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n) {\n\n    n = vec3( 0.0,  0.0,  1.0) +\n\n        vec3( 2.0, -2.0, -2.0) * q.x * q.zwx +\n\n        vec3( 2.0,  2.0, -2.0) * q.y * q.wzy;\n\n}\n\n\n\n\n\nvoid toTangentFrame(const highp vec4 q, out highp vec3 n, out highp vec3 t) {\n\n    toTangentFrame(q, n);\n\n    t = vec3( 1.0,  0.0,  0.0) +\n\n        vec3(-2.0,  2.0, -2.0) * q.y * q.yxw +\n\n        vec3(-2.0,  2.0,  2.0) * q.z * q.zwx;\n\n}\n\n\n\n\n\nvoid main()\n\n{\n\n    #ifdef IS_LINE_EXTRUSION\n\n        vec4 localPosition = getPosition(getLineExtrudePosition(aPosition));\n\n    #else\n\n        vec4 localPosition = getPosition(aPosition);\n\n    #endif\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n\n\n    vFragPos = vec3(modelMatrix * localPositionMatrix * localPosition);\n\n\n\n    #if defined(HAS_NORMAL) || defined(HAS_TANGENT)\n\n        mat3 localNormalMatrix = modelNormalMatrix * mat3(localPositionMatrix);\n\n        vec3 Normal;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t;\n\n            toTangentFrame(aTangent, Normal, t);\n\n            vTangent = vec4(localNormalMatrix * t, aTangent.w);\n\n        #else\n\n            #ifdef HAS_DECODE_NORMAL\n\n                Normal = getNormal(aNormal);\n\n            #else\n\n                Normal = aNormal;\n\n            #endif\n\n        #endif\n\n        vec3 localNormal = appendMorphNormal(Normal);\n\n        vNormal = normalize(localNormalMatrix * localNormal);\n\n    #else\n\n        vNormal = vec3(0.0);\n\n    #endif\n\n\n\n    mat4 jitteredProjection = projMatrix;\n\n    jitteredProjection[2].xy += halton.xy / outSize.xy;\n\n    gl_Position = jitteredProjection * modelViewMatrix * localPositionMatrix * localPosition;\n\n    #ifdef HAS_MAP\n\n        vec2 TexCoord = decode_getTexcoord(aTexCoord);\n\n        vTexCoord = TexCoord * uvScale + uvOffset;\n\n    #endif\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        vExtrusionOpacity = aExtrusionOpacity;\n\n    #endif\n\n    #if defined(HAS_COLOR)\n\n        vColor = aColor / 255.0;\n\n    #elif defined(HAS_COLOR0)\n\n        vColor = aColor0 / 255.0;\n\n    #endif\n\n    cut_positionFromViewpoint = cut_projViewMatrixFromViewpoint * modelMatrix * localPositionMatrix * localPosition;\n\n}\n\n",frag:"precision mediump float;\n\n#include <gl2_frag>\n\n\n\nuniform vec4 baseColorFactor;\n\nuniform float materialShininess;///\n\nuniform float opacity;\n\nuniform float environmentExposure;\n\nuniform float specularStrength;\n\n\n\nuniform vec3 light0_viewDirection;\n\nuniform vec3 ambientColor;\n\nuniform vec4 light0_diffuse;\n\nuniform vec3 lightSpecular;\n\nuniform vec3 cameraPosition;\n\n\n\n#ifdef HAS_TANGENT\n\n    varying vec4 vTangent;\n\n#endif\n\n\n\n#ifdef HAS_MAP\n\n    varying vec2 vTexCoord;\n\n#endif\n\nvarying vec3 vNormal;\n\nvarying vec3 vFragPos;\n\n\n\n#ifdef HAS_INSTANCE_COLOR\n\n    varying vec4 vInstanceColor;\n\n#endif\n\n\n\n#ifdef HAS_BASECOLOR_MAP\n\n    uniform sampler2D baseColorTexture;\n\n#endif\n\n\n\n#ifdef HAS_EXTRUSION_OPACITY\n\n    uniform vec2 extrusionOpacityRange;\n\n    varying float vExtrusionOpacity;\n\n#endif\n\n\n\n#if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n    varying vec4 vColor;\n\n#elif defined(IS_LINE_EXTRUSION)\n\n    uniform vec4 lineColor;\n\n#else\n\n    uniform vec4 polygonFill;\n\n#endif\n\n\n\n#ifdef IS_LINE_EXTRUSION\n\n    uniform float lineOpacity;\n\n#else\n\n    uniform float polygonOpacity;\n\n#endif\n\n\n\n#ifdef HAS_OCCLUSION_MAP\n\n    uniform sampler2D occlusionTexture;\n\n#endif\n\n\n\n#ifdef HAS_NORMAL_MAP\n\n    uniform sampler2D normalTexture;\n\n#endif\n\n\n\n#ifdef HAS_EMISSIVE_MAP\n\n    uniform sampler2D emissiveTexture;\n\n#endif\n\n\n\n#ifdef SHADING_MODEL_SPECULAR_GLOSSINESS\n\n    uniform vec4 diffuseFactor;\n\n    uniform vec3 specularFactor;\n\n    #ifdef HAS_DIFFUSE_MAP\n\n        uniform sampler2D diffuseTexture;\n\n    #endif\n\n    #ifdef HAS_SPECULARGLOSSINESS_MAP\n\n        uniform sampler2D specularGlossinessTexture;\n\n    #endif\n\n#endif\n\n#include <heatmap_render_frag>\n\n\n\n#if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n  #include <vsm_shadow_frag>\n\n#endif\n\nvarying vec4 cut_positionFromViewpoint;\n\n\n\nvec3 transformNormal() {\n\n    #if defined(HAS_NORMAL_MAP)\n\n        vec3 n = normalize(vNormal);\n\n        vec3 normal = texture2D(normalTexture, vTexCoord).xyz * 2.0 - 1.0;\n\n        #if defined(HAS_TANGENT)\n\n            vec3 t = normalize(vTangent.xyz);\n\n            vec3 b = normalize(cross(n, t) * sign(vTangent.w));\n\n            mat3 tbn = mat3(t, b, n);\n\n            return normalize(tbn * normal);\n\n        #else\n\n            return normalize(normal);\n\n        #endif\n\n    #else\n\n        return normalize(vNormal);\n\n    #endif\n\n}\n\n\n\nvec4 linearTosRGB(const in vec4 color) {\n\n    return vec4( color.r < 0.0031308 ? color.r * 12.92 : 1.055 * pow(color.r, 1.0/2.4) - 0.055, color.g < 0.0031308 ? color.g * 12.92 : 1.055 * pow(color.g, 1.0/2.4) - 0.055, color.b < 0.0031308 ? color.b * 12.92 : 1.055 * pow(color.b, 1.0/2.4) - 0.055, color.a);\n\n}\n\n\n\nvec4 getBaseColor() {\n\n    #if defined(HAS_BASECOLOR_MAP)\n\n        return texture2D(baseColorTexture, vTexCoord);\n\n    #elif defined(HAS_DIFFUSE_MAP)\n\n        return texture2D(diffuseTexture, vTexCoord);\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return diffuseFactor;\n\n    #else\n\n        return baseColorFactor;\n\n    #endif\n\n}\n\n\n\nvec3 getSpecularColor() {\n\n    #if defined(HAS_SPECULARGLOSSINESS_MAP)\n\n        return texture2D(specularGlossinessTexture, vTexCoord).rgb;\n\n    #elif defined(SHADING_MODEL_SPECULAR_GLOSSINESS)\n\n        return specularFactor;\n\n    #else\n\n        return vec3(1.0);\n\n    #endif\n\n}\n\n\n\nvoid main() {\n\n    //\n\n    vec4 baseColor = getBaseColor();\n\n    vec3 ambient = environmentExposure * ambientColor * baseColor.rgb;\n\n\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        ambient *= vInstanceColor.rgb;\n\n    #endif\n\n\n\n    //\n\n    vec3 norm = transformNormal();\n\n    vec3 lightDir = normalize(-light0_viewDirection);\n\n    float diff = max(dot(norm, lightDir), 0.0);\n\n    vec3 diffuse = light0_diffuse.rgb * diff * baseColor.rgb;\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        vec3 color = vColor.rgb;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        vec3 color = lineColor.rgb;\n\n    #else\n\n        vec3 color = polygonFill.rgb;\n\n    #endif\n\n    #ifdef HAS_INSTANCE_COLOR\n\n        color *= vInstanceColor.rgb;\n\n    #endif\n\n    ambient *= color.rgb;\n\n    diffuse *= color.rgb;\n\n\n\n    //\n\n    vec3 viewDir = normalize(cameraPosition - vFragPos);\n\n    vec3 halfwayDir = normalize(lightDir + viewDir);\n\n    float spec = pow(max(dot(norm, halfwayDir), 0.0), materialShininess);\n\n    vec3 specular = specularStrength * lightSpecular * spec * getSpecularColor();\n\n    #ifdef HAS_OCCLUSION_MAP\n\n        float ao = texture2D(occlusionTexture, vTexCoord).r;\n\n        ambient *= ao;\n\n    #endif\n\n    #if defined(HAS_SHADOWING) && !defined(HAS_BLOOM)\n\n        float shadowCoeff = shadow_computeShadow();\n\n        diffuse = shadow_blend(diffuse, shadowCoeff).rgb;\n\n        specular = shadow_blend(specular, shadowCoeff).rgb;\n\n    #endif\n\n    vec3 result = ambient + diffuse + specular;\n\n\n\n    #ifdef HAS_EMISSIVE_MAP\n\n        vec3 emit = texture2D(emissiveTexture, vTexCoord).rgb;\n\n        result += emit;\n\n    #endif\n\n    vec3 shadowCoord = (cut_positionFromViewpoint.xyz / cut_positionFromViewpoint.w)/2.0 + 0.5;\n\n    if (shadowCoord.x > 0.0 && shadowCoord.x < 1.0 && shadowCoord.y > 0.0 && shadowCoord.y < 1.0 && shadowCoord.z < 1.0) {\n\n        discard;\n\n    }\n\n    glFragColor = vec4(result, opacity);\n\n    // glFragColor = linearTosRGB(glFragColor);\n\n    #if defined(HAS_COLOR) || defined(HAS_COLOR0)\n\n        float colorAlpha = vColor.a;\n\n    #elif defined(IS_LINE_EXTRUSION)\n\n        float colorAlpha = lineColor.a;\n\n    #else\n\n        float colorAlpha = polygonFill.a;\n\n    #endif\n\n        glFragColor *= colorAlpha;\n\n    #ifdef HAS_EXTRUSION_OPACITY\n\n        float topAlpha = extrusionOpacityRange.x;\n\n        float bottomAlpha = extrusionOpacityRange.y;\n\n        float alpha = topAlpha + vExtrusionOpacity * (bottomAlpha - topAlpha);\n\n        alpha = clamp(alpha, 0.0, 1.0);\n\n        glFragColor *= alpha;\n\n    #endif\n\n\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:r,defines:A.defines||{},extraCommandProps:A.extraCommandProps||{}}),this.version=300}}const $A=[0,0,0,1],At={lightAmbient:[1,1,1],lightDiffuse:[1,1,1],lightSpecular:[1,1,1],lightDirection:[1,1,1]};class tt extends H{h(){this.TA=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.OA=new vn$4({vert:TA,frag:OA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>M([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.FA=new vn$4({vert:TA,frag:OA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>M([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u,depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.UA=new XA({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"}}}),this.EA=new XA({extraCommandProps:{viewport:this.u,blend:{enable:(A,t)=>!!t.meshConfig.transparent,func:{srcRGB:"src alpha",srcAlpha:1,dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"},equation:"add"},depth:{enable:!0,func:"always",mask:!1,range:[0,0]}}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.NA=new Ke$5,this.jA=new Ke$5,this.F=new Ke$5}QA(A,t,n,i){this.controller=new ZA(A,this.renderer,t,n,i)}SA(A,t,n){this.controller&&(this.controller.updateTRS(A,t,n),this.controller.DA(),this.controller.aA())}render(A,t){this.U(),this.renderer.clear({color:$A,depth:1,framebuffer:this.T});const n=this.kA(A),i=this.controller.getAllMeshes(),r=this.controller.createProjViewMatrix();return this.BA(n,i,r,t.map),this.RA(n,i,r,t.map),{meshesMap:this.TA,invisibleMap:this.T}}kA(t){const n=[];for(let i=0;i<t.length;i++){const r=t$1.Util.extend({},t[i].material.uniforms,At),e=new Ie$5(r),s=new Be$5(t[i].geometry,e),u=s.getDefines();u.HAS_CUT=1,s.setDefines(u),s.localTransform=t[i].localTransform,n.push(s)}return n}RA(A,t,n,i){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.T});const r={cut_projViewMatrixFromViewpoint:n,projViewMatrix:i.projViewMatrix};this.F.setMeshes(A),this.renderer.render(this.OA,r,this.F,this.T),this.F.setMeshes(t),this.renderer.render(this.FA,r,this.F,this.T)}BA(t,n,i,r){this.renderer.clear({color:[0,0,0,0],depth:1,framebuffer:this.TA});const e=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,s=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height,u={projMatrix:r.projMatrix,cut_projViewMatrixFromViewpoint:i,projViewMatrix:r.projViewMatrix,viewMatrix:r.viewMatrix,cameraPosition:r.cameraPosition,altitudeScale:1,outSize:[e,s],halton:[.2107,-.0202],polygonFill:[1,1,1,1],polygonOpacity:1};!function(t,n,i,r){const{iblTexes:e,dfgLUT:s}=fi$4.PBRUtils.getIBLResOnCanvas(n);if(i&&i.getLights()){const n=fi$4.PBRUtils.getPBRUniforms(i,e,s,r,r),u=i.getLights();t.ambientColor=u.ambient&&u.ambient.color?u.ambient.color:[1,1,1],n&&t$1.Util.extend(t,n)}else{const n=fi$4.PBRUtils.getPBRUniforms(i,null,s,r,r);t$1.Util.extend(t,n)}}(u,this.renderer.canvas,r),this.NA.setMeshes(t),this.renderer.render(this.UA,u,this.NA,this.TA),this.jA.setMeshes(n),this.renderer.render(this.EA,u,this.jA,this.TA)}dispose(){this.T&&this.T.destroy(),this.C&&this.C.dispose(),this.GA&&this.GA.dispose(),this.controller&&this.controller.LA()}U(){const A=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t),!this.TA||this.TA.width===A&&this.TA.height===t||this.TA.resize(A,t),this.controller&&this.controller.resize(A,t)}}const it=[0,0,0,1,1,-1,1,-1,-1,1,-1,1,1,1,1,1,0,0],rt=[0,1,0,2,0,3,0,4,1,2,2,3,3,4,4,1,0,5],et=[],st=G([]),ut=G([]),ot=[],ht=[1,0,0],ft=[],ct=[],at=[],vt=new t$1.Point(0,0),lt=[0,0,0,1];let wt=.01;class Pt extends H{h(){super.h(),this.qA=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 viewshed_projViewMatrixFromViewpoint;\n\nvarying vec4 viewshed_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    viewshed_positionFromViewpoint = viewshed_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n    gl_PointSize = 1.0;\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 viewshed_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\nuniform float near;\n\nuniform float far;\n\n#ifdef HAS_HELPERLINE\n\n  uniform vec3 lineColor;\n\n#endif\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nfloat linear(float value) {\n\n    float z = value * 2.0 - 1.0;\n\n    return (2.0 * near * far) / (far + near - z * (far - near));\n\n}\n\n\n\nvoid main() {\n\n    #ifdef HAS_HELPERLINE\n\n        gl_FragColor = vec4(lineColor, 0.009);\n\n    #else\n\n        vec3 shadowCoord = (viewshed_positionFromViewpoint.xyz / viewshed_positionFromViewpoint.w)/2.0 + 0.5;\n\n        vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n        float depth = unpackRGBAToDepth(rgbaDepth);\n\n        float linearZ = linear(shadowCoord.z);\n\n        float linearDepth = linear(depth);\n\n        if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && linearZ >= near && linearZ <= far - near) {\n\n            if (linearZ / far <= linearDepth / (far - near)) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);\n\n        }\n\n    #endif\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>M([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Q$7({POSITION:it},rt,0,{primitive:"lines",positionAttribute:"POSITION"});this.VA=new Be$5(t,new Ce$5({lineColor:[.8,.8,.1]}));const n=this.VA.getDefines();n.HAS_HELPERLINE=1,this.VA.setDefines(n),this.F=new Ke$5}render(A,t){const{eyePos:n,lookPoint:i,horizontalAngle:r,verticalAngle:e}=t;if(!this.m(r,e)||!n||!i)return this.T;this.C||this.D(r,e),this.U(r,e),this.renderer.clear({color:lt,depth:1,framebuffer:this.T}),this.VA.localTransform=this.WA(n,i,r,e),A.push(this.VA),this.F.setMeshes(A);const{projViewMatrixFromViewpoint:s,far:u}=this._A(n,i,e,r);return this.g(this.F,s,u),this.KA(this.F,s,t.projViewMatrix,u),this.T}WA(A,t,n,i){const r=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));r<=0&&console.warn("both lookpoint and eyePos are in the same position");const e=I(et),s=E(ot,t[0]-A[0],t[1]-A[1],t[2]-A[2]),u=n*Math.PI/360,o=i*Math.PI/360;let h=B(ht,E(ft,s[0],s[1],0));h=s[1]>=0?h:2*Math.PI-h;const f=V(st,ut,h);let c=B(E(ct,s[0],s[1],0),s);return c=s[0]>=0?-c:2*Math.PI-c,q(f,f,c),y(e,f,A,[r,r*Math.tan(u),r*Math.tan(o)]),e}HA(A){const t=this.VA.localTransform,n=[],i=A.getGLRes();for(let r=1;r<(it.length-3)/3;r++){at[0]=it[3*r],at[1]=it[3*r+1],at[2]=it[3*r+2];const e=k([],at,t);vt.set(e[0],e[1]);const s=A.pointAtResToCoord(vt,i),u=A.pointAtResToAltitude(e[2],i);s.z=u,n.push(s)}return n}KA(A,t,n,i){this.renderer.render(this.qA,{viewshed_projViewMatrixFromViewpoint:t,projViewMatrix:n,near:wt,far:i,depthMap:this.l,minAltitude:0},A,this.T)}_A(A,t,n,i){const r=n/i,e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return wt=e/100,{projViewMatrixFromViewpoint:M([],p([],i*Math.PI/180,r,wt,e),L([],A,t,[0,1,0])),far:e}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.qA&&this.qA.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(A,t){const n=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,i=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.l&&this.l.width/this.l.height!=A/t){const n=this.I(A,t);n&&this.l.resize(n.width,n.height)}}}class Ct extends H{render(A,{projViewMatrix:t,lineColor:n,lineWidth:i}){return A&&A.length?(this.JA(),this.U(),this.F.setMeshes(A),this.ZA(this.F,t),this.XA(n,i,this.T),this.T):null}h(){this.fboExtent=this.$A();const t=this.u;this.extentShader=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>  \n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    gl_Position = projViewMatrix * modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}",frag:"precision highp float;\n\nvoid main() {\n\n    gl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n\n}",extraCommandProps:{viewport:t,cull:{enable:!1}}}),this.outlineShader=new Mn$4({vert:"#if __VERSION__ == 300\n\n\t#define attribute in\n\n\t#define varying out\n\n#endif\n\n\n\nattribute vec2 aPosition;\n\nattribute vec2 aTexCoord;\n\n\n\nvarying vec2 vTexCoord;\n\n\n\nvoid main()\n\n{\n\n  gl_Position = vec4(aPosition, 0., 1.);\n\n  vTexCoord = aTexCoord;\n\n}\n\n",frag:"precision highp float;\n\nprecision highp int;\n\n\n\nvarying vec2 vTexCoord;\n\nuniform sampler2D maskTexture;\n\nuniform vec2 texSize;\n\nuniform vec3 visibleEdgeColor;\n\nuniform float lineWidth;\n\nvoid main() {\n\n    vec2 invSize = (1.0 / texSize) * lineWidth;\n\n    vec4 uvOffset = vec4(1.0, 0.0, 0.0, 1.0) * vec4(invSize.x, invSize.y, invSize.x, invSize.y);\n\n    vec4 c1 = texture2D(maskTexture, vTexCoord + uvOffset.xy);\n\n    vec4 c2 = texture2D(maskTexture, vTexCoord - uvOffset.xy);\n\n    vec4 c3 = texture2D(maskTexture, vTexCoord + uvOffset.yw);\n\n    vec4 c4 = texture2D(maskTexture, vTexCoord - uvOffset.yw);\n\n    float diff1 = (c1.r - c2.r)*0.7;\n\n    float diff2 = (c3.r - c4.r)*0.7;\n\n    float d = length(vec2(diff1, diff2) );\n\n    float a1 = min(c1.g, c2.g);\n\n    float a2 = min(c3.g, c4.g);\n\n    float visibilityFactor = min(a1, a2);\n\n    gl_FragColor = 1.0 - visibilityFactor > 0.001 ? vec4(visibleEdgeColor, 1.0) * vec4(d) : vec4(0.0);\n\n}",extraCommandProps:{viewport:t,depth:{enable:!0,mask:!1,func:"always"},blend:{enable:!0,func:{src:"one",dst:"one minus src alpha"},equation:"add"}}}),this.T=this.regl.framebuffer({color:this.regl.texture({width:t.width(),height:t.height(),wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.F=new Ke$5}ZA(A,t){this.renderer.render(this.extentShader,{projViewMatrix:t,minAltitude:0},A,this.fboExtent)}XA(A,t,n){this.renderer.render(this.outlineShader,{texSize:[n.width,n.height],visibleEdgeColor:A||[1,0,0],maskTexture:this.fboExtent,lineWidth:t||1,minAltitude:0},null,n)}$A(){return this.regl.framebuffer({color:this.regl.texture({width:2,height:2,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}getRenderMeshes(){return this.F.getMeshes()}JA(){this.regl.clear({color:[1,1,1,1],depth:1,framebuffer:this.fboExtent})}dispose(){this.fboExtent&&(this.fboExtent.destroy(),this.extentShader.dispose(),this.outlineShader.dispose(),delete this.fboExtent),this.T&&(this.T.destroy(),delete this.T)}U(){const A=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;this.T.width===A&&this.fboExtent.height===t||this.T.resize(A,t),this.fboExtent.width===A&&this.fboExtent.height===t||this.fboExtent.resize(A,t)}}const Dt="undefined"==typeof document?null:document.createElement("canvas");class Mt extends H{h(){this.O=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projViewMatrix * worldPosition;\n\n    flood_height = worldPosition.z;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform float waterHeight;\n\nuniform sampler2D extentMap;\n\nuniform float hasExtent;\n\nuniform float type;\n\nvarying float flood_height;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    bool compare = type == 1.0 ? flood_height < waterHeight : flood_height >= waterHeight;\n\n    if (compare) {\n\n        if (hasExtent == 1.0) {\n\n            if (extentColor.r > 0.0) {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n            } else {\n\n                gl_FragColor = vec4(0.0);\n\n            }\n\n        } else {\n\n            gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new Ke$5(t);return this.it(i,n),this.T}it(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,t,A,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const A=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}}const bt=[.1451,.2588,.4863],zt=[0,0,0,0];class dt extends LA{constructor(A){super(A),this.type="floodAnalysis"}YA(A){const t=this.layer.getMap();if(this.q={},this.q.waterHeight=X(t,this.options.waterHeight),this.q.waterOpacity=this.options.waterOpacity,this.q.waterColor=this.options.waterColor,this.q.extent=zt,this.q.extentMap=A.regl.texture({width:2,height:2}),this.q.hasExtent=0,this.q.type=1,this.options.boundary){const{extentMap:A,extentInWorld:t}=this.V(this.options.boundary);this.q.extent=t,this.q.extentMap=A,this.q.hasExtent=1}this.q.projViewMatrix=t.projViewMatrix,this.q.minAltitude=0}S(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t);const i=new B$6(t.regl);this.k=this.k||new Mt(i,n),this.layer.addAnalysis(this)}update(A,t){if("boundary"===A){const{extentMap:A,extentInWorld:n,extentPolygon:i}=this.V(t);this.q.extent=n,this.q.extentPolygon=i,this.q.extentMap=A}else if("waterHeight"===A){const A=this.layer.getMap();this.q.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}else this.q[A]=t;super.update(A,t)}renderAnalysis(A){const t={};return this.options.boundary&&this.B.render(this.R,this._),t.flood_waterColor=this.q.waterColor||bt,t.flood_waterOpacity=this.q.waterOpacity||.6,t.floodMap=this.k.render(A,this.q),t}getDefines(){return{HAS_FLOODANALYSE:1}}}const xt=[0,0,0,1,0,0],mt=[0,1],yt=[],pt=[0,0,0,1];class Lt extends H{h(){super.h(),this.rt=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 insight_projViewMatrixFromViewpoint;\n\nvarying vec4 insight_positionFromViewpoint;\n\n#include <get_output>\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 localPosition = localPositionMatrix * getPosition(aPosition);\n\n    gl_Position = projViewModelMatrix * localPosition;\n\n    insight_positionFromViewpoint = insight_projViewMatrixFromViewpoint * modelMatrix * localPosition;\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nvarying vec4 insight_positionFromViewpoint;\n\nuniform sampler2D depthMap;\n\n\n\nconst float UnpackDownscale = 255. / 256.;\n\nconst vec3 PackFactors = vec3(256. * 256. * 256., 256. * 256., 256.);\n\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1.);\n\nfloat unpackRGBAToDepth(const in vec4 v) {\n\n    return dot(v, UnpackFactors);\n\n}\n\n\n\nvoid main() {\n\n    vec3 shadowCoord = (insight_positionFromViewpoint.xyz / insight_positionFromViewpoint.w)/2.0 + 0.5;\n\n    vec4 rgbaDepth = texture2D(depthMap, shadowCoord.xy);\n\n    float depth = unpackRGBAToDepth(rgbaDepth); // Retrieve the z-value from R\n\n    if (shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0 && shadowCoord.z <= 1.0) {\n\n        if (depth <0.001) {\n\n            gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n        } else {\n\n            if (shadowCoord.z <= depth + 0.002) {\n\n                gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0);//,green\n\n            } else {\n\n                gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);//,red\n\n            }\n\n        }\n\n    } else {\n\n        gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0);//,blue\n\n    }\n\n}\n\n\n\n",uniforms:[{name:"projViewModelMatrix",type:"function",fn:(A,t)=>M([],t.projViewMatrix,t.modelMatrix)}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0});const t=new Q$7({POSITION:xt},mt,0,{primitive:"lines",positionAttribute:"POSITION"});this.et=t,this.VA=new Be$5(t,new Ce$5({lineColor:[.8,.8,.1]})),this.F=new Ke$5}render(A,t){const{lines:n,horizontalAngle:i,verticalAngle:r}=t;this.C||this.D(i,r),this.U(i,r),this.renderer.clear({color:pt,depth:1,framebuffer:this.T});const e=I(yt);this.VA.localTransform=e;for(let e=0;e<n.length;e++){const{from:s,to:u}=n[e];if(!this.m(i,r)||!s||!u)continue;const{projViewMatrixFromViewpoint:o,far:h}=this._A(s,u,i,r);this.F.setMeshes(A),this.g(this.F,o,h),this.st(s,u),this.F.setMeshes(this.VA),this.ut(this.F,o,t.projViewMatrix)}return this.T}st(t,n){this.et&&(this.et.dispose(),this.VA.dispose(),xt[0]=t[0],xt[1]=t[1],xt[2]=t[2],xt[3]=n[0],xt[4]=n[1],xt[5]=n[2],this.et=new Q$7({POSITION:xt},mt,0,{primitive:"lines",positionAttribute:"POSITION"}),this.VA=new Be$5(this.et,new Ce$5({lineColor:[.8,.8,.1]})))}ut(A,t,n){this.renderer.render(this.rt,{insight_projViewMatrixFromViewpoint:t,projViewMatrix:n,depthMap:this.l},A,this.T)}_A(A,t,n,i){const r=n/i,e=Math.sqrt(Math.pow(A[0]-t[0],2)+Math.pow(A[1]-t[1],2)+Math.pow(A[2]-t[2],2));return{projViewMatrixFromViewpoint:M([],p([],i*Math.PI/180,r,1,e+1e3),L([],A,t,[0,1,0])),far:e}}dispose(){super.dispose(),this.T&&this.T.destroy(),this.rt&&this.rt.dispose(),this.VA&&(this.VA.geometry.dispose(),this.VA.dispose())}U(A,t){const n=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():t$1.Util.isFunction(this.u.width)?this.u.width():this.u.width,i=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():t$1.Util.isFunction(this.u.height)?this.u.height():this.u.height;if(!this.T||this.T.width===n&&this.T.height===i||this.T.resize(n,i),this.l&&this.l.width/this.l.height!=A/t){const n=this.I(A,t);n&&this.l.resize(n.width,n.height)}}}const Tt=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1],Ot=[0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23],Ft=[],Ut=[],Et=[],Nt=[],jt=[],Qt=[],St=[],kt=[],Bt=new t$1.Point(0,0),Rt=[],Gt=[],Yt=[];class qt{constructor(A,t,n={}){this.setFromPoint(A),this.setToPoint(t),this.ot=n,this.ht={},this.ft=0}setFromPoint(A){this.ct=this.vt(A),this.wt()}setToPoint(A){this.Pt=this.vt(A),this.wt()}setOptions(A){this.ot=A}wt(){this.ht={},this.ft++}test(A,t){const n=[];for(let i=0;i<A.length;i++){const r=A[i],e=r.uuid+"-"+r.version+"-"+r.geometry.version+"-"+this.ft;if(this.ht[e]){n.push(this.ht[e]);continue}if(!this.Ct(r.getBoundingBox(),t))continue;const s=r.localTransform,u=r.geometry,o=u.data[u.desc.positionAttribute].array,h=u.data[u.desc.altitudeAttribute]&&u.data[u.desc.altitudeAttribute].array||Rt,f=u.indices;if(!o||!f){console.warn("there are no POSITION or inidces in mesh");continue}const c=this.Dt(t,o,h,f,u.desc.positionSize,s);if(c){const A={mesh:r,coordinates:c};n.push(A),this.ht[e]=A}}return n}Dt(A,t,n,i,s,u){const o=AA(A,this.ct.x,this.ct.y,this.ct.z),h=AA(A,this.Pt.x,this.Pt.y,this.Pt.z),f=set(Et,o,h),c=[];for(let r=0;r<i.length;r+=3){const o=i[r],h=i[r+1],a=i[r+2],v=this.It(Qt,A,t.slice(o*s,o*s+s),n[o]/100,u),w=this.It(St,A,t.slice(h*s,h*s+s),n[h]/100,u),P=this.It(kt,A,t.slice(a*s,a*s+s),n[a]/100,u),g=set$4(Ut,v,w,P),C=sub$2(Gt,v,w),D=sub$2(Yt,v,P),I=this.Mt(g,f);if(I){if(!I[0]||!I[1])continue;const t=A.pointAtResToAltitude(I[2],A.getGLRes());Bt.x=I[0],Bt.y=I[1];const n=A.pointAtResToCoordinate(Bt,A.getGLRes()),i=new t$1.Coordinate(n.x,n.y,t);c.push({coordinate:i,indices:[o,h,a],normal:cross$1([],C,D)})}}return c.length?c:null}It(A,t,n,i,r){let e;return t$1.Util.isNumber(i)?(e=t.altitudeToPoint(i,t.getGLRes()),set$3(A,n[0],n[1],0,1),transformMat4$1(A,A,r),A[2]=e):(e=n[2],set$3(A,n[0],n[1],e,1),transformMat4$1(A,A,r)),A}Mt(A,t){const n=A[0],i=A[1],r=A[2],s=t[0],u=t[1],o=s[0],h=s[1],f=s[2],c=u[0]-s[0],a=u[1]-s[1],v=u[2]-s[2];let l=0,w=0,P=0;n[0]===i[0]&&n[0]===r[0]?l=1:n[1]===i[1]&&n[1]===r[1]?w=1:n[2]===i[2]&&n[2]===r[2]?P=1:(l=(A[2][1]-A[0][1])*(A[2][2]-A[0][2])-(A[1][2]-A[0][2])*(A[2][1]-A[0][1]),w=(A[2][0]-A[0][0])*(A[1][2]-A[0][2])-(A[1][0]-A[0][0])*(A[2][2]-A[0][2]),P=(A[1][0]-A[0][0])*(A[2][1]-A[0][1])-(A[2][0]-A[0][0])*(A[1][1]-A[0][1]));const C=l*c+w*a+P*v;if(0===C)return null;const D=-(l*o+w*h+P*f+-(l*A[0][0]+w*A[0][1]+P*A[0][2]))/C,I=c*D+o,M=a*D+h,b=v*D+f,z=set$4(Nt,I,M,b);return this.bt(A,z)&&(this.ot.allowPointNotOnLine||this.zt(t,z))?[I,M,b]:null}bt(A,t){const n=this.ot.tolerance||1,i=A[0],r=A[1],e=A[2],s=t,u=this.dt(i,r,e),o=this.dt(s,i,r),h=this.dt(s,i,e),f=this.dt(s,r,e);return!(Math.abs(o+h+f-u)>n/1e3)}zt(A,t){const n=this.ot.tolerance||1,i=A[0],r=A[1],s=t,u=length$4(sub$2(jt,i,r)),o=length$4(sub$2(jt,i,s)),h=length$4(sub$2(jt,r,s));return!(Math.abs(o+h-u)>n/1e5)}dt(A,t,n){const s=cross$1([],[t[0]-A[0],t[1]-A[1],t[2]-A[2]],[n[0]-A[0],n[1]-A[1],n[2]-A[2]]);return.5*Math.sqrt(s[0]*s[0]+s[1]*s[1]+s[2]*s[2])}vt(A){return A instanceof t$1.Coordinate?A:Array.isArray(A)?new t$1.Coordinate(A):null}Ct(A,t){const n=[AA(t,this.ct.x,this.ct.y,this.ct.z),AA(t,this.Pt.x,this.Pt.y,this.Pt.z)],i=A[0],r=A[1];for(let A=0;A<Tt.length;A+=3)for(let t=0;t<3;t++){const n=3*A+t;Ft[n]=Tt[n]>0?r[t]:i[t]}for(let A=0;A<Ot.length;A+=3){const t=Ot[A],i=Ot[A+1],r=Ot[A+2],e=[Ft.slice(3*t,3*t+3),Ft.slice(3*i,3*i+3),Ft.slice(3*r,3*r+3)];if(this.Mt(e,n))return!0}return!1}}const Wt=[0,0,0,1],_t=[],Kt=[];class Ht extends H{h(){this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0}),this.O=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 projViewModelMatrix;\n\nuniform mat4 modelViewMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\n#include <get_output>\n\nvarying vec4 vPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vPosition = worldPosition;\n\n    gl_Position = projViewModelMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\n#include <gl2_frag>\n\n\n\nvarying vec4 vPosition;\n\n\n\nconst vec2 range = vec2(-100.0, 1000.0);\n\nvec4 encodeHeight(const in float height) {\n\n    float alpha = 1.0;\n\n    vec4 pack = vec4(0.0);\n\n    pack.a = alpha;\n\n    const vec3 code = vec3(1.0, 255.0, 65025.0);\n\n    pack.rgb = vec3(code * height);\n\n    pack.gb = fract(pack.gb);\n\n    pack.rg -= pack.gb * (1.0 / 256.0);\n\n    pack.b -= mod(pack.b, 4.0 / 255.0);\n\n    return pack;\n\n}\n\n\n\nvoid main() {\n\n    float height = (vPosition.z - range.x) / (range.y - range.x);\n\n    glFragColor = encodeHeight(height);\n\n    #if __VERSION__ == 100\n\n        gl_FragColor = glFragColor;\n\n    #endif\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:(A,n)=>multiply$5(_t,n.viewMatrix,n.modelMatrix)},{name:"projViewModelMatrix",type:"function",fn:(A,n)=>multiply$5(Kt,n.projViewMatrix,n.modelMatrix)}],extraCommandProps:{viewport:this.u,cull:{enable:!0},frontFace:"ccw"}}),this.F=new Ke$5}render(A,t){this.U(),this.renderer.clear({color:Wt,depth:1,framebuffer:this.T}),this.F.setMeshes(A);return this.renderer.render(this.O,{projViewMatrix:t},this.F,this.T),this.T}U(){const A=t__namespace.Util.isFunction(this.u.width)?this.u.width():this.u.width,t=t__namespace.Util.isFunction(this.u.height)?this.u.height():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}dispose(){this.T&&(this.T.destroy(),delete this.T),this.O&&(this.O.dispose(),delete this.O)}}const Jt=$n$2.getRendererClass("gl");class Zt extends $n$2{excavate(A){this.N=!0,this.Ft=Array.isArray(A)?A:[A];const t=this.getRenderer();t&&(t.Ut(),t.setToRedraw())}getExcavatedLayers(){return this.Ft}enable(){this.N=!0,this.Et()}disable(){this.N=!1,this.Et()}isEnable(){return this.N}Et(){const A=this.getRenderer();A&&A.setToRedraw()}}Zt.registerRenderer("gl",class extends Jt{draw(A,t){this.layer.getExcavatedLayers()&&this.layer.isEnable()&&(this.Nt(),super.draw(A,t))}Nt(){this._&&this.jt||this.Qt(),this.St=this.St||this.Ut();const A=this.getMap(),t=this.meshes;if(t&&this.St){for(let n=0;n<t.length;n++){const i=t[n],r=i.getDefines();r.HAS_EXCAVATE_ANALYSIS=1,i.setDefines(r),i.setUniform("heightmap",this.St),i.setUniform("excavateExtent",this.jt),i.setUniform("excavateHeight",X(A,this.options.height))}this.setToRedraw()}}Ut(){const A=this.layer.getExcavatedLayers();this.kt=[];for(let t=0;t<A.length;t++){const n=A[t].getRenderer();if(!n.getAnalysisMeshes)continue;const i=n.getAnalysisMeshes();t$1.Util.pushIn(this.kt,i)}return this.kt.length?(this.k=this.k||this.S(),this.k.render(this.kt,this._)):null}Qt(){const A=this.layer.getMap(),n=this.layer.getExtent(),i=A.getCenter(),r=A.getZoom(),e=A.getPitch(),u=A.getBearing(),o=A.getFitZoom(n),h=n.getCenter();A.setZoom(o),A.setCenter(h),A.setPitch(0),A.setBearing(0);const f=A.getExtent();this._=this._||[],copy$5(this._,A.projViewMatrix);const c=AA(A,f.xmin,f.ymin),a=AA(A,f.xmax,f.ymax);this.jt=set$3(this.jt||[],c[0],c[1],a[0],a[1]),A.setZoom(r),A.setCenter(i),A.setPitch(e),A.setBearing(u)}S(){this.u={x:0,y:0,width:()=>this.canvas?this.canvas.width:1,height:()=>this.canvas?this.canvas.height:1};const t=new B$6(this.regl);return this.k=this.k||new Ht(t,this.u),this.k}Bt(){this.Qt(),this.setToRedraw()}onGeometryAdd(A){super.onGeometryAdd(A),this.Bt()}onGeometryRemove(){super.onGeometryRemove(),this.Bt()}remove(){super.remove(),this.k&&this.k.dispose()}});class Xt extends H{h(){this.O=new vn$4({vert:"attribute vec3 aPosition;\n\nuniform mat4 projMatrix;\n\nuniform mat4 modelMatrix;\n\nuniform mat4 positionMatrix;\n\nuniform mat4 modelViewMatrix;\n\n#include <get_output>\n\nvarying vec4 vWorldPosition;\n\nvoid main()\n\n{\n\n    mat4 localPositionMatrix = getPositionMatrix();\n\n    vec4 worldPosition = modelMatrix * localPositionMatrix * getPosition(aPosition);\n\n    vWorldPosition = worldPosition;\n\n    gl_Position = projMatrix * modelViewMatrix * localPositionMatrix * getPosition(aPosition);\n\n}\n\n",frag:"#ifdef GL_ES\n\nprecision highp float;\n\n#endif\n\nuniform vec4 extent;\n\nuniform sampler2D extentMap;\n\nvarying vec4 vWorldPosition;\n\nvoid main() {\n\n    float width = extent.z - extent.x;\n\n    float height = extent.y - extent.w;\n\n    vec2 uvInExtent = vec2((vWorldPosition.x - extent.x) / width, 1.0 - (vWorldPosition.y - extent.w) / height);\n\n    vec4 extentColor = texture2D(extentMap, uvInExtent);\n\n    if (extentColor.r > 0.0) {\n\n        gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0);\n\n    } else {\n\n        gl_FragColor = vec4(0.0);\n\n    }\n\n}\n\n",uniforms:[{name:"modelViewMatrix",type:"function",fn:function(A,n){return multiply$5([],n.viewMatrix,n.modelMatrix)}}],extraCommandProps:{viewport:this.u}}),this.T=this.renderer.regl.framebuffer({color:this.renderer.regl.texture({width:1,height:1,wrap:"clamp",mag:"linear",min:"linear"}),depth:!0})}render(t,n){this.U(),this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T});const i=new Ke$5(t);return this.it(i,n),this.T}it(A,t){this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.renderer.render(this.O,t,A,this.T)}dispose(){this.T&&this.T.destroy(),this.O&&this.O.dispose()}U(){const A=t$1.Util.isFunction(this.u.width.data)?this.u.width.data():this.u.width,t=t$1.Util.isFunction(this.u.height.data)?this.u.height.data():this.u.height;!this.T||this.T.width===A&&this.T.height===t||this.T.resize(A,t)}}var $t={centimeters:637100880,centimetres:637100880,degrees:6371008.8/111325,feet:20902260.511392,inches:6371008.8*39.37,kilometers:6371.0088,kilometres:6371.0088,meters:6371008.8,metres:6371008.8,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:6371008.8/1852,radians:1,yards:6371008.8*1.0936};function An(A,t,n){void 0===n&&(n={});var i={type:"Feature"};return(0===n.id||n.id)&&(i.id=n.id),n.bbox&&(i.bbox=n.bbox),i.properties=t||{},i.geometry=A,i}function tn(A,t,n){if(void 0===n&&(n={}),!A)throw new Error("coordinates is required");if(!Array.isArray(A))throw new Error("coordinates must be an Array");if(A.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!hn(A[0])||!hn(A[1]))throw new Error("coordinates must contain numbers");return An({type:"Point",coordinates:A},t,n)}function nn(A,t,n){if(void 0===n&&(n={}),A.length<2)throw new Error("coordinates must be an array of two or more positions");return An({type:"LineString",coordinates:A},t,n)}function rn(A,t){void 0===t&&(t={});var n={type:"FeatureCollection"};return t.id&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.features=A,n}function en(A,t){void 0===t&&(t="kilometers");var n=$t[t];if(!n)throw new Error(t+" units is invalid");return A*n}function sn(A,t){void 0===t&&(t="kilometers");var n=$t[t];if(!n)throw new Error(t+" units is invalid");return A/n}function un(A){return A%(2*Math.PI)*180/Math.PI}function on(A){return A%360*Math.PI/180}function hn(A){return!isNaN(A)&&null!==A&&!Array.isArray(A)}function fn(A){if(!A)throw new Error("coord is required");if(!Array.isArray(A)){if("Feature"===A.type&&null!==A.geometry&&"Point"===A.geometry.type)return A.geometry.coordinates;if("Point"===A.type)return A.coordinates}if(Array.isArray(A)&&A.length>=2&&!Array.isArray(A[0])&&!Array.isArray(A[1]))return A;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function cn(A,t,n){if(void 0===n&&(n={}),!0===n.final)return function(A,t){var n=cn(t,A);return(n+180)%360}(A,t);var i=fn(A),r=fn(t),e=on(i[0]),s=on(r[0]),u=on(i[1]),o=on(r[1]),h=Math.sin(s-e)*Math.cos(o),f=Math.cos(u)*Math.sin(o)-Math.sin(u)*Math.cos(o)*Math.cos(s-e);return un(Math.atan2(h,f))}function an(A,t,n,i){void 0===i&&(i={});var r=fn(A),e=on(r[0]),s=on(r[1]),u=on(n),o=sn(t,i.units),h=Math.asin(Math.sin(s)*Math.cos(o)+Math.cos(s)*Math.sin(o)*Math.cos(u));return tn([un(e+Math.atan2(Math.sin(u)*Math.sin(o)*Math.cos(s),Math.cos(o)-Math.sin(s)*Math.sin(h))),un(h)],i.properties)}function vn(A,t,n){void 0===n&&(n={});var i=fn(A),r=fn(t),e=on(r[1]-i[1]),s=on(r[0]-i[0]),u=on(i[1]),o=on(r[1]),h=Math.pow(Math.sin(e/2),2)+Math.pow(Math.sin(s/2),2)*Math.cos(u)*Math.cos(o);return en(2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h)),n.units)}function ln(A,t,n){void 0===n&&(n={});for(var i,r=("Feature"===(i=A).type?i.geometry:i).coordinates,e=0,s=0;s<r.length&&!(t>=e&&s===r.length-1);s++){if(e>=t){var u=t-e;if(u){var o=cn(r[s],r[s-1])-180;return an(r[s],u,o,n)}return tn(r[s])}e+=vn(r[s],r[s+1],n)}return tn(r[r.length-1])}function wn(A,t){if("Feature"===A.type)t(A,0);else if("FeatureCollection"===A.type)for(var n=0;n<A.features.length&&!1!==t(A.features[n],n);n++);}function Pn(A,t){var n,i,r,e,s,u,o,h,f,c,a=0,v="FeatureCollection"===A.type,l="Feature"===A.type,w=v?A.features.length:1;for(n=0;n<w;n++){for(h=v?A.features[n].properties:l?A.properties:{},f=v?A.features[n].bbox:l?A.bbox:void 0,c=v?A.features[n].id:l?A.id:void 0,s=(o=!!(u=v?A.features[n].geometry:l?A.geometry:A)&&"GeometryCollection"===u.type)?u.geometries.length:1,r=0;r<s;r++)if(null!==(e=o?u.geometries[r]:u))switch(e.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===t(e,a,h,f,c))return!1;break;case"GeometryCollection":for(i=0;i<e.geometries.length;i++)if(!1===t(e.geometries[i],a,h,f,c))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===t(null,a,h,f,c))return!1;a++}}function gn(A){var t=[1/0,1/0,-1/0,-1/0];return function A(t,n,i){if(null!==t)for(var r,e,s,u,o,h,f,c,a=0,v=0,l=t.type,w="FeatureCollection"===l,P="Feature"===l,g=w?t.features.length:1,C=0;C<g;C++){o=(c=!!(f=w?t.features[C].geometry:P?t.geometry:t)&&"GeometryCollection"===f.type)?f.geometries.length:1;for(var D=0;D<o;D++){var I=0,M=0;if(null!==(u=c?f.geometries[D]:f)){h=u.coordinates;var b=u.type;switch(a=!i||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===n(h,v,C,I,M))return!1;v++,I++;break;case"LineString":case"MultiPoint":for(r=0;r<h.length;r++){if(!1===n(h[r],v,C,I,M))return!1;v++,"MultiPoint"===b&&I++}"LineString"===b&&I++;break;case"Polygon":case"MultiLineString":for(r=0;r<h.length;r++){for(e=0;e<h[r].length-a;e++){if(!1===n(h[r][e],v,C,I,M))return!1;v++}"MultiLineString"===b&&I++,"Polygon"===b&&M++}"Polygon"===b&&I++;break;case"MultiPolygon":for(r=0;r<h.length;r++){for(M=0,e=0;e<h[r].length;e++){for(s=0;s<h[r][e].length-a;s++){if(!1===n(h[r][e][s],v,C,I,M))return!1;v++}M++}I++}break;case"GeometryCollection":for(r=0;r<u.geometries.length;r++)if(!1===A(u.geometries[r],n,i))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}(A,(function(A){t[0]>A[0]&&(t[0]=A[0]),t[1]>A[1]&&(t[1]=A[1]),t[2]<A[0]&&(t[2]=A[0]),t[3]<A[1]&&(t[3]=A[1])})),t}gn.default=gn,"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(A){if(null==this)throw new TypeError(this+" is not an object");var t=Object(this),n=Math.max(Math.min(t.length,9007199254740991),0)||0,i=1 in arguments&&parseInt(Number(arguments[1]),10)||0;i=i<0?Math.max(n+i,0):Math.min(i,n);var r=2 in arguments&&void 0!==arguments[2]?parseInt(Number(arguments[2]),10)||0:n;for(r=r<0?Math.max(n+arguments[2],0):Math.min(r,n);i<r;)t[i]=A,++i;return t},writable:!0}),Number.isFinite=Number.isFinite||function(A){return"number"==typeof A&&isFinite(A)},Number.isInteger=Number.isInteger||function(A){return"number"==typeof A&&isFinite(A)&&Math.floor(A)===A},Number.parseFloat=Number.parseFloat||parseFloat,Number.isNaN=Number.isNaN||function(A){return A!=A},Math.trunc=Math.trunc||function(A){return A<0?Math.ceil(A):Math.floor(A)};var Cn=function(){};Cn.prototype.interfaces_=function(){return[]},Cn.prototype.getClass=function(){return Cn},Cn.prototype.equalsWithTolerance=function(A,t,n){return Math.abs(A-t)<=n};var Dn=function(A){function t(t){A.call(this,t),this.name="IllegalArgumentException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),In=function(){},Mn={MAX_VALUE:{configurable:!0}};In.isNaN=function(A){return Number.isNaN(A)},In.doubleToLongBits=function(A){return A},In.longBitsToDouble=function(A){return A},In.isInfinite=function(A){return!Number.isFinite(A)},Mn.MAX_VALUE.get=function(){return Number.MAX_VALUE},Object.defineProperties(In,Mn);var bn=function(){},zn=function(){},dn=function(){};function xn(){}var mn=function A(){if(this.x=null,this.y=null,this.z=null,0===arguments.length)this.x=0,this.y=0,this.z=A.NULL_ORDINATE;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.z=t.z}else 2===arguments.length?(this.x=arguments[0],this.y=arguments[1],this.z=A.NULL_ORDINATE):3===arguments.length&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},yn={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};mn.prototype.setOrdinate=function(A,t){switch(A){case mn.X:this.x=t;break;case mn.Y:this.y=t;break;case mn.Z:this.z=t;break;default:throw new Dn("Invalid ordinate index: "+A)}},mn.prototype.equals2D=function(){if(1===arguments.length){var A=arguments[0];return this.x===A.x&&this.y===A.y}if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!Cn.equalsWithTolerance(this.x,t.x,n)&&!!Cn.equalsWithTolerance(this.y,t.y,n)}},mn.prototype.getOrdinate=function(A){switch(A){case mn.X:return this.x;case mn.Y:return this.y;case mn.Z:return this.z}throw new Dn("Invalid ordinate index: "+A)},mn.prototype.equals3D=function(A){return this.x===A.x&&this.y===A.y&&(this.z===A.z||In.isNaN(this.z))&&In.isNaN(A.z)},mn.prototype.equals=function(A){return A instanceof mn&&this.equals2D(A)},mn.prototype.equalInZ=function(A,t){return Cn.equalsWithTolerance(this.z,A.z,t)},mn.prototype.compareTo=function(A){return this.x<A.x?-1:this.x>A.x?1:this.y<A.y?-1:this.y>A.y?1:0},mn.prototype.clone=function(){},mn.prototype.copy=function(){return new mn(this)},mn.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"},mn.prototype.distance3D=function(A){var t=this.x-A.x,n=this.y-A.y,i=this.z-A.z;return Math.sqrt(t*t+n*n+i*i)},mn.prototype.distance=function(A){var t=this.x-A.x,n=this.y-A.y;return Math.sqrt(t*t+n*n)},mn.prototype.hashCode=function(){var A=17;return 37*(A=37*A+mn.hashCode(this.x))+mn.hashCode(this.y)},mn.prototype.setCoordinate=function(A){this.x=A.x,this.y=A.y,this.z=A.z},mn.prototype.interfaces_=function(){return[bn,zn,xn]},mn.prototype.getClass=function(){return mn},mn.hashCode=function(){if(1===arguments.length){var A=arguments[0],t=In.doubleToLongBits(A);return Math.trunc((t^t)>>>32)}},yn.DimensionalComparator.get=function(){return pn},yn.serialVersionUID.get=function(){return 0x5cbf2c235c7e5800},yn.NULL_ORDINATE.get=function(){return In.NaN},yn.X.get=function(){return 0},yn.Y.get=function(){return 1},yn.Z.get=function(){return 2},Object.defineProperties(mn,yn);var pn=function(A){if(this.Rt=2,0===arguments.length);else if(1===arguments.length){var t=arguments[0];if(2!==t&&3!==t)throw new Dn("only 2 or 3 dimensions may be specified");this.Rt=t}};pn.prototype.compare=function(A,t){var n=A,i=t,r=pn.compare(n.x,i.x);if(0!==r)return r;var e=pn.compare(n.y,i.y);return 0!==e?e:this.Rt<=2?0:pn.compare(n.z,i.z)},pn.prototype.interfaces_=function(){return[dn]},pn.prototype.getClass=function(){return pn},pn.compare=function(A,t){return A<t?-1:A>t?1:In.isNaN(A)?In.isNaN(t)?0:-1:In.isNaN(t)?1:0};var Ln=function(){};Ln.prototype.create=function(){},Ln.prototype.interfaces_=function(){return[]},Ln.prototype.getClass=function(){return Ln};var Tn=function(){},On={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Tn.prototype.interfaces_=function(){return[]},Tn.prototype.getClass=function(){return Tn},Tn.toLocationSymbol=function(A){switch(A){case Tn.EXTERIOR:return"e";case Tn.BOUNDARY:return"b";case Tn.INTERIOR:return"i";case Tn.NONE:return"-"}throw new Dn("Unknown location value: "+A)},On.INTERIOR.get=function(){return 0},On.BOUNDARY.get=function(){return 1},On.EXTERIOR.get=function(){return 2},On.NONE.get=function(){return-1},Object.defineProperties(Tn,On);var Fn=function(A,t){return A.interfaces_&&A.interfaces_().indexOf(t)>-1},Un=function(){},En={LOG_10:{configurable:!0}};Un.prototype.interfaces_=function(){return[]},Un.prototype.getClass=function(){return Un},Un.log10=function(A){var t=Math.log(A);return In.isInfinite(t)||In.isNaN(t)?t:t/Un.LOG_10},Un.min=function(A,t,n,i){var r=A;return t<r&&(r=t),n<r&&(r=n),i<r&&(r=i),r},Un.clamp=function(){if("number"==typeof arguments[2]&&"number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1],n=arguments[2];return A<t?t:A>n?n:A}if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var i=arguments[0],r=arguments[1],e=arguments[2];return i<r?r:i>e?e:i}},Un.wrap=function(A,t){return A<0?t- -A%t:A%t},Un.max=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=A;return t>i&&(i=t),n>i&&(i=n),i}if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=r;return e>o&&(o=e),s>o&&(o=s),u>o&&(o=u),o}},Un.average=function(A,t){return(A+t)/2},En.LOG_10.get=function(){return Math.log(10)},Object.defineProperties(Un,En);var Nn=function(A){this.str=A};Nn.prototype.append=function(A){this.str+=A},Nn.prototype.setCharAt=function(A,t){this.str=this.str.substr(0,A)+t+this.str.substr(A+1)},Nn.prototype.toString=function(A){return this.str};var jn=function(A){this.value=A};jn.prototype.intValue=function(){return this.value},jn.prototype.compareTo=function(A){return this.value<A?-1:this.value>A?1:0},jn.isNaN=function(A){return Number.isNaN(A)};var Qn=function(){};Qn.isWhitespace=function(A){return A<=32&&A>=0||127===A},Qn.toUpperCase=function(A){return A.toUpperCase()};var Sn=function A(){if(this.Gt=0,this.Yt=0,0===arguments.length)this.init(0);else if(1===arguments.length){if("number"==typeof arguments[0]){var t=arguments[0];this.init(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}else if("string"==typeof arguments[0]){var i=arguments[0];A.call(this,A.parse(i))}}else if(2===arguments.length){var r=arguments[0],e=arguments[1];this.init(r,e)}},kn={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Sn.prototype.le=function(A){return(this.Gt<A.Gt||this.Gt===A.Gt)&&this.Yt<=A.Yt},Sn.prototype.extractSignificantDigits=function(A,t){var n=this.abs(),i=Sn.magnitude(n.Gt),r=Sn.TEN.pow(i);(n=n.divide(r)).gt(Sn.TEN)?(n=n.divide(Sn.TEN),i+=1):n.lt(Sn.ONE)&&(n=n.multiply(Sn.TEN),i-=1);for(var e=i+1,s=new Nn,u=Sn.MAX_PRINT_DIGITS-1,o=0;o<=u;o++){A&&o===e&&s.append(".");var h=Math.trunc(n.Gt);if(h<0)break;var f=!1,c=0;h>9?(f=!0,c="9"):c="0"+h,s.append(c),n=n.subtract(Sn.valueOf(h)).multiply(Sn.TEN),f&&n.selfAdd(Sn.TEN);var a=!0,v=Sn.magnitude(n.Gt);if(v<0&&Math.abs(v)>=u-o&&(a=!1),!a)break}return t[0]=i,s.toString()},Sn.prototype.sqr=function(){return this.multiply(this)},Sn.prototype.doubleValue=function(){return this.Gt+this.Yt},Sn.prototype.subtract=function(){if(arguments[0]instanceof Sn){var A=arguments[0];return this.add(A.negate())}if("number"==typeof arguments[0]){var t=arguments[0];return this.add(-t)}},Sn.prototype.equals=function(){if(1===arguments.length){var A=arguments[0];return this.Gt===A.Gt&&this.Yt===A.Yt}},Sn.prototype.isZero=function(){return 0===this.Gt&&0===this.Yt},Sn.prototype.selfSubtract=function(){if(arguments[0]instanceof Sn){var A=arguments[0];return this.isNaN()?this:this.selfAdd(-A.Gt,-A.Yt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t,0)}},Sn.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null},Sn.prototype.min=function(A){return this.le(A)?this:A},Sn.prototype.selfDivide=function(){if(1===arguments.length){if(arguments[0]instanceof Sn){var A=arguments[0];return this.selfDivide(A.Gt,A.Yt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfDivide(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null,f=null,c=null;return c=(r=(h=Sn.SPLIT*(o=this.Gt/n))-(r=h-o))*(s=(c=Sn.SPLIT*n)-(s=c-n))-(f=o*n)+r*(u=n-s)+(e=o-r)*s+e*u,c=o+(h=(this.Gt-f-c+this.Yt-o*i)/n),this.Gt=c,this.Yt=o-c+h,this}},Sn.prototype.dump=function(){return"DD<"+this.Gt+", "+this.Yt+">"},Sn.prototype.divide=function(){if(arguments[0]instanceof Sn){var A=arguments[0],t=null,n=null,i=null,r=null,e=null,s=null,u=null,o=null;n=(e=this.Gt/A.Gt)-(t=(s=Sn.SPLIT*e)-(t=s-e)),o=t*(i=(o=Sn.SPLIT*A.Gt)-(i=o-A.Gt))-(u=e*A.Gt)+t*(r=A.Gt-i)+n*i+n*r;var h=o=e+(s=(this.Gt-u-o+this.Yt-e*A.Yt)/A.Gt),f=e-o+s;return new Sn(h,f)}if("number"==typeof arguments[0]){var c=arguments[0];return In.isNaN(c)?Sn.createNaN():Sn.copy(this).selfDivide(c,0)}},Sn.prototype.ge=function(A){return(this.Gt>A.Gt||this.Gt===A.Gt)&&this.Yt>=A.Yt},Sn.prototype.pow=function(A){if(0===A)return Sn.valueOf(1);var t=new Sn(this),n=Sn.valueOf(1),i=Math.abs(A);if(i>1)for(;i>0;)i%2==1&&n.selfMultiply(t),(i/=2)>0&&(t=t.sqr());else n=t;return A<0?n.reciprocal():n},Sn.prototype.ceil=function(){if(this.isNaN())return Sn.NaN;var A=Math.ceil(this.Gt),t=0;return A===this.Gt&&(t=Math.ceil(this.Yt)),new Sn(A,t)},Sn.prototype.compareTo=function(A){return this.Gt<A.Gt?-1:this.Gt>A.Gt?1:this.Yt<A.Yt?-1:this.Yt>A.Yt?1:0},Sn.prototype.rint=function(){return this.isNaN()?this:this.add(.5).floor()},Sn.prototype.setValue=function(){if(arguments[0]instanceof Sn){var A=arguments[0];return this.init(A),this}if("number"==typeof arguments[0]){var t=arguments[0];return this.init(t),this}},Sn.prototype.max=function(A){return this.ge(A)?this:A},Sn.prototype.sqrt=function(){if(this.isZero())return Sn.valueOf(0);if(this.isNegative())return Sn.NaN;var A=1/Math.sqrt(this.Gt),n=Sn.valueOf(this.Gt*A),i=this.subtract(n.sqr()).Gt*(.5*A);return n.add(i)},Sn.prototype.selfAdd=function(){if(1===arguments.length){if(arguments[0]instanceof Sn){var A=arguments[0];return this.selfAdd(A.Gt,A.Yt)}if("number"==typeof arguments[0]){var t=arguments[0],n=null,i=null,r=null,e=null,s=null,u=null;return e=(r=this.Gt+t)-(s=r-this.Gt),i=(u=(e=t-s+(this.Gt-e))+this.Yt)+(r-(n=r+u)),this.Gt=n+i,this.Yt=i+(n-this.Gt),this}}else if(2===arguments.length){var o=arguments[0],h=arguments[1],f=null,c=null,a=null,v=null,l=null,w=null,P=null;l=(v=this.Gt+o)-(w=v-this.Gt),a=(c=this.Yt+h)-(P=c-this.Yt);var g=(f=v+(w=(l=o-w+(this.Gt-l))+c))+(w=(a=h-P+(this.Yt-a))+(w+(v-f))),C=w+(f-g);return this.Gt=g,this.Yt=C,this}},Sn.prototype.selfMultiply=function(){if(1===arguments.length){if(arguments[0]instanceof Sn){var A=arguments[0];return this.selfMultiply(A.Gt,A.Yt)}if("number"==typeof arguments[0]){var t=arguments[0];return this.selfMultiply(t,0)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=null,e=null,s=null,u=null,o=null,h=null;r=(o=Sn.SPLIT*this.Gt)-this.Gt,r=o-r;var f=(o=this.Gt*n)+(h=r*(s=(h=Sn.SPLIT*n)-(s=h-n))-o+r*(u=n-s)+(e=this.Gt-r)*s+e*u+(this.Gt*i+this.Yt*n)),c=h+(r=o-f);return this.Gt=f,this.Yt=c,this}},Sn.prototype.selfSqr=function(){return this.selfMultiply(this)},Sn.prototype.floor=function(){if(this.isNaN())return Sn.NaN;var A=Math.floor(this.Gt),t=0;return A===this.Gt&&(t=Math.floor(this.Yt)),new Sn(A,t)},Sn.prototype.negate=function(){return this.isNaN()?this:new Sn(-this.Gt,-this.Yt)},Sn.prototype.clone=function(){},Sn.prototype.multiply=function(){if(arguments[0]instanceof Sn){var A=arguments[0];return A.isNaN()?Sn.createNaN():Sn.copy(this).selfMultiply(A)}if("number"==typeof arguments[0]){var t=arguments[0];return In.isNaN(t)?Sn.createNaN():Sn.copy(this).selfMultiply(t,0)}},Sn.prototype.isNaN=function(){return In.isNaN(this.Gt)},Sn.prototype.intValue=function(){return Math.trunc(this.Gt)},Sn.prototype.toString=function(){var A=Sn.magnitude(this.Gt);return A>=-3&&A<=20?this.toStandardNotation():this.toSciNotation()},Sn.prototype.toStandardNotation=function(){var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!0,t),i=t[0]+1,r=n;if("."===n.charAt(0))r="0"+n;else if(i<0)r="0."+Sn.stringOfChar("0",-i)+n;else if(-1===n.indexOf(".")){r=n+Sn.stringOfChar("0",i-n.length)+".0"}return this.isNegative()?"-"+r:r},Sn.prototype.reciprocal=function(){var A,t,n,i,r=null,e=null,s=null,u=null;A=(n=1/this.Gt)-(r=(s=Sn.SPLIT*n)-(r=s-n)),e=(u=Sn.SPLIT*this.Gt)-this.Gt;var o=n+(s=(1-(i=n*this.Gt)-(u=r*(e=u-e)-i+r*(t=this.Gt-e)+A*e+A*t)-n*this.Yt)/this.Gt);return new Sn(o,n-o+s)},Sn.prototype.toSciNotation=function(){if(this.isZero())return Sn.SCI_NOT_ZERO;var A=this.getSpecialNumberString();if(null!==A)return A;var t=new Array(1).fill(null),n=this.extractSignificantDigits(!1,t),i=Sn.SCI_NOT_EXPONENT_CHAR+t[0];if("0"===n.charAt(0))throw new Error("Found leading zero: "+n);var r="";n.length>1&&(r=n.substring(1));var e=n.charAt(0)+"."+r;return this.isNegative()?"-"+e+i:e+i},Sn.prototype.abs=function(){return this.isNaN()?Sn.NaN:this.isNegative()?this.negate():new Sn(this)},Sn.prototype.isPositive=function(){return(this.Gt>0||0===this.Gt)&&this.Yt>0},Sn.prototype.lt=function(A){return(this.Gt<A.Gt||this.Gt===A.Gt)&&this.Yt<A.Yt},Sn.prototype.add=function(){if(arguments[0]instanceof Sn){var A=arguments[0];return Sn.copy(this).selfAdd(A)}if("number"==typeof arguments[0]){var t=arguments[0];return Sn.copy(this).selfAdd(t)}},Sn.prototype.init=function(){if(1===arguments.length){if("number"==typeof arguments[0]){var A=arguments[0];this.Gt=A,this.Yt=0}else if(arguments[0]instanceof Sn){var t=arguments[0];this.Gt=t.Gt,this.Yt=t.Yt}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.Gt=n,this.Yt=i}},Sn.prototype.gt=function(A){return(this.Gt>A.Gt||this.Gt===A.Gt)&&this.Yt>A.Yt},Sn.prototype.isNegative=function(){return(this.Gt<0||0===this.Gt)&&this.Yt<0},Sn.prototype.trunc=function(){return this.isNaN()?Sn.NaN:this.isPositive()?this.floor():this.ceil()},Sn.prototype.signum=function(){return this.Gt>0?1:this.Gt<0?-1:this.Yt>0?1:this.Yt<0?-1:0},Sn.prototype.interfaces_=function(){return[xn,bn,zn]},Sn.prototype.getClass=function(){return Sn},Sn.sqr=function(A){return Sn.valueOf(A).selfMultiply(A)},Sn.valueOf=function(){if("string"==typeof arguments[0]){var A=arguments[0];return Sn.parse(A)}if("number"==typeof arguments[0]){var t=arguments[0];return new Sn(t)}},Sn.sqrt=function(A){return Sn.valueOf(A).sqrt()},Sn.parse=function(A){for(var t=0,n=A.length;Qn.isWhitespace(A.charAt(t));)t++;var i=!1;if(t<n){var r=A.charAt(t);"-"!==r&&"+"!==r||(t++,"-"===r&&(i=!0))}for(var e=new Sn,s=0,u=0,o=0;!(t>=n);){var h=A.charAt(t);if(t++,Qn.isDigit(h)){var f=h-"0";e.selfMultiply(Sn.TEN),e.selfAdd(f),s++}else{if("."!==h){if("e"===h||"E"===h){var c=A.substring(t);try{o=jn.parseInt(c)}catch(t){throw t instanceof Error?new Error("Invalid exponent "+c+" in string "+A):t}break}throw new Error("Unexpected character '"+h+"' at position "+t+" in string "+A)}u=s}}var a=e,v=s-u-o;if(0===v)a=e;else if(v>0){var l=Sn.TEN.pow(v);a=e.divide(l)}else if(v<0){var w=Sn.TEN.pow(-v);a=e.multiply(w)}return i?a.negate():a},Sn.createNaN=function(){return new Sn(In.NaN,In.NaN)},Sn.copy=function(A){return new Sn(A)},Sn.magnitude=function(A){var t=Math.abs(A),n=Math.log(t)/Math.log(10),i=Math.trunc(Math.floor(n));return 10*Math.pow(10,i)<=t&&(i+=1),i},Sn.stringOfChar=function(A,t){for(var n=new Nn,i=0;i<t;i++)n.append(A);return n.toString()},kn.PI.get=function(){return new Sn(3.141592653589793,12246467991473532e-32)},kn.TWO_PI.get=function(){return new Sn(6.283185307179586,24492935982947064e-32)},kn.PI_2.get=function(){return new Sn(1.5707963267948966,6123233995736766e-32)},kn.E.get=function(){return new Sn(2.718281828459045,14456468917292502e-32)},kn.NaN.get=function(){return new Sn(In.NaN,In.NaN)},kn.EPS.get=function(){return 123259516440783e-46},kn.SPLIT.get=function(){return 134217729},kn.MAX_PRINT_DIGITS.get=function(){return 32},kn.TEN.get=function(){return Sn.valueOf(10)},kn.ONE.get=function(){return Sn.valueOf(1)},kn.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"},kn.SCI_NOT_ZERO.get=function(){return"0.0E0"},Object.defineProperties(Sn,kn);var Bn=function(){},Rn={DP_SAFE_EPSILON:{configurable:!0}};Bn.prototype.interfaces_=function(){return[]},Bn.prototype.getClass=function(){return Bn},Bn.orientationIndex=function(A,t,n){var i=Bn.orientationIndexFilter(A,t,n);if(i<=1)return i;var r=Sn.valueOf(t.x).selfAdd(-A.x),e=Sn.valueOf(t.y).selfAdd(-A.y),s=Sn.valueOf(n.x).selfAdd(-t.x),u=Sn.valueOf(n.y).selfAdd(-t.y);return r.selfMultiply(u).selfSubtract(e.selfMultiply(s)).signum()},Bn.signOfDet2x2=function(A,t,n,i){return A.multiply(i).selfSubtract(t.multiply(n)).signum()},Bn.intersection=function(A,t,n,i){var r=Sn.valueOf(i.y).selfSubtract(n.y).selfMultiply(Sn.valueOf(t.x).selfSubtract(A.x)),e=Sn.valueOf(i.x).selfSubtract(n.x).selfMultiply(Sn.valueOf(t.y).selfSubtract(A.y)),s=r.subtract(e),u=Sn.valueOf(i.x).selfSubtract(n.x).selfMultiply(Sn.valueOf(A.y).selfSubtract(n.y)),o=Sn.valueOf(i.y).selfSubtract(n.y).selfMultiply(Sn.valueOf(A.x).selfSubtract(n.x)),h=u.subtract(o).selfDivide(s).doubleValue(),f=Sn.valueOf(A.x).selfAdd(Sn.valueOf(t.x).selfSubtract(A.x).selfMultiply(h)).doubleValue(),c=Sn.valueOf(t.x).selfSubtract(A.x).selfMultiply(Sn.valueOf(A.y).selfSubtract(n.y)),a=Sn.valueOf(t.y).selfSubtract(A.y).selfMultiply(Sn.valueOf(A.x).selfSubtract(n.x)),v=c.subtract(a).selfDivide(s).doubleValue(),l=Sn.valueOf(n.y).selfAdd(Sn.valueOf(i.y).selfSubtract(n.y).selfMultiply(v)).doubleValue();return new mn(f,l)},Bn.orientationIndexFilter=function(A,t,n){var i=null,r=(A.x-n.x)*(t.y-n.y),e=(A.y-n.y)*(t.x-n.x),s=r-e;if(r>0){if(e<=0)return Bn.signum(s);i=r+e}else{if(!(r<0))return Bn.signum(s);if(e>=0)return Bn.signum(s);i=-r-e}var u=Bn.DP_SAFE_EPSILON*i;return s>=u||-s>=u?Bn.signum(s):2},Bn.signum=function(A){return A>0?1:A<0?-1:0},Rn.DP_SAFE_EPSILON.get=function(){return 1e-15},Object.defineProperties(Bn,Rn);var Gn=function(){},Yn={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};Yn.X.get=function(){return 0},Yn.Y.get=function(){return 1},Yn.Z.get=function(){return 2},Yn.M.get=function(){return 3},Gn.prototype.setOrdinate=function(A,t,n){},Gn.prototype.size=function(){},Gn.prototype.getOrdinate=function(A,t){},Gn.prototype.getCoordinate=function(){},Gn.prototype.getCoordinateCopy=function(A){},Gn.prototype.getDimension=function(){},Gn.prototype.getX=function(A){},Gn.prototype.clone=function(){},Gn.prototype.expandEnvelope=function(A){},Gn.prototype.copy=function(){},Gn.prototype.getY=function(A){},Gn.prototype.toCoordinateArray=function(){},Gn.prototype.interfaces_=function(){return[zn]},Gn.prototype.getClass=function(){return Gn},Object.defineProperties(Gn,Yn);var qn=function(){},Vn=function(A){function t(){A.call(this,"Projective point not representable on the Cartesian plane.")}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qn),Wn=function(){};Wn.arraycopy=function(A,t,n,i,r){for(var e=0,s=t;s<t+r;s++)n[i+e]=A[s],e++},Wn.getProperty=function(A){return{"line.separator":"\n"}[A]};var _n=function A(){if(this.x=null,this.y=null,this.w=null,0===arguments.length)this.x=0,this.y=0,this.w=1;else if(1===arguments.length){var t=arguments[0];this.x=t.x,this.y=t.y,this.w=1}else if(2===arguments.length){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var n=arguments[0],i=arguments[1];this.x=n,this.y=i,this.w=1}else if(arguments[0]instanceof A&&arguments[1]instanceof A){var r=arguments[0],e=arguments[1];this.x=r.y*e.w-e.y*r.w,this.y=e.x*r.w-r.x*e.w,this.w=r.x*e.y-e.x*r.y}else if(arguments[0]instanceof mn&&arguments[1]instanceof mn){var s=arguments[0],u=arguments[1];this.x=s.y-u.y,this.y=u.x-s.x,this.w=s.x*u.y-u.x*s.y}}else if(3===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2];this.x=o,this.y=h,this.w=f}else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3],w=c.y-a.y,P=a.x-c.x,g=c.x*a.y-a.x*c.y,C=v.y-l.y,D=l.x-v.x,I=v.x*l.y-l.x*v.y;this.x=P*I-D*g,this.y=C*g-w*I,this.w=w*D-C*P}};_n.prototype.getY=function(){var A=this.y/this.w;if(In.isNaN(A)||In.isInfinite(A))throw new Vn;return A},_n.prototype.getX=function(){var A=this.x/this.w;if(In.isNaN(A)||In.isInfinite(A))throw new Vn;return A},_n.prototype.getCoordinate=function(){var A=new mn;return A.x=this.getX(),A.y=this.getY(),A},_n.prototype.interfaces_=function(){return[]},_n.prototype.getClass=function(){return _n},_n.intersection=function(A,t,n,i){var r=A.y-t.y,e=t.x-A.x,s=A.x*t.y-t.x*A.y,u=n.y-i.y,o=i.x-n.x,h=n.x*i.y-i.x*n.y,f=r*o-u*e,c=(e*h-o*s)/f,a=(u*s-r*h)/f;if(In.isNaN(c)||In.isInfinite(c)||In.isNaN(a)||In.isInfinite(a))throw new Vn;return new mn(c,a)};var Kn=function A(){if(this.qt=null,this.Vt=null,this.Wt=null,this._t=null,0===arguments.length)this.init();else if(1===arguments.length){if(arguments[0]instanceof mn){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof A){var n=arguments[0];this.init(n)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.init(i.x,r.x,i.y,r.y)}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this.init(e,s,u,o)}},Hn={serialVersionUID:{configurable:!0}};Kn.prototype.getArea=function(){return this.getWidth()*this.getHeight()},Kn.prototype.equals=function(A){if(!(A instanceof Kn))return!1;var t=A;return this.isNull()?t.isNull():this.Vt===t.getMaxX()&&this._t===t.getMaxY()&&this.qt===t.getMinX()&&this.Wt===t.getMinY()},Kn.prototype.intersection=function(A){return this.isNull()||A.isNull()||!this.intersects(A)?new Kn:new Kn(this.qt>A.qt?this.qt:A.qt,this.Vt<A.Vt?this.Vt:A.Vt,this.Wt>A.Wt?this.Wt:A.Wt,this._t<A._t?this._t:A._t)},Kn.prototype.isNull=function(){return this.Vt<this.qt},Kn.prototype.getMaxX=function(){return this.Vt},Kn.prototype.covers=function(){if(1===arguments.length){if(arguments[0]instanceof mn){var A=arguments[0];return this.covers(A.x,A.y)}if(arguments[0]instanceof Kn){var t=arguments[0];return!this.isNull()&&!t.isNull()&&t.getMinX()>=this.qt&&t.getMaxX()<=this.Vt&&t.getMinY()>=this.Wt&&t.getMaxY()<=this._t}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&n>=this.qt&&n<=this.Vt&&i>=this.Wt&&i<=this._t}},Kn.prototype.intersects=function(){if(1===arguments.length){if(arguments[0]instanceof Kn){var A=arguments[0];return!this.isNull()&&!A.isNull()&&!(A.qt>this.Vt||A.Vt<this.qt||A.Wt>this._t||A._t<this.Wt)}if(arguments[0]instanceof mn){var t=arguments[0];return this.intersects(t.x,t.y)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return!this.isNull()&&!(n>this.Vt||n<this.qt||i>this._t||i<this.Wt)}},Kn.prototype.getMinY=function(){return this.Wt},Kn.prototype.getMinX=function(){return this.qt},Kn.prototype.expandToInclude=function(){if(1===arguments.length){if(arguments[0]instanceof mn){var A=arguments[0];this.expandToInclude(A.x,A.y)}else if(arguments[0]instanceof Kn){var t=arguments[0];if(t.isNull())return null;this.isNull()?(this.qt=t.getMinX(),this.Vt=t.getMaxX(),this.Wt=t.getMinY(),this._t=t.getMaxY()):(t.qt<this.qt&&(this.qt=t.qt),t.Vt>this.Vt&&(this.Vt=t.Vt),t.Wt<this.Wt&&(this.Wt=t.Wt),t._t>this._t&&(this._t=t._t))}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.isNull()?(this.qt=n,this.Vt=n,this.Wt=i,this._t=i):(n<this.qt&&(this.qt=n),n>this.Vt&&(this.Vt=n),i<this.Wt&&(this.Wt=i),i>this._t&&(this._t=i))}},Kn.prototype.minExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A<t?A:t},Kn.prototype.getWidth=function(){return this.isNull()?0:this.Vt-this.qt},Kn.prototype.compareTo=function(A){var t=A;return this.isNull()?t.isNull()?0:-1:t.isNull()?1:this.qt<t.qt?-1:this.qt>t.qt?1:this.Wt<t.Wt?-1:this.Wt>t.Wt?1:this.Vt<t.Vt?-1:this.Vt>t.Vt?1:this._t<t._t?-1:this._t>t._t?1:0},Kn.prototype.translate=function(A,t){if(this.isNull())return null;this.init(this.getMinX()+A,this.getMaxX()+A,this.getMinY()+t,this.getMaxY()+t)},Kn.prototype.toString=function(){return"Env["+this.qt+" : "+this.Vt+", "+this.Wt+" : "+this._t+"]"},Kn.prototype.setToNull=function(){this.qt=0,this.Vt=-1,this.Wt=0,this._t=-1},Kn.prototype.getHeight=function(){return this.isNull()?0:this._t-this.Wt},Kn.prototype.maxExtent=function(){if(this.isNull())return 0;var A=this.getWidth(),t=this.getHeight();return A>t?A:t},Kn.prototype.expandBy=function(){if(1===arguments.length){var A=arguments[0];this.expandBy(A,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.isNull())return null;this.qt-=t,this.Vt+=t,this.Wt-=n,this._t+=n,(this.qt>this.Vt||this.Wt>this._t)&&this.setToNull()}},Kn.prototype.contains=function(){if(1===arguments.length){if(arguments[0]instanceof Kn){var A=arguments[0];return this.covers(A)}if(arguments[0]instanceof mn){var t=arguments[0];return this.covers(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.covers(n,i)}},Kn.prototype.centre=function(){return this.isNull()?null:new mn((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)},Kn.prototype.init=function(){if(0===arguments.length)this.setToNull();else if(1===arguments.length){if(arguments[0]instanceof mn){var A=arguments[0];this.init(A.x,A.x,A.y,A.y)}else if(arguments[0]instanceof Kn){var t=arguments[0];this.qt=t.qt,this.Vt=t.Vt,this.Wt=t.Wt,this._t=t._t}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.init(n.x,i.x,n.y,i.y)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];r<e?(this.qt=r,this.Vt=e):(this.qt=e,this.Vt=r),s<u?(this.Wt=s,this._t=u):(this.Wt=u,this._t=s)}},Kn.prototype.getMaxY=function(){return this._t},Kn.prototype.distance=function(A){if(this.intersects(A))return 0;var t=0;this.Vt<A.qt?t=A.qt-this.Vt:this.qt>A.Vt&&(t=this.qt-A.Vt);var n=0;return this._t<A.Wt?n=A.Wt-this._t:this.Wt>A._t&&(n=this.Wt-A._t),0===t?n:0===n?t:Math.sqrt(t*t+n*n)},Kn.prototype.hashCode=function(){var A=17;return 37*(A=37*(A=37*(A=37*A+mn.hashCode(this.qt))+mn.hashCode(this.Vt))+mn.hashCode(this.Wt))+mn.hashCode(this._t)},Kn.prototype.interfaces_=function(){return[bn,xn]},Kn.prototype.getClass=function(){return Kn},Kn.intersects=function(){if(3===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2];return n.x>=(A.x<t.x?A.x:t.x)&&n.x<=(A.x>t.x?A.x:t.x)&&n.y>=(A.y<t.y?A.y:t.y)&&n.y<=(A.y>t.y?A.y:t.y)}if(4===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=Math.min(e.x,s.x),o=Math.max(e.x,s.x),h=Math.min(i.x,r.x),f=Math.max(i.x,r.x);return!(h>o||f<u||(u=Math.min(e.y,s.y),o=Math.max(e.y,s.y),h=Math.min(i.y,r.y),f=Math.max(i.y,r.y),h>o||f<u))}},Hn.serialVersionUID.get=function(){return 0x51845cd552189800},Object.defineProperties(Kn,Hn);var Jn={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},Zn=function(A){this.geometryFactory=A||new jr};Zn.prototype.read=function(A){var t,n;A=A.replace(/[\n\r]/g," ");var r=Jn.typeStr.exec(A);if(-1!==A.search("EMPTY")&&((r=Jn.emptyTypeStr.exec(A))[2]=void 0),r&&(n=r[1].toLowerCase(),$n[n]&&(t=$n[n].apply(this,[r[2]]))),void 0===t)throw new Error("Could not parse WKT "+A);return t},Zn.prototype.write=function(A){return this.extractGeometry(A)},Zn.prototype.extractGeometry=function(A){var t=A.getGeometryType().toLowerCase();if(!Xn[t])return null;var n=t.toUpperCase();return A.isEmpty()?n+" EMPTY":n+"("+Xn[t].apply(this,[A])+")"};var Xn={coordinate:function(A){return A.x+" "+A.y},point:function(A){return Xn.coordinate.call(this,A.Kt.Kt[0])},multipoint:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Xn.point.apply(this,[A.Ht[n]])+")");return t.join(",")},linestring:function(A){for(var t=[],n=0,i=A.Jt.Kt.length;n<i;++n)t.push(Xn.coordinate.apply(this,[A.Jt.Kt[n]]));return t.join(",")},linearring:function(A){for(var t=[],n=0,i=A.Jt.Kt.length;n<i;++n)t.push(Xn.coordinate.apply(this,[A.Jt.Kt[n]]));return t.join(",")},multilinestring:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Xn.linestring.apply(this,[A.Ht[n]])+")");return t.join(",")},polygon:function(A){var t=[];t.push("("+Xn.linestring.apply(this,[A.Zt])+")");for(var n=0,i=A.Xt.length;n<i;++n)t.push("("+Xn.linestring.apply(this,[A.Xt[n]])+")");return t.join(",")},multipolygon:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push("("+Xn.polygon.apply(this,[A.Ht[n]])+")");return t.join(",")},geometrycollection:function(A){for(var t=[],n=0,i=A.Ht.length;n<i;++n)t.push(this.extractGeometry(A.Ht[n]));return t.join(",")}},$n={point:function(A){if(void 0===A)return this.geometryFactory.createPoint();var t=A.trim().split(Jn.spaces);return this.geometryFactory.createPoint(new mn(Number.parseFloat(t[0]),Number.parseFloat(t[1])))},multipoint:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPoint();for(var n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Jn.trimParens,"$1"),i.push($n.point.apply(this,[t]));return this.geometryFactory.createMultiPoint(i)},linestring:function(A){if(void 0===A)return this.geometryFactory.createLineString();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(Jn.spaces),i.push(new mn(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLineString(i)},linearring:function(A){if(void 0===A)return this.geometryFactory.createLinearRing();for(var t,n=A.trim().split(","),i=[],r=0,e=n.length;r<e;++r)t=n[r].trim().split(Jn.spaces),i.push(new mn(Number.parseFloat(t[0]),Number.parseFloat(t[1])));return this.geometryFactory.createLinearRing(i)},multilinestring:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiLineString();for(var n=A.trim().split(Jn.parenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Jn.trimParens,"$1"),i.push($n.linestring.apply(this,[t]));return this.geometryFactory.createMultiLineString(i)},polygon:function(A){var t,n,i;if(void 0===A)return this.geometryFactory.createPolygon();for(var r,e=A.trim().split(Jn.parenComma),s=[],u=0,o=e.length;u<o;++u)t=e[u].replace(Jn.trimParens,"$1"),n=$n.linestring.apply(this,[t]),i=this.geometryFactory.createLinearRing(n.Jt),0===u?r=i:s.push(i);return this.geometryFactory.createPolygon(r,s)},multipolygon:function(A){var t;if(void 0===A)return this.geometryFactory.createMultiPolygon();for(var n=A.trim().split(Jn.doubleParenComma),i=[],r=0,e=n.length;r<e;++r)t=n[r].replace(Jn.trimParens,"$1"),i.push($n.polygon.apply(this,[t]));return this.geometryFactory.createMultiPolygon(i)},geometrycollection:function(A){if(void 0===A)return this.geometryFactory.createGeometryCollection();for(var t=(A=A.replace(/,\s*([A-Za-z])/g,"|$1")).trim().split("|"),n=[],i=0,r=t.length;i<r;++i)n.push(this.read(t[i]));return this.geometryFactory.createGeometryCollection(n)}},Ai=function(A){this.parser=new Zn(A)};Ai.prototype.write=function(A){return this.parser.write(A)},Ai.toLineString=function(A,t){if(2!==arguments.length)throw new Error("Not implemented");return"LINESTRING ( "+A.x+" "+A.y+", "+t.x+" "+t.y+" )"};var ti=function(A){function t(t){A.call(this,t),this.name="RuntimeException",this.message=t,this.stack=(new A).stack}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Error),ni=function(A){function t(){if(A.call(this),0===arguments.length)A.call(this);else if(1===arguments.length){var t=arguments[0];A.call(this,t)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ti),ii=function(){};ii.prototype.interfaces_=function(){return[]},ii.prototype.getClass=function(){return ii},ii.shouldNeverReachHere=function(){if(0===arguments.length)ii.shouldNeverReachHere(null);else if(1===arguments.length){var A=arguments[0];throw new ni("Should never reach here"+(null!==A?": "+A:""))}},ii.isTrue=function(){var A;if(1===arguments.length)ii.isTrue(arguments[0],null);else if(2===arguments.length&&(A=arguments[1],!arguments[0]))throw null===A?new ni:new ni(A)},ii.equals=function(){var A,t,n;if(2===arguments.length)ii.equals(A=arguments[0],t=arguments[1],null);else if(3===arguments.length&&(n=arguments[2],!(t=arguments[1]).equals(A=arguments[0])))throw new ni("Expected "+A+" but encountered "+t+(null!==n?": "+n:""))};var ri=function(){this.$t=null,this.An=Array(2).fill().map((function(){return Array(2)})),this.tn=new Array(2).fill(null),this.nn=null,this.in=null,this.rn=null,this.en=null,this.sn=null,this.tn[0]=new mn,this.tn[1]=new mn,this.rn=this.tn[0],this.en=this.tn[1],this.$t=0},ei={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};ri.prototype.getIndexAlongSegment=function(A,t){return this.computeIntLineIndex(),this.nn[A][t]},ri.prototype.getTopologySummary=function(){var A=new Nn;return this.isEndPoint()&&A.append(" endpoint"),this.in&&A.append(" proper"),this.isCollinear()&&A.append(" collinear"),A.toString()},ri.prototype.computeIntersection=function(A,t,n,i){this.An[0][0]=A,this.An[0][1]=t,this.An[1][0]=n,this.An[1][1]=i,this.$t=this.computeIntersect(A,t,n,i)},ri.prototype.getIntersectionNum=function(){return this.$t},ri.prototype.computeIntLineIndex=function(){if(0===arguments.length)null===this.nn&&(this.nn=Array(2).fill().map((function(){return Array(2)})),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(1===arguments.length){var A=arguments[0],t=this.getEdgeDistance(A,0),n=this.getEdgeDistance(A,1);t>n?(this.nn[A][0]=0,this.nn[A][1]=1):(this.nn[A][0]=1,this.nn[A][1]=0)}},ri.prototype.isProper=function(){return this.hasIntersection()&&this.in},ri.prototype.setPrecisionModel=function(A){this.sn=A},ri.prototype.isInteriorIntersection=function(){var A=this;if(0===arguments.length)return!!this.isInteriorIntersection(0)||!!this.isInteriorIntersection(1);if(1===arguments.length){for(var t=arguments[0],n=0;n<this.$t;n++)if(!A.tn[n].equals2D(A.An[t][0])&&!A.tn[n].equals2D(A.An[t][1]))return!0;return!1}},ri.prototype.getIntersection=function(A){return this.tn[A]},ri.prototype.isEndPoint=function(){return this.hasIntersection()&&!this.in},ri.prototype.hasIntersection=function(){return this.$t!==ri.NO_INTERSECTION},ri.prototype.getEdgeDistance=function(A,t){return ri.computeEdgeDistance(this.tn[t],this.An[A][0],this.An[A][1])},ri.prototype.isCollinear=function(){return this.$t===ri.COLLINEAR_INTERSECTION},ri.prototype.toString=function(){return Ai.toLineString(this.An[0][0],this.An[0][1])+" - "+Ai.toLineString(this.An[1][0],this.An[1][1])+this.getTopologySummary()},ri.prototype.getEndpoint=function(A,t){return this.An[A][t]},ri.prototype.isIntersection=function(A){for(var t=0;t<this.$t;t++)if(this.tn[t].equals2D(A))return!0;return!1},ri.prototype.getIntersectionAlongSegment=function(A,t){return this.computeIntLineIndex(),this.tn[this.nn[A][t]]},ri.prototype.interfaces_=function(){return[]},ri.prototype.getClass=function(){return ri},ri.computeEdgeDistance=function(A,t,n){var i=Math.abs(n.x-t.x),r=Math.abs(n.y-t.y),e=-1;if(A.equals(t))e=0;else if(A.equals(n))e=i>r?i:r;else{var s=Math.abs(A.x-t.x),u=Math.abs(A.y-t.y);0!==(e=i>r?s:u)||A.equals(t)||(e=Math.max(s,u))}return ii.isTrue(!(0===e&&!A.equals(t)),"Bad distance calculation"),e},ri.nonRobustComputeEdgeDistance=function(A,t,n){var i=A.x-t.x,r=A.y-t.y,e=Math.sqrt(i*i+r*r);return ii.isTrue(!(0===e&&!A.equals(t)),"Invalid distance calculation"),e},ei.DONT_INTERSECT.get=function(){return 0},ei.DO_INTERSECT.get=function(){return 1},ei.COLLINEAR.get=function(){return 2},ei.NO_INTERSECTION.get=function(){return 0},ei.POINT_INTERSECTION.get=function(){return 1},ei.COLLINEAR_INTERSECTION.get=function(){return 2},Object.defineProperties(ri,ei);var si=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isInSegmentEnvelopes=function(A){var t=new Kn(this.An[0][0],this.An[0][1]),n=new Kn(this.An[1][0],this.An[1][1]);return t.contains(A)&&n.contains(A)},t.prototype.computeIntersection=function(){if(3!==arguments.length)return A.prototype.computeIntersection.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2];if(this.in=!1,Kn.intersects(n,i,t)&&0===hi.orientationIndex(n,i,t)&&0===hi.orientationIndex(i,n,t))return this.in=!0,(t.equals(n)||t.equals(i))&&(this.in=!1),this.$t=A.POINT_INTERSECTION,null;this.$t=A.NO_INTERSECTION},t.prototype.normalizeToMinimum=function(A,t,n,i,r){r.x=this.smallestInAbsValue(A.x,t.x,n.x,i.x),r.y=this.smallestInAbsValue(A.y,t.y,n.y,i.y),A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.safeHCoordinateIntersection=function(A,n,i,r){var e=null;try{e=_n.intersection(A,n,i,r)}catch(s){if(!(s instanceof Vn))throw s;e=t.nearestEndpoint(A,n,i,r)}return e},t.prototype.intersection=function(A,n,i,r){var e=this.intersectionWithNormalization(A,n,i,r);return this.isInSegmentEnvelopes(e)||(e=new mn(t.nearestEndpoint(A,n,i,r))),null!==this.sn&&this.sn.makePrecise(e),e},t.prototype.smallestInAbsValue=function(A,t,n,i){var r=A,e=Math.abs(r);return Math.abs(t)<e&&(r=t,e=Math.abs(t)),Math.abs(n)<e&&(r=n,e=Math.abs(n)),Math.abs(i)<e&&(r=i),r},t.prototype.checkDD=function(A,t,n,i,r){var e=Bn.intersection(A,t,n,i),s=this.isInSegmentEnvelopes(e);Wn.out.println("DD in env = "+s+"  --------------------- "+e),r.distance(e)>1e-4&&Wn.out.println("Distance = "+r.distance(e))},t.prototype.intersectionWithNormalization=function(A,t,n,i){var r=new mn(A),e=new mn(t),s=new mn(n),u=new mn(i),o=new mn;this.normalizeToEnvCentre(r,e,s,u,o);var h=this.safeHCoordinateIntersection(r,e,s,u);return h.x+=o.x,h.y+=o.y,h},t.prototype.computeCollinearIntersection=function(t,n,i,r){var e=Kn.intersects(t,n,i),s=Kn.intersects(t,n,r),u=Kn.intersects(i,r,t),o=Kn.intersects(i,r,n);return e&&s?(this.tn[0]=i,this.tn[1]=r,A.COLLINEAR_INTERSECTION):u&&o?(this.tn[0]=t,this.tn[1]=n,A.COLLINEAR_INTERSECTION):e&&u?(this.tn[0]=i,this.tn[1]=t,!i.equals(t)||s||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):e&&o?(this.tn[0]=i,this.tn[1]=n,!i.equals(n)||s||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&u?(this.tn[0]=r,this.tn[1]=t,!r.equals(t)||e||o?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):s&&o?(this.tn[0]=r,this.tn[1]=n,!r.equals(n)||e||u?A.COLLINEAR_INTERSECTION:A.POINT_INTERSECTION):A.NO_INTERSECTION},t.prototype.normalizeToEnvCentre=function(A,t,n,i,r){var e=A.x<t.x?A.x:t.x,s=A.y<t.y?A.y:t.y,u=A.x>t.x?A.x:t.x,o=A.y>t.y?A.y:t.y,h=n.x<i.x?n.x:i.x,f=n.y<i.y?n.y:i.y,c=n.x>i.x?n.x:i.x,a=n.y>i.y?n.y:i.y,l=((s>f?s:f)+(o<a?o:a))/2;r.x=((e>h?e:h)+(u<c?u:c))/2,r.y=l,A.x-=r.x,A.y-=r.y,t.x-=r.x,t.y-=r.y,n.x-=r.x,n.y-=r.y,i.x-=r.x,i.y-=r.y},t.prototype.computeIntersect=function(t,n,i,r){if(this.in=!1,!Kn.intersects(t,n,i,r))return A.NO_INTERSECTION;var e=hi.orientationIndex(t,n,i),s=hi.orientationIndex(t,n,r);if(e>0&&s>0||e<0&&s<0)return A.NO_INTERSECTION;var u=hi.orientationIndex(i,r,t),o=hi.orientationIndex(i,r,n);return u>0&&o>0||u<0&&o<0?A.NO_INTERSECTION:0===e&&0===s&&0===u&&0===o?this.computeCollinearIntersection(t,n,i,r):(0===e||0===s||0===u||0===o?(this.in=!1,t.equals2D(i)||t.equals2D(r)?this.tn[0]=t:n.equals2D(i)||n.equals2D(r)?this.tn[0]=n:0===e?this.tn[0]=new mn(i):0===s?this.tn[0]=new mn(r):0===u?this.tn[0]=new mn(t):0===o&&(this.tn[0]=new mn(n))):(this.in=!0,this.tn[0]=this.intersection(t,n,i,r)),A.POINT_INTERSECTION)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.nearestEndpoint=function(A,t,n,i){var r=A,e=hi.distancePointLine(A,n,i),s=hi.distancePointLine(t,n,i);return s<e&&(e=s,r=t),(s=hi.distancePointLine(n,A,t))<e&&(e=s,r=n),(s=hi.distancePointLine(i,A,t))<e&&(e=s,r=i),r},t}(ri),ui=function(){};ui.prototype.interfaces_=function(){return[]},ui.prototype.getClass=function(){return ui},ui.orientationIndex=function(A,t,n){return ui.signOfDet2x2(t.x-A.x,t.y-A.y,n.x-t.x,n.y-t.y)},ui.signOfDet2x2=function(A,t,n,i){var r=null,e=null,s=null;if(r=1,0===A||0===i)return 0===t||0===n?0:t>0?n>0?-r:r:n>0?r:-r;if(0===t||0===n)return i>0?A>0?r:-r:A>0?-r:r;if(t>0?i>0?t<=i||(r=-r,e=A,A=n,n=e,e=t,t=i,i=e):t<=-i?(r=-r,n=-n,i=-i):(e=A,A=-n,n=e,e=t,t=-i,i=e):i>0?-t<=i?(r=-r,A=-A,t=-t):(e=-A,A=n,n=e,e=-t,t=i,i=e):t>=i?(A=-A,t=-t,n=-n,i=-i):(r=-r,e=-A,A=-n,n=e,e=-t,t=-i,i=e),A>0){if(!(n>0))return r;if(!(A<=n))return r}else{if(n>0)return-r;if(!(A>=n))return-r;r=-r,A=-A,n=-n}for(;;){if((i-=(s=Math.floor(n/A))*t)<0)return-r;if(i>t)return r;if(A>(n-=s*A)+n){if(t<i+i)return r}else{if(t>i+i)return-r;n=A-n,i=t-i,r=-r}if(0===i)return 0===n?0:-r;if(0===n)return r;if((t-=(s=Math.floor(A/n))*i)<0)return r;if(t>i)return-r;if(n>(A-=s*n)+A){if(i<t+t)return-r}else{if(i>t+t)return r;A=n-A,t=i-t,r=-r}if(0===t)return 0===A?0:r;if(0===A)return-r}};var oi=function(){this.un=null,this.hn=0,this.cn=!1;var A=arguments[0];this.un=A};oi.prototype.countSegment=function(A,t){if(A.x<this.un.x&&t.x<this.un.x)return null;if(this.un.x===t.x&&this.un.y===t.y)return this.cn=!0,null;if(A.y===this.un.y&&t.y===this.un.y){var n=A.x,i=t.x;return n>i&&(n=t.x,i=A.x),this.un.x>=n&&this.un.x<=i&&(this.cn=!0),null}if(A.y>this.un.y&&t.y<=this.un.y||t.y>this.un.y&&A.y<=this.un.y){var e=A.y-this.un.y,u=t.y-this.un.y,o=ui.signOfDet2x2(A.x-this.un.x,e,t.x-this.un.x,u);if(0===o)return this.cn=!0,null;u<e&&(o=-o),o>0&&this.hn++}},oi.prototype.isPointInPolygon=function(){return this.getLocation()!==Tn.EXTERIOR},oi.prototype.getLocation=function(){return this.cn?Tn.BOUNDARY:this.hn%2==1?Tn.INTERIOR:Tn.EXTERIOR},oi.prototype.isOnSegment=function(){return this.cn},oi.prototype.interfaces_=function(){return[]},oi.prototype.getClass=function(){return oi},oi.locatePointInRing=function(){if(arguments[0]instanceof mn&&Fn(arguments[1],Gn)){for(var A=arguments[0],t=arguments[1],n=new oi(A),i=new mn,r=new mn,e=1;e<t.size();e++)if(t.getCoordinate(e,i),t.getCoordinate(e-1,r),n.countSegment(i,r),n.isOnSegment())return n.getLocation();return n.getLocation()}if(arguments[0]instanceof mn&&arguments[1]instanceof Array){for(var s=arguments[0],u=arguments[1],o=new oi(s),h=1;h<u.length;h++){var f=u[h],c=u[h-1];if(o.countSegment(f,c),o.isOnSegment())return o.getLocation()}return o.getLocation()}};var hi=function(){},fi={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};hi.prototype.interfaces_=function(){return[]},hi.prototype.getClass=function(){return hi},hi.orientationIndex=function(A,t,n){return Bn.orientationIndex(A,t,n)},hi.signedArea=function(){if(arguments[0]instanceof Array){var A=arguments[0];if(A.length<3)return 0;for(var t=0,n=A[0].x,i=1;i<A.length-1;i++){var r=A[i].x-n,e=A[i+1].y,s=A[i-1].y;t+=r*(s-e)}return t/2}if(Fn(arguments[0],Gn)){var u=arguments[0],o=u.size();if(o<3)return 0;var h=new mn,f=new mn,c=new mn;u.getCoordinate(0,f),u.getCoordinate(1,c);var a=f.x;c.x-=a;for(var v=0,l=1;l<o-1;l++)h.y=f.y,f.x=c.x,f.y=c.y,u.getCoordinate(l+1,c),c.x-=a,v+=f.x*(h.y-c.y);return v/2}},hi.distanceLineLine=function(A,t,n,i){if(A.equals(t))return hi.distancePointLine(A,n,i);if(n.equals(i))return hi.distancePointLine(i,A,t);var r=!1;if(Kn.intersects(A,t,n,i)){var e=(t.x-A.x)*(i.y-n.y)-(t.y-A.y)*(i.x-n.x);if(0===e)r=!0;else{var u=((A.y-n.y)*(t.x-A.x)-(A.x-n.x)*(t.y-A.y))/e,o=((A.y-n.y)*(i.x-n.x)-(A.x-n.x)*(i.y-n.y))/e;(o<0||o>1||u<0||u>1)&&(r=!0)}}else r=!0;return r?Un.min(hi.distancePointLine(A,n,i),hi.distancePointLine(t,n,i),hi.distancePointLine(n,A,t),hi.distancePointLine(i,A,t)):0},hi.isPointInRing=function(A,t){return hi.locatePointInRing(A,t)!==Tn.EXTERIOR},hi.computeLength=function(A){var t=A.size();if(t<=1)return 0;var n=0,i=new mn;A.getCoordinate(0,i);for(var r=i.x,e=i.y,s=1;s<t;s++){A.getCoordinate(s,i);var u=i.x,o=i.y,h=u-r,f=o-e;n+=Math.sqrt(h*h+f*f),r=u,e=o}return n},hi.isCCW=function(A){var t=A.length-1;if(t<3)throw new Dn("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=A[0],i=0,r=1;r<=t;r++){var e=A[r];e.y>n.y&&(n=e,i=r)}var s=i;do{(s-=1)<0&&(s=t)}while(A[s].equals2D(n)&&s!==i);var u=i;do{u=(u+1)%t}while(A[u].equals2D(n)&&u!==i);var o=A[s],h=A[u];if(o.equals2D(n)||h.equals2D(n)||o.equals2D(h))return!1;var f=hi.computeOrientation(o,n,h);return 0===f?o.x>h.x:f>0},hi.locatePointInRing=function(A,t){return oi.locatePointInRing(A,t)},hi.distancePointLinePerpendicular=function(A,t,n){var i=(n.x-t.x)*(n.x-t.x)+(n.y-t.y)*(n.y-t.y);return Math.abs(((t.y-A.y)*(n.x-t.x)-(t.x-A.x)*(n.y-t.y))/i)*Math.sqrt(i)},hi.computeOrientation=function(A,t,n){return hi.orientationIndex(A,t,n)},hi.distancePointLine=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(0===t.length)throw new Dn("Line array must contain at least one vertex");for(var n=A.distance(t[0]),i=0;i<t.length-1;i++){var r=hi.distancePointLine(A,t[i],t[i+1]);r<n&&(n=r)}return n}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];if(s.x===u.x&&s.y===u.y)return e.distance(s);var o=(u.x-s.x)*(u.x-s.x)+(u.y-s.y)*(u.y-s.y),h=((e.x-s.x)*(u.x-s.x)+(e.y-s.y)*(u.y-s.y))/o;if(h<=0)return e.distance(s);if(h>=1)return e.distance(u);var f=((s.y-e.y)*(u.x-s.x)-(s.x-e.x)*(u.y-s.y))/o;return Math.abs(f)*Math.sqrt(o)}},hi.isOnLine=function(A,t){for(var n=new si,i=1;i<t.length;i++){if(n.computeIntersection(A,t[i-1],t[i]),n.hasIntersection())return!0}return!1},fi.CLOCKWISE.get=function(){return-1},fi.RIGHT.get=function(){return hi.CLOCKWISE},fi.COUNTERCLOCKWISE.get=function(){return 1},fi.LEFT.get=function(){return hi.COUNTERCLOCKWISE},fi.COLLINEAR.get=function(){return 0},fi.STRAIGHT.get=function(){return hi.COLLINEAR},Object.defineProperties(hi,fi);var ci=function(){};ci.prototype.filter=function(A){},ci.prototype.interfaces_=function(){return[]},ci.prototype.getClass=function(){return ci};var ai=function(){var A=arguments[0];this.an=null,this.vn=null,this.ln=null,this.wn=null,this.vn=A,this.ln=A.getSRID()},vi={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};ai.prototype.isGeometryCollection=function(){return this.getSortIndex()===ai.SORTINDEX_GEOMETRYCOLLECTION},ai.prototype.getFactory=function(){return this.vn},ai.prototype.getGeometryN=function(A){return this},ai.prototype.getArea=function(){return 0},ai.prototype.isRectangle=function(){return!1},ai.prototype.equals=function(){if(arguments[0]instanceof ai){var A=arguments[0];return null!==A&&this.equalsTopo(A)}if(arguments[0]instanceof Object){var t=arguments[0];if(!(t instanceof ai))return!1;var n=t;return this.equalsExact(n)}},ai.prototype.equalsExact=function(A){return this===A||this.equalsExact(A,0)},ai.prototype.geometryChanged=function(){this.apply(ai.geometryChangedFilter)},ai.prototype.geometryChangedAction=function(){this.an=null},ai.prototype.equalsNorm=function(A){return null!==A&&this.norm().equalsExact(A.norm())},ai.prototype.getLength=function(){return 0},ai.prototype.getNumGeometries=function(){return 1},ai.prototype.compareTo=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getSortIndex()!==t.getSortIndex()?this.getSortIndex()-t.getSortIndex():this.isEmpty()&&t.isEmpty()?0:this.isEmpty()?-1:t.isEmpty()?1:this.compareToSameClass(A)}if(2===arguments.length){var n=arguments[0],i=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,i)}},ai.prototype.getUserData=function(){return this.wn},ai.prototype.getSRID=function(){return this.ln},ai.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())},ai.prototype.checkNotGeometryCollection=function(A){if(A.getSortIndex()===ai.SORTINDEX_GEOMETRYCOLLECTION)throw new Dn("This method does not support GeometryCollection arguments")},ai.prototype.equal=function(A,t,n){return 0===n?A.equals(t):A.distance(t)<=n},ai.prototype.norm=function(){var A=this.copy();return A.normalize(),A},ai.prototype.getPrecisionModel=function(){return this.vn.getPrecisionModel()},ai.prototype.getEnvelopeInternal=function(){return null===this.an&&(this.an=this.computeEnvelopeInternal()),new Kn(this.an)},ai.prototype.setSRID=function(A){this.ln=A},ai.prototype.setUserData=function(A){this.wn=A},ai.prototype.compare=function(A,t){for(var n=A.iterator(),i=t.iterator();n.hasNext()&&i.hasNext();){var r=n.next(),e=i.next(),s=r.compareTo(e);if(0!==s)return s}return n.hasNext()?1:i.hasNext()?-1:0},ai.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()},ai.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===ai.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===ai.SORTINDEX_MULTIPOINT||this.getSortIndex()===ai.SORTINDEX_MULTILINESTRING||this.getSortIndex()===ai.SORTINDEX_MULTIPOLYGON},ai.prototype.interfaces_=function(){return[zn,bn,xn]},ai.prototype.getClass=function(){return ai},ai.hasNonEmptyElements=function(A){for(var t=0;t<A.length;t++)if(!A[t].isEmpty())return!0;return!1},ai.hasNullElements=function(A){for(var t=0;t<A.length;t++)if(null===A[t])return!0;return!1},vi.serialVersionUID.get=function(){return 0x799ea46522854c00},vi.SORTINDEX_POINT.get=function(){return 0},vi.SORTINDEX_MULTIPOINT.get=function(){return 1},vi.SORTINDEX_LINESTRING.get=function(){return 2},vi.SORTINDEX_LINEARRING.get=function(){return 3},vi.SORTINDEX_MULTILINESTRING.get=function(){return 4},vi.SORTINDEX_POLYGON.get=function(){return 5},vi.SORTINDEX_MULTIPOLYGON.get=function(){return 6},vi.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7},vi.geometryChangedFilter.get=function(){return li},Object.defineProperties(ai,vi);var li=function(){};li.interfaces_=function(){return[ci]},li.filter=function(A){A.geometryChangedAction()};var wi=function(){};wi.prototype.filter=function(A){},wi.prototype.interfaces_=function(){return[]},wi.prototype.getClass=function(){return wi};var Pi=function(){},gi={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Pi.prototype.isInBoundary=function(A){},Pi.prototype.interfaces_=function(){return[]},Pi.prototype.getClass=function(){return Pi},gi.Mod2BoundaryNodeRule.get=function(){return Ci},gi.EndPointBoundaryNodeRule.get=function(){return Di},gi.MultiValentEndPointBoundaryNodeRule.get=function(){return Ii},gi.MonoValentEndPointBoundaryNodeRule.get=function(){return Mi},gi.MOD2_BOUNDARY_RULE.get=function(){return new Ci},gi.ENDPOINT_BOUNDARY_RULE.get=function(){return new Di},gi.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Ii},gi.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new Mi},gi.OGC_SFS_BOUNDARY_RULE.get=function(){return Pi.MOD2_BOUNDARY_RULE},Object.defineProperties(Pi,gi);var Ci=function(){};Ci.prototype.isInBoundary=function(A){return A%2==1},Ci.prototype.interfaces_=function(){return[Pi]},Ci.prototype.getClass=function(){return Ci};var Di=function(){};Di.prototype.isInBoundary=function(A){return A>0},Di.prototype.interfaces_=function(){return[Pi]},Di.prototype.getClass=function(){return Di};var Ii=function(){};Ii.prototype.isInBoundary=function(A){return A>1},Ii.prototype.interfaces_=function(){return[Pi]},Ii.prototype.getClass=function(){return Ii};var Mi=function(){};Mi.prototype.isInBoundary=function(A){return 1===A},Mi.prototype.interfaces_=function(){return[Pi]},Mi.prototype.getClass=function(){return Mi};var bi=function(){};function zi(A){this.message=A||""}bi.prototype.add=function(){},bi.prototype.addAll=function(){},bi.prototype.isEmpty=function(){},bi.prototype.iterator=function(){},bi.prototype.size=function(){},bi.prototype.toArray=function(){},bi.prototype.remove=function(){},(zi.prototype=new Error).name="IndexOutOfBoundsException";var di=function(){};di.prototype.hasNext=function(){},di.prototype.next=function(){},di.prototype.remove=function(){};var xi=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(){},t.prototype.set=function(){},t.prototype.isEmpty=function(){},t}(bi);function mi(A){this.message=A||""}(mi.prototype=new Error).name="NoSuchElementException";var yi=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof bi&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.ensureCapacity=function(){},t.prototype.interfaces_=function(){return[A,bi]},t.prototype.add=function(A){return 1===arguments.length?this.array_.push(A):this.array_.splice(arguments[0],arguments[1]),!0},t.prototype.clear=function(){this.array_=[]},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.set=function(A,t){var n=this.array_[A];return this.array_[A]=t,n},t.prototype.iterator=function(){return new pi(this)},t.prototype.get=function(A){if(A<0||A>=this.size())throw new zi;return this.array_[A]},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.size=function(){return this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.remove=function(A){for(var t=!1,n=0,i=this.array_.length;n<i;n++)if(this.array_[n]===A){this.array_.splice(n,1),t=!0;break}return t},t}(xi),pi=function(A){function t(t){A.call(this),this.arrayList_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new mi;return this.arrayList_.get(this.position_++)},t.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},t.prototype.set=function(A){return this.arrayList_.set(this.position_-1,A)},t.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},t}(di),Li=function(A){function t(){if(A.call(this),0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.ensureCapacity(t.length),this.add(t,!0)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.ensureCapacity(n.length),this.add(n,i)}}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},t.prototype.getCoordinate=function(A){return this.get(A)},t.prototype.addAll=function(){var t=this;if(2===arguments.length){for(var n=arguments[0],i=arguments[1],r=!1,e=n.iterator();e.hasNext();)t.add(e.next(),i),r=!0;return r}return A.prototype.addAll.apply(this,arguments)},t.prototype.clone=function(){for(var t=A.prototype.clone.call(this),n=0;n<this.size();n++)t.add(n,this.get(n).copy());return t},t.prototype.toCoordinateArray=function(){return this.toArray(t.coordArrayType)},t.prototype.add=function(){var t=this;if(1===arguments.length){var n=arguments[0];A.prototype.add.call(this,n)}else if(2===arguments.length){if(arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var i=arguments[0],r=arguments[1];return this.add(i,r,!0),!0}if(arguments[0]instanceof mn&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1];if(!s&&this.size()>=1){var u=this.get(this.size()-1);if(u.equals2D(e))return null}A.prototype.add.call(this,e)}else if(arguments[0]instanceof Object&&"boolean"==typeof arguments[1]){var o=arguments[0],h=arguments[1];return this.add(o,h),!0}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&arguments[0]instanceof Array&&"boolean"==typeof arguments[1]){var f=arguments[0],c=arguments[1],a=arguments[2];if(a)for(var v=0;v<f.length;v++)t.add(f[v],c);else for(var l=f.length-1;l>=0;l--)t.add(f[l],c);return!0}if("boolean"==typeof arguments[2]&&Number.isInteger(arguments[0])&&arguments[1]instanceof mn){var w=arguments[0],P=arguments[1],g=arguments[2];if(!g){var C=this.size();if(C>0){if(w>0){var D=this.get(w-1);if(D.equals2D(P))return null}if(w<C){var I=this.get(w);if(I.equals2D(P))return null}}}A.prototype.add.call(this,w,P)}}else if(4===arguments.length){var M=arguments[0],b=arguments[1],z=arguments[2],d=arguments[3],x=1;z>d&&(x=-1);for(var m=z;m!==d;m+=x)t.add(M[m],b);return!0}},t.prototype.closeRing=function(){this.size()>0&&this.add(new mn(this.get(0)),!1)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},Object.defineProperties(t,n),t}(yi),Ti=function(){},Oi={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};Oi.ForwardComparator.get=function(){return Fi},Oi.BidirectionalComparator.get=function(){return Ui},Oi.coordArrayType.get=function(){return new Array(0).fill(null)},Ti.prototype.interfaces_=function(){return[]},Ti.prototype.getClass=function(){return Ti},Ti.isRing=function(A){return!(A.length<4||!A[0].equals2D(A[A.length-1]))},Ti.ptNotInList=function(A,t){for(var n=0;n<A.length;n++){var i=A[n];if(Ti.indexOf(i,t)<0)return i}return null},Ti.scroll=function(A,t){var n=Ti.indexOf(t,A);if(n<0)return null;var i=new Array(A.length).fill(null);Wn.arraycopy(A,n,i,0,A.length-n),Wn.arraycopy(A,0,i,A.length-n,n),Wn.arraycopy(i,0,A,0,A.length)},Ti.equals=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];if(A===t)return!0;if(null===A||null===t)return!1;if(A.length!==t.length)return!1;for(var n=0;n<A.length;n++)if(!A[n].equals(t[n]))return!1;return!0}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(i===r)return!0;if(null===i||null===r)return!1;if(i.length!==r.length)return!1;for(var s=0;s<i.length;s++)if(0!==e.compare(i[s],r[s]))return!1;return!0}},Ti.intersection=function(A,t){for(var n=new Li,i=0;i<A.length;i++)t.intersects(A[i])&&n.add(A[i],!0);return n.toCoordinateArray()},Ti.hasRepeatedPoints=function(A){for(var t=1;t<A.length;t++)if(A[t-1].equals(A[t]))return!0;return!1},Ti.removeRepeatedPoints=function(A){return Ti.hasRepeatedPoints(A)?new Li(A,!1).toCoordinateArray():A},Ti.reverse=function(A){for(var t=A.length-1,n=Math.trunc(t/2),i=0;i<=n;i++){var r=A[i];A[i]=A[t-i],A[t-i]=r}},Ti.removeNull=function(A){for(var t=0,n=0;n<A.length;n++)null!==A[n]&&t++;var i=new Array(t).fill(null);if(0===t)return i;for(var r=0,e=0;e<A.length;e++)null!==A[e]&&(i[r++]=A[e]);return i},Ti.copyDeep=function(){if(1===arguments.length){for(var A=arguments[0],t=new Array(A.length).fill(null),n=0;n<A.length;n++)t[n]=new mn(A[n]);return t}if(5===arguments.length)for(var i=arguments[0],r=arguments[1],e=arguments[2],s=arguments[3],u=arguments[4],o=0;o<u;o++)e[s+o]=new mn(i[r+o])},Ti.isEqualReversed=function(A,t){for(var n=0;n<A.length;n++){if(0!==A[n].compareTo(t[A.length-n-1]))return!1}return!0},Ti.envelope=function(A){for(var t=new Kn,n=0;n<A.length;n++)t.expandToInclude(A[n]);return t},Ti.toCoordinateArray=function(A){return A.toArray(Ti.coordArrayType)},Ti.atLeastNCoordinatesOrNothing=function(A,t){return t.length>=A?t:[]},Ti.indexOf=function(A,t){for(var n=0;n<t.length;n++)if(A.equals(t[n]))return n;return-1},Ti.increasingDirection=function(A){for(var t=0;t<Math.trunc(A.length/2);t++){var i=A[t].compareTo(A[A.length-1-t]);if(0!==i)return i}return 1},Ti.compare=function(A,t){for(var n=0;n<A.length&&n<t.length;){var i=A[n].compareTo(t[n]);if(0!==i)return i;n++}return n<t.length?-1:n<A.length?1:0},Ti.minCoordinate=function(A){for(var t=null,n=0;n<A.length;n++)(null===t||t.compareTo(A[n])>0)&&(t=A[n]);return t},Ti.extract=function(A,t,n){t=Un.clamp(t,0,A.length);var i=(n=Un.clamp(n,-1,A.length))-t+1;n<0&&(i=0),t>=A.length&&(i=0),n<t&&(i=0);var r=new Array(i).fill(null);if(0===i)return r;for(var e=0,s=t;s<=n;s++)r[e++]=A[s];return r},Object.defineProperties(Ti,Oi);var Fi=function(){};Fi.prototype.compare=function(A,t){return Ti.compare(A,t)},Fi.prototype.interfaces_=function(){return[dn]},Fi.prototype.getClass=function(){return Fi};var Ui=function(){};Ui.prototype.compare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;var r=Ti.compare(n,i);return Ti.isEqualReversed(n,i)?0:r},Ui.prototype.OLDcompare=function(A,t){var n=A,i=t;if(n.length<i.length)return-1;if(n.length>i.length)return 1;if(0===n.length)return 0;for(var r=Ti.increasingDirection(n),e=Ti.increasingDirection(i),s=r>0?0:n.length-1,u=e>0?0:n.length-1,o=0;o<n.length;o++){var h=n[s].compareTo(i[u]);if(0!==h)return h;s+=r,u+=e}return 0},Ui.prototype.interfaces_=function(){return[dn]},Ui.prototype.getClass=function(){return Ui};var Ei=function(){};Ei.prototype.get=function(){},Ei.prototype.put=function(){},Ei.prototype.size=function(){},Ei.prototype.values=function(){},Ei.prototype.entrySet=function(){};var Ni=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t}(Ei);function ji(A){this.message=A||""}function Qi(){}(ji.prototype=new Error).name="OperationNotSupported",(Qi.prototype=new bi).contains=function(){};var Si=function(A){function t(){A.call(this),this.array_=[],arguments[0]instanceof bi&&this.addAll(arguments[0])}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(this.array_[t]===A)return!0;return!1},t.prototype.add=function(A){return!this.contains(A)&&(this.array_.push(A),!0)},t.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},t.prototype.remove=function(A){throw new Error},t.prototype.size=function(){return this.array_.length},t.prototype.isEmpty=function(){return 0===this.array_.length},t.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},t.prototype.iterator=function(){return new ki(this)},t}(Qi),ki=function(A){function t(t){A.call(this),this.hashSet_=t,this.position_=0}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new mi;return this.hashSet_.array_[this.position_++]},t.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},t.prototype.remove=function(){throw new ji},t}(di);function Bi(A){return null===A?0:A.color}function Ri(A){return null===A?null:A.parent}function Gi(A,t){null!==A&&(A.color=t)}function Yi(A){return null===A?null:A.left}function qi(A){return null===A?null:A.right}function Vi(){this.root_=null,this.size_=0}(Vi.prototype=new Ni).get=function(A){for(var t=this.root_;null!==t;){var n=A.compareTo(t.key);if(n<0)t=t.left;else{if(!(n>0))return t.value;t=t.right}}return null},Vi.prototype.put=function(A,t){if(null===this.root_)return this.root_={key:A,value:t,left:null,right:null,parent:null,color:0,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n,i,r=this.root_;do{if(n=r,(i=A.compareTo(r.key))<0)r=r.left;else{if(!(i>0)){var e=r.value;return r.value=t,e}r=r.right}}while(null!==r);var s={key:A,left:null,right:null,value:t,parent:n,color:0,getValue:function(){return this.value},getKey:function(){return this.key}};return i<0?n.left=s:n.right=s,this.fixAfterInsertion(s),this.size_++,null},Vi.prototype.fixAfterInsertion=function(A){for(A.color=1;null!=A&&A!==this.root_&&1===A.parent.color;)if(Ri(A)===Yi(Ri(Ri(A)))){var t=qi(Ri(Ri(A)));1===Bi(t)?(Gi(Ri(A),0),Gi(t,0),Gi(Ri(Ri(A)),1),A=Ri(Ri(A))):(A===qi(Ri(A))&&(A=Ri(A),this.rotateLeft(A)),Gi(Ri(A),0),Gi(Ri(Ri(A)),1),this.rotateRight(Ri(Ri(A))))}else{var n=Yi(Ri(Ri(A)));1===Bi(n)?(Gi(Ri(A),0),Gi(n,0),Gi(Ri(Ri(A)),1),A=Ri(Ri(A))):(A===Yi(Ri(A))&&(A=Ri(A),this.rotateRight(A)),Gi(Ri(A),0),Gi(Ri(Ri(A)),1),this.rotateLeft(Ri(Ri(A))))}this.root_.color=0},Vi.prototype.values=function(){var A=new yi,t=this.getFirstEntry();if(null!==t)for(A.add(t.value);null!==(t=Vi.successor(t));)A.add(t.value);return A},Vi.prototype.entrySet=function(){var A=new Si,t=this.getFirstEntry();if(null!==t)for(A.add(t);null!==(t=Vi.successor(t));)A.add(t);return A},Vi.prototype.rotateLeft=function(A){if(null!=A){var t=A.right;A.right=t.left,null!=t.left&&(t.left.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.left===A?A.parent.left=t:A.parent.right=t,t.left=A,A.parent=t}},Vi.prototype.rotateRight=function(A){if(null!=A){var t=A.left;A.left=t.right,null!=t.right&&(t.right.parent=A),t.parent=A.parent,null===A.parent?this.root_=t:A.parent.right===A?A.parent.right=t:A.parent.left=t,t.right=A,A.parent=t}},Vi.prototype.getFirstEntry=function(){var A=this.root_;if(null!=A)for(;null!=A.left;)A=A.left;return A},Vi.successor=function(A){if(null===A)return null;if(null!==A.right){for(var t=A.right;null!==t.left;)t=t.left;return t}for(var n=A.parent,i=A;null!==n&&i===n.right;)i=n,n=n.parent;return n},Vi.prototype.size=function(){return this.size_};var Wi=function(){};function _i(){}function Ki(){this.array_=[],arguments[0]instanceof bi&&this.addAll(arguments[0])}Wi.prototype.interfaces_=function(){return[]},Wi.prototype.getClass=function(){return Wi},_i.prototype=new Qi,(Ki.prototype=new _i).contains=function(A){for(var t=0,n=this.array_.length;t<n;t++)if(0===this.array_[t].compareTo(A))return!0;return!1},Ki.prototype.add=function(A){if(this.contains(A))return!1;for(var t=0,n=this.array_.length;t<n;t++)if(1===this.array_[t].compareTo(A))return this.array_.splice(t,0,A),!0;return this.array_.push(A),!0},Ki.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next());return!0},Ki.prototype.remove=function(A){throw new ji},Ki.prototype.size=function(){return this.array_.length},Ki.prototype.isEmpty=function(){return 0===this.array_.length},Ki.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A},Ki.prototype.iterator=function(){return new Hi(this)};var Hi=function(A){this.treeSet_=A,this.position_=0};Hi.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new mi;return this.treeSet_.array_[this.position_++]},Hi.prototype.hasNext=function(){return this.position_<this.treeSet_.size()},Hi.prototype.remove=function(){throw new ji};var Ji=function(){};Ji.sort=function(){var A,t,n,i,r=arguments[0];if(1===arguments.length)i=function(A,t){return A.compareTo(t)},r.sort(i);else if(2===arguments.length)n=arguments[1],i=function(A,t){return n.compare(A,t)},r.sort(i);else if(3===arguments.length){(t=r.slice(arguments[1],arguments[2])).sort();var e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length));for(r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])}else if(4===arguments.length)for(t=r.slice(arguments[1],arguments[2]),n=arguments[3],i=function(A,t){return n.compare(A,t)},t.sort(i),e=r.slice(0,arguments[1]).concat(t,r.slice(arguments[2],r.length)),r.splice(0,r.length),A=0;A<e.length;A++)r.push(e[A])},Ji.asList=function(A){for(var t=new yi,n=0,i=A.length;n<i;n++)t.add(A[n]);return t};var Zi=function(){},Xi={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};Xi.P.get=function(){return 0},Xi.L.get=function(){return 1},Xi.A.get=function(){return 2},Xi.FALSE.get=function(){return-1},Xi.TRUE.get=function(){return-2},Xi.DONTCARE.get=function(){return-3},Xi.SYM_FALSE.get=function(){return"F"},Xi.SYM_TRUE.get=function(){return"T"},Xi.SYM_DONTCARE.get=function(){return"*"},Xi.SYM_P.get=function(){return"0"},Xi.SYM_L.get=function(){return"1"},Xi.SYM_A.get=function(){return"2"},Zi.prototype.interfaces_=function(){return[]},Zi.prototype.getClass=function(){return Zi},Zi.toDimensionSymbol=function(A){switch(A){case Zi.FALSE:return Zi.SYM_FALSE;case Zi.TRUE:return Zi.SYM_TRUE;case Zi.DONTCARE:return Zi.SYM_DONTCARE;case Zi.P:return Zi.SYM_P;case Zi.L:return Zi.SYM_L;case Zi.A:return Zi.SYM_A}throw new Dn("Unknown dimension value: "+A)},Zi.toDimensionValue=function(A){switch(Qn.toUpperCase(A)){case Zi.SYM_FALSE:return Zi.FALSE;case Zi.SYM_TRUE:return Zi.TRUE;case Zi.SYM_DONTCARE:return Zi.DONTCARE;case Zi.SYM_P:return Zi.P;case Zi.SYM_L:return Zi.L;case Zi.SYM_A:return Zi.A}throw new Dn("Unknown dimension symbol: "+A)},Object.defineProperties(Zi,Xi);var $i=function(){};$i.prototype.filter=function(A){},$i.prototype.interfaces_=function(){return[]},$i.prototype.getClass=function(){return $i};var Ar=function(){};Ar.prototype.filter=function(A,t){},Ar.prototype.isDone=function(){},Ar.prototype.isGeometryChanged=function(){},Ar.prototype.interfaces_=function(){return[]},Ar.prototype.getClass=function(){return Ar};var tr=function(A){function t(t,n){if(A.call(this,n),this.Ht=t||[],A.hasNullElements(this.Ht))throw new Dn("geometries must not contain null elements")}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){for(var A=new Kn,t=0;t<this.Ht.length;t++)A.expandToInclude(this.Ht[t].getEnvelopeInternal());return A},t.prototype.getGeometryN=function(A){return this.Ht[A]},t.prototype.getSortIndex=function(){return A.SORTINDEX_GEOMETRYCOLLECTION},t.prototype.getCoordinates=function(){for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=0;n<this.Ht.length;n++)for(var i=this.Ht[n].getCoordinates(),r=0;r<i.length;r++)A[++t]=i[r];return A},t.prototype.getArea=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getArea();return A},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this.Ht.length!==r.Ht.length)return!1;for(var e=0;e<this.Ht.length;e++)if(!t.Ht[e].equalsExact(r.Ht[e],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<this.Ht.length;A++)this.Ht[A].normalize();Ji.sort(this.Ht)},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this.Ht[0].getCoordinate()},t.prototype.getBoundaryDimension=function(){for(var A=Zi.FALSE,t=0;t<this.Ht.length;t++)A=Math.max(A,this.Ht[t].getBoundaryDimension());return A},t.prototype.getDimension=function(){for(var A=Zi.FALSE,t=0;t<this.Ht.length;t++)A=Math.max(A,this.Ht[t].getDimension());return A},t.prototype.getLength=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=0,t=0;t<this.Ht.length;t++)A+=this.Ht[t].getNumPoints();return A},t.prototype.getNumGeometries=function(){return this.Ht.length},t.prototype.reverse=function(){for(var t=new Array(this.Ht.length).fill(null),n=0;n<this.Ht.length;n++)t[n]=this.Ht[n].reverse();return this.getFactory().createGeometryCollection(t)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new Ki(Ji.asList(this.Ht)),i=new Ki(Ji.asList(t.Ht));return this.compare(n,i)}if(2===arguments.length){for(var r=arguments[0],e=arguments[1],s=r,u=this.getNumGeometries(),o=s.getNumGeometries(),h=0;h<u&&h<o;){var f=A.getGeometryN(h),c=s.getGeometryN(h),a=f.compareToSameClass(c,e);if(0!==a)return a;h++}return h<u?1:h<o?-1:0}},t.prototype.apply=function(){var A=this;if(Fn(arguments[0],wi))for(var t=arguments[0],n=0;n<this.Ht.length;n++)A.Ht[n].apply(t);else if(Fn(arguments[0],Ar)){var i=arguments[0];if(0===this.Ht.length)return null;for(var r=0;r<this.Ht.length&&(A.Ht[r].apply(i),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(Fn(arguments[0],$i)){var e=arguments[0];e.filter(this);for(var s=0;s<this.Ht.length;s++)A.Ht[s].apply(e)}else if(Fn(arguments[0],ci)){var u=arguments[0];u.filter(this);for(var o=0;o<this.Ht.length;o++)A.Ht[o].apply(u)}},t.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),ii.shouldNeverReachHere(),null},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.Ht=new Array(this.Ht.length).fill(null);for(var n=0;n<this.Ht.length;n++)t.Ht[n]=this.Ht[n].clone();return t},t.prototype.getGeometryType=function(){return"GeometryCollection"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.vn)},t.prototype.isEmpty=function(){for(var A=0;A<this.Ht.length;A++)if(!this.Ht[A].isEmpty())return!1;return!0},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x4f07bcb1f857d800},Object.defineProperties(t,n),t}(ai),nr=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ai.SORTINDEX_MULTILINESTRING},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Zi.FALSE:0},t.prototype.isClosed=function(){if(this.isEmpty())return!1;for(var A=0;A<this.Ht.length;A++)if(!this.Ht[A].isClosed())return!1;return!0},t.prototype.getDimension=function(){return 1},t.prototype.reverse=function(){for(var A=this.Ht.length,t=new Array(A).fill(null),n=0;n<this.Ht.length;n++)t[A-1-n]=this.Ht[n].reverse();return this.getFactory().createMultiLineString(t)},t.prototype.getBoundary=function(){return new ir(this).getBoundary()},t.prototype.getGeometryType=function(){return"MultiLineString"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.vn)},t.prototype.interfaces_=function(){return[Wi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x7155d2ab4afa8000},Object.defineProperties(t,n),t}(tr),ir=function(){if(this.Pn=null,this.gn=null,this.Cn=null,this.Dn=null,1===arguments.length){var A=arguments[0],t=Pi.MOD2_BOUNDARY_RULE;this.Pn=A,this.gn=A.getFactory(),this.Cn=t}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.Pn=n,this.gn=n.getFactory(),this.Cn=i}};ir.prototype.boundaryMultiLineString=function(A){if(this.Pn.isEmpty())return this.getEmptyMultiPoint();var t=this.computeBoundaryCoordinates(A);return 1===t.length?this.gn.createPoint(t[0]):this.gn.createMultiPointFromCoords(t)},ir.prototype.getBoundary=function(){return this.Pn instanceof lr?this.boundaryLineString(this.Pn):this.Pn instanceof nr?this.boundaryMultiLineString(this.Pn):this.Pn.getBoundary()},ir.prototype.boundaryLineString=function(A){return this.Pn.isEmpty()?this.getEmptyMultiPoint():A.isClosed()?this.Cn.isInBoundary(2)?A.getStartPoint():this.gn.createMultiPoint():this.gn.createMultiPoint([A.getStartPoint(),A.getEndPoint()])},ir.prototype.getEmptyMultiPoint=function(){return this.gn.createMultiPoint()},ir.prototype.computeBoundaryCoordinates=function(A){var t=new yi;this.Dn=new Vi;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);0!==i.getNumPoints()&&(this.addEndpoint(i.getCoordinateN(0)),this.addEndpoint(i.getCoordinateN(i.getNumPoints()-1)))}for(var r=this.Dn.entrySet().iterator();r.hasNext();){var e=r.next(),s=e.getValue().count;this.Cn.isInBoundary(s)&&t.add(e.getKey())}return Ti.toCoordinateArray(t)},ir.prototype.addEndpoint=function(A){var t=this.Dn.get(A);null===t&&(t=new rr,this.Dn.put(A,t)),t.count++},ir.prototype.interfaces_=function(){return[]},ir.prototype.getClass=function(){return ir},ir.getBoundary=function(){if(1===arguments.length){var A=arguments[0],t=new ir(A);return t.getBoundary()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new ir(n,i);return r.getBoundary()}};var rr=function(){this.count=null};function er(){}function sr(){}rr.prototype.interfaces_=function(){return[]},rr.prototype.getClass=function(){return rr};var ur=function(){};function or(){}function hr(){}function fr(){}var cr=function(){},ar={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};cr.prototype.interfaces_=function(){return[]},cr.prototype.getClass=function(){return cr},cr.chars=function(A,t){for(var n=new Array(t).fill(null),i=0;i<t;i++)n[i]=A;return String(n)},cr.getStackTrace=function(){if(1===arguments.length){var A=arguments[0],t=new or,n=new er;return A.printStackTrace(n),t.toString()}if(2===arguments.length){var i=arguments[0],r=arguments[1],e="";new sr(cr.getStackTrace(i));for(var s=new fr,u=0;u<r;u++)try{e+=s.readLine()+cr.NEWLINE}catch(A){if(!(A instanceof hr))throw A;ii.shouldNeverReachHere()}return e}},cr.split=function(A,t){for(var n=t.length,i=new yi,r=""+A,e=r.indexOf(t);e>=0;){var s=r.substring(0,e);i.add(s),e=(r=r.substring(e+n)).indexOf(t)}r.length>0&&i.add(r);for(var u=new Array(i.size()).fill(null),o=0;o<u.length;o++)u[o]=i.get(o);return u},cr.toString=function(){if(1===arguments.length){var A=arguments[0];return cr.SIMPLE_ORDINATE_FORMAT.format(A)}},cr.spaces=function(A){return cr.chars(" ",A)},ar.NEWLINE.get=function(){return Wn.getProperty("line.separator")},ar.SIMPLE_ORDINATE_FORMAT.get=function(){return new ur},Object.defineProperties(cr,ar);var vr=function(){};vr.prototype.interfaces_=function(){return[]},vr.prototype.getClass=function(){return vr},vr.copyCoord=function(A,t,n,i){for(var r=Math.min(A.getDimension(),n.getDimension()),e=0;e<r;e++)n.setOrdinate(i,e,A.getOrdinate(t,e))},vr.isRing=function(A){var t=A.size();return 0===t||!(t<=3)&&A.getOrdinate(0,Gn.X)===A.getOrdinate(t-1,Gn.X)&&A.getOrdinate(0,Gn.Y)===A.getOrdinate(t-1,Gn.Y)},vr.isEqual=function(A,t){var n=A.size();if(n!==t.size())return!1;for(var i=Math.min(A.getDimension(),t.getDimension()),r=0;r<n;r++)for(var e=0;e<i;e++){var s=A.getOrdinate(r,e),u=t.getOrdinate(r,e);if(!(A.getOrdinate(r,e)===t.getOrdinate(r,e)||In.isNaN(s)&&In.isNaN(u)))return!1}return!0},vr.extend=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();if(vr.copy(t,0,i,0,r),r>0)for(var e=r;e<n;e++)vr.copy(t,r-1,i,e,1);return i},vr.reverse=function(A){for(var t=A.size()-1,n=Math.trunc(t/2),i=0;i<=n;i++)vr.swap(A,i,t-i)},vr.swap=function(A,t,n){if(t===n)return null;for(var i=0;i<A.getDimension();i++){var r=A.getOrdinate(t,i);A.setOrdinate(t,i,A.getOrdinate(n,i)),A.setOrdinate(n,i,r)}},vr.copy=function(A,t,n,i,r){for(var e=0;e<r;e++)vr.copyCoord(A,t+e,n,i+e)},vr.toString=function(){if(1===arguments.length){var A=arguments[0],t=A.size();if(0===t)return"()";var n=A.getDimension(),i=new Nn;i.append("(");for(var r=0;r<t;r++){r>0&&i.append(" ");for(var e=0;e<n;e++)e>0&&i.append(","),i.append(cr.toString(A.getOrdinate(r,e)))}return i.append(")"),i.toString()}},vr.ensureValidRing=function(A,t){var n=t.size();return 0===n?t:n<=3?vr.createClosedRing(A,t,4):t.getOrdinate(0,Gn.X)===t.getOrdinate(n-1,Gn.X)&&t.getOrdinate(0,Gn.Y)===t.getOrdinate(n-1,Gn.Y)?t:vr.createClosedRing(A,t,n+1)},vr.createClosedRing=function(A,t,n){var i=A.create(n,t.getDimension()),r=t.size();vr.copy(t,0,i,0,r);for(var e=r;e<n;e++)vr.copy(t,0,i,e,1);return i};var lr=function(A){function t(t,n){A.call(this,n),this.Jt=null,this.init(t)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new Kn:this.Jt.expandEnvelope(new Kn)},t.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},t.prototype.getSortIndex=function(){return A.SORTINDEX_LINESTRING},t.prototype.getCoordinates=function(){return this.Jt.toCoordinateArray()},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n;if(this.Jt.size()!==r.Jt.size())return!1;for(var e=0;e<this.Jt.size();e++)if(!t.equal(t.Jt.getCoordinate(e),r.Jt.getCoordinate(e),i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){for(var A=0;A<Math.trunc(this.Jt.size()/2);A++){var t=this.Jt.size()-1-A;if(!this.Jt.getCoordinate(A).equals(this.Jt.getCoordinate(t)))return this.Jt.getCoordinate(A).compareTo(this.Jt.getCoordinate(t))>0&&vr.reverse(this.Jt),null}},t.prototype.getCoordinate=function(){return this.isEmpty()?null:this.Jt.getCoordinate(0)},t.prototype.getBoundaryDimension=function(){return this.isClosed()?Zi.FALSE:0},t.prototype.isClosed=function(){return!this.isEmpty()&&this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},t.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},t.prototype.getDimension=function(){return 1},t.prototype.getLength=function(){return hi.computeLength(this.Jt)},t.prototype.getNumPoints=function(){return this.Jt.size()},t.prototype.reverse=function(){var A=this.Jt.copy();return vr.reverse(A),this.getFactory().createLineString(A)},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=t,i=0,r=0;i<this.Jt.size()&&r<n.Jt.size();){var e=A.Jt.getCoordinate(i).compareTo(n.Jt.getCoordinate(r));if(0!==e)return e;i++,r++}return i<this.Jt.size()?1:r<n.Jt.size()?-1:0}if(2===arguments.length){var s=arguments[0],u=arguments[1],o=s;return u.compare(this.Jt,o.Jt)}},t.prototype.apply=function(){var A=this;if(Fn(arguments[0],wi))for(var t=arguments[0],n=0;n<this.Jt.size();n++)t.filter(A.Jt.getCoordinate(n));else if(Fn(arguments[0],Ar)){var i=arguments[0];if(0===this.Jt.size())return null;for(var r=0;r<this.Jt.size()&&(i.filter(A.Jt,r),!i.isDone());r++);i.isGeometryChanged()&&this.geometryChanged()}else if(Fn(arguments[0],$i)){var e=arguments[0];e.filter(this)}else if(Fn(arguments[0],ci)){var s=arguments[0];s.filter(this)}},t.prototype.getBoundary=function(){return new ir(this).getBoundary()},t.prototype.isEquivalentClass=function(A){return A instanceof t},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t.Jt=this.Jt.clone(),t},t.prototype.getCoordinateN=function(A){return this.Jt.getCoordinate(A)},t.prototype.getGeometryType=function(){return"LineString"},t.prototype.copy=function(){return new t(this.Jt.copy(),this.vn)},t.prototype.getCoordinateSequence=function(){return this.Jt},t.prototype.isEmpty=function(){return 0===this.Jt.size()},t.prototype.init=function(A){if(null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),1===A.size())throw new Dn("Invalid number of points in LineString (found "+A.size()+" - must be 0 or >= 2)");this.Jt=A},t.prototype.isCoordinate=function(A){for(var t=0;t<this.Jt.size();t++)if(this.Jt.getCoordinate(t).equals(A))return!0;return!1},t.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},t.prototype.getPointN=function(A){return this.getFactory().createPoint(this.Jt.getCoordinate(A))},t.prototype.interfaces_=function(){return[Wi]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(t,n),t}(ai),wr=function(){};wr.prototype.interfaces_=function(){return[]},wr.prototype.getClass=function(){return wr};var Pr=function(A){function t(t,n){A.call(this,n),this.Kt=t||null,this.init(this.Kt)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new Kn;var A=new Kn;return A.expandToInclude(this.Kt.getX(0),this.Kt.getY(0)),A},t.prototype.getSortIndex=function(){return A.SORTINDEX_POINT},t.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&(!(!this.isEmpty()||!t.isEmpty())||this.isEmpty()===t.isEmpty()&&this.equal(t.getCoordinate(),this.getCoordinate(),n))}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){},t.prototype.getCoordinate=function(){return 0!==this.Kt.size()?this.Kt.getCoordinate(0):null},t.prototype.getBoundaryDimension=function(){return Zi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getNumPoints=function(){return this.isEmpty()?0:1},t.prototype.reverse=function(){return this.copy()},t.prototype.getX=function(){if(null===this.getCoordinate())throw new Error("getX called on empty Point");return this.getCoordinate().x},t.prototype.compareToSameClass=function(){if(1===arguments.length){var A=arguments[0],t=A;return this.getCoordinate().compareTo(t.getCoordinate())}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=n;return i.compare(this.Kt,r.Kt)}},t.prototype.apply=function(){if(Fn(arguments[0],wi)){var A=arguments[0];if(this.isEmpty())return null;A.filter(this.getCoordinate())}else if(Fn(arguments[0],Ar)){var t=arguments[0];if(this.isEmpty())return null;t.filter(this.Kt,0),t.isGeometryChanged()&&this.geometryChanged()}else if(Fn(arguments[0],$i)){var n=arguments[0];n.filter(this)}else if(Fn(arguments[0],ci)){var i=arguments[0];i.filter(this)}},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);return t.Kt=this.Kt.clone(),t},t.prototype.getGeometryType=function(){return"Point"},t.prototype.copy=function(){return new t(this.Kt.copy(),this.vn)},t.prototype.getCoordinateSequence=function(){return this.Kt},t.prototype.getY=function(){if(null===this.getCoordinate())throw new Error("getY called on empty Point");return this.getCoordinate().y},t.prototype.isEmpty=function(){return 0===this.Kt.size()},t.prototype.init=function(A){null===A&&(A=this.getFactory().getCoordinateSequenceFactory().create([])),ii.isTrue(A.size()<=1),this.Kt=A},t.prototype.isSimple=function(){return!0},t.prototype.interfaces_=function(){return[wr]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return 0x44077bad161cbc00},Object.defineProperties(t,n),t}(ai),gr=function(){};gr.prototype.interfaces_=function(){return[]},gr.prototype.getClass=function(){return gr};var Cr=function(A){function t(t,n,i){if(A.call(this,i),this.Zt=null,this.Xt=null,null===t&&(t=this.getFactory().createLinearRing()),null===n&&(n=[]),A.hasNullElements(n))throw new Dn("holes must not contain null elements");if(t.isEmpty()&&A.hasNonEmptyElements(n))throw new Dn("shell is empty but holes are not");this.Zt=t,this.Xt=n}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.computeEnvelopeInternal=function(){return this.Zt.getEnvelopeInternal()},t.prototype.getSortIndex=function(){return A.SORTINDEX_POLYGON},t.prototype.getCoordinates=function(){if(this.isEmpty())return[];for(var A=new Array(this.getNumPoints()).fill(null),t=-1,n=this.Zt.getCoordinates(),i=0;i<n.length;i++)A[++t]=n[i];for(var r=0;r<this.Xt.length;r++)for(var e=this.Xt[r].getCoordinates(),s=0;s<e.length;s++)A[++t]=e[s];return A},t.prototype.getArea=function(){var A=0;A+=Math.abs(hi.signedArea(this.Zt.getCoordinateSequence()));for(var t=0;t<this.Xt.length;t++)A-=Math.abs(hi.signedArea(this.Xt[t].getCoordinateSequence()));return A},t.prototype.isRectangle=function(){if(0!==this.getNumInteriorRing())return!1;if(null===this.Zt)return!1;if(5!==this.Zt.getNumPoints())return!1;for(var A=this.Zt.getCoordinateSequence(),t=this.getEnvelopeInternal(),n=0;n<5;n++){var i=A.getX(n);if(i!==t.getMinX()&&i!==t.getMaxX())return!1;var r=A.getY(n);if(r!==t.getMinY()&&r!==t.getMaxY())return!1}for(var e=A.getX(0),s=A.getY(0),u=1;u<=4;u++){var o=A.getX(u),h=A.getY(u);if(o!==e==(h!==s))return!1;e=o,s=h}return!0},t.prototype.equalsExact=function(){var t=this;if(2===arguments.length){var n=arguments[0],i=arguments[1];if(!this.isEquivalentClass(n))return!1;var r=n,e=this.Zt,s=r.Zt;if(!e.equalsExact(s,i))return!1;if(this.Xt.length!==r.Xt.length)return!1;for(var u=0;u<this.Xt.length;u++)if(!t.Xt[u].equalsExact(r.Xt[u],i))return!1;return!0}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.normalize=function(){var A=this;if(0===arguments.length){this.normalize(this.Zt,!0);for(var t=0;t<this.Xt.length;t++)A.normalize(A.Xt[t],!1);Ji.sort(this.Xt)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];if(n.isEmpty())return null;var r=new Array(n.getCoordinates().length-1).fill(null);Wn.arraycopy(n.getCoordinates(),0,r,0,r.length);var e=Ti.minCoordinate(n.getCoordinates());Ti.scroll(r,e),Wn.arraycopy(r,0,n.getCoordinates(),0,r.length),n.getCoordinates()[r.length]=r[0],hi.isCCW(n.getCoordinates())===i&&Ti.reverse(n.getCoordinates())}},t.prototype.getCoordinate=function(){return this.Zt.getCoordinate()},t.prototype.getNumInteriorRing=function(){return this.Xt.length},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.getLength=function(){var A=0;A+=this.Zt.getLength();for(var t=0;t<this.Xt.length;t++)A+=this.Xt[t].getLength();return A},t.prototype.getNumPoints=function(){for(var A=this.Zt.getNumPoints(),t=0;t<this.Xt.length;t++)A+=this.Xt[t].getNumPoints();return A},t.prototype.reverse=function(){var A=this.copy();A.Zt=this.Zt.copy().reverse(),A.Xt=new Array(this.Xt.length).fill(null);for(var t=0;t<this.Xt.length;t++)A.Xt[t]=this.Xt[t].copy().reverse();return A},t.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},t.prototype.compareToSameClass=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.Zt,i=t.Zt;return n.compareToSameClass(i)}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r,u=this.Zt,o=s.Zt,h=u.compareToSameClass(o,e);if(0!==h)return h;for(var f=this.getNumInteriorRing(),c=s.getNumInteriorRing(),a=0;a<f&&a<c;){var v=A.getInteriorRingN(a),l=s.getInteriorRingN(a),w=v.compareToSameClass(l,e);if(0!==w)return w;a++}return a<f?1:a<c?-1:0}},t.prototype.apply=function(A){if(Fn(A,wi)){this.Zt.apply(A);for(var t=0;t<this.Xt.length;t++)this.Xt[t].apply(A)}else if(Fn(A,Ar)){if(this.Zt.apply(A),!A.isDone())for(var n=0;n<this.Xt.length&&(this.Xt[n].apply(A),!A.isDone());n++);A.isGeometryChanged()&&this.geometryChanged()}else if(Fn(A,$i))A.filter(this);else if(Fn(A,ci)){A.filter(this),this.Zt.apply(A);for(var i=0;i<this.Xt.length;i++)this.Xt[i].apply(A)}},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();var A=new Array(this.Xt.length+1).fill(null);A[0]=this.Zt;for(var t=0;t<this.Xt.length;t++)A[t+1]=this.Xt[t];return A.length<=1?this.getFactory().createLinearRing(A[0].getCoordinateSequence()):this.getFactory().createMultiLineString(A)},t.prototype.clone=function(){var t=A.prototype.clone.call(this);t.Zt=this.Zt.clone(),t.Xt=new Array(this.Xt.length).fill(null);for(var n=0;n<this.Xt.length;n++)t.Xt[n]=this.Xt[n].clone();return t},t.prototype.getGeometryType=function(){return"Polygon"},t.prototype.copy=function(){for(var A=this.Zt.copy(),n=new Array(this.Xt.length).fill(null),i=0;i<n.length;i++)n[i]=this.Xt[i].copy();return new t(A,n,this.vn)},t.prototype.getExteriorRing=function(){return this.Zt},t.prototype.isEmpty=function(){return this.Zt.isEmpty()},t.prototype.getInteriorRingN=function(A){return this.Xt[A]},t.prototype.interfaces_=function(){return[gr]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(t,n),t}(ai),Dr=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ai.SORTINDEX_MULTIPOINT},t.prototype.isValid=function(){return!0},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getCoordinate=function(){if(1===arguments.length){var t=arguments[0];return this.Ht[t].getCoordinate()}return A.prototype.getCoordinate.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return Zi.FALSE},t.prototype.getDimension=function(){return 0},t.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},t.prototype.getGeometryType=function(){return"MultiPoint"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.vn)},t.prototype.interfaces_=function(){return[wr]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x6fb1ed4162e0fc00},Object.defineProperties(t,n),t}(tr),Ir=function(A){function t(t,n){t instanceof mn&&n instanceof jr&&(t=n.getCoordinateSequenceFactory().create(t)),A.call(this,t,n),this.validateConstruction()}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ai.SORTINDEX_LINEARRING},t.prototype.getBoundaryDimension=function(){return Zi.FALSE},t.prototype.isClosed=function(){return!!this.isEmpty()||A.prototype.isClosed.call(this)},t.prototype.reverse=function(){var A=this.Jt.copy();return vr.reverse(A),this.getFactory().createLinearRing(A)},t.prototype.validateConstruction=function(){if(!this.isEmpty()&&!A.prototype.isClosed.call(this))throw new Dn("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<t.MINIMUM_VALID_SIZE)throw new Dn("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},t.prototype.getGeometryType=function(){return"LinearRing"},t.prototype.copy=function(){return new t(this.Jt.copy(),this.vn)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(t,n),t}(lr),Mr=function(A){function t(){A.apply(this,arguments)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={serialVersionUID:{configurable:!0}};return t.prototype.getSortIndex=function(){return ai.SORTINDEX_MULTIPOLYGON},t.prototype.equalsExact=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return!!this.isEquivalentClass(t)&&A.prototype.equalsExact.call(this,t,n)}return A.prototype.equalsExact.apply(this,arguments)},t.prototype.getBoundaryDimension=function(){return 1},t.prototype.getDimension=function(){return 2},t.prototype.reverse=function(){for(var t=new Array(this.Ht.length).fill(null),n=0;n<this.Ht.length;n++)t[n]=this.Ht[n].reverse();return this.getFactory().createMultiPolygon(t)},t.prototype.getBoundary=function(){if(this.isEmpty())return this.getFactory().createMultiLineString();for(var A=new yi,t=0;t<this.Ht.length;t++)for(var n=this.Ht[t].getBoundary(),i=0;i<n.getNumGeometries();i++)A.add(n.getGeometryN(i));var r=new Array(A.size()).fill(null);return this.getFactory().createMultiLineString(A.toArray(r))},t.prototype.getGeometryType=function(){return"MultiPolygon"},t.prototype.copy=function(){for(var A=new Array(this.Ht.length).fill(null),n=0;n<A.length;n++)A[n]=this.Ht[n].copy();return new t(A,this.vn)},t.prototype.interfaces_=function(){return[gr]},t.prototype.getClass=function(){return t},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(t,n),t}(tr),br=function(A){this.vn=A||null,this.In=!1},zr={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};br.prototype.setCopyUserData=function(A){this.In=A},br.prototype.edit=function(A,t){if(null===A)return null;var n=this.editInternal(A,t);return this.In&&n.setUserData(A.getUserData()),n},br.prototype.editInternal=function(A,t){return null===this.vn&&(this.vn=A.getFactory()),A instanceof tr?this.editGeometryCollection(A,t):A instanceof Cr?this.editPolygon(A,t):A instanceof Pr||A instanceof lr?t.edit(A,this.vn):(ii.shouldNeverReachHere("Unsupported Geometry class: "+A.getClass().getName()),null)},br.prototype.editGeometryCollection=function(A,t){for(var n=t.edit(A,this.vn),i=new yi,r=0;r<n.getNumGeometries();r++){var e=this.edit(n.getGeometryN(r),t);null===e||e.isEmpty()||i.add(e)}return n.getClass()===Dr?this.vn.createMultiPoint(i.toArray([])):n.getClass()===nr?this.vn.createMultiLineString(i.toArray([])):n.getClass()===Mr?this.vn.createMultiPolygon(i.toArray([])):this.vn.createGeometryCollection(i.toArray([]))},br.prototype.editPolygon=function(A,t){var n=t.edit(A,this.vn);if(null===n&&(n=this.vn.createPolygon(null)),n.isEmpty())return n;var i=this.edit(n.getExteriorRing(),t);if(null===i||i.isEmpty())return this.vn.createPolygon();for(var r=new yi,e=0;e<n.getNumInteriorRing();e++){var s=this.edit(n.getInteriorRingN(e),t);null===s||s.isEmpty()||r.add(s)}return this.vn.createPolygon(i,r.toArray([]))},br.prototype.interfaces_=function(){return[]},br.prototype.getClass=function(){return br},br.GeometryEditorOperation=function(){},zr.NoOpGeometryOperation.get=function(){return dr},zr.CoordinateOperation.get=function(){return xr},zr.CoordinateSequenceOperation.get=function(){return mr},Object.defineProperties(br,zr);var dr=function(){};dr.prototype.edit=function(A,t){return A},dr.prototype.interfaces_=function(){return[br.GeometryEditorOperation]},dr.prototype.getClass=function(){return dr};var xr=function(){};xr.prototype.edit=function(A,t){var n=this.editCoordinates(A.getCoordinates(),A);return null===n?A:A instanceof Ir?t.createLinearRing(n):A instanceof lr?t.createLineString(n):A instanceof Pr?n.length>0?t.createPoint(n[0]):t.createPoint():A},xr.prototype.interfaces_=function(){return[br.GeometryEditorOperation]},xr.prototype.getClass=function(){return xr};var mr=function(){};mr.prototype.edit=function(A,t){return A instanceof Ir?t.createLinearRing(this.edit(A.getCoordinateSequence(),A)):A instanceof lr?t.createLineString(this.edit(A.getCoordinateSequence(),A)):A instanceof Pr?t.createPoint(this.edit(A.getCoordinateSequence(),A)):A},mr.prototype.interfaces_=function(){return[br.GeometryEditorOperation]},mr.prototype.getClass=function(){return mr};var yr=function(){var A=this;if(this.Mn=3,this.Kt=null,1===arguments.length){if(arguments[0]instanceof Array)this.Kt=arguments[0],this.Mn=3;else if(Number.isInteger(arguments[0])){var t=arguments[0];this.Kt=new Array(t).fill(null);for(var n=0;n<t;n++)A.Kt[n]=new mn}else if(Fn(arguments[0],Gn)){var i=arguments[0];if(null===i)return this.Kt=new Array(0).fill(null),null;this.Mn=i.getDimension(),this.Kt=new Array(i.size()).fill(null);for(var r=0;r<this.Kt.length;r++)A.Kt[r]=i.getCoordinateCopy(r)}}else if(2===arguments.length)if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var e=arguments[0],s=arguments[1];this.Kt=e,this.Mn=s,null===e&&(this.Kt=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],o=arguments[1];this.Kt=new Array(u).fill(null),this.Mn=o;for(var h=0;h<u;h++)A.Kt[h]=new mn}},pr={serialVersionUID:{configurable:!0}};yr.prototype.setOrdinate=function(A,t,n){switch(t){case Gn.X:this.Kt[A].x=n;break;case Gn.Y:this.Kt[A].y=n;break;case Gn.Z:this.Kt[A].z=n;break;default:throw new Dn("invalid ordinateIndex")}},yr.prototype.size=function(){return this.Kt.length},yr.prototype.getOrdinate=function(A,t){switch(t){case Gn.X:return this.Kt[A].x;case Gn.Y:return this.Kt[A].y;case Gn.Z:return this.Kt[A].z}return In.NaN},yr.prototype.getCoordinate=function(){if(1===arguments.length){var A=arguments[0];return this.Kt[A]}if(2===arguments.length){var t=arguments[0],n=arguments[1];n.x=this.Kt[t].x,n.y=this.Kt[t].y,n.z=this.Kt[t].z}},yr.prototype.getCoordinateCopy=function(A){return new mn(this.Kt[A])},yr.prototype.getDimension=function(){return this.Mn},yr.prototype.getX=function(A){return this.Kt[A].x},yr.prototype.clone=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.Kt.length;t++)A[t]=this.Kt[t].clone();return new yr(A,this.Mn)},yr.prototype.expandEnvelope=function(A){for(var t=0;t<this.Kt.length;t++)A.expandToInclude(this.Kt[t]);return A},yr.prototype.copy=function(){for(var A=new Array(this.size()).fill(null),t=0;t<this.Kt.length;t++)A[t]=this.Kt[t].copy();return new yr(A,this.Mn)},yr.prototype.toString=function(){if(this.Kt.length>0){var A=new Nn(17*this.Kt.length);A.append("("),A.append(this.Kt[0]);for(var t=1;t<this.Kt.length;t++)A.append(", "),A.append(this.Kt[t]);return A.append(")"),A.toString()}return"()"},yr.prototype.getY=function(A){return this.Kt[A].y},yr.prototype.toCoordinateArray=function(){return this.Kt},yr.prototype.interfaces_=function(){return[Gn,xn]},yr.prototype.getClass=function(){return yr},pr.serialVersionUID.get=function(){return-0xcb44a778db18e00},Object.defineProperties(yr,pr);var Lr=function(){},Tr={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};Lr.prototype.readResolve=function(){return Lr.instance()},Lr.prototype.create=function(){if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return new yr(A)}if(Fn(arguments[0],Gn)){var t=arguments[0];return new yr(t)}}else if(2===arguments.length){var n=arguments[0],i=arguments[1];return i>3&&(i=3),i<2?new yr(n):new yr(n,i)}},Lr.prototype.interfaces_=function(){return[Ln,xn]},Lr.prototype.getClass=function(){return Lr},Lr.instance=function(){return Lr.instanceObject},Tr.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00},Tr.instanceObject.get=function(){return new Lr},Object.defineProperties(Lr,Tr);var Or=function(A){function t(){A.call(this),this.map_=new Map}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.get=function(A){return this.map_.get(A)||null},t.prototype.put=function(A,t){return this.map_.set(A,t),t},t.prototype.values=function(){for(var A=new yi,t=this.map_.values(),n=t.next();!n.done;)A.add(n.value),n=t.next();return A},t.prototype.entrySet=function(){var A=new Si;return this.map_.entries().forEach((function(t){return A.add(t)})),A},t.prototype.size=function(){return this.map_.size()},t}(Ei),Fr=function A(){if(this.bn=null,this.xA=null,0===arguments.length)this.bn=A.FLOATING;else if(1===arguments.length)if(arguments[0]instanceof Er){var t=arguments[0];this.bn=t,t===A.FIXED&&this.setScale(1)}else if("number"==typeof arguments[0]){var n=arguments[0];this.bn=A.FIXED,this.setScale(n)}else if(arguments[0]instanceof A){var i=arguments[0];this.bn=i.bn,this.xA=i.xA}},Ur={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};Fr.prototype.equals=function(A){if(!(A instanceof Fr))return!1;return this.bn===A.bn&&this.xA===A.xA},Fr.prototype.compareTo=function(A){var t=A,n=this.getMaximumSignificantDigits(),i=t.getMaximumSignificantDigits();return new jn(n).compareTo(new jn(i))},Fr.prototype.getScale=function(){return this.xA},Fr.prototype.isFloating=function(){return this.bn===Fr.FLOATING||this.bn===Fr.FLOATING_SINGLE},Fr.prototype.getType=function(){return this.bn},Fr.prototype.toString=function(){var A="UNKNOWN";return this.bn===Fr.FLOATING?A="Floating":this.bn===Fr.FLOATING_SINGLE?A="Floating-Single":this.bn===Fr.FIXED&&(A="Fixed (Scale="+this.getScale()+")"),A},Fr.prototype.makePrecise=function(){if("number"==typeof arguments[0]){var A=arguments[0];return In.isNaN(A)||this.bn===Fr.FLOATING_SINGLE?A:this.bn===Fr.FIXED?Math.round(A*this.xA)/this.xA:A}if(arguments[0]instanceof mn){var t=arguments[0];if(this.bn===Fr.FLOATING)return null;t.x=this.makePrecise(t.x),t.y=this.makePrecise(t.y)}},Fr.prototype.getMaximumSignificantDigits=function(){var A=16;return this.bn===Fr.FLOATING?A=16:this.bn===Fr.FLOATING_SINGLE?A=6:this.bn===Fr.FIXED&&(A=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),A},Fr.prototype.setScale=function(A){this.xA=Math.abs(A)},Fr.prototype.interfaces_=function(){return[xn,bn]},Fr.prototype.getClass=function(){return Fr},Fr.mostPrecise=function(A,t){return A.compareTo(t)>=0?A:t},Ur.serialVersionUID.get=function(){return 0x6bee6404e9a25c00},Ur.maximumPreciseValue.get=function(){return 9007199254740992},Object.defineProperties(Fr,Ur);var Er=function A(t){this.zn=t||null,A.nameToTypeMap.put(t,this)},Nr={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Er.prototype.readResolve=function(){return Er.nameToTypeMap.get(this.zn)},Er.prototype.toString=function(){return this.zn},Er.prototype.interfaces_=function(){return[xn]},Er.prototype.getClass=function(){return Er},Nr.serialVersionUID.get=function(){return-552860263173159e4},Nr.nameToTypeMap.get=function(){return new Or},Object.defineProperties(Er,Nr),Fr.Type=Er,Fr.FIXED=new Er("FIXED"),Fr.FLOATING=new Er("FLOATING"),Fr.FLOATING_SINGLE=new Er("FLOATING SINGLE");var jr=function A(){this.sn=new Fr,this.ln=0,this.dn=A.getDefaultCoordinateSequenceFactory(),0===arguments.length||(1===arguments.length?Fn(arguments[0],Ln)?this.dn=arguments[0]:arguments[0]instanceof Fr&&(this.sn=arguments[0]):2===arguments.length?(this.sn=arguments[0],this.ln=arguments[1]):3===arguments.length&&(this.sn=arguments[0],this.ln=arguments[1],this.dn=arguments[2]))},Qr={serialVersionUID:{configurable:!0}};jr.prototype.toGeometry=function(A){return A.isNull()?this.createPoint(null):A.getMinX()===A.getMaxX()&&A.getMinY()===A.getMaxY()?this.createPoint(new mn(A.getMinX(),A.getMinY())):A.getMinX()===A.getMaxX()||A.getMinY()===A.getMaxY()?this.createLineString([new mn(A.getMinX(),A.getMinY()),new mn(A.getMaxX(),A.getMaxY())]):this.createPolygon(this.createLinearRing([new mn(A.getMinX(),A.getMinY()),new mn(A.getMinX(),A.getMaxY()),new mn(A.getMaxX(),A.getMaxY()),new mn(A.getMaxX(),A.getMinY()),new mn(A.getMinX(),A.getMinY())]),null)},jr.prototype.createLineString=function(A){return A?A instanceof Array?new lr(this.getCoordinateSequenceFactory().create(A),this):Fn(A,Gn)?new lr(A,this):void 0:new lr(this.getCoordinateSequenceFactory().create([]),this)},jr.prototype.createMultiLineString=function(){if(0===arguments.length)return new nr(null,this);if(1===arguments.length){var A=arguments[0];return new nr(A,this)}},jr.prototype.buildGeometry=function(A){for(var t=null,n=!1,i=!1,r=A.iterator();r.hasNext();){var e=r.next(),s=e.getClass();null===t&&(t=s),s!==t&&(n=!0),e.isGeometryCollectionOrDerived()&&(i=!0)}if(null===t)return this.createGeometryCollection();if(n||i)return this.createGeometryCollection(jr.toGeometryArray(A));var u=A.iterator().next();if(A.size()>1){if(u instanceof Cr)return this.createMultiPolygon(jr.toPolygonArray(A));if(u instanceof lr)return this.createMultiLineString(jr.toLineStringArray(A));if(u instanceof Pr)return this.createMultiPoint(jr.toPointArray(A));ii.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u},jr.prototype.createMultiPointFromCoords=function(A){return this.createMultiPoint(null!==A?this.getCoordinateSequenceFactory().create(A):null)},jr.prototype.createPoint=function(){if(0===arguments.length)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof mn){var A=arguments[0];return this.createPoint(null!==A?this.getCoordinateSequenceFactory().create([A]):null)}if(Fn(arguments[0],Gn)){var t=arguments[0];return new Pr(t,this)}}},jr.prototype.getCoordinateSequenceFactory=function(){return this.dn},jr.prototype.createPolygon=function(){if(0===arguments.length)return new Cr(null,null,this);if(1===arguments.length){if(Fn(arguments[0],Gn)){var A=arguments[0];return this.createPolygon(this.createLinearRing(A))}if(arguments[0]instanceof Array){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}if(arguments[0]instanceof Ir){var n=arguments[0];return this.createPolygon(n,null)}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];return new Cr(i,r,this)}},jr.prototype.getSRID=function(){return this.ln},jr.prototype.createGeometryCollection=function(){if(0===arguments.length)return new tr(null,this);if(1===arguments.length){var A=arguments[0];return new tr(A,this)}},jr.prototype.createGeometry=function(A){return new br(this).edit(A,{edit:function(){if(2===arguments.length){var A=arguments[0];return this.dn.create(A)}}})},jr.prototype.getPrecisionModel=function(){return this.sn},jr.prototype.createLinearRing=function(){if(0===arguments.length)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(1===arguments.length){if(arguments[0]instanceof Array){var A=arguments[0];return this.createLinearRing(null!==A?this.getCoordinateSequenceFactory().create(A):null)}if(Fn(arguments[0],Gn)){var t=arguments[0];return new Ir(t,this)}}},jr.prototype.createMultiPolygon=function(){if(0===arguments.length)return new Mr(null,this);if(1===arguments.length){var A=arguments[0];return new Mr(A,this)}},jr.prototype.createMultiPoint=function(){var A=this;if(0===arguments.length)return new Dr(null,this);if(1===arguments.length){if(arguments[0]instanceof Array){var t=arguments[0];return new Dr(t,this)}if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(null!==n?this.getCoordinateSequenceFactory().create(n):null)}if(Fn(arguments[0],Gn)){var i=arguments[0];if(null===i)return this.createMultiPoint(new Array(0).fill(null));for(var r=new Array(i.size()).fill(null),e=0;e<i.size();e++){var s=A.getCoordinateSequenceFactory().create(1,i.getDimension());vr.copy(i,e,s,0,1),r[e]=A.createPoint(s)}return this.createMultiPoint(r)}}},jr.prototype.interfaces_=function(){return[xn]},jr.prototype.getClass=function(){return jr},jr.toMultiPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toGeometryArray=function(A){if(null===A)return null;var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.getDefaultCoordinateSequenceFactory=function(){return Lr.instance()},jr.toMultiLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toLineStringArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toMultiPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toLinearRingArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toPointArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.toPolygonArray=function(A){var t=new Array(A.size()).fill(null);return A.toArray(t)},jr.createPointFromInternalCoord=function(A,t){return t.getPrecisionModel().makePrecise(A),t.getFactory().createPoint(A)},Qr.serialVersionUID.get=function(){return-0x5ea75f2051eeb400},Object.defineProperties(jr,Qr);var Sr=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],kr=function(A){this.geometryFactory=A||new jr};kr.prototype.read=function(A){var t,n=(t="string"==typeof A?JSON.parse(A):A).type;if(!Br[n])throw new Error("Unknown GeoJSON type: "+t.type);return-1!==Sr.indexOf(n)?Br[n].apply(this,[t.coordinates]):Br[n].apply(this,"GeometryCollection"===n?[t.geometries]:[t])},kr.prototype.write=function(A){var t=A.getGeometryType();if(!Rr[t])throw new Error("Geometry is not supported");return Rr[t].apply(this,[A])};var Br={Feature:function(A){var t={};for(var n in A)t[n]=A[n];if(A.geometry){if(!Br[A.geometry.type])throw new Error("Unknown GeoJSON type: "+A.type);t.geometry=this.read(A.geometry)}return A.bbox&&(t.bbox=Br.bbox.apply(this,[A.bbox])),t},FeatureCollection:function(A){var t={};if(A.features){t.features=[];for(var n=0;n<A.features.length;++n)t.features.push(this.read(A.features[n]))}return A.bbox&&(t.bbox=this.parse.bbox.apply(this,[A.bbox])),t},coordinates:function(A){for(var t=[],n=0;n<A.length;++n){var i=A[n];t.push(new mn(i[0],i[1]))}return t},bbox:function(A){return this.geometryFactory.createLinearRing([new mn(A[0],A[1]),new mn(A[2],A[1]),new mn(A[2],A[3]),new mn(A[0],A[3]),new mn(A[0],A[1])])},Point:function(A){var t=new mn(A[0],A[1]);return this.geometryFactory.createPoint(t)},MultiPoint:function(A){for(var t=[],n=0;n<A.length;++n)t.push(Br.Point.apply(this,[A[n]]));return this.geometryFactory.createMultiPoint(t)},LineString:function(A){var t=Br.coordinates.apply(this,[A]);return this.geometryFactory.createLineString(t)},MultiLineString:function(A){for(var t=[],n=0;n<A.length;++n)t.push(Br.LineString.apply(this,[A[n]]));return this.geometryFactory.createMultiLineString(t)},Polygon:function(A){for(var t=Br.coordinates.apply(this,[A[0]]),n=this.geometryFactory.createLinearRing(t),i=[],r=1;r<A.length;++r){var s=Br.coordinates.apply(this,[A[r]]),u=this.geometryFactory.createLinearRing(s);i.push(u)}return this.geometryFactory.createPolygon(n,i)},MultiPolygon:function(A){for(var t=[],n=0;n<A.length;++n){t.push(Br.Polygon.apply(this,[A[n]]))}return this.geometryFactory.createMultiPolygon(t)},GeometryCollection:function(A){for(var t=[],n=0;n<A.length;++n){t.push(this.read(A[n]))}return this.geometryFactory.createGeometryCollection(t)}},Rr={coordinate:function(A){return[A.x,A.y]},Point:function(A){return{type:"Point",coordinates:Rr.coordinate.apply(this,[A.getCoordinate()])}},MultiPoint:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Rr.Point.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiPoint",coordinates:t}},LineString:function(A){for(var t=[],n=A.getCoordinates(),i=0;i<n.length;++i){t.push(Rr.coordinate.apply(this,[n[i]]))}return{type:"LineString",coordinates:t}},MultiLineString:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Rr.LineString.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiLineString",coordinates:t}},Polygon:function(A){var t=[],n=Rr.LineString.apply(this,[A.Zt]);t.push(n.coordinates);for(var i=0;i<A.Xt.length;++i){var e=Rr.LineString.apply(this,[A.Xt[i]]);t.push(e.coordinates)}return{type:"Polygon",coordinates:t}},MultiPolygon:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var r=Rr.Polygon.apply(this,[A.Ht[n]]);t.push(r.coordinates)}return{type:"MultiPolygon",coordinates:t}},GeometryCollection:function(A){for(var t=[],n=0;n<A.Ht.length;++n){var i=A.Ht[n],r=i.getGeometryType();t.push(Rr[r].apply(this,[i]))}return{type:"GeometryCollection",geometries:t}}},Gr=function(A){this.geometryFactory=A||new jr,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new kr(this.geometryFactory)};Gr.prototype.read=function(A){var t=this.parser.read(A);return this.precisionModel.getType()===Fr.FIXED&&this.reducePrecision(t),t},Gr.prototype.reducePrecision=function(A){var t,n;if(A.coordinate)this.precisionModel.makePrecise(A.coordinate);else if(A.points)for(t=0,n=A.points.length;t<n;t++)this.precisionModel.makePrecise(A.points[t]);else if(A.geometries)for(t=0,n=A.geometries.length;t<n;t++)this.reducePrecision(A.geometries[t])};var Yr=function(){this.parser=new kr(this.geometryFactory)};Yr.prototype.write=function(A){return this.parser.write(A)};var qr=function(){},Vr={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};function Wr(A){this.message=A||""}function _r(){this.array_=[]}qr.prototype.interfaces_=function(){return[]},qr.prototype.getClass=function(){return qr},qr.opposite=function(A){return A===qr.LEFT?qr.RIGHT:A===qr.RIGHT?qr.LEFT:A},Vr.ON.get=function(){return 0},Vr.LEFT.get=function(){return 1},Vr.RIGHT.get=function(){return 2},Object.defineProperties(qr,Vr),(Wr.prototype=new Error).name="EmptyStackException",(_r.prototype=new xi).add=function(A){return this.array_.push(A),!0},_r.prototype.get=function(A){if(A<0||A>=this.size())throw new Error;return this.array_[A]},_r.prototype.push=function(A){return this.array_.push(A),A},_r.prototype.pop=function(A){if(0===this.array_.length)throw new Wr;return this.array_.pop()},_r.prototype.peek=function(){if(0===this.array_.length)throw new Wr;return this.array_[this.array_.length-1]},_r.prototype.empty=function(){return 0===this.array_.length},_r.prototype.isEmpty=function(){return this.empty()},_r.prototype.search=function(A){return this.array_.indexOf(A)},_r.prototype.size=function(){return this.array_.length},_r.prototype.toArray=function(){for(var A=[],t=0,n=this.array_.length;t<n;t++)A.push(this.array_[t]);return A};var Kr=function(){this.xn=-1,this.mn=null,this.yn=null,this.pn=null};Kr.prototype.getCoordinate=function(){return this.mn},Kr.prototype.getRightmostSide=function(A,t){var n=this.getRightmostSideOfSegment(A,t);return n<0&&(n=this.getRightmostSideOfSegment(A,t-1)),n<0&&(this.mn=null,this.checkForRightmostCoordinate(A)),n},Kr.prototype.findRightmostEdgeAtVertex=function(){var A=this.yn.getEdge().getCoordinates();ii.isTrue(this.xn>0&&this.xn<A.length,"rightmost point expected to be interior vertex of edge");var t=A[this.xn-1],n=A[this.xn+1],i=hi.computeOrientation(this.mn,n,t),r=!1;(t.y<this.mn.y&&n.y<this.mn.y&&i===hi.COUNTERCLOCKWISE||t.y>this.mn.y&&n.y>this.mn.y&&i===hi.CLOCKWISE)&&(r=!0),r&&(this.xn=this.xn-1)},Kr.prototype.getRightmostSideOfSegment=function(A,t){var n=A.getEdge().getCoordinates();if(t<0||t+1>=n.length)return-1;if(n[t].y===n[t+1].y)return-1;var i=qr.LEFT;return n[t].y<n[t+1].y&&(i=qr.RIGHT),i},Kr.prototype.getEdge=function(){return this.pn},Kr.prototype.checkForRightmostCoordinate=function(A){for(var t=A.getEdge().getCoordinates(),n=0;n<t.length-1;n++)(null===this.mn||t[n].x>this.mn.x)&&(this.yn=A,this.xn=n,this.mn=t[n])},Kr.prototype.findRightmostEdgeAtNode=function(){var A=this.yn.getNode().getEdges();this.yn=A.getRightmostEdge(),this.yn.isForward()||(this.yn=this.yn.getSym(),this.xn=this.yn.getEdge().getCoordinates().length-1)},Kr.prototype.findEdge=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();n.isForward()&&this.checkForRightmostCoordinate(n)}ii.isTrue(0!==this.xn||this.mn.equals(this.yn.getCoordinate()),"inconsistency in rightmost processing"),0===this.xn?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this.pn=this.yn,this.getRightmostSide(this.yn,this.xn)===qr.LEFT&&(this.pn=this.yn.getSym())},Kr.prototype.interfaces_=function(){return[]},Kr.prototype.getClass=function(){return Kr};var Hr=function(A){function t(n,i){A.call(this,t.msgWithCoord(n,i)),this.pt=i?new mn(i):null,this.name="TopologyException"}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getCoordinate=function(){return this.pt},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.msgWithCoord=function(A,t){return t?A:A+" [ "+t+" ]"},t}(ti),Jr=function(){this.array_=[]};Jr.prototype.addLast=function(A){this.array_.push(A)},Jr.prototype.removeFirst=function(){return this.array_.shift()},Jr.prototype.isEmpty=function(){return 0===this.array_.length};var Zr=function(){this.Ln=null,this.Tn=new yi,this.On=new yi,this.Fn=null,this.Un=null,this.Ln=new Kr};Zr.prototype.clearVisitedEdges=function(){for(var A=this.Tn.iterator();A.hasNext();)A.next().setVisited(!1)},Zr.prototype.getRightmostCoordinate=function(){return this.Fn},Zr.prototype.computeNodeDepth=function(A){for(var t=null,n=A.getEdges().iterator();n.hasNext();){var i=n.next();if(i.isVisited()||i.getSym().isVisited()){t=i;break}}if(null===t)throw new Hr("unable to find edge to compute depths at "+A.getCoordinate());A.getEdges().computeDepths(t);for(var r=A.getEdges().iterator();r.hasNext();){var e=r.next();e.setVisited(!0),this.copySymDepths(e)}},Zr.prototype.computeDepth=function(A){this.clearVisitedEdges();var t=this.Ln.getEdge();t.setEdgeDepths(qr.RIGHT,A),this.copySymDepths(t),this.computeDepths(t)},Zr.prototype.create=function(A){this.addReachable(A),this.Ln.findEdge(this.Tn),this.Fn=this.Ln.getCoordinate()},Zr.prototype.findResultEdges=function(){for(var A=this.Tn.iterator();A.hasNext();){var t=A.next();t.getDepth(qr.RIGHT)>=1&&t.getDepth(qr.LEFT)<=0&&!t.isInteriorAreaEdge()&&t.setInResult(!0)}},Zr.prototype.computeDepths=function(A){var t=new Si,n=new Jr,i=A.getNode();for(n.addLast(i),t.add(i),A.setVisited(!0);!n.isEmpty();){var r=n.removeFirst();t.add(r),this.computeNodeDepth(r);for(var e=r.getEdges().iterator();e.hasNext();){var s=e.next().getSym();if(!s.isVisited()){var u=s.getNode();t.contains(u)||(n.addLast(u),t.add(u))}}}},Zr.prototype.compareTo=function(A){return this.Fn.x<A.Fn.x?-1:this.Fn.x>A.Fn.x?1:0},Zr.prototype.getEnvelope=function(){if(null===this.Un){for(var A=new Kn,t=this.Tn.iterator();t.hasNext();)for(var n=t.next().getEdge().getCoordinates(),i=0;i<n.length-1;i++)A.expandToInclude(n[i]);this.Un=A}return this.Un},Zr.prototype.addReachable=function(A){var t=new _r;for(t.add(A);!t.empty();){var n=t.pop();this.add(n,t)}},Zr.prototype.copySymDepths=function(A){var t=A.getSym();t.setDepth(qr.LEFT,A.getDepth(qr.RIGHT)),t.setDepth(qr.RIGHT,A.getDepth(qr.LEFT))},Zr.prototype.add=function(A,t){A.setVisited(!0),this.On.add(A);for(var n=A.getEdges().iterator();n.hasNext();){var i=n.next();this.Tn.add(i);var r=i.getSym().getNode();r.isVisited()||t.push(r)}},Zr.prototype.getNodes=function(){return this.On},Zr.prototype.getDirectedEdges=function(){return this.Tn},Zr.prototype.interfaces_=function(){return[bn]},Zr.prototype.getClass=function(){return Zr};var Xr=function A(){var t=this;if(this.location=null,1===arguments.length){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var i=arguments[0];this.init(1),this.location[qr.ON]=i}else if(arguments[0]instanceof A){var r=arguments[0];if(this.init(r.location.length),null!==r)for(var e=0;e<this.location.length;e++)t.location[e]=r.location[e]}}else if(3===arguments.length){var s=arguments[0],u=arguments[1],o=arguments[2];this.init(3),this.location[qr.ON]=s,this.location[qr.LEFT]=u,this.location[qr.RIGHT]=o}};Xr.prototype.setAllLocations=function(A){for(var t=0;t<this.location.length;t++)this.location[t]=A},Xr.prototype.isNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]!==Tn.NONE)return!1;return!0},Xr.prototype.setAllLocationsIfNull=function(A){for(var t=0;t<this.location.length;t++)this.location[t]===Tn.NONE&&(this.location[t]=A)},Xr.prototype.isLine=function(){return 1===this.location.length},Xr.prototype.merge=function(A){if(A.location.length>this.location.length){var t=new Array(3).fill(null);t[qr.ON]=this.location[qr.ON],t[qr.LEFT]=Tn.NONE,t[qr.RIGHT]=Tn.NONE,this.location=t}for(var n=0;n<this.location.length;n++)this.location[n]===Tn.NONE&&n<A.location.length&&(this.location[n]=A.location[n])},Xr.prototype.getLocations=function(){return this.location},Xr.prototype.flip=function(){if(this.location.length<=1)return null;var A=this.location[qr.LEFT];this.location[qr.LEFT]=this.location[qr.RIGHT],this.location[qr.RIGHT]=A},Xr.prototype.toString=function(){var A=new Nn;return this.location.length>1&&A.append(Tn.toLocationSymbol(this.location[qr.LEFT])),A.append(Tn.toLocationSymbol(this.location[qr.ON])),this.location.length>1&&A.append(Tn.toLocationSymbol(this.location[qr.RIGHT])),A.toString()},Xr.prototype.setLocations=function(A,t,n){this.location[qr.ON]=A,this.location[qr.LEFT]=t,this.location[qr.RIGHT]=n},Xr.prototype.get=function(A){return A<this.location.length?this.location[A]:Tn.NONE},Xr.prototype.isArea=function(){return this.location.length>1},Xr.prototype.isAnyNull=function(){for(var A=0;A<this.location.length;A++)if(this.location[A]===Tn.NONE)return!0;return!1},Xr.prototype.setLocation=function(){if(1===arguments.length){var A=arguments[0];this.setLocation(qr.ON,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.location[t]=n}},Xr.prototype.init=function(A){this.location=new Array(A).fill(null),this.setAllLocations(Tn.NONE)},Xr.prototype.isEqualOnSide=function(A,t){return this.location[t]===A.location[t]},Xr.prototype.allPositionsEqual=function(A){for(var t=0;t<this.location.length;t++)if(this.location[t]!==A)return!1;return!0},Xr.prototype.interfaces_=function(){return[]},Xr.prototype.getClass=function(){return Xr};var $r=function A(){if(this.elt=new Array(2).fill(null),1===arguments.length){if(Number.isInteger(arguments[0])){var t=arguments[0];this.elt[0]=new Xr(t),this.elt[1]=new Xr(t)}else if(arguments[0]instanceof A){var n=arguments[0];this.elt[0]=new Xr(n.elt[0]),this.elt[1]=new Xr(n.elt[1])}}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.elt[0]=new Xr(Tn.NONE),this.elt[1]=new Xr(Tn.NONE),this.elt[i].setLocation(r)}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];this.elt[0]=new Xr(e,s,u),this.elt[1]=new Xr(e,s,u)}else if(4===arguments.length){var o=arguments[0],h=arguments[1],f=arguments[2],c=arguments[3];this.elt[0]=new Xr(Tn.NONE,Tn.NONE,Tn.NONE),this.elt[1]=new Xr(Tn.NONE,Tn.NONE,Tn.NONE),this.elt[o].setLocations(h,f,c)}};$r.prototype.getGeometryCount=function(){var A=0;return this.elt[0].isNull()||A++,this.elt[1].isNull()||A++,A},$r.prototype.setAllLocations=function(A,t){this.elt[A].setAllLocations(t)},$r.prototype.isNull=function(A){return this.elt[A].isNull()},$r.prototype.setAllLocationsIfNull=function(){if(1===arguments.length){var A=arguments[0];this.setAllLocationsIfNull(0,A),this.setAllLocationsIfNull(1,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.elt[t].setAllLocationsIfNull(n)}},$r.prototype.isLine=function(A){return this.elt[A].isLine()},$r.prototype.merge=function(A){for(var t=0;t<2;t++)null===this.elt[t]&&null!==A.elt[t]?this.elt[t]=new Xr(A.elt[t]):this.elt[t].merge(A.elt[t])},$r.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()},$r.prototype.getLocation=function(){if(1===arguments.length){var A=arguments[0];return this.elt[A].get(qr.ON)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.elt[t].get(n)}},$r.prototype.toString=function(){var A=new Nn;return null!==this.elt[0]&&(A.append("A:"),A.append(this.elt[0].toString())),null!==this.elt[1]&&(A.append(" B:"),A.append(this.elt[1].toString())),A.toString()},$r.prototype.isArea=function(){if(0===arguments.length)return this.elt[0].isArea()||this.elt[1].isArea();if(1===arguments.length){var A=arguments[0];return this.elt[A].isArea()}},$r.prototype.isAnyNull=function(A){return this.elt[A].isAnyNull()},$r.prototype.setLocation=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.elt[A].setLocation(qr.ON,t)}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.elt[n].setLocation(i,r)}},$r.prototype.isEqualOnSide=function(A,t){return this.elt[0].isEqualOnSide(A.elt[0],t)&&this.elt[1].isEqualOnSide(A.elt[1],t)},$r.prototype.allPositionsEqual=function(A,t){return this.elt[A].allPositionsEqual(t)},$r.prototype.toLine=function(A){this.elt[A].isArea()&&(this.elt[A]=new Xr(this.elt[A].location[0]))},$r.prototype.interfaces_=function(){return[]},$r.prototype.getClass=function(){return $r},$r.toLineLabel=function(A){for(var t=new $r(Tn.NONE),n=0;n<2;n++)t.setLocation(n,A.getLocation(n));return t};var Ae=function(){this.En=null,this.Nn=-1,this.jn=new yi,this.Qn=new yi,this.Sn=new $r(Tn.NONE),this.kn=null,this.Bn=null,this.Zt=null,this.Xt=new yi,this.Rn=null;var A=arguments[0],t=arguments[1];this.Rn=t,this.computePoints(A),this.computeRing()};Ae.prototype.computeRing=function(){if(null!==this.kn)return null;for(var A=new Array(this.Qn.size()).fill(null),t=0;t<this.Qn.size();t++)A[t]=this.Qn.get(t);this.kn=this.Rn.createLinearRing(A),this.Bn=hi.isCCW(this.kn.getCoordinates())},Ae.prototype.isIsolated=function(){return 1===this.Sn.getGeometryCount()},Ae.prototype.computePoints=function(A){this.En=A;var t=A,n=!0;do{if(null===t)throw new Hr("Found null DirectedEdge");if(t.getEdgeRing()===this)throw new Hr("Directed Edge visited twice during ring-building at "+t.getCoordinate());this.jn.add(t);var i=t.getLabel();ii.isTrue(i.isArea()),this.mergeLabel(i),this.addPoints(t.getEdge(),t.isForward(),n),n=!1,this.setEdgeRing(t,this),t=this.getNext(t)}while(t!==this.En)},Ae.prototype.getLinearRing=function(){return this.kn},Ae.prototype.getCoordinate=function(A){return this.Qn.get(A)},Ae.prototype.computeMaxNodeDegree=function(){this.Nn=0;var A=this.En;do{var t=A.getNode().getEdges().getOutgoingDegree(this);t>this.Nn&&(this.Nn=t),A=this.getNext(A)}while(A!==this.En);this.Nn*=2},Ae.prototype.addPoints=function(A,t,n){var i=A.getCoordinates();if(t){var r=1;n&&(r=0);for(var e=r;e<i.length;e++)this.Qn.add(i[e])}else{var s=i.length-2;n&&(s=i.length-1);for(var u=s;u>=0;u--)this.Qn.add(i[u])}},Ae.prototype.isHole=function(){return this.Bn},Ae.prototype.setInResult=function(){var A=this.En;do{A.getEdge().setInResult(!0),A=A.getNext()}while(A!==this.En)},Ae.prototype.containsPoint=function(A){var t=this.getLinearRing();if(!t.getEnvelopeInternal().contains(A))return!1;if(!hi.isPointInRing(A,t.getCoordinates()))return!1;for(var n=this.Xt.iterator();n.hasNext();)if(n.next().containsPoint(A))return!1;return!0},Ae.prototype.addHole=function(A){this.Xt.add(A)},Ae.prototype.isShell=function(){return null===this.Zt},Ae.prototype.getLabel=function(){return this.Sn},Ae.prototype.getEdges=function(){return this.jn},Ae.prototype.getMaxNodeDegree=function(){return this.Nn<0&&this.computeMaxNodeDegree(),this.Nn},Ae.prototype.getShell=function(){return this.Zt},Ae.prototype.mergeLabel=function(){if(1===arguments.length){var A=arguments[0];this.mergeLabel(A,0),this.mergeLabel(A,1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=t.getLocation(n,qr.RIGHT);if(i===Tn.NONE)return null;if(this.Sn.getLocation(n)===Tn.NONE)return this.Sn.setLocation(n,i),null}},Ae.prototype.setShell=function(A){this.Zt=A,null!==A&&A.addHole(this)},Ae.prototype.toPolygon=function(A){for(var t=new Array(this.Xt.size()).fill(null),n=0;n<this.Xt.size();n++)t[n]=this.Xt.get(n).getLinearRing();return A.createPolygon(this.getLinearRing(),t)},Ae.prototype.interfaces_=function(){return[]},Ae.prototype.getClass=function(){return Ae};var te=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.setEdgeRing=function(A,t){A.setMinEdgeRing(t)},t.prototype.getNext=function(A){return A.getNextMin()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ae),ne=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildMinimalRings=function(){var A=new yi,t=this.En;do{if(null===t.getMinEdgeRing()){var n=new te(t,this.Rn);A.add(n)}t=t.getNext()}while(t!==this.En);return A},t.prototype.setEdgeRing=function(A,t){A.setEdgeRing(t)},t.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var A=this.En;do{A.getNode().getEdges().linkMinimalDirectedEdges(this),A=A.getNext()}while(A!==this.En)},t.prototype.getNext=function(A){return A.getNext()},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ae),ie=function(){if(this.Sn=null,this.Gn=!1,this.Yn=!1,this.qn=!1,this.Vn=!1,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.Sn=A}};ie.prototype.setVisited=function(A){this.Vn=A},ie.prototype.setInResult=function(A){this.Gn=A},ie.prototype.isCovered=function(){return this.Yn},ie.prototype.isCoveredSet=function(){return this.qn},ie.prototype.setLabel=function(A){this.Sn=A},ie.prototype.getLabel=function(){return this.Sn},ie.prototype.setCovered=function(A){this.Yn=A,this.qn=!0},ie.prototype.updateIM=function(A){ii.isTrue(this.Sn.getGeometryCount()>=2,"found partial label"),this.computeIM(A)},ie.prototype.isInResult=function(){return this.Gn},ie.prototype.isVisited=function(){return this.Vn},ie.prototype.interfaces_=function(){return[]},ie.prototype.getClass=function(){return ie};var re=function(A){function t(){A.call(this),this.Wn=null,this.jn=null;var t=arguments[0],n=arguments[1];this.Wn=t,this.jn=n,this.Sn=new $r(0,Tn.NONE)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isIncidentEdgeInResult=function(){for(var A=this.getEdges().getEdges().iterator();A.hasNext();)if(A.next().getEdge().isInResult())return!0;return!1},t.prototype.isIsolated=function(){return 1===this.Sn.getGeometryCount()},t.prototype.getCoordinate=function(){return this.Wn},t.prototype.print=function(A){A.println("node "+this.Wn+" lbl: "+this.Sn)},t.prototype.computeIM=function(A){},t.prototype.computeMergedLocation=function(A,t){var n=Tn.NONE;if(n=this.Sn.getLocation(t),!A.isNull(t)){var i=A.getLocation(t);n!==Tn.BOUNDARY&&(n=i)}return n},t.prototype.setLabel=function(){if(2!==arguments.length)return A.prototype.setLabel.apply(this,arguments);var t=arguments[0],n=arguments[1];null===this.Sn?this.Sn=new $r(t,n):this.Sn.setLocation(t,n)},t.prototype.getEdges=function(){return this.jn},t.prototype.mergeLabel=function(){var A=this;if(arguments[0]instanceof t){var n=arguments[0];this.mergeLabel(n.Sn)}else if(arguments[0]instanceof $r)for(var i=arguments[0],r=0;r<2;r++){var e=A.computeMergedLocation(i,r),s=A.Sn.getLocation(r);s===Tn.NONE&&A.Sn.setLocation(r,e)}},t.prototype.add=function(A){this.jn.insert(A),A.setNode(this)},t.prototype.setLabelBoundary=function(A){if(null===this.Sn)return null;var t=Tn.NONE;null!==this.Sn&&(t=this.Sn.getLocation(A));var n=null;if(t===Tn.BOUNDARY)n=Tn.INTERIOR;else n=Tn.BOUNDARY;this.Sn.setLocation(A,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(ie),ee=function(){this.nodeMap=new Vi,this.nodeFact=null;var A=arguments[0];this.nodeFact=A};ee.prototype.find=function(A){return this.nodeMap.get(A)},ee.prototype.addNode=function(){if(arguments[0]instanceof mn){var A=arguments[0],t=this.nodeMap.get(A);return null===t&&(t=this.nodeFact.createNode(A),this.nodeMap.put(A,t)),t}if(arguments[0]instanceof re){var n=arguments[0],i=this.nodeMap.get(n.getCoordinate());return null===i?(this.nodeMap.put(n.getCoordinate(),n),n):(i.mergeLabel(n),i)}},ee.prototype.print=function(A){for(var t=this.iterator();t.hasNext();)t.next().print(A)},ee.prototype.iterator=function(){return this.nodeMap.values().iterator()},ee.prototype.values=function(){return this.nodeMap.values()},ee.prototype.getBoundaryNodes=function(A){for(var t=new yi,n=this.iterator();n.hasNext();){var i=n.next();i.getLabel().getLocation(A)===Tn.BOUNDARY&&t.add(i)}return t},ee.prototype.add=function(A){var t=A.getCoordinate();this.addNode(t).add(A)},ee.prototype.interfaces_=function(){return[]},ee.prototype.getClass=function(){return ee};var se=function(){},ue={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};se.prototype.interfaces_=function(){return[]},se.prototype.getClass=function(){return se},se.isNorthern=function(A){return A===se.NE||A===se.NW},se.isOpposite=function(A,t){return A!==t&&2==(A-t+4)%4},se.commonHalfPlane=function(A,t){if(A===t)return A;if(2==(A-t+4)%4)return-1;var n=A<t?A:t;return 0===n&&3===(A>t?A:t)?3:n},se.isInHalfPlane=function(A,t){return t===se.SE?A===se.SE||A===se.SW:A===t||A===t+1},se.quadrant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new Dn("Cannot compute the quadrant for point ( "+A+", "+t+" )");return A>=0?t>=0?se.NE:se.SE:t>=0?se.NW:se.SW}if(arguments[0]instanceof mn&&arguments[1]instanceof mn){var n=arguments[0],i=arguments[1];if(i.x===n.x&&i.y===n.y)throw new Dn("Cannot compute the quadrant for two identical points "+n);return i.x>=n.x?i.y>=n.y?se.NE:se.SE:i.y>=n.y?se.NW:se.SW}},ue.NE.get=function(){return 0},ue.NW.get=function(){return 1},ue.SW.get=function(){return 2},ue.SE.get=function(){return 3},Object.defineProperties(se,ue);var oe=function(){if(this._n=null,this.Sn=null,this.Kn=null,this.Hn=null,this.Jn=null,this.Zn=null,this.Xn=null,this.$n=null,1===arguments.length){var A=arguments[0];this._n=A}else if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=null;this._n=t,this.init(n,i),this.Sn=r}else if(4===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=arguments[3];this._n=e,this.init(s,u),this.Sn=o}};oe.prototype.compareDirection=function(A){return this.Zn===A.Zn&&this.Xn===A.Xn?0:this.$n>A.$n?1:this.$n<A.$n?-1:hi.computeOrientation(A.Hn,A.Jn,this.Jn)},oe.prototype.getDy=function(){return this.Xn},oe.prototype.getCoordinate=function(){return this.Hn},oe.prototype.setNode=function(A){this.Kn=A},oe.prototype.print=function(A){var t=Math.atan2(this.Xn,this.Zn),n=this.getClass().getName(),i=n.lastIndexOf("."),r=n.substring(i+1);A.print("  "+r+": "+this.Hn+" - "+this.Jn+" "+this.$n+":"+t+"   "+this.Sn)},oe.prototype.compareTo=function(A){return this.compareDirection(A)},oe.prototype.getDirectedCoordinate=function(){return this.Jn},oe.prototype.getDx=function(){return this.Zn},oe.prototype.getLabel=function(){return this.Sn},oe.prototype.getEdge=function(){return this._n},oe.prototype.getQuadrant=function(){return this.$n},oe.prototype.getNode=function(){return this.Kn},oe.prototype.toString=function(){var A=Math.atan2(this.Xn,this.Zn),t=this.getClass().getName(),n=t.lastIndexOf(".");return"  "+t.substring(n+1)+": "+this.Hn+" - "+this.Jn+" "+this.$n+":"+A+"   "+this.Sn},oe.prototype.computeLabel=function(A){},oe.prototype.init=function(A,t){this.Hn=A,this.Jn=t,this.Zn=t.x-A.x,this.Xn=t.y-A.y,this.$n=se.quadrant(this.Zn,this.Xn),ii.isTrue(!(0===this.Zn&&0===this.Xn),"EdgeEnd with identical endpoints found")},oe.prototype.interfaces_=function(){return[bn]},oe.prototype.getClass=function(){return oe};var he=function(A){function t(){var t=arguments[0],n=arguments[1];if(A.call(this,t),this.Ai=null,this.Gn=!1,this.Vn=!1,this.ti=null,this.ni=null,this.ii=null,this.ri=null,this.ei=null,this.si=[0,-999,-999],this.Ai=n,n)this.init(t.getCoordinate(0),t.getCoordinate(1));else{var i=t.getNumPoints()-1;this.init(t.getCoordinate(i),t.getCoordinate(i-1))}this.computeDirectedLabel()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getNextMin=function(){return this.ii},t.prototype.getDepth=function(A){return this.si[A]},t.prototype.setVisited=function(A){this.Vn=A},t.prototype.computeDirectedLabel=function(){this.Sn=new $r(this._n.getLabel()),this.Ai||this.Sn.flip()},t.prototype.getNext=function(){return this.ni},t.prototype.setDepth=function(A,t){if(-999!==this.si[A]&&this.si[A]!==t)throw new Hr("assigned depths do not match",this.getCoordinate());this.si[A]=t},t.prototype.isInteriorAreaEdge=function(){for(var A=!0,t=0;t<2;t++)this.Sn.isArea(t)&&this.Sn.getLocation(t,qr.LEFT)===Tn.INTERIOR&&this.Sn.getLocation(t,qr.RIGHT)===Tn.INTERIOR||(A=!1);return A},t.prototype.setNextMin=function(A){this.ii=A},t.prototype.print=function(t){A.prototype.print.call(this,t),t.print(" "+this.si[qr.LEFT]+"/"+this.si[qr.RIGHT]),t.print(" ("+this.getDepthDelta()+")"),this.Gn&&t.print(" inResult")},t.prototype.setMinEdgeRing=function(A){this.ei=A},t.prototype.isLineEdge=function(){var A=this.Sn.isLine(0)||this.Sn.isLine(1),t=!this.Sn.isArea(0)||this.Sn.allPositionsEqual(0,Tn.EXTERIOR),n=!this.Sn.isArea(1)||this.Sn.allPositionsEqual(1,Tn.EXTERIOR);return A&&t&&n},t.prototype.setEdgeRing=function(A){this.ri=A},t.prototype.getMinEdgeRing=function(){return this.ei},t.prototype.getDepthDelta=function(){var A=this._n.getDepthDelta();return this.Ai||(A=-A),A},t.prototype.setInResult=function(A){this.Gn=A},t.prototype.getSym=function(){return this.ti},t.prototype.isForward=function(){return this.Ai},t.prototype.getEdge=function(){return this._n},t.prototype.printEdge=function(A){this.print(A),A.print(" "),this.Ai?this._n.print(A):this._n.printReverse(A)},t.prototype.setSym=function(A){this.ti=A},t.prototype.setVisitedEdge=function(A){this.setVisited(A),this.ti.setVisited(A)},t.prototype.setEdgeDepths=function(A,t){var n=this.getEdge().getDepthDelta();this.Ai||(n=-n);var i=1;A===qr.LEFT&&(i=-1);var r=qr.opposite(A),e=t+n*i;this.setDepth(A,t),this.setDepth(r,e)},t.prototype.getEdgeRing=function(){return this.ri},t.prototype.isInResult=function(){return this.Gn},t.prototype.setNext=function(A){this.ni=A},t.prototype.isVisited=function(){return this.Vn},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.depthFactor=function(A,t){return A===Tn.EXTERIOR&&t===Tn.INTERIOR?1:A===Tn.INTERIOR&&t===Tn.EXTERIOR?-1:0},t}(oe),fe=function(){};fe.prototype.createNode=function(A){return new re(A,null)},fe.prototype.interfaces_=function(){return[]},fe.prototype.getClass=function(){return fe};var ce=function(){if(this.jn=new yi,this.On=null,this.ui=new yi,0===arguments.length)this.On=new ee(new fe);else if(1===arguments.length){var A=arguments[0];this.On=new ee(A)}};ce.prototype.printEdges=function(A){A.println("Edges:");for(var t=0;t<this.jn.size();t++){A.println("edge "+t+":");var n=this.jn.get(t);n.print(A),n.eiList.print(A)}},ce.prototype.find=function(A){return this.On.find(A)},ce.prototype.addNode=function(){if(arguments[0]instanceof re){var A=arguments[0];return this.On.addNode(A)}if(arguments[0]instanceof mn){var t=arguments[0];return this.On.addNode(t)}},ce.prototype.getNodeIterator=function(){return this.On.iterator()},ce.prototype.linkResultDirectedEdges=function(){for(var A=this.On.iterator();A.hasNext();)A.next().getEdges().linkResultDirectedEdges()},ce.prototype.debugPrintln=function(A){Wn.out.println(A)},ce.prototype.isBoundaryNode=function(A,t){var n=this.On.find(t);if(null===n)return!1;var i=n.getLabel();return null!==i&&i.getLocation(A)===Tn.BOUNDARY},ce.prototype.linkAllDirectedEdges=function(){for(var A=this.On.iterator();A.hasNext();)A.next().getEdges().linkAllDirectedEdges()},ce.prototype.matchInSameDirection=function(A,t,n,i){return!!A.equals(n)&&hi.computeOrientation(A,t,i)===hi.COLLINEAR&&se.quadrant(A,t)===se.quadrant(n,i)},ce.prototype.getEdgeEnds=function(){return this.ui},ce.prototype.debugPrint=function(A){Wn.out.print(A)},ce.prototype.getEdgeIterator=function(){return this.jn.iterator()},ce.prototype.findEdgeInSameDirection=function(A,t){for(var n=0;n<this.jn.size();n++){var i=this.jn.get(n),r=i.getCoordinates();if(this.matchInSameDirection(A,t,r[0],r[1]))return i;if(this.matchInSameDirection(A,t,r[r.length-1],r[r.length-2]))return i}return null},ce.prototype.insertEdge=function(A){this.jn.add(A)},ce.prototype.findEdgeEnd=function(A){for(var t=this.getEdgeEnds().iterator();t.hasNext();){var n=t.next();if(n.getEdge()===A)return n}return null},ce.prototype.addEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.jn.add(n);var i=new he(n,!0),r=new he(n,!1);i.setSym(r),r.setSym(i),this.add(i),this.add(r)}},ce.prototype.add=function(A){this.On.add(A),this.ui.add(A)},ce.prototype.getNodes=function(){return this.On.values()},ce.prototype.findEdge=function(A,t){for(var n=0;n<this.jn.size();n++){var i=this.jn.get(n),r=i.getCoordinates();if(A.equals(r[0])&&t.equals(r[1]))return i}return null},ce.prototype.interfaces_=function(){return[]},ce.prototype.getClass=function(){return ce},ce.linkResultDirectedEdges=function(A){for(var t=A.iterator();t.hasNext();)t.next().getEdges().linkResultDirectedEdges()};var ae=function(){this.Rn=null,this.oi=new yi;var A=arguments[0];this.Rn=A};ae.prototype.sortShellsAndHoles=function(A,t,n){for(var i=A.iterator();i.hasNext();){var r=i.next();r.isHole()?n.add(r):t.add(r)}},ae.prototype.computePolygons=function(A){for(var t=new yi,n=A.iterator();n.hasNext();){var i=n.next().toPolygon(this.Rn);t.add(i)}return t},ae.prototype.placeFreeHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(null===i.getShell()){var r=this.findEdgeRingContaining(i,A);if(null===r)throw new Hr("unable to assign hole to a shell",i.getCoordinate(0));i.setShell(r)}}},ae.prototype.buildMinimalEdgeRings=function(A,t,n){for(var i=new yi,r=A.iterator();r.hasNext();){var e=r.next();if(e.getMaxNodeDegree()>2){e.linkDirectedEdgesForMinimalEdgeRings();var s=e.buildMinimalRings(),u=this.findShell(s);null!==u?(this.placePolygonHoles(u,s),t.add(u)):n.addAll(s)}else i.add(e)}return i},ae.prototype.containsPoint=function(A){for(var t=this.oi.iterator();t.hasNext();)if(t.next().containsPoint(A))return!0;return!1},ae.prototype.buildMaximalEdgeRings=function(A){for(var t=new yi,n=A.iterator();n.hasNext();){var i=n.next();if(i.isInResult()&&i.getLabel().isArea()&&null===i.getEdgeRing()){var r=new ne(i,this.Rn);t.add(r),r.setInResult()}}return t},ae.prototype.placePolygonHoles=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();i.isHole()&&i.setShell(A)}},ae.prototype.getPolygons=function(){return this.computePolygons(this.oi)},ae.prototype.findEdgeRingContaining=function(A,t){for(var n=A.getLinearRing(),i=n.getEnvelopeInternal(),r=n.getCoordinateN(0),e=null,s=null,u=t.iterator();u.hasNext();){var o=u.next(),h=o.getLinearRing(),f=h.getEnvelopeInternal();null!==e&&(s=e.getLinearRing().getEnvelopeInternal());var c=!1;f.contains(i)&&hi.isPointInRing(r,h.getCoordinates())&&(c=!0),c&&(null===e||s.contains(f))&&(e=o)}return e},ae.prototype.findShell=function(A){for(var t=0,n=null,i=A.iterator();i.hasNext();){var r=i.next();r.isHole()||(n=r,t++)}return ii.isTrue(t<=1,"found two shells in MinimalEdgeRing list"),n},ae.prototype.add=function(){if(1===arguments.length){var A=arguments[0];this.add(A.getEdgeEnds(),A.getNodes())}else if(2===arguments.length){var t=arguments[0],n=arguments[1];ce.linkResultDirectedEdges(n);var i=this.buildMaximalEdgeRings(t),r=new yi,e=this.buildMinimalEdgeRings(i,this.oi,r);this.sortShellsAndHoles(e,this.oi,r),this.placeFreeHoles(this.oi,r)}},ae.prototype.interfaces_=function(){return[]},ae.prototype.getClass=function(){return ae};var ve=function(){};ve.prototype.getBounds=function(){},ve.prototype.interfaces_=function(){return[]},ve.prototype.getClass=function(){return ve};var le=function(){this.hi=null,this.fi=null;var A=arguments[0],t=arguments[1];this.hi=A,this.fi=t};le.prototype.getItem=function(){return this.fi},le.prototype.getBounds=function(){return this.hi},le.prototype.interfaces_=function(){return[ve,xn]},le.prototype.getClass=function(){return le};var we=function(){this.ci=null,this.ai=null,this.ci=0,this.ai=new yi,this.ai.add(null)};we.prototype.poll=function(){if(this.isEmpty())return null;var A=this.ai.get(1);return this.ai.set(1,this.ai.get(this.ci)),this.ci-=1,this.reorder(1),A},we.prototype.size=function(){return this.ci},we.prototype.reorder=function(A){for(var t=null,n=this.ai.get(A);2*A<=this.ci&&((t=2*A)!==this.ci&&this.ai.get(t+1).compareTo(this.ai.get(t))<0&&t++,this.ai.get(t).compareTo(n)<0);A=t)this.ai.set(A,this.ai.get(t));this.ai.set(A,n)},we.prototype.clear=function(){this.ci=0,this.ai.clear()},we.prototype.isEmpty=function(){return 0===this.ci},we.prototype.add=function(A){this.ai.add(null),this.ci+=1;var t=this.ci;for(this.ai.set(0,A);A.compareTo(this.ai.get(Math.trunc(t/2)))<0;t/=2)this.ai.set(t,this.ai.get(Math.trunc(t/2)));this.ai.set(t,A)},we.prototype.interfaces_=function(){return[]},we.prototype.getClass=function(){return we};var Pe=function(){};Pe.prototype.visitItem=function(A){},Pe.prototype.interfaces_=function(){return[]},Pe.prototype.getClass=function(){return Pe};var ge=function(){};ge.prototype.insert=function(A,t){},ge.prototype.remove=function(A,t){},ge.prototype.query=function(){},ge.prototype.interfaces_=function(){return[]},ge.prototype.getClass=function(){return ge};var Ce=function(){if(this.vi=new yi,this.hi=null,this.li=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.li=A}},De={serialVersionUID:{configurable:!0}};Ce.prototype.getLevel=function(){return this.li},Ce.prototype.size=function(){return this.vi.size()},Ce.prototype.getChildBoundables=function(){return this.vi},Ce.prototype.addChildBoundable=function(A){ii.isTrue(null===this.hi),this.vi.add(A)},Ce.prototype.isEmpty=function(){return this.vi.isEmpty()},Ce.prototype.getBounds=function(){return null===this.hi&&(this.hi=this.computeBounds()),this.hi},Ce.prototype.interfaces_=function(){return[ve,xn]},Ce.prototype.getClass=function(){return Ce},De.serialVersionUID.get=function(){return 0x5a1e55ec41369800},Object.defineProperties(Ce,De);var Ie=function(){};Ie.reverseOrder=function(){return{compare:function(A,t){return t.compareTo(A)}}},Ie.min=function(A){return Ie.sort(A),A.get(0)},Ie.sort=function(A,t){var n=A.toArray();t?Ji.sort(n,t):Ji.sort(n);for(var i=A.iterator(),r=0,e=n.length;r<e;r++)i.next(),i.set(n[r])},Ie.singletonList=function(A){var t=new yi;return t.add(A),t};var Me=function(){this.wi=null,this.Pi=null,this.gi=null,this.Ci=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.wi=A,this.Pi=t,this.Ci=n,this.gi=this.distance()};Me.prototype.expandToQueue=function(A,t){var n=Me.isComposite(this.wi),i=Me.isComposite(this.Pi);if(n&&i)return Me.area(this.wi)>Me.area(this.Pi)?(this.expand(this.wi,this.Pi,A,t),null):(this.expand(this.Pi,this.wi,A,t),null);if(n)return this.expand(this.wi,this.Pi,A,t),null;if(i)return this.expand(this.Pi,this.wi,A,t),null;throw new Dn("neither boundable is composite")},Me.prototype.isLeaves=function(){return!(Me.isComposite(this.wi)||Me.isComposite(this.Pi))},Me.prototype.compareTo=function(A){return this.gi<A.gi?-1:this.gi>A.gi?1:0},Me.prototype.expand=function(A,t,n,i){for(var r=A.getChildBoundables().iterator();r.hasNext();){var e=r.next(),s=new Me(e,t,this.Ci);s.getDistance()<i&&n.add(s)}},Me.prototype.getBoundable=function(A){return 0===A?this.wi:this.Pi},Me.prototype.getDistance=function(){return this.gi},Me.prototype.distance=function(){return this.isLeaves()?this.Ci.distance(this.wi,this.Pi):this.wi.getBounds().distance(this.Pi.getBounds())},Me.prototype.interfaces_=function(){return[bn]},Me.prototype.getClass=function(){return Me},Me.area=function(A){return A.getBounds().getArea()},Me.isComposite=function(A){return A instanceof Ce};var be=function A(){if(this.Di=null,this.Ii=!1,this.Mi=new yi,this.bi=null,0===arguments.length){var t=A.DEFAULT_NODE_CAPACITY;this.bi=t}else if(1===arguments.length){var n=arguments[0];ii.isTrue(n>1,"Node capacity must be greater than 1"),this.bi=n}},ze={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};be.prototype.getNodeCapacity=function(){return this.bi},be.prototype.lastNode=function(A){return A.get(A.size()-1)},be.prototype.size=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.size(this.Di));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof Ce?n+=A.size(r):r instanceof le&&(n+=1)}return n}},be.prototype.removeItem=function(A,t){for(var n=null,i=A.getChildBoundables().iterator();i.hasNext();){var r=i.next();r instanceof le&&r.getItem()===t&&(n=r)}return null!==n&&(A.getChildBoundables().remove(n),!0)},be.prototype.itemsTree=function(){var A=this;if(0===arguments.length){this.build();var t=this.itemsTree(this.Di);return null===t?new yi:t}if(1===arguments.length){for(var n=arguments[0],i=new yi,r=n.getChildBoundables().iterator();r.hasNext();){var e=r.next();if(e instanceof Ce){var s=A.itemsTree(e);null!==s&&i.add(s)}else e instanceof le?i.add(e.getItem()):ii.shouldNeverReachHere()}return i.size()<=0?null:i}},be.prototype.insert=function(A,t){ii.isTrue(!this.Ii,"Cannot insert items into an STR packed R-tree after it has been built."),this.Mi.add(new le(A,t))},be.prototype.boundablesAtLevel=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=new yi;return this.boundablesAtLevel(t,this.Di,n),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];if(ii.isTrue(i>-2),r.getLevel()===i)return e.add(r),null;for(var s=r.getChildBoundables().iterator();s.hasNext();){var u=s.next();u instanceof Ce?A.boundablesAtLevel(i,u,e):(ii.isTrue(u instanceof le),-1===i&&e.add(u))}return null}},be.prototype.query=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.build();var n=new yi;return this.isEmpty()||this.getIntersectsOp().intersects(this.Di.getBounds(),t)&&this.query(t,this.Di,n),n}if(2===arguments.length){var i=arguments[0],r=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this.Di.getBounds(),i)&&this.query(i,this.Di,r)}else if(3===arguments.length)if(Fn(arguments[2],Pe)&&arguments[0]instanceof Object&&arguments[1]instanceof Ce)for(var e=arguments[0],s=arguments[1],u=arguments[2],o=s.getChildBoundables(),h=0;h<o.size();h++){var f=o.get(h);A.getIntersectsOp().intersects(f.getBounds(),e)&&(f instanceof Ce?A.query(e,f,u):f instanceof le?u.visitItem(f.getItem()):ii.shouldNeverReachHere())}else if(Fn(arguments[2],xi)&&arguments[0]instanceof Object&&arguments[1]instanceof Ce)for(var c=arguments[0],a=arguments[1],v=arguments[2],l=a.getChildBoundables(),w=0;w<l.size();w++){var P=l.get(w);A.getIntersectsOp().intersects(P.getBounds(),c)&&(P instanceof Ce?A.query(c,P,v):P instanceof le?v.add(P.getItem()):ii.shouldNeverReachHere())}},be.prototype.build=function(){if(this.Ii)return null;this.Di=this.Mi.isEmpty()?this.createNode(0):this.createHigherLevels(this.Mi,-1),this.Mi=null,this.Ii=!0},be.prototype.getRoot=function(){return this.build(),this.Di},be.prototype.remove=function(){var A=this;if(2===arguments.length){var t=arguments[0],n=arguments[1];return this.build(),!!this.getIntersectsOp().intersects(this.Di.getBounds(),t)&&this.remove(t,this.Di,n)}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=this.removeItem(r,e);if(s)return!0;for(var u=null,o=r.getChildBoundables().iterator();o.hasNext();){var h=o.next();if(A.getIntersectsOp().intersects(h.getBounds(),i)&&h instanceof Ce&&(s=A.remove(i,h,e))){u=h;break}}return null!==u&&u.getChildBoundables().isEmpty()&&r.getChildBoundables().remove(u),s}},be.prototype.createHigherLevels=function(A,t){ii.isTrue(!A.isEmpty());var n=this.createParentBoundables(A,t+1);return 1===n.size()?n.get(0):this.createHigherLevels(n,t+1)},be.prototype.depth=function(){var A=this;if(0===arguments.length)return this.isEmpty()?0:(this.build(),this.depth(this.Di));if(1===arguments.length){for(var t=arguments[0],n=0,i=t.getChildBoundables().iterator();i.hasNext();){var r=i.next();if(r instanceof Ce){var e=A.depth(r);e>n&&(n=e)}}return n+1}},be.prototype.createParentBoundables=function(A,t){ii.isTrue(!A.isEmpty());var n=new yi;n.add(this.createNode(t));var i=new yi(A);Ie.sort(i,this.getComparator());for(var r=i.iterator();r.hasNext();){var e=r.next();this.lastNode(n).getChildBoundables().size()===this.getNodeCapacity()&&n.add(this.createNode(t)),this.lastNode(n).addChildBoundable(e)}return n},be.prototype.isEmpty=function(){return this.Ii?this.Di.isEmpty():this.Mi.isEmpty()},be.prototype.interfaces_=function(){return[xn]},be.prototype.getClass=function(){return be},be.compareDoubles=function(A,t){return A>t?1:A<t?-1:0},ze.IntersectsOp.get=function(){return de},ze.serialVersionUID.get=function(){return-0x35ef64c82d4c5400},ze.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(be,ze);var de=function(){},xe=function(){};xe.prototype.distance=function(A,t){},xe.prototype.interfaces_=function(){return[]},xe.prototype.getClass=function(){return xe};var me=function(A){function t(n){A.call(this,n=n||t.DEFAULT_NODE_CAPACITY)}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return t.prototype.createParentBoundablesFromVerticalSlices=function(A,t){ii.isTrue(A.length>0);for(var n=new yi,i=0;i<A.length;i++)n.addAll(this.createParentBoundablesFromVerticalSlice(A[i],t));return n},t.prototype.createNode=function(A){return new ye(A)},t.prototype.size=function(){return 0===arguments.length?A.prototype.size.call(this):A.prototype.size.apply(this,arguments)},t.prototype.insert=function(){if(2!==arguments.length)return A.prototype.insert.apply(this,arguments);var t=arguments[0],n=arguments[1];if(t.isNull())return null;A.prototype.insert.call(this,t,n)},t.prototype.getIntersectsOp=function(){return t.intersectsOp},t.prototype.verticalSlices=function(A,t){for(var n=Math.trunc(Math.ceil(A.size()/t)),i=new Array(t).fill(null),r=A.iterator(),e=0;e<t;e++){i[e]=new yi;for(var s=0;r.hasNext()&&s<n;){var u=r.next();i[e].add(u),s++}}return i},t.prototype.query=function(){if(1===arguments.length){var t=arguments[0];return A.prototype.query.call(this,t)}if(2===arguments.length){var n=arguments[0],i=arguments[1];A.prototype.query.call(this,n,i)}else if(3===arguments.length)if(Fn(arguments[2],Pe)&&arguments[0]instanceof Object&&arguments[1]instanceof Ce){var r=arguments[0],e=arguments[1],s=arguments[2];A.prototype.query.call(this,r,e,s)}else if(Fn(arguments[2],xi)&&arguments[0]instanceof Object&&arguments[1]instanceof Ce){var u=arguments[0],o=arguments[1],h=arguments[2];A.prototype.query.call(this,u,o,h)}},t.prototype.getComparator=function(){return t.yComparator},t.prototype.createParentBoundablesFromVerticalSlice=function(t,n){return A.prototype.createParentBoundables.call(this,t,n)},t.prototype.remove=function(){if(2===arguments.length){var t=arguments[0],n=arguments[1];return A.prototype.remove.call(this,t,n)}return A.prototype.remove.apply(this,arguments)},t.prototype.depth=function(){return 0===arguments.length?A.prototype.depth.call(this):A.prototype.depth.apply(this,arguments)},t.prototype.createParentBoundables=function(A,n){ii.isTrue(!A.isEmpty());var i=Math.trunc(Math.ceil(A.size()/this.getNodeCapacity())),r=new yi(A);Ie.sort(r,t.xComparator);var e=this.verticalSlices(r,Math.trunc(Math.ceil(Math.sqrt(i))));return this.createParentBoundablesFromVerticalSlices(e,n)},t.prototype.nearestNeighbour=function(){if(1===arguments.length){if(Fn(arguments[0],xe)){var A=arguments[0],n=new Me(this.getRoot(),this.getRoot(),A);return this.nearestNeighbour(n)}if(arguments[0]instanceof Me){var i=arguments[0];return this.nearestNeighbour(i,In.POSITIVE_INFINITY)}}else if(2===arguments.length){if(arguments[0]instanceof t&&Fn(arguments[1],xe)){var r=arguments[0],e=arguments[1],s=new Me(this.getRoot(),r.getRoot(),e);return this.nearestNeighbour(s)}if(arguments[0]instanceof Me&&"number"==typeof arguments[1]){var u=arguments[0],o=arguments[1],h=o,f=null,c=new we;for(c.add(u);!c.isEmpty()&&h>0;){var a=c.poll(),v=a.getDistance();if(v>=h)break;a.isLeaves()?(h=v,f=a):a.expandToQueue(c,h)}return[f.getBoundable(0).getItem(),f.getBoundable(1).getItem()]}}else if(3===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=new le(l,w),C=new Me(this.getRoot(),g,P);return this.nearestNeighbour(C)[0]}},t.prototype.interfaces_=function(){return[ge,xn]},t.prototype.getClass=function(){return t},t.centreX=function(A){return t.avg(A.getMinX(),A.getMaxX())},t.avg=function(A,t){return(A+t)/2},t.centreY=function(A){return t.avg(A.getMinY(),A.getMaxY())},n.STRtreeNode.get=function(){return ye},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[dn]},compare:function(n,i){return A.compareDoubles(t.centreX(n.getBounds()),t.centreX(i.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[dn]},compare:function(n,i){return A.compareDoubles(t.centreY(n.getBounds()),t.centreY(i.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[A.IntersectsOp]},intersects:function(A,t){return A.intersects(t)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(t,n),t}(be),ye=function(A){function t(){var t=arguments[0];A.call(this,t)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.computeBounds=function(){for(var A=null,t=this.getChildBoundables().iterator();t.hasNext();){var n=t.next();null===A?A=new Kn(n.getBounds()):A.expandToInclude(n.getBounds())}return A},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ce),pe=function(){};pe.prototype.interfaces_=function(){return[]},pe.prototype.getClass=function(){return pe},pe.relativeSign=function(A,t){return A<t?-1:A>t?1:0},pe.compare=function(A,t,n){if(t.equals2D(n))return 0;var i=pe.relativeSign(t.x,n.x),r=pe.relativeSign(t.y,n.y);switch(A){case 0:return pe.compareValue(i,r);case 1:return pe.compareValue(r,i);case 2:return pe.compareValue(r,-i);case 3:return pe.compareValue(-i,r);case 4:return pe.compareValue(-i,-r);case 5:return pe.compareValue(-r,-i);case 6:return pe.compareValue(-r,i);case 7:return pe.compareValue(i,-r)}return ii.shouldNeverReachHere("invalid octant value"),0},pe.compareValue=function(A,t){return A<0?-1:A>0?1:t<0?-1:t>0?1:0};var Le=function(){this.zi=null,this.coord=null,this.segmentIndex=null,this.di=null,this.xi=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.zi=A,this.coord=new mn(t),this.segmentIndex=n,this.di=i,this.xi=!t.equals2D(A.getCoordinate(n))};Le.prototype.getCoordinate=function(){return this.coord},Le.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex)},Le.prototype.compareTo=function(A){var t=A;return this.segmentIndex<t.segmentIndex?-1:this.segmentIndex>t.segmentIndex?1:this.coord.equals2D(t.coord)?0:pe.compare(this.di,this.coord,t.coord)},Le.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&!this.xi||this.segmentIndex===A},Le.prototype.isInterior=function(){return this.xi},Le.prototype.interfaces_=function(){return[bn]},Le.prototype.getClass=function(){return Le};var Te=function(){this.mi=new Vi,this._n=null;var A=arguments[0];this._n=A};Te.prototype.getSplitCoordinates=function(){var A=new Li;this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next();this.addEdgeCoordinates(n,i,A),n=i}return A.toCoordinateArray()},Te.prototype.addCollapsedNodes=function(){var A=new yi;this.findCollapsesFromInsertedNodes(A),this.findCollapsesFromExistingVertices(A);for(var t=A.iterator();t.hasNext();){var n=t.next().intValue();this.add(this._n.getCoordinate(n),n)}},Te.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},Te.prototype.findCollapsesFromExistingVertices=function(A){for(var t=0;t<this._n.size()-2;t++){var n=this._n.getCoordinate(t),i=this._n.getCoordinate(t+2);n.equals2D(i)&&A.add(new jn(t+1))}},Te.prototype.addEdgeCoordinates=function(A,t,n){var i=this._n.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);n.add(new mn(A.coord),!1);for(var e=A.segmentIndex+1;e<=t.segmentIndex;e++)n.add(this._n.getCoordinate(e));r&&n.add(new mn(t.coord))},Te.prototype.iterator=function(){return this.mi.values().iterator()},Te.prototype.addSplitEdges=function(A){this.addEndpoints(),this.addCollapsedNodes();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},Te.prototype.findCollapseIndex=function(A,t,n){if(!A.coord.equals2D(t.coord))return!1;var i=t.segmentIndex-A.segmentIndex;return t.isInterior()||i--,1===i&&(n[0]=A.segmentIndex+1,!0)},Te.prototype.findCollapsesFromInsertedNodes=function(A){for(var t=new Array(1).fill(null),n=this.iterator(),i=n.next();n.hasNext();){var r=n.next();this.findCollapseIndex(i,r,t)&&A.add(new jn(t[0])),i=r}},Te.prototype.getEdge=function(){return this._n},Te.prototype.addEndpoints=function(){var A=this._n.size()-1;this.add(this._n.getCoordinate(0),0),this.add(this._n.getCoordinate(A),A)},Te.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,i=this._n.getCoordinate(t.segmentIndex),r=t.isInterior()||!t.coord.equals2D(i);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new mn(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this._n.getCoordinate(u);return r&&(e[s]=new mn(t.coord)),new Ee(e,this._n.getData())},Te.prototype.add=function(A,t){var n=new Le(this._n,A,t,this._n.getSegmentOctant(t)),i=this.mi.get(n);return null!==i?(ii.isTrue(i.coord.equals2D(A),"Found equal nodes with different coordinates"),i):(this.mi.put(n,n),n)},Te.prototype.checkSplitEdgesCorrectness=function(A){var t=this._n.getCoordinates(),n=A.get(0).getCoordinate(0);if(!n.equals2D(t[0]))throw new ti("bad split edge start point at "+n);var i=A.get(A.size()-1).getCoordinates(),r=i[i.length-1];if(!r.equals2D(t[t.length-1]))throw new ti("bad split edge end point at "+r)},Te.prototype.interfaces_=function(){return[]},Te.prototype.getClass=function(){return Te};var Oe=function(){};Oe.prototype.interfaces_=function(){return[]},Oe.prototype.getClass=function(){return Oe},Oe.octant=function(){if("number"==typeof arguments[0]&&"number"==typeof arguments[1]){var A=arguments[0],t=arguments[1];if(0===A&&0===t)throw new Dn("Cannot compute the octant for point ( "+A+", "+t+" )");var n=Math.abs(A),i=Math.abs(t);return A>=0?t>=0?n>=i?0:1:n>=i?7:6:t>=0?n>=i?3:2:n>=i?4:5}if(arguments[0]instanceof mn&&arguments[1]instanceof mn){var r=arguments[0],e=arguments[1],s=e.x-r.x,u=e.y-r.y;if(0===s&&0===u)throw new Dn("Cannot compute the octant for two identical points "+r);return Oe.octant(s,u)}};var Fe=function(){};Fe.prototype.getCoordinates=function(){},Fe.prototype.size=function(){},Fe.prototype.getCoordinate=function(A){},Fe.prototype.isClosed=function(){},Fe.prototype.setData=function(A){},Fe.prototype.getData=function(){},Fe.prototype.interfaces_=function(){return[]},Fe.prototype.getClass=function(){return Fe};var Ue=function(){};Ue.prototype.addIntersection=function(A,t){},Ue.prototype.interfaces_=function(){return[Fe]},Ue.prototype.getClass=function(){return Ue};var Ee=function(){this.yi=new Te(this),this.Qn=null,this.pi=null;var A=arguments[0],t=arguments[1];this.Qn=A,this.pi=t};Ee.prototype.getCoordinates=function(){return this.Qn},Ee.prototype.size=function(){return this.Qn.length},Ee.prototype.getCoordinate=function(A){return this.Qn[A]},Ee.prototype.isClosed=function(){return this.Qn[0].equals(this.Qn[this.Qn.length-1])},Ee.prototype.getSegmentOctant=function(A){return A===this.Qn.length-1?-1:this.safeOctant(this.getCoordinate(A),this.getCoordinate(A+1))},Ee.prototype.setData=function(A){this.pi=A},Ee.prototype.safeOctant=function(A,t){return A.equals2D(t)?0:Oe.octant(A,t)},Ee.prototype.getData=function(){return this.pi},Ee.prototype.addIntersection=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];this.addIntersectionNode(A,t)}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[3],e=new mn(n.getIntersection(r));this.addIntersection(e,i)}},Ee.prototype.toString=function(){return Ai.toLineString(new yr(this.Qn))},Ee.prototype.getNodeList=function(){return this.yi},Ee.prototype.addIntersectionNode=function(A,t){var n=t,i=n+1;i<this.Qn.length&&(A.equals2D(this.Qn[i])&&(n=i));return this.yi.add(A,n)},Ee.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},Ee.prototype.interfaces_=function(){return[Ue]},Ee.prototype.getClass=function(){return Ee},Ee.getNodedSubstrings=function(){if(1===arguments.length){var A=arguments[0],t=new yi;return Ee.getNodedSubstrings(A,t),t}if(2===arguments.length)for(var n=arguments[0],i=arguments[1],r=n.iterator();r.hasNext();){var e=r.next();e.getNodeList().addSplitEdges(i)}};var Ne=function(){if(this.p0=null,this.p1=null,0===arguments.length)this.p0=new mn,this.p1=new mn;else if(1===arguments.length){var A=arguments[0];this.p0=new mn(A.p0),this.p1=new mn(A.p1)}else if(2===arguments.length)this.p0=arguments[0],this.p1=arguments[1];else if(4===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3];this.p0=new mn(t,n),this.p1=new mn(i,r)}},je={serialVersionUID:{configurable:!0}};Ne.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)},Ne.prototype.orientationIndex=function(){if(arguments[0]instanceof Ne){var A=arguments[0],t=hi.orientationIndex(this.p0,this.p1,A.p0),n=hi.orientationIndex(this.p0,this.p1,A.p1);return t>=0&&n>=0||t<=0&&n<=0?Math.max(t,n):0}if(arguments[0]instanceof mn){var i=arguments[0];return hi.orientationIndex(this.p0,this.p1,i)}},Ne.prototype.toGeometry=function(A){return A.createLineString([this.p0,this.p1])},Ne.prototype.isVertical=function(){return this.p0.x===this.p1.x},Ne.prototype.equals=function(A){if(!(A instanceof Ne))return!1;var t=A;return this.p0.equals(t.p0)&&this.p1.equals(t.p1)},Ne.prototype.intersection=function(A){var t=new si;return t.computeIntersection(this.p0,this.p1,A.p0,A.p1),t.hasIntersection()?t.getIntersection(0):null},Ne.prototype.project=function(){if(arguments[0]instanceof mn){var A=arguments[0];if(A.equals(this.p0)||A.equals(this.p1))return new mn(A);var t=this.projectionFactor(A),n=new mn;return n.x=this.p0.x+t*(this.p1.x-this.p0.x),n.y=this.p0.y+t*(this.p1.y-this.p0.y),n}if(arguments[0]instanceof Ne){var i=arguments[0],r=this.projectionFactor(i.p0),e=this.projectionFactor(i.p1);if(r>=1&&e>=1)return null;if(r<=0&&e<=0)return null;var s=this.project(i.p0);r<0&&(s=this.p0),r>1&&(s=this.p1);var u=this.project(i.p1);return e<0&&(u=this.p0),e>1&&(u=this.p1),new Ne(s,u)}},Ne.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()},Ne.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)},Ne.prototype.getCoordinate=function(A){return 0===A?this.p0:this.p1},Ne.prototype.distancePerpendicular=function(A){return hi.distancePointLinePerpendicular(A,this.p0,this.p1)},Ne.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)},Ne.prototype.midPoint=function(){return Ne.midPoint(this.p0,this.p1)},Ne.prototype.projectionFactor=function(A){if(A.equals(this.p0))return 0;if(A.equals(this.p1))return 1;var t=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,i=t*t+n*n;return i<=0?In.NaN:((A.x-this.p0.x)*t+(A.y-this.p0.y)*n)/i},Ne.prototype.closestPoints=function(A){var t=this.intersection(A);if(null!==t)return[t,t];var n=new Array(2).fill(null),i=In.MAX_VALUE,r=null,e=this.closestPoint(A.p0);i=e.distance(A.p0),n[0]=e,n[1]=A.p0;var s=this.closestPoint(A.p1);(r=s.distance(A.p1))<i&&(i=r,n[0]=s,n[1]=A.p1);var u=A.closestPoint(this.p0);(r=u.distance(this.p0))<i&&(i=r,n[0]=this.p0,n[1]=u);var o=A.closestPoint(this.p1);return(r=o.distance(this.p1))<i&&(i=r,n[0]=this.p1,n[1]=o),n},Ne.prototype.closestPoint=function(A){var t=this.projectionFactor(A);return t>0&&t<1?this.project(A):this.p0.distance(A)<this.p1.distance(A)?this.p0:this.p1},Ne.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)},Ne.prototype.getLength=function(){return this.p0.distance(this.p1)},Ne.prototype.compareTo=function(A){var t=A,n=this.p0.compareTo(t.p0);return 0!==n?n:this.p1.compareTo(t.p1)},Ne.prototype.reverse=function(){var A=this.p0;this.p0=this.p1,this.p1=A},Ne.prototype.equalsTopo=function(A){return this.p0.equals(A.p0)&&(this.p1.equals(A.p1)||this.p0.equals(A.p1))&&this.p1.equals(A.p0)},Ne.prototype.lineIntersection=function(A){try{return _n.intersection(this.p0,this.p1,A.p0,A.p1)}catch(A){if(!(A instanceof Vn))throw A}return null},Ne.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)},Ne.prototype.pointAlongOffset=function(A,t){var n=this.p0.x+A*(this.p1.x-this.p0.x),i=this.p0.y+A*(this.p1.y-this.p0.y),r=this.p1.x-this.p0.x,e=this.p1.y-this.p0.y,s=Math.sqrt(r*r+e*e),u=0,o=0;if(0!==t){if(s<=0)throw new Error("Cannot compute offset from zero-length line segment");u=t*r/s,o=t*e/s}return new mn(n-o,i+u)},Ne.prototype.setCoordinates=function(){if(1===arguments.length){var A=arguments[0];this.setCoordinates(A.p0,A.p1)}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.p0.x=t.x,this.p0.y=t.y,this.p1.x=n.x,this.p1.y=n.y}},Ne.prototype.segmentFraction=function(A){var t=this.projectionFactor(A);return t<0?t=0:(t>1||In.isNaN(t))&&(t=1),t},Ne.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"},Ne.prototype.isHorizontal=function(){return this.p0.y===this.p1.y},Ne.prototype.distance=function(){if(arguments[0]instanceof Ne){var A=arguments[0];return hi.distanceLineLine(this.p0,this.p1,A.p0,A.p1)}if(arguments[0]instanceof mn){var t=arguments[0];return hi.distancePointLine(t,this.p0,this.p1)}},Ne.prototype.pointAlong=function(A){var t=new mn;return t.x=this.p0.x+A*(this.p1.x-this.p0.x),t.y=this.p0.y+A*(this.p1.y-this.p0.y),t},Ne.prototype.hashCode=function(){var A=In.doubleToLongBits(this.p0.x);A^=31*In.doubleToLongBits(this.p0.y);var t=Math.trunc(A)^Math.trunc(A>>32),n=In.doubleToLongBits(this.p1.x);return n^=31*In.doubleToLongBits(this.p1.y),t^Math.trunc(n)^Math.trunc(n>>32)},Ne.prototype.interfaces_=function(){return[bn,xn]},Ne.prototype.getClass=function(){return Ne},Ne.midPoint=function(A,t){return new mn((A.x+t.x)/2,(A.y+t.y)/2)},je.serialVersionUID.get=function(){return 0x2d2172135f411c00},Object.defineProperties(Ne,je);var Qe=function(){this.tempEnv1=new Kn,this.tempEnv2=new Kn,this.Li=new Ne,this.Ti=new Ne};Qe.prototype.overlap=function(){if(2===arguments.length);else if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];A.getLineSegment(t,this.Li),n.getLineSegment(i,this.Ti),this.overlap(this.Li,this.Ti)}},Qe.prototype.interfaces_=function(){return[]},Qe.prototype.getClass=function(){return Qe};var Se=function(){this.Qn=null,this.Oi=null,this.Fi=null,this.Un=null,this.Ui=null,this.Ei=null;var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.Qn=A,this.Oi=t,this.Fi=n,this.Ui=i};Se.prototype.getLineSegment=function(A,t){t.p0=this.Qn[A],t.p1=this.Qn[A+1]},Se.prototype.computeSelect=function(A,t,n,i){if(i.tempEnv1.init(this.Qn[t],this.Qn[n]),n-t==1)return i.select(this,t),null;if(!A.intersects(i.tempEnv1))return null;var s=Math.trunc((t+n)/2);t<s&&this.computeSelect(A,t,s,i),s<n&&this.computeSelect(A,s,n,i)},Se.prototype.getCoordinates=function(){for(var A=new Array(this.Fi-this.Oi+1).fill(null),t=0,n=this.Oi;n<=this.Fi;n++)A[t++]=this.Qn[n];return A},Se.prototype.computeOverlaps=function(A,t){this.computeOverlapsInternal(this.Oi,this.Fi,A,A.Oi,A.Fi,t)},Se.prototype.setId=function(A){this.Ei=A},Se.prototype.select=function(A,t){this.computeSelect(A,this.Oi,this.Fi,t)},Se.prototype.getEnvelope=function(){null===this.Un&&(this.Un=new Kn(this.Qn[this.Oi],this.Qn[this.Fi]));return this.Un},Se.prototype.getEndIndex=function(){return this.Fi},Se.prototype.getStartIndex=function(){return this.Oi},Se.prototype.getContext=function(){return this.Ui},Se.prototype.getId=function(){return this.Ei},Se.prototype.computeOverlapsInternal=function(A,t,n,i,r,e){var s=this.Qn[A],u=this.Qn[t],o=n.Qn[i],h=n.Qn[r];if(t-A==1&&r-i==1)return e.overlap(this,A,n,i),null;if(e.tempEnv1.init(s,u),e.tempEnv2.init(o,h),!e.tempEnv1.intersects(e.tempEnv2))return null;var f=Math.trunc((A+t)/2),c=Math.trunc((i+r)/2);A<f&&(i<c&&this.computeOverlapsInternal(A,f,n,i,c,e),c<r&&this.computeOverlapsInternal(A,f,n,c,r,e)),f<t&&(i<c&&this.computeOverlapsInternal(f,t,n,i,c,e),c<r&&this.computeOverlapsInternal(f,t,n,c,r,e))},Se.prototype.interfaces_=function(){return[]},Se.prototype.getClass=function(){return Se};var ke=function(){};ke.prototype.interfaces_=function(){return[]},ke.prototype.getClass=function(){return ke},ke.getChainStartIndices=function(A){var t=0,n=new yi;n.add(new jn(t));do{var i=ke.findChainEnd(A,t);n.add(new jn(i)),t=i}while(t<A.length-1);return ke.toIntArray(n)},ke.findChainEnd=function(A,t){for(var n=t;n<A.length-1&&A[n].equals2D(A[n+1]);)n++;if(n>=A.length-1)return A.length-1;for(var i=se.quadrant(A[n],A[n+1]),r=t+1;r<A.length&&(A[r-1].equals2D(A[r])||se.quadrant(A[r-1],A[r])===i);)r++;return r-1},ke.getChains=function(){if(1===arguments.length){var A=arguments[0];return ke.getChains(A,null)}if(2===arguments.length){for(var t=arguments[0],n=arguments[1],i=new yi,r=ke.getChainStartIndices(t),e=0;e<r.length-1;e++){var s=new Se(t,r[e],r[e+1],n);i.add(s)}return i}},ke.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var Be=function(){};Be.prototype.computeNodes=function(A){},Be.prototype.getNodedSubstrings=function(){},Be.prototype.interfaces_=function(){return[]},Be.prototype.getClass=function(){return Be};var Re=function(){if(this.Ni=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];this.setSegmentIntersector(A)}};Re.prototype.setSegmentIntersector=function(A){this.Ni=A},Re.prototype.interfaces_=function(){return[Be]},Re.prototype.getClass=function(){return Re};var Ge=function(A){function t(t){t?A.call(this,t):A.call(this),this.ji=new yi,this.Qi=new me,this.Si=0,this.ki=null,this.Bi=0}A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t;var n={SegmentOverlapAction:{configurable:!0}};return t.prototype.getMonotoneChains=function(){return this.ji},t.prototype.getNodedSubstrings=function(){return Ee.getNodedSubstrings(this.ki)},t.prototype.getIndex=function(){return this.Qi},t.prototype.add=function(A){for(var t=ke.getChains(A.getCoordinates(),A).iterator();t.hasNext();){var n=t.next();n.setId(this.Si++),this.Qi.insert(n.getEnvelope(),n),this.ji.add(n)}},t.prototype.computeNodes=function(A){this.ki=A;for(var t=A.iterator();t.hasNext();)this.add(t.next());this.intersectChains()},t.prototype.intersectChains=function(){for(var A=new Ye(this.Ni),t=this.ji.iterator();t.hasNext();)for(var n=t.next(),i=this.Qi.query(n.getEnvelope()).iterator();i.hasNext();){var r=i.next();if(r.getId()>n.getId()&&(n.computeOverlaps(r,A),this.Bi++),this.Ni.isDone())return null}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},n.SegmentOverlapAction.get=function(){return Ye},Object.defineProperties(t,n),t}(Re),Ye=function(A){function t(){A.call(this),this.Ri=null;var t=arguments[0];this.Ri=t}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.overlap=function(){if(4!==arguments.length)return A.prototype.overlap.apply(this,arguments);var t=arguments[0],n=arguments[1],i=arguments[2],r=arguments[3],e=t.getContext(),s=i.getContext();this.Ri.processIntersections(e,n,s,r)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Qe),qe=function A(){if(this.Gi=A.DEFAULT_QUADRANT_SEGMENTS,this.Yi=A.CAP_ROUND,this.qi=A.JOIN_ROUND,this.Vi=A.DEFAULT_MITRE_LIMIT,this.Wi=!1,this._i=A.DEFAULT_SIMPLIFY_FACTOR,0===arguments.length);else if(1===arguments.length){var t=arguments[0];this.setQuadrantSegments(t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(i)}else if(4===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3];this.setQuadrantSegments(r),this.setEndCapStyle(e),this.setJoinStyle(s),this.setMitreLimit(u)}},Ve={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};qe.prototype.getEndCapStyle=function(){return this.Yi},qe.prototype.isSingleSided=function(){return this.Wi},qe.prototype.setQuadrantSegments=function(A){this.Gi=A,0===this.Gi&&(this.qi=qe.JOIN_BEVEL),this.Gi<0&&(this.qi=qe.JOIN_MITRE,this.Vi=Math.abs(this.Gi)),A<=0&&(this.Gi=1),this.qi!==qe.JOIN_ROUND&&(this.Gi=qe.DEFAULT_QUADRANT_SEGMENTS)},qe.prototype.getJoinStyle=function(){return this.qi},qe.prototype.setJoinStyle=function(A){this.qi=A},qe.prototype.setSimplifyFactor=function(A){this._i=A<0?0:A},qe.prototype.getSimplifyFactor=function(){return this._i},qe.prototype.getQuadrantSegments=function(){return this.Gi},qe.prototype.setEndCapStyle=function(A){this.Yi=A},qe.prototype.getMitreLimit=function(){return this.Vi},qe.prototype.setMitreLimit=function(A){this.Vi=A},qe.prototype.setSingleSided=function(A){this.Wi=A},qe.prototype.interfaces_=function(){return[]},qe.prototype.getClass=function(){return qe},qe.bufferDistanceError=function(A){var t=Math.PI/2/A;return 1-Math.cos(t/2)},Ve.CAP_ROUND.get=function(){return 1},Ve.CAP_FLAT.get=function(){return 2},Ve.CAP_SQUARE.get=function(){return 3},Ve.JOIN_ROUND.get=function(){return 1},Ve.JOIN_MITRE.get=function(){return 2},Ve.JOIN_BEVEL.get=function(){return 3},Ve.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8},Ve.DEFAULT_MITRE_LIMIT.get=function(){return 5},Ve.DEFAULT_SIMPLIFY_FACTOR.get=function(){return.01},Object.defineProperties(qe,Ve);var We=function(A){this.Ki=null,this.Hi=null,this.Ji=hi.COUNTERCLOCKWISE,this.Zi=A||null},_e={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};We.prototype.isDeletable=function(A,t,n,i){var r=this.Zi[A],e=this.Zi[t],s=this.Zi[n];return!!this.isConcave(r,e,s)&&!!this.isShallow(r,e,s,i)&&this.isShallowSampled(r,e,A,n,i)},We.prototype.deleteShallowConcavities=function(){for(var A=1,t=this.findNextNonDeletedIndex(A),n=this.findNextNonDeletedIndex(t),i=!1;n<this.Zi.length;){var r=!1;this.isDeletable(A,t,n,this.Ki)&&(this.Hi[t]=We.DELETE,r=!0,i=!0),t=this.findNextNonDeletedIndex(A=r?n:t),n=this.findNextNonDeletedIndex(t)}return i},We.prototype.isShallowConcavity=function(A,t,n,i){return hi.computeOrientation(A,t,n)===this.Ji&&hi.distancePointLine(t,A,n)<i},We.prototype.isShallowSampled=function(A,t,n,i,r){var e=Math.trunc((i-n)/We.NUM_PTS_TO_CHECK);e<=0&&(e=1);for(var s=n;s<i;s+=e)if(!this.isShallow(A,t,this.Zi[s],r))return!1;return!0},We.prototype.isConcave=function(A,t,n){return hi.computeOrientation(A,t,n)===this.Ji},We.prototype.simplify=function(A){this.Ki=Math.abs(A),A<0&&(this.Ji=hi.CLOCKWISE),this.Hi=new Array(this.Zi.length).fill(null);var t=!1;do{t=this.deleteShallowConcavities()}while(t);return this.collapseLine()},We.prototype.findNextNonDeletedIndex=function(A){for(var t=A+1;t<this.Zi.length&&this.Hi[t]===We.DELETE;)t++;return t},We.prototype.isShallow=function(A,t,n,i){return hi.distancePointLine(t,A,n)<i},We.prototype.collapseLine=function(){for(var A=new Li,t=0;t<this.Zi.length;t++)this.Hi[t]!==We.DELETE&&A.add(this.Zi[t]);return A.toCoordinateArray()},We.prototype.interfaces_=function(){return[]},We.prototype.getClass=function(){return We},We.simplify=function(A,t){return new We(A).simplify(t)},_e.INIT.get=function(){return 0},_e.DELETE.get=function(){return 1},_e.KEEP.get=function(){return 1},_e.NUM_PTS_TO_CHECK.get=function(){return 10},Object.defineProperties(We,_e);var Ke=function(){this.Xi=null,this.sn=null,this.$i=0,this.Xi=new yi},He={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ke.prototype.getCoordinates=function(){return this.Xi.toArray(Ke.COORDINATE_ARRAY_TYPE)},Ke.prototype.setPrecisionModel=function(A){this.sn=A},Ke.prototype.addPt=function(A){var t=new mn(A);if(this.sn.makePrecise(t),this.isRedundant(t))return null;this.Xi.add(t)},Ke.prototype.revere=function(){},Ke.prototype.addPts=function(A,t){if(t)for(var n=0;n<A.length;n++)this.addPt(A[n]);else for(var i=A.length-1;i>=0;i--)this.addPt(A[i])},Ke.prototype.isRedundant=function(A){if(this.Xi.size()<1)return!1;var t=this.Xi.get(this.Xi.size()-1);return A.distance(t)<this.$i},Ke.prototype.toString=function(){return(new jr).createLineString(this.getCoordinates()).toString()},Ke.prototype.closeRing=function(){if(this.Xi.size()<1)return null;var A=new mn(this.Xi.get(0)),t=this.Xi.get(this.Xi.size()-1);if(A.equals(t))return null;this.Xi.add(A)},Ke.prototype.setMinimumVertexDistance=function(A){this.$i=A},Ke.prototype.interfaces_=function(){return[]},Ke.prototype.getClass=function(){return Ke},He.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)},Object.defineProperties(Ke,He);var Je=function(){},Ze={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Je.prototype.interfaces_=function(){return[]},Je.prototype.getClass=function(){return Je},Je.toDegrees=function(A){return 180*A/Math.PI},Je.normalize=function(A){for(;A>Math.PI;)A-=Je.PI_TIMES_2;for(;A<=-Math.PI;)A+=Je.PI_TIMES_2;return A},Je.angle=function(){if(1===arguments.length){var A=arguments[0];return Math.atan2(A.y,A.x)}if(2===arguments.length){var t=arguments[0],n=arguments[1],i=n.x-t.x,r=n.y-t.y;return Math.atan2(r,i)}},Je.isAcute=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)>0},Je.isObtuse=function(A,t,n){return(A.x-t.x)*(n.x-t.x)+(A.y-t.y)*(n.y-t.y)<0},Je.interiorAngle=function(A,t,n){var i=Je.angle(t,A),r=Je.angle(t,n);return Math.abs(r-i)},Je.normalizePositive=function(A){if(A<0){for(;A<0;)A+=Je.PI_TIMES_2;A>=Je.PI_TIMES_2&&(A=0)}else{for(;A>=Je.PI_TIMES_2;)A-=Je.PI_TIMES_2;A<0&&(A=0)}return A},Je.angleBetween=function(A,t,n){var i=Je.angle(t,A),r=Je.angle(t,n);return Je.diff(i,r)},Je.diff=function(A,t){var n=null;return(n=A<t?t-A:A-t)>Math.PI&&(n=2*Math.PI-n),n},Je.toRadians=function(A){return A*Math.PI/180},Je.getTurn=function(A,t){var n=Math.sin(t-A);return n>0?Je.COUNTERCLOCKWISE:n<0?Je.CLOCKWISE:Je.NONE},Je.angleBetweenOriented=function(A,t,n){var i=Je.angle(t,A),r=Je.angle(t,n)-i;return r<=-Math.PI?r+Je.PI_TIMES_2:r>Math.PI?r-Je.PI_TIMES_2:r},Ze.PI_TIMES_2.get=function(){return 2*Math.PI},Ze.PI_OVER_2.get=function(){return Math.PI/2},Ze.PI_OVER_4.get=function(){return Math.PI/4},Ze.COUNTERCLOCKWISE.get=function(){return hi.COUNTERCLOCKWISE},Ze.CLOCKWISE.get=function(){return hi.CLOCKWISE},Ze.NONE.get=function(){return hi.COLLINEAR},Object.defineProperties(Je,Ze);var Xe=function A(){this.Ar=0,this.tr=null,this.nr=1,this.ir=null,this.gi=0,this.sn=null,this.rr=null,this.er=null,this.sr=null,this.ur=null,this.or=null,this.hr=new Ne,this.cr=new Ne,this.ar=new Ne,this.vr=new Ne,this.lr=0,this.wr=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.sn=t,this.rr=n,this.er=new si,this.tr=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===qe.JOIN_ROUND&&(this.nr=A.MAX_CLOSING_SEG_LEN_FACTOR),this.init(i)},$e={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};Xe.prototype.addNextSegment=function(A,t){if(this.sr=this.ur,this.ur=this.or,this.or=A,this.hr.setCoordinates(this.sr,this.ur),this.computeOffsetSegment(this.hr,this.lr,this.gi,this.ar),this.cr.setCoordinates(this.ur,this.or),this.computeOffsetSegment(this.cr,this.lr,this.gi,this.vr),this.ur.equals(this.or))return null;var n=hi.computeOrientation(this.sr,this.ur,this.or),i=n===hi.CLOCKWISE&&this.lr===qr.LEFT||n===hi.COUNTERCLOCKWISE&&this.lr===qr.RIGHT;0===n?this.addCollinear(t):i?this.addOutsideTurn(n,t):this.addInsideTurn(n,t)},Xe.prototype.addLineEndCap=function(A,t){var n=new Ne(A,t),i=new Ne;this.computeOffsetSegment(n,qr.LEFT,this.gi,i);var r=new Ne;this.computeOffsetSegment(n,qr.RIGHT,this.gi,r);var u=Math.atan2(t.y-A.y,t.x-A.x);switch(this.rr.getEndCapStyle()){case qe.CAP_ROUND:this.ir.addPt(i.p1),this.addFilletArc(t,u+Math.PI/2,u-Math.PI/2,hi.CLOCKWISE,this.gi),this.ir.addPt(r.p1);break;case qe.CAP_FLAT:this.ir.addPt(i.p1),this.ir.addPt(r.p1);break;case qe.CAP_SQUARE:var o=new mn;o.x=Math.abs(this.gi)*Math.cos(u),o.y=Math.abs(this.gi)*Math.sin(u);var h=new mn(i.p1.x+o.x,i.p1.y+o.y),f=new mn(r.p1.x+o.x,r.p1.y+o.y);this.ir.addPt(h),this.ir.addPt(f)}},Xe.prototype.getCoordinates=function(){return this.ir.getCoordinates()},Xe.prototype.addMitreJoin=function(A,t,n,i){var r=!0,e=null;try{e=_n.intersection(t.p0,t.p1,n.p0,n.p1),(i<=0?1:e.distance(A)/Math.abs(i))>this.rr.getMitreLimit()&&(r=!1)}catch(A){if(!(A instanceof Vn))throw A;e=new mn(0,0),r=!1}r?this.ir.addPt(e):this.addLimitedMitreJoin(t,n,i,this.rr.getMitreLimit())},Xe.prototype.addFilletCorner=function(A,t,n,i,r){var u=Math.atan2(t.y-A.y,t.x-A.x),f=Math.atan2(n.y-A.y,n.x-A.x);i===hi.CLOCKWISE?u<=f&&(u+=2*Math.PI):u>=f&&(u-=2*Math.PI),this.ir.addPt(t),this.addFilletArc(A,u,f,i,r),this.ir.addPt(n)},Xe.prototype.addOutsideTurn=function(A,t){if(this.ar.p1.distance(this.vr.p0)<this.gi*Xe.OFFSET_SEGMENT_SEPARATION_FACTOR)return this.ir.addPt(this.ar.p1),null;this.rr.getJoinStyle()===qe.JOIN_MITRE?this.addMitreJoin(this.ur,this.ar,this.vr,this.gi):this.rr.getJoinStyle()===qe.JOIN_BEVEL?this.addBevelJoin(this.ar,this.vr):(t&&this.ir.addPt(this.ar.p1),this.addFilletCorner(this.ur,this.ar.p1,this.vr.p0,A,this.gi),this.ir.addPt(this.vr.p0))},Xe.prototype.createSquare=function(A){this.ir.addPt(new mn(A.x+this.gi,A.y+this.gi)),this.ir.addPt(new mn(A.x+this.gi,A.y-this.gi)),this.ir.addPt(new mn(A.x-this.gi,A.y-this.gi)),this.ir.addPt(new mn(A.x-this.gi,A.y+this.gi)),this.ir.closeRing()},Xe.prototype.addSegments=function(A,t){this.ir.addPts(A,t)},Xe.prototype.addFirstSegment=function(){this.ir.addPt(this.vr.p0)},Xe.prototype.addLastSegment=function(){this.ir.addPt(this.vr.p1)},Xe.prototype.initSideSegments=function(A,t,n){this.ur=A,this.or=t,this.lr=n,this.cr.setCoordinates(A,t),this.computeOffsetSegment(this.cr,n,this.gi,this.vr)},Xe.prototype.addLimitedMitreJoin=function(A,t,n,i){var r=this.hr.p1,e=Je.angle(r,this.hr.p0),s=Je.angleBetweenOriented(this.hr.p0,r,this.cr.p1)/2,u=Je.normalize(e+s),o=Je.normalize(u+Math.PI),h=i*n,f=n-h*Math.abs(Math.sin(s)),c=r.x+h*Math.cos(o),a=r.y+h*Math.sin(o),v=new mn(c,a),l=new Ne(r,v),w=l.pointAlongOffset(1,f),P=l.pointAlongOffset(1,-f);this.lr===qr.LEFT?(this.ir.addPt(w),this.ir.addPt(P)):(this.ir.addPt(P),this.ir.addPt(w))},Xe.prototype.computeOffsetSegment=function(A,t,n,i){var r=t===qr.LEFT?1:-1,e=A.p1.x-A.p0.x,s=A.p1.y-A.p0.y,u=Math.sqrt(e*e+s*s),o=r*n*e/u,h=r*n*s/u;i.p0.x=A.p0.x-h,i.p0.y=A.p0.y+o,i.p1.x=A.p1.x-h,i.p1.y=A.p1.y+o},Xe.prototype.addFilletArc=function(A,t,n,i,r){var e=i===hi.CLOCKWISE?-1:1,s=Math.abs(t-n),u=Math.trunc(s/this.tr+.5);if(u<1)return null;for(var o=s/u,h=0,f=new mn;h<s;){var c=t+e*h;f.x=A.x+r*Math.cos(c),f.y=A.y+r*Math.sin(c),this.ir.addPt(f),h+=o}},Xe.prototype.addInsideTurn=function(A,t){if(this.er.computeIntersection(this.ar.p0,this.ar.p1,this.vr.p0,this.vr.p1),this.er.hasIntersection())this.ir.addPt(this.er.getIntersection(0));else if(this.wr=!0,this.ar.p1.distance(this.vr.p0)<this.gi*Xe.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this.ir.addPt(this.ar.p1);else{if(this.ir.addPt(this.ar.p1),this.nr>0){var n=new mn((this.nr*this.ar.p1.x+this.ur.x)/(this.nr+1),(this.nr*this.ar.p1.y+this.ur.y)/(this.nr+1));this.ir.addPt(n);var i=new mn((this.nr*this.vr.p0.x+this.ur.x)/(this.nr+1),(this.nr*this.vr.p0.y+this.ur.y)/(this.nr+1));this.ir.addPt(i)}else this.ir.addPt(this.ur);this.ir.addPt(this.vr.p0)}},Xe.prototype.createCircle=function(A){var t=new mn(A.x+this.gi,A.y);this.ir.addPt(t),this.addFilletArc(A,0,2*Math.PI,-1,this.gi),this.ir.closeRing()},Xe.prototype.addBevelJoin=function(A,t){this.ir.addPt(A.p1),this.ir.addPt(t.p0)},Xe.prototype.init=function(A){this.gi=A,this.Ar=A*(1-Math.cos(this.tr/2)),this.ir=new Ke,this.ir.setPrecisionModel(this.sn),this.ir.setMinimumVertexDistance(A*Xe.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)},Xe.prototype.addCollinear=function(A){this.er.computeIntersection(this.sr,this.ur,this.ur,this.or),this.er.getIntersectionNum()>=2&&(this.rr.getJoinStyle()===qe.JOIN_BEVEL||this.rr.getJoinStyle()===qe.JOIN_MITRE?(A&&this.ir.addPt(this.ar.p1),this.ir.addPt(this.vr.p0)):this.addFilletCorner(this.ur,this.ar.p1,this.vr.p0,hi.CLOCKWISE,this.gi))},Xe.prototype.closeRing=function(){this.ir.closeRing()},Xe.prototype.hasNarrowConcaveAngle=function(){return this.wr},Xe.prototype.interfaces_=function(){return[]},Xe.prototype.getClass=function(){return Xe},$e.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return.001},$e.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return.001},$e.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6},$e.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80},Object.defineProperties(Xe,$e);var As=function(){this.gi=0,this.sn=null,this.rr=null;var A=arguments[0],t=arguments[1];this.sn=A,this.rr=t};As.prototype.getOffsetCurve=function(A,t){if(this.gi=t,0===t)return null;var n=t<0,i=Math.abs(t),r=this.getSegGen(i);A.length<=1?this.computePointCurve(A[0],r):this.computeOffsetCurve(A,n,r);var e=r.getCoordinates();return n&&Ti.reverse(e),e},As.prototype.computeSingleSidedBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this.gi);if(t){n.addSegments(A,!0);var r=We.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],qr.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{n.addSegments(A,!1);var u=We.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],qr.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment(),n.closeRing()},As.prototype.computeRingBufferCurve=function(A,t,n){var i=this.simplifyTolerance(this.gi);t===qr.RIGHT&&(i=-i);var r=We.simplify(A,i),e=r.length-1;n.initSideSegments(r[e-1],r[0],t);for(var s=1;s<=e;s++){n.addNextSegment(r[s],1!==s)}n.closeRing()},As.prototype.computeLineBufferCurve=function(A,t){var n=this.simplifyTolerance(this.gi),i=We.simplify(A,n),r=i.length-1;t.initSideSegments(i[0],i[1],qr.LEFT);for(var e=2;e<=r;e++)t.addNextSegment(i[e],!0);t.addLastSegment(),t.addLineEndCap(i[r-1],i[r]);var s=We.simplify(A,-n),u=s.length-1;t.initSideSegments(s[u],s[u-1],qr.LEFT);for(var o=u-2;o>=0;o--)t.addNextSegment(s[o],!0);t.addLastSegment(),t.addLineEndCap(s[1],s[0]),t.closeRing()},As.prototype.computePointCurve=function(A,t){switch(this.rr.getEndCapStyle()){case qe.CAP_ROUND:t.createCircle(A);break;case qe.CAP_SQUARE:t.createSquare(A)}},As.prototype.getLineCurve=function(A,t){if(this.gi=t,t<0&&!this.rr.isSingleSided())return null;if(0===t)return null;var n=Math.abs(t),i=this.getSegGen(n);if(A.length<=1)this.computePointCurve(A[0],i);else if(this.rr.isSingleSided()){this.computeSingleSidedBufferCurve(A,t<0,i)}else this.computeLineBufferCurve(A,i);return i.getCoordinates()},As.prototype.getBufferParameters=function(){return this.rr},As.prototype.simplifyTolerance=function(A){return A*this.rr.getSimplifyFactor()},As.prototype.getRingCurve=function(A,t,n){if(this.gi=n,A.length<=2)return this.getLineCurve(A,n);if(0===n)return As.copyCoordinates(A);var i=this.getSegGen(n);return this.computeRingBufferCurve(A,t,i),i.getCoordinates()},As.prototype.computeOffsetCurve=function(A,t,n){var i=this.simplifyTolerance(this.gi);if(t){var r=We.simplify(A,-i),e=r.length-1;n.initSideSegments(r[e],r[e-1],qr.LEFT),n.addFirstSegment();for(var s=e-2;s>=0;s--)n.addNextSegment(r[s],!0)}else{var u=We.simplify(A,i),o=u.length-1;n.initSideSegments(u[0],u[1],qr.LEFT),n.addFirstSegment();for(var h=2;h<=o;h++)n.addNextSegment(u[h],!0)}n.addLastSegment()},As.prototype.getSegGen=function(A){return new Xe(this.sn,this.rr,A)},As.prototype.interfaces_=function(){return[]},As.prototype.getClass=function(){return As},As.copyCoordinates=function(A){for(var t=new Array(A.length).fill(null),n=0;n<t.length;n++)t[n]=new mn(A[n]);return t};var ts=function(){this.Pr=null,this.gr=new Ne,this.Cr=new hi;var A=arguments[0];this.Pr=A},ns={DepthSegment:{configurable:!0}};ts.prototype.findStabbedSegments=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=new yi,i=this.Pr.iterator();i.hasNext();){var r=i.next(),e=r.getEnvelope();t.y<e.getMinY()||t.y>e.getMaxY()||A.findStabbedSegments(t,r.getDirectedEdges(),n)}return n}if(3===arguments.length)if(Fn(arguments[2],xi)&&arguments[0]instanceof mn&&arguments[1]instanceof he)for(var s=arguments[0],u=arguments[1],o=arguments[2],h=u.getEdge().getCoordinates(),f=0;f<h.length-1;f++){A.gr.p0=h[f],A.gr.p1=h[f+1],A.gr.p0.y>A.gr.p1.y&&A.gr.reverse();var c=Math.max(A.gr.p0.x,A.gr.p1.x);if(!(c<s.x||A.gr.isHorizontal()||s.y<A.gr.p0.y||s.y>A.gr.p1.y||hi.computeOrientation(A.gr.p0,A.gr.p1,s)===hi.RIGHT)){var a=u.getDepth(qr.LEFT);A.gr.p0.equals(h[f])||(a=u.getDepth(qr.RIGHT));var v=new is(A.gr,a);o.add(v)}}else if(Fn(arguments[2],xi)&&arguments[0]instanceof mn&&Fn(arguments[1],xi))for(var l=arguments[0],w=arguments[1],P=arguments[2],g=w.iterator();g.hasNext();){var C=g.next();C.isForward()&&A.findStabbedSegments(l,C,P)}},ts.prototype.getDepth=function(A){var t=this.findStabbedSegments(A);return 0===t.size()?0:Ie.min(t).Dr},ts.prototype.interfaces_=function(){return[]},ts.prototype.getClass=function(){return ts},ns.DepthSegment.get=function(){return is},Object.defineProperties(ts,ns);var is=function(){this.Ir=null,this.Dr=null;var A=arguments[0],t=arguments[1];this.Ir=new Ne(A),this.Dr=t};is.prototype.compareTo=function(A){var t=A;if(this.Ir.minX()>=t.Ir.maxX())return 1;if(this.Ir.maxX()<=t.Ir.minX())return-1;var n=this.Ir.orientationIndex(t.Ir);return 0!==n||0!=(n=-1*t.Ir.orientationIndex(this.Ir))?n:this.Ir.compareTo(t.Ir)},is.prototype.compareX=function(A,t){var n=A.p0.compareTo(t.p0);return 0!==n?n:A.p1.compareTo(t.p1)},is.prototype.toString=function(){return this.Ir.toString()},is.prototype.interfaces_=function(){return[bn]},is.prototype.getClass=function(){return is};var rs=function(A,t,n){this.p0=A||null,this.p1=t||null,this.p2=n||null};rs.prototype.area=function(){return rs.area(this.p0,this.p1,this.p2)},rs.prototype.signedArea=function(){return rs.signedArea(this.p0,this.p1,this.p2)},rs.prototype.interpolateZ=function(A){if(null===A)throw new Dn("Supplied point is null.");return rs.interpolateZ(A,this.p0,this.p1,this.p2)},rs.prototype.longestSideLength=function(){return rs.longestSideLength(this.p0,this.p1,this.p2)},rs.prototype.isAcute=function(){return rs.isAcute(this.p0,this.p1,this.p2)},rs.prototype.circumcentre=function(){return rs.circumcentre(this.p0,this.p1,this.p2)},rs.prototype.area3D=function(){return rs.area3D(this.p0,this.p1,this.p2)},rs.prototype.centroid=function(){return rs.centroid(this.p0,this.p1,this.p2)},rs.prototype.inCentre=function(){return rs.inCentre(this.p0,this.p1,this.p2)},rs.prototype.interfaces_=function(){return[]},rs.prototype.getClass=function(){return rs},rs.area=function(A,t,n){return Math.abs(((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2)},rs.signedArea=function(A,t,n){return((n.x-A.x)*(t.y-A.y)-(t.x-A.x)*(n.y-A.y))/2},rs.det=function(A,t,n,i){return A*i-t*n},rs.interpolateZ=function(A,t,n,i){var r=t.x,e=t.y,s=n.x-r,u=i.x-r,o=n.y-e,h=i.y-e,f=s*h-u*o,c=A.x-r,a=A.y-e;return t.z+(h*c-u*a)/f*(n.z-t.z)+(-o*c+s*a)/f*(i.z-t.z)},rs.longestSideLength=function(A,t,n){var i=A.distance(t),r=t.distance(n),e=n.distance(A),s=i;return r>s&&(s=r),e>s&&(s=e),s},rs.isAcute=function(A,t,n){return!!Je.isAcute(A,t,n)&&!!Je.isAcute(t,n,A)&&!!Je.isAcute(n,A,t)},rs.circumcentre=function(A,t,n){var i=n.x,r=n.y,e=A.x-i,s=A.y-r,u=t.x-i,o=t.y-r,h=2*rs.det(e,s,u,o),f=rs.det(s,e*e+s*s,o,u*u+o*o),c=rs.det(e,e*e+s*s,u,u*u+o*o);return new mn(i-f/h,r+c/h)},rs.perpendicularBisector=function(A,t){var n=t.x-A.x,i=t.y-A.y,r=new _n(A.x+n/2,A.y+i/2,1),e=new _n(A.x-i+n/2,A.y+n+i/2,1);return new _n(r,e)},rs.angleBisector=function(A,t,n){var i=t.distance(A),r=i/(i+t.distance(n));return new mn(A.x+r*(n.x-A.x),A.y+r*(n.y-A.y))},rs.area3D=function(A,t,n){var i=t.x-A.x,r=t.y-A.y,e=t.z-A.z,s=n.x-A.x,u=n.y-A.y,o=n.z-A.z,h=r*o-e*u,f=e*s-i*o,c=i*u-r*s;return Math.sqrt(h*h+f*f+c*c)/2},rs.centroid=function(A,t,n){return new mn((A.x+t.x+n.x)/3,(A.y+t.y+n.y)/3)},rs.inCentre=function(A,t,n){var i=t.distance(n),r=A.distance(n),e=A.distance(t),s=i+r+e;return new mn((i*A.x+r*t.x+e*n.x)/s,(i*A.y+r*t.y+e*n.y)/s)};var es=function(){this.Mr=null,this.gi=null,this.br=null,this.zr=new yi;var A=arguments[0],t=arguments[1],n=arguments[2];this.Mr=A,this.gi=t,this.br=n};es.prototype.addPoint=function(A){if(this.gi<=0)return null;var t=A.getCoordinates(),n=this.br.getLineCurve(t,this.gi);this.addCurve(n,Tn.EXTERIOR,Tn.INTERIOR)},es.prototype.addPolygon=function(A){var t=this.gi,n=qr.LEFT;this.gi<0&&(t=-this.gi,n=qr.RIGHT);var i=A.getExteriorRing(),r=Ti.removeRepeatedPoints(i.getCoordinates());if(this.gi<0&&this.isErodedCompletely(i,this.gi))return null;if(this.gi<=0&&r.length<3)return null;this.addPolygonRing(r,t,n,Tn.EXTERIOR,Tn.INTERIOR);for(var e=0;e<A.getNumInteriorRing();e++){var s=A.getInteriorRingN(e),u=Ti.removeRepeatedPoints(s.getCoordinates());this.gi>0&&this.isErodedCompletely(s,-this.gi)||this.addPolygonRing(u,t,qr.opposite(n),Tn.INTERIOR,Tn.EXTERIOR)}},es.prototype.isTriangleErodedCompletely=function(A,t){var n=new rs(A[0],A[1],A[2]),i=n.inCentre();return hi.distancePointLine(i,n.p0,n.p1)<Math.abs(t)},es.prototype.addLineString=function(A){if(this.gi<=0&&!this.br.getBufferParameters().isSingleSided())return null;var t=Ti.removeRepeatedPoints(A.getCoordinates()),n=this.br.getLineCurve(t,this.gi);this.addCurve(n,Tn.EXTERIOR,Tn.INTERIOR)},es.prototype.addCurve=function(A,t,n){if(null===A||A.length<2)return null;var i=new Ee(A,new $r(0,Tn.BOUNDARY,t,n));this.zr.add(i)},es.prototype.getCurves=function(){return this.add(this.Mr),this.zr},es.prototype.addPolygonRing=function(A,t,n,i,r){if(0===t&&A.length<Ir.MINIMUM_VALID_SIZE)return null;var e=i,s=r;A.length>=Ir.MINIMUM_VALID_SIZE&&hi.isCCW(A)&&(e=r,s=i,n=qr.opposite(n));var u=this.br.getRingCurve(A,n,t);this.addCurve(u,e,s)},es.prototype.add=function(A){if(A.isEmpty())return null;A instanceof Cr?this.addPolygon(A):A instanceof lr?this.addLineString(A):A instanceof Pr?this.addPoint(A):(A instanceof Dr||A instanceof nr||A instanceof Mr||A instanceof tr)&&this.addCollection(A)},es.prototype.isErodedCompletely=function(A,t){var n=A.getCoordinates();if(n.length<4)return t<0;if(4===n.length)return this.isTriangleErodedCompletely(n,t);var i=A.getEnvelopeInternal(),r=Math.min(i.getHeight(),i.getWidth());return t<0&&2*Math.abs(t)>r},es.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},es.prototype.interfaces_=function(){return[]},es.prototype.getClass=function(){return es};var ss=function(){};ss.prototype.locate=function(A){},ss.prototype.interfaces_=function(){return[]},ss.prototype.getClass=function(){return ss};var us=function(){this.dr=null,this.xr=null,this.mr=null,this.Qi=null,this.yr=null;var A=arguments[0];this.dr=A,this.xr=!0,this.Qi=0,this.mr=A.getNumGeometries()};us.prototype.next=function(){if(this.xr)return this.xr=!1,us.isAtomic(this.dr)&&this.Qi++,this.dr;if(null!==this.yr){if(this.yr.hasNext())return this.yr.next();this.yr=null}if(this.Qi>=this.mr)throw new mi;var A=this.dr.getGeometryN(this.Qi++);return A instanceof tr?(this.yr=new us(A),this.yr.next()):A},us.prototype.remove=function(){throw new Error(this.getClass().getName())},us.prototype.hasNext=function(){if(this.xr)return!0;if(null!==this.yr){if(this.yr.hasNext())return!0;this.yr=null}return!(this.Qi>=this.mr)},us.prototype.interfaces_=function(){return[di]},us.prototype.getClass=function(){return us},us.isAtomic=function(A){return!(A instanceof tr)};var os=function(){this.Pn=null;var A=arguments[0];this.Pn=A};os.prototype.locate=function(A){return os.locate(A,this.Pn)},os.prototype.interfaces_=function(){return[ss]},os.prototype.getClass=function(){return os},os.isPointInRing=function(A,t){return!!t.getEnvelopeInternal().intersects(A)&&hi.isPointInRing(A,t.getCoordinates())},os.containsPointInPolygon=function(A,t){if(t.isEmpty())return!1;var n=t.getExteriorRing();if(!os.isPointInRing(A,n))return!1;for(var i=0;i<t.getNumInteriorRing();i++){var r=t.getInteriorRingN(i);if(os.isPointInRing(A,r))return!1}return!0},os.containsPoint=function(A,t){if(t instanceof Cr)return os.containsPointInPolygon(A,t);if(t instanceof tr)for(var n=new us(t);n.hasNext();){var i=n.next();if(i!==t&&os.containsPoint(A,i))return!0}return!1},os.locate=function(A,t){return t.isEmpty()?Tn.EXTERIOR:os.containsPoint(A,t)?Tn.INTERIOR:Tn.EXTERIOR};var hs=function(){this.pr=new Vi,this.Lr=null,this.Tr=[Tn.NONE,Tn.NONE]};hs.prototype.getNextCW=function(A){this.getEdges();var t=this.Lr.indexOf(A),n=t-1;return 0===t&&(n=this.Lr.size()-1),this.Lr.get(n)},hs.prototype.propagateSideLabels=function(A){for(var t=Tn.NONE,n=this.iterator();n.hasNext();){var i=n.next().getLabel();i.isArea(A)&&i.getLocation(A,qr.LEFT)!==Tn.NONE&&(t=i.getLocation(A,qr.LEFT))}if(t===Tn.NONE)return null;for(var r=t,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getLabel();if(u.getLocation(A,qr.ON)===Tn.NONE&&u.setLocation(A,qr.ON,r),u.isArea(A)){var o=u.getLocation(A,qr.LEFT),h=u.getLocation(A,qr.RIGHT);if(h!==Tn.NONE){if(h!==r)throw new Hr("side location conflict",s.getCoordinate());o===Tn.NONE&&ii.shouldNeverReachHere("found single null side (at "+s.getCoordinate()+")"),r=o}else ii.isTrue(u.getLocation(A,qr.LEFT)===Tn.NONE,"found single null side"),u.setLocation(A,qr.RIGHT,r),u.setLocation(A,qr.LEFT,r)}}},hs.prototype.getCoordinate=function(){var A=this.iterator();return A.hasNext()?A.next().getCoordinate():null},hs.prototype.print=function(A){Wn.out.println("EdgeEndStar:   "+this.getCoordinate());for(var t=this.iterator();t.hasNext();)t.next().print(A)},hs.prototype.isAreaLabelsConsistent=function(A){return this.computeEdgeEndLabels(A.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)},hs.prototype.checkAreaLabelsConsistent=function(A){var t=this.getEdges();if(t.size()<=0)return!0;var n=t.size()-1,i=t.get(n).getLabel().getLocation(A,qr.LEFT);ii.isTrue(i!==Tn.NONE,"Found unlabelled area edge");for(var r=i,e=this.iterator();e.hasNext();){var s=e.next().getLabel();ii.isTrue(s.isArea(A),"Found non-area edge");var u=s.getLocation(A,qr.LEFT),o=s.getLocation(A,qr.RIGHT);if(u===o)return!1;if(o!==r)return!1;r=u}return!0},hs.prototype.findIndex=function(A){this.iterator();for(var t=0;t<this.Lr.size();t++)if(this.Lr.get(t)===A)return t;return-1},hs.prototype.iterator=function(){return this.getEdges().iterator()},hs.prototype.getEdges=function(){return null===this.Lr&&(this.Lr=new yi(this.pr.values())),this.Lr},hs.prototype.getLocation=function(A,t,n){return this.Tr[A]===Tn.NONE&&(this.Tr[A]=os.locate(t,n[A].getGeometry())),this.Tr[A]},hs.prototype.toString=function(){var A=new Nn;A.append("EdgeEndStar:   "+this.getCoordinate()),A.append("\n");for(var t=this.iterator();t.hasNext();){var n=t.next();A.append(n),A.append("\n")}return A.toString()},hs.prototype.computeEdgeEndLabels=function(A){for(var t=this.iterator();t.hasNext();)t.next().computeLabel(A)},hs.prototype.computeLabelling=function(A){this.computeEdgeEndLabels(A[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var t=[!1,!1],n=this.iterator();n.hasNext();)for(var i=n.next().getLabel(),r=0;r<2;r++)i.isLine(r)&&i.getLocation(r)===Tn.BOUNDARY&&(t[r]=!0);for(var e=this.iterator();e.hasNext();)for(var s=e.next(),u=s.getLabel(),o=0;o<2;o++)if(u.isAnyNull(o)){var h=Tn.NONE;if(t[o])h=Tn.EXTERIOR;else{var f=s.getCoordinate();h=this.getLocation(o,f,A)}u.setAllLocationsIfNull(o,h)}},hs.prototype.getDegree=function(){return this.pr.size()},hs.prototype.insertEdgeEnd=function(A,t){this.pr.put(A,t),this.Lr=null},hs.prototype.interfaces_=function(){return[]},hs.prototype.getClass=function(){return hs};var fs=function(A){function t(){A.call(this),this.Or=null,this.Sn=null,this.Fr=1,this.Ur=2}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.linkResultDirectedEdges=function(){this.getResultAreaEdges();for(var A=null,t=null,n=this.Fr,i=0;i<this.Or.size();i++){var r=this.Or.get(i),e=r.getSym();if(r.getLabel().isArea())switch(null===A&&r.isInResult()&&(A=r),n){case this.Fr:if(!e.isInResult())continue;t=e,n=this.Ur;break;case this.Ur:if(!r.isInResult())continue;t.setNext(r),n=this.Fr}}if(n===this.Ur){if(null===A)throw new Hr("no outgoing dirEdge found",this.getCoordinate());ii.isTrue(A.isInResult(),"unable to link last incoming dirEdge"),t.setNext(A)}},t.prototype.insert=function(A){this.insertEdgeEnd(A,A)},t.prototype.getRightmostEdge=function(){var A=this.getEdges(),t=A.size();if(t<1)return null;var n=A.get(0);if(1===t)return n;var i=A.get(t-1),r=n.getQuadrant(),e=i.getQuadrant();return se.isNorthern(r)&&se.isNorthern(e)?n:se.isNorthern(r)||se.isNorthern(e)?0!==n.getDy()?n:0!==i.getDy()?i:(ii.shouldNeverReachHere("found two horizontal edges incident on node"),null):i},t.prototype.print=function(A){Wn.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var t=this.iterator();t.hasNext();){var n=t.next();A.print("out "),n.print(A),A.println(),A.print("in "),n.getSym().print(A),A.println()}},t.prototype.getResultAreaEdges=function(){if(null!==this.Or)return this.Or;this.Or=new yi;for(var A=this.iterator();A.hasNext();){var t=A.next();(t.isInResult()||t.getSym().isInResult())&&this.Or.add(t)}return this.Or},t.prototype.updateLabelling=function(A){for(var t=this.iterator();t.hasNext();){var n=t.next().getLabel();n.setAllLocationsIfNull(0,A.getLocation(0)),n.setAllLocationsIfNull(1,A.getLocation(1))}},t.prototype.linkAllDirectedEdges=function(){this.getEdges();for(var A=null,t=null,n=this.Lr.size()-1;n>=0;n--){var i=this.Lr.get(n),r=i.getSym();null===t&&(t=r),null!==A&&r.setNext(A),A=i}t.setNext(A)},t.prototype.computeDepths=function(){var A=this;if(1===arguments.length){var t=arguments[0],n=this.findIndex(t),i=t.getDepth(qr.LEFT),r=t.getDepth(qr.RIGHT),e=this.computeDepths(n+1,this.Lr.size(),i),s=this.computeDepths(0,n,e);if(s!==r)throw new Hr("depth mismatch at "+t.getCoordinate())}else if(3===arguments.length){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=h,c=u;c<o;c++){var a=A.Lr.get(c);a.setEdgeDepths(qr.RIGHT,f),f=a.getDepth(qr.LEFT)}return f}},t.prototype.mergeSymLabels=function(){for(var A=this.iterator();A.hasNext();){var t=A.next();t.getLabel().merge(t.getSym().getLabel())}},t.prototype.linkMinimalDirectedEdges=function(A){for(var t=null,n=null,i=this.Fr,r=this.Or.size()-1;r>=0;r--){var e=this.Or.get(r),s=e.getSym();switch(null===t&&e.getEdgeRing()===A&&(t=e),i){case this.Fr:if(s.getEdgeRing()!==A)continue;n=s,i=this.Ur;break;case this.Ur:if(e.getEdgeRing()!==A)continue;n.setNextMin(e),i=this.Fr}}i===this.Ur&&(ii.isTrue(null!==t,"found null for first outgoing dirEdge"),ii.isTrue(t.getEdgeRing()===A,"unable to link last incoming dirEdge"),n.setNextMin(t))},t.prototype.getOutgoingDegree=function(){if(0===arguments.length){for(var A=0,t=this.iterator();t.hasNext();){var n=t.next();n.isInResult()&&A++}return A}if(1===arguments.length){for(var i=arguments[0],r=0,e=this.iterator();e.hasNext();){var s=e.next();s.getEdgeRing()===i&&r++}return r}},t.prototype.getLabel=function(){return this.Sn},t.prototype.findCoveredLineEdges=function(){for(var A=Tn.NONE,t=this.iterator();t.hasNext();){var n=t.next(),i=n.getSym();if(!n.isLineEdge()){if(n.isInResult()){A=Tn.INTERIOR;break}if(i.isInResult()){A=Tn.EXTERIOR;break}}}if(A===Tn.NONE)return null;for(var r=A,e=this.iterator();e.hasNext();){var s=e.next(),u=s.getSym();s.isLineEdge()?s.getEdge().setCovered(r===Tn.INTERIOR):(s.isInResult()&&(r=Tn.EXTERIOR),u.isInResult()&&(r=Tn.INTERIOR))}},t.prototype.computeLabelling=function(t){A.prototype.computeLabelling.call(this,t),this.Sn=new $r(Tn.NONE);for(var n=this.iterator();n.hasNext();)for(var i=n.next().getEdge().getLabel(),r=0;r<2;r++){var e=i.getLocation(r);e!==Tn.INTERIOR&&e!==Tn.BOUNDARY||this.Sn.setLocation(r,Tn.INTERIOR)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(hs),cs=function(A){function t(){A.apply(this,arguments)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.createNode=function(A){return new re(A,new fs)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(fe),as=function A(){this.Qn=null,this.Er=null;var t=arguments[0];this.Qn=t,this.Er=A.orientation(t)};as.prototype.compareTo=function(A){return as.compareOriented(this.Qn,this.Er,A.Qn,A.Er)},as.prototype.interfaces_=function(){return[bn]},as.prototype.getClass=function(){return as},as.orientation=function(A){return 1===Ti.increasingDirection(A)},as.compareOriented=function(A,t,n,i){for(var r=t?1:-1,e=i?1:-1,s=t?A.length:-1,u=i?n.length:-1,o=t?0:A.length-1,h=i?0:n.length-1;;){var f=A[o].compareTo(n[h]);if(0!==f)return f;var c=(o+=r)===s,a=(h+=e)===u;if(c&&!a)return-1;if(!c&&a)return 1;if(c&&a)return 0}};var vs=function(){this.jn=new yi,this.Nr=new Vi};vs.prototype.print=function(A){A.print("MULTILINESTRING ( ");for(var t=0;t<this.jn.size();t++){var n=this.jn.get(t);t>0&&A.print(","),A.print("(");for(var i=n.getCoordinates(),r=0;r<i.length;r++)r>0&&A.print(","),A.print(i[r].x+" "+i[r].y);A.println(")")}A.print(")  ")},vs.prototype.addAll=function(A){for(var t=A.iterator();t.hasNext();)this.add(t.next())},vs.prototype.findEdgeIndex=function(A){for(var t=0;t<this.jn.size();t++)if(this.jn.get(t).equals(A))return t;return-1},vs.prototype.iterator=function(){return this.jn.iterator()},vs.prototype.getEdges=function(){return this.jn},vs.prototype.get=function(A){return this.jn.get(A)},vs.prototype.findEqualEdge=function(A){var t=new as(A.getCoordinates());return this.Nr.get(t)},vs.prototype.add=function(A){this.jn.add(A);var t=new as(A.getCoordinates());this.Nr.put(t,A)},vs.prototype.interfaces_=function(){return[]},vs.prototype.getClass=function(){return vs};var ls=function(){};ls.prototype.processIntersections=function(A,t,n,i){},ls.prototype.isDone=function(){},ls.prototype.interfaces_=function(){return[]},ls.prototype.getClass=function(){return ls};var ws=function(){this.jr=!1,this.Qr=!1,this.Sr=!1,this.kr=!1,this.Br=null,this.er=null,this.Rr=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var A=arguments[0];this.er=A};ws.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.er.getIntersectionNum()){if(ws.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.size()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},ws.prototype.getProperIntersectionPoint=function(){return this.Br},ws.prototype.hasProperInteriorIntersection=function(){return this.Sr},ws.prototype.getLineIntersector=function(){return this.er},ws.prototype.hasProperIntersection=function(){return this.Qr},ws.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.er.computeIntersection(r,e,s,u),this.er.hasIntersection()&&(this.numIntersections++,this.er.isInteriorIntersection()&&(this.numInteriorIntersections++,this.kr=!0),this.isTrivialIntersection(A,t,n,i)||(this.jr=!0,A.addIntersections(this.er,t,0),n.addIntersections(this.er,i,1),this.er.isProper()&&(this.numProperIntersections++,this.Qr=!0,this.Sr=!0)))},ws.prototype.hasIntersection=function(){return this.jr},ws.prototype.isDone=function(){return!1},ws.prototype.hasInteriorIntersection=function(){return this.kr},ws.prototype.interfaces_=function(){return[ls]},ws.prototype.getClass=function(){return ws},ws.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var Ps=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var A=arguments[0],t=arguments[1],n=arguments[2];this.coord=new mn(A),this.segmentIndex=t,this.dist=n};Ps.prototype.getSegmentIndex=function(){return this.segmentIndex},Ps.prototype.getCoordinate=function(){return this.coord},Ps.prototype.print=function(A){A.print(this.coord),A.print(" seg # = "+this.segmentIndex),A.println(" dist = "+this.dist)},Ps.prototype.compareTo=function(A){return this.compare(A.segmentIndex,A.dist)},Ps.prototype.isEndPoint=function(A){return 0===this.segmentIndex&&0===this.dist||this.segmentIndex===A},Ps.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist},Ps.prototype.getDistance=function(){return this.dist},Ps.prototype.compare=function(A,t){return this.segmentIndex<A?-1:this.segmentIndex>A?1:this.dist<t?-1:this.dist>t?1:0},Ps.prototype.interfaces_=function(){return[bn]},Ps.prototype.getClass=function(){return Ps};var gs=function(){this.mi=new Vi,this.edge=null;var A=arguments[0];this.edge=A};gs.prototype.print=function(A){A.println("Intersections:");for(var t=this.iterator();t.hasNext();)t.next().print(A)},gs.prototype.iterator=function(){return this.mi.values().iterator()},gs.prototype.addSplitEdges=function(A){this.addEndpoints();for(var t=this.iterator(),n=t.next();t.hasNext();){var i=t.next(),r=this.createSplitEdge(n,i);A.add(r),n=i}},gs.prototype.addEndpoints=function(){var A=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[A],A,0)},gs.prototype.createSplitEdge=function(A,t){var n=t.segmentIndex-A.segmentIndex+2,r=t.dist>0||!t.coord.equals2D(this.edge.pts[t.segmentIndex]);r||n--;var e=new Array(n).fill(null),s=0;e[s++]=new mn(A.coord);for(var u=A.segmentIndex+1;u<=t.segmentIndex;u++)e[s++]=this.edge.pts[u];return r&&(e[s]=t.coord),new bs(e,new $r(this.edge.Sn))},gs.prototype.add=function(A,t,n){var i=new Ps(A,t,n),r=this.mi.get(i);return null!==r?r:(this.mi.put(i,i),i)},gs.prototype.isIntersection=function(A){for(var t=this.iterator();t.hasNext();)if(t.next().coord.equals(A))return!0;return!1},gs.prototype.interfaces_=function(){return[]},gs.prototype.getClass=function(){return gs};var Cs=function(){};Cs.prototype.getChainStartIndices=function(A){var t=0,n=new yi;n.add(new jn(t));do{var i=this.findChainEnd(A,t);n.add(new jn(i)),t=i}while(t<A.length-1);return Cs.toIntArray(n)},Cs.prototype.findChainEnd=function(A,t){for(var n=se.quadrant(A[t],A[t+1]),i=t+1;i<A.length&&se.quadrant(A[i-1],A[i])===n;)i++;return i-1},Cs.prototype.interfaces_=function(){return[]},Cs.prototype.getClass=function(){return Cs},Cs.toIntArray=function(A){for(var t=new Array(A.size()).fill(null),n=0;n<t.length;n++)t[n]=A.get(n).intValue();return t};var Ds=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new Kn,this.env2=new Kn;var A=arguments[0];this.e=A,this.pts=A.getCoordinates();var t=new Cs;this.startIndex=t.getChainStartIndices(this.pts)};Ds.prototype.getCoordinates=function(){return this.pts},Ds.prototype.getMaxX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t>n?t:n},Ds.prototype.getMinX=function(A){var t=this.pts[this.startIndex[A]].x,n=this.pts[this.startIndex[A+1]].x;return t<n?t:n},Ds.prototype.computeIntersectsForChain=function(){if(4===arguments.length){var A=arguments[0],t=arguments[1],n=arguments[2],i=arguments[3];this.computeIntersectsForChain(this.startIndex[A],this.startIndex[A+1],t,t.startIndex[n],t.startIndex[n+1],i)}else if(6===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2],u=arguments[3],o=arguments[4],h=arguments[5],f=this.pts[r],c=this.pts[e],a=s.pts[u],v=s.pts[o];if(e-r==1&&o-u==1)return h.addIntersections(this.e,r,s.e,u),null;if(this.env1.init(f,c),this.env2.init(a,v),!this.env1.intersects(this.env2))return null;var l=Math.trunc((r+e)/2),w=Math.trunc((u+o)/2);r<l&&(u<w&&this.computeIntersectsForChain(r,l,s,u,w,h),w<o&&this.computeIntersectsForChain(r,l,s,w,o,h)),l<e&&(u<w&&this.computeIntersectsForChain(l,e,s,u,w,h),w<o&&this.computeIntersectsForChain(l,e,s,w,o,h))}},Ds.prototype.getStartIndexes=function(){return this.startIndex},Ds.prototype.computeIntersects=function(A,t){for(var n=0;n<this.startIndex.length-1;n++)for(var i=0;i<A.startIndex.length-1;i++)this.computeIntersectsForChain(n,A,i,t)},Ds.prototype.interfaces_=function(){return[]},Ds.prototype.getClass=function(){return Ds};var Is=function A(){this.si=Array(2).fill().map((function(){return Array(3)}));for(var t=0;t<2;t++)for(var n=0;n<3;n++)this.si[t][n]=A.NULL_VALUE},Ms={NULL_VALUE:{configurable:!0}};Is.prototype.getDepth=function(A,t){return this.si[A][t]},Is.prototype.setDepth=function(A,t,n){this.si[A][t]=n},Is.prototype.isNull=function(){var A=this;if(0===arguments.length){for(var t=0;t<2;t++)for(var n=0;n<3;n++)if(A.si[t][n]!==Is.NULL_VALUE)return!1;return!0}if(1===arguments.length){var i=arguments[0];return this.si[i][1]===Is.NULL_VALUE}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.si[r][e]===Is.NULL_VALUE}},Is.prototype.normalize=function(){for(var A=0;A<2;A++)if(!this.isNull(A)){var t=this.si[A][1];this.si[A][2]<t&&(t=this.si[A][2]),t<0&&(t=0);for(var n=1;n<3;n++){var i=0;this.si[A][n]>t&&(i=1),this.si[A][n]=i}}},Is.prototype.getDelta=function(A){return this.si[A][qr.RIGHT]-this.si[A][qr.LEFT]},Is.prototype.getLocation=function(A,t){return this.si[A][t]<=0?Tn.EXTERIOR:Tn.INTERIOR},Is.prototype.toString=function(){return"A: "+this.si[0][1]+","+this.si[0][2]+" B: "+this.si[1][1]+","+this.si[1][2]},Is.prototype.add=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=0;n<2;n++)for(var i=1;i<3;i++){var r=t.getLocation(n,i);r!==Tn.EXTERIOR&&r!==Tn.INTERIOR||(A.isNull(n,i)?A.si[n][i]=Is.depthAtLocation(r):A.si[n][i]+=Is.depthAtLocation(r))}else if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2];u===Tn.INTERIOR&&this.si[e][s]++}},Is.prototype.interfaces_=function(){return[]},Is.prototype.getClass=function(){return Is},Is.depthAtLocation=function(A){return A===Tn.EXTERIOR?0:A===Tn.INTERIOR?1:Is.NULL_VALUE},Ms.NULL_VALUE.get=function(){return-1},Object.defineProperties(Is,Ms);var bs=function(A){function t(){if(A.call(this),this.pts=null,this.Un=null,this.eiList=new gs(this),this.zn=null,this.Gr=null,this.Yr=!0,this.si=new Is,this.qr=0,1===arguments.length){var n=arguments[0];t.call(this,n,null)}else if(2===arguments.length){var i=arguments[0],r=arguments[1];this.pts=i,this.Sn=r}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.getDepth=function(){return this.si},t.prototype.getCollapsedEdge=function(){var A=new Array(2).fill(null);return A[0]=this.pts[0],A[1]=this.pts[1],new t(A,$r.toLineLabel(this.Sn))},t.prototype.isIsolated=function(){return this.Yr},t.prototype.getCoordinates=function(){return this.pts},t.prototype.setIsolated=function(A){this.Yr=A},t.prototype.setName=function(A){this.zn=A},t.prototype.equals=function(A){if(!(A instanceof t))return!1;var n=A;if(this.pts.length!==n.pts.length)return!1;for(var i=!0,r=!0,e=this.pts.length,s=0;s<this.pts.length;s++)if(this.pts[s].equals2D(n.pts[s])||(i=!1),this.pts[s].equals2D(n.pts[--e])||(r=!1),!i&&!r)return!1;return!0},t.prototype.getCoordinate=function(){if(0===arguments.length)return this.pts.length>0?this.pts[0]:null;if(1===arguments.length){var A=arguments[0];return this.pts[A]}},t.prototype.print=function(A){A.print("edge "+this.zn+": "),A.print("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.print(","),A.print(this.pts[t].x+" "+this.pts[t].y);A.print(")  "+this.Sn+" "+this.qr)},t.prototype.computeIM=function(A){t.updateIM(this.Sn,A)},t.prototype.isCollapsed=function(){return!!this.Sn.isArea()&&3===this.pts.length&&!!this.pts[0].equals(this.pts[2])},t.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},t.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},t.prototype.getDepthDelta=function(){return this.qr},t.prototype.getNumPoints=function(){return this.pts.length},t.prototype.printReverse=function(A){A.print("edge "+this.zn+": ");for(var t=this.pts.length-1;t>=0;t--)A.print(this.pts[t]+" ");A.println("")},t.prototype.getMonotoneChainEdge=function(){return null===this.Gr&&(this.Gr=new Ds(this)),this.Gr},t.prototype.getEnvelope=function(){if(null===this.Un){this.Un=new Kn;for(var A=0;A<this.pts.length;A++)this.Un.expandToInclude(this.pts[A])}return this.Un},t.prototype.addIntersection=function(A,t,n,i){var r=new mn(A.getIntersection(i)),e=t,s=A.getEdgeDistance(n,i),u=e+1;u<this.pts.length&&(r.equals2D(this.pts[u])&&(e=u,s=0));this.eiList.add(r,e,s)},t.prototype.toString=function(){var A=new Nn;A.append("edge "+this.zn+": "),A.append("LINESTRING (");for(var t=0;t<this.pts.length;t++)t>0&&A.append(","),A.append(this.pts[t].x+" "+this.pts[t].y);return A.append(")  "+this.Sn+" "+this.qr),A.toString()},t.prototype.isPointwiseEqual=function(A){if(this.pts.length!==A.pts.length)return!1;for(var t=0;t<this.pts.length;t++)if(!this.pts[t].equals2D(A.pts[t]))return!1;return!0},t.prototype.setDepthDelta=function(A){this.qr=A},t.prototype.getEdgeIntersectionList=function(){return this.eiList},t.prototype.addIntersections=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++)this.addIntersection(A,t,n,i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.updateIM=function(){if(2!==arguments.length)return A.prototype.updateIM.apply(this,arguments);var t=arguments[0],n=arguments[1];n.setAtLeastIfValid(t.getLocation(0,qr.ON),t.getLocation(1,qr.ON),1),t.isArea()&&(n.setAtLeastIfValid(t.getLocation(0,qr.LEFT),t.getLocation(1,qr.LEFT),2),n.setAtLeastIfValid(t.getLocation(0,qr.RIGHT),t.getLocation(1,qr.RIGHT),2))},t}(ie),zs=function(A){this.Vr=null,this.Wr=null,this.gn=null,this._r=null,this.Lr=new vs,this.rr=A||null};zs.prototype.setWorkingPrecisionModel=function(A){this.Vr=A},zs.prototype.insertUniqueEdge=function(A){var t=this.Lr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new $r(A.getLabel())).flip(),n.merge(i);var r=zs.depthDelta(i),e=t.getDepthDelta()+r;t.setDepthDelta(e)}else this.Lr.add(A),A.setDepthDelta(zs.depthDelta(A.getLabel()))},zs.prototype.buildSubgraphs=function(A,t){for(var n=new yi,i=A.iterator();i.hasNext();){var r=i.next(),e=r.getRightmostCoordinate(),s=new ts(n).getDepth(e);r.computeDepth(s),r.findResultEdges(),n.add(r),t.add(r.getDirectedEdges(),r.getNodes())}},zs.prototype.createSubgraphs=function(A){for(var t=new yi,n=A.getNodes().iterator();n.hasNext();){var i=n.next();if(!i.isVisited()){var r=new Zr;r.create(i),t.add(r)}}return Ie.sort(t,Ie.reverseOrder()),t},zs.prototype.createEmptyResultGeometry=function(){return this.gn.createPolygon()},zs.prototype.getNoder=function(A){if(null!==this.Wr)return this.Wr;var t=new Ge,n=new si;return n.setPrecisionModel(A),t.setSegmentIntersector(new ws(n)),t},zs.prototype.buffer=function(A,t){var n=this.Vr;null===n&&(n=A.getPrecisionModel()),this.gn=A.getFactory();var i=new As(n,this.rr),r=new es(A,t,i).getCurves();if(r.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(r,n),this._r=new ce(new cs),this._r.addEdges(this.Lr.getEdges());var e=this.createSubgraphs(this._r),s=new ae(this.gn);this.buildSubgraphs(e,s);var u=s.getPolygons();return u.size()<=0?this.createEmptyResultGeometry():this.gn.buildGeometry(u)},zs.prototype.computeNodedEdges=function(A,t){var n=this.getNoder(t);n.computeNodes(A);for(var i=n.getNodedSubstrings().iterator();i.hasNext();){var r=i.next(),e=r.getCoordinates();if(2!==e.length||!e[0].equals2D(e[1])){var s=r.getData(),u=new bs(r.getCoordinates(),new $r(s));this.insertUniqueEdge(u)}}},zs.prototype.setNoder=function(A){this.Wr=A},zs.prototype.interfaces_=function(){return[]},zs.prototype.getClass=function(){return zs},zs.depthDelta=function(A){var t=A.getLocation(0,qr.LEFT),n=A.getLocation(0,qr.RIGHT);return t===Tn.INTERIOR&&n===Tn.EXTERIOR?1:t===Tn.EXTERIOR&&n===Tn.INTERIOR?-1:0},zs.convertSegStrings=function(A){for(var t=new jr,n=new yi;A.hasNext();){var i=A.next(),r=t.createLineString(i.getCoordinates());n.add(r)}return t.buildGeometry(n)};var ds=function(){if(this.Kr=null,this.Hr=null,this.Jr=null,this.Zr=null,this.Xr=!1,2===arguments.length){var A=arguments[0],t=arguments[1];this.Kr=A,this.Hr=t,this.Jr=0,this.Zr=0,this.Xr=!this.isIntegerPrecision()}else if(4===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=arguments[3];this.Kr=n,this.Hr=i,this.Jr=r,this.Zr=e,this.Xr=!this.isIntegerPrecision()}};ds.prototype.rescale=function(){var A=this;if(Fn(arguments[0],bi))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.rescale(i.getCoordinates())}else if(arguments[0]instanceof Array){for(var r=arguments[0],e=0;e<r.length;e++)r[e].x=r[e].x/A.Hr+A.Jr,r[e].y=r[e].y/A.Hr+A.Zr;2===r.length&&r[0].equals2D(r[1])&&Wn.out.println(r)}},ds.prototype.scale=function(){var A=this;if(Fn(arguments[0],bi)){for(var t=arguments[0],n=new yi,i=t.iterator();i.hasNext();){var r=i.next();n.add(new Ee(A.scale(r.getCoordinates()),r.getData()))}return n}if(arguments[0]instanceof Array){for(var e=arguments[0],s=new Array(e.length).fill(null),u=0;u<e.length;u++)s[u]=new mn(Math.round((e[u].x-A.Jr)*A.Hr),Math.round((e[u].y-A.Zr)*A.Hr),e[u].z);var o=Ti.removeRepeatedPoints(s);return o}},ds.prototype.isIntegerPrecision=function(){return 1===this.Hr},ds.prototype.getNodedSubstrings=function(){var A=this.Kr.getNodedSubstrings();return this.Xr&&this.rescale(A),A},ds.prototype.computeNodes=function(A){var t=A;this.Xr&&(t=this.scale(A)),this.Kr.computeNodes(t)},ds.prototype.interfaces_=function(){return[Be]},ds.prototype.getClass=function(){return ds};var xs=function(){this.er=new si,this.$r=null;var A=arguments[0];this.$r=A},ms={fact:{configurable:!0}};xs.prototype.checkEndPtVertexIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.$r.iterator();t.hasNext();){var n=t.next(),i=n.getCoordinates();A.checkEndPtVertexIntersections(i[0],A.$r),A.checkEndPtVertexIntersections(i[i.length-1],A.$r)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=e.iterator();s.hasNext();)for(var u=s.next(),o=u.getCoordinates(),h=1;h<o.length-1;h++)if(o[h].equals(r))throw new ti("found endpt/interior pt intersection at index "+h+" :pt "+r)},xs.prototype.checkInteriorIntersections=function(){var A=this;if(0===arguments.length)for(var t=this.$r.iterator();t.hasNext();)for(var n=t.next(),i=this.$r.iterator();i.hasNext();){var r=i.next();A.checkInteriorIntersections(n,r)}else if(2===arguments.length)for(var e=arguments[0],s=arguments[1],u=e.getCoordinates(),o=s.getCoordinates(),h=0;h<u.length-1;h++)for(var f=0;f<o.length-1;f++)A.checkInteriorIntersections(e,h,s,f);else if(4===arguments.length){var c=arguments[0],a=arguments[1],v=arguments[2],l=arguments[3];if(c===v&&a===l)return null;var w=c.getCoordinates()[a],P=c.getCoordinates()[a+1],g=v.getCoordinates()[l],C=v.getCoordinates()[l+1];if(this.er.computeIntersection(w,P,g,C),this.er.hasIntersection()&&(this.er.isProper()||this.hasInteriorIntersection(this.er,w,P)||this.hasInteriorIntersection(this.er,g,C)))throw new ti("found non-noded intersection at "+w+"-"+P+" and "+g+"-"+C)}},xs.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()},xs.prototype.checkCollapses=function(){var A=this;if(0===arguments.length)for(var t=this.$r.iterator();t.hasNext();){var n=t.next();A.checkCollapses(n)}else if(1===arguments.length)for(var i=arguments[0],r=i.getCoordinates(),e=0;e<r.length-2;e++)A.checkCollapse(r[e],r[e+1],r[e+2])},xs.prototype.hasInteriorIntersection=function(A,t,n){for(var i=0;i<A.getIntersectionNum();i++){var r=A.getIntersection(i);if(!r.equals(t)&&!r.equals(n))return!0}return!1},xs.prototype.checkCollapse=function(A,t,n){if(A.equals(n))throw new ti("found non-noded collapse at "+xs.fact.createLineString([A,t,n]))},xs.prototype.interfaces_=function(){return[]},xs.prototype.getClass=function(){return xs},ms.fact.get=function(){return new jr},Object.defineProperties(xs,ms);var ys=function(){this.er=null,this.Ae=null,this.te=null,this.ne=null,this.ie=null,this.re=null,this.Hr=null,this.qt=null,this.Vt=null,this.Wt=null,this._t=null,this.ee=new Array(4).fill(null),this.se=null;var A=arguments[0],t=arguments[1],n=arguments[2];if(this.te=A,this.Ae=A,this.Hr=t,this.er=n,t<=0)throw new Dn("Scale factor must be non-zero");1!==t&&(this.Ae=new mn(this.scale(A.x),this.scale(A.y)),this.ie=new mn,this.re=new mn),this.initCorners(this.Ae)},ps={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};ys.prototype.intersectsScaled=function(A,t){var n=Math.min(A.x,t.x),i=Math.max(A.x,t.x),r=Math.min(A.y,t.y),e=Math.max(A.y,t.y),s=this.Vt<n||this.qt>i||this._t<r||this.Wt>e;if(s)return!1;var u=this.intersectsToleranceSquare(A,t);return ii.isTrue(!(s&&u),"Found bad envelope test"),u},ys.prototype.initCorners=function(A){this.qt=A.x-.5,this.Vt=A.x+.5,this.Wt=A.y-.5,this._t=A.y+.5,this.ee[0]=new mn(this.Vt,this._t),this.ee[1]=new mn(this.qt,this._t),this.ee[2]=new mn(this.qt,this.Wt),this.ee[3]=new mn(this.Vt,this.Wt)},ys.prototype.intersects=function(A,t){return 1===this.Hr?this.intersectsScaled(A,t):(this.copyScaled(A,this.ie),this.copyScaled(t,this.re),this.intersectsScaled(this.ie,this.re))},ys.prototype.scale=function(A){return Math.round(A*this.Hr)},ys.prototype.getCoordinate=function(){return this.te},ys.prototype.copyScaled=function(A,t){t.x=this.scale(A.x),t.y=this.scale(A.y)},ys.prototype.getSafeEnvelope=function(){if(null===this.se){var A=ys.SAFE_ENV_EXPANSION_FACTOR/this.Hr;this.se=new Kn(this.te.x-A,this.te.x+A,this.te.y-A,this.te.y+A)}return this.se},ys.prototype.intersectsPixelClosure=function(A,t){return this.er.computeIntersection(A,t,this.ee[0],this.ee[1]),!!(this.er.hasIntersection()||(this.er.computeIntersection(A,t,this.ee[1],this.ee[2]),this.er.hasIntersection()||(this.er.computeIntersection(A,t,this.ee[2],this.ee[3]),this.er.hasIntersection()||(this.er.computeIntersection(A,t,this.ee[3],this.ee[0]),this.er.hasIntersection()))))},ys.prototype.intersectsToleranceSquare=function(A,t){var n=!1,i=!1;return this.er.computeIntersection(A,t,this.ee[0],this.ee[1]),!!(this.er.isProper()||(this.er.computeIntersection(A,t,this.ee[1],this.ee[2]),this.er.isProper()||(this.er.hasIntersection()&&(n=!0),this.er.computeIntersection(A,t,this.ee[2],this.ee[3]),this.er.isProper()||(this.er.hasIntersection()&&(i=!0),this.er.computeIntersection(A,t,this.ee[3],this.ee[0]),this.er.isProper()||n&&i||A.equals(this.Ae)||t.equals(this.Ae)))))},ys.prototype.addSnappedNode=function(A,t){var n=A.getCoordinate(t),i=A.getCoordinate(t+1);return!!this.intersects(n,i)&&(A.addIntersection(this.getCoordinate(),t),!0)},ys.prototype.interfaces_=function(){return[]},ys.prototype.getClass=function(){return ys},ps.SAFE_ENV_EXPANSION_FACTOR.get=function(){return.75},Object.defineProperties(ys,ps);var Ls=function(){this.tempEnv1=new Kn,this.selectedSegment=new Ne};Ls.prototype.select=function(){if(1===arguments.length);else if(2===arguments.length){var A=arguments[0],t=arguments[1];A.getLineSegment(t,this.selectedSegment),this.select(this.selectedSegment)}},Ls.prototype.interfaces_=function(){return[]},Ls.prototype.getClass=function(){return Ls};var Ts=function(){this.Qi=null;var A=arguments[0];this.Qi=A},Os={HotPixelSnapAction:{configurable:!0}};Ts.prototype.snap=function(){if(1===arguments.length){var A=arguments[0];return this.snap(A,null,-1)}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2],r=t.getSafeEnvelope(),e=new Fs(t,n,i);return this.Qi.query(r,{interfaces_:function(){return[Pe]},visitItem:function(A){A.select(r,e)}}),e.isNodeAdded()}},Ts.prototype.interfaces_=function(){return[]},Ts.prototype.getClass=function(){return Ts},Os.HotPixelSnapAction.get=function(){return Fs},Object.defineProperties(Ts,Os);var Fs=function(A){function t(){A.call(this),this.ue=null,this.oe=null,this.he=null,this.fe=!1;var t=arguments[0],n=arguments[1],i=arguments[2];this.ue=t,this.oe=n,this.he=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.isNodeAdded=function(){return this.fe},t.prototype.select=function(){if(2!==arguments.length)return A.prototype.select.apply(this,arguments);var t=arguments[0],n=arguments[1],i=t.getContext();if(null!==this.oe&&i===this.oe&&n===this.he)return null;this.fe=this.ue.addSnappedNode(i,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Ls),Us=function(){this.er=null,this.ce=null;var A=arguments[0];this.er=A,this.ce=new yi};Us.prototype.processIntersections=function(A,t,n,i){if(A===n&&t===i)return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];if(this.er.computeIntersection(r,e,s,u),this.er.hasIntersection()&&this.er.isInteriorIntersection()){for(var o=0;o<this.er.getIntersectionNum();o++)this.ce.add(this.er.getIntersection(o));A.addIntersections(this.er,t,0),n.addIntersections(this.er,i,1)}},Us.prototype.isDone=function(){return!1},Us.prototype.getInteriorIntersections=function(){return this.ce},Us.prototype.interfaces_=function(){return[ls]},Us.prototype.getClass=function(){return Us};var Es=function(){this.ae=null,this.er=null,this.Hr=null,this.Kr=null,this.ve=null,this.ki=null;var A=arguments[0];this.ae=A,this.er=new si,this.er.setPrecisionModel(A),this.Hr=A.getScale()};Es.prototype.checkCorrectness=function(A){var t=Ee.getNodedSubstrings(A),n=new xs(t);try{n.checkValid()}catch(A){if(!(A instanceof qn))throw A;A.printStackTrace()}},Es.prototype.getNodedSubstrings=function(){return Ee.getNodedSubstrings(this.ki)},Es.prototype.snapRound=function(A,t){var n=this.findInteriorIntersections(A,t);this.computeIntersectionSnaps(n),this.computeVertexSnaps(A)},Es.prototype.findInteriorIntersections=function(A,t){var n=new Us(t);return this.Kr.setSegmentIntersector(n),this.Kr.computeNodes(A),n.getInteriorIntersections()},Es.prototype.computeVertexSnaps=function(){var A=this;if(Fn(arguments[0],bi))for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.computeVertexSnaps(i)}else if(arguments[0]instanceof Ee)for(var r=arguments[0],e=r.getCoordinates(),s=0;s<e.length;s++){var u=new ys(e[s],A.Hr,A.er),o=A.ve.snap(u,r,s);o&&r.addIntersection(e[s],s)}},Es.prototype.computeNodes=function(A){this.ki=A,this.Kr=new Ge,this.ve=new Ts(this.Kr.getIndex()),this.snapRound(A,this.er)},Es.prototype.computeIntersectionSnaps=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=new ys(n,this.Hr,this.er);this.ve.snap(i)}},Es.prototype.interfaces_=function(){return[Be]},Es.prototype.getClass=function(){return Es};var Ns=function(){if(this.we=null,this.gi=null,this.rr=new qe,this.Pe=null,this.Ce=null,1===arguments.length){var A=arguments[0];this.we=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.we=t,this.rr=n}},js={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Ns.prototype.bufferFixedPrecision=function(A){var t=new ds(new Es(new Fr(1)),A.getScale()),n=new zs(this.rr);n.setWorkingPrecisionModel(A),n.setNoder(t),this.Pe=n.buffer(this.we,this.gi)},Ns.prototype.bufferReducedPrecision=function(){var A=this;if(0===arguments.length){for(var t=Ns.MAX_PRECISION_DIGITS;t>=0;t--){try{A.bufferReducedPrecision(t)}catch(t){if(!(t instanceof Hr))throw t;A.Ce=t}if(null!==A.Pe)return null}throw this.Ce}if(1===arguments.length){var n=arguments[0],i=Ns.precisionScaleFactor(this.we,this.gi,n),r=new Fr(i);this.bufferFixedPrecision(r)}},Ns.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),null!==this.Pe)return null;var A=this.we.getFactory().getPrecisionModel();A.getType()===Fr.FIXED?this.bufferFixedPrecision(A):this.bufferReducedPrecision()},Ns.prototype.setQuadrantSegments=function(A){this.rr.setQuadrantSegments(A)},Ns.prototype.bufferOriginalPrecision=function(){try{var A=new zs(this.rr);this.Pe=A.buffer(this.we,this.gi)}catch(A){if(!(A instanceof ti))throw A;this.Ce=A}},Ns.prototype.getResultGeometry=function(A){return this.gi=A,this.computeGeometry(),this.Pe},Ns.prototype.setEndCapStyle=function(A){this.rr.setEndCapStyle(A)},Ns.prototype.interfaces_=function(){return[]},Ns.prototype.getClass=function(){return Ns},Ns.bufferOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new Ns(A),i=n.getResultGeometry(t);return i}if(3===arguments.length){if(Number.isInteger(arguments[2])&&arguments[0]instanceof ai&&"number"==typeof arguments[1]){var r=arguments[0],e=arguments[1],s=arguments[2],u=new Ns(r);u.setQuadrantSegments(s);var o=u.getResultGeometry(e);return o}if(arguments[2]instanceof qe&&arguments[0]instanceof ai&&"number"==typeof arguments[1]){var h=arguments[0],f=arguments[1],c=arguments[2],a=new Ns(h,c),v=a.getResultGeometry(f);return v}}else if(4===arguments.length){var l=arguments[0],w=arguments[1],P=arguments[2],g=arguments[3],C=new Ns(l);C.setQuadrantSegments(P),C.setEndCapStyle(g);var D=C.getResultGeometry(w);return D}},Ns.precisionScaleFactor=function(A,t,n){var i=A.getEnvelopeInternal(),r=Un.max(Math.abs(i.getMaxX()),Math.abs(i.getMaxY()),Math.abs(i.getMinX()),Math.abs(i.getMinY()))+2*(t>0?t:0),e=n-Math.trunc(Math.log(r)/Math.log(10)+1);return Math.pow(10,e)},js.CAP_ROUND.get=function(){return qe.CAP_ROUND},js.CAP_BUTT.get=function(){return qe.CAP_FLAT},js.CAP_FLAT.get=function(){return qe.CAP_FLAT},js.CAP_SQUARE.get=function(){return qe.CAP_SQUARE},js.MAX_PRECISION_DIGITS.get=function(){return 12},Object.defineProperties(Ns,js);var Qs=function(){this.Ae=[new mn,new mn],this.gi=In.NaN,this.De=!0};Qs.prototype.getCoordinates=function(){return this.Ae},Qs.prototype.getCoordinate=function(A){return this.Ae[A]},Qs.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.Ae[0],A.Ae[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.De)return this.initialize(t,n),null;var i=t.distance(n);i<this.gi&&this.initialize(t,n,i)}},Qs.prototype.initialize=function(){if(0===arguments.length)this.De=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.Ae[0].setCoordinate(A),this.Ae[1].setCoordinate(t),this.gi=A.distance(t),this.De=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Ae[0].setCoordinate(n),this.Ae[1].setCoordinate(i),this.gi=r,this.De=!1}},Qs.prototype.getDistance=function(){return this.gi},Qs.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.Ae[0],A.Ae[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.De)return this.initialize(t,n),null;var i=t.distance(n);i>this.gi&&this.initialize(t,n,i)}},Qs.prototype.interfaces_=function(){return[]},Qs.prototype.getClass=function(){return Qs};var Ss=function(){};Ss.prototype.interfaces_=function(){return[]},Ss.prototype.getClass=function(){return Ss},Ss.computeDistance=function(){if(arguments[2]instanceof Qs&&arguments[0]instanceof lr&&arguments[1]instanceof mn)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=A.getCoordinates(),r=new Ne,e=0;e<i.length-1;e++){r.setCoordinates(i[e],i[e+1]);var s=r.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof Cr&&arguments[1]instanceof mn){var u=arguments[0],o=arguments[1],h=arguments[2];Ss.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)Ss.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof ai&&arguments[1]instanceof mn){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof lr)Ss.computeDistance(c,a,v);else if(c instanceof Cr)Ss.computeDistance(c,a,v);else if(c instanceof tr)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);Ss.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof Qs&&arguments[0]instanceof Ne&&arguments[1]instanceof mn){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var ks=function(A){this.Ie=new Qs,this.Mr=A||null},Bs={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};ks.prototype.computeMaxMidpointDistance=function(A){var t=new Gs(this.Mr);A.apply(t),this.Ie.setMaximum(t.getMaxPointDistance())},ks.prototype.computeMaxVertexDistance=function(A){var t=new Rs(this.Mr);A.apply(t),this.Ie.setMaximum(t.getMaxPointDistance())},ks.prototype.findDistance=function(A){return this.computeMaxVertexDistance(A),this.computeMaxMidpointDistance(A),this.Ie.getDistance()},ks.prototype.getDistancePoints=function(){return this.Ie},ks.prototype.interfaces_=function(){return[]},ks.prototype.getClass=function(){return ks},Bs.MaxPointDistanceFilter.get=function(){return Rs},Bs.MaxMidpointDistanceFilter.get=function(){return Gs},Object.defineProperties(ks,Bs);var Rs=function(A){this.Ie=new Qs,this.Me=new Qs,this.Pn=A||null};Rs.prototype.filter=function(A){this.Me.initialize(),Ss.computeDistance(this.Pn,A,this.Me),this.Ie.setMaximum(this.Me)},Rs.prototype.getMaxPointDistance=function(){return this.Ie},Rs.prototype.interfaces_=function(){return[wi]},Rs.prototype.getClass=function(){return Rs};var Gs=function(A){this.Ie=new Qs,this.Me=new Qs,this.Pn=A||null};Gs.prototype.filter=function(A,t){if(0===t)return null;var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=new mn((n.x+i.x)/2,(n.y+i.y)/2);this.Me.initialize(),Ss.computeDistance(this.Pn,r,this.Me),this.Ie.setMaximum(this.Me)},Gs.prototype.isDone=function(){return!1},Gs.prototype.isGeometryChanged=function(){return!1},Gs.prototype.getMaxPointDistance=function(){return this.Ie},Gs.prototype.interfaces_=function(){return[Ar]},Gs.prototype.getClass=function(){return Gs};var Ys=function(A){this.be=A||null};Ys.prototype.filter=function(A){A instanceof Cr&&this.be.add(A)},Ys.prototype.interfaces_=function(){return[$i]},Ys.prototype.getClass=function(){return Ys},Ys.getPolygons=function(){if(1===arguments.length){var A=arguments[0];return Ys.getPolygons(A,new yi)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof Cr?n.add(t):t instanceof tr&&t.apply(new Ys(n)),n}};var qs=function(){if(this.xt=null,this.ze=!1,1===arguments.length){var A=arguments[0];this.xt=A}else if(2===arguments.length){var t=arguments[0],n=arguments[1];this.xt=t,this.ze=n}};qs.prototype.filter=function(A){if(this.ze&&A instanceof Ir){var t=A.getFactory().createLineString(A.getCoordinateSequence());return this.xt.add(t),null}A instanceof lr&&this.xt.add(A)},qs.prototype.setForceToLineString=function(A){this.ze=A},qs.prototype.interfaces_=function(){return[ci]},qs.prototype.getClass=function(){return qs},qs.getGeometry=function(){if(1===arguments.length){var A=arguments[0];return A.getFactory().buildGeometry(qs.getLines(A))}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t.getFactory().buildGeometry(qs.getLines(t,n))}},qs.getLines=function(){if(1===arguments.length){var A=arguments[0];return qs.getLines(A,!1)}if(2===arguments.length){if(Fn(arguments[0],bi)&&Fn(arguments[1],bi)){for(var t=arguments[0],n=arguments[1],i=t.iterator();i.hasNext();){var r=i.next();qs.getLines(r,n)}return n}if(arguments[0]instanceof ai&&"boolean"==typeof arguments[1]){var e=arguments[0],s=arguments[1],u=new yi;return e.apply(new qs(u,s)),u}if(arguments[0]instanceof ai&&Fn(arguments[1],bi)){var o=arguments[0],h=arguments[1];return o instanceof lr?h.add(o):o.apply(new qs(h)),h}}else if(3===arguments.length){if("boolean"==typeof arguments[2]&&Fn(arguments[0],bi)&&Fn(arguments[1],bi)){for(var f=arguments[0],c=arguments[1],a=arguments[2],v=f.iterator();v.hasNext();){var l=v.next();qs.getLines(l,c,a)}return c}if("boolean"==typeof arguments[2]&&arguments[0]instanceof ai&&Fn(arguments[1],bi)){var w=arguments[0],P=arguments[1],g=arguments[2];return w.apply(new qs(P,g)),P}}};var Vs=function(){if(this.de=Pi.OGC_SFS_BOUNDARY_RULE,this.xe=null,this.me=null,0===arguments.length);else if(1===arguments.length){var A=arguments[0];if(null===A)throw new Dn("Rule must be non-null");this.de=A}};Vs.prototype.locateInternal=function(){var A=this;if(arguments[0]instanceof mn&&arguments[1]instanceof Cr){var t=arguments[0],n=arguments[1];if(n.isEmpty())return Tn.EXTERIOR;var i=n.getExteriorRing(),r=this.locateInPolygonRing(t,i);if(r===Tn.EXTERIOR)return Tn.EXTERIOR;if(r===Tn.BOUNDARY)return Tn.BOUNDARY;for(var e=0;e<n.getNumInteriorRing();e++){var s=n.getInteriorRingN(e),u=A.locateInPolygonRing(t,s);if(u===Tn.INTERIOR)return Tn.EXTERIOR;if(u===Tn.BOUNDARY)return Tn.BOUNDARY}return Tn.INTERIOR}if(arguments[0]instanceof mn&&arguments[1]instanceof lr){var o=arguments[0],h=arguments[1];if(!h.getEnvelopeInternal().intersects(o))return Tn.EXTERIOR;var f=h.getCoordinates();return h.isClosed()||!o.equals(f[0])&&!o.equals(f[f.length-1])?hi.isOnLine(o,f)?Tn.INTERIOR:Tn.EXTERIOR:Tn.BOUNDARY}if(arguments[0]instanceof mn&&arguments[1]instanceof Pr){var c=arguments[0],a=arguments[1],v=a.getCoordinate();return v.equals2D(c)?Tn.INTERIOR:Tn.EXTERIOR}},Vs.prototype.locateInPolygonRing=function(A,t){return t.getEnvelopeInternal().intersects(A)?hi.locatePointInRing(A,t.getCoordinates()):Tn.EXTERIOR},Vs.prototype.intersects=function(A,t){return this.locate(A,t)!==Tn.EXTERIOR},Vs.prototype.updateLocationInfo=function(A){A===Tn.INTERIOR&&(this.xe=!0),A===Tn.BOUNDARY&&this.me++},Vs.prototype.computeLocation=function(A,t){if(t instanceof Pr&&this.updateLocationInfo(this.locateInternal(A,t)),t instanceof lr)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof Cr)this.updateLocationInfo(this.locateInternal(A,t));else if(t instanceof nr)for(var n=t,i=0;i<n.getNumGeometries();i++){var r=n.getGeometryN(i);this.updateLocationInfo(this.locateInternal(A,r))}else if(t instanceof Mr)for(var e=t,s=0;s<e.getNumGeometries();s++){var u=e.getGeometryN(s);this.updateLocationInfo(this.locateInternal(A,u))}else if(t instanceof tr)for(var o=new us(t);o.hasNext();){var h=o.next();h!==t&&this.computeLocation(A,h)}},Vs.prototype.locate=function(A,t){return t.isEmpty()?Tn.EXTERIOR:t instanceof lr||t instanceof Cr?this.locateInternal(A,t):(this.xe=!1,this.me=0,this.computeLocation(A,t),this.de.isInBoundary(this.me)?Tn.BOUNDARY:this.me>0||this.xe?Tn.INTERIOR:Tn.EXTERIOR)},Vs.prototype.interfaces_=function(){return[]},Vs.prototype.getClass=function(){return Vs};var Ws=function A(){if(this.ye=null,this.pe=null,this.Ae=null,2===arguments.length){var t=arguments[0],n=arguments[1];A.call(this,t,A.INSIDE_AREA,n)}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.ye=i,this.pe=r,this.Ae=e}},_s={INSIDE_AREA:{configurable:!0}};Ws.prototype.isInsideArea=function(){return this.pe===Ws.INSIDE_AREA},Ws.prototype.getCoordinate=function(){return this.Ae},Ws.prototype.getGeometryComponent=function(){return this.ye},Ws.prototype.getSegmentIndex=function(){return this.pe},Ws.prototype.interfaces_=function(){return[]},Ws.prototype.getClass=function(){return Ws},_s.INSIDE_AREA.get=function(){return-1},Object.defineProperties(Ws,_s);var Ks=function(A){this.Qn=A||null};Ks.prototype.filter=function(A){A instanceof Pr&&this.Qn.add(A)},Ks.prototype.interfaces_=function(){return[$i]},Ks.prototype.getClass=function(){return Ks},Ks.getPoints=function(){if(1===arguments.length){var A=arguments[0];return A instanceof Pr?Ie.singletonList(A):Ks.getPoints(A,new yi)}if(2===arguments.length){var t=arguments[0],n=arguments[1];return t instanceof Pr?n.add(t):t instanceof tr&&t.apply(new Ks(n)),n}};var Hs=function(){this.Le=null;var A=arguments[0];this.Le=A};Hs.prototype.filter=function(A){(A instanceof Pr||A instanceof lr||A instanceof Cr)&&this.Le.add(new Ws(A,0,A.getCoordinate()))},Hs.prototype.interfaces_=function(){return[$i]},Hs.prototype.getClass=function(){return Hs},Hs.getLocations=function(A){var t=new yi;return A.apply(new Hs(t)),t};var Js=function(){if(this.Pn=null,this.Te=0,this.Oe=new Vs,this.Fe=null,this.Ue=In.MAX_VALUE,2===arguments.length){var A=arguments[0],t=arguments[1];this.Pn=[A,t],this.Te=0}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Pn=new Array(2).fill(null),this.Pn[0]=n,this.Pn[1]=i,this.Te=r}};Js.prototype.computeContainmentDistance=function(){var A=this;if(0===arguments.length){var t=new Array(2).fill(null);if(this.computeContainmentDistance(0,t),this.Ue<=this.Te)return null;this.computeContainmentDistance(1,t)}else if(2===arguments.length){var n=arguments[0],i=arguments[1],r=1-n,e=Ys.getPolygons(this.Pn[n]);if(e.size()>0){var s=Hs.getLocations(this.Pn[r]);if(this.computeContainmentDistance(s,e,i),this.Ue<=this.Te)return this.Fe[r]=i[0],this.Fe[n]=i[1],null}}else if(3===arguments.length)if(arguments[2]instanceof Array&&Fn(arguments[0],xi)&&Fn(arguments[1],xi)){for(var u=arguments[0],o=arguments[1],h=arguments[2],f=0;f<u.size();f++)for(var c=u.get(f),a=0;a<o.size();a++)if(A.computeContainmentDistance(c,o.get(a),h),A.Ue<=A.Te)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof Ws&&arguments[1]instanceof Cr){var v=arguments[0],l=arguments[1],w=arguments[2],P=v.getCoordinate();if(Tn.EXTERIOR!==this.Oe.locate(P,l))return this.Ue=0,w[0]=v,w[1]=new Ws(l,P),null}},Js.prototype.computeMinDistanceLinesPoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.Ue<=this.Te)return null}},Js.prototype.computeFacetDistance=function(){var A=new Array(2).fill(null),t=qs.getLines(this.Pn[0]),n=qs.getLines(this.Pn[1]),i=Ks.getPoints(this.Pn[0]),r=Ks.getPoints(this.Pn[1]);return this.computeMinDistanceLines(t,n,A),this.updateMinDistance(A,!1),this.Ue<=this.Te?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(t,r,A),this.updateMinDistance(A,!1),this.Ue<=this.Te?null:(A[0]=null,A[1]=null,this.computeMinDistanceLinesPoints(n,i,A),this.updateMinDistance(A,!0),this.Ue<=this.Te?null:(A[0]=null,A[1]=null,this.computeMinDistancePoints(i,r,A),void this.updateMinDistance(A,!1))))},Js.prototype.nearestLocations=function(){return this.computeMinDistance(),this.Fe},Js.prototype.updateMinDistance=function(A,t){if(null===A[0])return null;t?(this.Fe[0]=A[1],this.Fe[1]=A[0]):(this.Fe[0]=A[0],this.Fe[1]=A[1])},Js.prototype.nearestPoints=function(){return this.computeMinDistance(),[this.Fe[0].getCoordinate(),this.Fe[1].getCoordinate()]},Js.prototype.computeMinDistance=function(){var A=this;if(0===arguments.length){if(null!==this.Fe)return null;if(this.Fe=new Array(2).fill(null),this.computeContainmentDistance(),this.Ue<=this.Te)return null;this.computeFacetDistance()}else if(3===arguments.length)if(arguments[2]instanceof Array&&arguments[0]instanceof lr&&arguments[1]instanceof Pr){var t=arguments[0],n=arguments[1],i=arguments[2];if(t.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this.Ue)return null;for(var r=t.getCoordinates(),e=n.getCoordinate(),s=0;s<r.length-1;s++){var u=hi.distancePointLine(e,r[s],r[s+1]);if(u<A.Ue){A.Ue=u;var o=new Ne(r[s],r[s+1]),h=o.closestPoint(e);i[0]=new Ws(t,s,h),i[1]=new Ws(n,0,e)}if(A.Ue<=A.Te)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof lr&&arguments[1]instanceof lr){var f=arguments[0],c=arguments[1],a=arguments[2];if(f.getEnvelopeInternal().distance(c.getEnvelopeInternal())>this.Ue)return null;for(var v=f.getCoordinates(),l=c.getCoordinates(),w=0;w<v.length-1;w++)for(var P=0;P<l.length-1;P++){var g=hi.distanceLineLine(v[w],v[w+1],l[P],l[P+1]);if(g<A.Ue){A.Ue=g;var C=new Ne(v[w],v[w+1]),D=new Ne(l[P],l[P+1]),I=C.closestPoints(D);a[0]=new Ws(f,w,I[0]),a[1]=new Ws(c,P,I[1])}if(A.Ue<=A.Te)return null}}},Js.prototype.computeMinDistancePoints=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e),u=r.getCoordinate().distance(s.getCoordinate());if(u<this.Ue&&(this.Ue=u,n[0]=new Ws(r,0,r.getCoordinate()),n[1]=new Ws(s,0,s.getCoordinate())),this.Ue<=this.Te)return null}},Js.prototype.distance=function(){if(null===this.Pn[0]||null===this.Pn[1])throw new Dn("null geometries are not supported");return this.Pn[0].isEmpty()||this.Pn[1].isEmpty()?0:(this.computeMinDistance(),this.Ue)},Js.prototype.computeMinDistanceLines=function(A,t,n){for(var i=0;i<A.size();i++)for(var r=A.get(i),e=0;e<t.size();e++){var s=t.get(e);if(this.computeMinDistance(r,s,n),this.Ue<=this.Te)return null}},Js.prototype.interfaces_=function(){return[]},Js.prototype.getClass=function(){return Js},Js.distance=function(A,t){return new Js(A,t).distance()},Js.isWithinDistance=function(A,t,n){return new Js(A,t,n).distance()<=n},Js.nearestPoints=function(A,t){return new Js(A,t).nearestPoints()};var Zs=function(){this.Ae=[new mn,new mn],this.gi=In.NaN,this.De=!0};Zs.prototype.getCoordinates=function(){return this.Ae},Zs.prototype.getCoordinate=function(A){return this.Ae[A]},Zs.prototype.setMinimum=function(){if(1===arguments.length){var A=arguments[0];this.setMinimum(A.Ae[0],A.Ae[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.De)return this.initialize(t,n),null;var i=t.distance(n);i<this.gi&&this.initialize(t,n,i)}},Zs.prototype.initialize=function(){if(0===arguments.length)this.De=!0;else if(2===arguments.length){var A=arguments[0],t=arguments[1];this.Ae[0].setCoordinate(A),this.Ae[1].setCoordinate(t),this.gi=A.distance(t),this.De=!1}else if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2];this.Ae[0].setCoordinate(n),this.Ae[1].setCoordinate(i),this.gi=r,this.De=!1}},Zs.prototype.toString=function(){return Ai.toLineString(this.Ae[0],this.Ae[1])},Zs.prototype.getDistance=function(){return this.gi},Zs.prototype.setMaximum=function(){if(1===arguments.length){var A=arguments[0];this.setMaximum(A.Ae[0],A.Ae[1])}else if(2===arguments.length){var t=arguments[0],n=arguments[1];if(this.De)return this.initialize(t,n),null;var i=t.distance(n);i>this.gi&&this.initialize(t,n,i)}},Zs.prototype.interfaces_=function(){return[]},Zs.prototype.getClass=function(){return Zs};var Xs=function(){};Xs.prototype.interfaces_=function(){return[]},Xs.prototype.getClass=function(){return Xs},Xs.computeDistance=function(){if(arguments[2]instanceof Zs&&arguments[0]instanceof lr&&arguments[1]instanceof mn)for(var A=arguments[0],t=arguments[1],n=arguments[2],i=new Ne,r=A.getCoordinates(),e=0;e<r.length-1;e++){i.setCoordinates(r[e],r[e+1]);var s=i.closestPoint(t);n.setMinimum(s,t)}else if(arguments[2]instanceof Zs&&arguments[0]instanceof Cr&&arguments[1]instanceof mn){var u=arguments[0],o=arguments[1],h=arguments[2];Xs.computeDistance(u.getExteriorRing(),o,h);for(var f=0;f<u.getNumInteriorRing();f++)Xs.computeDistance(u.getInteriorRingN(f),o,h)}else if(arguments[2]instanceof Zs&&arguments[0]instanceof ai&&arguments[1]instanceof mn){var c=arguments[0],a=arguments[1],v=arguments[2];if(c instanceof lr)Xs.computeDistance(c,a,v);else if(c instanceof Cr)Xs.computeDistance(c,a,v);else if(c instanceof tr)for(var l=c,w=0;w<l.getNumGeometries();w++){var P=l.getGeometryN(w);Xs.computeDistance(P,a,v)}else v.setMinimum(c.getCoordinate(),a)}else if(arguments[2]instanceof Zs&&arguments[0]instanceof Ne&&arguments[1]instanceof mn){var g=arguments[0],C=arguments[1],D=arguments[2],I=g.closestPoint(C);D.setMinimum(I,C)}};var $s=function(){this.Ee=null,this.Ne=null,this.je=new Zs,this.Qe=0;var A=arguments[0],t=arguments[1];this.Ee=A,this.Ne=t},Au={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};$s.prototype.getCoordinates=function(){return this.je.getCoordinates()},$s.prototype.setDensifyFraction=function(A){if(A>1||A<=0)throw new Dn("Fraction is not in range (0.0 - 1.0]");this.Qe=A},$s.prototype.compute=function(A,t){this.computeOrientedDistance(A,t,this.je),this.computeOrientedDistance(t,A,this.je)},$s.prototype.distance=function(){return this.compute(this.Ee,this.Ne),this.je.getDistance()},$s.prototype.computeOrientedDistance=function(A,t,n){var i=new tu(t);if(A.apply(i),n.setMaximum(i.getMaxPointDistance()),this.Qe>0){var r=new nu(t,this.Qe);A.apply(r),n.setMaximum(r.getMaxPointDistance())}},$s.prototype.orientedDistance=function(){return this.computeOrientedDistance(this.Ee,this.Ne,this.je),this.je.getDistance()},$s.prototype.interfaces_=function(){return[]},$s.prototype.getClass=function(){return $s},$s.distance=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new $s(A,t);return n.distance()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new $s(i,r);return s.setDensifyFraction(e),s.distance()}},Au.MaxPointDistanceFilter.get=function(){return tu},Au.MaxDensifiedByFractionDistanceFilter.get=function(){return nu},Object.defineProperties($s,Au);var tu=function(){this.Ie=new Zs,this.Me=new Zs,this.Se=new Xs,this.Pn=null;var A=arguments[0];this.Pn=A};tu.prototype.filter=function(A){this.Me.initialize(),Xs.computeDistance(this.Pn,A,this.Me),this.Ie.setMaximum(this.Me)},tu.prototype.getMaxPointDistance=function(){return this.Ie},tu.prototype.interfaces_=function(){return[wi]},tu.prototype.getClass=function(){return tu};var nu=function(){this.Ie=new Zs,this.Me=new Zs,this.Pn=null,this.ke=0;var A=arguments[0],t=arguments[1];this.Pn=A,this.ke=Math.trunc(Math.round(1/t))};nu.prototype.filter=function(A,t){if(0===t)return null;for(var n=A.getCoordinate(t-1),i=A.getCoordinate(t),r=(i.x-n.x)/this.ke,e=(i.y-n.y)/this.ke,s=0;s<this.ke;s++){var h=new mn(n.x+s*r,n.y+s*e);this.Me.initialize(),Xs.computeDistance(this.Pn,h,this.Me),this.Ie.setMaximum(this.Me)}},nu.prototype.isDone=function(){return!1},nu.prototype.isGeometryChanged=function(){return!1},nu.prototype.getMaxPointDistance=function(){return this.Ie},nu.prototype.interfaces_=function(){return[Ar]},nu.prototype.getClass=function(){return nu};var iu=function(A,t,n){this.Be=null,this.Re=null,this.Ge=null,this.Ye=null,this.qe=!0,this.Ve=null,this.We=null,this._e=null,this.Ke=A||null,this.He=t||null,this.$t=n||null},ru={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};iu.prototype.checkMaximumDistance=function(A,t,n){var i=new $s(t,A);if(i.setDensifyFraction(.25),this.Ye=i.orientedDistance(),this.Ye>n){this.qe=!1;var r=i.getCoordinates();this.We=r[1],this._e=A.getFactory().createLineString(r),this.Ve="Distance between buffer curve and input is too large ("+this.Ye+" at "+Ai.toLineString(r[0],r[1])+")"}},iu.prototype.isValid=function(){var A=Math.abs(this.He),t=iu.MAX_DISTANCE_DIFF_FRAC*A;return this.Be=A-t,this.Re=A+t,!(!this.Ke.isEmpty()&&!this.$t.isEmpty())||(this.He>0?this.checkPositiveValid():this.checkNegativeValid(),iu.VERBOSE&&Wn.out.println("Min Dist= "+this.Ge+"  err= "+(1-this.Ge/this.He)+"  Max Dist= "+this.Ye+"  err= "+(this.Ye/this.He-1)),this.qe)},iu.prototype.checkNegativeValid=function(){if(!(this.Ke instanceof Cr||this.Ke instanceof Mr||this.Ke instanceof tr))return null;var A=this.getPolygonLines(this.Ke);if(this.checkMinimumDistance(A,this.$t,this.Be),!this.qe)return null;this.checkMaximumDistance(A,this.$t,this.Re)},iu.prototype.getErrorIndicator=function(){return this._e},iu.prototype.checkMinimumDistance=function(A,t,n){var i=new Js(A,t,n);if(this.Ge=i.distance(),this.Ge<n){this.qe=!1;var r=i.nearestPoints();this.We=i.nearestPoints()[1],this._e=A.getFactory().createLineString(r),this.Ve="Distance between buffer curve and input is too small ("+this.Ge+" at "+Ai.toLineString(r[0],r[1])+" )"}},iu.prototype.checkPositiveValid=function(){var A=this.$t.getBoundary();if(this.checkMinimumDistance(this.Ke,A,this.Be),!this.qe)return null;this.checkMaximumDistance(this.Ke,A,this.Re)},iu.prototype.getErrorLocation=function(){return this.We},iu.prototype.getPolygonLines=function(A){for(var t=new yi,n=new qs(t),i=Ys.getPolygons(A).iterator();i.hasNext();)i.next().apply(n);return A.getFactory().buildGeometry(t)},iu.prototype.getErrorMessage=function(){return this.Ve},iu.prototype.interfaces_=function(){return[]},iu.prototype.getClass=function(){return iu},ru.VERBOSE.get=function(){return!1},ru.MAX_DISTANCE_DIFF_FRAC.get=function(){return.012},Object.defineProperties(iu,ru);var eu=function(A,t,n){this.qe=!0,this.Je=null,this.We=null,this._e=null,this.Ke=A||null,this.gi=t||null,this.$t=n||null},su={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};eu.prototype.isValid=function(){return this.checkPolygonal(),this.qe?(this.checkExpectedEmpty(),this.qe?(this.checkEnvelope(),this.qe?(this.checkArea(),this.qe?(this.checkDistance(),this.qe):this.qe):this.qe):this.qe):this.qe},eu.prototype.checkEnvelope=function(){if(this.gi<0)return null;var A=this.gi*eu.MAX_ENV_DIFF_FRAC;0===A&&(A=.001);var t=new Kn(this.Ke.getEnvelopeInternal());t.expandBy(this.gi);var n=new Kn(this.$t.getEnvelopeInternal());n.expandBy(A),n.contains(t)||(this.qe=!1,this.Je="Buffer envelope is incorrect",this._e=this.Ke.getFactory().toGeometry(n)),this.report("Envelope")},eu.prototype.checkDistance=function(){var A=new iu(this.Ke,this.gi,this.$t);A.isValid()||(this.qe=!1,this.Je=A.getErrorMessage(),this.We=A.getErrorLocation(),this._e=A.getErrorIndicator()),this.report("Distance")},eu.prototype.checkArea=function(){var A=this.Ke.getArea(),t=this.$t.getArea();this.gi>0&&A>t&&(this.qe=!1,this.Je="Area of positive buffer is smaller than input",this._e=this.$t),this.gi<0&&A<t&&(this.qe=!1,this.Je="Area of negative buffer is larger than input",this._e=this.$t),this.report("Area")},eu.prototype.checkPolygonal=function(){this.$t instanceof Cr||this.$t instanceof Mr||(this.qe=!1),this.Je="Result is not polygonal",this._e=this.$t,this.report("Polygonal")},eu.prototype.getErrorIndicator=function(){return this._e},eu.prototype.getErrorLocation=function(){return this.We},eu.prototype.checkExpectedEmpty=function(){return this.Ke.getDimension()>=2||this.gi>0?null:(this.$t.isEmpty()||(this.qe=!1,this.Je="Result is non-empty",this._e=this.$t),void this.report("ExpectedEmpty"))},eu.prototype.report=function(A){if(!eu.VERBOSE)return null;Wn.out.println("Check "+A+": "+(this.qe?"passed":"FAILED"))},eu.prototype.getErrorMessage=function(){return this.Je},eu.prototype.interfaces_=function(){return[]},eu.prototype.getClass=function(){return eu},eu.isValidMsg=function(A,t,n){var i=new eu(A,t,n);return i.isValid()?null:i.getErrorMessage()},eu.isValid=function(A,t,n){return!!new eu(A,t,n).isValid()},su.VERBOSE.get=function(){return!1},su.MAX_ENV_DIFF_FRAC.get=function(){return.012},Object.defineProperties(eu,su);var uu=function(){this.Qn=null,this.pi=null;var A=arguments[0],t=arguments[1];this.Qn=A,this.pi=t};uu.prototype.getCoordinates=function(){return this.Qn},uu.prototype.size=function(){return this.Qn.length},uu.prototype.getCoordinate=function(A){return this.Qn[A]},uu.prototype.isClosed=function(){return this.Qn[0].equals(this.Qn[this.Qn.length-1])},uu.prototype.getSegmentOctant=function(A){return A===this.Qn.length-1?-1:Oe.octant(this.getCoordinate(A),this.getCoordinate(A+1))},uu.prototype.setData=function(A){this.pi=A},uu.prototype.getData=function(){return this.pi},uu.prototype.toString=function(){return Ai.toLineString(new yr(this.Qn))},uu.prototype.interfaces_=function(){return[Fe]},uu.prototype.getClass=function(){return uu};var ou=function(){this.Ze=!1,this.Xe=!1,this.er=null,this.$e=null,this.As=null,this.ts=new yi,this.ns=0,this.rs=!0;var A=arguments[0];this.er=A,this.$e=null};ou.prototype.getInteriorIntersection=function(){return this.$e},ou.prototype.setCheckEndSegmentsOnly=function(A){this.Xe=A},ou.prototype.getIntersectionSegments=function(){return this.As},ou.prototype.count=function(){return this.ns},ou.prototype.getIntersections=function(){return this.ts},ou.prototype.setFindAllIntersections=function(A){this.Ze=A},ou.prototype.setKeepIntersections=function(A){this.rs=A},ou.prototype.processIntersections=function(A,t,n,i){if(!this.Ze&&this.hasIntersection())return null;if(A===n&&t===i)return null;if(this.Xe&&!this.isEndSegment(A,t)&&!this.isEndSegment(n,i))return null;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.er.computeIntersection(r,e,s,u),this.er.hasIntersection()&&this.er.isInteriorIntersection()&&(this.As=new Array(4).fill(null),this.As[0]=r,this.As[1]=e,this.As[2]=s,this.As[3]=u,this.$e=this.er.getIntersection(0),this.rs&&this.ts.add(this.$e),this.ns++)},ou.prototype.isEndSegment=function(A,t){return 0===t||t>=A.size()-2},ou.prototype.hasIntersection=function(){return null!==this.$e},ou.prototype.isDone=function(){return!this.Ze&&null!==this.$e},ou.prototype.interfaces_=function(){return[ls]},ou.prototype.getClass=function(){return ou},ou.createAllIntersectionsFinder=function(A){var t=new ou(A);return t.setFindAllIntersections(!0),t},ou.createAnyIntersectionFinder=function(A){return new ou(A)},ou.createIntersectionCounter=function(A){var t=new ou(A);return t.setFindAllIntersections(!0),t.setKeepIntersections(!1),t};var hu=function(){this.er=new si,this.$r=null,this.Ze=!1,this.Ni=null,this.qe=!0;var A=arguments[0];this.$r=A};hu.prototype.execute=function(){if(null!==this.Ni)return null;this.checkInteriorIntersections()},hu.prototype.getIntersections=function(){return this.Ni.getIntersections()},hu.prototype.isValid=function(){return this.execute(),this.qe},hu.prototype.setFindAllIntersections=function(A){this.Ze=A},hu.prototype.checkInteriorIntersections=function(){this.qe=!0,this.Ni=new ou(this.er),this.Ni.setFindAllIntersections(this.Ze);var A=new Ge;if(A.setSegmentIntersector(this.Ni),A.computeNodes(this.$r),this.Ni.hasIntersection())return this.qe=!1,null},hu.prototype.checkValid=function(){if(this.execute(),!this.qe)throw new Hr(this.getErrorMessage(),this.Ni.getInteriorIntersection())},hu.prototype.getErrorMessage=function(){if(this.qe)return"no intersections found";var A=this.Ni.getIntersectionSegments();return"found non-noded intersection between "+Ai.toLineString(A[0],A[1])+" and "+Ai.toLineString(A[2],A[3])},hu.prototype.interfaces_=function(){return[]},hu.prototype.getClass=function(){return hu},hu.computeIntersections=function(A){var t=new hu(A);return t.setFindAllIntersections(!0),t.isValid(),t.getIntersections()};var fu=function A(){this.es=null;var t=arguments[0];this.es=new hu(A.toSegmentStrings(t))};fu.prototype.checkValid=function(){this.es.checkValid()},fu.prototype.interfaces_=function(){return[]},fu.prototype.getClass=function(){return fu},fu.toSegmentStrings=function(A){for(var t=new yi,n=A.iterator();n.hasNext();){var i=n.next();t.add(new uu(i.getCoordinates(),i))}return t},fu.checkValid=function(A){new fu(A).checkValid()};var cu=function(A){this.ss=A};cu.prototype.map=function(A){for(var t=new yi,n=0;n<A.getNumGeometries();n++){var i=this.ss.map(A.getGeometryN(n));i.isEmpty()||t.add(i)}return A.getFactory().createGeometryCollection(jr.toGeometryArray(t))},cu.prototype.interfaces_=function(){return[]},cu.prototype.getClass=function(){return cu},cu.map=function(A,t){return new cu(t).map(A)};var au=function(){this.us=null,this.Rn=null,this.Oe=null,this.os=new yi,this.hs=new yi;var A=arguments[0],t=arguments[1],n=arguments[2];this.us=A,this.Rn=t,this.Oe=n};au.prototype.collectLines=function(A){for(var t=this.us.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next();this.collectLineEdge(n,A,this.os),this.collectBoundaryTouchEdge(n,A,this.os)}},au.prototype.labelIsolatedLine=function(A,t){var n=this.Oe.locate(A.getCoordinate(),this.us.getArgGeometry(t));A.getLabel().setLocation(t,n)},au.prototype.build=function(A){return this.findCoveredLineEdges(),this.collectLines(A),this.buildLines(A),this.hs},au.prototype.collectLineEdge=function(A,t,n){var i=A.getLabel(),r=A.getEdge();A.isLineEdge()&&(A.isVisited()||!Wu.isResultOfOp(i,t)||r.isCovered()||(n.add(r),A.setVisitedEdge(!0)))},au.prototype.findCoveredLineEdges=function(){for(var A=this.us.getGraph().getNodes().iterator();A.hasNext();)A.next().getEdges().findCoveredLineEdges();for(var t=this.us.getGraph().getEdgeEnds().iterator();t.hasNext();){var n=t.next(),i=n.getEdge();if(n.isLineEdge()&&!i.isCoveredSet()){var r=this.us.isCoveredByA(n.getCoordinate());i.setCovered(r)}}},au.prototype.labelIsolatedLines=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next(),i=n.getLabel();n.isIsolated()&&(i.isNull(0)?this.labelIsolatedLine(n,0):this.labelIsolatedLine(n,1))}},au.prototype.buildLines=function(A){for(var t=this.os.iterator();t.hasNext();){var n=t.next(),i=this.Rn.createLineString(n.getCoordinates());this.hs.add(i),n.setInResult(!0)}},au.prototype.collectBoundaryTouchEdge=function(A,t,n){var i=A.getLabel();return A.isLineEdge()||A.isVisited()||A.isInteriorAreaEdge()||A.getEdge().isInResult()?null:(ii.isTrue(!(A.isInResult()||A.getSym().isInResult())||!A.getEdge().isInResult()),void(Wu.isResultOfOp(i,t)&&t===Wu.INTERSECTION&&(n.add(A.getEdge()),A.setVisitedEdge(!0))))},au.prototype.interfaces_=function(){return[]},au.prototype.getClass=function(){return au};var vu=function(){this.us=null,this.Rn=null,this.fs=new yi;var A=arguments[0],t=arguments[1];this.us=A,this.Rn=t};vu.prototype.filterCoveredNodeToPoint=function(A){var t=A.getCoordinate();if(!this.us.isCoveredByLA(t)){var n=this.Rn.createPoint(t);this.fs.add(n)}},vu.prototype.extractNonCoveredResultNodes=function(A){for(var t=this.us.getGraph().getNodes().iterator();t.hasNext();){var n=t.next();if(!(n.isInResult()||n.isIncidentEdgeInResult()||0!==n.getEdges().getDegree()&&A!==Wu.INTERSECTION)){var i=n.getLabel();Wu.isResultOfOp(i,A)&&this.filterCoveredNodeToPoint(n)}}},vu.prototype.build=function(A){return this.extractNonCoveredResultNodes(A),this.fs},vu.prototype.interfaces_=function(){return[]},vu.prototype.getClass=function(){return vu};var lu=function(){this.Mr=null,this.vn=null,this.cs=!0,this.as=!0,this.vs=!1,this.ls=!1};lu.prototype.transformPoint=function(A,t){return this.vn.createPoint(this.transformCoordinates(A.getCoordinateSequence(),A))},lu.prototype.transformPolygon=function(A,t){var n=!0,i=this.transformLinearRing(A.getExteriorRing(),A);null!==i&&i instanceof Ir&&!i.isEmpty()||(n=!1);for(var r=new yi,e=0;e<A.getNumInteriorRing();e++){var s=this.transformLinearRing(A.getInteriorRingN(e),A);null===s||s.isEmpty()||(s instanceof Ir||(n=!1),r.add(s))}if(n)return this.vn.createPolygon(i,r.toArray([]));var u=new yi;return null!==i&&u.add(i),u.addAll(r),this.vn.buildGeometry(u)},lu.prototype.createCoordinateSequence=function(A){return this.vn.getCoordinateSequenceFactory().create(A)},lu.prototype.getInputGeometry=function(){return this.Mr},lu.prototype.transformMultiLineString=function(A,t){for(var n=new yi,i=0;i<A.getNumGeometries();i++){var r=this.transformLineString(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.vn.buildGeometry(n)},lu.prototype.transformCoordinates=function(A,t){return this.copy(A)},lu.prototype.transformLineString=function(A,t){return this.vn.createLineString(this.transformCoordinates(A.getCoordinateSequence(),A))},lu.prototype.transformMultiPoint=function(A,t){for(var n=new yi,i=0;i<A.getNumGeometries();i++){var r=this.transformPoint(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.vn.buildGeometry(n)},lu.prototype.transformMultiPolygon=function(A,t){for(var n=new yi,i=0;i<A.getNumGeometries();i++){var r=this.transformPolygon(A.getGeometryN(i),A);null!==r&&(r.isEmpty()||n.add(r))}return this.vn.buildGeometry(n)},lu.prototype.copy=function(A){return A.copy()},lu.prototype.transformGeometryCollection=function(A,t){for(var n=new yi,i=0;i<A.getNumGeometries();i++){var r=this.transform(A.getGeometryN(i));null!==r&&(this.cs&&r.isEmpty()||n.add(r))}return this.as?this.vn.createGeometryCollection(jr.toGeometryArray(n)):this.vn.buildGeometry(n)},lu.prototype.transform=function(A){if(this.Mr=A,this.vn=A.getFactory(),A instanceof Pr)return this.transformPoint(A,null);if(A instanceof Dr)return this.transformMultiPoint(A,null);if(A instanceof Ir)return this.transformLinearRing(A,null);if(A instanceof lr)return this.transformLineString(A,null);if(A instanceof nr)return this.transformMultiLineString(A,null);if(A instanceof Cr)return this.transformPolygon(A,null);if(A instanceof Mr)return this.transformMultiPolygon(A,null);if(A instanceof tr)return this.transformGeometryCollection(A,null);throw new Dn("Unknown Geometry subtype: "+A.getClass().getName())},lu.prototype.transformLinearRing=function(A,t){var n=this.transformCoordinates(A.getCoordinateSequence(),A);if(null===n)return this.vn.createLinearRing(null);var i=n.size();return i>0&&i<4&&!this.ls?this.vn.createLineString(n):this.vn.createLinearRing(n)},lu.prototype.interfaces_=function(){return[]},lu.prototype.getClass=function(){return lu};var wu=function A(){if(this.ws=0,this.Ps=null,this.gr=new Ne,this.gs=!1,this.Cs=!1,arguments[0]instanceof lr&&"number"==typeof arguments[1]){var t=arguments[0],n=arguments[1];A.call(this,t.getCoordinates(),n)}else if(arguments[0]instanceof Array&&"number"==typeof arguments[1]){var i=arguments[0],r=arguments[1];this.Ps=i,this.Cs=A.isClosed(i),this.ws=r}};wu.prototype.snapVertices=function(A,t){for(var n=this.Cs?A.size()-1:A.size(),i=0;i<n;i++){var r=A.get(i),e=this.findSnapForVertex(r,t);null!==e&&(A.set(i,new mn(e)),0===i&&this.Cs&&A.set(A.size()-1,new mn(e)))}},wu.prototype.findSnapForVertex=function(A,t){for(var n=0;n<t.length;n++){if(A.equals2D(t[n]))return null;if(A.distance(t[n])<this.ws)return t[n]}return null},wu.prototype.snapTo=function(A){var t=new Li(this.Ps);return this.snapVertices(t,A),this.snapSegments(t,A),t.toCoordinateArray()},wu.prototype.snapSegments=function(A,t){if(0===t.length)return null;var n=t.length;t[0].equals2D(t[t.length-1])&&(n=t.length-1);for(var i=0;i<n;i++){var r=t[i],e=this.findSegmentIndexToSnap(r,A);e>=0&&A.add(e+1,new mn(r),!1)}},wu.prototype.findSegmentIndexToSnap=function(A,t){for(var n=In.MAX_VALUE,i=-1,r=0;r<t.size()-1;r++){if(this.gr.p0=t.get(r),this.gr.p1=t.get(r+1),this.gr.p0.equals2D(A)||this.gr.p1.equals2D(A)){if(this.gs)continue;return-1}var e=this.gr.distance(A);e<this.ws&&e<n&&(n=e,i=r)}return i},wu.prototype.setAllowSnappingToSourceVertices=function(A){this.gs=A},wu.prototype.interfaces_=function(){return[]},wu.prototype.getClass=function(){return wu},wu.isClosed=function(A){return!(A.length<=1)&&A[0].equals2D(A[A.length-1])};var Pu=function(A){this.Ds=A||null},gu={SNAP_PRECISION_FACTOR:{configurable:!0}};Pu.prototype.snapTo=function(A,t){var n=this.extractTargetCoordinates(A);return new Cu(t,n).transform(this.Ds)},Pu.prototype.snapToSelf=function(A,t){var n=this.extractTargetCoordinates(this.Ds),i=new Cu(A,n,!0).transform(this.Ds),r=i;return t&&Fn(r,gr)&&(r=i.buffer(0)),r},Pu.prototype.computeSnapTolerance=function(A){return this.computeMinimumSegmentLength(A)/10},Pu.prototype.extractTargetCoordinates=function(A){for(var t=new Ki,n=A.getCoordinates(),i=0;i<n.length;i++)t.add(n[i]);return t.toArray(new Array(0).fill(null))},Pu.prototype.computeMinimumSegmentLength=function(A){for(var t=In.MAX_VALUE,n=0;n<A.length-1;n++){var i=A[n].distance(A[n+1]);i<t&&(t=i)}return t},Pu.prototype.interfaces_=function(){return[]},Pu.prototype.getClass=function(){return Pu},Pu.snap=function(A,t,n){var i=new Array(2).fill(null),r=new Pu(A);i[0]=r.snapTo(t,n);var e=new Pu(t);return i[1]=e.snapTo(i[0],n),i},Pu.computeOverlaySnapTolerance=function(){if(1===arguments.length){var A=arguments[0],t=Pu.computeSizeBasedSnapTolerance(A),n=A.getPrecisionModel();if(n.getType()===Fr.FIXED){var i=1/n.getScale()*2/1.415;i>t&&(t=i)}return t}if(2===arguments.length){var r=arguments[0],e=arguments[1];return Math.min(Pu.computeOverlaySnapTolerance(r),Pu.computeOverlaySnapTolerance(e))}},Pu.computeSizeBasedSnapTolerance=function(A){var t=A.getEnvelopeInternal();return Math.min(t.getHeight(),t.getWidth())*Pu.SNAP_PRECISION_FACTOR},Pu.snapToSelf=function(A,t,n){return new Pu(A).snapToSelf(t,n)},gu.SNAP_PRECISION_FACTOR.get=function(){return 1e-9},Object.defineProperties(Pu,gu);var Cu=function(A){function t(t,n,i){A.call(this),this.ws=t||null,this.Is=n||null,this.Ms=void 0!==i&&i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.snapLine=function(A,t){var n=new wu(A,this.ws);return n.setAllowSnappingToSourceVertices(this.Ms),n.snapTo(t)},t.prototype.transformCoordinates=function(A,t){var n=A.toCoordinateArray(),i=this.snapLine(n,this.Is);return this.vn.getCoordinateSequenceFactory().create(i)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(lu),Du=function(){this.bs=!0,this.zs=53,this.ds=0,this.xs=null};Du.prototype.getCommon=function(){return In.longBitsToDouble(this.ds)},Du.prototype.add=function(A){var t=In.doubleToLongBits(A);return this.bs?(this.ds=t,this.xs=Du.signExpBits(this.ds),this.bs=!1,null):Du.signExpBits(t)!==this.xs?(this.ds=0,null):(this.zs=Du.numCommonMostSigMantissaBits(this.ds,t),void(this.ds=Du.zeroLowerBits(this.ds,64-(12+this.zs))))},Du.prototype.toString=function(){if(1===arguments.length){var A=arguments[0],t=In.longBitsToDouble(A),n=In.toBinaryString(A),i="0000000000000000000000000000000000000000000000000000000000000000"+n,r=i.substring(i.length-64),e=r.substring(0,1)+"  "+r.substring(1,12)+"(exp) "+r.substring(12)+" [ "+t+" ]";return e}},Du.prototype.interfaces_=function(){return[]},Du.prototype.getClass=function(){return Du},Du.getBit=function(A,t){return 0!=(A&1<<t)?1:0},Du.signExpBits=function(A){return A>>52},Du.zeroLowerBits=function(A,t){return A&~((1<<t)-1)},Du.numCommonMostSigMantissaBits=function(A,t){for(var n=0,i=52;i>=0;i--){if(Du.getBit(A,i)!==Du.getBit(t,i))return n;n++}return 52};var Iu=function(){this.ms=null,this.ys=new bu},Mu={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Iu.prototype.addCommonBits=function(A){var t=new zu(this.ms);A.apply(t),A.geometryChanged()},Iu.prototype.removeCommonBits=function(A){if(0===this.ms.x&&0===this.ms.y)return A;var t=new mn(this.ms);t.x=-t.x,t.y=-t.y;var n=new zu(t);return A.apply(n),A.geometryChanged(),A},Iu.prototype.getCommonCoordinate=function(){return this.ms},Iu.prototype.add=function(A){A.apply(this.ys),this.ms=this.ys.getCommonCoordinate()},Iu.prototype.interfaces_=function(){return[]},Iu.prototype.getClass=function(){return Iu},Mu.CommonCoordinateFilter.get=function(){return bu},Mu.Translater.get=function(){return zu},Object.defineProperties(Iu,Mu);var bu=function(){this.ps=new Du,this.Ls=new Du};bu.prototype.filter=function(A){this.ps.add(A.x),this.Ls.add(A.y)},bu.prototype.getCommonCoordinate=function(){return new mn(this.ps.getCommon(),this.Ls.getCommon())},bu.prototype.interfaces_=function(){return[wi]},bu.prototype.getClass=function(){return bu};var zu=function(){this.trans=null;var A=arguments[0];this.trans=A};zu.prototype.filter=function(A,t){var n=A.getOrdinate(t,0)+this.trans.x,i=A.getOrdinate(t,1)+this.trans.y;A.setOrdinate(t,0,n),A.setOrdinate(t,1,i)},zu.prototype.isDone=function(){return!1},zu.prototype.isGeometryChanged=function(){return!0},zu.prototype.interfaces_=function(){return[Ar]},zu.prototype.getClass=function(){return zu};var du=function(A,t){this.Pn=new Array(2).fill(null),this.ws=null,this.Ts=null,this.Pn[0]=A,this.Pn[1]=t,this.computeSnapTolerance()};du.prototype.selfSnap=function(A){return new Pu(A).snapTo(A,this.ws)},du.prototype.removeCommonBits=function(A){this.Ts=new Iu,this.Ts.add(A[0]),this.Ts.add(A[1]);var t=new Array(2).fill(null);return t[0]=this.Ts.removeCommonBits(A[0].copy()),t[1]=this.Ts.removeCommonBits(A[1].copy()),t},du.prototype.prepareResult=function(A){return this.Ts.addCommonBits(A),A},du.prototype.getResultGeometry=function(A){var t=this.snap(this.Pn),n=Wu.overlayOp(t[0],t[1],A);return this.prepareResult(n)},du.prototype.checkValid=function(A){A.isValid()||Wn.out.println("Snapped geometry is invalid")},du.prototype.computeSnapTolerance=function(){this.ws=Pu.computeOverlaySnapTolerance(this.Pn[0],this.Pn[1])},du.prototype.snap=function(A){var t=this.removeCommonBits(A);return Pu.snap(t[0],t[1],this.ws)},du.prototype.interfaces_=function(){return[]},du.prototype.getClass=function(){return du},du.overlayOp=function(A,t,n){return new du(A,t).getResultGeometry(n)},du.union=function(A,t){return du.overlayOp(A,t,Wu.UNION)},du.intersection=function(A,t){return du.overlayOp(A,t,Wu.INTERSECTION)},du.symDifference=function(A,t){return du.overlayOp(A,t,Wu.SYMDIFFERENCE)},du.difference=function(A,t){return du.overlayOp(A,t,Wu.DIFFERENCE)};var xu=function(A,t){this.Pn=new Array(2).fill(null),this.Pn[0]=A,this.Pn[1]=t};xu.prototype.getResultGeometry=function(A){var t=null,n=!1,i=null;try{t=Wu.overlayOp(this.Pn[0],this.Pn[1],A),n=!0}catch(A){if(!(A instanceof ti))throw A;i=A}if(!n)try{t=du.overlayOp(this.Pn[0],this.Pn[1],A)}catch(A){throw A instanceof ti?i:A}return t},xu.prototype.interfaces_=function(){return[]},xu.prototype.getClass=function(){return xu},xu.overlayOp=function(A,t,n){return new xu(A,t).getResultGeometry(n)},xu.union=function(A,t){return xu.overlayOp(A,t,Wu.UNION)},xu.intersection=function(A,t){return xu.overlayOp(A,t,Wu.INTERSECTION)},xu.symDifference=function(A,t){return xu.overlayOp(A,t,Wu.SYMDIFFERENCE)},xu.difference=function(A,t){return xu.overlayOp(A,t,Wu.DIFFERENCE)};var mu=function(){this.mce=null,this.chainIndex=null;var A=arguments[0],t=arguments[1];this.mce=A,this.chainIndex=t};mu.prototype.computeIntersections=function(A,t){this.mce.computeIntersectsForChain(this.chainIndex,A.mce,A.chainIndex,t)},mu.prototype.interfaces_=function(){return[]},mu.prototype.getClass=function(){return mu};var yu=function A(){if(this.Sn=null,this.Os=null,this.Fs=null,this.Us=null,this.Es=null,this.Ns=null,2===arguments.length){var t=arguments[0],n=arguments[1];this.Fs=A.DELETE,this.Os=t,this.Us=n}else if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.Fs=A.INSERT,this.Sn=i,this.Os=r,this.Ns=e}},pu={INSERT:{configurable:!0},DELETE:{configurable:!0}};yu.prototype.isDelete=function(){return this.Fs===yu.DELETE},yu.prototype.setDeleteEventIndex=function(A){this.Es=A},yu.prototype.getObject=function(){return this.Ns},yu.prototype.compareTo=function(A){return this.Os<A.Os?-1:this.Os>A.Os?1:this.Fs<A.Fs?-1:this.Fs>A.Fs?1:0},yu.prototype.getInsertEvent=function(){return this.Us},yu.prototype.isInsert=function(){return this.Fs===yu.INSERT},yu.prototype.isSameLabel=function(A){return null!==this.Sn&&this.Sn===A.Sn},yu.prototype.getDeleteEventIndex=function(){return this.Es},yu.prototype.interfaces_=function(){return[bn]},yu.prototype.getClass=function(){return yu},pu.INSERT.get=function(){return 1},pu.DELETE.get=function(){return 2},Object.defineProperties(yu,pu);var Lu=function(){};Lu.prototype.interfaces_=function(){return[]},Lu.prototype.getClass=function(){return Lu};var Tu=function(){this.jr=!1,this.Qr=!1,this.Sr=!1,this.Br=null,this.er=null,this.js=null,this.Qs=null,this.Rr=null,this.Ss=0,this.numTests=0,this.ks=null,this.Bs=!1,this.Rs=!1;var A=arguments[0],t=arguments[1],n=arguments[2];this.er=A,this.js=t,this.Qs=n};Tu.prototype.isTrivialIntersection=function(A,t,n,i){if(A===n&&1===this.er.getIntersectionNum()){if(Tu.isAdjacentSegments(t,i))return!0;if(A.isClosed()){var r=A.getNumPoints()-1;if(0===t&&i===r||0===i&&t===r)return!0}}return!1},Tu.prototype.getProperIntersectionPoint=function(){return this.Br},Tu.prototype.setIsDoneIfProperInt=function(A){this.Rs=A},Tu.prototype.hasProperInteriorIntersection=function(){return this.Sr},Tu.prototype.isBoundaryPointInternal=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next().getCoordinate();if(A.isIntersection(i))return!0}return!1},Tu.prototype.hasProperIntersection=function(){return this.Qr},Tu.prototype.hasIntersection=function(){return this.jr},Tu.prototype.isDone=function(){return this.Bs},Tu.prototype.isBoundaryPoint=function(A,t){return!(null===t||!this.isBoundaryPointInternal(A,t[0])&&!this.isBoundaryPointInternal(A,t[1]))},Tu.prototype.setBoundaryNodes=function(A,t){this.ks=new Array(2).fill(null),this.ks[0]=A,this.ks[1]=t},Tu.prototype.addIntersections=function(A,t,n,i){if(A===n&&t===i)return null;this.numTests++;var r=A.getCoordinates()[t],e=A.getCoordinates()[t+1],s=n.getCoordinates()[i],u=n.getCoordinates()[i+1];this.er.computeIntersection(r,e,s,u),this.er.hasIntersection()&&(this.Qs&&(A.setIsolated(!1),n.setIsolated(!1)),this.Ss++,this.isTrivialIntersection(A,t,n,i)||(this.jr=!0,!this.js&&this.er.isProper()||(A.addIntersections(this.er,t,0),n.addIntersections(this.er,i,1)),this.er.isProper()&&(this.Br=this.er.getIntersection(0).copy(),this.Qr=!0,this.Rs&&(this.Bs=!0),this.isBoundaryPoint(this.er,this.ks)||(this.Sr=!0))))},Tu.prototype.interfaces_=function(){return[]},Tu.prototype.getClass=function(){return Tu},Tu.isAdjacentSegments=function(A,t){return 1===Math.abs(A-t)};var Ou=function(A){function t(){A.call(this),this.events=new yi,this.nOverlaps=null}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.prepareEvents=function(){Ie.sort(this.events);for(var A=0;A<this.events.size();A++){var t=this.events.get(A);t.isDelete()&&t.getInsertEvent().setDeleteEventIndex(A)}},t.prototype.computeIntersections=function(){var A=this;if(1===arguments.length){var t=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var n=0;n<this.events.size();n++){var i=A.events.get(n);if(i.isInsert()&&A.processOverlaps(n,i.getDeleteEventIndex(),i,t),t.isDone())break}}else if(3===arguments.length)if(arguments[2]instanceof Tu&&Fn(arguments[0],xi)&&Fn(arguments[1],xi)){var r=arguments[0],e=arguments[1],s=arguments[2];this.addEdges(r,r),this.addEdges(e,e),this.computeIntersections(s)}else if("boolean"==typeof arguments[2]&&Fn(arguments[0],xi)&&arguments[1]instanceof Tu){var u=arguments[0],o=arguments[1],h=arguments[2];h?this.addEdges(u,null):this.addEdges(u),this.computeIntersections(o)}},t.prototype.addEdge=function(A,t){for(var n=A.getMonotoneChainEdge(),i=n.getStartIndexes(),r=0;r<i.length-1;r++){var e=new mu(n,r),s=new yu(t,n.getMinX(r),e);this.events.add(s),this.events.add(new yu(n.getMaxX(r),s))}},t.prototype.processOverlaps=function(A,t,n,i){for(var r=n.getObject(),e=A;e<t;e++){var s=this.events.get(e);if(s.isInsert()){var u=s.getObject();n.isSameLabel(s)||(r.computeIntersections(u,i),this.nOverlaps++)}}},t.prototype.addEdges=function(){var A=this;if(1===arguments.length)for(var t=arguments[0],n=t.iterator();n.hasNext();){var i=n.next();A.addEdge(i,i)}else if(2===arguments.length)for(var r=arguments[0],e=arguments[1],s=r.iterator();s.hasNext();){var u=s.next();A.addEdge(u,e)}},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Lu),Fu=function(){this.Gs=In.POSITIVE_INFINITY,this.mr=In.NEGATIVE_INFINITY},Uu={NodeComparator:{configurable:!0}};Fu.prototype.getMin=function(){return this.Gs},Fu.prototype.intersects=function(A,t){return!(this.Gs>t||this.mr<A)},Fu.prototype.getMax=function(){return this.mr},Fu.prototype.toString=function(){return Ai.toLineString(new mn(this.Gs,0),new mn(this.mr,0))},Fu.prototype.interfaces_=function(){return[]},Fu.prototype.getClass=function(){return Fu},Uu.NodeComparator.get=function(){return Eu},Object.defineProperties(Fu,Uu);var Eu=function(){};Eu.prototype.compare=function(A,t){var r=(A.Gs+A.mr)/2,e=(t.Gs+t.mr)/2;return r<e?-1:r>e?1:0},Eu.prototype.interfaces_=function(){return[dn]},Eu.prototype.getClass=function(){return Eu};var Nu=function(A){function t(){A.call(this),this.fi=null;var t=arguments[0],n=arguments[1],i=arguments[2];this.Gs=t,this.mr=n,this.fi=i}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;n.visitItem(this.fi)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Fu),ju=function(A){function t(){A.call(this),this.Ys=null,this.qs=null;var t=arguments[0],n=arguments[1];this.Ys=t,this.qs=n,this.buildExtent(this.Ys,this.qs)}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.buildExtent=function(A,t){this.Gs=Math.min(A.Gs,t.Gs),this.mr=Math.max(A.mr,t.mr)},t.prototype.query=function(A,t,n){if(!this.intersects(A,t))return null;null!==this.Ys&&this.Ys.query(A,t,n),null!==this.qs&&this.qs.query(A,t,n)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(Fu),Qu=function(){this.Vs=new yi,this.Di=null,this.li=0};Qu.prototype.buildTree=function(){Ie.sort(this.Vs,new Fu.NodeComparator);for(var A=this.Vs,t=null,n=new yi;;){if(this.buildLevel(A,n),1===n.size())return n.get(0);t=A,A=n,n=t}},Qu.prototype.insert=function(A,t,n){if(null!==this.Di)throw new Error("Index cannot be added to once it has been queried");this.Vs.add(new Nu(A,t,n))},Qu.prototype.query=function(A,t,n){this.init(),this.Di.query(A,t,n)},Qu.prototype.buildRoot=function(){if(null!==this.Di)return null;this.Di=this.buildTree()},Qu.prototype.printNode=function(A){Wn.out.println(Ai.toLineString(new mn(A.Gs,this.li),new mn(A.mr,this.li)))},Qu.prototype.init=function(){if(null!==this.Di)return null;this.buildRoot()},Qu.prototype.buildLevel=function(A,t){this.li++,t.clear();for(var n=0;n<A.size();n+=2){var i=A.get(n);if(null===(n+1<A.size()?A.get(n):null))t.add(i);else{var r=new ju(A.get(n),A.get(n+1));t.add(r)}}},Qu.prototype.interfaces_=function(){return[]},Qu.prototype.getClass=function(){return Qu};var Su=function(){this.ai=new yi};Su.prototype.visitItem=function(A){this.ai.add(A)},Su.prototype.getItems=function(){return this.ai},Su.prototype.interfaces_=function(){return[Pe]},Su.prototype.getClass=function(){return Su};var ku=function(){this.Qi=null;var A=arguments[0];if(!Fn(A,gr))throw new Dn("Argument must be Polygonal");this.Qi=new Gu(A)},Bu={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};ku.prototype.locate=function(A){var t=new oi(A),n=new Ru(t);return this.Qi.query(A.y,A.y,n),t.getLocation()},ku.prototype.interfaces_=function(){return[ss]},ku.prototype.getClass=function(){return ku},Bu.SegmentVisitor.get=function(){return Ru},Bu.IntervalIndexedGeometry.get=function(){return Gu},Object.defineProperties(ku,Bu);var Ru=function(){this.Ws=null;var A=arguments[0];this.Ws=A};Ru.prototype.visitItem=function(A){var t=A;this.Ws.countSegment(t.getCoordinate(0),t.getCoordinate(1))},Ru.prototype.interfaces_=function(){return[Pe]},Ru.prototype.getClass=function(){return Ru};var Gu=function(){this.Qi=new Qu;var A=arguments[0];this.init(A)};Gu.prototype.init=function(A){for(var t=qs.getLines(A).iterator();t.hasNext();){var n=t.next().getCoordinates();this.addLine(n)}},Gu.prototype.addLine=function(A){for(var t=1;t<A.length;t++){var n=new Ne(A[t-1],A[t]),i=Math.min(n.p0.y,n.p1.y),r=Math.max(n.p0.y,n.p1.y);this.Qi.insert(i,r,n)}},Gu.prototype.query=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new Su;return this.Qi.query(A,t,n),n.getItems()}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2];this.Qi.query(i,r,e)}},Gu.prototype.interfaces_=function(){return[]},Gu.prototype.getClass=function(){return Gu};var Yu=function(A){function t(){if(A.call(this),this._s=null,this.Ks=new Or,this.Hs=null,this.Js=!0,this.Zs=null,this.Xs=null,this.$s=!1,this.Au=null,this.tu=null,this.Oe=new Vs,2===arguments.length){var t=arguments[0],n=arguments[1],i=Pi.OGC_SFS_BOUNDARY_RULE;this.Zs=t,this._s=n,this.Hs=i,null!==n&&this.add(n)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];this.Zs=r,this._s=e,this.Hs=s,null!==e&&this.add(e)}}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertBoundaryPoint=function(A,n){var i=this.On.addNode(n).getLabel(),r=1;i.getLocation(A,qr.ON)===Tn.BOUNDARY&&r++;var e=t.determineBoundary(this.Hs,r);i.setLocation(A,e)},t.prototype.computeSelfNodes=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1];return this.computeSelfNodes(A,t,!1)}if(3===arguments.length){var n=arguments[0],i=arguments[1],r=arguments[2],e=new Tu(n,!0,!1);e.setIsDoneIfProperInt(r);var s=this.createEdgeSetIntersector(),u=this._s instanceof Ir||this._s instanceof Cr||this._s instanceof Mr,o=i||!u;return s.computeIntersections(this.jn,e,o),this.addSelfIntersectionNodes(this.Zs),e}},t.prototype.computeSplitEdges=function(A){for(var t=this.jn.iterator();t.hasNext();)t.next().eiList.addSplitEdges(A)},t.prototype.computeEdgeIntersections=function(A,t,n){var i=new Tu(t,n,!0);return i.setBoundaryNodes(this.getBoundaryNodes(),A.getBoundaryNodes()),this.createEdgeSetIntersector().computeIntersections(this.jn,A.jn,i),i},t.prototype.getGeometry=function(){return this._s},t.prototype.getBoundaryNodeRule=function(){return this.Hs},t.prototype.hasTooFewPoints=function(){return this.$s},t.prototype.addPoint=function(){if(arguments[0]instanceof Pr){var A=arguments[0],t=A.getCoordinate();this.insertPoint(this.Zs,t,Tn.INTERIOR)}else if(arguments[0]instanceof mn){var n=arguments[0];this.insertPoint(this.Zs,n,Tn.INTERIOR)}},t.prototype.addPolygon=function(A){this.addPolygonRing(A.getExteriorRing(),Tn.EXTERIOR,Tn.INTERIOR);for(var t=0;t<A.getNumInteriorRing();t++){var n=A.getInteriorRingN(t);this.addPolygonRing(n,Tn.INTERIOR,Tn.EXTERIOR)}},t.prototype.addEdge=function(A){this.insertEdge(A);var t=A.getCoordinates();this.insertPoint(this.Zs,t[0],Tn.BOUNDARY),this.insertPoint(this.Zs,t[t.length-1],Tn.BOUNDARY)},t.prototype.addLineString=function(A){var t=Ti.removeRepeatedPoints(A.getCoordinates());if(t.length<2)return this.$s=!0,this.Au=t[0],null;var n=new bs(t,new $r(this.Zs,Tn.INTERIOR));this.Ks.put(A,n),this.insertEdge(n),ii.isTrue(t.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this.Zs,t[0]),this.insertBoundaryPoint(this.Zs,t[t.length-1])},t.prototype.getInvalidPoint=function(){return this.Au},t.prototype.getBoundaryPoints=function(){for(var A=this.getBoundaryNodes(),t=new Array(A.size()).fill(null),n=0,i=A.iterator();i.hasNext();){var r=i.next();t[n++]=r.getCoordinate().copy()}return t},t.prototype.getBoundaryNodes=function(){return null===this.Xs&&(this.Xs=this.On.getBoundaryNodes(this.Zs)),this.Xs},t.prototype.addSelfIntersectionNode=function(A,t,n){if(this.isBoundaryNode(A,t))return null;n===Tn.BOUNDARY&&this.Js?this.insertBoundaryPoint(A,t):this.insertPoint(A,t,n)},t.prototype.addPolygonRing=function(A,t,n){if(A.isEmpty())return null;var i=Ti.removeRepeatedPoints(A.getCoordinates());if(i.length<4)return this.$s=!0,this.Au=i[0],null;var r=t,e=n;hi.isCCW(i)&&(r=n,e=t);var s=new bs(i,new $r(this.Zs,Tn.BOUNDARY,r,e));this.Ks.put(A,s),this.insertEdge(s),this.insertPoint(this.Zs,i[0],Tn.BOUNDARY)},t.prototype.insertPoint=function(A,t,n){var i=this.On.addNode(t),r=i.getLabel();null===r?i.Sn=new $r(A,n):r.setLocation(A,n)},t.prototype.createEdgeSetIntersector=function(){return new Ou},t.prototype.addSelfIntersectionNodes=function(A){for(var t=this.jn.iterator();t.hasNext();)for(var n=t.next(),i=n.getLabel().getLocation(A),r=n.eiList.iterator();r.hasNext();){var e=r.next();this.addSelfIntersectionNode(A,e.coord,i)}},t.prototype.add=function(){if(1!==arguments.length)return A.prototype.add.apply(this,arguments);var t=arguments[0];if(t.isEmpty())return null;if(t instanceof Mr&&(this.Js=!1),t instanceof Cr)this.addPolygon(t);else if(t instanceof lr)this.addLineString(t);else if(t instanceof Pr)this.addPoint(t);else if(t instanceof Dr)this.addCollection(t);else if(t instanceof nr)this.addCollection(t);else if(t instanceof Mr)this.addCollection(t);else{if(!(t instanceof tr))throw new Error(t.getClass().getName());this.addCollection(t)}},t.prototype.addCollection=function(A){for(var t=0;t<A.getNumGeometries();t++){var n=A.getGeometryN(t);this.add(n)}},t.prototype.locate=function(A){return Fn(this._s,gr)&&this._s.getNumGeometries()>50?(null===this.tu&&(this.tu=new ku(this._s)),this.tu.locate(A)):this.Oe.locate(A,this._s)},t.prototype.findEdge=function(){if(1===arguments.length){var t=arguments[0];return this.Ks.get(t)}return A.prototype.findEdge.apply(this,arguments)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t.determineBoundary=function(A,t){return A.isInBoundary(t)?Tn.BOUNDARY:Tn.INTERIOR},t}(ce),qu=function(){if(this.er=new si,this.nu=null,this.iu=null,1===arguments.length){var A=arguments[0];this.setComputationPrecision(A.getPrecisionModel()),this.iu=new Array(1).fill(null),this.iu[0]=new Yu(0,A)}else if(2===arguments.length){var t=arguments[0],n=arguments[1],i=Pi.OGC_SFS_BOUNDARY_RULE;t.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(t.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this.iu=new Array(2).fill(null),this.iu[0]=new Yu(0,t,i),this.iu[1]=new Yu(1,n,i)}else if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];r.getPrecisionModel().compareTo(e.getPrecisionModel())>=0?this.setComputationPrecision(r.getPrecisionModel()):this.setComputationPrecision(e.getPrecisionModel()),this.iu=new Array(2).fill(null),this.iu[0]=new Yu(0,r,s),this.iu[1]=new Yu(1,e,s)}};qu.prototype.getArgGeometry=function(A){return this.iu[A].getGeometry()},qu.prototype.setComputationPrecision=function(A){this.nu=A,this.er.setPrecisionModel(this.nu)},qu.prototype.interfaces_=function(){return[]},qu.prototype.getClass=function(){return qu};var Vu=function(){};Vu.prototype.interfaces_=function(){return[]},Vu.prototype.getClass=function(){return Vu},Vu.map=function(){if(arguments[0]instanceof ai&&Fn(arguments[1],Vu.MapOp)){for(var A=arguments[0],t=arguments[1],n=new yi,i=0;i<A.getNumGeometries();i++){var r=t.map(A.getGeometryN(i));null!==r&&n.add(r)}return A.getFactory().buildGeometry(n)}if(Fn(arguments[0],bi)&&Fn(arguments[1],Vu.MapOp)){for(var e=arguments[0],s=arguments[1],u=new yi,o=e.iterator();o.hasNext();){var h=o.next(),f=s.map(h);null!==f&&u.add(f)}return u}},Vu.MapOp=function(){};var Wu=function(A){function t(){var t=arguments[0],n=arguments[1];A.call(this,t,n),this.Oe=new Vs,this.gn=null,this.ru=null,this._r=null,this.Lr=new vs,this.eu=new yi,this.hs=new yi,this.fs=new yi,this._r=new ce(new cs),this.gn=t.getFactory()}return A&&(t.__proto__=A),(t.prototype=Object.create(A&&A.prototype)).constructor=t,t.prototype.insertUniqueEdge=function(A){var t=this.Lr.findEqualEdge(A);if(null!==t){var n=t.getLabel(),i=A.getLabel();t.isPointwiseEqual(A)||(i=new $r(A.getLabel())).flip();var r=t.getDepth();r.isNull()&&r.add(n),r.add(i),n.merge(i)}else this.Lr.add(A)},t.prototype.getGraph=function(){return this._r},t.prototype.cancelDuplicateResultEdges=function(){for(var A=this._r.getEdgeEnds().iterator();A.hasNext();){var t=A.next(),n=t.getSym();t.isInResult()&&n.isInResult()&&(t.setInResult(!1),n.setInResult(!1))}},t.prototype.isCoveredByLA=function(A){return!!this.isCovered(A,this.hs)||!!this.isCovered(A,this.eu)},t.prototype.computeGeometry=function(A,n,i,r){var e=new yi;return e.addAll(A),e.addAll(n),e.addAll(i),e.isEmpty()?t.createEmptyResult(r,this.iu[0].getGeometry(),this.iu[1].getGeometry(),this.gn):this.gn.buildGeometry(e)},t.prototype.mergeSymLabels=function(){for(var A=this._r.getNodes().iterator();A.hasNext();)A.next().getEdges().mergeSymLabels()},t.prototype.isCovered=function(A,t){for(var n=t.iterator();n.hasNext();){var i=n.next();if(this.Oe.locate(A,i)!==Tn.EXTERIOR)return!0}return!1},t.prototype.replaceCollapsedEdges=function(){for(var A=new yi,t=this.Lr.iterator();t.hasNext();){var n=t.next();n.isCollapsed()&&(t.remove(),A.add(n.getCollapsedEdge()))}this.Lr.addAll(A)},t.prototype.updateNodeLabelling=function(){for(var A=this._r.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getEdges().getLabel();t.getLabel().merge(n)}},t.prototype.getResultGeometry=function(A){return this.computeOverlay(A),this.ru},t.prototype.insertUniqueEdges=function(A){for(var t=A.iterator();t.hasNext();){var n=t.next();this.insertUniqueEdge(n)}},t.prototype.computeOverlay=function(A){this.copyPoints(0),this.copyPoints(1),this.iu[0].computeSelfNodes(this.er,!1),this.iu[1].computeSelfNodes(this.er,!1),this.iu[0].computeEdgeIntersections(this.iu[1],this.er,!0);var t=new yi;this.iu[0].computeSplitEdges(t),this.iu[1].computeSplitEdges(t),this.insertUniqueEdges(t),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),fu.checkValid(this.Lr.getEdges()),this._r.addEdges(this.Lr.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(A),this.cancelDuplicateResultEdges();var n=new ae(this.gn);n.add(this._r),this.eu=n.getPolygons();var i=new au(this,this.gn,this.Oe);this.hs=i.build(A);var r=new vu(this,this.gn,this.Oe);this.fs=r.build(A),this.ru=this.computeGeometry(this.fs,this.hs,this.eu,A)},t.prototype.labelIncompleteNode=function(A,t){var n=this.Oe.locate(A.getCoordinate(),this.iu[t].getGeometry());A.getLabel().setLocation(t,n)},t.prototype.copyPoints=function(A){for(var t=this.iu[A].getNodeIterator();t.hasNext();){var n=t.next();this._r.addNode(n.getCoordinate()).setLabel(A,n.getLabel().getLocation(A))}},t.prototype.findResultAreaEdges=function(A){for(var n=this._r.getEdgeEnds().iterator();n.hasNext();){var i=n.next(),r=i.getLabel();r.isArea()&&!i.isInteriorAreaEdge()&&t.isResultOfOp(r.getLocation(0,qr.RIGHT),r.getLocation(1,qr.RIGHT),A)&&i.setInResult(!0)}},t.prototype.computeLabelsFromDepths=function(){for(var A=this.Lr.iterator();A.hasNext();){var t=A.next(),n=t.getLabel(),i=t.getDepth();if(!i.isNull()){i.normalize();for(var r=0;r<2;r++)n.isNull(r)||!n.isArea()||i.isNull(r)||(0===i.getDelta(r)?n.toLine(r):(ii.isTrue(!i.isNull(r,qr.LEFT),"depth of LEFT side has not been initialized"),n.setLocation(r,qr.LEFT,i.getLocation(r,qr.LEFT)),ii.isTrue(!i.isNull(r,qr.RIGHT),"depth of RIGHT side has not been initialized"),n.setLocation(r,qr.RIGHT,i.getLocation(r,qr.RIGHT))))}}},t.prototype.computeLabelling=function(){for(var A=this._r.getNodes().iterator();A.hasNext();)A.next().getEdges().computeLabelling(this.iu);this.mergeSymLabels(),this.updateNodeLabelling()},t.prototype.labelIncompleteNodes=function(){for(var A=this._r.getNodes().iterator();A.hasNext();){var t=A.next(),n=t.getLabel();t.isIsolated()&&(n.isNull(0)?this.labelIncompleteNode(t,0):this.labelIncompleteNode(t,1)),t.getEdges().updateLabelling(n)}},t.prototype.isCoveredByA=function(A){return!!this.isCovered(A,this.eu)},t.prototype.interfaces_=function(){return[]},t.prototype.getClass=function(){return t},t}(qu);Wu.overlayOp=function(A,t,n){return new Wu(A,t).getResultGeometry(n)},Wu.intersection=function(A,t){if(A.isEmpty()||t.isEmpty())return Wu.createEmptyResult(Wu.INTERSECTION,A,t,A.getFactory());if(A.isGeometryCollection()){var n=t;return cu.map(A,{interfaces_:function(){return[Vu.MapOp]},map:function(A){return A.intersection(n)}})}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),xu.overlayOp(A,t,Wu.INTERSECTION)},Wu.symDifference=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Wu.createEmptyResult(Wu.SYMDIFFERENCE,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),xu.overlayOp(A,t,Wu.SYMDIFFERENCE)},Wu.resultDimension=function(A,t,n){var i=t.getDimension(),r=n.getDimension(),e=-1;switch(A){case Wu.INTERSECTION:e=Math.min(i,r);break;case Wu.UNION:e=Math.max(i,r);break;case Wu.DIFFERENCE:e=i;break;case Wu.SYMDIFFERENCE:e=Math.max(i,r)}return e},Wu.createEmptyResult=function(A,t,n,i){var r=null;switch(Wu.resultDimension(A,t,n)){case-1:r=i.createGeometryCollection(new Array(0).fill(null));break;case 0:r=i.createPoint();break;case 1:r=i.createLineString();break;case 2:r=i.createPolygon()}return r},Wu.difference=function(A,t){return A.isEmpty()?Wu.createEmptyResult(Wu.DIFFERENCE,A,t,A.getFactory()):t.isEmpty()?A.copy():(A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),xu.overlayOp(A,t,Wu.DIFFERENCE))},Wu.isResultOfOp=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=A.getLocation(0),i=A.getLocation(1);return Wu.isResultOfOp(n,i,t)}if(3===arguments.length){var r=arguments[0],e=arguments[1],s=arguments[2];switch(r===Tn.BOUNDARY&&(r=Tn.INTERIOR),e===Tn.BOUNDARY&&(e=Tn.INTERIOR),s){case Wu.INTERSECTION:return r===Tn.INTERIOR&&e===Tn.INTERIOR;case Wu.UNION:return r===Tn.INTERIOR||e===Tn.INTERIOR;case Wu.DIFFERENCE:return r===Tn.INTERIOR&&e!==Tn.INTERIOR;case Wu.SYMDIFFERENCE:return r===Tn.INTERIOR&&e!==Tn.INTERIOR||r!==Tn.INTERIOR&&e===Tn.INTERIOR}return!1}},Wu.INTERSECTION=1,Wu.UNION=2,Wu.DIFFERENCE=3,Wu.SYMDIFFERENCE=4;var _u=function(){this.su=null,this.uu=null,this.ou=null,this.Oe=new Vs,this.gr=new Ne;var A=arguments[0],t=arguments[1];this.su=A,this.uu=t,this.ou=this.extractLinework(A)};_u.prototype.isWithinToleranceOfBoundary=function(A){for(var t=0;t<this.ou.getNumGeometries();t++)for(var n=this.ou.getGeometryN(t).getCoordinateSequence(),i=0;i<n.size()-1;i++)if(n.getCoordinate(i,this.gr.p0),n.getCoordinate(i+1,this.gr.p1),this.gr.distance(A)<=this.uu)return!0;return!1},_u.prototype.getLocation=function(A){return this.isWithinToleranceOfBoundary(A)?Tn.BOUNDARY:this.Oe.locate(A,this.su)},_u.prototype.extractLinework=function(A){var t=new Ku;A.apply(t);var n=t.getLinework(),i=jr.toLineStringArray(n);return A.getFactory().createMultiLineString(i)},_u.prototype.interfaces_=function(){return[]},_u.prototype.getClass=function(){return _u};var Ku=function(){this.ou=null,this.ou=new yi};Ku.prototype.getLinework=function(){return this.ou},Ku.prototype.filter=function(A){if(A instanceof Cr){var t=A;this.ou.add(t.getExteriorRing());for(var n=0;n<t.getNumInteriorRing();n++)this.ou.add(t.getInteriorRingN(n))}},Ku.prototype.interfaces_=function(){return[$i]},Ku.prototype.getClass=function(){return Ku};var Hu=function(){this.su=null,this.hu=!0,this.fu=!0;var A=arguments[0];this.su=A};Hu.prototype.extractPoints=function(A,t,n){for(var i=A.getCoordinates(),r=0;r<i.length-1;r++)this.computeOffsetPoints(i[r],i[r+1],t,n)},Hu.prototype.setSidesToGenerate=function(A,t){this.hu=A,this.fu=t},Hu.prototype.getPoints=function(A){for(var t=new yi,n=qs.getLines(this.su).iterator();n.hasNext();){var i=n.next();this.extractPoints(i,A,t)}return t},Hu.prototype.computeOffsetPoints=function(A,t,n,i){var r=t.x-A.x,e=t.y-A.y,s=Math.sqrt(r*r+e*e),u=n*r/s,o=n*e/s,h=(t.x+A.x)/2,f=(t.y+A.y)/2;if(this.hu){var c=new mn(h-o,f+u);i.add(c)}if(this.fu){var a=new mn(h+o,f-u);i.add(a)}},Hu.prototype.interfaces_=function(){return[]},Hu.prototype.getClass=function(){return Hu};var Ju=function A(){this.Pn=null,this.cu=null,this.au=new Array(3).fill(null),this.vu=null,this.uu=A.TOLERANCE,this.lu=new yi;var t=arguments[0],n=arguments[1],i=arguments[2];this.uu=A.computeBoundaryDistanceTolerance(t,n),this.Pn=[t,n,i],this.cu=[new _u(this.Pn[0],this.uu),new _u(this.Pn[1],this.uu),new _u(this.Pn[2],this.uu)]},Zu={TOLERANCE:{configurable:!0}};Ju.prototype.reportResult=function(A,t,n){Wn.out.println("Overlay result invalid - A:"+Tn.toLocationSymbol(t[0])+" B:"+Tn.toLocationSymbol(t[1])+" expected:"+(n?"i":"e")+" actual:"+Tn.toLocationSymbol(t[2]))},Ju.prototype.isValid=function(A){return this.addTestPts(this.Pn[0]),this.addTestPts(this.Pn[1]),this.checkValid(A)},Ju.prototype.checkValid=function(){var A=this;if(1===arguments.length){for(var t=arguments[0],n=0;n<this.lu.size();n++){var i=A.lu.get(n);if(!A.checkValid(t,i))return A.vu=i,!1}return!0}if(2===arguments.length){var r=arguments[0],e=arguments[1];return this.au[0]=this.cu[0].getLocation(e),this.au[1]=this.cu[1].getLocation(e),this.au[2]=this.cu[2].getLocation(e),!!Ju.hasLocation(this.au,Tn.BOUNDARY)||this.isValidResult(r,this.au)}},Ju.prototype.addTestPts=function(A){var t=new Hu(A);this.lu.addAll(t.getPoints(5*this.uu))},Ju.prototype.isValidResult=function(A,t){var n=Wu.isResultOfOp(t[0],t[1],A),i=!(n^t[2]===Tn.INTERIOR);return i||this.reportResult(A,t,n),i},Ju.prototype.getInvalidLocation=function(){return this.vu},Ju.prototype.interfaces_=function(){return[]},Ju.prototype.getClass=function(){return Ju},Ju.hasLocation=function(A,t){for(var n=0;n<3;n++)if(A[n]===t)return!0;return!1},Ju.computeBoundaryDistanceTolerance=function(A,t){return Math.min(Pu.computeSizeBasedSnapTolerance(A),Pu.computeSizeBasedSnapTolerance(t))},Ju.isValid=function(A,t,n,i){return new Ju(A,t,i).isValid(n)},Zu.TOLERANCE.get=function(){return 1e-6},Object.defineProperties(Ju,Zu);var Xu=function A(t){this.wu=null,this.Pu=!1,this.gu=null,this.wu=A.extractFactory(t),this.gu=t};Xu.prototype.extractElements=function(A,t){if(null===A)return null;for(var n=0;n<A.getNumGeometries();n++){var i=A.getGeometryN(n);this.Pu&&i.isEmpty()||t.add(i)}},Xu.prototype.combine=function(){for(var A=new yi,t=this.gu.iterator();t.hasNext();){var n=t.next();this.extractElements(n,A)}return 0===A.size()?null!==this.wu?this.wu.createGeometryCollection(null):null:this.wu.buildGeometry(A)},Xu.prototype.interfaces_=function(){return[]},Xu.prototype.getClass=function(){return Xu},Xu.combine=function(){if(1===arguments.length){var A=arguments[0],t=new Xu(A);return t.combine()}if(2===arguments.length){var n=arguments[0],i=arguments[1],r=new Xu(Xu.createList(n,i));return r.combine()}if(3===arguments.length){var e=arguments[0],s=arguments[1],u=arguments[2],o=new Xu(Xu.createList(e,s,u));return o.combine()}},Xu.extractFactory=function(A){return A.isEmpty()?null:A.iterator().next().getFactory()},Xu.createList=function(){if(2===arguments.length){var A=arguments[0],t=arguments[1],n=new yi;return n.add(A),n.add(t),n}if(3===arguments.length){var i=arguments[0],r=arguments[1],e=arguments[2],s=new yi;return s.add(i),s.add(r),s.add(e),s}};var $u=function(){this.Cu=null,this.wu=null;var A=arguments[0];this.Cu=A,null===this.Cu&&(this.Cu=new yi)},Ao={STRTREE_NODE_CAPACITY:{configurable:!0}};$u.prototype.reduceToGeometries=function(A){for(var t=new yi,n=A.iterator();n.hasNext();){var i=n.next(),r=null;Fn(i,xi)?r=this.unionTree(i):i instanceof ai&&(r=i),t.add(r)}return t},$u.prototype.extractByEnvelope=function(A,t,n){for(var i=new yi,r=0;r<t.getNumGeometries();r++){var e=t.getGeometryN(r);e.getEnvelopeInternal().intersects(A)?i.add(e):n.add(e)}return this.wu.buildGeometry(i)},$u.prototype.unionOptimized=function(A,t){var n=A.getEnvelopeInternal(),i=t.getEnvelopeInternal();if(!n.intersects(i))return Xu.combine(A,t);if(A.getNumGeometries()<=1&&t.getNumGeometries()<=1)return this.unionActual(A,t);var r=n.intersection(i);return this.unionUsingEnvelopeIntersection(A,t,r)},$u.prototype.union=function(){if(null===this.Cu)throw new Error("union() method cannot be called twice");if(this.Cu.isEmpty())return null;this.wu=this.Cu.iterator().next().getFactory();for(var A=new me($u.STRTREE_NODE_CAPACITY),t=this.Cu.iterator();t.hasNext();){var n=t.next();A.insert(n.getEnvelopeInternal(),n)}this.Cu=null;var i=A.itemsTree();return this.unionTree(i)},$u.prototype.binaryUnion=function(){if(1===arguments.length){var A=arguments[0];return this.binaryUnion(A,0,A.size())}if(3===arguments.length){var t=arguments[0],n=arguments[1],i=arguments[2];if(i-n<=1){var r=$u.getGeometry(t,n);return this.unionSafe(r,null)}if(i-n==2)return this.unionSafe($u.getGeometry(t,n),$u.getGeometry(t,n+1));var e=Math.trunc((i+n)/2),s=this.binaryUnion(t,n,e),u=this.binaryUnion(t,e,i);return this.unionSafe(s,u)}},$u.prototype.repeatedUnion=function(A){for(var t=null,n=A.iterator();n.hasNext();){var i=n.next();t=null===t?i.copy():t.union(i)}return t},$u.prototype.unionSafe=function(A,t){return null===A&&null===t?null:null===A?t.copy():null===t?A.copy():this.unionOptimized(A,t)},$u.prototype.unionActual=function(A,t){return $u.restrictToPolygons(A.union(t))},$u.prototype.unionTree=function(A){var t=this.reduceToGeometries(A);return this.binaryUnion(t)},$u.prototype.unionUsingEnvelopeIntersection=function(A,t,n){var i=new yi,r=this.extractByEnvelope(n,A,i),e=this.extractByEnvelope(n,t,i),s=this.unionActual(r,e);return i.add(s),Xu.combine(i)},$u.prototype.bufferUnion=function(){if(1===arguments.length){var A=arguments[0],t=A.get(0).getFactory(),n=t.buildGeometry(A),i=n.buffer(0);return i}if(2===arguments.length){var r=arguments[0],e=arguments[1],s=r.getFactory(),u=s.createGeometryCollection([r,e]),o=u.buffer(0);return o}},$u.prototype.interfaces_=function(){return[]},$u.prototype.getClass=function(){return $u},$u.restrictToPolygons=function(A){if(Fn(A,gr))return A;var t=Ys.getPolygons(A);return 1===t.size()?t.get(0):A.getFactory().createMultiPolygon(jr.toPolygonArray(t))},$u.getGeometry=function(A,t){return t>=A.size()?null:A.get(t)},$u.union=function(A){return new $u(A).union()},Ao.STRTREE_NODE_CAPACITY.get=function(){return 4},Object.defineProperties($u,Ao);var to=function(){};function no(){return new io}function io(){this.reset()}to.prototype.interfaces_=function(){return[]},to.prototype.getClass=function(){return to},to.union=function(A,t){if(A.isEmpty()||t.isEmpty()){if(A.isEmpty()&&t.isEmpty())return Wu.createEmptyResult(Wu.UNION,A,t,A.getFactory());if(A.isEmpty())return t.copy();if(t.isEmpty())return A.copy()}return A.checkNotGeometryCollection(A),A.checkNotGeometryCollection(t),xu.overlayOp(A,t,Wu.UNION)},io.prototype={constructor:io,reset:function(){this.s=this.t=0},add:function(A){eo(ro,A,this.t),eo(this,ro.s,this.s),this.s?this.t+=ro.t:this.s=ro.t},valueOf:function(){return this.s}};var ro=new io;function eo(A,t,n){var i=A.s=t+n,r=i-t;A.t=t-(i-r)+(n-r)}var so=1e-6,uo=Math.PI,oo=uo/2,ho=uo/4,fo=2*uo,co=180/uo,ao=uo/180,vo=Math.abs,lo=Math.atan,wo=Math.atan2,Po=Math.cos,go=Math.sin,Co=Math.sqrt;function Do(A){return A>1?0:A<-1?uo:Math.acos(A)}function Io(A){return A>1?oo:A<-1?-oo:Math.asin(A)}function Mo(){}function bo(A,t){A&&yo.hasOwnProperty(A.type)&&yo[A.type](A,t)}var zo,xo,mo={Feature:function(A,t){bo(A.geometry,t)},FeatureCollection:function(A,t){for(var n=A.features,i=-1,r=n.length;++i<r;)bo(n[i].geometry,t)}},yo={Sphere:function(A,t){t.sphere()},Point:function(A,t){t.point((A=A.coordinates)[0],A[1],A[2])},MultiPoint:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)t.point((A=n[i])[0],A[1],A[2])},LineString:function(A,t){po(A.coordinates,t,0)},MultiLineString:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)po(n[i],t,0)},Polygon:function(A,t){Lo(A.coordinates,t)},MultiPolygon:function(A,t){for(var n=A.coordinates,i=-1,r=n.length;++i<r;)Lo(n[i],t)},GeometryCollection:function(A,t){for(var n=A.geometries,i=-1,r=n.length;++i<r;)bo(n[i],t)}};function po(A,t,n){var i,r=-1,e=A.length-n;for(t.lineStart();++r<e;)t.point((i=A[r])[0],i[1],i[2]);t.lineEnd()}function Lo(A,t){var n=-1,i=A.length;for(t.polygonStart();++n<i;)po(A[n],t,1);t.polygonEnd()}function To(A){return[wo(A[1],A[0]),Io(A[2])]}function Oo(A){var t=A[0],n=A[1],i=Po(n);return[i*Po(t),i*go(t),go(n)]}function Fo(A,t){return A[0]*t[0]+A[1]*t[1]+A[2]*t[2]}function Uo(A,t){return[A[1]*t[2]-A[2]*t[1],A[2]*t[0]-A[0]*t[2],A[0]*t[1]-A[1]*t[0]]}function Eo(A,t){A[0]+=t[0],A[1]+=t[1],A[2]+=t[2]}function No(A,t){return[A[0]*t,A[1]*t,A[2]*t]}function jo(A){var t=Co(A[0]*A[0]+A[1]*A[1]+A[2]*A[2]);A[0]/=t,A[1]/=t,A[2]/=t}function Qo(A,t){function n(n,i){return n=A(n,i),t(n[0],n[1])}return A.invert&&t.invert&&(n.invert=function(n,i){return(n=t.invert(n,i))&&A.invert(n[0],n[1])}),n}function So(A,t){return[A>uo?A-fo:A<-uo?A+fo:A,t]}function ko(A){return function(t,n){return[(t+=A)>uo?t-fo:t<-uo?t+fo:t,n]}}function Bo(A){var t=ko(A);return t.invert=ko(-A),t}function Ro(A,t){var n=Po(A),i=go(A),r=Po(t),e=go(t);function s(A,t){var s=Po(t),u=Po(A)*s,o=go(A)*s,h=go(t),f=h*n+u*i;return[wo(o*r-f*e,u*n-h*i),Io(f*r+o*e)]}return s.invert=function(A,t){var s=Po(t),u=Po(A)*s,o=go(A)*s,h=go(t),f=h*r-o*e;return[wo(o*r+h*e,u*n+f*i),Io(f*n-u*i)]},s}function Go(A,t){(t=Oo(t))[0]-=A,jo(t);var n=Do(-t[1]);return((-t[2]<0?-n:n)+fo-so)%fo}function Yo(){var A,t=[];return{point:function(t,n){A.push([t,n])},lineStart:function(){t.push(A=[])},lineEnd:Mo,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],A=null,n}}}function qo(A,t){return vo(A[0]-t[0])<so&&vo(A[1]-t[1])<so}function Vo(A,t,n,i){this.x=A,this.z=t,this.o=n,this.e=i,this.v=!1,this.n=this.p=null}function Wo(A,t,n,i,r){var e,s,u=[],o=[];if(A.forEach((function(A){if(!((t=A.length-1)<=0)){var t,n,i=A[0],s=A[t];if(qo(i,s)){for(r.lineStart(),e=0;e<t;++e)r.point((i=A[e])[0],i[1]);r.lineEnd()}else u.push(n=new Vo(i,A,null,!0)),o.push(n.o=new Vo(i,null,n,!1)),u.push(n=new Vo(s,A,null,!1)),o.push(n.o=new Vo(s,null,n,!0))}})),u.length){for(o.sort(t),_o(u),_o(o),e=0,s=o.length;e<s;++e)o[e].e=n=!n;for(var h,f,c=u[0];;){for(var a=c,v=!0;a.v;)if((a=a.n)===c)return;h=a.z,r.lineStart();do{if(a.v=a.o.v=!0,a.e){if(v)for(e=0,s=h.length;e<s;++e)r.point((f=h[e])[0],f[1]);else i(a.x,a.n.x,1,r);a=a.n}else{if(v)for(e=(h=a.p.z).length-1;e>=0;--e)r.point((f=h[e])[0],f[1]);else i(a.x,a.p.x,-1,r);a=a.p}h=(a=a.o).z,v=!v}while(!a.v);r.lineEnd()}}}function _o(A){if(t=A.length){for(var t,n,i=0,r=A[0];++i<t;)r.n=n=A[i],n.p=r,r=n;r.n=n=A[0],n.p=r}}function Ko(A,t){return A<t?-1:A>t?1:A>=t?0:NaN}function Ho(A){for(var t,n,i,r=A.length,e=-1,s=0;++e<r;)s+=A[e].length;for(n=new Array(s);--r>=0;)for(t=(i=A[r]).length;--t>=0;)n[--s]=i[t];return n}function Jo(A,t,n,i){function r(r,e){return A<=r&&r<=n&&t<=e&&e<=i}function e(r,e,u,h){var f=0,c=0;if(null==r||(f=s(r,u))!==(c=s(e,u))||o(r,e)<0^u>0)do{h.point(0===f||3===f?A:n,f>1?i:t)}while((f=(f+u+4)%4)!==c);else h.point(e[0],e[1])}function s(i,r){return vo(i[0]-A)<so?r>0?0:3:vo(i[0]-n)<so?r>0?2:1:vo(i[1]-t)<so?r>0?1:0:r>0?3:2}function u(A,t){return o(A.x,t.x)}function o(A,t){var n=s(A,1),i=s(t,1);return n!==i?n-i:0===n?t[1]-A[1]:1===n?A[0]-t[0]:2===n?A[1]-t[1]:t[0]-A[0]}return function(s){var o,h,f,c,a,v,l,w,P,g,C,D=s,I=Yo(),M={point:b,lineStart:function(){M.point=z,h&&h.push(f=[]),g=!0,P=!1,l=w=NaN},lineEnd:function(){o&&(z(c,a),v&&P&&I.rejoin(),o.push(I.result())),M.point=b,P&&D.lineEnd()},polygonStart:function(){D=I,o=[],h=[],C=!0},polygonEnd:function(){var t=function(){for(var t=0,n=0,r=h.length;n<r;++n)for(var e,s,u=h[n],o=1,f=u.length,c=u[0],a=c[0],v=c[1];o<f;++o)e=a,s=v,a=(c=u[o])[0],v=c[1],s<=i?v>i&&(a-e)*(i-s)>(v-s)*(A-e)&&++t:v<=i&&(a-e)*(i-s)<(v-s)*(A-e)&&--t;return t}(),n=C&&t,r=(o=Ho(o)).length;(n||r)&&(s.polygonStart(),n&&(s.lineStart(),e(null,null,1,s),s.lineEnd()),r&&Wo(o,u,t,e,s),s.polygonEnd()),D=s,o=h=f=null}};function b(A,t){r(A,t)&&D.point(A,t)}function z(e,s){var u=r(e,s);if(h&&f.push([e,s]),g)c=e,a=s,v=u,g=!1,u&&(D.lineStart(),D.point(e,s));else if(u&&P)D.point(e,s);else{var o=[l=Math.max(-1e9,Math.min(1e9,l)),w=Math.max(-1e9,Math.min(1e9,w))],I=[e=Math.max(-1e9,Math.min(1e9,e)),s=Math.max(-1e9,Math.min(1e9,s))];!function(A,t,n,i,r,e){var s,u=A[0],o=A[1],h=0,f=1,c=t[0]-u,a=t[1]-o;if(s=n-u,c||!(s>0)){if(s/=c,c<0){if(s<h)return;s<f&&(f=s)}else if(c>0){if(s>f)return;s>h&&(h=s)}if(s=r-u,c||!(s<0)){if(s/=c,c<0){if(s>f)return;s>h&&(h=s)}else if(c>0){if(s<h)return;s<f&&(f=s)}if(s=i-o,a||!(s>0)){if(s/=a,a<0){if(s<h)return;s<f&&(f=s)}else if(a>0){if(s>f)return;s>h&&(h=s)}if(s=e-o,a||!(s<0)){if(s/=a,a<0){if(s>f)return;s>h&&(h=s)}else if(a>0){if(s<h)return;s<f&&(f=s)}return h>0&&(A[0]=u+h*c,A[1]=o+h*a),f<1&&(t[0]=u+f*c,t[1]=o+f*a),!0}}}}}(o,I,A,t,n,i)?u&&(D.lineStart(),D.point(e,s),C=!1):(P||(D.lineStart(),D.point(o[0],o[1])),D.point(I[0],I[1]),u||D.lineEnd(),C=!1)}l=e,w=s,P=u}return M}}no(),no(),no(),So.invert=So,1===(zo=Ko).length&&(xo=zo,zo=function(A,t){return Ko(xo(A),t)});var Zo=no();function Xo(A){return A}no(),no(),no();var $o=1/0,Ah=$o,th=-$o,nh=th,ih={point:function(A,t){A<$o&&($o=A),A>th&&(th=A),t<Ah&&(Ah=t),t>nh&&(nh=t)},lineStart:Mo,lineEnd:Mo,polygonStart:Mo,polygonEnd:Mo,result:function(){var A=[[$o,Ah],[th,nh]];return th=nh=-(Ah=$o=1/0),A}};function rh(A,t,n,i){return function(r,e){var s,u,o,h=t(e),f=r.invert(i[0],i[1]),c=Yo(),a=t(c),v=!1,l={point:w,lineStart:g,lineEnd:C,polygonStart:function(){l.point=D,l.lineStart=I,l.lineEnd=M,u=[],s=[]},polygonEnd:function(){l.point=w,l.lineStart=g,l.lineEnd=C,u=Ho(u);var A=function(A,t){var n=t[0],i=t[1],r=[go(n),-Po(n),0],e=0,s=0;Zo.reset();for(var u=0,o=A.length;u<o;++u)if(f=(h=A[u]).length)for(var h,f,c=h[f-1],a=c[0],v=c[1]/2+ho,l=go(v),w=Po(v),P=0;P<f;++P,a=C,l=I,w=M,c=g){var g=h[P],C=g[0],D=g[1]/2+ho,I=go(D),M=Po(D),b=C-a,z=b>=0?1:-1,d=z*b,x=d>uo,m=l*I;if(Zo.add(wo(m*z*go(d),w*M+m*Po(d))),e+=x?b+z*fo:b,x^a>=n^C>=n){var y=Uo(Oo(c),Oo(g));jo(y);var p=Uo(r,y);jo(p);var L=(x^b>=0?-1:1)*Io(p[2]);(i>L||i===L&&(y[0]||y[1]))&&(s+=x^b>=0?1:-1)}}return(e<-so||e<so&&Zo<-so)^1&s}(s,f);u.length?(v||(e.polygonStart(),v=!0),Wo(u,sh,A,n,e)):A&&(v||(e.polygonStart(),v=!0),e.lineStart(),n(null,null,1,e),e.lineEnd()),v&&(e.polygonEnd(),v=!1),u=s=null},sphere:function(){e.polygonStart(),e.lineStart(),n(null,null,1,e),e.lineEnd(),e.polygonEnd()}};function w(t,n){var i=r(t,n);A(t=i[0],n=i[1])&&e.point(t,n)}function P(A,t){var n=r(A,t);h.point(n[0],n[1])}function g(){l.point=P,h.lineStart()}function C(){l.point=w,h.lineEnd()}function D(A,t){o.push([A,t]);var n=r(A,t);a.point(n[0],n[1])}function I(){a.lineStart(),o=[]}function M(){D(o[0][0],o[0][1]),a.lineEnd();var A,t,n,i,r=a.clean(),h=c.result(),f=h.length;if(o.pop(),s.push(o),o=null,f)if(1&r){if((t=(n=h[0]).length-1)>0){for(v||(e.polygonStart(),v=!0),e.lineStart(),A=0;A<t;++A)e.point((i=n[A])[0],i[1]);e.lineEnd()}}else f>1&&2&r&&h.push(h.pop().concat(h.shift())),u.push(h.filter(eh))}return l}}function eh(A){return A.length>1}function sh(A,t){return((A=A.x)[0]<0?A[1]-oo-so:oo-A[1])-((t=t.x)[0]<0?t[1]-oo-so:oo-t[1])}no();var uh=rh((function(){return!0}),(function(A){var t,n=NaN,i=NaN,r=NaN;return{lineStart:function(){A.lineStart(),t=1},point:function(e,s){var u=e>0?uo:-uo,o=vo(e-n);vo(o-uo)<so?(A.point(n,i=(i+s)/2>0?oo:-oo),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),A.point(e,i),t=0):r!==u&&o>=uo&&(vo(n-r)<so&&(n-=r*so),vo(e-u)<so&&(e-=u*so),i=function(A,t,n,i){var r,e,s=go(A-n);return vo(s)>so?lo((go(t)*(e=Po(i))*go(n)-go(i)*(r=Po(t))*go(A))/(r*e*s)):(t+i)/2}(n,i,e,s),A.point(r,i),A.lineEnd(),A.lineStart(),A.point(u,i),t=0),A.point(n=e,i=s),r=u},lineEnd:function(){A.lineEnd(),n=i=NaN},clean:function(){return 2-t}}}),(function(A,t,n,i){var r;if(null==A)i.point(-uo,r=n*oo),i.point(0,r),i.point(uo,r),i.point(uo,0),i.point(uo,-r),i.point(0,-r),i.point(-uo,-r),i.point(-uo,0),i.point(-uo,r);else if(vo(A[0]-t[0])>so){var e=A[0]<t[0]?uo:-uo;i.point(-e,r=n*e/2),i.point(0,r),i.point(e,r)}else i.point(t[0],t[1])}),[-uo,-oo]);function oh(A,t){var n=Po(A),i=n>0,r=vo(n)>so;function e(A,t){return Po(A)*Po(t)>n}function s(A,t,i){var r=[1,0,0],e=Uo(Oo(A),Oo(t)),s=Fo(e,e),u=e[0],o=s-u*u;if(!o)return!i&&A;var h=n*s/o,f=-n*u/o,c=Uo(r,e),a=No(r,h);Eo(a,No(e,f));var v=c,l=Fo(a,v),w=Fo(v,v),P=l*l-w*(Fo(a,a)-1);if(!(P<0)){var g=Co(P),C=No(v,(-l-g)/w);if(Eo(C,a),C=To(C),!i)return C;var D,I=A[0],M=t[0],b=A[1],z=t[1];M<I&&(D=I,I=M,M=D);var d=M-I,x=vo(d-uo)<so;if(!x&&z<b&&(D=b,b=z,z=D),x||d<so?x?b+z>0^C[1]<(vo(C[0]-I)<so?b:z):b<=C[1]&&C[1]<=z:d>uo^(I<=C[0]&&C[0]<=M)){var m=No(v,(-l+g)/w);return Eo(m,a),[C,To(m)]}}}function u(t,n){var r=i?A:uo-A,e=0;return t<-r?e|=1:t>r&&(e|=2),n<-r?e|=4:n>r&&(e|=8),e}return rh(e,(function(A){var t,n,o,h,f;return{lineStart:function(){h=o=!1,f=1},point:function(c,a){var v,l=[c,a],w=e(c,a),P=i?w?0:u(c,a):w?u(c+(c<0?uo:-uo),a):0;if(!t&&(h=o=w)&&A.lineStart(),w!==o&&(!(v=s(t,l))||qo(t,v)||qo(l,v))&&(l[0]+=so,l[1]+=so,w=e(l[0],l[1])),w!==o)f=0,w?(A.lineStart(),v=s(l,t),A.point(v[0],v[1])):(v=s(t,l),A.point(v[0],v[1]),A.lineEnd()),t=v;else if(r&&t&&i^w){var g;P&n||!(g=s(l,t,!0))||(f=0,i?(A.lineStart(),A.point(g[0][0],g[0][1]),A.point(g[1][0],g[1][1]),A.lineEnd()):(A.point(g[1][0],g[1][1]),A.lineEnd(),A.lineStart(),A.point(g[0][0],g[0][1])))}!w||t&&qo(t,l)||A.point(l[0],l[1]),t=l,o=w,n=P},lineEnd:function(){o&&A.lineEnd(),t=null},clean:function(){return f|(h&&o)<<1}}}),(function(n,i,r,e){!function(A,t,n,i,r,e){if(n){var s=Po(t),u=go(t),o=i*n;null==r?(r=t+i*fo,e=t-o/2):(r=Go(s,r),e=Go(s,e),(i>0?r<e:r>e)&&(r+=i*fo));for(var h,f=r;i>0?f>e:f<e;f-=o)h=To([s,-u*Po(f),-u*go(f)]),A.point(h[0],h[1])}}(e,A,t,r,n,i)}),i?[0,-A]:[-uo,A-uo])}function hh(A){return function(t){var n=new fh;for(var i in A)n[i]=A[i];return n.stream=t,n}}function fh(){}function ch(A,t,n){var i=t[1][0]-t[0][0],r=t[1][1]-t[0][1],e=A.clipExtent&&A.clipExtent();A.scale(150).translate([0,0]),null!=e&&A.clipExtent(null),function(A,t){A&&mo.hasOwnProperty(A.type)?mo[A.type](A,t):bo(A,t)}(n,A.stream(ih));var s=ih.result(),u=Math.min(i/(s[1][0]-s[0][0]),r/(s[1][1]-s[0][1])),o=+t[0][0]+(i-u*(s[1][0]+s[0][0]))/2,h=+t[0][1]+(r-u*(s[1][1]+s[0][1]))/2;return null!=e&&A.clipExtent(e),A.scale(150*u).translate([o,h])}fh.prototype={constructor:fh,point:function(A,t){this.stream.point(A,t)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};var ah=Po(30*ao);function vh(A,t){return+t?function(A,t){function n(i,r,e,s,u,o,h,f,c,a,v,l,w,P){var g=h-i,C=f-r,D=g*g+C*C;if(D>4*t&&w--){var I=s+a,M=u+v,b=o+l,z=Co(I*I+M*M+b*b),d=Io(b/=z),x=vo(vo(b)-1)<so||vo(e-c)<so?(e+c)/2:wo(M,I),m=A(x,d),y=m[0],p=m[1],L=y-i,T=p-r,O=C*L-g*T;(O*O/D>t||vo((g*L+C*T)/D-.5)>.3||s*a+u*v+o*l<ah)&&(n(i,r,e,s,u,o,y,p,x,I/=z,M/=z,b,w,P),P.point(y,p),n(y,p,x,I,M,b,h,f,c,a,v,l,w,P))}}return function(t){var i,r,e,s,u,o,h,f,c,a,v,l,w={point:P,lineStart:g,lineEnd:D,polygonStart:function(){t.polygonStart(),w.lineStart=I},polygonEnd:function(){t.polygonEnd(),w.lineStart=g}};function P(n,i){n=A(n,i),t.point(n[0],n[1])}function g(){f=NaN,w.point=C,t.lineStart()}function C(i,r){var e=Oo([i,r]),s=A(i,r);n(f,c,h,a,v,l,f=s[0],c=s[1],h=i,a=e[0],v=e[1],l=e[2],16,t),t.point(f,c)}function D(){w.point=P,t.lineEnd()}function I(){g(),w.point=M,w.lineEnd=b}function M(A,t){C(i=A,t),r=f,e=c,s=a,u=v,o=l,w.point=C}function b(){n(f,c,h,a,v,l,r,e,i,s,u,o,16,t),w.lineEnd=D,D()}return w}}(A,t):function(A){return hh({point:function(t,n){t=A(t,n),this.stream.point(t[0],t[1])}})}(A)}var lh=hh({point:function(A,t){this.stream.point(A*ao,t*ao)}});function Ph(A){return function(t,n){var i=Po(t),r=Po(n),e=A(i*r);return[e*r*go(t),e*go(n)]}}function gh(A){return function(t,n){var i=Co(t*t+n*n),r=A(i),e=go(r),s=Po(r);return[wo(t*e,i*s),Io(i&&n*e/i)]}}Ph((function(A){return Co(2/(1+A))})).invert=gh((function(A){return 2*Io(A/2)}));var Ch=Ph((function(A){return(A=Do(A))&&A/go(A)}));function Dh(){return function(A){return function(A){var t,n,i,r,e,s,u,o,h,f,c=150,a=480,v=250,l=0,w=0,P=0,g=0,C=0,D=null,I=uh,M=null,b=Xo,z=.5,d=vh(y,z);function x(A){return[(A=e(A[0]*ao,A[1]*ao))[0]*c+n,i-A[1]*c]}function m(A){return(A=e.invert((A[0]-n)/c,(i-A[1])/c))&&[A[0]*co,A[1]*co]}function y(A,r){return[(A=t(A,r))[0]*c+n,i-A[1]*c]}function p(){e=Qo(r=function(A,t,n){return(A%=fo)?t||n?Qo(Bo(A),Ro(t,n)):Bo(A):t||n?Ro(t,n):So}(P,g,C),t);var A=t(l,w);return n=a-A[0]*c,i=v+A[1]*c,L()}function L(){return h=f=null,x}return x.stream=function(A){return h&&f===A?h:h=lh(I(r,d(b(f=A))))},x.clipAngle=function(A){return arguments.length?(I=+A?oh(D=A*ao,6*ao):(D=null,uh),L()):D*co},x.clipExtent=function(A){return arguments.length?(b=null==A?(M=s=u=o=null,Xo):Jo(M=+A[0][0],s=+A[0][1],u=+A[1][0],o=+A[1][1]),L()):null==M?null:[[M,s],[u,o]]},x.scale=function(A){return arguments.length?(c=+A,p()):c},x.translate=function(A){return arguments.length?(a=+A[0],v=+A[1],p()):[a,v]},x.center=function(A){return arguments.length?(l=A[0]%360*ao,w=A[1]%360*ao,p()):[l*co,w*co]},x.rotate=function(A){return arguments.length?(P=A[0]%360*ao,g=A[1]%360*ao,C=A.length>2?A[2]%360*ao:0,p()):[P*co,g*co,C*co]},x.precision=function(A){return arguments.length?(d=vh(y,z=A*A),L()):Co(z)},x.fitExtent=function(A,t){return ch(x,A,t)},x.fitSize=function(A,t){return function(A,t,n){return ch(A,[[0,0],t],n)}(x,A,t)},function(){return t=A.apply(this,arguments),x.invert=t.invert&&m,p()}}((function(){return A}))()}(Ch).scale(79.4188).clipAngle(179.999)}function Ih(A,t){return[A,t]}function Mh(A,t,n,i){var r=A.properties||{},e="Feature"===A.type?A.geometry:A;if("GeometryCollection"===e.type){var s=[];return Pn(A,(function(A){var r=Mh(A,t,n,i);r&&s.push(r)})),rn(s)}var u=function(A){var t=function(A,t){void 0===t&&(t={});var n=gn(A);return tn([(n[0]+n[2])/2,(n[1]+n[3])/2],t.properties,t)}(A).geometry.coordinates,n=[-t[0],-t[1]];return Dh().rotate(n).scale(6371008.8)}(e),o={type:e.type,coordinates:bh(e.coordinates,u)},h=(new Gr).read(o),f=en(sn(t,n),"meters"),c=Ns.bufferOp(h,f,i);if(!function A(t){return Array.isArray(t[0])?A(t[0]):isNaN(t[0])}((c=(new Yr).write(c)).coordinates))return An({type:c.type,coordinates:zh(c.coordinates,u)},r)}function bh(A,t){return"object"!=typeof A[0]?t(A):A.map((function(A){return bh(A,t)}))}function zh(A,t){return"object"!=typeof A[0]?t.invert(A):A.map((function(A){return zh(A,t)}))}Ch.invert=gh((function(A){return A})),Ih.invert=Ih;const dh=[.8451,.2588,.4863],xh=[],mh=[],yh=[];const Lh=[.8,.1,.1];class Oh extends t__namespace.DrawTool{constructor(A){super(A),this.on("enable",this.pu,this),this.on("disable",this.Lu,this),this.Tu=[]}addTo(A){const t=A.getMap();return t?(super.addTo(t),this.Ou=A,this.Fu=t,this.Uu()):A.once("add",(()=>{this.addTo(A)}),this),this}Uu(){this.Fu.getLayer(t__namespace.INTERNAL_LAYER_PREFIX+"drawtool").hide()}pu(){this.on("drawstart",this.Eu,this).on("drawvertex",this.Nu,this).on("mousemove",this.ju,this).on("drawend",this.Qu,this)}Lu(){this.off("drawstart",this.Eu,this).off("drawvertex",this.Nu,this).off("mousemove",this.ju,this).off("drawend",this.Qu,this)}Su(A){const t=this.Ou.identify(A,{includeInternals:!0})[0];return t&&t.coordinate?new t__namespace.Coordinate(t.coordinate):(A.z=A.z||0,A)}Eu(A){const t=this.Su(A.coordinate);t&&(this.ku=!0,this.Tu.push(t),this.Bu(t))}Nu(A){const t=this.Su(A.coordinate);t&&(this.ku=!0,this.Tu[this.Tu.length-1]=t,this.Ru())}ju(A){const t=this.Su(A.coordinate);t&&(this.ku?this.Tu.push(t):this.Tu[this.Tu.length-1]=t,this.Ru(),this.ku=!1)}Qu(A){const t=this.Su(A.coordinate);t&&(this.Tu.push(t),this.Gu())}Gu(){this.Ru(),this.Tu=[],this.et=null,this.Sn=null}remove(){this.Yu&&this.Yu.remove(),this.qu&&this.qu.remove()}clear(){this.Yu&&this.Yu.clear(),this.qu&&this.qu.clear()}}Oh.mergeOptions({mode:"LineString",language:"zh-CN",metric:!0,imperial:!1,once:!0,symbol:{lineColor:"#f00",lineWidth:2,polygonFill:"#ddd",polygonOpacity:.4},vertexSymbol:{markerType:"ellipse",markerFill:"#fff",markerLineColor:"#669955",markerLineWidth:3,markerWidth:12,markerHeight:12,markerDy:6},labelSymbol:{markerType:"square",markerFill:"rgb(135,196,240)",markerFillOpacity:"0.6",markerDx:-15,markerVerticalAlignment:"middle",markerHorizontalAlignment:"left",markerTextFit:"both",markerTextFitPadding:[5,5,5,10],textHorizontalAlignment:"left",textSize:16,textFill:"#fff",textDx:-25}});const Fh=[["","",""],["spatial distance","vertical height","horizontal distance"]];"undefined"!=typeof console&&console.log("@maptalks/analysis v0.95.6"),"undefined"!=typeof window&&(window.maptalksgl=window.maptalksgl||{},window.maptalksgl.transcoders=window.maptalksgl.transcoders||transcoders),exports.AEMarker=class extends st$1{constructor(t,n){super(t,n);const s=t$1.Util.extend({},Bt$1,this.options.symbol);this.setSymbol(s);const i=t$1.Util.extend({},Ft$1,this.options.symbol.uniforms);this.setUniforms(i)}},exports.Area3DTool=class extends Oh{Uu(){super.Uu(),this.Yu=new Je$2(t__namespace.INTERNAL_LAYER_PREFIX+"_area3dtool",{geometryEvents:!1}).addTo(this.Ou),this.qu=new Ye$2(t__namespace.INTERNAL_LAYER_PREFIX+"_area3dtool_marker",{geometryEvents:!1}).addTo(this.Ou)}Ru(){this.et.setCoordinates(this.Tu);const A=this.qu.getGeometries(),t=this.Yu.getGeometries().length;for(let n=0;n<A.length;n++){const i=A[n].getId();i!=="label"+t&&i.indexOf(t+"_")>-1&&A[n].remove()}for(let A=0;A<this.Tu.length-1;A++)new t__namespace.Marker(this.Tu[A],{id:t+"_"+A,symbol:this.options.vertexSymbol}).addTo(this.qu);this.Vu()}Vu(){const A=this.getMeasureResult(),t=("zh-CN"!==this.options.language?"area: ":": ")+this.Wu(A),n=t__namespace.Util.extend({textName:t},this.options.labelSymbol),i=this.Tu[this.Tu.length-1],r=this.Yu.getGeometries().length;this.Sn?(this.Sn.setSymbol([this.options.vertexSymbol,n]),this.Sn.setCoordinates(i)):this.Sn=new t__namespace.Marker(i,{id:"label"+r,symbol:[this.options.vertexSymbol,n]}).addTo(this.qu)}Wu(A){let t;t="zh-CN"===this.options.language?[" "," "," "," "]:[" sq.m"," sq.km"," sq.ft"," sq.mi"];let n="";if(this.options.metric&&(this._u=A<1e6?A.toFixed(2):(A/1e6).toFixed(2),this.Ku=A<1e6?t[0]:t[1]),this.options.imperial){n.length>0&&(n+="\n");const i=27878400;this._u=(A*=3.2808399)<i?A.toFixed(2):(A/i).toFixed(2),this.Ku=A<i?t[2]:t[3]}return n+=this._u+this.Ku,n}Bu(A){this.et||(this.et=new t__namespace.Polygon([A],{symbol:this.options.symbol}).addTo(this.Yu)),this.Ru(),this.ku=!0}getMeasureResult(){return this.et.getArea()}},exports.B3DMLoader=ds$1,exports.BoxInsideClipMask=ln$4,exports.BoxOutsideClipMask=cn$4,exports.CMPTLoader=vs$1,exports.ClipInsideMask=Xs$3,exports.ClipOutsideMask=Js$3,exports.ColorMask=tn$4,exports.CrossCutAnalysis=class extends LA{constructor(A){super(A),this.type="crosscutAnalysis",this.$=!0}YA(){const A=this.layer.getMap();this.q={};const{extentMap:t,extentInWorld:n}=this.Du(this.options.cutLine);this.q.extent=n,this.q.extentMap=t,this.q.projMatrix=A.projMatrix,this.q.viewMatrix=A.viewMatrix,this.q.minAltitude=0;const i=new t__namespace.LineString(this.options.cutLine);this.Iu=i.getExtent()}getAltitudes(A){const t=nn(this.options.cutLine);let n=0;for(let A=0;A<this.options.cutLine.length-1;A++)n+=vn(this.options.cutLine[A],this.options.cutLine[A+1]);const i=n/A,r=[],e=[];for(let n=0;n<A;n++){const A=ln(t,i*(n+1));e.push(A.geometry.coordinates)}const s=this.layer.getMap(),o=s.getDevicePixelRatio(),{projViewMatrix:h,projMatrix:f,viewMatrix:c}=this.Mu(e);for(let A=0;A<e.length;A++){const t=this.bu(e[A],e),v=this.zu(t.x*o,t.y*o,h,f,c);if(!v)continue;const l=s.pointAtResToAltitude(v[2],s.getGLRes()),w=s.pointAtResToCoordinate(new t__namespace.Point(v[0],v[1]),s.getGLRes());r.push({coordinate:new t__namespace.Coordinate(w.x,w.y,l),distance:i*A})}return r}Du(A){const t=function(A,t,n){var i=(n=n||{}).units||"kilometers",r=n.steps||8;if(!A)throw new Error("geojson is required");if("object"!=typeof n)throw new Error("options must be an object");if("number"!=typeof r)throw new Error("steps must be an number");if(r<=0)throw new Error("steps must be greater than 0");var e=[];switch(A.type){case"GeometryCollection":return Pn(A,(function(A){var n=Mh(A,t,i,r);n&&e.push(n)})),rn(e);case"FeatureCollection":return wn(A,(function(A){var n=Mh(A,t,i,r);n&&wn(n,(function(A){A&&e.push(A)}))})),rn(e)}return Mh(A,t,i,r)}(nn(A),.001);return this.V(t.geometry.coordinates[0])}S(t){const n=this.u={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(t),this.du(t);const i=new B$6(t.regl);this.k=this.k||new Xt(i,n),this.layer.addAnalysis(this)}du(n){const i=this.layer.getMap();this.pickingFBO=n.canvas.pickingFBO||n.regl.framebuffer(n.canvas.width,n.canvas.height);const r=new B$6(n.regl);this.G=new Cr$4(r,{vert:UA,uniforms:[{name:"projViewModelMatrix",type:"function",fn:function(A,n){return multiply$5([],n.projViewMatrix,n.modelMatrix)}}]},this.pickingFBO,i)}Mu(){if(this.xu)return this.xu;const A=this.layer.getMap(),{precenter:n,prezoom:i,prepitch:r,prebearing:e}=this.mu();return copy$5(xh,A.projViewMatrix),copy$5(mh,A.projMatrix),copy$5(yh,A.viewMatrix),A.setZoom(i),A.setCenter(n),A.setPitch(r),A.setBearing(e),this.xu={projViewMatrix:xh,projMatrix:mh,viewMatrix:yh},this.xu}mu(){const A=this.Iu,t=this.layer.getMap(),n=t.getCenter(),i=t.getZoom(),r=t.getPitch(),e=t.getBearing(),s=t.getFitZoom(A);return t.setZoom(s),t.setCenter(A.getCenter()),t.setPitch(0),{precenter:n,prezoom:i,prepitch:r,prebearing:e}}bu(A){const{precenter:t,prezoom:n,prepitch:i,prebearing:r}=this.mu(),e=this.layer.getMap(),s=e.coordinateToContainerPoint(new t__namespace.Coordinate(A));return e.setZoom(n),e.setCenter(t),e.setPitch(i),e.setBearing(r),s}zu(A,t,n,i,r,e={}){if(this.$){if(!this.yu||0===this.yu.length)return null;const A=this.yu;A.forEach((A=>{const t=A.getDefines();t.HAS_PICKING_ID=2,A.setDefines(t),A.setUniform("uPickingId",1)})),this.G.render(A,{projViewMatrix:n,minAltitude:this.q.minAltitude},!0),this.$=!1}const{point:s}=this.G.pick(A,t,e.tolerance||3,{projViewMatrix:n,minAltitude:this.q.minAltitude},{viewMatrix:r,projMatrix:i,returnPoint:!0});return s}update(A,t){if(super.update(A,t),"cutLine"===A){const{extentMap:A,extentInWorld:n}=this.Du(t);this.q.extent=n,this.q.extentMap=A;const i=new t__namespace.LineString(this.options.cutLine);this.Iu=i.getExtent(),this.$=!0,delete this.xu}else this.q[A]=t}renderAnalysis(A){const t={};return this.B.render(this.R,this._),t.cutLineColor=this.options.cutLineColor||dh,t.crosscutMap=this.k.render(A,this.q),this.yu=A,t}getDefines(){return{HAS_CROSSCUT:1}}},exports.CutAnalysis=class extends LA{constructor(A){super(A),this.type="cut"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.q[A]=AA(n,...t)}else this.q[A]=t;super.update(A,t)}reset(){if(this.k){this.k.SA(this.q.position,this.q.rotation,this.q.scale)}}YA(){const A=this.layer.getMap();this.q={},this.q.position=AA(A,...this.options.position),this.q.rotation=this.options.rotation||[0,0,0],this.q.scale=this.options.scale||[1,1,1],this.q.projViewMatrix=A.projViewMatrix,this.q.minAltitude=0}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1},i=new B$6(t.regl);i.canvas=t.canvas,i.parentRenderer=t,this.YA(),this.k=new tt(i,n)||this.k;const r=this.layer.getMap();this.k.QA(r,this.q.position,this.q.rotation,this.q.scale),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={};this.q.map=this.layer.getMap();const{meshesMap:n,invisibleMap:i}=this.k.render(A,this.q);return t.meshesMap=n,t.invisibleMap=i,t}getDefines(){return{HAS_CUT:1}}},exports.Distance3DTool=class extends Oh{Uu(){super.Uu(),this.Yu=new $e$2(t__namespace.INTERNAL_LAYER_PREFIX+"_distance3dtool",{geometryEvents:!1}).addTo(this.Ou),this.qu=new Ye$2(t__namespace.INTERNAL_LAYER_PREFIX+"_distance3dtool_marker",{geometryEvents:!1}).addTo(this.Ou)}Ru(){this.et.setCoordinates(this.Tu);const A=this.qu.getGeometries(),t=this.Yu.getGeometries().length;for(let n=0;n<A.length;n++){const i=A[n].getId();i!=="label"+t&&i.indexOf(t+"_")>-1&&A[n].remove()}for(let A=0;A<this.Tu.length-1;A++)new t__namespace.Marker(this.Tu[A],{id:t+"_"+A,symbol:this.options.vertexSymbol}).addTo(this.qu);this.Vu()}Vu(){const A=this.getMeasureResult(),t=("zh-CN"!==this.options.language?"distance: ":": ")+this.Wu(A),n=t__namespace.Util.extend({textName:t},this.options.labelSymbol),i=this.Tu[this.Tu.length-1],r=this.Yu.getGeometries().length;this.Sn?(this.Sn.setSymbol([this.options.vertexSymbol,n]),this.Sn.setCoordinates(i)):this.Sn=new t__namespace.Marker(i,{id:"label"+r,symbol:[this.options.vertexSymbol,n]}).addTo(this.qu)}Wu(A){let t;t="zh-CN"===this.options.language?[" "," "," "," "]:[" m"," km"," feet"," mile"];let n="";return this.options.metric&&(this._u=A<1e3?A.toFixed(1):(A/1e3).toFixed(2),this.Ku=A<1e3?t[0]:t[1]),this.options.imperial&&(n.length>0&&(n+="\n"),this._u=(A*=3.2808399)<5280?A.toFixed(1):(A/5280).toFixed(2),this.Ku=A<5280?t[2]:t[3]),n+=this._u+this.Ku,n}Bu(A){this.et||(this.et=new t__namespace.LineString([A],{symbol:this.options.symbol}).addTo(this.Yu)),this.Ru(),this.ku=!0}getMeasureResult(){return this.et.getLength()}},exports.EffectLayer=St$1,exports.EffectLine=class extends st$1{constructor(t,n){super(t,n);const s=t$1.Util.extend({},Pt$1,this.options.symbol);this.setSymbol(s);const i=t$1.Util.extend({},It$1,this.options.symbol.uniforms);this.setUniforms(i),this.setShader("effectline"),this.ht="effectmarker"}getEffectType(){return"sequence"}setTexture(t){return this.setUniform("texture",t),this}setHeight(t){return this.setUniform("modelHeight",t),this}setStartOpacity(t){return this.setUniform("startOpacity",t),this}setEndOpacity(t){return this.setUniform("endOpacity",t),this}},exports.EffectLineLayer=kt$1,exports.EffectMarker=st$1,exports.EffectRing=class extends et$1{constructor(t,n){super(t,n);const s=t$1.Util.extend({},Nt$1,this.options.symbol.uniforms);this.setUniforms(s),this.setShader("effectring"),this.ht="effectring"}},exports.EffectRingLayer=Lt$1,exports.ElevateMask=sn$4,exports.ExcavateAnalysis=Zt,exports.ExtrudePolygonLayer=$n$2,exports.FillPainter=nr$2,exports.FillPlugin=ga,exports.FilterUtil=Mr$3,exports.FlatInsideMask=Ks$3,exports.FlatOutsideMask=Qs$3,exports.FloodAnalysis=dt,exports.GLContext=a,exports.GLTFGeometry=class extends et$1{Dt(t){const e=this.getMap(),n=e.getGLRes(),s=e.distanceToPointAtRes(100,100,n,this.getCenter()),i=e.altitudeToPoint(100,n);return t[0]*=s.x/100,t[1]*=s.y/100,t[2]*=i/100,t}},exports.GLTFLayer=ht$1,exports.GLTFLineString=vt$1,exports.GLTFMarker=et$1,exports.GLTFMercatorGeometry=class extends et$1{Dt(t){const e=this.getMap(),n=e.getGLRes(),s=this.getCoordinates(),i=e.coordToPointAtRes(s,n,ft$1),r=t$1.projection.EPSG3857.project(s,ut$1)._add(1,1),o=t$1.projection.EPSG3857.unproject(r,lt$1),a=e.coordToPointAtRes(o,n,dt$1),c=a.x-i.x,u=a.y-i.y,l=e.altitudeToPoint(100,n);return t[0]*=c,t[1]*=u,t[2]*=l/100,t}},exports.GLTFPhongPlugin=Ta,exports.GLTFStandardPlugin=ka,exports.Geo3DTilesLayer=os$1,exports.Geo3DTilesUtil=Nt$2,exports.Geo3DTransform=ue$1,exports.GeoJSONVectorTileLayer=ve$2,exports.GlowMarker=At$1,exports.GlowMarkerLayer=Et$1,exports.GroundPainter=jt$4,exports.GroupGLLayer=Cs$3,exports.HeatmapPlugin=Oa,exports.HeatmapProcess=$s$2,exports.Height3DTool=class extends Oh{Uu(){super.Uu(),this.qu=new Ye$2(t__namespace.INTERNAL_LAYER_PREFIX+"_height3dtool_marker").addTo(this.Fu).bringToFront(),this.Yu=new t__namespace.VectorLayer(t__namespace.INTERNAL_LAYER_PREFIX+"_height3dtool",{enableAltitude:!0}).addTo(this.Fu).bringToFront()}Nu(A){super.Nu(A),this.Tu.length>1&&(this.Gu(),this.disable())}Ru(){const A=this.qu.getGeometries(),t=this.Yu.getGeometries().length;for(let n=0;n<A.length;n++){const i=A[n].getId();i!=="label"+t+"_"+n&&0===i.indexOf(t+"_")&&A[n].remove()}for(let A=0;A<this.Tu.length;A++)new t__namespace.Marker(this.Tu[A],{id:t+"_"+A,symbol:this.options.vertexSymbol}).addTo(this.qu);const n=this.Tu.length;if(n>1){const e=new t__namespace.Coordinate([this.Tu[n-1].x,this.Tu[n-1].y,this.Tu[n-2].z]);new t__namespace.Marker(e,{id:t+"_2",symbol:this.options.vertexSymbol}).addTo(this.qu);const s=[].concat(this.Tu);s.push(e),s.push(this.Tu[0]);const o=s.map((A=>A.z));this.et.setCoordinates(s),this.et.setProperties({altitude:o});const h=this.Fu.getProjection().measureLenBetween(s[0],s[2]),f=s[1].z-s[2].z,c=Math.sqrt(Math.pow(h,2)+Math.pow(f,2));this.Vu(s,[c,f,h])}}Vu(A,t){for(let n=0;n<A.length-1;n++){const i=A[n],r=A[n+1],s="zh-CN"===this.options.language?0:1,o=this.Wu(t[n]),f=t__namespace.Util.extend({textName:Fh[s][n]+":"+o},this.options.labelSymbol);n<2&&(f.markerDx=20,f.textDx=25,f.markerHorizontalAlignment="right",f.textHorizontalAlignment="right");const c=1===n?i:new t__namespace.Coordinate((i.x+r.x)/2,(i.y+r.y)/2,(i.z+r.z)/2),a="label"+this.Yu.getGeometries().length+"_"+n,v=this.qu.getGeometryById(a);v?(v.setSymbol([this.options.vertexSymbol,f]),v.setCoordinates(c)):new t__namespace.Marker(c,{id:a,symbol:[this.options.vertexSymbol,f]}).addTo(this.qu)}}Wu(A){let t;t="zh-CN"===this.options.language?[" "," "," "," "]:[" m"," km"," feet"," mile"];let n="";return this.options.metric&&(this._u=A<1e3?A.toFixed(1):(A/1e3).toFixed(2),this.Ku=A<1e3?t[0]:t[1]),this.options.imperial&&(n.length>0&&(n+="\n"),this._u=(A*=3.2808399)<5280?A.toFixed(1):(A/5280).toFixed(2),this.Ku=A<5280?t[2]:t[3]),n+=this._u+this.Ku,n}Bu(A){this.et||(this.et=new t__namespace.LineString([A],{symbol:this.options.symbol}).addTo(this.Yu)),this.Ru(),this.ku=!0}getMeasureResult(){return this.et.getLength()}},exports.HeightLimitAnalysis=class extends dt{constructor(A){super(A),this.type="heightLimitAnalysis"}YA(A){super.YA(A);const t=this.layer.getMap();this.q.waterHeight=X(t,this.options.limitHeight),this.q.type=2}update(A,t){if(super.update(A,t),"limitHeight"===A){const A=this.layer.getMap();this.q.waterHeight=A.altitudeToPoint(t||0,A.getGLRes())}}renderAnalysis(A){const t=super.renderAnalysis(A);return t.heightLimitMap=t.floodMap,t.limitColor=this.options.limitColor||Lh,t}getDefines(){return{HAS_HEIGHTLIMIT:1}}},exports.HighlightUtil=Ws$3,exports.IconPainter=Es$1,exports.IconPlugin=ba,exports.InSightAnalysis=class extends LA{constructor(A){super(A),this.xt=A.lines||[],this.yt=new qt,this.type="insight"}update(A,t){"lines"===A?this.setLines(t):this.q[A]=t,super.update(A,t)}addLine(A){const{from:t,to:n}=A;t&&n&&this.xt.push(A),this.Lt()}removeLine(A){const t=this.xt.indexOf(A);t>-1&&this.xt.splice(t,1),this.Lt()}getLines(){return this.xt}setLines(A){this.xt=A,this.Lt()}clearLines(){this.xt=[],this.Lt()}getIntersetction(){const A=[];if(!this.Tt)return A;const t=this.layer.getMap();for(let n=0;n<this.xt.length;n++){const{from:i,to:r}=this.xt[n];this.yt.setFromPoint(i),this.yt.setToPoint(r);const e=this.yt.test(this.Tt,t);if(e&&e.length){const t={inSightLine:this.xt[n],intersects:[]};e.forEach((A=>{const n=this.Ot(A);n&&t.intersects.push(n)})),A.push(t)}}return A}Ot(A){const t=[],n=this.layer;if(!n)return t;const{mesh:i,coordinates:r}=A,e=this.getExcludeLayers();return n.getLayers().forEach((A=>{const n=A.getId(),s=A.getRenderer();if(e.indexOf(n)<0&&s&&s.getRayCastData&&r.length){const n=s.getRayCastData(i,r[0].indices[0]);n&&t.push({data:n,coordinates:r})}})),t}Lt(){this.YA();const A=this.layer.getRenderer();A&&A.setToRedraw()}YA(){const A=this.layer.getMap();this.q={},this.q.lines=this.xt.map((t=>{const{from:n,to:i}=t;return{from:AA(A,...n),to:AA(A,...i)}})),this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=A.projViewMatrix,this.q.horizontalAngle=45,this.q.verticalAngle=45,this.q.minAltitude=0}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const i=new B$6(t.regl);this.k=this.k||new Lt(i,n),this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={};this.Tt=A;const n=this.k.render(A,this.q);return t.insightMap=n,t.insight_visibleColor=this.q.visibleColor||[0,1,0,1],t.insight_invisibleColor=this.q.invisibleColor||[1,0,0,1],t}getDefines(){return{HAS_INSIGHT:1}}},exports.LineGradientPlugin=xa,exports.LinePainter=or$2,exports.LinePlugin=va,exports.LineStringLayer=$e$2,exports.LitPlugin=Ma,exports.MSDJSONLoader=class{constructor(t){this.i=t||{}}load(){const t=this.i.data;let r=this.i.basePath;if("string"==typeof(e=t)||null!==e.constructor&&e.constructor===String){const e=this.i.fetchFunction||fetch,i=this.i.fetchOptions;if(!r){const e=t.lastIndexOf("/");r=e<0?"./":t.substring(0,e)}return e(t,i).then((t=>t.json())).then((t=>(this.s(t,r),this)))}return this.s(t,r||"./"),Promise.resolve(this);var e}getMSDJSON(){return e(this.h)}getMapJSON(){return e(this.t)}getView(){if(!this.t)return null;const{center:t,zoom:r,pitch:e,bearing:i}=this.t;return{center:t,zoom:r,pitch:e,bearing:i}}getLights(){return this.t&&this.t.options.lights}getSceneConfig(){return this.t&&this.t.layers[0].options.sceneConfig}s(r,i){if("./"!==i&&"."!==i){"/"!==i[i.length-1]&&(i+="/"),this.h=r;let t=JSON.stringify(r);t=t.replace(/".\/res/g,'"'+i+"res"),r=JSON.parse(t)}else this.h=e(r);this.t=r||{},this.u=function(r){return r.layers?r.layers.map((r=>r?new t(r):null)):[]}(r.layers[0])}getLayer(t){const r=this.u;if(!r)return null;for(let e=0;e<r.length;e++){const i=r[e];if(i&&t===i.getId())return i}return null}getLayers(){return this.u||[]}},exports.MapboxVectorTileLayer=ye$2,exports.MaskLayerMixin=ds$4,exports.MaskRendererMixin=oe$4,exports.MultiGLTFMarker=_t$1,exports.NativeLinePainter=To$1,exports.NativeLinePlugin=wa,exports.NativePointPainter=So$1,exports.PackUtil=Fa,exports.PhongPainter=Uo$1,exports.PhongPlugin=_a,exports.PointLayer=Ye$2,exports.PolygonLayer=Je$2,exports.RayCaster=qt,exports.SYMBOLS_NEED_REBUILD_IN_VECTOR=Ia$1,exports.SYMBOLS_NEED_REBUILD_IN_VT=Da,exports.SkylineAnalysis=class extends LA{constructor(A){super(A),this.type="skyline"}YA(){const A=this.layer.getMap();this.q={},this.q.lineColor=this.options.lineColor,this.q.lineWidth=this.options.lineWidth,this.q.projViewMatrix=A.projViewMatrix,this.q.minAltitude=0}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA(),this.renderer=new B$6(t.regl),this.k=new Ct(this.renderer,n)||this.k,this.layer.addAnalysis(this),this.At=this.tt(t.regl)}renderAnalysis(A){this.At=this.At||this.tt(this.renderer.regl);const t=this.layer.getMap();this.nt(t);const n={},i=A.concat([this.At]);return this.renderer.clear({color:[0,0,0,1],depth:1,framebuffer:this.T}),this.T=this.k.render(i,this.q),n.skylineMap=this.T,n}exportSkylineMap(A){if(!Dt||!this.isEnable())return null;A||(A={});const t=this.k.getRenderMeshes(),n=this.exportAnalysisMap(t),i=this.T.width,r=this.T.height,e=new Uint8ClampedArray(n.length);for(let A=0;A<i;A++)for(let t=0;t<r;t++)e[4*(t*i+A)]=n[4*((r-t)*i+A)],e[4*(t*i+A)+1]=n[4*((r-t)*i+A)+1],e[4*(t*i+A)+2]=n[4*((r-t)*i+A)+2],e[4*(t*i+A)+3]=n[4*((r-t)*i+A)+3],0===e[4*(t*i+A)]&&0===e[4*(t*i+A)+1]&&0===e[4*(t*i+A)+2]&&(e[4*(t*i+A)+3]=0);Dt.width=i,Dt.height=r;const s=new ImageData(e,i,r);Dt.getContext("2d").putImageData(s,0,0);const u=Dt.toDataURL();if(A.save){const t=document.createElement("a");t.download=A.filename||"export",t.href=u,document.body.appendChild(t),t.click(),document.body.removeChild(t)}return u}update(A,t){this.q[A]=t,super.update(A,t)}tt(t){const n=new tn$5;return n.generateBuffers(t),n.data.aTexCoord=new Float32Array(8),new Be$5(n)}nt(A){const t=jt$4.getGroundTransform(this.At.localTransform,A);this.At.setLocalTransform(t)}remove(){super.remove(),this.At&&(this.At.geometry.dispose(),this.At.dispose(),delete this.At)}getDefines(){return{HAS_SKYLINE:1}}},exports.TextPainter=xo$1,exports.TextPlugin=Aa,exports.TransformControl=tA$1,exports.TubePlugin=Pa,exports.Vector3DLayer=we$2,exports.VectorTileLayer=he$2,exports.VectorTileLayerRenderer=Jt$2,exports.VideoLayer=b$1,exports.VideoMask=en$4,exports.VideoSurface=y$1,exports.ViewshedAnalysis=class extends LA{constructor(A){super(A),this.type="viewshed"}update(A,t){if("eyePos"===A||"lookPoint"===A){const n=this.layer.getMap();this.q[A]=AA(n,...t)}else this.q[A]=t;super.update(A,t)}YA(){const A=this.layer.getMap();this.q={},this.q.eyePos=AA(A,...this.options.eyePos),this.q.lookPoint=AA(A,...this.options.lookPoint),this.q.verticalAngle=this.options.verticalAngle,this.q.horizontalAngle=this.options.horizontalAngle,this.q.visibleColor=this.options.visibleColor,this.q.invisibleColor=this.options.invisibleColor,this.q.projViewMatrix=A.projViewMatrix,this.q.minAltitude=0}S(t){const n={x:0,y:0,width:()=>t.canvas?t.canvas.width:1,height:()=>t.canvas?t.canvas.height:1};this.YA();const i=new B$6(t.regl);this.k=new Pt(i,n)||this.k,this.layer.addAnalysis(this),t.setToRedraw()}renderAnalysis(A){const t={},n=this.k.render(A,this.q);return t.viewshedMap=n,t.viewshed_visibleColor=this.q.visibleColor||[0,1,0,.3],t.viewshed_invisibleColor=this.q.invisibleColor||[1,0,0,.3],t}getVertexCoordinates(){const A=this.layer.getMap();return A?this.k.HA(A):[]}getDefines(){return{HAS_VIEWSHED:1}}},exports.WaterPlugin=Ia,exports.WireframePainter=Bo$1,exports.WireframePlugin=Sa,exports.createREGL=a$2,exports.glMatrix=common,exports.mat2=mat2,exports.mat2d=mat2d,exports.mat3=mat3,exports.mat4=mat4,exports.quat=quat,exports.quat2=quat2,exports.reshader=l$1,exports.transcoders=transcoders,exports.vec2=vec2,exports.vec3=vec3,exports.vec4=vec4,Object.defineProperty(exports,"__esModule",{value:!0}),"undefined"!=typeof console&&console.log("@maptalks/gl-layers v0.31.8")}));
